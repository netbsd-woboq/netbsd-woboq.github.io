<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ntp_monitor.c source code [netbsd/external/bsd/ntp/dist/ntpd/ntp_monitor.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/external/bsd/ntp/dist/ntpd/ntp_monitor.c'; var root_path = '../../../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../..'>netbsd</a>/<a href='../../../..'>external</a>/<a href='../../..'>bsd</a>/<a href='../..'>ntp</a>/<a href='..'>dist</a>/<a href='./'>ntpd</a>/<a href='ntp_monitor.c.html'>ntp_monitor.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: ntp_monitor.c,v 1.5 2016/01/08 21:35:39 christos Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * ntp_monitor - monitor ntpd statistics</i></td></tr>
<tr><th id="5">5</th><td><i> */</i></td></tr>
<tr><th id="6">6</th><td><u>#<span data-ppcond="6">ifdef</span> <span class="macro" data-ref="_M/HAVE_CONFIG_H">HAVE_CONFIG_H</span></u></td></tr>
<tr><th id="7">7</th><td><u># include <a href="../../include/config.h.html">&lt;config.h&gt;</a></u></td></tr>
<tr><th id="8">8</th><td><u>#<span data-ppcond="6">endif</span></u></td></tr>
<tr><th id="9">9</th><td></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="../include/ntpd.h.html">"ntpd.h"</a></u></td></tr>
<tr><th id="11">11</th><td><u>#include <a href="../include/ntp_io.h.html">"ntp_io.h"</a></u></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="../include/ntp_if.h.html">"ntp_if.h"</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include <a href="../include/ntp_lists.h.html">"ntp_lists.h"</a></u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../include/ntp_stdlib.h.html">"ntp_stdlib.h"</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../include/ntp_random.h.html">&lt;ntp_random.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html">&lt;stdio.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/signal.h.html">&lt;signal.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#<span data-ppcond="19">ifdef</span> <a class="macro" href="../../include/config.h.html#977" data-ref="_M/HAVE_SYS_IOCTL_H">HAVE_SYS_IOCTL_H</a></u></td></tr>
<tr><th id="20">20</th><td><u># include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/ioctl.h.html">&lt;sys/ioctl.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#<span data-ppcond="19">endif</span></u></td></tr>
<tr><th id="22">22</th><td></td></tr>
<tr><th id="23">23</th><td><i>/*</i></td></tr>
<tr><th id="24">24</th><td><i> * Record statistics based on source address, mode and version. The</i></td></tr>
<tr><th id="25">25</th><td><i> * receive procedure calls us with the incoming rbufp before it does</i></td></tr>
<tr><th id="26">26</th><td><i> * anything else. While at it, implement rate controls for inbound</i></td></tr>
<tr><th id="27">27</th><td><i> * traffic.</i></td></tr>
<tr><th id="28">28</th><td><i> *</i></td></tr>
<tr><th id="29">29</th><td><i> * Each entry is doubly linked into two lists, a hash table and a most-</i></td></tr>
<tr><th id="30">30</th><td><i> * recently-used (MRU) list. When a packet arrives it is looked up in</i></td></tr>
<tr><th id="31">31</th><td><i> * the hash table. If found, the statistics are updated and the entry</i></td></tr>
<tr><th id="32">32</th><td><i> * relinked at the head of the MRU list. If not found, a new entry is</i></td></tr>
<tr><th id="33">33</th><td><i> * allocated, initialized and linked into both the hash table and at the</i></td></tr>
<tr><th id="34">34</th><td><i> * head of the MRU list.</i></td></tr>
<tr><th id="35">35</th><td><i> *</i></td></tr>
<tr><th id="36">36</th><td><i> * Memory is usually allocated by grabbing a big chunk of new memory and</i></td></tr>
<tr><th id="37">37</th><td><i> * cutting it up into littler pieces. The exception to this when we hit</i></td></tr>
<tr><th id="38">38</th><td><i> * the memory limit. Then we free memory by grabbing entries off the</i></td></tr>
<tr><th id="39">39</th><td><i> * tail for the MRU list, unlinking from the hash table, and</i></td></tr>
<tr><th id="40">40</th><td><i> * reinitializing.</i></td></tr>
<tr><th id="41">41</th><td><i> *</i></td></tr>
<tr><th id="42">42</th><td><i> * INC_MONLIST is the default allocation granularity in entries.</i></td></tr>
<tr><th id="43">43</th><td><i> * INIT_MONLIST is the default initial allocation in entries.</i></td></tr>
<tr><th id="44">44</th><td><i> */</i></td></tr>
<tr><th id="45">45</th><td><u>#<span data-ppcond="45">ifdef</span> <span class="macro" data-ref="_M/MONMEMINC">MONMEMINC</span>		/* old name */</u></td></tr>
<tr><th id="46">46</th><td><u># define	INC_MONLIST	MONMEMINC</u></td></tr>
<tr><th id="47">47</th><td><u>#<span data-ppcond="45">elif</span> !defined(<span class="macro" data-ref="_M/INC_MONLIST">INC_MONLIST</span>)</u></td></tr>
<tr><th id="48">48</th><td><u># define	<dfn class="macro" id="_M/INC_MONLIST" data-ref="_M/INC_MONLIST">INC_MONLIST</dfn>	(4 * 1024 / sizeof(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>))</u></td></tr>
<tr><th id="49">49</th><td><u>#<span data-ppcond="45">endif</span></u></td></tr>
<tr><th id="50">50</th><td><u>#<span data-ppcond="50">ifndef</span> <span class="macro" data-ref="_M/INIT_MONLIST">INIT_MONLIST</span></u></td></tr>
<tr><th id="51">51</th><td><u># define	<dfn class="macro" id="_M/INIT_MONLIST" data-ref="_M/INIT_MONLIST">INIT_MONLIST</dfn>	(4 * 1024 / sizeof(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>))</u></td></tr>
<tr><th id="52">52</th><td><u>#<span data-ppcond="50">endif</span></u></td></tr>
<tr><th id="53">53</th><td><u>#<span data-ppcond="53">ifndef</span> <span class="macro" data-ref="_M/MRU_MAXDEPTH_DEF">MRU_MAXDEPTH_DEF</span></u></td></tr>
<tr><th id="54">54</th><td><u># define <dfn class="macro" id="_M/MRU_MAXDEPTH_DEF" data-ref="_M/MRU_MAXDEPTH_DEF">MRU_MAXDEPTH_DEF</dfn>	(1024 * 1024 / sizeof(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>))</u></td></tr>
<tr><th id="55">55</th><td><u>#<span data-ppcond="53">endif</span></u></td></tr>
<tr><th id="56">56</th><td></td></tr>
<tr><th id="57">57</th><td><i>/*</i></td></tr>
<tr><th id="58">58</th><td><i> * Hashing stuff</i></td></tr>
<tr><th id="59">59</th><td><i> */</i></td></tr>
<tr><th id="60">60</th><td><a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="decl def" id="mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</dfn>;</td></tr>
<tr><th id="61">61</th><td></td></tr>
<tr><th id="62">62</th><td><i>/*</i></td></tr>
<tr><th id="63">63</th><td><i> * Pointers to the hash table and the MRU list.  Memory for the hash</i></td></tr>
<tr><th id="64">64</th><td><i> * table is allocated only if monitoring is enabled.</i></td></tr>
<tr><th id="65">65</th><td><i> */</i></td></tr>
<tr><th id="66">66</th><td><a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> **	<dfn class="decl def" id="mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</dfn>;	<i>/* MRU hash table */</i></td></tr>
<tr><th id="67">67</th><td><a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>	<dfn class="decl def" id="mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</dfn>;	<i>/* mru listhead */</i></td></tr>
<tr><th id="68">68</th><td></td></tr>
<tr><th id="69">69</th><td><i  data-doc="mon_free">/*</i></td></tr>
<tr><th id="70">70</th><td><i  data-doc="mon_free"> * List of free structures structures, and counters of in-use and total</i></td></tr>
<tr><th id="71">71</th><td><i  data-doc="mon_free"> * structures. The free structures are linked with the hash_next field.</i></td></tr>
<tr><th id="72">72</th><td><i  data-doc="mon_free"> */</i></td></tr>
<tr><th id="73">73</th><td><em>static</em>  <a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="tu decl def" id="mon_free" title='mon_free' data-type='mon_entry *' data-ref="mon_free" data-ref-filename="mon_free">mon_free</dfn>;		<i  data-doc="mon_free">/* free list or null if none */</i></td></tr>
<tr><th id="74">74</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="decl def" id="mru_alloc" title='mru_alloc' data-ref="mru_alloc" data-ref-filename="mru_alloc">mru_alloc</dfn>;		<i>/* mru list + free list count */</i></td></tr>
<tr><th id="75">75</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="decl def" id="mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</dfn>;		<i>/* mru list count */</i></td></tr>
<tr><th id="76">76</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="decl def" id="mru_peakentries" title='mru_peakentries' data-ref="mru_peakentries" data-ref-filename="mru_peakentries">mru_peakentries</dfn>;		<i>/* highest mru_entries seen */</i></td></tr>
<tr><th id="77">77</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="decl def" id="mru_initalloc" title='mru_initalloc' data-ref="mru_initalloc" data-ref-filename="mru_initalloc">mru_initalloc</dfn> = <a class="macro" href="#51" title="(4 * 1024 / sizeof(mon_entry))" data-ref="_M/INIT_MONLIST">INIT_MONLIST</a>;<i>/* entries to preallocate */</i></td></tr>
<tr><th id="78">78</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="decl def" id="mru_incalloc" title='mru_incalloc' data-ref="mru_incalloc" data-ref-filename="mru_incalloc">mru_incalloc</dfn> = <a class="macro" href="#48" title="(4 * 1024 / sizeof(mon_entry))" data-ref="_M/INC_MONLIST">INC_MONLIST</a>;<i>/* allocation batch factor */</i></td></tr>
<tr><th id="79">79</th><td><em>static</em>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl def" id="mon_mem_increments" title='mon_mem_increments' data-type='u_int' data-ref="mon_mem_increments" data-ref-filename="mon_mem_increments">mon_mem_increments</dfn>;	<i  data-doc="mon_mem_increments">/* times called malloc() */</i></td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><i>/*</i></td></tr>
<tr><th id="82">82</th><td><i> * Parameters of the RES_LIMITED restriction option. We define headway</i></td></tr>
<tr><th id="83">83</th><td><i> * as the idle time between packets. A packet is discarded if the</i></td></tr>
<tr><th id="84">84</th><td><i> * headway is less than the minimum, as well as if the average headway</i></td></tr>
<tr><th id="85">85</th><td><i> * is less than eight times the increment.</i></td></tr>
<tr><th id="86">86</th><td><i> */</i></td></tr>
<tr><th id="87">87</th><td><em>int</em>	<dfn class="decl def" id="ntp_minpkt" title='ntp_minpkt' data-ref="ntp_minpkt" data-ref-filename="ntp_minpkt">ntp_minpkt</dfn> = <a class="macro" href="../include/ntp.h.html#111" title="2" data-ref="_M/NTP_MINPKT">NTP_MINPKT</a>;	<i>/* minimum (log 2 s) */</i></td></tr>
<tr><th id="88">88</th><td><a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="decl def" id="ntp_minpoll" title='ntp_minpoll' data-ref="ntp_minpoll" data-ref-filename="ntp_minpoll">ntp_minpoll</dfn> = <a class="macro" href="../include/ntp.h.html#106" title="3" data-ref="_M/NTP_MINPOLL">NTP_MINPOLL</a>;	<i>/* increment (log 2 s) */</i></td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td><i>/*</i></td></tr>
<tr><th id="91">91</th><td><i> * Initialization state.  We may be monitoring, we may not.  If</i></td></tr>
<tr><th id="92">92</th><td><i> * we aren't, we may not even have allocated any memory yet.</i></td></tr>
<tr><th id="93">93</th><td><i> */</i></td></tr>
<tr><th id="94">94</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="decl def" id="mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</dfn>;		<i>/* enable switch */</i></td></tr>
<tr><th id="95">95</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="decl def" id="mru_mindepth" title='mru_mindepth' data-ref="mru_mindepth" data-ref-filename="mru_mindepth">mru_mindepth</dfn> = <var>600</var>;	<i>/* preempt above this */</i></td></tr>
<tr><th id="96">96</th><td>	<em>int</em>	<dfn class="decl def" id="mru_maxage" title='mru_maxage' data-ref="mru_maxage" data-ref-filename="mru_maxage">mru_maxage</dfn> = <var>64</var>;	<i>/* for entries older than */</i></td></tr>
<tr><th id="97">97</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="decl def" id="mru_maxdepth" title='mru_maxdepth' data-ref="mru_maxdepth" data-ref-filename="mru_maxdepth">mru_maxdepth</dfn> = 		<i>/* MRU count hard limit */</i></td></tr>
<tr><th id="98">98</th><td>			<a class="macro" href="#54" title="(1024 * 1024 / sizeof(mon_entry))" data-ref="_M/MRU_MAXDEPTH_DEF">MRU_MAXDEPTH_DEF</a>;</td></tr>
<tr><th id="99">99</th><td>	<em>int</em>	<dfn class="decl def" id="mon_age" title='mon_age' data-ref="mon_age" data-ref-filename="mon_age">mon_age</dfn> = <var>3000</var>;		<i>/* preemption limit */</i></td></tr>
<tr><th id="100">100</th><td></td></tr>
<tr><th id="101">101</th><td><em>static</em>	<em>void</em>		<a class="tu decl fn" href="#mon_getmoremem" title='mon_getmoremem' data-type='void mon_getmoremem()' data-ref="mon_getmoremem" data-ref-filename="mon_getmoremem">mon_getmoremem</a>(<em>void</em>);</td></tr>
<tr><th id="102">102</th><td><em>static</em>	<em>void</em>		<a class="tu decl fn" href="#remove_from_hash" title='remove_from_hash' data-type='void remove_from_hash(mon_entry * )' data-ref="remove_from_hash" data-ref-filename="remove_from_hash">remove_from_hash</a>(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *);</td></tr>
<tr><th id="103">103</th><td><em>static</em>	<b>inline</b> <em>void</em>	<a class="tu decl fn" href="#mon_free_entry" title='mon_free_entry' data-type='void mon_free_entry(mon_entry * )' data-ref="mon_free_entry" data-ref-filename="mon_free_entry">mon_free_entry</a>(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *);</td></tr>
<tr><th id="104">104</th><td><em>static</em>	<b>inline</b> <em>void</em>	<a class="tu decl fn" href="#mon_reclaim_entry" title='mon_reclaim_entry' data-type='void mon_reclaim_entry(mon_entry * )' data-ref="mon_reclaim_entry" data-ref-filename="mon_reclaim_entry">mon_reclaim_entry</a>(<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *);</td></tr>
<tr><th id="105">105</th><td></td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td><i>/*</i></td></tr>
<tr><th id="108">108</th><td><i> * init_mon - initialize monitoring global data</i></td></tr>
<tr><th id="109">109</th><td><i> */</i></td></tr>
<tr><th id="110">110</th><td><em>void</em></td></tr>
<tr><th id="111">111</th><td><dfn class="decl def fn" id="init_mon" title='init_mon' data-ref="init_mon" data-ref-filename="init_mon">init_mon</dfn>(<em>void</em>)</td></tr>
<tr><th id="112">112</th><td>{</td></tr>
<tr><th id="113">113</th><td>	<i>/*</i></td></tr>
<tr><th id="114">114</th><td><i>	 * Don't do much of anything here.  We don't allocate memory</i></td></tr>
<tr><th id="115">115</th><td><i>	 * until mon_start().</i></td></tr>
<tr><th id="116">116</th><td><i>	 */</i></td></tr>
<tr><th id="117">117</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> = <a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a>;</td></tr>
<tr><th id="118">118</th><td>	<a class="macro" href="../include/ntp_lists.h.html#363" title="do { (mon_mru_list).mru.f = &amp;(mon_mru_list); (mon_mru_list).mru.b = &amp;(mon_mru_list); } while (0)" data-ref="_M/INIT_DLIST">INIT_DLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="119">119</th><td>}</td></tr>
<tr><th id="120">120</th><td></td></tr>
<tr><th id="121">121</th><td></td></tr>
<tr><th id="122">122</th><td><i  data-doc="remove_from_hash">/*</i></td></tr>
<tr><th id="123">123</th><td><i  data-doc="remove_from_hash"> * remove_from_hash - removes an entry from the address hash table and</i></td></tr>
<tr><th id="124">124</th><td><i  data-doc="remove_from_hash"> *		      decrements mru_entries.</i></td></tr>
<tr><th id="125">125</th><td><i  data-doc="remove_from_hash"> */</i></td></tr>
<tr><th id="126">126</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="127">127</th><td><dfn class="tu decl def fn" id="remove_from_hash" title='remove_from_hash' data-type='void remove_from_hash(mon_entry * mon)' data-ref="remove_from_hash" data-ref-filename="remove_from_hash">remove_from_hash</dfn>(</td></tr>
<tr><th id="128">128</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col1 decl" id="1mon" title='mon' data-type='mon_entry *' data-ref="1mon" data-ref-filename="1mon">mon</dfn></td></tr>
<tr><th id="129">129</th><td>	)</td></tr>
<tr><th id="130">130</th><td>{</td></tr>
<tr><th id="131">131</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="local col2 decl" id="2hash" title='hash' data-type='u_int' data-ref="2hash" data-ref-filename="2hash">hash</dfn>;</td></tr>
<tr><th id="132">132</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col3 decl" id="3punlinked" title='punlinked' data-type='mon_entry *' data-ref="3punlinked" data-ref-filename="3punlinked">punlinked</dfn>;</td></tr>
<tr><th id="133">133</th><td></td></tr>
<tr><th id="134">134</th><td>	<a class="ref" href="../include/ntpd.h.html#mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</a>--;</td></tr>
<tr><th id="135">135</th><td>	<a class="local col2 ref" href="#2hash" title='hash' data-ref="2hash" data-ref-filename="2hash">hash</a> = <a class="macro" href="../include/ntpd.h.html#163" title="(sock_hash(&amp;mon-&gt;rmtadr) &amp; (((size_t)1U &lt;&lt; mon_hash_bits) - 1))" data-ref="_M/MON_HASH">MON_HASH</a>(&amp;<a class="local col1 ref" href="#1mon" title='mon' data-ref="1mon" data-ref-filename="1mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::rmtadr" title='mon_data::rmtadr' data-ref="mon_data::rmtadr" data-ref-filename="mon_data..rmtadr">rmtadr</a>);</td></tr>
<tr><th id="136">136</th><td>	<a class="macro" href="../include/ntp_lists.h.html#209" title="do { mon_entry **ppentry; ppentry = &amp;(mon_hash[hash]); while (!((mon) == (*ppentry))) if (*ppentry != ((void*)0) &amp;&amp; (*ppentry)-&gt;hash_next != ((void*)0)) { ppentry = &amp;((*ppentry)-&gt;hash_next); } else { ppentry = ((void*)0); break; } if (ppentry != ((void*)0)) { (punlinked) = *ppentry; *ppentry = (punlinked)-&gt;hash_next; ((punlinked)-&gt;hash_next) = ((void*)0); } else { (punlinked) = ((void*)0); } } while (0)" data-ref="_M/UNLINK_SLIST">UNLINK_SLIST</a>(<a class="local col3 ref" href="#3punlinked" title='punlinked' data-ref="3punlinked" data-ref-filename="3punlinked">punlinked</a>, <a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>[<a class="local col2 ref" href="#2hash" title='hash' data-ref="2hash" data-ref-filename="2hash">hash</a>], <a class="local col1 ref" href="#1mon" title='mon' data-ref="1mon" data-ref-filename="1mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>,</td></tr>
<tr><th id="137">137</th><td>		     <a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>);</td></tr>
<tr><th id="138">138</th><td>	<a class="macro" href="../include/ntp_assert.h.html#87" title="((void) ((punlinked == mon) || ((isc_assertion_failed)(&quot;/___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/ntp_monitor.c&quot;, 138, isc_assertiontype_ensure, &quot;punlinked == mon&quot;), 0)))" data-ref="_M/ENSURE">ENSURE</a>(<a class="local col3 ref" href="#3punlinked" title='punlinked' data-ref="3punlinked" data-ref-filename="3punlinked">punlinked</a> == <a class="local col1 ref" href="#1mon" title='mon' data-ref="1mon" data-ref-filename="1mon">mon</a>);</td></tr>
<tr><th id="139">139</th><td>}</td></tr>
<tr><th id="140">140</th><td></td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td><em>static</em> <b>inline</b> <em>void</em></td></tr>
<tr><th id="143">143</th><td><dfn class="tu decl def fn" id="mon_free_entry" title='mon_free_entry' data-type='void mon_free_entry(mon_entry * m)' data-ref="mon_free_entry" data-ref-filename="mon_free_entry">mon_free_entry</dfn>(</td></tr>
<tr><th id="144">144</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col4 decl" id="4m" title='m' data-type='mon_entry *' data-ref="4m" data-ref-filename="4m">m</dfn></td></tr>
<tr><th id="145">145</th><td>	)</td></tr>
<tr><th id="146">146</th><td>{</td></tr>
<tr><th id="147">147</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(*m), sizeof(*m))" data-ref="_M/ZERO">ZERO</a>(*<a class="local col4 ref" href="#4m" title='m' data-ref="4m" data-ref-filename="4m">m</a>);</td></tr>
<tr><th id="148">148</th><td>	<a class="macro" href="../include/ntp_lists.h.html#130" title="do { (m)-&gt;hash_next = (mon_free); (mon_free) = (m); } while (0)" data-ref="_M/LINK_SLIST">LINK_SLIST</a>(<a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free"><a class="tu ref" href="#mon_free" title='mon_free' data-use='w' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a></a>, <a class="local col4 ref" href="#4m" title='m' data-ref="4m" data-ref-filename="4m">m</a>, <a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>);</td></tr>
<tr><th id="149">149</th><td>}</td></tr>
<tr><th id="150">150</th><td></td></tr>
<tr><th id="151">151</th><td></td></tr>
<tr><th id="152">152</th><td><i  data-doc="mon_reclaim_entry">/*</i></td></tr>
<tr><th id="153">153</th><td><i  data-doc="mon_reclaim_entry"> * mon_reclaim_entry - Remove an entry from the MRU list and from the</i></td></tr>
<tr><th id="154">154</th><td><i  data-doc="mon_reclaim_entry"> *		       hash array, then zero-initialize it.  Indirectly</i></td></tr>
<tr><th id="155">155</th><td><i  data-doc="mon_reclaim_entry"> *		       decrements mru_entries.</i></td></tr>
<tr><th id="156">156</th><td><i  data-doc="mon_reclaim_entry"></i></td></tr>
<tr><th id="157">157</th><td><i  data-doc="mon_reclaim_entry"> * The entry is prepared to be reused.  Before return, in</i></td></tr>
<tr><th id="158">158</th><td><i  data-doc="mon_reclaim_entry"> * remove_from_hash(), mru_entries is decremented.  It is the caller's</i></td></tr>
<tr><th id="159">159</th><td><i  data-doc="mon_reclaim_entry"> * responsibility to increment it again.</i></td></tr>
<tr><th id="160">160</th><td><i  data-doc="mon_reclaim_entry"> */</i></td></tr>
<tr><th id="161">161</th><td><em>static</em> <b>inline</b> <em>void</em></td></tr>
<tr><th id="162">162</th><td><dfn class="tu decl def fn" id="mon_reclaim_entry" title='mon_reclaim_entry' data-type='void mon_reclaim_entry(mon_entry * m)' data-ref="mon_reclaim_entry" data-ref-filename="mon_reclaim_entry">mon_reclaim_entry</dfn>(</td></tr>
<tr><th id="163">163</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col5 decl" id="5m" title='m' data-type='mon_entry *' data-ref="5m" data-ref-filename="5m">m</dfn></td></tr>
<tr><th id="164">164</th><td>	)</td></tr>
<tr><th id="165">165</th><td>{</td></tr>
<tr><th id="166">166</th><td>	<a class="macro" href="../include/ntp_assert.h.html#96" title="((void) ((((void*)0) != m) || ((isc_assertion_failed)(&quot;/___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/ntp_monitor.c&quot;, 166, isc_assertiontype_insist, &quot;((void*)0) != m&quot;), 0)))" data-ref="_M/DEBUG_INSIST">DEBUG_INSIST</a>(<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> != <a class="local col5 ref" href="#5m" title='m' data-ref="5m" data-ref-filename="5m">m</a>);</td></tr>
<tr><th id="167">167</th><td></td></tr>
<tr><th id="168">168</th><td>	<a class="macro" href="../include/ntp_lists.h.html#413" title="do { (m)-&gt;mru.b-&gt;mru.f = (m)-&gt;mru.f; (m)-&gt;mru.f-&gt;mru.b = (m)-&gt;mru.b; ((m)-&gt;mru.b) = ((void*)0); ((m)-&gt;mru.f) = ((void*)0); } while (0)" data-ref="_M/UNLINK_DLIST">UNLINK_DLIST</a>(<a class="local col5 ref" href="#5m" title='m' data-ref="5m" data-ref-filename="5m">m</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="169">169</th><td>	<a class="tu ref fn" href="#remove_from_hash" title='remove_from_hash' data-use='c' data-ref="remove_from_hash" data-ref-filename="remove_from_hash">remove_from_hash</a>(<a class="local col5 ref" href="#5m" title='m' data-ref="5m" data-ref-filename="5m">m</a>);</td></tr>
<tr><th id="170">170</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(*m), sizeof(*m))" data-ref="_M/ZERO">ZERO</a>(*<a class="local col5 ref" href="#5m" title='m' data-ref="5m" data-ref-filename="5m">m</a>);</td></tr>
<tr><th id="171">171</th><td>}</td></tr>
<tr><th id="172">172</th><td></td></tr>
<tr><th id="173">173</th><td></td></tr>
<tr><th id="174">174</th><td><i  data-doc="mon_getmoremem">/*</i></td></tr>
<tr><th id="175">175</th><td><i  data-doc="mon_getmoremem"> * mon_getmoremem - get more memory and put it on the free list</i></td></tr>
<tr><th id="176">176</th><td><i  data-doc="mon_getmoremem"> */</i></td></tr>
<tr><th id="177">177</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="178">178</th><td><dfn class="tu decl def fn" id="mon_getmoremem" title='mon_getmoremem' data-type='void mon_getmoremem()' data-ref="mon_getmoremem" data-ref-filename="mon_getmoremem">mon_getmoremem</dfn>(<em>void</em>)</td></tr>
<tr><th id="179">179</th><td>{</td></tr>
<tr><th id="180">180</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col6 decl" id="6chunk" title='chunk' data-type='mon_entry *' data-ref="6chunk" data-ref-filename="6chunk">chunk</dfn>;</td></tr>
<tr><th id="181">181</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="local col7 decl" id="7entries" title='entries' data-type='u_int' data-ref="7entries" data-ref-filename="7entries">entries</dfn>;</td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td>	<a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a> = (<var>0</var> == <a class="tu ref" href="#mon_mem_increments" title='mon_mem_increments' data-use='r' data-ref="mon_mem_increments" data-ref-filename="mon_mem_increments">mon_mem_increments</a>)</td></tr>
<tr><th id="184">184</th><td>		      ? <a class="ref" href="../include/ntpd.h.html#mru_initalloc" title='mru_initalloc' data-ref="mru_initalloc" data-ref-filename="mru_initalloc">mru_initalloc</a></td></tr>
<tr><th id="185">185</th><td>		      : <a class="ref" href="../include/ntpd.h.html#mru_incalloc" title='mru_incalloc' data-ref="mru_incalloc" data-ref-filename="mru_incalloc">mru_incalloc</a>;</td></tr>
<tr><th id="186">186</th><td></td></tr>
<tr><th id="187">187</th><td>	<b>if</b> (<a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>) {</td></tr>
<tr><th id="188">188</th><td>		<a class="local col6 ref" href="#6chunk" title='chunk' data-ref="6chunk" data-ref-filename="6chunk">chunk</a> = <a class="macro" href="../include/ntp_stdlib.h.html#119" title="oreallocarrayxz(((void*)0), (entries), (sizeof(*chunk)), 0)" data-ref="_M/eallocarray">eallocarray</a>(<a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>, <b>sizeof</b>(*<a class="local col6 ref" href="#6chunk" title='chunk' data-ref="6chunk" data-ref-filename="6chunk">chunk</a>));</td></tr>
<tr><th id="189">189</th><td>		<a class="ref" href="../include/ntpd.h.html#mru_alloc" title='mru_alloc' data-ref="mru_alloc" data-ref-filename="mru_alloc">mru_alloc</a> += <a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>;</td></tr>
<tr><th id="190">190</th><td>		<b>for</b> (<a class="local col6 ref" href="#6chunk" title='chunk' data-ref="6chunk" data-ref-filename="6chunk">chunk</a> += <a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>; <a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>; <a class="local col7 ref" href="#7entries" title='entries' data-ref="7entries" data-ref-filename="7entries">entries</a>--)</td></tr>
<tr><th id="191">191</th><td>			<a class="tu ref fn" href="#mon_free_entry" title='mon_free_entry' data-use='c' data-ref="mon_free_entry" data-ref-filename="mon_free_entry">mon_free_entry</a>(--<a class="local col6 ref" href="#6chunk" title='chunk' data-ref="6chunk" data-ref-filename="6chunk">chunk</a>);</td></tr>
<tr><th id="192">192</th><td></td></tr>
<tr><th id="193">193</th><td>		<a class="tu ref" href="#mon_mem_increments" title='mon_mem_increments' data-use='w' data-ref="mon_mem_increments" data-ref-filename="mon_mem_increments">mon_mem_increments</a>++;</td></tr>
<tr><th id="194">194</th><td>	}</td></tr>
<tr><th id="195">195</th><td>}</td></tr>
<tr><th id="196">196</th><td></td></tr>
<tr><th id="197">197</th><td></td></tr>
<tr><th id="198">198</th><td><i>/*</i></td></tr>
<tr><th id="199">199</th><td><i> * mon_start - start up the monitoring software</i></td></tr>
<tr><th id="200">200</th><td><i> */</i></td></tr>
<tr><th id="201">201</th><td><em>void</em></td></tr>
<tr><th id="202">202</th><td><dfn class="decl def fn" id="mon_start" title='mon_start' data-ref="mon_start" data-ref-filename="mon_start">mon_start</dfn>(</td></tr>
<tr><th id="203">203</th><td>	<em>int</em> <dfn class="local col8 decl" id="8mode" title='mode' data-type='int' data-ref="8mode" data-ref-filename="8mode">mode</dfn></td></tr>
<tr><th id="204">204</th><td>	)</td></tr>
<tr><th id="205">205</th><td>{</td></tr>
<tr><th id="206">206</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col9 decl" id="9octets" title='octets' data-type='size_t' data-ref="9octets" data-ref-filename="9octets">octets</dfn>;</td></tr>
<tr><th id="207">207</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="local col0 decl" id="10min_hash_slots" title='min_hash_slots' data-type='u_int' data-ref="10min_hash_slots" data-ref-filename="10min_hash_slots">min_hash_slots</dfn>;</td></tr>
<tr><th id="208">208</th><td></td></tr>
<tr><th id="209">209</th><td>	<b>if</b> (<a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a> == <a class="local col8 ref" href="#8mode" title='mode' data-ref="8mode" data-ref-filename="8mode">mode</a>)		<i>/* MON_OFF is 0 */</i></td></tr>
<tr><th id="210">210</th><td>		<b>return</b>;</td></tr>
<tr><th id="211">211</th><td>	<b>if</b> (<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a>) {</td></tr>
<tr><th id="212">212</th><td>		<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> |= <a class="local col8 ref" href="#8mode" title='mode' data-ref="8mode" data-ref-filename="8mode">mode</a>;</td></tr>
<tr><th id="213">213</th><td>		<b>return</b>;</td></tr>
<tr><th id="214">214</th><td>	}</td></tr>
<tr><th id="215">215</th><td>	<b>if</b> (<var>0</var> == <a class="tu ref" href="#mon_mem_increments" title='mon_mem_increments' data-use='r' data-ref="mon_mem_increments" data-ref-filename="mon_mem_increments">mon_mem_increments</a>)</td></tr>
<tr><th id="216">216</th><td>		<a class="tu ref fn" href="#mon_getmoremem" title='mon_getmoremem' data-use='c' data-ref="mon_getmoremem" data-ref-filename="mon_getmoremem">mon_getmoremem</a>();</td></tr>
<tr><th id="217">217</th><td>	<i>/*</i></td></tr>
<tr><th id="218">218</th><td><i>	 * Select the MRU hash table size to limit the average count</i></td></tr>
<tr><th id="219">219</th><td><i>	 * per bucket at capacity (mru_maxdepth) to 8, if possible</i></td></tr>
<tr><th id="220">220</th><td><i>	 * given our hash is limited to 16 bits.</i></td></tr>
<tr><th id="221">221</th><td><i>	 */</i></td></tr>
<tr><th id="222">222</th><td>	<a class="local col0 ref" href="#10min_hash_slots" title='min_hash_slots' data-ref="10min_hash_slots" data-ref-filename="10min_hash_slots">min_hash_slots</a> = (<a class="ref" href="../include/ntpd.h.html#mru_maxdepth" title='mru_maxdepth' data-ref="mru_maxdepth" data-ref-filename="mru_maxdepth">mru_maxdepth</a> / <var>8</var>) + <var>1</var>;</td></tr>
<tr><th id="223">223</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a> = <var>0</var>;</td></tr>
<tr><th id="224">224</th><td>	<b>while</b> (<a class="local col0 ref" href="#10min_hash_slots" title='min_hash_slots' data-ref="10min_hash_slots" data-ref-filename="10min_hash_slots">min_hash_slots</a> &gt;&gt;= <var>1</var>)</td></tr>
<tr><th id="225">225</th><td>		<a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a>++;</td></tr>
<tr><th id="226">226</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a> = <a class="macro" href="../include/ntp.h.html#703" title="(((4) &gt; (mon_hash_bits)) ? (4) : (mon_hash_bits))" data-ref="_M/max">max</a>(<var>4</var>, <a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a>);</td></tr>
<tr><th id="227">227</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a> = <a class="macro" href="../include/ntp.h.html#702" title="(((16) &lt; (mon_hash_bits)) ? (16) : (mon_hash_bits))" data-ref="_M/min">min</a>(<var>16</var>, <a class="ref" href="../include/ntpd.h.html#mon_hash_bits" title='mon_hash_bits' data-ref="mon_hash_bits" data-ref-filename="mon_hash_bits">mon_hash_bits</a>);</td></tr>
<tr><th id="228">228</th><td>	<a class="local col9 ref" href="#9octets" title='octets' data-ref="9octets" data-ref-filename="9octets">octets</a> = <b>sizeof</b>(*<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>) * <a class="macro" href="../include/ntpd.h.html#161" title="((size_t)1U &lt;&lt; mon_hash_bits)" data-ref="_M/MON_HASH_SIZE">MON_HASH_SIZE</a>;</td></tr>
<tr><th id="229">229</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a> = <a class="macro" href="../include/ntp_stdlib.h.html#117" title="ereallocz((mon_hash), (octets), (0), 1)" data-ref="_M/erealloc_zero">erealloc_zero</a>(<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>, <a class="local col9 ref" href="#9octets" title='octets' data-ref="9octets" data-ref-filename="9octets">octets</a>, <var>0</var>);</td></tr>
<tr><th id="230">230</th><td></td></tr>
<tr><th id="231">231</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> = <a class="local col8 ref" href="#8mode" title='mode' data-ref="8mode" data-ref-filename="8mode">mode</a>;</td></tr>
<tr><th id="232">232</th><td>}</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td><i>/*</i></td></tr>
<tr><th id="236">236</th><td><i> * mon_stop - stop the monitoring software</i></td></tr>
<tr><th id="237">237</th><td><i> */</i></td></tr>
<tr><th id="238">238</th><td><em>void</em></td></tr>
<tr><th id="239">239</th><td><dfn class="decl def fn" id="mon_stop" title='mon_stop' data-ref="mon_stop" data-ref-filename="mon_stop">mon_stop</dfn>(</td></tr>
<tr><th id="240">240</th><td>	<em>int</em> <dfn class="local col1 decl" id="11mode" title='mode' data-type='int' data-ref="11mode" data-ref-filename="11mode">mode</dfn></td></tr>
<tr><th id="241">241</th><td>	)</td></tr>
<tr><th id="242">242</th><td>{</td></tr>
<tr><th id="243">243</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col2 decl" id="12mon" title='mon' data-type='mon_entry *' data-ref="12mon" data-ref-filename="12mon">mon</dfn>;</td></tr>
<tr><th id="244">244</th><td></td></tr>
<tr><th id="245">245</th><td>	<b>if</b> (<a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a> == <a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a>)</td></tr>
<tr><th id="246">246</th><td>		<b>return</b>;</td></tr>
<tr><th id="247">247</th><td>	<b>if</b> ((<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> &amp; <a class="local col1 ref" href="#11mode" title='mode' data-ref="11mode" data-ref-filename="11mode">mode</a>) == <var>0</var> || <a class="local col1 ref" href="#11mode" title='mode' data-ref="11mode" data-ref-filename="11mode">mode</a> == <a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a>)</td></tr>
<tr><th id="248">248</th><td>		<b>return</b>;</td></tr>
<tr><th id="249">249</th><td></td></tr>
<tr><th id="250">250</th><td>	<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> &amp;= ~<a class="local col1 ref" href="#11mode" title='mode' data-ref="11mode" data-ref-filename="11mode">mode</a>;</td></tr>
<tr><th id="251">251</th><td>	<b>if</b> (<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> != <a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a>)</td></tr>
<tr><th id="252">252</th><td>		<b>return</b>;</td></tr>
<tr><th id="253">253</th><td>	</td></tr>
<tr><th id="254">254</th><td>	<i>/*</i></td></tr>
<tr><th id="255">255</th><td><i>	 * Move everything on the MRU list to the free list quickly,</i></td></tr>
<tr><th id="256">256</th><td><i>	 * without bothering to remove each from either the MRU list or</i></td></tr>
<tr><th id="257">257</th><td><i>	 * the hash table.</i></td></tr>
<tr><th id="258">258</th><td><i>	 */</i></td></tr>
<tr><th id="259">259</th><td>	<a class="macro" href="../include/ntp_lists.h.html#421" title="{ mon_entry *i_dl_nextiter; for ((mon) = (mon_mru_list).mru.f; (mon) != &amp;(mon_mru_list) &amp;&amp; ((i_dl_nextiter = (mon)-&gt;mru.f), 1); (mon) = i_dl_nextiter) {" data-ref="_M/ITER_DLIST_BEGIN">ITER_DLIST_BEGIN</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="local col2 ref" href="#12mon" title='mon' data-ref="12mon" data-ref-filename="12mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>, <a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>)</td></tr>
<tr><th id="260">260</th><td>		<a class="tu ref fn" href="#mon_free_entry" title='mon_free_entry' data-use='c' data-ref="mon_free_entry" data-ref-filename="mon_free_entry">mon_free_entry</a>(<a class="local col2 ref" href="#12mon" title='mon' data-ref="12mon" data-ref-filename="12mon">mon</a>);</td></tr>
<tr><th id="261">261</th><td>	<a class="macro" href="../include/ntp_lists.h.html#429" title="} }" data-ref="_M/ITER_DLIST_END">ITER_DLIST_END</a>()</td></tr>
<tr><th id="262">262</th><td></td></tr>
<tr><th id="263">263</th><td>	<i>/* empty the MRU list and hash table. */</i></td></tr>
<tr><th id="264">264</th><td>	<a class="ref" href="../include/ntpd.h.html#mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</a> = <var>0</var>;</td></tr>
<tr><th id="265">265</th><td>	<a class="macro" href="../include/ntp_lists.h.html#363" title="do { (mon_mru_list).mru.f = &amp;(mon_mru_list); (mon_mru_list).mru.b = &amp;(mon_mru_list); } while (0)" data-ref="_M/INIT_DLIST">INIT_DLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="266">266</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#55" title="bzero(mon_hash, sizeof(*mon_hash) * ((size_t)1U &lt;&lt; mon_hash_bits))" data-ref="_M/zero_mem">zero_mem</a>(<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>, <b>sizeof</b>(*<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>) * <a class="macro" href="../include/ntpd.h.html#161" title="((size_t)1U &lt;&lt; mon_hash_bits)" data-ref="_M/MON_HASH_SIZE">MON_HASH_SIZE</a>);</td></tr>
<tr><th id="267">267</th><td>}</td></tr>
<tr><th id="268">268</th><td></td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td><i>/*</i></td></tr>
<tr><th id="271">271</th><td><i> * mon_clearinterface -- remove mru entries referring to a local address</i></td></tr>
<tr><th id="272">272</th><td><i> *			 which is going away.</i></td></tr>
<tr><th id="273">273</th><td><i> */</i></td></tr>
<tr><th id="274">274</th><td><em>void</em></td></tr>
<tr><th id="275">275</th><td><dfn class="decl def fn" id="mon_clearinterface" title='mon_clearinterface' data-ref="mon_clearinterface" data-ref-filename="mon_clearinterface">mon_clearinterface</dfn>(</td></tr>
<tr><th id="276">276</th><td>	<a class="typedef" href="../include/ntp.h.html#endpt" title='endpt' data-type='struct interface' data-ref="endpt" data-ref-filename="endpt">endpt</a> *<dfn class="local col3 decl" id="13lcladr" title='lcladr' data-type='endpt *' data-ref="13lcladr" data-ref-filename="13lcladr">lcladr</dfn></td></tr>
<tr><th id="277">277</th><td>	)</td></tr>
<tr><th id="278">278</th><td>{</td></tr>
<tr><th id="279">279</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *<dfn class="local col4 decl" id="14mon" title='mon' data-type='mon_entry *' data-ref="14mon" data-ref-filename="14mon">mon</dfn>;</td></tr>
<tr><th id="280">280</th><td></td></tr>
<tr><th id="281">281</th><td>	<i>/* iterate mon over mon_mru_list */</i></td></tr>
<tr><th id="282">282</th><td>	<a class="macro" href="../include/ntp_lists.h.html#421" title="{ mon_entry *i_dl_nextiter; for ((mon) = (mon_mru_list).mru.f; (mon) != &amp;(mon_mru_list) &amp;&amp; ((i_dl_nextiter = (mon)-&gt;mru.f), 1); (mon) = i_dl_nextiter) {" data-ref="_M/ITER_DLIST_BEGIN">ITER_DLIST_BEGIN</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="local col4 ref" href="#14mon" title='mon' data-ref="14mon" data-ref-filename="14mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>, <a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a>)</td></tr>
<tr><th id="283">283</th><td>		<b>if</b> (<a class="local col4 ref" href="#14mon" title='mon' data-ref="14mon" data-ref-filename="14mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::lcladr" title='mon_data::lcladr' data-ref="mon_data::lcladr" data-ref-filename="mon_data..lcladr">lcladr</a> == <a class="local col3 ref" href="#13lcladr" title='lcladr' data-ref="13lcladr" data-ref-filename="13lcladr">lcladr</a>) {</td></tr>
<tr><th id="284">284</th><td>			<i>/* remove from mru list */</i></td></tr>
<tr><th id="285">285</th><td>			<a class="macro" href="../include/ntp_lists.h.html#413" title="do { (mon)-&gt;mru.b-&gt;mru.f = (mon)-&gt;mru.f; (mon)-&gt;mru.f-&gt;mru.b = (mon)-&gt;mru.b; ((mon)-&gt;mru.b) = ((void*)0); ((mon)-&gt;mru.f) = ((void*)0); } while (0)" data-ref="_M/UNLINK_DLIST">UNLINK_DLIST</a>(<a class="local col4 ref" href="#14mon" title='mon' data-ref="14mon" data-ref-filename="14mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="286">286</th><td>			<i>/* remove from hash list, adjust mru_entries */</i></td></tr>
<tr><th id="287">287</th><td>			<a class="tu ref fn" href="#remove_from_hash" title='remove_from_hash' data-use='c' data-ref="remove_from_hash" data-ref-filename="remove_from_hash">remove_from_hash</a>(<a class="local col4 ref" href="#14mon" title='mon' data-ref="14mon" data-ref-filename="14mon">mon</a>);</td></tr>
<tr><th id="288">288</th><td>			<i>/* put on free list */</i></td></tr>
<tr><th id="289">289</th><td>			<a class="tu ref fn" href="#mon_free_entry" title='mon_free_entry' data-use='c' data-ref="mon_free_entry" data-ref-filename="mon_free_entry">mon_free_entry</a>(<a class="local col4 ref" href="#14mon" title='mon' data-ref="14mon" data-ref-filename="14mon">mon</a>);</td></tr>
<tr><th id="290">290</th><td>		}</td></tr>
<tr><th id="291">291</th><td>	<a class="macro" href="../include/ntp_lists.h.html#429" title="} }" data-ref="_M/ITER_DLIST_END">ITER_DLIST_END</a>()</td></tr>
<tr><th id="292">292</th><td>}</td></tr>
<tr><th id="293">293</th><td></td></tr>
<tr><th id="294">294</th><td></td></tr>
<tr><th id="295">295</th><td><i>/*</i></td></tr>
<tr><th id="296">296</th><td><i> * ntp_monitor - record stats about this packet</i></td></tr>
<tr><th id="297">297</th><td><i> *</i></td></tr>
<tr><th id="298">298</th><td><i> * Returns supplied restriction flags, with RES_LIMITED and RES_KOD</i></td></tr>
<tr><th id="299">299</th><td><i> * cleared unless the packet should not be responded to normally</i></td></tr>
<tr><th id="300">300</th><td><i> * (RES_LIMITED) and possibly should trigger a KoD response (RES_KOD).</i></td></tr>
<tr><th id="301">301</th><td><i> * The returned flags are saved in the MRU entry, so that it reflects</i></td></tr>
<tr><th id="302">302</th><td><i> * whether the last packet from that source triggered rate limiting,</i></td></tr>
<tr><th id="303">303</th><td><i> * and if so, possible KoD response.  This implies you can not tell</i></td></tr>
<tr><th id="304">304</th><td><i> * whether a given address is eligible for rate limiting/KoD from the</i></td></tr>
<tr><th id="305">305</th><td><i> * monlist restrict bits, only whether or not the last packet triggered</i></td></tr>
<tr><th id="306">306</th><td><i> * such responses.  ntpdc -c reslist lets you see whether RES_LIMITED</i></td></tr>
<tr><th id="307">307</th><td><i> * or RES_KOD is lit for a particular address before ntp_monitor()'s</i></td></tr>
<tr><th id="308">308</th><td><i> * typical dousing.</i></td></tr>
<tr><th id="309">309</th><td><i> */</i></td></tr>
<tr><th id="310">310</th><td><a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a></td></tr>
<tr><th id="311">311</th><td><dfn class="decl def fn" id="ntp_monitor" title='ntp_monitor' data-ref="ntp_monitor" data-ref-filename="ntp_monitor">ntp_monitor</dfn>(</td></tr>
<tr><th id="312">312</th><td>	<b>struct</b> <a class="type" href="../include/recvbuff.h.html#recvbuf" title='recvbuf' data-ref="recvbuf" data-ref-filename="recvbuf">recvbuf</a> *<dfn class="local col5 decl" id="15rbufp" title='rbufp' data-type='struct recvbuf *' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</dfn>,</td></tr>
<tr><th id="313">313</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>	<dfn class="local col6 decl" id="16flags" title='flags' data-type='u_short' data-ref="16flags" data-ref-filename="16flags">flags</dfn></td></tr>
<tr><th id="314">314</th><td>	)</td></tr>
<tr><th id="315">315</th><td>{</td></tr>
<tr><th id="316">316</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>		<dfn class="local col7 decl" id="17interval_fp" title='interval_fp' data-type='l_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</dfn>;</td></tr>
<tr><th id="317">317</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#pkt" title='pkt' data-ref="pkt" data-ref-filename="pkt">pkt</a> *	<dfn class="local col8 decl" id="18pkt" title='pkt' data-type='struct pkt *' data-ref="18pkt" data-ref-filename="18pkt">pkt</dfn>;</td></tr>
<tr><th id="318">318</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *	<dfn class="local col9 decl" id="19mon" title='mon' data-type='mon_entry *' data-ref="19mon" data-ref-filename="19mon">mon</dfn>;</td></tr>
<tr><th id="319">319</th><td>	<a class="typedef" href="../include/ntp.h.html#mon_entry" title='mon_entry' data-type='struct mon_data' data-ref="mon_entry" data-ref-filename="mon_entry">mon_entry</a> *	<dfn class="local col0 decl" id="20oldest" title='oldest' data-type='mon_entry *' data-ref="20oldest" data-ref-filename="20oldest">oldest</dfn>;</td></tr>
<tr><th id="320">320</th><td>	<em>int</em>		<dfn class="local col1 decl" id="21oldest_age" title='oldest_age' data-type='int' data-ref="21oldest_age" data-ref-filename="21oldest_age">oldest_age</dfn>;</td></tr>
<tr><th id="321">321</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>		<dfn class="local col2 decl" id="22hash" title='hash' data-type='u_int' data-ref="22hash" data-ref-filename="22hash">hash</dfn>;</td></tr>
<tr><th id="322">322</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>		<dfn class="local col3 decl" id="23restrict_mask" title='restrict_mask' data-type='u_short' data-ref="23restrict_mask" data-ref-filename="23restrict_mask">restrict_mask</dfn>;</td></tr>
<tr><th id="323">323</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>		<dfn class="local col4 decl" id="24mode" title='mode' data-type='u_char' data-ref="24mode" data-ref-filename="24mode">mode</dfn>;</td></tr>
<tr><th id="324">324</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>		<dfn class="local col5 decl" id="25version" title='version' data-type='u_char' data-ref="25version" data-ref-filename="25version">version</dfn>;</td></tr>
<tr><th id="325">325</th><td>	<em>int</em>		<dfn class="local col6 decl" id="26interval" title='interval' data-type='int' data-ref="26interval" data-ref-filename="26interval">interval</dfn>;</td></tr>
<tr><th id="326">326</th><td>	<em>int</em>		<dfn class="local col7 decl" id="27head" title='head' data-type='int' data-ref="27head" data-ref-filename="27head">head</dfn>;		<i>/* headway increment */</i></td></tr>
<tr><th id="327">327</th><td>	<em>int</em>		<dfn class="local col8 decl" id="28leak" title='leak' data-type='int' data-ref="28leak" data-ref-filename="28leak">leak</dfn>;		<i>/* new headway */</i></td></tr>
<tr><th id="328">328</th><td>	<em>int</em>		<dfn class="local col9 decl" id="29limit" title='limit' data-type='int' data-ref="29limit" data-ref-filename="29limit">limit</dfn>;		<i>/* average threshold */</i></td></tr>
<tr><th id="329">329</th><td></td></tr>
<tr><th id="330">330</th><td>	<a class="macro" href="../include/ntp_assert.h.html#84" title="((void) ((rbufp != ((void*)0)) || ((isc_assertion_failed)(&quot;/___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/ntp_monitor.c&quot;, 330, isc_assertiontype_require, &quot;rbufp != ((void*)0)&quot;), 0)))" data-ref="_M/REQUIRE">REQUIRE</a>(<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="331">331</th><td></td></tr>
<tr><th id="332">332</th><td>	<b>if</b> (<a class="ref" href="../include/ntpd.h.html#mon_enabled" title='mon_enabled' data-ref="mon_enabled" data-ref-filename="mon_enabled">mon_enabled</a> == <a class="macro" href="../include/ntp.h.html#823" title="0x00" data-ref="_M/MON_OFF">MON_OFF</a>)</td></tr>
<tr><th id="333">333</th><td>		<b>return</b> ~(<a class="macro" href="../include/ntp.h.html#876" title="0x0040" data-ref="_M/RES_LIMITED">RES_LIMITED</a> | <a class="macro" href="../include/ntp.h.html#886" title="0x0800" data-ref="_M/RES_KOD">RES_KOD</a>) &amp; <a class="local col6 ref" href="#16flags" title='flags' data-ref="16flags" data-ref-filename="16flags">flags</a>;</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td>	<a class="local col8 ref" href="#18pkt" title='pkt' data-ref="18pkt" data-ref-filename="18pkt">pkt</a> = &amp;<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#77" title="recv_space.X_recv_pkt" data-ref="_M/recv_pkt">recv_pkt</a>;</td></tr>
<tr><th id="336">336</th><td>	<a class="local col2 ref" href="#22hash" title='hash' data-ref="22hash" data-ref-filename="22hash">hash</a> = <a class="macro" href="../include/ntpd.h.html#163" title="(sock_hash(&amp;rbufp-&gt;X_from_where.X_recv_srcadr) &amp; (((size_t)1U &lt;&lt; mon_hash_bits) - 1))" data-ref="_M/MON_HASH">MON_HASH</a>(&amp;<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#59" title="X_from_where.X_recv_srcadr" data-ref="_M/recv_srcadr">recv_srcadr</a>);</td></tr>
<tr><th id="337">337</th><td>	<a class="local col4 ref" href="#24mode" title='mode' data-ref="24mode" data-ref-filename="24mode">mode</a> = <a class="macro" href="../include/ntp.h.html#593" title="((u_char)((pkt-&gt;li_vn_mode) &amp; 0x7))" data-ref="_M/PKT_MODE">PKT_MODE</a>(<a class="local col8 ref" href="#18pkt" title='pkt' data-ref="18pkt" data-ref-filename="18pkt">pkt</a>-&gt;<a class="ref field" href="../include/ntp.h.html#pkt::li_vn_mode" title='pkt::li_vn_mode' data-ref="pkt::li_vn_mode" data-ref-filename="pkt..li_vn_mode">li_vn_mode</a>);</td></tr>
<tr><th id="338">338</th><td>	<a class="local col5 ref" href="#25version" title='version' data-ref="25version" data-ref-filename="25version">version</a> = <a class="macro" href="../include/ntp.h.html#594" title="((u_char)(((pkt-&gt;li_vn_mode) &gt;&gt; 3) &amp; 0x7))" data-ref="_M/PKT_VERSION">PKT_VERSION</a>(<a class="local col8 ref" href="#18pkt" title='pkt' data-ref="18pkt" data-ref-filename="18pkt">pkt</a>-&gt;<a class="ref field" href="../include/ntp.h.html#pkt::li_vn_mode" title='pkt::li_vn_mode' data-ref="pkt::li_vn_mode" data-ref-filename="pkt..li_vn_mode">li_vn_mode</a>);</td></tr>
<tr><th id="339">339</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> = <a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>[<a class="local col2 ref" href="#22hash" title='hash' data-ref="22hash" data-ref-filename="22hash">hash</a>];</td></tr>
<tr><th id="340">340</th><td></td></tr>
<tr><th id="341">341</th><td>	<i>/*</i></td></tr>
<tr><th id="342">342</th><td><i>	 * We keep track of all traffic for a given IP in one entry,</i></td></tr>
<tr><th id="343">343</th><td><i>	 * otherwise cron'ed ntpdate or similar evades RES_LIMITED.</i></td></tr>
<tr><th id="344">344</th><td><i>	 */</i></td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td>	<b>for</b> (; <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>; <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> = <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>)</td></tr>
<tr><th id="347">347</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_net.h.html#176" title="((((&amp;mon-&gt;rmtadr)-&gt;sa.sa_family) != ((&amp;rbufp-&gt;X_from_where.X_recv_srcadr)-&gt;sa.sa_family)) ? 0 : (2 == ((&amp;mon-&gt;rmtadr)-&gt;sa.sa_family)) ? ((((&amp;mon-&gt;rmtadr)-&gt;sa4.sin_addr).s_addr) == (((&amp;rbufp-&gt;X_from_where.X_recv_srcadr)-&gt;sa4.sin_addr).s_addr)) : ((!memcmp((&amp;((&amp;mon-&gt;rmtadr))-&gt;sa6.sin6_addr)-&gt;__u6_addr.__u6_addr8, ((&amp;((&amp;rbufp-&gt;X_from_where.X_recv_srcadr)-&gt;sa6.sin6_addr)))-&gt;__u6_addr.__u6_addr8, sizeof(&amp;((&amp;mon-&gt;rmtadr))-&gt;sa6.sin6_addr)-&gt;__u6_addr.__u6_addr8)) &amp;&amp; ((((&amp;mon-&gt;rmtadr))-&gt;sa6.sin6_scope_id) == (((&amp;rbufp-&gt;X_from_where.X_recv_srcadr))-&gt;sa6.sin6_scope_id))))" data-ref="_M/SOCK_EQ">SOCK_EQ</a>(&amp;<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::rmtadr" title='mon_data::rmtadr' data-ref="mon_data::rmtadr" data-ref-filename="mon_data..rmtadr">rmtadr</a>, &amp;<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#59" title="X_from_where.X_recv_srcadr" data-ref="_M/recv_srcadr">recv_srcadr</a>))</td></tr>
<tr><th id="348">348</th><td>			<b>break</b>;</td></tr>
<tr><th id="349">349</th><td></td></tr>
<tr><th id="350">350</th><td>	<b>if</b> (<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="351">351</th><td>		<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a> = <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::recv_time" title='recvbuf::recv_time' data-ref="recvbuf::recv_time" data-ref-filename="recvbuf..recv_time">recv_time</a>;</td></tr>
<tr><th id="352">352</th><td>		<a class="macro" href="../include/ntp_fp.h.html#231" title="do { u_int32 sub_t = ((&amp;interval_fp)-&gt;l_uf); ((&amp;interval_fp)-&gt;l_uf) -= ((&amp;mon-&gt;last)-&gt;l_uf); ((&amp;interval_fp)-&gt;Ul_i.Xl_ui) -= ((&amp;mon-&gt;last)-&gt;Ul_i.Xl_ui) + ((u_int32)((&amp;interval_fp)-&gt;l_uf) &gt; sub_t); } while (0)" data-ref="_M/L_SUB">L_SUB</a>(&amp;<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>, &amp;<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::last" title='mon_data::last' data-ref="mon_data::last" data-ref-filename="mon_data..last">last</a>);</td></tr>
<tr><th id="353">353</th><td>		<i>/* add one-half second to round up */</i></td></tr>
<tr><th id="354">354</th><td>		<a class="macro" href="../include/ntp_fp.h.html#233" title="do { u_int32 add_t = (((&amp;interval_fp)-&gt;l_uf)); (((&amp;interval_fp)-&gt;l_uf)) += (((0x80000000))); (((&amp;interval_fp)-&gt;Ul_i.Xl_ui)) += (0) + ((u_int32)(((&amp;interval_fp)-&gt;l_uf)) &lt; add_t); } while (0)" data-ref="_M/L_ADDUF">L_ADDUF</a>(&amp;<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>, <var>0x80000000</var>);</td></tr>
<tr><th id="355">355</th><td>		<a class="local col6 ref" href="#26interval" title='interval' data-ref="26interval" data-ref-filename="26interval">interval</a> = <a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>.<a class="macro" href="../include/ntp_fp.h.html#41" title="Ul_i.Xl_i" data-ref="_M/l_i">l_i</a>;</td></tr>
<tr><th id="356">356</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::last" title='mon_data::last' data-ref="mon_data::last" data-ref-filename="mon_data..last">last</a> = <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::recv_time" title='recvbuf::recv_time' data-ref="recvbuf::recv_time" data-ref-filename="recvbuf..recv_time">recv_time</a>;</td></tr>
<tr><th id="357">357</th><td>		<a class="macro" href="../include/ntp_net.h.html#70" title="((&amp;mon-&gt;rmtadr)-&gt;sa4.sin_port)" data-ref="_M/NSRCPORT">NSRCPORT</a>(&amp;<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::rmtadr" title='mon_data::rmtadr' data-ref="mon_data::rmtadr" data-ref-filename="mon_data..rmtadr">rmtadr</a>) = <a class="macro" href="../include/ntp_net.h.html#70" title="((&amp;rbufp-&gt;X_from_where.X_recv_srcadr)-&gt;sa4.sin_port)" data-ref="_M/NSRCPORT">NSRCPORT</a>(&amp;<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#59" title="X_from_where.X_recv_srcadr" data-ref="_M/recv_srcadr">recv_srcadr</a>);</td></tr>
<tr><th id="358">358</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::count" title='mon_data::count' data-ref="mon_data::count" data-ref-filename="mon_data..count">count</a>++;</td></tr>
<tr><th id="359">359</th><td>		<a class="local col3 ref" href="#23restrict_mask" title='restrict_mask' data-ref="23restrict_mask" data-ref-filename="23restrict_mask">restrict_mask</a> = <a class="local col6 ref" href="#16flags" title='flags' data-ref="16flags" data-ref-filename="16flags">flags</a>;</td></tr>
<tr><th id="360">360</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::vn_mode" title='mon_data::vn_mode' data-ref="mon_data::vn_mode" data-ref-filename="mon_data..vn_mode">vn_mode</a> = <a class="macro" href="../include/ntp.h.html#601" title="((((version) &amp; 7) &lt;&lt; 3) | ((mode) &amp; 0x7))" data-ref="_M/VN_MODE">VN_MODE</a>(<a class="local col5 ref" href="#25version" title='version' data-ref="25version" data-ref-filename="25version">version</a>, <a class="local col4 ref" href="#24mode" title='mode' data-ref="24mode" data-ref-filename="24mode">mode</a>);</td></tr>
<tr><th id="361">361</th><td></td></tr>
<tr><th id="362">362</th><td>		<i>/* Shuffle to the head of the MRU list. */</i></td></tr>
<tr><th id="363">363</th><td>		<a class="macro" href="../include/ntp_lists.h.html#413" title="do { (mon)-&gt;mru.b-&gt;mru.f = (mon)-&gt;mru.f; (mon)-&gt;mru.f-&gt;mru.b = (mon)-&gt;mru.b; ((mon)-&gt;mru.b) = ((void*)0); ((mon)-&gt;mru.f) = ((void*)0); } while (0)" data-ref="_M/UNLINK_DLIST">UNLINK_DLIST</a>(<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="364">364</th><td>		<a class="macro" href="../include/ntp_lists.h.html#397" title="do { (mon)-&gt;mru.f = (mon_mru_list).mru.f; (mon)-&gt;mru.b = &amp;(mon_mru_list); (mon_mru_list).mru.f-&gt;mru.b = (mon); (mon_mru_list).mru.f = (mon); } while (0)" data-ref="_M/LINK_DLIST">LINK_DLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="365">365</th><td></td></tr>
<tr><th id="366">366</th><td>		<i>/*</i></td></tr>
<tr><th id="367">367</th><td><i>		 * At this point the most recent arrival is first in the</i></td></tr>
<tr><th id="368">368</th><td><i>		 * MRU list.  Decrease the counter by the headway, but</i></td></tr>
<tr><th id="369">369</th><td><i>		 * not less than zero.</i></td></tr>
<tr><th id="370">370</th><td><i>		 */</i></td></tr>
<tr><th id="371">371</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> -= <a class="local col6 ref" href="#26interval" title='interval' data-ref="26interval" data-ref-filename="26interval">interval</a>;</td></tr>
<tr><th id="372">372</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> = <a class="macro" href="../include/ntp.h.html#703" title="(((0) &gt; (mon-&gt;leak)) ? (0) : (mon-&gt;leak))" data-ref="_M/max">max</a>(<var>0</var>, <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a>);</td></tr>
<tr><th id="373">373</th><td>		<a class="local col7 ref" href="#27head" title='head' data-ref="27head" data-ref-filename="27head">head</a> = <var>1</var> &lt;&lt; <a class="ref" href="../include/ntpd.h.html#ntp_minpoll" title='ntp_minpoll' data-ref="ntp_minpoll" data-ref-filename="ntp_minpoll">ntp_minpoll</a>;</td></tr>
<tr><th id="374">374</th><td>		<a class="local col8 ref" href="#28leak" title='leak' data-ref="28leak" data-ref-filename="28leak">leak</a> = <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> + <a class="local col7 ref" href="#27head" title='head' data-ref="27head" data-ref-filename="27head">head</a>;</td></tr>
<tr><th id="375">375</th><td>		<a class="local col9 ref" href="#29limit" title='limit' data-ref="29limit" data-ref-filename="29limit">limit</a> = <a class="macro" href="../include/ntp.h.html#117" title="8" data-ref="_M/NTP_SHIFT">NTP_SHIFT</a> * <a class="local col7 ref" href="#27head" title='head' data-ref="27head" data-ref-filename="27head">head</a>;</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (2)) mprintf (&quot;MRU: interval %d headway %d limit %d\n&quot;, interval, leak, limit); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>2</var>, (<q>"MRU: interval %d headway %d limit %d\n"</q>,</td></tr>
<tr><th id="378">378</th><td>			    <a class="local col6 ref" href="#26interval" title='interval' data-ref="26interval" data-ref-filename="26interval">interval</a>, <a class="local col8 ref" href="#28leak" title='leak' data-ref="28leak" data-ref-filename="28leak">leak</a>, <a class="local col9 ref" href="#29limit" title='limit' data-ref="29limit" data-ref-filename="29limit">limit</a>));</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td>		<i>/*</i></td></tr>
<tr><th id="381">381</th><td><i>		 * If the minimum and average thresholds are not</i></td></tr>
<tr><th id="382">382</th><td><i>		 * exceeded, douse the RES_LIMITED and RES_KOD bits and</i></td></tr>
<tr><th id="383">383</th><td><i>		 * increase the counter by the headway increment.  Note</i></td></tr>
<tr><th id="384">384</th><td><i>		 * that we give a 1-s grace for the minimum threshold</i></td></tr>
<tr><th id="385">385</th><td><i>		 * and a 2-s grace for the headway increment.  If one or</i></td></tr>
<tr><th id="386">386</th><td><i>		 * both thresholds are exceeded and the old counter is</i></td></tr>
<tr><th id="387">387</th><td><i>		 * less than the average threshold, set the counter to</i></td></tr>
<tr><th id="388">388</th><td><i>		 * the average threshold plus the increment and leave</i></td></tr>
<tr><th id="389">389</th><td><i>		 * the RES_LIMITED and RES_KOD bits lit. Otherwise,</i></td></tr>
<tr><th id="390">390</th><td><i>		 * leave the counter alone and douse the RES_KOD bit.</i></td></tr>
<tr><th id="391">391</th><td><i>		 * This rate-limits the KoDs to no less than the average</i></td></tr>
<tr><th id="392">392</th><td><i>		 * headway.</i></td></tr>
<tr><th id="393">393</th><td><i>		 */</i></td></tr>
<tr><th id="394">394</th><td>		<b>if</b> (<a class="local col6 ref" href="#26interval" title='interval' data-ref="26interval" data-ref-filename="26interval">interval</a> + <var>1</var> &gt;= <a class="ref" href="../include/ntpd.h.html#ntp_minpkt" title='ntp_minpkt' data-ref="ntp_minpkt" data-ref-filename="ntp_minpkt">ntp_minpkt</a> &amp;&amp; <a class="local col8 ref" href="#28leak" title='leak' data-ref="28leak" data-ref-filename="28leak">leak</a> &lt; <a class="local col9 ref" href="#29limit" title='limit' data-ref="29limit" data-ref-filename="29limit">limit</a>) {</td></tr>
<tr><th id="395">395</th><td>			<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> = <a class="local col8 ref" href="#28leak" title='leak' data-ref="28leak" data-ref-filename="28leak">leak</a> - <var>2</var>;</td></tr>
<tr><th id="396">396</th><td>			<a class="local col3 ref" href="#23restrict_mask" title='restrict_mask' data-ref="23restrict_mask" data-ref-filename="23restrict_mask">restrict_mask</a> &amp;= ~(<a class="macro" href="../include/ntp.h.html#876" title="0x0040" data-ref="_M/RES_LIMITED">RES_LIMITED</a> | <a class="macro" href="../include/ntp.h.html#886" title="0x0800" data-ref="_M/RES_KOD">RES_KOD</a>);</td></tr>
<tr><th id="397">397</th><td>		} <b>else</b> <b>if</b> (<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> &lt; <a class="local col9 ref" href="#29limit" title='limit' data-ref="29limit" data-ref-filename="29limit">limit</a>)</td></tr>
<tr><th id="398">398</th><td>			<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> = <a class="local col9 ref" href="#29limit" title='limit' data-ref="29limit" data-ref-filename="29limit">limit</a> + <a class="local col7 ref" href="#27head" title='head' data-ref="27head" data-ref-filename="27head">head</a>;</td></tr>
<tr><th id="399">399</th><td>		<b>else</b></td></tr>
<tr><th id="400">400</th><td>			<a class="local col3 ref" href="#23restrict_mask" title='restrict_mask' data-ref="23restrict_mask" data-ref-filename="23restrict_mask">restrict_mask</a> &amp;= ~<a class="macro" href="../include/ntp.h.html#886" title="0x0800" data-ref="_M/RES_KOD">RES_KOD</a>;</td></tr>
<tr><th id="401">401</th><td></td></tr>
<tr><th id="402">402</th><td>		<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::flags" title='mon_data::flags' data-ref="mon_data::flags" data-ref-filename="mon_data..flags">flags</a> = <a class="local col3 ref" href="#23restrict_mask" title='restrict_mask' data-ref="23restrict_mask" data-ref-filename="23restrict_mask">restrict_mask</a>;</td></tr>
<tr><th id="403">403</th><td></td></tr>
<tr><th id="404">404</th><td>		<b>return</b> <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::flags" title='mon_data::flags' data-ref="mon_data::flags" data-ref-filename="mon_data..flags">flags</a>;</td></tr>
<tr><th id="405">405</th><td>	}</td></tr>
<tr><th id="406">406</th><td></td></tr>
<tr><th id="407">407</th><td>	<i>/*</i></td></tr>
<tr><th id="408">408</th><td><i>	 * If we got here, this is the first we've heard of this</i></td></tr>
<tr><th id="409">409</th><td><i>	 * guy.  Get him some memory, either from the free list</i></td></tr>
<tr><th id="410">410</th><td><i>	 * or from the tail of the MRU list.</i></td></tr>
<tr><th id="411">411</th><td><i>	 *</i></td></tr>
<tr><th id="412">412</th><td><i>	 * The following ntp.conf "mru" knobs come into play determining</i></td></tr>
<tr><th id="413">413</th><td><i>	 * the depth (or count) of the MRU list:</i></td></tr>
<tr><th id="414">414</th><td><i>	 * - mru_mindepth ("mru mindepth") is a floor beneath which</i></td></tr>
<tr><th id="415">415</th><td><i>	 *   entries are kept without regard to their age.  The</i></td></tr>
<tr><th id="416">416</th><td><i>	 *   default is 600 which matches the longtime implementation</i></td></tr>
<tr><th id="417">417</th><td><i>	 *   limit on the total number of entries.</i></td></tr>
<tr><th id="418">418</th><td><i>	 * - mru_maxage ("mru maxage") is a ceiling on the age in</i></td></tr>
<tr><th id="419">419</th><td><i>	 *   seconds of entries.  Entries older than this are</i></td></tr>
<tr><th id="420">420</th><td><i>	 *   reclaimed once mon_mindepth is exceeded.  64s default.</i></td></tr>
<tr><th id="421">421</th><td><i>	 *   Note that entries older than this can easily survive</i></td></tr>
<tr><th id="422">422</th><td><i>	 *   as they are reclaimed only as needed.</i></td></tr>
<tr><th id="423">423</th><td><i>	 * - mru_maxdepth ("mru maxdepth") is a hard limit on the</i></td></tr>
<tr><th id="424">424</th><td><i>	 *   number of entries.</i></td></tr>
<tr><th id="425">425</th><td><i>	 * - "mru maxmem" sets mru_maxdepth to the number of entries</i></td></tr>
<tr><th id="426">426</th><td><i>	 *   which fit in the given number of kilobytes.  The default is</i></td></tr>
<tr><th id="427">427</th><td><i>	 *   1024, or 1 megabyte.</i></td></tr>
<tr><th id="428">428</th><td><i>	 * - mru_initalloc ("mru initalloc" sets the count of the</i></td></tr>
<tr><th id="429">429</th><td><i>	 *   initial allocation of MRU entries.</i></td></tr>
<tr><th id="430">430</th><td><i>	 * - "mru initmem" sets mru_initalloc in units of kilobytes.</i></td></tr>
<tr><th id="431">431</th><td><i>	 *   The default is 4.</i></td></tr>
<tr><th id="432">432</th><td><i>	 * - mru_incalloc ("mru incalloc" sets the number of entries to</i></td></tr>
<tr><th id="433">433</th><td><i>	 *   allocate on-demand each time the free list is empty.</i></td></tr>
<tr><th id="434">434</th><td><i>	 * - "mru incmem" sets mru_incalloc in units of kilobytes.</i></td></tr>
<tr><th id="435">435</th><td><i>	 *   The default is 4.</i></td></tr>
<tr><th id="436">436</th><td><i>	 * Whichever of "mru maxmem" or "mru maxdepth" occurs last in</i></td></tr>
<tr><th id="437">437</th><td><i>	 * ntp.conf controls.  Similarly for "mru initalloc" and "mru</i></td></tr>
<tr><th id="438">438</th><td><i>	 * initmem", and for "mru incalloc" and "mru incmem".</i></td></tr>
<tr><th id="439">439</th><td><i>	 */</i></td></tr>
<tr><th id="440">440</th><td>	<b>if</b> (<a class="ref" href="../include/ntpd.h.html#mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</a> &lt; <a class="ref" href="../include/ntpd.h.html#mru_mindepth" title='mru_mindepth' data-ref="mru_mindepth" data-ref-filename="mru_mindepth">mru_mindepth</a>) {</td></tr>
<tr><th id="441">441</th><td>		<b>if</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> == <a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a>)</td></tr>
<tr><th id="442">442</th><td>			<a class="tu ref fn" href="#mon_getmoremem" title='mon_getmoremem' data-use='c' data-ref="mon_getmoremem" data-ref-filename="mon_getmoremem">mon_getmoremem</a>();</td></tr>
<tr><th id="443">443</th><td>		<a class="macro" href="../include/ntp_lists.h.html#172" title="do { (mon) = (mon_free); if (((void*)0) != (mon)) { (mon_free) = (mon)-&gt;hash_next; ((mon)-&gt;hash_next) = ((void*)0); } } while (0)" data-ref="_M/UNLINK_HEAD_SLIST">UNLINK_HEAD_SLIST</a>(<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free"><a class="tu ref" href="#mon_free" title='mon_free' data-use='w' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a></a>, <a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>);</td></tr>
<tr><th id="444">444</th><td>	} <b>else</b> {</td></tr>
<tr><th id="445">445</th><td>		<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a> = <a class="macro" href="../include/ntp_lists.h.html#376" title="( (&amp;(mon_mru_list) != (mon_mru_list).mru.b) ? (mon_mru_list).mru.b : ((void*)0) )" data-ref="_M/TAIL_DLIST">TAIL_DLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="446">446</th><td>		<a class="local col1 ref" href="#21oldest_age" title='oldest_age' data-ref="21oldest_age" data-ref-filename="21oldest_age">oldest_age</a> = <var>0</var>;		<i>/* silence uninit warning */</i></td></tr>
<tr><th id="447">447</th><td>		<b>if</b> (<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="448">448</th><td>			<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a> = <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::recv_time" title='recvbuf::recv_time' data-ref="recvbuf::recv_time" data-ref-filename="recvbuf..recv_time">recv_time</a>;</td></tr>
<tr><th id="449">449</th><td>			<a class="macro" href="../include/ntp_fp.h.html#231" title="do { u_int32 sub_t = ((&amp;interval_fp)-&gt;l_uf); ((&amp;interval_fp)-&gt;l_uf) -= ((&amp;oldest-&gt;last)-&gt;l_uf); ((&amp;interval_fp)-&gt;Ul_i.Xl_ui) -= ((&amp;oldest-&gt;last)-&gt;Ul_i.Xl_ui) + ((u_int32)((&amp;interval_fp)-&gt;l_uf) &gt; sub_t); } while (0)" data-ref="_M/L_SUB">L_SUB</a>(&amp;<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>, &amp;<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::last" title='mon_data::last' data-ref="mon_data::last" data-ref-filename="mon_data..last">last</a>);</td></tr>
<tr><th id="450">450</th><td>			<i>/* add one-half second to round up */</i></td></tr>
<tr><th id="451">451</th><td>			<a class="macro" href="../include/ntp_fp.h.html#233" title="do { u_int32 add_t = (((&amp;interval_fp)-&gt;l_uf)); (((&amp;interval_fp)-&gt;l_uf)) += (((0x80000000))); (((&amp;interval_fp)-&gt;Ul_i.Xl_ui)) += (0) + ((u_int32)(((&amp;interval_fp)-&gt;l_uf)) &lt; add_t); } while (0)" data-ref="_M/L_ADDUF">L_ADDUF</a>(&amp;<a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>, <var>0x80000000</var>);</td></tr>
<tr><th id="452">452</th><td>			<a class="local col1 ref" href="#21oldest_age" title='oldest_age' data-ref="21oldest_age" data-ref-filename="21oldest_age">oldest_age</a> = <a class="local col7 ref" href="#17interval_fp" title='interval_fp' data-ref="17interval_fp" data-ref-filename="17interval_fp">interval_fp</a>.<a class="macro" href="../include/ntp_fp.h.html#41" title="Ul_i.Xl_i" data-ref="_M/l_i">l_i</a>;</td></tr>
<tr><th id="453">453</th><td>		}</td></tr>
<tr><th id="454">454</th><td>		<i>/* note -1 is legal for mru_maxage (disables) */</i></td></tr>
<tr><th id="455">455</th><td>		<b>if</b> (<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> &amp;&amp; <a class="ref" href="../include/ntpd.h.html#mru_maxage" title='mru_maxage' data-ref="mru_maxage" data-ref-filename="mru_maxage">mru_maxage</a> &lt; <a class="local col1 ref" href="#21oldest_age" title='oldest_age' data-ref="21oldest_age" data-ref-filename="21oldest_age">oldest_age</a>) {</td></tr>
<tr><th id="456">456</th><td>			<a class="tu ref fn" href="#mon_reclaim_entry" title='mon_reclaim_entry' data-use='c' data-ref="mon_reclaim_entry" data-ref-filename="mon_reclaim_entry">mon_reclaim_entry</a>(<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a>);</td></tr>
<tr><th id="457">457</th><td>			<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> = <a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a>;</td></tr>
<tr><th id="458">458</th><td>		} <b>else</b> <b>if</b> (<a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> || <a class="ref" href="../include/ntpd.h.html#mru_alloc" title='mru_alloc' data-ref="mru_alloc" data-ref-filename="mru_alloc">mru_alloc</a> &lt;</td></tr>
<tr><th id="459">459</th><td>			   <a class="ref" href="../include/ntpd.h.html#mru_maxdepth" title='mru_maxdepth' data-ref="mru_maxdepth" data-ref-filename="mru_maxdepth">mru_maxdepth</a>) {</td></tr>
<tr><th id="460">460</th><td>			<b>if</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span> == <a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a>)</td></tr>
<tr><th id="461">461</th><td>				<a class="tu ref fn" href="#mon_getmoremem" title='mon_getmoremem' data-use='c' data-ref="mon_getmoremem" data-ref-filename="mon_getmoremem">mon_getmoremem</a>();</td></tr>
<tr><th id="462">462</th><td>			<a class="macro" href="../include/ntp_lists.h.html#172" title="do { (mon) = (mon_free); if (((void*)0) != (mon)) { (mon_free) = (mon)-&gt;hash_next; ((mon)-&gt;hash_next) = ((void*)0); } } while (0)" data-ref="_M/UNLINK_HEAD_SLIST">UNLINK_HEAD_SLIST</a>(<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="tu ref" href="#mon_free" title='mon_free' data-use='r' data-ref="mon_free" data-ref-filename="mon_free"><a class="tu ref" href="#mon_free" title='mon_free' data-use='w' data-ref="mon_free" data-ref-filename="mon_free">mon_free</a></a>, <a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>);</td></tr>
<tr><th id="463">463</th><td>		<i>/* Preempt from the MRU list if old enough. */</i></td></tr>
<tr><th id="464">464</th><td>		} <b>else</b> <b>if</b> (<a class="ref fn" href="../include/ntp_random.h.html#ntp_random" title='ntp_random' data-ref="ntp_random" data-ref-filename="ntp_random">ntp_random</a>() / (<var>2.</var> * <a class="macro" href="../include/ntp_fp.h.html#260" title="4294967296.0" data-ref="_M/FRAC">FRAC</a>) &gt;</td></tr>
<tr><th id="465">465</th><td>			   (<em>double</em>)<a class="local col1 ref" href="#21oldest_age" title='oldest_age' data-ref="21oldest_age" data-ref-filename="21oldest_age">oldest_age</a> / <a class="ref" href="../include/ntpd.h.html#mon_age" title='mon_age' data-ref="mon_age" data-ref-filename="mon_age">mon_age</a>) {</td></tr>
<tr><th id="466">466</th><td>			<b>return</b> ~(<a class="macro" href="../include/ntp.h.html#876" title="0x0040" data-ref="_M/RES_LIMITED">RES_LIMITED</a> | <a class="macro" href="../include/ntp.h.html#886" title="0x0800" data-ref="_M/RES_KOD">RES_KOD</a>) &amp; <a class="local col6 ref" href="#16flags" title='flags' data-ref="16flags" data-ref-filename="16flags">flags</a>;</td></tr>
<tr><th id="467">467</th><td>		} <b>else</b> {</td></tr>
<tr><th id="468">468</th><td>			<a class="tu ref fn" href="#mon_reclaim_entry" title='mon_reclaim_entry' data-use='c' data-ref="mon_reclaim_entry" data-ref-filename="mon_reclaim_entry">mon_reclaim_entry</a>(<a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a>);</td></tr>
<tr><th id="469">469</th><td>			<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> = <a class="local col0 ref" href="#20oldest" title='oldest' data-ref="20oldest" data-ref-filename="20oldest">oldest</a>;</td></tr>
<tr><th id="470">470</th><td>		}</td></tr>
<tr><th id="471">471</th><td>	}</td></tr>
<tr><th id="472">472</th><td></td></tr>
<tr><th id="473">473</th><td>	<a class="macro" href="../include/ntp_assert.h.html#85" title="((void) ((mon != ((void*)0)) || ((isc_assertion_failed)(&quot;/___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/ntp_monitor.c&quot;, 473, isc_assertiontype_insist, &quot;mon != ((void*)0)&quot;), 0)))" data-ref="_M/INSIST">INSIST</a>(<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="474">474</th><td></td></tr>
<tr><th id="475">475</th><td>	<i>/*</i></td></tr>
<tr><th id="476">476</th><td><i>	 * Got one, initialize it</i></td></tr>
<tr><th id="477">477</th><td><i>	 */</i></td></tr>
<tr><th id="478">478</th><td>	<a class="ref" href="../include/ntpd.h.html#mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</a>++;</td></tr>
<tr><th id="479">479</th><td>	<a class="ref" href="../include/ntpd.h.html#mru_peakentries" title='mru_peakentries' data-ref="mru_peakentries" data-ref-filename="mru_peakentries">mru_peakentries</a> = <a class="macro" href="../include/ntp.h.html#703" title="(((mru_peakentries) &gt; (mru_entries)) ? (mru_peakentries) : (mru_entries))" data-ref="_M/max">max</a>(<a class="ref" href="../include/ntpd.h.html#mru_peakentries" title='mru_peakentries' data-ref="mru_peakentries" data-ref-filename="mru_peakentries">mru_peakentries</a>, <a class="ref" href="../include/ntpd.h.html#mru_entries" title='mru_entries' data-ref="mru_entries" data-ref-filename="mru_entries">mru_entries</a>);</td></tr>
<tr><th id="480">480</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::last" title='mon_data::last' data-ref="mon_data::last" data-ref-filename="mon_data..last">last</a> = <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::recv_time" title='recvbuf::recv_time' data-ref="recvbuf::recv_time" data-ref-filename="recvbuf..recv_time">recv_time</a>;</td></tr>
<tr><th id="481">481</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::first" title='mon_data::first' data-ref="mon_data::first" data-ref-filename="mon_data..first">first</a> = <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::last" title='mon_data::last' data-ref="mon_data::last" data-ref-filename="mon_data..last">last</a>;</td></tr>
<tr><th id="482">482</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::count" title='mon_data::count' data-ref="mon_data::count" data-ref-filename="mon_data..count">count</a> = <var>1</var>;</td></tr>
<tr><th id="483">483</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::flags" title='mon_data::flags' data-ref="mon_data::flags" data-ref-filename="mon_data..flags">flags</a> = ~(<a class="macro" href="../include/ntp.h.html#876" title="0x0040" data-ref="_M/RES_LIMITED">RES_LIMITED</a> | <a class="macro" href="../include/ntp.h.html#886" title="0x0800" data-ref="_M/RES_KOD">RES_KOD</a>) &amp; <a class="local col6 ref" href="#16flags" title='flags' data-ref="16flags" data-ref-filename="16flags">flags</a>;</td></tr>
<tr><th id="484">484</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::leak" title='mon_data::leak' data-ref="mon_data::leak" data-ref-filename="mon_data..leak">leak</a> = <var>0</var>;</td></tr>
<tr><th id="485">485</th><td>	<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(&amp;<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::rmtadr" title='mon_data::rmtadr' data-ref="mon_data::rmtadr" data-ref-filename="mon_data..rmtadr">rmtadr</a>, &amp;<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#59" title="X_from_where.X_recv_srcadr" data-ref="_M/recv_srcadr">recv_srcadr</a>, <b>sizeof</b>(<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::rmtadr" title='mon_data::rmtadr' data-ref="mon_data::rmtadr" data-ref-filename="mon_data..rmtadr">rmtadr</a>));</td></tr>
<tr><th id="486">486</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::vn_mode" title='mon_data::vn_mode' data-ref="mon_data::vn_mode" data-ref-filename="mon_data..vn_mode">vn_mode</a> = <a class="macro" href="../include/ntp.h.html#601" title="((((version) &amp; 7) &lt;&lt; 3) | ((mode) &amp; 0x7))" data-ref="_M/VN_MODE">VN_MODE</a>(<a class="local col5 ref" href="#25version" title='version' data-ref="25version" data-ref-filename="25version">version</a>, <a class="local col4 ref" href="#24mode" title='mode' data-ref="24mode" data-ref-filename="24mode">mode</a>);</td></tr>
<tr><th id="487">487</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::lcladr" title='mon_data::lcladr' data-ref="mon_data::lcladr" data-ref-filename="mon_data..lcladr">lcladr</a> = <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::dstadr" title='recvbuf::dstadr' data-ref="recvbuf::dstadr" data-ref-filename="recvbuf..dstadr">dstadr</a>;</td></tr>
<tr><th id="488">488</th><td>	<a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::cast_flags" title='mon_data::cast_flags' data-ref="mon_data::cast_flags" data-ref-filename="mon_data..cast_flags">cast_flags</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)(((<a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::dstadr" title='recvbuf::dstadr' data-ref="recvbuf::dstadr" data-ref-filename="recvbuf..dstadr">dstadr</a>-&gt;<a class="ref field" href="../include/ntp.h.html#interface::flags" title='interface::flags' data-ref="interface::flags" data-ref-filename="interface..flags">flags</a> &amp;</td></tr>
<tr><th id="489">489</th><td>	    <a class="macro" href="../include/ntp.h.html#213" title="0x040" data-ref="_M/INT_MCASTOPEN">INT_MCASTOPEN</a>) &amp;&amp; <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::fd" title='recvbuf::fd' data-ref="recvbuf::fd" data-ref-filename="recvbuf..fd">fd</a> == <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::lcladr" title='mon_data::lcladr' data-ref="mon_data::lcladr" data-ref-filename="mon_data..lcladr">lcladr</a>-&gt;<a class="ref field" href="../include/ntp.h.html#interface::fd" title='interface::fd' data-ref="interface::fd" data-ref-filename="interface..fd">fd</a>) ? <a class="macro" href="../include/ntp.h.html#801" title="0x02" data-ref="_M/MDF_MCAST">MDF_MCAST</a></td></tr>
<tr><th id="490">490</th><td>	    : <a class="local col5 ref" href="#15rbufp" title='rbufp' data-ref="15rbufp" data-ref-filename="15rbufp">rbufp</a>-&gt;<a class="ref field" href="../include/recvbuff.h.html#recvbuf::fd" title='recvbuf::fd' data-ref="recvbuf::fd" data-ref-filename="recvbuf..fd">fd</a> == <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::lcladr" title='mon_data::lcladr' data-ref="mon_data::lcladr" data-ref-filename="mon_data..lcladr">lcladr</a>-&gt;<a class="ref field" href="../include/ntp.h.html#interface::bfd" title='interface::bfd' data-ref="interface::bfd" data-ref-filename="interface..bfd">bfd</a> ? <a class="macro" href="../include/ntp.h.html#802" title="0x04" data-ref="_M/MDF_BCAST">MDF_BCAST</a> : <a class="macro" href="../include/ntp.h.html#800" title="0x01" data-ref="_M/MDF_UCAST">MDF_UCAST</a>);</td></tr>
<tr><th id="491">491</th><td></td></tr>
<tr><th id="492">492</th><td>	<i>/*</i></td></tr>
<tr><th id="493">493</th><td><i>	 * Drop him into front of the hash table. Also put him on top of</i></td></tr>
<tr><th id="494">494</th><td><i>	 * the MRU list.</i></td></tr>
<tr><th id="495">495</th><td><i>	 */</i></td></tr>
<tr><th id="496">496</th><td>	<a class="macro" href="../include/ntp_lists.h.html#130" title="do { (mon)-&gt;hash_next = (mon_hash[hash]); (mon_hash[hash]) = (mon); } while (0)" data-ref="_M/LINK_SLIST">LINK_SLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_hash" title='mon_hash' data-ref="mon_hash" data-ref-filename="mon_hash">mon_hash</a>[<a class="local col2 ref" href="#22hash" title='hash' data-ref="22hash" data-ref-filename="22hash">hash</a>], <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#mon_data::hash_next" title='mon_data::hash_next' data-ref="mon_data::hash_next" data-ref-filename="mon_data..hash_next">hash_next</a>);</td></tr>
<tr><th id="497">497</th><td>	<a class="macro" href="../include/ntp_lists.h.html#397" title="do { (mon)-&gt;mru.f = (mon_mru_list).mru.f; (mon)-&gt;mru.b = &amp;(mon_mru_list); (mon_mru_list).mru.f-&gt;mru.b = (mon); (mon_mru_list).mru.f = (mon); } while (0)" data-ref="_M/LINK_DLIST">LINK_DLIST</a>(<a class="ref" href="../include/ntpd.h.html#mon_mru_list" title='mon_mru_list' data-ref="mon_mru_list" data-ref-filename="mon_mru_list">mon_mru_list</a>, <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>, <a class="ref field" href="../include/ntp.h.html#784" title='mon_data::mru' data-ref="mon_data::mru" data-ref-filename="mon_data..mru">mru</a>);</td></tr>
<tr><th id="498">498</th><td></td></tr>
<tr><th id="499">499</th><td>	<b>return</b> <a class="local col9 ref" href="#19mon" title='mon' data-ref="19mon" data-ref-filename="19mon">mon</a>-&gt;<a class="ref field" href="../include/ntp.h.html#mon_data::flags" title='mon_data::flags' data-ref="mon_data::flags" data-ref-filename="mon_data..flags">flags</a>;</td></tr>
<tr><th id="500">500</th><td>}</td></tr>
<tr><th id="501">501</th><td></td></tr>
<tr><th id="502">502</th><td></td></tr>
<tr><th id="503">503</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
