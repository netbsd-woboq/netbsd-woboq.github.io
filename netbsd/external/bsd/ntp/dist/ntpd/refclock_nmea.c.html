<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>refclock_nmea.c source code [netbsd/external/bsd/ntp/dist/ntpd/refclock_nmea.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="date_fmt "/>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/external/bsd/ntp/dist/ntpd/refclock_nmea.c'; var root_path = '../../../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../..'>netbsd</a>/<a href='../../../..'>external</a>/<a href='../../..'>bsd</a>/<a href='../..'>ntp</a>/<a href='..'>dist</a>/<a href='./'>ntpd</a>/<a href='refclock_nmea.c.html'>refclock_nmea.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: refclock_nmea.c,v 1.12 2017/04/13 20:17:42 christos Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * refclock_nmea.c - clock driver for an NMEA GPS CLOCK</i></td></tr>
<tr><th id="5">5</th><td><i> *		Michael Petry Jun 20, 1994</i></td></tr>
<tr><th id="6">6</th><td><i> *		 based on refclock_heathn.c</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * Updated to add support for Accord GPS Clock</i></td></tr>
<tr><th id="9">9</th><td><i> *		Venu Gopal Dec 05, 2007</i></td></tr>
<tr><th id="10">10</th><td><i> *		neo.venu@gmail.com, venugopal_d@pgad.gov.in</i></td></tr>
<tr><th id="11">11</th><td><i> *</i></td></tr>
<tr><th id="12">12</th><td><i> * Updated to process 'time1' fudge factor</i></td></tr>
<tr><th id="13">13</th><td><i> *		Venu Gopal May 05, 2008</i></td></tr>
<tr><th id="14">14</th><td><i> *</i></td></tr>
<tr><th id="15">15</th><td><i> * Converted to common PPSAPI code, separate PPS fudge time1</i></td></tr>
<tr><th id="16">16</th><td><i> * from serial timecode fudge time2.</i></td></tr>
<tr><th id="17">17</th><td><i> *		Dave Hart July 1, 2009</i></td></tr>
<tr><th id="18">18</th><td><i> *		hart@ntp.org, davehart@davehart.com</i></td></tr>
<tr><th id="19">19</th><td><i> */</i></td></tr>
<tr><th id="20">20</th><td></td></tr>
<tr><th id="21">21</th><td><u>#<span data-ppcond="21">ifdef</span> <span class="macro" data-ref="_M/HAVE_CONFIG_H">HAVE_CONFIG_H</span></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../../include/config.h.html">&lt;config.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#<span data-ppcond="21">endif</span></u></td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../include/ntp_types.h.html">"ntp_types.h"</a></u></td></tr>
<tr><th id="26">26</th><td></td></tr>
<tr><th id="27">27</th><td><u>#<span data-ppcond="27">if</span> defined(<a class="macro" href="../../include/config.h.html#1519" data-ref="_M/REFCLOCK">REFCLOCK</a>) &amp;&amp; defined(<a class="macro" href="../../include/config.h.html#101" data-ref="_M/CLOCK_NMEA">CLOCK_NMEA</a>)</u></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><u>#define <dfn class="macro" id="_M/NMEA_WRITE_SUPPORT" data-ref="_M/NMEA_WRITE_SUPPORT">NMEA_WRITE_SUPPORT</dfn> 0 /* no write support at the moment */</u></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/stat.h.html">&lt;sys/stat.h&gt;</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html">&lt;stdio.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/ctype.h.html">&lt;ctype.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#<span data-ppcond="34">ifdef</span> <a class="macro" href="../../include/config.h.html#1041" data-ref="_M/HAVE_SYS_SOCKET_H">HAVE_SYS_SOCKET_H</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/socket.h.html">&lt;sys/socket.h&gt;</a></u></td></tr>
<tr><th id="36">36</th><td><u>#<span data-ppcond="34">endif</span></u></td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="../include/ntpd.h.html">"ntpd.h"</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="../include/ntp_io.h.html">"ntp_io.h"</a></u></td></tr>
<tr><th id="40">40</th><td><u>#include <a href="../include/ntp_unixtime.h.html">"ntp_unixtime.h"</a></u></td></tr>
<tr><th id="41">41</th><td><u>#include <a href="../include/ntp_refclock.h.html">"ntp_refclock.h"</a></u></td></tr>
<tr><th id="42">42</th><td><u>#include <a href="../include/ntp_stdlib.h.html">"ntp_stdlib.h"</a></u></td></tr>
<tr><th id="43">43</th><td><u>#include <a href="../include/ntp_calendar.h.html">"ntp_calendar.h"</a></u></td></tr>
<tr><th id="44">44</th><td><u>#include <a href="../include/timespecops.h.html">"timespecops.h"</a></u></td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td><u>#<span data-ppcond="46">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="47">47</th><td><u># include <a href="ppsapi_timepps.h.html">"ppsapi_timepps.h"</a></u></td></tr>
<tr><th id="48">48</th><td><u># include <a href="../include/refclock_atom.h.html">"refclock_atom.h"</a></u></td></tr>
<tr><th id="49">49</th><td><u>#<span data-ppcond="46">endif</span> /* HAVE_PPSAPI */</u></td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td><i>/*</i></td></tr>
<tr><th id="53">53</th><td><i> * This driver supports NMEA-compatible GPS receivers</i></td></tr>
<tr><th id="54">54</th><td><i> *</i></td></tr>
<tr><th id="55">55</th><td><i> * Prototype was refclock_trak.c, Thanks a lot.</i></td></tr>
<tr><th id="56">56</th><td><i> *</i></td></tr>
<tr><th id="57">57</th><td><i> * The receiver used spits out the NMEA sentences for boat navigation.</i></td></tr>
<tr><th id="58">58</th><td><i> * And you thought it was an information superhighway.	Try a raging river</i></td></tr>
<tr><th id="59">59</th><td><i> * filled with rapids and whirlpools that rip away your data and warp time.</i></td></tr>
<tr><th id="60">60</th><td><i> *</i></td></tr>
<tr><th id="61">61</th><td><i> * If HAVE_PPSAPI is defined code to use the PPSAPI will be compiled in.</i></td></tr>
<tr><th id="62">62</th><td><i> * On startup if initialization of the PPSAPI fails, it will fall back</i></td></tr>
<tr><th id="63">63</th><td><i> * to the "normal" timestamps.</i></td></tr>
<tr><th id="64">64</th><td><i> *</i></td></tr>
<tr><th id="65">65</th><td><i> * The PPSAPI part of the driver understands fudge flag2 and flag3. If</i></td></tr>
<tr><th id="66">66</th><td><i> * flag2 is set, it will use the clear edge of the pulse. If flag3 is</i></td></tr>
<tr><th id="67">67</th><td><i> * set, kernel hardpps is enabled.</i></td></tr>
<tr><th id="68">68</th><td><i> *</i></td></tr>
<tr><th id="69">69</th><td><i> * GPS sentences other than RMC (the default) may be enabled by setting</i></td></tr>
<tr><th id="70">70</th><td><i> * the relevent bits of 'mode' in the server configuration line</i></td></tr>
<tr><th id="71">71</th><td><i> * server 127.127.20.x mode X</i></td></tr>
<tr><th id="72">72</th><td><i> * </i></td></tr>
<tr><th id="73">73</th><td><i> * bit 0 - enables RMC (1)</i></td></tr>
<tr><th id="74">74</th><td><i> * bit 1 - enables GGA (2)</i></td></tr>
<tr><th id="75">75</th><td><i> * bit 2 - enables GLL (4)</i></td></tr>
<tr><th id="76">76</th><td><i> * bit 3 - enables ZDA (8) - Standard Time &amp; Date</i></td></tr>
<tr><th id="77">77</th><td><i> * bit 3 - enables ZDG (8) - Accord GPS Clock's custom sentence with GPS time </i></td></tr>
<tr><th id="78">78</th><td><i> *			     very close to standard ZDA</i></td></tr>
<tr><th id="79">79</th><td><i> * </i></td></tr>
<tr><th id="80">80</th><td><i> * Multiple sentences may be selected except when ZDG/ZDA is selected.</i></td></tr>
<tr><th id="81">81</th><td><i> *</i></td></tr>
<tr><th id="82">82</th><td><i> * bit 4/5/6 - selects the baudrate for serial port :</i></td></tr>
<tr><th id="83">83</th><td><i> *		0 for 4800 (default) </i></td></tr>
<tr><th id="84">84</th><td><i> *		1 for 9600 </i></td></tr>
<tr><th id="85">85</th><td><i> *		2 for 19200 </i></td></tr>
<tr><th id="86">86</th><td><i> *		3 for 38400 </i></td></tr>
<tr><th id="87">87</th><td><i> *		4 for 57600 </i></td></tr>
<tr><th id="88">88</th><td><i> *		5 for 115200 </i></td></tr>
<tr><th id="89">89</th><td><i> */</i></td></tr>
<tr><th id="90">90</th><td><u>#define <dfn class="macro" id="_M/NMEA_MESSAGE_MASK" data-ref="_M/NMEA_MESSAGE_MASK">NMEA_MESSAGE_MASK</dfn>	0x0000FF0FU</u></td></tr>
<tr><th id="91">91</th><td><u>#define <dfn class="macro" id="_M/NMEA_BAUDRATE_MASK" data-ref="_M/NMEA_BAUDRATE_MASK">NMEA_BAUDRATE_MASK</dfn>	0x00000070U</u></td></tr>
<tr><th id="92">92</th><td><u>#define <dfn class="macro" id="_M/NMEA_BAUDRATE_SHIFT" data-ref="_M/NMEA_BAUDRATE_SHIFT">NMEA_BAUDRATE_SHIFT</dfn>	4</u></td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td><u>#define <dfn class="macro" id="_M/NMEA_DELAYMEAS_MASK" data-ref="_M/NMEA_DELAYMEAS_MASK">NMEA_DELAYMEAS_MASK</dfn>	0x80</u></td></tr>
<tr><th id="95">95</th><td><u>#define <dfn class="macro" id="_M/NMEA_EXTLOG_MASK" data-ref="_M/NMEA_EXTLOG_MASK">NMEA_EXTLOG_MASK</dfn>	0x00010000U</u></td></tr>
<tr><th id="96">96</th><td><u>#define <dfn class="macro" id="_M/NMEA_DATETRUST_MASK" data-ref="_M/NMEA_DATETRUST_MASK">NMEA_DATETRUST_MASK</dfn>	0x02000000U</u></td></tr>
<tr><th id="97">97</th><td></td></tr>
<tr><th id="98">98</th><td><u>#define <dfn class="macro" id="_M/NMEA_PROTO_IDLEN" data-ref="_M/NMEA_PROTO_IDLEN">NMEA_PROTO_IDLEN</dfn>	5	/* tag name must be at least 5 chars */</u></td></tr>
<tr><th id="99">99</th><td><u>#define <dfn class="macro" id="_M/NMEA_PROTO_MINLEN" data-ref="_M/NMEA_PROTO_MINLEN">NMEA_PROTO_MINLEN</dfn>	6	/* min chars in sentence, excluding CS */</u></td></tr>
<tr><th id="100">100</th><td><u>#define <dfn class="macro" id="_M/NMEA_PROTO_MAXLEN" data-ref="_M/NMEA_PROTO_MAXLEN">NMEA_PROTO_MAXLEN</dfn>	80	/* max chars in sentence, excluding CS */</u></td></tr>
<tr><th id="101">101</th><td><u>#define <dfn class="macro" id="_M/NMEA_PROTO_FIELDS" data-ref="_M/NMEA_PROTO_FIELDS">NMEA_PROTO_FIELDS</dfn>	32	/* not official; limit on fields per record */</u></td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><i>/*</i></td></tr>
<tr><th id="104">104</th><td><i> * We check the timecode format and decode its contents.  We only care</i></td></tr>
<tr><th id="105">105</th><td><i> * about a few of them, the most important being the $GPRMC format:</i></td></tr>
<tr><th id="106">106</th><td><i> *</i></td></tr>
<tr><th id="107">107</th><td><i> * $GPRMC,hhmmss,a,fddmm.xx,n,dddmmm.xx,w,zz.z,yyy.,ddmmyy,dd,v*CC</i></td></tr>
<tr><th id="108">108</th><td><i> *</i></td></tr>
<tr><th id="109">109</th><td><i> * mode (0,1,2,3) selects sentence ANY/ALL, RMC, GGA, GLL, ZDA</i></td></tr>
<tr><th id="110">110</th><td><i> * $GPGLL,3513.8385,S,14900.7851,E,232420.594,A*21</i></td></tr>
<tr><th id="111">111</th><td><i> * $GPGGA,232420.59,3513.8385,S,14900.7851,E,1,05,3.4,00519,M,,,,*3F</i></td></tr>
<tr><th id="112">112</th><td><i> * $GPRMC,232418.19,A,3513.8386,S,14900.7853,E,00.0,000.0,121199,12.,E*77</i></td></tr>
<tr><th id="113">113</th><td><i> *</i></td></tr>
<tr><th id="114">114</th><td><i> * Defining GPZDA to support Standard Time &amp; Date</i></td></tr>
<tr><th id="115">115</th><td><i> * sentence. The sentence has the following format </i></td></tr>
<tr><th id="116">116</th><td><i> *  </i></td></tr>
<tr><th id="117">117</th><td><i> *  $--ZDA,HHMMSS.SS,DD,MM,YYYY,TH,TM,*CS&lt;CR&gt;&lt;LF&gt;</i></td></tr>
<tr><th id="118">118</th><td><i> *</i></td></tr>
<tr><th id="119">119</th><td><i> *  Apart from the familiar fields, </i></td></tr>
<tr><th id="120">120</th><td><i> *  'TH'    Time zone Hours</i></td></tr>
<tr><th id="121">121</th><td><i> *  'TM'    Time zone Minutes</i></td></tr>
<tr><th id="122">122</th><td><i> *</i></td></tr>
<tr><th id="123">123</th><td><i> * Defining GPZDG to support Accord GPS Clock's custom NMEA </i></td></tr>
<tr><th id="124">124</th><td><i> * sentence. The sentence has the following format </i></td></tr>
<tr><th id="125">125</th><td><i> *  </i></td></tr>
<tr><th id="126">126</th><td><i> *  $GPZDG,HHMMSS.S,DD,MM,YYYY,AA.BB,V*CS&lt;CR&gt;&lt;LF&gt;</i></td></tr>
<tr><th id="127">127</th><td><i> *</i></td></tr>
<tr><th id="128">128</th><td><i> *  It contains the GPS timestamp valid for next PPS pulse.</i></td></tr>
<tr><th id="129">129</th><td><i> *  Apart from the familiar fields, </i></td></tr>
<tr><th id="130">130</th><td><i> *  'AA.BB' denotes the signal strength( should be &lt; 05.00 ) </i></td></tr>
<tr><th id="131">131</th><td><i> *  'V'	    denotes the GPS sync status : </i></td></tr>
<tr><th id="132">132</th><td><i> *	   '0' indicates INVALID time, </i></td></tr>
<tr><th id="133">133</th><td><i> *	   '1' indicates accuracy of +/-20 ms</i></td></tr>
<tr><th id="134">134</th><td><i> *	   '2' indicates accuracy of +/-100 ns</i></td></tr>
<tr><th id="135">135</th><td><i> *</i></td></tr>
<tr><th id="136">136</th><td><i> * Defining PGRMF for Garmin GPS Fix Data</i></td></tr>
<tr><th id="137">137</th><td><i> * $PGRMF,WN,WS,DATE,TIME,LS,LAT,LAT_DIR,LON,LON_DIR,MODE,FIX,SPD,DIR,PDOP,TDOP</i></td></tr>
<tr><th id="138">138</th><td><i> * WN  -- GPS week number (weeks since 1980-01-06, mod 1024)</i></td></tr>
<tr><th id="139">139</th><td><i> * WS  -- GPS seconds in week</i></td></tr>
<tr><th id="140">140</th><td><i> * LS  -- GPS leap seconds, accumulated ( UTC + LS == GPS )</i></td></tr>
<tr><th id="141">141</th><td><i> * FIX -- Fix type: 0=nofix, 1=2D, 2=3D</i></td></tr>
<tr><th id="142">142</th><td><i> * DATE/TIME are standard date/time strings in UTC time scale</i></td></tr>
<tr><th id="143">143</th><td><i> *</i></td></tr>
<tr><th id="144">144</th><td><i> * The GPS time can be used to get the full century for the truncated</i></td></tr>
<tr><th id="145">145</th><td><i> * date spec.</i></td></tr>
<tr><th id="146">146</th><td><i> */</i></td></tr>
<tr><th id="147">147</th><td></td></tr>
<tr><th id="148">148</th><td><i>/*</i></td></tr>
<tr><th id="149">149</th><td><i> * Definitions</i></td></tr>
<tr><th id="150">150</th><td><i> */</i></td></tr>
<tr><th id="151">151</th><td><u>#define	<dfn class="macro" id="_M/DEVICE" data-ref="_M/DEVICE">DEVICE</dfn>		"/dev/gps%d"	/* GPS serial device */</u></td></tr>
<tr><th id="152">152</th><td><u>#define	<dfn class="macro" id="_M/PPSDEV" data-ref="_M/PPSDEV">PPSDEV</dfn>		"/dev/gpspps%d"	/* PPSAPI device override */</u></td></tr>
<tr><th id="153">153</th><td><u>#define	<dfn class="macro" id="_M/SPEED232" data-ref="_M/SPEED232">SPEED232</dfn>	B4800	/* uart speed (4800 bps) */</u></td></tr>
<tr><th id="154">154</th><td><u>#define	<dfn class="macro" id="_M/PRECISION" data-ref="_M/PRECISION">PRECISION</dfn>	(-9)	/* precision assumed (about 2 ms) */</u></td></tr>
<tr><th id="155">155</th><td><u>#define	<dfn class="macro" id="_M/PPS_PRECISION" data-ref="_M/PPS_PRECISION">PPS_PRECISION</dfn>	(-20)	/* precision assumed (about 1 us) */</u></td></tr>
<tr><th id="156">156</th><td><u>#define	<dfn class="macro" id="_M/REFID" data-ref="_M/REFID">REFID</dfn>		"GPS\0"	/* reference id */</u></td></tr>
<tr><th id="157">157</th><td><u>#define	<dfn class="macro" id="_M/DESCRIPTION" data-ref="_M/DESCRIPTION">DESCRIPTION</dfn>	"NMEA GPS Clock" /* who we are */</u></td></tr>
<tr><th id="158">158</th><td><u>#<span data-ppcond="158">ifndef</span> <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/fcntl.h.html#102" data-ref="_M/O_NOCTTY">O_NOCTTY</a></u></td></tr>
<tr><th id="159">159</th><td><u>#define M_NOCTTY	0</u></td></tr>
<tr><th id="160">160</th><td><u>#<span data-ppcond="158">else</span></u></td></tr>
<tr><th id="161">161</th><td><u>#define <dfn class="macro" id="_M/M_NOCTTY" data-ref="_M/M_NOCTTY">M_NOCTTY</dfn>	O_NOCTTY</u></td></tr>
<tr><th id="162">162</th><td><u>#<span data-ppcond="158">endif</span></u></td></tr>
<tr><th id="163">163</th><td><u>#<span data-ppcond="163">ifndef</span> <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/fcntl.h.html#81" data-ref="_M/O_NONBLOCK">O_NONBLOCK</a></u></td></tr>
<tr><th id="164">164</th><td><u>#define M_NONBLOCK	0</u></td></tr>
<tr><th id="165">165</th><td><u>#<span data-ppcond="163">else</span></u></td></tr>
<tr><th id="166">166</th><td><u>#define <dfn class="macro" id="_M/M_NONBLOCK" data-ref="_M/M_NONBLOCK">M_NONBLOCK</dfn>	O_NONBLOCK</u></td></tr>
<tr><th id="167">167</th><td><u>#<span data-ppcond="163">endif</span></u></td></tr>
<tr><th id="168">168</th><td><u>#define <dfn class="macro" id="_M/PPSOPENMODE" data-ref="_M/PPSOPENMODE">PPSOPENMODE</dfn>	(O_RDWR | M_NOCTTY | M_NONBLOCK)</u></td></tr>
<tr><th id="169">169</th><td></td></tr>
<tr><th id="170">170</th><td><i>/* NMEA sentence array indexes for those we use */</i></td></tr>
<tr><th id="171">171</th><td><u>#define <dfn class="macro" id="_M/NMEA_GPRMC" data-ref="_M/NMEA_GPRMC">NMEA_GPRMC</dfn>	0	/* recommended min. nav. */</u></td></tr>
<tr><th id="172">172</th><td><u>#define <dfn class="macro" id="_M/NMEA_GPGGA" data-ref="_M/NMEA_GPGGA">NMEA_GPGGA</dfn>	1	/* fix and quality */</u></td></tr>
<tr><th id="173">173</th><td><u>#define <dfn class="macro" id="_M/NMEA_GPGLL" data-ref="_M/NMEA_GPGLL">NMEA_GPGLL</dfn>	2	/* geo. lat/long */</u></td></tr>
<tr><th id="174">174</th><td><u>#define <dfn class="macro" id="_M/NMEA_GPZDA" data-ref="_M/NMEA_GPZDA">NMEA_GPZDA</dfn>	3	/* date/time */</u></td></tr>
<tr><th id="175">175</th><td><i>/*</i></td></tr>
<tr><th id="176">176</th><td><i> * $GPZDG is a proprietary sentence that violates the spec, by not</i></td></tr>
<tr><th id="177">177</th><td><i> * using $P and an assigned company identifier to prefix the sentence</i></td></tr>
<tr><th id="178">178</th><td><i> * identifier.	When used with this driver, the system needs to be</i></td></tr>
<tr><th id="179">179</th><td><i> * isolated from other NTP networks, as it operates in GPS time, not</i></td></tr>
<tr><th id="180">180</th><td><i> * UTC as is much more common.	GPS time is &gt;15 seconds different from</i></td></tr>
<tr><th id="181">181</th><td><i> * UTC due to not respecting leap seconds since 1970 or so.  Other</i></td></tr>
<tr><th id="182">182</th><td><i> * than the different timebase, $GPZDG is similar to $GPZDA.</i></td></tr>
<tr><th id="183">183</th><td><i> */</i></td></tr>
<tr><th id="184">184</th><td><u>#define <dfn class="macro" id="_M/NMEA_GPZDG" data-ref="_M/NMEA_GPZDG">NMEA_GPZDG</dfn>	4</u></td></tr>
<tr><th id="185">185</th><td><u>#define <dfn class="macro" id="_M/NMEA_PGRMF" data-ref="_M/NMEA_PGRMF">NMEA_PGRMF</dfn>	5</u></td></tr>
<tr><th id="186">186</th><td><u>#define <dfn class="macro" id="_M/NMEA_ARRAY_SIZE" data-ref="_M/NMEA_ARRAY_SIZE">NMEA_ARRAY_SIZE</dfn> (NMEA_PGRMF + 1)</u></td></tr>
<tr><th id="187">187</th><td></td></tr>
<tr><th id="188">188</th><td><i>/*</i></td></tr>
<tr><th id="189">189</th><td><i> * Sentence selection mode bits</i></td></tr>
<tr><th id="190">190</th><td><i> */</i></td></tr>
<tr><th id="191">191</th><td><u>#define <dfn class="macro" id="_M/USE_GPRMC" data-ref="_M/USE_GPRMC">USE_GPRMC</dfn>		0x00000001u</u></td></tr>
<tr><th id="192">192</th><td><u>#define <dfn class="macro" id="_M/USE_GPGGA" data-ref="_M/USE_GPGGA">USE_GPGGA</dfn>		0x00000002u</u></td></tr>
<tr><th id="193">193</th><td><u>#define <dfn class="macro" id="_M/USE_GPGLL" data-ref="_M/USE_GPGLL">USE_GPGLL</dfn>		0x00000004u</u></td></tr>
<tr><th id="194">194</th><td><u>#define <dfn class="macro" id="_M/USE_GPZDA" data-ref="_M/USE_GPZDA">USE_GPZDA</dfn>		0x00000008u</u></td></tr>
<tr><th id="195">195</th><td><u>#define <dfn class="macro" id="_M/USE_PGRMF" data-ref="_M/USE_PGRMF">USE_PGRMF</dfn>		0x00000100u</u></td></tr>
<tr><th id="196">196</th><td></td></tr>
<tr><th id="197">197</th><td><i  data-doc="sentence_mode">/* mapping from sentence index to controlling mode bit */</i></td></tr>
<tr><th id="198">198</th><td><em>static</em> <em>const</em> <a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a> <dfn class="tu decl def" id="sentence_mode" title='sentence_mode' data-type='const u_int32 [6]' data-ref="sentence_mode" data-ref-filename="sentence_mode">sentence_mode</dfn>[<a class="macro" href="#186" title="(5 + 1)" data-ref="_M/NMEA_ARRAY_SIZE">NMEA_ARRAY_SIZE</a>] =</td></tr>
<tr><th id="199">199</th><td>{</td></tr>
<tr><th id="200">200</th><td>	<a class="macro" href="#191" title="0x00000001u" data-ref="_M/USE_GPRMC">USE_GPRMC</a>,</td></tr>
<tr><th id="201">201</th><td>	<a class="macro" href="#192" title="0x00000002u" data-ref="_M/USE_GPGGA">USE_GPGGA</a>,</td></tr>
<tr><th id="202">202</th><td>	<a class="macro" href="#193" title="0x00000004u" data-ref="_M/USE_GPGLL">USE_GPGLL</a>,</td></tr>
<tr><th id="203">203</th><td>	<a class="macro" href="#194" title="0x00000008u" data-ref="_M/USE_GPZDA">USE_GPZDA</a>,</td></tr>
<tr><th id="204">204</th><td>	<a class="macro" href="#194" title="0x00000008u" data-ref="_M/USE_GPZDA">USE_GPZDA</a>,</td></tr>
<tr><th id="205">205</th><td>	<a class="macro" href="#195" title="0x00000100u" data-ref="_M/USE_PGRMF">USE_PGRMF</a></td></tr>
<tr><th id="206">206</th><td>};</td></tr>
<tr><th id="207">207</th><td></td></tr>
<tr><th id="208">208</th><td><i>/* date formats we support */</i></td></tr>
<tr><th id="209">209</th><td><b>enum</b> <dfn class="type def" id="date_fmt" title='date_fmt' data-ref="date_fmt" data-ref-filename="date_fmt">date_fmt</dfn> {</td></tr>
<tr><th id="210">210</th><td>	<dfn class="enum" id="DATE_1_DDMMYY" title='DATE_1_DDMMYY' data-ref="DATE_1_DDMMYY" data-ref-filename="DATE_1_DDMMYY">DATE_1_DDMMYY</dfn>,	<i>/* use 1 field	with 2-digit year */</i></td></tr>
<tr><th id="211">211</th><td>	<dfn class="enum" id="DATE_3_DDMMYYYY" title='DATE_3_DDMMYYYY' data-ref="DATE_3_DDMMYYYY" data-ref-filename="DATE_3_DDMMYYYY">DATE_3_DDMMYYYY</dfn>	<i>/* use 3 fields with 4-digit year */</i></td></tr>
<tr><th id="212">212</th><td>};</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td><i>/* results for 'field_init()'</i></td></tr>
<tr><th id="215">215</th><td><i> *</i></td></tr>
<tr><th id="216">216</th><td><i> * Note: If a checksum is present, the checksum test must pass OK or the</i></td></tr>
<tr><th id="217">217</th><td><i> * sentence is tagged invalid.</i></td></tr>
<tr><th id="218">218</th><td><i> */</i></td></tr>
<tr><th id="219">219</th><td><u>#define <dfn class="macro" id="_M/CHECK_EMPTY" data-ref="_M/CHECK_EMPTY">CHECK_EMPTY</dfn>  -1	/* no data			*/</u></td></tr>
<tr><th id="220">220</th><td><u>#define <dfn class="macro" id="_M/CHECK_INVALID" data-ref="_M/CHECK_INVALID">CHECK_INVALID</dfn> 0	/* not a valid NMEA sentence	*/</u></td></tr>
<tr><th id="221">221</th><td><u>#define <dfn class="macro" id="_M/CHECK_VALID" data-ref="_M/CHECK_VALID">CHECK_VALID</dfn>   1	/* valid but without checksum	*/</u></td></tr>
<tr><th id="222">222</th><td><u>#define <dfn class="macro" id="_M/CHECK_CSVALID" data-ref="_M/CHECK_CSVALID">CHECK_CSVALID</dfn> 2	/* valid with checksum OK	*/</u></td></tr>
<tr><th id="223">223</th><td></td></tr>
<tr><th id="224">224</th><td><i>/*</i></td></tr>
<tr><th id="225">225</th><td><i> * Unit control structure</i></td></tr>
<tr><th id="226">226</th><td><i> */</i></td></tr>
<tr><th id="227">227</th><td><b>typedef</b> <b>struct</b> {</td></tr>
<tr><th id="228">228</th><td><u>#<span data-ppcond="228">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="229">229</th><td>	<b>struct</b> <a class="type" href="../include/refclock_atom.h.html#refclock_atom" title='refclock_atom' data-ref="refclock_atom" data-ref-filename="refclock_atom">refclock_atom</a> <dfn class="tu decl field" id="(anonymous)::atom" title='(anonymous struct)::atom' data-type='struct refclock_atom' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</dfn>; <i  data-doc="(anonymous)::atom">/* PPSAPI structure */</i></td></tr>
<tr><th id="230">230</th><td>	<em>int</em>	<dfn class="tu decl field" id="(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-type='int' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</dfn>;	<i  data-doc="(anonymous)::ppsapi_fd">/* fd used with PPSAPI */</i></td></tr>
<tr><th id="231">231</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="tu decl field" id="(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-type='u_char' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</dfn>;	<i  data-doc="(anonymous)::ppsapi_tried">/* attempt PPSAPI once */</i></td></tr>
<tr><th id="232">232</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="tu decl field" id="(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-type='u_char' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</dfn>;	<i  data-doc="(anonymous)::ppsapi_lit">/* time_pps_create() worked */</i></td></tr>
<tr><th id="233">233</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="tu decl field" id="(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-type='u_char' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</dfn>;	<i  data-doc="(anonymous)::ppsapi_gate">/* system is on PPS */</i></td></tr>
<tr><th id="234">234</th><td><u>#<span data-ppcond="228">endif</span> /* HAVE_PPSAPI */</u></td></tr>
<tr><th id="235">235</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>  <dfn class="tu decl field" id="(anonymous)::gps_time" title='(anonymous struct)::gps_time' data-type='u_char' data-ref="(anonymous)::gps_time" data-ref-filename="(anonymous)..gps_time">gps_time</dfn>;	<i  data-doc="(anonymous)::gps_time">/* use GPS time, not UTC */</i></td></tr>
<tr><th id="236">236</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a> <dfn class="tu decl field" id="(anonymous)::century_cache" title='(anonymous struct)::century_cache' data-type='u_short' data-ref="(anonymous)::century_cache" data-ref-filename="(anonymous)..century_cache">century_cache</dfn>;	<i  data-doc="(anonymous)::century_cache">/* cached current century */</i></td></tr>
<tr><th id="237">237</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>	<dfn class="tu decl field" id="(anonymous)::last_reftime" title='(anonymous struct)::last_reftime' data-type='l_fp' data-ref="(anonymous)::last_reftime" data-ref-filename="(anonymous)..last_reftime">last_reftime</dfn>;	<i  data-doc="(anonymous)::last_reftime">/* last processed reference stamp */</i></td></tr>
<tr><th id="238">238</th><td>	<em>short</em> 	<dfn class="tu decl field" id="(anonymous)::epoch_warp" title='(anonymous struct)::epoch_warp' data-type='short' data-ref="(anonymous)::epoch_warp" data-ref-filename="(anonymous)..epoch_warp">epoch_warp</dfn>;	<i  data-doc="(anonymous)::epoch_warp">/* last epoch warp, for logging */</i></td></tr>
<tr><th id="239">239</th><td>	<i  data-doc="(anonymous)::tally">/* tally stats, reset each poll cycle */</i></td></tr>
<tr><th id="240">240</th><td>	<b>struct</b></td></tr>
<tr><th id="241">241</th><td>	{</td></tr>
<tr><th id="242">242</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::total" title='(anonymous struct)::(anonymous struct)::total' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::total" data-ref-filename="(anonymousstruct)..(anonymous)..total">total</dfn>;</td></tr>
<tr><th id="243">243</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::accepted" title='(anonymous struct)::(anonymous struct)::accepted' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::accepted" data-ref-filename="(anonymousstruct)..(anonymous)..accepted">accepted</dfn>;</td></tr>
<tr><th id="244">244</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::rejected" title='(anonymous struct)::(anonymous struct)::rejected' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::rejected" data-ref-filename="(anonymousstruct)..(anonymous)..rejected">rejected</dfn>;   <i  data-doc="(anonymousstruct)::(anonymous)::rejected">/* GPS said not enough signal */</i></td></tr>
<tr><th id="245">245</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::malformed" title='(anonymous struct)::(anonymous struct)::malformed' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::malformed" data-ref-filename="(anonymousstruct)..(anonymous)..malformed">malformed</dfn>;  <i  data-doc="(anonymousstruct)::(anonymous)::malformed">/* Bad checksum, invalid date or time */</i></td></tr>
<tr><th id="246">246</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::filtered" title='(anonymous struct)::(anonymous struct)::filtered' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::filtered" data-ref-filename="(anonymousstruct)..(anonymous)..filtered">filtered</dfn>;   <i  data-doc="(anonymousstruct)::(anonymous)::filtered">/* mode bits, not GPZDG, same second */</i></td></tr>
<tr><th id="247">247</th><td>		<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a> <dfn class="tu decl field" id="(anonymousstruct)::(anonymous)::pps_used" title='(anonymous struct)::(anonymous struct)::pps_used' data-type='u_int' data-ref="(anonymousstruct)::(anonymous)::pps_used" data-ref-filename="(anonymousstruct)..(anonymous)..pps_used">pps_used</dfn>;</td></tr>
<tr><th id="248">248</th><td>	}	</td></tr>
<tr><th id="249">249</th><td>		<dfn class="tu decl field" id="(anonymous)::tally" title='(anonymous struct)::tally' data-type='struct (anonymous struct at /___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/refclock_nmea.c:240:2)' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</dfn>;</td></tr>
<tr><th id="250">250</th><td>	<i  data-doc="(anonymous)::cksum_type">/* per sentence checksum seen flag */</i></td></tr>
<tr><th id="251">251</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<dfn class="tu decl field" id="(anonymous)::cksum_type" title='(anonymous struct)::cksum_type' data-type='u_char [6]' data-ref="(anonymous)::cksum_type" data-ref-filename="(anonymous)..cksum_type">cksum_type</dfn>[<a class="macro" href="#186" title="(5 + 1)" data-ref="_M/NMEA_ARRAY_SIZE">NMEA_ARRAY_SIZE</a>];</td></tr>
<tr><th id="252">252</th><td>} <dfn class="typedef" id="nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</dfn>;</td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><i>/*</i></td></tr>
<tr><th id="255">255</th><td><i> * helper for faster field access</i></td></tr>
<tr><th id="256">256</th><td><i> */</i></td></tr>
<tr><th id="257">257</th><td><b>typedef</b> <b>struct</b> {</td></tr>
<tr><th id="258">258</th><td>	<em>char</em>  *<dfn class="tu decl field" id="(anonymous)::base" title='(anonymous struct)::base' data-type='char *' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</dfn>;	<i  data-doc="(anonymous)::base">/* buffer base		*/</i></td></tr>
<tr><th id="259">259</th><td>	<em>char</em>  *<dfn class="tu decl field" id="(anonymous)::cptr" title='(anonymous struct)::cptr' data-type='char *' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</dfn>;	<i  data-doc="(anonymous)::cptr">/* current field ptr	*/</i></td></tr>
<tr><th id="260">260</th><td>	<em>int</em>    <dfn class="tu decl field" id="(anonymous)::blen" title='(anonymous struct)::blen' data-type='int' data-ref="(anonymous)::blen" data-ref-filename="(anonymous)..blen">blen</dfn>;	<i  data-doc="(anonymous)::blen">/* buffer length	*/</i></td></tr>
<tr><th id="261">261</th><td>	<em>int</em>    <dfn class="tu decl field" id="(anonymous)::cidx" title='(anonymous struct)::cidx' data-type='int' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</dfn>;	<i  data-doc="(anonymous)::cidx">/* current field index	*/</i></td></tr>
<tr><th id="262">262</th><td>} <dfn class="typedef" id="nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</dfn>;</td></tr>
<tr><th id="263">263</th><td></td></tr>
<tr><th id="264">264</th><td><i>/*</i></td></tr>
<tr><th id="265">265</th><td><i> * NMEA gps week/time information</i></td></tr>
<tr><th id="266">266</th><td><i> * This record contains the number of weeks since 1980-01-06 modulo</i></td></tr>
<tr><th id="267">267</th><td><i> * 1024, the seconds elapsed since start of the week, and the number of</i></td></tr>
<tr><th id="268">268</th><td><i> * leap seconds that are the difference between GPS and UTC time scale.</i></td></tr>
<tr><th id="269">269</th><td><i> */</i></td></tr>
<tr><th id="270">270</th><td><b>typedef</b> <b>struct</b> {</td></tr>
<tr><th id="271">271</th><td>	<a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a> <dfn class="tu decl field" id="(anonymous)::wt_time" title='(anonymous struct)::wt_time' data-type='u_int32' data-ref="(anonymous)::wt_time" data-ref-filename="(anonymous)..wt_time">wt_time</dfn>;	<i  data-doc="(anonymous)::wt_time">/* seconds since weekstart */</i></td></tr>
<tr><th id="272">272</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a> <dfn class="tu decl field" id="(anonymous)::wt_week" title='(anonymous struct)::wt_week' data-type='u_short' data-ref="(anonymous)::wt_week" data-ref-filename="(anonymous)..wt_week">wt_week</dfn>;	<i  data-doc="(anonymous)::wt_week">/* week number */</i></td></tr>
<tr><th id="273">273</th><td>	<em>short</em>	<dfn class="tu decl field" id="(anonymous)::wt_leap" title='(anonymous struct)::wt_leap' data-type='short' data-ref="(anonymous)::wt_leap" data-ref-filename="(anonymous)..wt_leap">wt_leap</dfn>;	<i  data-doc="(anonymous)::wt_leap">/* leap seconds */</i></td></tr>
<tr><th id="274">274</th><td>} <dfn class="typedef" id="gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</dfn>;</td></tr>
<tr><th id="275">275</th><td></td></tr>
<tr><th id="276">276</th><td><i>/*</i></td></tr>
<tr><th id="277">277</th><td><i> * The GPS week time scale starts on Sunday, 1980-01-06. We need the</i></td></tr>
<tr><th id="278">278</th><td><i> * rata die number of this day.</i></td></tr>
<tr><th id="279">279</th><td><i> */</i></td></tr>
<tr><th id="280">280</th><td><u>#<span data-ppcond="280">ifndef</span> <span class="macro" data-ref="_M/DAY_GPS_STARTS">DAY_GPS_STARTS</span></u></td></tr>
<tr><th id="281">281</th><td><u>#define <dfn class="macro" id="_M/DAY_GPS_STARTS" data-ref="_M/DAY_GPS_STARTS">DAY_GPS_STARTS</dfn> 722820</u></td></tr>
<tr><th id="282">282</th><td><u>#<span data-ppcond="280">endif</span></u></td></tr>
<tr><th id="283">283</th><td></td></tr>
<tr><th id="284">284</th><td><i  data-doc="nmea_init">/*</i></td></tr>
<tr><th id="285">285</th><td><i  data-doc="nmea_init"> * Function prototypes</i></td></tr>
<tr><th id="286">286</th><td><i  data-doc="nmea_init"> */</i></td></tr>
<tr><th id="287">287</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_init" title='nmea_init' data-type='void nmea_init()' data-ref="nmea_init" data-ref-filename="nmea_init">nmea_init</a>	(<em>void</em>);</td></tr>
<tr><th id="288">288</th><td><em>static</em>	<em>int</em>	<a class="tu decl fn" href="#nmea_start" title='nmea_start' data-type='int nmea_start(int , struct peer * )' data-ref="nmea_start" data-ref-filename="nmea_start">nmea_start</a>	(<em>int</em>, <b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *);</td></tr>
<tr><th id="289">289</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_shutdown" title='nmea_shutdown' data-type='void nmea_shutdown(int , struct peer * )' data-ref="nmea_shutdown" data-ref-filename="nmea_shutdown">nmea_shutdown</a>	(<em>int</em>, <b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *);</td></tr>
<tr><th id="290">290</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_receive" title='nmea_receive' data-type='void nmea_receive(struct recvbuf * )' data-ref="nmea_receive" data-ref-filename="nmea_receive">nmea_receive</a>	(<b>struct</b> <a class="type" href="../include/recvbuff.h.html#recvbuf" title='recvbuf' data-ref="recvbuf" data-ref-filename="recvbuf">recvbuf</a> *);</td></tr>
<tr><th id="291">291</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_poll" title='nmea_poll' data-type='void nmea_poll(int , struct peer * )' data-ref="nmea_poll" data-ref-filename="nmea_poll">nmea_poll</a>	(<em>int</em>, <b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *);</td></tr>
<tr><th id="292">292</th><td><u>#<span data-ppcond="292">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="293">293</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_control" title='nmea_control' data-type='void nmea_control(int , const struct refclockstat * , struct refclockstat * , struct peer * )' data-ref="nmea_control" data-ref-filename="nmea_control">nmea_control</a>	(<em>int</em>, <em>const</em> <b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockstat" title='refclockstat' data-ref="refclockstat" data-ref-filename="refclockstat">refclockstat</a> *,</td></tr>
<tr><th id="294">294</th><td>				 <b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockstat" title='refclockstat' data-ref="refclockstat" data-ref-filename="refclockstat">refclockstat</a> *, <b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *);</td></tr>
<tr><th id="295">295</th><td><u>#define		<dfn class="macro" id="_M/NMEA_CONTROL" data-ref="_M/NMEA_CONTROL">NMEA_CONTROL</dfn>	<a class="tu ref fn" href="#nmea_control" title='nmea_control' data-ref="nmea_control" data-ref-filename="nmea_control">nmea_control</a></u></td></tr>
<tr><th id="296">296</th><td><u>#<span data-ppcond="292">else</span></u></td></tr>
<tr><th id="297">297</th><td><u>#define		NMEA_CONTROL	noentry</u></td></tr>
<tr><th id="298">298</th><td><u>#<span data-ppcond="292">endif</span> /* HAVE_PPSAPI */</u></td></tr>
<tr><th id="299">299</th><td><em>static</em>	<em>void</em>	<a class="tu decl fn" href="#nmea_timer" title='nmea_timer' data-type='void nmea_timer(int , struct peer * )' data-ref="nmea_timer" data-ref-filename="nmea_timer">nmea_timer</a>	(<em>int</em>, <b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *);</td></tr>
<tr><th id="300">300</th><td></td></tr>
<tr><th id="301">301</th><td><i  data-doc="field_init">/* parsing helpers */</i></td></tr>
<tr><th id="302">302</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#field_init" title='field_init' data-type='int field_init(nmea_data * data, char * cp, int len)' data-ref="field_init" data-ref-filename="field_init">field_init</a>	(<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col1 decl" id="1data" title='data' data-type='nmea_data *' data-ref="1data" data-ref-filename="1data">data</dfn>, <em>char</em> * <dfn class="local col2 decl" id="2cp" title='cp' data-type='char *' data-ref="2cp" data-ref-filename="2cp">cp</dfn>, <em>int</em> <dfn class="local col3 decl" id="3len" title='len' data-type='int' data-ref="3len" data-ref-filename="3len">len</dfn>);</td></tr>
<tr><th id="303">303</th><td><em>static</em> <em>char</em> *	<a class="tu decl fn" href="#field_parse" title='field_parse' data-type='char * field_parse(nmea_data * data, int fn)' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>	(<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col4 decl" id="4data" title='data' data-type='nmea_data *' data-ref="4data" data-ref-filename="4data">data</dfn>, <em>int</em> <dfn class="local col5 decl" id="5fn" title='fn' data-type='int' data-ref="5fn" data-ref-filename="5fn">fn</dfn>);</td></tr>
<tr><th id="304">304</th><td><em>static</em> <em>void</em>	<a class="tu decl fn" href="#field_wipe" title='field_wipe' data-type='void field_wipe(nmea_data * data)' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</a>	(<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col6 decl" id="6data" title='data' data-type='nmea_data *' data-ref="6data" data-ref-filename="6data">data</dfn>, ...);</td></tr>
<tr><th id="305">305</th><td><em>static</em> <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>	<a class="tu decl fn" href="#parse_qual" title='parse_qual' data-type='u_char parse_qual(nmea_data * data, int idx, char tag, int inv)' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>	(<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col7 decl" id="7data" title='data' data-type='nmea_data *' data-ref="7data" data-ref-filename="7data">data</dfn>, <em>int</em> <dfn class="local col8 decl" id="8idx" title='idx' data-type='int' data-ref="8idx" data-ref-filename="8idx">idx</dfn>,</td></tr>
<tr><th id="306">306</th><td>				 <em>char</em> <dfn class="local col9 decl" id="9tag" title='tag' data-type='char' data-ref="9tag" data-ref-filename="9tag">tag</dfn>, <em>int</em> <dfn class="local col0 decl" id="10inv" title='inv' data-type='int' data-ref="10inv" data-ref-filename="10inv">inv</dfn>);</td></tr>
<tr><th id="307">307</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#parse_time" title='parse_time' data-type='int parse_time(struct calendar * jd, long * nsec, nmea_data * , int idx)' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>	(<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col1 decl" id="11jd" title='jd' data-type='struct calendar *' data-ref="11jd" data-ref-filename="11jd">jd</dfn>, <em>long</em> * <dfn class="local col2 decl" id="12nsec" title='nsec' data-type='long *' data-ref="12nsec" data-ref-filename="12nsec">nsec</dfn>,</td></tr>
<tr><th id="308">308</th><td>				 <a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> *, <em>int</em> <dfn class="local col3 decl" id="13idx" title='idx' data-type='int' data-ref="13idx" data-ref-filename="13idx">idx</dfn>);</td></tr>
<tr><th id="309">309</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#parse_date" title='parse_date' data-type='int parse_date(struct calendar * jd, nmea_data * , int idx, enum date_fmt fmt)' data-ref="parse_date" data-ref-filename="parse_date">parse_date</a>	(<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> *<dfn class="local col4 decl" id="14jd" title='jd' data-type='struct calendar *' data-ref="14jd" data-ref-filename="14jd">jd</dfn>, <a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a>*,</td></tr>
<tr><th id="310">310</th><td>				 <em>int</em> <dfn class="local col5 decl" id="15idx" title='idx' data-type='int' data-ref="15idx" data-ref-filename="15idx">idx</dfn>, <b>enum</b> <a class="type" href="#date_fmt" title='date_fmt' data-ref="date_fmt" data-ref-filename="date_fmt">date_fmt</a> <dfn class="local col6 decl" id="16fmt" title='fmt' data-type='enum date_fmt' data-ref="16fmt" data-ref-filename="16fmt">fmt</dfn>);</td></tr>
<tr><th id="311">311</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#parse_weekdata" title='parse_weekdata' data-type='int parse_weekdata(gps_weektm * , nmea_data * , int weekidx, int timeidx, int leapidx)' data-ref="parse_weekdata" data-ref-filename="parse_weekdata">parse_weekdata</a>	(<a class="typedef" href="#gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</a> *, <a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> *,</td></tr>
<tr><th id="312">312</th><td>				 <em>int</em> <dfn class="local col7 decl" id="17weekidx" title='weekidx' data-type='int' data-ref="17weekidx" data-ref-filename="17weekidx">weekidx</dfn>, <em>int</em> <dfn class="local col8 decl" id="18timeidx" title='timeidx' data-type='int' data-ref="18timeidx" data-ref-filename="18timeidx">timeidx</dfn>, <em>int</em> <dfn class="local col9 decl" id="19leapidx" title='leapidx' data-type='int' data-ref="19leapidx" data-ref-filename="19leapidx">leapidx</dfn>);</td></tr>
<tr><th id="313">313</th><td><i  data-doc="unfold_day">/* calendar / date helpers */</i></td></tr>
<tr><th id="314">314</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#unfold_day" title='unfold_day' data-type='int unfold_day(struct calendar * jd, u_int32 rec_ui)' data-ref="unfold_day" data-ref-filename="unfold_day">unfold_day</a>	(<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col0 decl" id="20jd" title='jd' data-type='struct calendar *' data-ref="20jd" data-ref-filename="20jd">jd</dfn>, <a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a> <dfn class="local col1 decl" id="21rec_ui" title='rec_ui' data-type='u_int32' data-ref="21rec_ui" data-ref-filename="21rec_ui">rec_ui</dfn>);</td></tr>
<tr><th id="315">315</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#unfold_century" title='unfold_century' data-type='int unfold_century(struct calendar * jd, u_int32 rec_ui)' data-ref="unfold_century" data-ref-filename="unfold_century">unfold_century</a>	(<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col2 decl" id="22jd" title='jd' data-type='struct calendar *' data-ref="22jd" data-ref-filename="22jd">jd</dfn>, <a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a> <dfn class="local col3 decl" id="23rec_ui" title='rec_ui' data-type='u_int32' data-ref="23rec_ui" data-ref-filename="23rec_ui">rec_ui</dfn>);</td></tr>
<tr><th id="316">316</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#gpsfix_century" title='gpsfix_century' data-type='int gpsfix_century(struct calendar * jd, const gps_weektm * wd, u_short * ccentury)' data-ref="gpsfix_century" data-ref-filename="gpsfix_century">gpsfix_century</a>	(<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col4 decl" id="24jd" title='jd' data-type='struct calendar *' data-ref="24jd" data-ref-filename="24jd">jd</dfn>, <em>const</em> <a class="typedef" href="#gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</a> * <dfn class="local col5 decl" id="25wd" title='wd' data-type='const gps_weektm *' data-ref="25wd" data-ref-filename="25wd">wd</dfn>,</td></tr>
<tr><th id="317">317</th><td>				 <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a> * <dfn class="local col6 decl" id="26ccentury" title='ccentury' data-type='u_short *' data-ref="26ccentury" data-ref-filename="26ccentury">ccentury</dfn>);</td></tr>
<tr><th id="318">318</th><td><em>static</em> <a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>     <a class="tu decl fn" href="#eval_gps_time" title='eval_gps_time' data-type='l_fp eval_gps_time(struct peer * peer, const struct calendar * gpst, const struct timespec * gpso, const l_fp * xrecv)' data-ref="eval_gps_time" data-ref-filename="eval_gps_time">eval_gps_time</a>	(<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> * <dfn class="local col7 decl" id="27peer" title='peer' data-type='struct peer *' data-ref="27peer" data-ref-filename="27peer">peer</dfn>, <em>const</em> <b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col8 decl" id="28gpst" title='gpst' data-type='const struct calendar *' data-ref="28gpst" data-ref-filename="28gpst">gpst</dfn>,</td></tr>
<tr><th id="319">319</th><td>				 <em>const</em> <b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> * <dfn class="local col9 decl" id="29gpso" title='gpso' data-type='const struct timespec *' data-ref="29gpso" data-ref-filename="29gpso">gpso</dfn>, <em>const</em> <a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a> * <dfn class="local col0 decl" id="30xrecv" title='xrecv' data-type='const l_fp *' data-ref="30xrecv" data-ref-filename="30xrecv">xrecv</dfn>);</td></tr>
<tr><th id="320">320</th><td></td></tr>
<tr><th id="321">321</th><td><em>static</em> <em>int</em>	<a class="tu decl fn" href="#nmead_open" title='nmead_open' data-type='int nmead_open(const char * device)' data-ref="nmead_open" data-ref-filename="nmead_open">nmead_open</a>	(<em>const</em> <em>char</em> * <dfn class="local col1 decl" id="31device" title='device' data-type='const char *' data-ref="31device" data-ref-filename="31device">device</dfn>);</td></tr>
<tr><th id="322">322</th><td><em>static</em> <em>void</em>     <a class="tu decl fn" href="#save_ltc" title='save_ltc' data-type='void save_ltc(struct refclockproc *const , const char *const , size_t )' data-ref="save_ltc" data-ref-filename="save_ltc">save_ltc</a>        (<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em>, <em>const</em> <em>char</em> * <em>const</em>,</td></tr>
<tr><th id="323">323</th><td>				 <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a>);</td></tr>
<tr><th id="324">324</th><td></td></tr>
<tr><th id="325">325</th><td><i>/*</i></td></tr>
<tr><th id="326">326</th><td><i> * If we want the driver to ouput sentences, too: re-enable the send</i></td></tr>
<tr><th id="327">327</th><td><i> * support functions by defining NMEA_WRITE_SUPPORT to non-zero...</i></td></tr>
<tr><th id="328">328</th><td><i> */</i></td></tr>
<tr><th id="329">329</th><td><u>#<span data-ppcond="329">if</span> <a class="macro" href="#29" title="0" data-ref="_M/NMEA_WRITE_SUPPORT">NMEA_WRITE_SUPPORT</a></u></td></tr>
<tr><th id="330">330</th><td></td></tr>
<tr><th id="331">331</th><td><em>static</em>	<em>void</em> gps_send(<em>int</em>, <em>const</em> <em>char</em> *, <b>struct</b> peer *);</td></tr>
<tr><th id="332">332</th><td><u># ifdef SYS_WINNT</u></td></tr>
<tr><th id="333">333</th><td><u>#  undef write	/* ports/winnt/include/config.h: #define write _write */</u></td></tr>
<tr><th id="334">334</th><td><b>extern</b> <em>int</em> async_write(<em>int</em>, <em>const</em> <em>void</em> *, <em>unsigned</em> <em>int</em>);</td></tr>
<tr><th id="335">335</th><td><u>#  define write(fd, data, octets)	async_write(fd, data, octets)</u></td></tr>
<tr><th id="336">336</th><td><u># endif /* SYS_WINNT */</u></td></tr>
<tr><th id="337">337</th><td></td></tr>
<tr><th id="338">338</th><td><u>#<span data-ppcond="329">endif</span> /* NMEA_WRITE_SUPPORT */</u></td></tr>
<tr><th id="339">339</th><td></td></tr>
<tr><th id="340">340</th><td><em>static</em> <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="tu decl def" id="g_gpsMinBase" title='g_gpsMinBase' data-type='int32_t' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</dfn>;</td></tr>
<tr><th id="341">341</th><td><em>static</em> <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="tu decl def" id="g_gpsMinYear" title='g_gpsMinYear' data-type='int32_t' data-ref="g_gpsMinYear" data-ref-filename="g_gpsMinYear">g_gpsMinYear</dfn>;</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td><i>/*</i></td></tr>
<tr><th id="344">344</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="345">345</th><td><i> * Transfer vector</i></td></tr>
<tr><th id="346">346</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="347">347</th><td><i> */</i></td></tr>
<tr><th id="348">348</th><td><b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclock" title='refclock' data-ref="refclock" data-ref-filename="refclock">refclock</a> <dfn class="decl def" id="refclock_nmea" title='refclock_nmea' data-ref="refclock_nmea" data-ref-filename="refclock_nmea">refclock_nmea</dfn> = {</td></tr>
<tr><th id="349">349</th><td>	<a class="tu ref fn" href="#nmea_start" title='nmea_start' data-ref="nmea_start" data-ref-filename="nmea_start">nmea_start</a>,		<i>/* start up driver */</i></td></tr>
<tr><th id="350">350</th><td>	<a class="tu ref fn" href="#nmea_shutdown" title='nmea_shutdown' data-ref="nmea_shutdown" data-ref-filename="nmea_shutdown">nmea_shutdown</a>,		<i>/* shut down driver */</i></td></tr>
<tr><th id="351">351</th><td>	<a class="tu ref fn" href="#nmea_poll" title='nmea_poll' data-ref="nmea_poll" data-ref-filename="nmea_poll">nmea_poll</a>,		<i>/* transmit poll message */</i></td></tr>
<tr><th id="352">352</th><td>	<a class="macro" href="#295" title="nmea_control" data-ref="_M/NMEA_CONTROL">NMEA_CONTROL</a>,		<i>/* fudge control */</i></td></tr>
<tr><th id="353">353</th><td>	<a class="tu ref fn" href="#nmea_init" title='nmea_init' data-ref="nmea_init" data-ref-filename="nmea_init">nmea_init</a>,		<i>/* initialize driver */</i></td></tr>
<tr><th id="354">354</th><td>	<a class="macro" href="../include/ntp_refclock.h.html#200" title="0" data-ref="_M/noentry">noentry</a>,		<i>/* buginfo */</i></td></tr>
<tr><th id="355">355</th><td>	<a class="tu ref fn" href="#nmea_timer" title='nmea_timer' data-ref="nmea_timer" data-ref-filename="nmea_timer">nmea_timer</a>		<i>/* called once per second */</i></td></tr>
<tr><th id="356">356</th><td>};</td></tr>
<tr><th id="357">357</th><td></td></tr>
<tr><th id="358">358</th><td><i  data-doc="nmea_init">/*</i></td></tr>
<tr><th id="359">359</th><td><i  data-doc="nmea_init"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="360">360</th><td><i  data-doc="nmea_init"> * nmea_init - initialise data</i></td></tr>
<tr><th id="361">361</th><td><i  data-doc="nmea_init"> *</i></td></tr>
<tr><th id="362">362</th><td><i  data-doc="nmea_init"> * calculates a few runtime constants that cannot be made compile time</i></td></tr>
<tr><th id="363">363</th><td><i  data-doc="nmea_init"> * constants.</i></td></tr>
<tr><th id="364">364</th><td><i  data-doc="nmea_init"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="365">365</th><td><i  data-doc="nmea_init"> */</i></td></tr>
<tr><th id="366">366</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="367">367</th><td><dfn class="tu decl def fn" id="nmea_init" title='nmea_init' data-type='void nmea_init()' data-ref="nmea_init" data-ref-filename="nmea_init">nmea_init</dfn>(<em>void</em>)</td></tr>
<tr><th id="368">368</th><td>{</td></tr>
<tr><th id="369">369</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> <dfn class="local col2 decl" id="32date" title='date' data-type='struct calendar' data-ref="32date" data-ref-filename="32date">date</dfn>;</td></tr>
<tr><th id="370">370</th><td></td></tr>
<tr><th id="371">371</th><td>	<i>/* - calculate min. base value for GPS epoch &amp; century unfolding </i></td></tr>
<tr><th id="372">372</th><td><i>	 * This assumes that the build system was roughly in sync with</i></td></tr>
<tr><th id="373">373</th><td><i>	 * the world, and that really synchronising to a time before the</i></td></tr>
<tr><th id="374">374</th><td><i>	 * program was created would be unsafe or insane. If the build</i></td></tr>
<tr><th id="375">375</th><td><i>	 * date cannot be stablished, at least use the start of GPS</i></td></tr>
<tr><th id="376">376</th><td><i>	 * (1980-01-06) as minimum, because GPS can surely NOT</i></td></tr>
<tr><th id="377">377</th><td><i>	 * synchronise beyond it's own big bang. We add a little safety</i></td></tr>
<tr><th id="378">378</th><td><i>	 * margin for the fuzziness of the build date, which is in an</i></td></tr>
<tr><th id="379">379</th><td><i>	 * undefined time zone. */</i></td></tr>
<tr><th id="380">380</th><td>	<b>if</b> (<a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_get_build_date" title='ntpcal_get_build_date' data-ref="ntpcal_get_build_date" data-ref-filename="ntpcal_get_build_date">ntpcal_get_build_date</a>(&amp;<a class="local col2 ref" href="#32date" title='date' data-ref="32date" data-ref-filename="32date">date</a>))</td></tr>
<tr><th id="381">381</th><td>		<a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='w' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_rd" title='ntpcal_date_to_rd' data-ref="ntpcal_date_to_rd" data-ref-filename="ntpcal_date_to_rd">ntpcal_date_to_rd</a>(&amp;<a class="local col2 ref" href="#32date" title='date' data-ref="32date" data-ref-filename="32date">date</a>) - <var>2</var>;</td></tr>
<tr><th id="382">382</th><td>	<b>else</b></td></tr>
<tr><th id="383">383</th><td>		<a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='w' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a> = <var>0</var>;</td></tr>
<tr><th id="384">384</th><td></td></tr>
<tr><th id="385">385</th><td>	<b>if</b> (<a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='r' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a> &lt; <a class="macro" href="#281" title="722820" data-ref="_M/DAY_GPS_STARTS">DAY_GPS_STARTS</a>)</td></tr>
<tr><th id="386">386</th><td>		<a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='w' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a> = <a class="macro" href="#281" title="722820" data-ref="_M/DAY_GPS_STARTS">DAY_GPS_STARTS</a>;</td></tr>
<tr><th id="387">387</th><td></td></tr>
<tr><th id="388">388</th><td>	<a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_rd_to_date" title='ntpcal_rd_to_date' data-ref="ntpcal_rd_to_date" data-ref-filename="ntpcal_rd_to_date">ntpcal_rd_to_date</a>(&amp;<a class="local col2 ref" href="#32date" title='date' data-ref="32date" data-ref-filename="32date">date</a>, <a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='r' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a>);</td></tr>
<tr><th id="389">389</th><td>	<a class="tu ref" href="#g_gpsMinYear" title='g_gpsMinYear' data-use='w' data-ref="g_gpsMinYear" data-ref-filename="g_gpsMinYear">g_gpsMinYear</a>  = <a class="local col2 ref" href="#32date" title='date' data-ref="32date" data-ref-filename="32date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>;</td></tr>
<tr><th id="390">390</th><td>	<a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='w' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a> -= <a class="macro" href="../include/ntp_calendar.h.html#418" title="693596" data-ref="_M/DAY_NTP_STARTS">DAY_NTP_STARTS</a>;</td></tr>
<tr><th id="391">391</th><td>}</td></tr>
<tr><th id="392">392</th><td></td></tr>
<tr><th id="393">393</th><td><i  data-doc="nmea_start">/*</i></td></tr>
<tr><th id="394">394</th><td><i  data-doc="nmea_start"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="395">395</th><td><i  data-doc="nmea_start"> * nmea_start - open the GPS devices and initialize data for processing</i></td></tr>
<tr><th id="396">396</th><td><i  data-doc="nmea_start"> *</i></td></tr>
<tr><th id="397">397</th><td><i  data-doc="nmea_start"> * return 0 on error, 1 on success. Even on error the peer structures</i></td></tr>
<tr><th id="398">398</th><td><i  data-doc="nmea_start"> * must be in a state that permits 'nmea_shutdown()' to clean up all</i></td></tr>
<tr><th id="399">399</th><td><i  data-doc="nmea_start"> * resources, because it will be called immediately to do so.</i></td></tr>
<tr><th id="400">400</th><td><i  data-doc="nmea_start"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="401">401</th><td><i  data-doc="nmea_start"> */</i></td></tr>
<tr><th id="402">402</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="403">403</th><td><dfn class="tu decl def fn" id="nmea_start" title='nmea_start' data-type='int nmea_start(int unit, struct peer * peer)' data-ref="nmea_start" data-ref-filename="nmea_start">nmea_start</dfn>(</td></tr>
<tr><th id="404">404</th><td>	<em>int</em>		<dfn class="local col3 decl" id="33unit" title='unit' data-type='int' data-ref="33unit" data-ref-filename="33unit">unit</dfn>,</td></tr>
<tr><th id="405">405</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> *	<dfn class="local col4 decl" id="34peer" title='peer' data-type='struct peer *' data-ref="34peer" data-ref-filename="34peer">peer</dfn></td></tr>
<tr><th id="406">406</th><td>	)</td></tr>
<tr><th id="407">407</th><td>{</td></tr>
<tr><th id="408">408</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em>	<dfn class="local col5 decl" id="35pp" title='pp' data-type='struct refclockproc *const' data-ref="35pp" data-ref-filename="35pp">pp</dfn> = <a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="409">409</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a> * <em>const</em>		<dfn class="local col6 decl" id="36up" title='up' data-type='nmea_unit *const' data-ref="36up" data-ref-filename="36up">up</dfn> = <a class="macro" href="../include/ntp_stdlib.h.html#115" title="ereallocz(((void*)0), (sizeof(*up)), 0, 1)" data-ref="_M/emalloc_zero">emalloc_zero</a>(<b>sizeof</b>(*<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>));</td></tr>
<tr><th id="410">410</th><td>	<em>char</em>				<dfn class="local col7 decl" id="37device" title='device' data-type='char [20]' data-ref="37device" data-ref-filename="37device">device</dfn>[<var>20</var>];</td></tr>
<tr><th id="411">411</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a>				<dfn class="local col8 decl" id="38devlen" title='devlen' data-type='size_t' data-ref="38devlen" data-ref-filename="38devlen">devlen</dfn>;</td></tr>
<tr><th id="412">412</th><td>	<a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a>				<dfn class="local col9 decl" id="39rate" title='rate' data-type='u_int32' data-ref="39rate" data-ref-filename="39rate">rate</dfn>;</td></tr>
<tr><th id="413">413</th><td>	<em>int</em>				<dfn class="local col0 decl" id="40baudrate" title='baudrate' data-type='int' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</dfn>;</td></tr>
<tr><th id="414">414</th><td>	<em>const</em> <em>char</em> *			<dfn class="local col1 decl" id="41baudtext" title='baudtext' data-type='const char *' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</dfn>;</td></tr>
<tr><th id="415">415</th><td></td></tr>
<tr><th id="416">416</th><td></td></tr>
<tr><th id="417">417</th><td>	<i>/* Get baudrate choice from mode byte bits 4/5/6 */</i></td></tr>
<tr><th id="418">418</th><td>	<a class="local col9 ref" href="#39rate" title='rate' data-ref="39rate" data-ref-filename="39rate">rate</a> = (<a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="macro" href="#91" title="0x00000070U" data-ref="_M/NMEA_BAUDRATE_MASK">NMEA_BAUDRATE_MASK</a>) &gt;&gt; <a class="macro" href="#92" title="4" data-ref="_M/NMEA_BAUDRATE_SHIFT">NMEA_BAUDRATE_SHIFT</a>;</td></tr>
<tr><th id="419">419</th><td></td></tr>
<tr><th id="420">420</th><td>	<b>switch</b> (<a class="local col9 ref" href="#39rate" title='rate' data-ref="39rate" data-ref-filename="39rate">rate</a>) {</td></tr>
<tr><th id="421">421</th><td>	<b>case</b> <var>0</var>:</td></tr>
<tr><th id="422">422</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="#153" title="4800U" data-ref="_M/SPEED232">SPEED232</a>;</td></tr>
<tr><th id="423">423</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"4800"</q>;</td></tr>
<tr><th id="424">424</th><td>		<b>break</b>;</td></tr>
<tr><th id="425">425</th><td>	<b>case</b> <var>1</var>:</td></tr>
<tr><th id="426">426</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#228" title="9600U" data-ref="_M/B9600">B9600</a>;</td></tr>
<tr><th id="427">427</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"9600"</q>;</td></tr>
<tr><th id="428">428</th><td>		<b>break</b>;</td></tr>
<tr><th id="429">429</th><td>	<b>case</b> <var>2</var>:</td></tr>
<tr><th id="430">430</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#229" title="19200U" data-ref="_M/B19200">B19200</a>;</td></tr>
<tr><th id="431">431</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"19200"</q>;</td></tr>
<tr><th id="432">432</th><td>		<b>break</b>;</td></tr>
<tr><th id="433">433</th><td>	<b>case</b> <var>3</var>:</td></tr>
<tr><th id="434">434</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#230" title="38400U" data-ref="_M/B38400">B38400</a>;</td></tr>
<tr><th id="435">435</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"38400"</q>;</td></tr>
<tr><th id="436">436</th><td>		<b>break</b>;</td></tr>
<tr><th id="437">437</th><td><u>#<span data-ppcond="437">ifdef</span> <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#235" data-ref="_M/B57600">B57600</a></u></td></tr>
<tr><th id="438">438</th><td>	<b>case</b> <var>4</var>:</td></tr>
<tr><th id="439">439</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#235" title="57600U" data-ref="_M/B57600">B57600</a>;</td></tr>
<tr><th id="440">440</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"57600"</q>;</td></tr>
<tr><th id="441">441</th><td>		<b>break</b>;</td></tr>
<tr><th id="442">442</th><td><u>#<span data-ppcond="437">endif</span></u></td></tr>
<tr><th id="443">443</th><td><u>#<span data-ppcond="443">ifdef</span> <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#237" data-ref="_M/B115200">B115200</a></u></td></tr>
<tr><th id="444">444</th><td>	<b>case</b> <var>5</var>:</td></tr>
<tr><th id="445">445</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/termios.h.html#237" title="115200U" data-ref="_M/B115200">B115200</a>;</td></tr>
<tr><th id="446">446</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"115200"</q>;</td></tr>
<tr><th id="447">447</th><td>		<b>break</b>;</td></tr>
<tr><th id="448">448</th><td><u>#<span data-ppcond="443">endif</span></u></td></tr>
<tr><th id="449">449</th><td>	<b>default</b>:</td></tr>
<tr><th id="450">450</th><td>		<a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a> = <a class="macro" href="#153" title="4800U" data-ref="_M/SPEED232">SPEED232</a>;</td></tr>
<tr><th id="451">451</th><td>		<a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a> = <q>"4800 (fallback)"</q>;</td></tr>
<tr><th id="452">452</th><td>		<b>break</b>;</td></tr>
<tr><th id="453">453</th><td>	}</td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td>	<i>/* Allocate and initialize unit structure */</i></td></tr>
<tr><th id="456">456</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a> = (<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#146" title="__caddr_t" data-ref="_M/caddr_t">caddr_t</a>)<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>;</td></tr>
<tr><th id="457">457</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a> = -<var>1</var>;</td></tr>
<tr><th id="458">458</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::clock_recv" title='refclockio::clock_recv' data-ref="refclockio::clock_recv" data-ref-filename="refclockio..clock_recv">clock_recv</a> = <a class="tu ref fn" href="#nmea_receive" title='nmea_receive' data-use='r' data-ref="nmea_receive" data-ref-filename="nmea_receive">nmea_receive</a>;</td></tr>
<tr><th id="459">459</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::srcclock" title='refclockio::srcclock' data-ref="refclockio::srcclock" data-ref-filename="refclockio..srcclock">srcclock</a> = <a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>;</td></tr>
<tr><th id="460">460</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::datalen" title='refclockio::datalen' data-ref="refclockio::datalen" data-ref-filename="refclockio..datalen">datalen</a> = <var>0</var>;</td></tr>
<tr><th id="461">461</th><td>	<i>/* force change detection on first valid message */</i></td></tr>
<tr><th id="462">462</th><td>	<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memset" title='memset' data-ref="memset" data-ref-filename="memset">memset</a>(&amp;<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::last_reftime" title='(anonymous struct)::last_reftime' data-use='a' data-ref="(anonymous)::last_reftime" data-ref-filename="(anonymous)..last_reftime">last_reftime</a>, <var>0xFF</var>, <b>sizeof</b>(<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::last_reftime" title='(anonymous struct)::last_reftime' data-use='r' data-ref="(anonymous)::last_reftime" data-ref-filename="(anonymous)..last_reftime">last_reftime</a>));</td></tr>
<tr><th id="463">463</th><td>	<i>/* force checksum on GPRMC, see below */</i></td></tr>
<tr><th id="464">464</th><td>	<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::cksum_type" title='(anonymous struct)::cksum_type' data-use='w' data-ref="(anonymous)::cksum_type" data-ref-filename="(anonymous)..cksum_type">cksum_type</a>[<a class="macro" href="#171" title="0" data-ref="_M/NMEA_GPRMC">NMEA_GPRMC</a>] = <a class="macro" href="#222" title="2" data-ref="_M/CHECK_CSVALID">CHECK_CSVALID</a>;</td></tr>
<tr><th id="465">465</th><td><u>#<span data-ppcond="465">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="466">466</th><td>	<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='w' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> = -<var>1</var>;</td></tr>
<tr><th id="467">467</th><td><u>#<span data-ppcond="465">endif</span></u></td></tr>
<tr><th id="468">468</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(up-&gt;tally), sizeof(up-&gt;tally))" data-ref="_M/ZERO">ZERO</a>(<a class="local col6 ref" href="#36up" title='up' data-ref="36up" data-ref-filename="36up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='a' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally"><a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='r' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a></a>);</td></tr>
<tr><th id="469">469</th><td></td></tr>
<tr><th id="470">470</th><td>	<i>/* Initialize miscellaneous variables */</i></td></tr>
<tr><th id="471">471</th><td>	<a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::precision" title='peer::precision' data-ref="peer::precision" data-ref-filename="peer..precision">precision</a> = <a class="macro" href="#154" title="(-9)" data-ref="_M/PRECISION">PRECISION</a>;</td></tr>
<tr><th id="472">472</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::clockdesc" title='refclockproc::clockdesc' data-ref="refclockproc::clockdesc" data-ref-filename="refclockproc..clockdesc">clockdesc</a> = <a class="macro" href="#157" title="&quot;NMEA GPS Clock&quot;" data-ref="_M/DESCRIPTION">DESCRIPTION</a>;</td></tr>
<tr><th id="473">473</th><td>	<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(&amp;<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::refid" title='refclockproc::refid' data-ref="refclockproc::refid" data-ref-filename="refclockproc..refid">refid</a>, <a class="macro" href="#156" title="&quot;GPS\0&quot;" data-ref="_M/REFID">REFID</a>, <var>4</var>);</td></tr>
<tr><th id="474">474</th><td></td></tr>
<tr><th id="475">475</th><td>	<i>/* Open serial port. Use CLK line discipline, if available. */</i></td></tr>
<tr><th id="476">476</th><td>	<a class="local col8 ref" href="#38devlen" title='devlen' data-ref="38devlen" data-ref-filename="38devlen">devlen</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#snprintf" title='snprintf' data-ref="snprintf" data-ref-filename="snprintf">snprintf</a>(<a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>, <b>sizeof</b>(<a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>), <a class="macro" href="#151" title="&quot;/dev/gps%d&quot;" data-ref="_M/DEVICE">DEVICE</a>, <a class="local col3 ref" href="#33unit" title='unit' data-ref="33unit" data-ref-filename="33unit">unit</a>);</td></tr>
<tr><th id="477">477</th><td>	<b>if</b> (<a class="local col8 ref" href="#38devlen" title='devlen' data-ref="38devlen" data-ref-filename="38devlen">devlen</a> &gt;= <b>sizeof</b>(<a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>)) {</td></tr>
<tr><th id="478">478</th><td>		<a class="ref fn" href="../include/ntp_stdlib.h.html#msyslog" title='msyslog' data-ref="msyslog" data-ref-filename="msyslog">msyslog</a>(<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#55" title="3" data-ref="_M/LOG_ERR">LOG_ERR</a>, <q>"%s clock device name too long"</q>,</td></tr>
<tr><th id="479">479</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>));</td></tr>
<tr><th id="480">480</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>; <i>/* buffer overflow */</i></td></tr>
<tr><th id="481">481</th><td>	}</td></tr>
<tr><th id="482">482</th><td>	<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a> = <a class="ref fn" href="../include/ntp_refclock.h.html#refclock_open" title='refclock_open' data-ref="refclock_open" data-ref-filename="refclock_open">refclock_open</a>(<a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>, <a class="local col0 ref" href="#40baudrate" title='baudrate' data-ref="40baudrate" data-ref-filename="40baudrate">baudrate</a>, <a class="macro" href="../include/ntp_tty.h.html#86" title="0x001" data-ref="_M/LDISC_CLK">LDISC_CLK</a>);</td></tr>
<tr><th id="483">483</th><td>	<b>if</b> (<var>0</var> &gt;= <a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>) {</td></tr>
<tr><th id="484">484</th><td>		<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a> = <a class="tu ref fn" href="#nmead_open" title='nmead_open' data-use='c' data-ref="nmead_open" data-ref-filename="nmead_open">nmead_open</a>(<a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>);</td></tr>
<tr><th id="485">485</th><td>		<b>if</b> (-<var>1</var> == <a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>)</td></tr>
<tr><th id="486">486</th><td>			<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="487">487</th><td>	}</td></tr>
<tr><th id="488">488</th><td>	<a class="macro" href="../include/ntp_syslog.h.html#82" title="do { if (ntp_syslogmask &amp; (0x00000100)) msyslog (5, &quot;%s serial %s open at %s bps&quot;, refnumtoa(&amp;peer-&gt;srcadr), device, baudtext); } while (0)" data-ref="_M/LOGIF">LOGIF</a>(CLOCKINFO, (<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#57" title="5" data-ref="_M/LOG_NOTICE">LOG_NOTICE</a>, <q>"%s serial %s open at %s bps"</q>,</td></tr>
<tr><th id="489">489</th><td>	      <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col4 ref" href="#34peer" title='peer' data-ref="34peer" data-ref-filename="34peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col7 ref" href="#37device" title='device' data-ref="37device" data-ref-filename="37device">device</a>, <a class="local col1 ref" href="#41baudtext" title='baudtext' data-ref="41baudtext" data-ref-filename="41baudtext">baudtext</a>));</td></tr>
<tr><th id="490">490</th><td></td></tr>
<tr><th id="491">491</th><td>	<i>/* succeed if this clock can be added */</i></td></tr>
<tr><th id="492">492</th><td>	<b>return</b> <a class="ref fn" href="../include/ntp_refclock.h.html#io_addclock" title='io_addclock' data-ref="io_addclock" data-ref-filename="io_addclock">io_addclock</a>(&amp;<a class="local col5 ref" href="#35pp" title='pp' data-ref="35pp" data-ref-filename="35pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>) != <var>0</var>;</td></tr>
<tr><th id="493">493</th><td>}</td></tr>
<tr><th id="494">494</th><td></td></tr>
<tr><th id="495">495</th><td></td></tr>
<tr><th id="496">496</th><td><i  data-doc="nmea_shutdown">/*</i></td></tr>
<tr><th id="497">497</th><td><i  data-doc="nmea_shutdown"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="498">498</th><td><i  data-doc="nmea_shutdown"> * nmea_shutdown - shut down a GPS clock</i></td></tr>
<tr><th id="499">499</th><td><i  data-doc="nmea_shutdown"> * </i></td></tr>
<tr><th id="500">500</th><td><i  data-doc="nmea_shutdown"> * NOTE this routine is called after nmea_start() returns failure,</i></td></tr>
<tr><th id="501">501</th><td><i  data-doc="nmea_shutdown"> * as well as during a normal shutdown due to ntpq :config unpeer.</i></td></tr>
<tr><th id="502">502</th><td><i  data-doc="nmea_shutdown"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="503">503</th><td><i  data-doc="nmea_shutdown"> */</i></td></tr>
<tr><th id="504">504</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="505">505</th><td><dfn class="tu decl def fn" id="nmea_shutdown" title='nmea_shutdown' data-type='void nmea_shutdown(int unit, struct peer * peer)' data-ref="nmea_shutdown" data-ref-filename="nmea_shutdown">nmea_shutdown</dfn>(</td></tr>
<tr><th id="506">506</th><td>	<em>int</em>           <dfn class="local col2 decl" id="42unit" title='unit' data-type='int' data-ref="42unit" data-ref-filename="42unit">unit</dfn>,</td></tr>
<tr><th id="507">507</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> * <dfn class="local col3 decl" id="43peer" title='peer' data-type='struct peer *' data-ref="43peer" data-ref-filename="43peer">peer</dfn></td></tr>
<tr><th id="508">508</th><td>	)</td></tr>
<tr><th id="509">509</th><td>{</td></tr>
<tr><th id="510">510</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col4 decl" id="44pp" title='pp' data-type='struct refclockproc *const' data-ref="44pp" data-ref-filename="44pp">pp</dfn> = <a class="local col3 ref" href="#43peer" title='peer' data-ref="43peer" data-ref-filename="43peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="511">511</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>	    * <em>const</em> <dfn class="local col5 decl" id="45up" title='up' data-type='nmea_unit *const' data-ref="45up" data-ref-filename="45up">up</dfn> = (<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a> *)<a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a>;</td></tr>
<tr><th id="512">512</th><td></td></tr>
<tr><th id="513">513</th><td>	<a class="macro" href="../include/ntp_types.h.html#63" title="((void)(unit))" data-ref="_M/UNUSED_ARG">UNUSED_ARG</a>(<a class="local col2 ref" href="#42unit" title='unit' data-ref="42unit" data-ref-filename="42unit">unit</a>);</td></tr>
<tr><th id="514">514</th><td></td></tr>
<tr><th id="515">515</th><td>	<b>if</b> (<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="516">516</th><td><u>#<span data-ppcond="516">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="517">517</th><td>		<b>if</b> (<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='r' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a>)</td></tr>
<tr><th id="518">518</th><td>			<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#time_pps_destroy" title='time_pps_destroy' data-ref="time_pps_destroy" data-ref-filename="time_pps_destroy">time_pps_destroy</a>(<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='m' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>.<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::handle" title='refclock_atom::handle' data-ref="refclock_atom::handle" data-ref-filename="refclock_atom..handle">handle</a>);</td></tr>
<tr><th id="519">519</th><td>		<b>if</b> (<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-use='r' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</a> &amp;&amp; <a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> != <a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>)</td></tr>
<tr><th id="520">520</th><td>			<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/unistd.h.html#close" title='close' data-ref="close" data-ref-filename="close">close</a>(<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a>);</td></tr>
<tr><th id="521">521</th><td><u>#<span data-ppcond="516">endif</span></u></td></tr>
<tr><th id="522">522</th><td>		<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#free" title='free' data-ref="free" data-ref-filename="free">free</a>(<a class="local col5 ref" href="#45up" title='up' data-ref="45up" data-ref-filename="45up">up</a>);</td></tr>
<tr><th id="523">523</th><td>	}</td></tr>
<tr><th id="524">524</th><td>	<a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a> = (<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#146" title="__caddr_t" data-ref="_M/caddr_t">caddr_t</a>)<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="525">525</th><td>	<b>if</b> (-<var>1</var> != <a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>)</td></tr>
<tr><th id="526">526</th><td>		<a class="ref fn" href="../include/ntp_refclock.h.html#io_closeclock" title='io_closeclock' data-ref="io_closeclock" data-ref-filename="io_closeclock">io_closeclock</a>(&amp;<a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>);</td></tr>
<tr><th id="527">527</th><td>	<a class="local col4 ref" href="#44pp" title='pp' data-ref="44pp" data-ref-filename="44pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a> = -<var>1</var>;</td></tr>
<tr><th id="528">528</th><td>}</td></tr>
<tr><th id="529">529</th><td></td></tr>
<tr><th id="530">530</th><td><i>/*</i></td></tr>
<tr><th id="531">531</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="532">532</th><td><i> * nmea_control - configure fudge params</i></td></tr>
<tr><th id="533">533</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="534">534</th><td><i> */</i></td></tr>
<tr><th id="535">535</th><td><u>#<span data-ppcond="535">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="536">536</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="537">537</th><td><dfn class="tu decl def fn" id="nmea_control" title='nmea_control' data-type='void nmea_control(int unit, const struct refclockstat * in_st, struct refclockstat * out_st, struct peer * peer)' data-ref="nmea_control" data-ref-filename="nmea_control">nmea_control</dfn>(</td></tr>
<tr><th id="538">538</th><td>	<em>int</em>                         <dfn class="local col6 decl" id="46unit" title='unit' data-type='int' data-ref="46unit" data-ref-filename="46unit">unit</dfn>,</td></tr>
<tr><th id="539">539</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockstat" title='refclockstat' data-ref="refclockstat" data-ref-filename="refclockstat">refclockstat</a> * <dfn class="local col7 decl" id="47in_st" title='in_st' data-type='const struct refclockstat *' data-ref="47in_st" data-ref-filename="47in_st">in_st</dfn>,</td></tr>
<tr><th id="540">540</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockstat" title='refclockstat' data-ref="refclockstat" data-ref-filename="refclockstat">refclockstat</a>       * <dfn class="local col8 decl" id="48out_st" title='out_st' data-type='struct refclockstat *' data-ref="48out_st" data-ref-filename="48out_st">out_st</dfn>,</td></tr>
<tr><th id="541">541</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a>               * <dfn class="local col9 decl" id="49peer" title='peer' data-type='struct peer *' data-ref="49peer" data-ref-filename="49peer">peer</dfn></td></tr>
<tr><th id="542">542</th><td>	)</td></tr>
<tr><th id="543">543</th><td>{</td></tr>
<tr><th id="544">544</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col0 decl" id="50pp" title='pp' data-type='struct refclockproc *const' data-ref="50pp" data-ref-filename="50pp">pp</dfn> = <a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="545">545</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>	    * <em>const</em> <dfn class="local col1 decl" id="51up" title='up' data-type='nmea_unit *const' data-ref="51up" data-ref-filename="51up">up</dfn> = (<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a> *)<a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a>;</td></tr>
<tr><th id="546">546</th><td></td></tr>
<tr><th id="547">547</th><td>	<em>char</em>   <dfn class="local col2 decl" id="52device" title='device' data-type='char [32]' data-ref="52device" data-ref-filename="52device">device</dfn>[<var>32</var>];</td></tr>
<tr><th id="548">548</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col3 decl" id="53devlen" title='devlen' data-type='size_t' data-ref="53devlen" data-ref-filename="53devlen">devlen</dfn>;</td></tr>
<tr><th id="549">549</th><td>	</td></tr>
<tr><th id="550">550</th><td>	<a class="macro" href="../include/ntp_types.h.html#63" title="((void)(in_st))" data-ref="_M/UNUSED_ARG">UNUSED_ARG</a>(<a class="local col7 ref" href="#47in_st" title='in_st' data-ref="47in_st" data-ref-filename="47in_st">in_st</a>);</td></tr>
<tr><th id="551">551</th><td>	<a class="macro" href="../include/ntp_types.h.html#63" title="((void)(out_st))" data-ref="_M/UNUSED_ARG">UNUSED_ARG</a>(<a class="local col8 ref" href="#48out_st" title='out_st' data-ref="48out_st" data-ref-filename="48out_st">out_st</a>);</td></tr>
<tr><th id="552">552</th><td></td></tr>
<tr><th id="553">553</th><td>	<i>/*</i></td></tr>
<tr><th id="554">554</th><td><i>	 * PPS control</i></td></tr>
<tr><th id="555">555</th><td><i>	 *</i></td></tr>
<tr><th id="556">556</th><td><i>	 * If /dev/gpspps$UNIT can be opened that will be used for</i></td></tr>
<tr><th id="557">557</th><td><i>	 * PPSAPI.  Otherwise, the GPS serial device /dev/gps$UNIT</i></td></tr>
<tr><th id="558">558</th><td><i>	 * already opened is used for PPSAPI as well. (This might not</i></td></tr>
<tr><th id="559">559</th><td><i>	 * work, in which case the PPS API remains unavailable...)</i></td></tr>
<tr><th id="560">560</th><td><i>	 */</i></td></tr>
<tr><th id="561">561</th><td></td></tr>
<tr><th id="562">562</th><td>	<i>/* Light up the PPSAPI interface if not yet attempted. */</i></td></tr>
<tr><th id="563">563</th><td>	<b>if</b> ((<a class="macro" href="../include/ntp_refclock.h.html#50" title="0x1" data-ref="_M/CLK_FLAG1">CLK_FLAG1</a> &amp; <a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>) &amp;&amp; !<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-use='r' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</a>) {</td></tr>
<tr><th id="564">564</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-use='w' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</a> = <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="565">565</th><td>		<a class="local col3 ref" href="#53devlen" title='devlen' data-ref="53devlen" data-ref-filename="53devlen">devlen</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#snprintf" title='snprintf' data-ref="snprintf" data-ref-filename="snprintf">snprintf</a>(<a class="local col2 ref" href="#52device" title='device' data-ref="52device" data-ref-filename="52device">device</a>, <b>sizeof</b>(<a class="local col2 ref" href="#52device" title='device' data-ref="52device" data-ref-filename="52device">device</a>), <a class="macro" href="#152" title="&quot;/dev/gpspps%d&quot;" data-ref="_M/PPSDEV">PPSDEV</a>, <a class="local col6 ref" href="#46unit" title='unit' data-ref="46unit" data-ref-filename="46unit">unit</a>);</td></tr>
<tr><th id="566">566</th><td>		<b>if</b> (<a class="local col3 ref" href="#53devlen" title='devlen' data-ref="53devlen" data-ref-filename="53devlen">devlen</a> &lt; <b>sizeof</b>(<a class="local col2 ref" href="#52device" title='device' data-ref="52device" data-ref-filename="52device">device</a>)) {</td></tr>
<tr><th id="567">567</th><td>			<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='w' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/fcntl.h.html#open" title='open' data-ref="open" data-ref-filename="open">open</a>(<a class="local col2 ref" href="#52device" title='device' data-ref="52device" data-ref-filename="52device">device</a>, <a class="macro" href="#168" title="(0x00000002 | 0x00008000 | 0x00000004)" data-ref="_M/PPSOPENMODE">PPSOPENMODE</a>,</td></tr>
<tr><th id="568">568</th><td>					     <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/stat.h.html#118" title="0000400" data-ref="_M/S_IRUSR">S_IRUSR</a> | <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/stat.h.html#119" title="0000200" data-ref="_M/S_IWUSR">S_IWUSR</a>);</td></tr>
<tr><th id="569">569</th><td>		} <b>else</b> {</td></tr>
<tr><th id="570">570</th><td>			<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='w' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> = -<var>1</var>;</td></tr>
<tr><th id="571">571</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#msyslog" title='msyslog' data-ref="msyslog" data-ref-filename="msyslog">msyslog</a>(<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#55" title="3" data-ref="_M/LOG_ERR">LOG_ERR</a>, <q>"%s PPS device name too long"</q>,</td></tr>
<tr><th id="572">572</th><td>				<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>));</td></tr>
<tr><th id="573">573</th><td>		}</td></tr>
<tr><th id="574">574</th><td>		<b>if</b> (-<var>1</var> == <a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a>)</td></tr>
<tr><th id="575">575</th><td>			<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='w' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> = <a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>;	</td></tr>
<tr><th id="576">576</th><td>		<b>if</b> (<a class="ref fn" href="../include/refclock_atom.h.html#refclock_ppsapi" title='refclock_ppsapi' data-ref="refclock_ppsapi" data-ref-filename="refclock_ppsapi">refclock_ppsapi</a>(<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a>, &amp;<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='a' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>)) {</td></tr>
<tr><th id="577">577</th><td>			<i>/* use the PPS API for our own purposes now. */</i></td></tr>
<tr><th id="578">578</th><td>			<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='w' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a> = <a class="ref fn" href="../include/refclock_atom.h.html#refclock_params" title='refclock_params' data-ref="refclock_params" data-ref-filename="refclock_params">refclock_params</a>(</td></tr>
<tr><th id="579">579</th><td>				<a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>, &amp;<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='a' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>);</td></tr>
<tr><th id="580">580</th><td>			<b>if</b> (!<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='r' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a>) {</td></tr>
<tr><th id="581">581</th><td>				<i>/* failed to configure, drop PPS unit */</i></td></tr>
<tr><th id="582">582</th><td>				<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#time_pps_destroy" title='time_pps_destroy' data-ref="time_pps_destroy" data-ref-filename="time_pps_destroy">time_pps_destroy</a>(<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='m' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>.<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::handle" title='refclock_atom::handle' data-ref="refclock_atom::handle" data-ref-filename="refclock_atom..handle">handle</a>);</td></tr>
<tr><th id="583">583</th><td>				<a class="ref fn" href="../include/ntp_stdlib.h.html#msyslog" title='msyslog' data-ref="msyslog" data-ref-filename="msyslog">msyslog</a>(<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#56" title="4" data-ref="_M/LOG_WARNING">LOG_WARNING</a>,</td></tr>
<tr><th id="584">584</th><td>					<q>"%s set PPSAPI params fails"</q>,</td></tr>
<tr><th id="585">585</th><td>					<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>));				</td></tr>
<tr><th id="586">586</th><td>			}</td></tr>
<tr><th id="587">587</th><td>			<i>/* note: the PPS I/O handle remains valid until</i></td></tr>
<tr><th id="588">588</th><td><i>			 * flag1 is cleared or the clock is shut down. </i></td></tr>
<tr><th id="589">589</th><td><i>			 */</i></td></tr>
<tr><th id="590">590</th><td>		} <b>else</b> {</td></tr>
<tr><th id="591">591</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#msyslog" title='msyslog' data-ref="msyslog" data-ref-filename="msyslog">msyslog</a>(<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#56" title="4" data-ref="_M/LOG_WARNING">LOG_WARNING</a>,</td></tr>
<tr><th id="592">592</th><td>				<q>"%s flag1 1 but PPSAPI fails"</q>,</td></tr>
<tr><th id="593">593</th><td>				<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>));</td></tr>
<tr><th id="594">594</th><td>		}</td></tr>
<tr><th id="595">595</th><td>	}</td></tr>
<tr><th id="596">596</th><td></td></tr>
<tr><th id="597">597</th><td>	<i>/* shut down PPS API if activated */</i></td></tr>
<tr><th id="598">598</th><td>	<b>if</b> (!(<a class="macro" href="../include/ntp_refclock.h.html#50" title="0x1" data-ref="_M/CLK_FLAG1">CLK_FLAG1</a> &amp; <a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>) &amp;&amp; <a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-use='r' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</a>) {</td></tr>
<tr><th id="599">599</th><td>		<i>/* shutdown PPS API */</i></td></tr>
<tr><th id="600">600</th><td>		<b>if</b> (<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='r' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a>)</td></tr>
<tr><th id="601">601</th><td>			<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#time_pps_destroy" title='time_pps_destroy' data-ref="time_pps_destroy" data-ref-filename="time_pps_destroy">time_pps_destroy</a>(<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='m' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>.<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::handle" title='refclock_atom::handle' data-ref="refclock_atom::handle" data-ref-filename="refclock_atom..handle">handle</a>);</td></tr>
<tr><th id="602">602</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='m' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>.<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::handle" title='refclock_atom::handle' data-ref="refclock_atom::handle" data-ref-filename="refclock_atom..handle">handle</a> = <var>0</var>;</td></tr>
<tr><th id="603">603</th><td>		<i>/* close/drop PPS fd */</i></td></tr>
<tr><th id="604">604</th><td>		<b>if</b> (<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> != <a class="local col0 ref" href="#50pp" title='pp' data-ref="50pp" data-ref-filename="50pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::io" title='refclockproc::io' data-ref="refclockproc::io" data-ref-filename="refclockproc..io">io</a>.<a class="ref field" href="../include/ntp_refclock.h.html#refclockio::fd" title='refclockio::fd' data-ref="refclockio::fd" data-ref-filename="refclockio..fd">fd</a>)</td></tr>
<tr><th id="605">605</th><td>			<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/unistd.h.html#close" title='close' data-ref="close" data-ref-filename="close">close</a>(<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='r' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a>);</td></tr>
<tr><th id="606">606</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_fd" title='(anonymous struct)::ppsapi_fd' data-use='w' data-ref="(anonymous)::ppsapi_fd" data-ref-filename="(anonymous)..ppsapi_fd">ppsapi_fd</a> = -<var>1</var>;</td></tr>
<tr><th id="607">607</th><td></td></tr>
<tr><th id="608">608</th><td>		<i>/* clear markers and peer items */</i></td></tr>
<tr><th id="609">609</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-use='w' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</a>  = <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="610">610</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='w' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a>   = <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="611">611</th><td>		<a class="local col1 ref" href="#51up" title='up' data-ref="51up" data-ref-filename="51up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_tried" title='(anonymous struct)::ppsapi_tried' data-use='w' data-ref="(anonymous)::ppsapi_tried" data-ref-filename="(anonymous)..ppsapi_tried">ppsapi_tried</a> = <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="612">612</th><td></td></tr>
<tr><th id="613">613</th><td>		<a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::flags" title='peer::flags' data-ref="peer::flags" data-ref-filename="peer..flags">flags</a> &amp;= ~<a class="macro" href="../include/ntp.h.html#459" title="0x0080" data-ref="_M/FLAG_PPS">FLAG_PPS</a>;</td></tr>
<tr><th id="614">614</th><td>		<a class="local col9 ref" href="#49peer" title='peer' data-ref="49peer" data-ref-filename="49peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::precision" title='peer::precision' data-ref="peer::precision" data-ref-filename="peer..precision">precision</a> = <a class="macro" href="#154" title="(-9)" data-ref="_M/PRECISION">PRECISION</a>;</td></tr>
<tr><th id="615">615</th><td>	}</td></tr>
<tr><th id="616">616</th><td>}</td></tr>
<tr><th id="617">617</th><td><u>#<span data-ppcond="535">endif</span>	/* HAVE_PPSAPI */</u></td></tr>
<tr><th id="618">618</th><td></td></tr>
<tr><th id="619">619</th><td><i  data-doc="nmea_timer">/*</i></td></tr>
<tr><th id="620">620</th><td><i  data-doc="nmea_timer"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="621">621</th><td><i  data-doc="nmea_timer"> * nmea_timer - called once per second</i></td></tr>
<tr><th id="622">622</th><td><i  data-doc="nmea_timer"> *		this only polls (older?) Oncore devices now</i></td></tr>
<tr><th id="623">623</th><td><i  data-doc="nmea_timer"> *</i></td></tr>
<tr><th id="624">624</th><td><i  data-doc="nmea_timer"> * Usually 'nmea_receive()' can get a timestamp every second, but at</i></td></tr>
<tr><th id="625">625</th><td><i  data-doc="nmea_timer"> * least one Motorola unit needs prompting each time. Doing so in</i></td></tr>
<tr><th id="626">626</th><td><i  data-doc="nmea_timer"> * 'nmea_poll()' gives only one sample per poll cycle, which actually</i></td></tr>
<tr><th id="627">627</th><td><i  data-doc="nmea_timer"> * defeats the purpose of the median filter. Polling once per second</i></td></tr>
<tr><th id="628">628</th><td><i  data-doc="nmea_timer"> * seems a much better idea.</i></td></tr>
<tr><th id="629">629</th><td><i  data-doc="nmea_timer"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="630">630</th><td><i  data-doc="nmea_timer"> */</i></td></tr>
<tr><th id="631">631</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="632">632</th><td><dfn class="tu decl def fn" id="nmea_timer" title='nmea_timer' data-type='void nmea_timer(int unit, struct peer * peer)' data-ref="nmea_timer" data-ref-filename="nmea_timer">nmea_timer</dfn>(</td></tr>
<tr><th id="633">633</th><td>	<em>int</em>	      <dfn class="local col4 decl" id="54unit" title='unit' data-type='int' data-ref="54unit" data-ref-filename="54unit">unit</dfn>,</td></tr>
<tr><th id="634">634</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> * <dfn class="local col5 decl" id="55peer" title='peer' data-type='struct peer *' data-ref="55peer" data-ref-filename="55peer">peer</dfn></td></tr>
<tr><th id="635">635</th><td>	)</td></tr>
<tr><th id="636">636</th><td>{</td></tr>
<tr><th id="637">637</th><td><u>#<span data-ppcond="637">if</span> <a class="macro" href="#29" title="0" data-ref="_M/NMEA_WRITE_SUPPORT">NMEA_WRITE_SUPPORT</a></u></td></tr>
<tr><th id="638">638</th><td>    </td></tr>
<tr><th id="639">639</th><td>	<b>struct</b> refclockproc * <em>const</em> pp = peer-&gt;procptr;</td></tr>
<tr><th id="640">640</th><td></td></tr>
<tr><th id="641">641</th><td>	UNUSED_ARG(unit);</td></tr>
<tr><th id="642">642</th><td></td></tr>
<tr><th id="643">643</th><td>	<b>if</b> (-<var>1</var> != pp-&gt;io.fd) <i>/* any mode bits to evaluate here? */</i></td></tr>
<tr><th id="644">644</th><td>		gps_send(pp-&gt;io.fd, <q>"$PMOTG,RMC,0000*1D\r\n"</q>, peer);</td></tr>
<tr><th id="645">645</th><td><u>#<span data-ppcond="637">else</span></u></td></tr>
<tr><th id="646">646</th><td>	</td></tr>
<tr><th id="647">647</th><td>	<a class="macro" href="../include/ntp_types.h.html#63" title="((void)(unit))" data-ref="_M/UNUSED_ARG">UNUSED_ARG</a>(<a class="local col4 ref" href="#54unit" title='unit' data-ref="54unit" data-ref-filename="54unit">unit</a>);</td></tr>
<tr><th id="648">648</th><td>	<a class="macro" href="../include/ntp_types.h.html#63" title="((void)(peer))" data-ref="_M/UNUSED_ARG">UNUSED_ARG</a>(<a class="local col5 ref" href="#55peer" title='peer' data-ref="55peer" data-ref-filename="55peer">peer</a>);</td></tr>
<tr><th id="649">649</th><td>	</td></tr>
<tr><th id="650">650</th><td><u>#<span data-ppcond="637">endif</span> /* NMEA_WRITE_SUPPORT */</u></td></tr>
<tr><th id="651">651</th><td>}</td></tr>
<tr><th id="652">652</th><td></td></tr>
<tr><th id="653">653</th><td><u>#<span data-ppcond="653">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="654">654</th><td><i>/*</i></td></tr>
<tr><th id="655">655</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="656">656</th><td><i> * refclock_ppsrelate(...) -- correlate with PPS edge</i></td></tr>
<tr><th id="657">657</th><td><i> *</i></td></tr>
<tr><th id="658">658</th><td><i> * This function is used to correlate a receive time stamp and a</i></td></tr>
<tr><th id="659">659</th><td><i> * reference time with a PPS edge time stamp. It applies the necessary</i></td></tr>
<tr><th id="660">660</th><td><i> * fudges (fudge1 for PPS, fudge2 for receive time) and then tries to</i></td></tr>
<tr><th id="661">661</th><td><i> * move the receive time stamp to the corresponding edge. This can warp</i></td></tr>
<tr><th id="662">662</th><td><i> * into future, if a transmission delay of more than 500ms is not</i></td></tr>
<tr><th id="663">663</th><td><i> * compensated with a corresponding fudge time2 value, because then the</i></td></tr>
<tr><th id="664">664</th><td><i> * next PPS edge is nearer than the last. (Similiar to what the PPS ATOM</i></td></tr>
<tr><th id="665">665</th><td><i> * driver does, but we deal with full time stamps here, not just phase</i></td></tr>
<tr><th id="666">666</th><td><i> * shift information.) Likewise, a negative fudge time2 value must be</i></td></tr>
<tr><th id="667">667</th><td><i> * used if the reference time stamp correlates with the *following* PPS</i></td></tr>
<tr><th id="668">668</th><td><i> * pulse.</i></td></tr>
<tr><th id="669">669</th><td><i> *</i></td></tr>
<tr><th id="670">670</th><td><i> * Note that the receive time fudge value only needs to move the receive</i></td></tr>
<tr><th id="671">671</th><td><i> * stamp near a PPS edge but that close proximity is not required;</i></td></tr>
<tr><th id="672">672</th><td><i> * +/-100ms precision should be enough. But since the fudge value will</i></td></tr>
<tr><th id="673">673</th><td><i> * probably also be used to compensate the transmission delay when no</i></td></tr>
<tr><th id="674">674</th><td><i> * PPS edge can be related to the time stamp, it's best to get it as</i></td></tr>
<tr><th id="675">675</th><td><i> * close as possible.</i></td></tr>
<tr><th id="676">676</th><td><i> *</i></td></tr>
<tr><th id="677">677</th><td><i> * It should also be noted that the typical use case is matching to the</i></td></tr>
<tr><th id="678">678</th><td><i> * preceeding edge, as most units relate their sentences to the current</i></td></tr>
<tr><th id="679">679</th><td><i> * second.</i></td></tr>
<tr><th id="680">680</th><td><i> *</i></td></tr>
<tr><th id="681">681</th><td><i> * The function returns PPS_RELATE_NONE (0) if no PPS edge correlation</i></td></tr>
<tr><th id="682">682</th><td><i> * can be fixed; PPS_RELATE_EDGE (1) when a PPS edge could be fixed, but</i></td></tr>
<tr><th id="683">683</th><td><i> * the distance to the reference time stamp is too big (exceeds</i></td></tr>
<tr><th id="684">684</th><td><i> * +/-400ms) and the ATOM driver PLL cannot be used to fix the phase;</i></td></tr>
<tr><th id="685">685</th><td><i> * and PPS_RELATE_PHASE (2) when the ATOM driver PLL code can be used.</i></td></tr>
<tr><th id="686">686</th><td><i> *</i></td></tr>
<tr><th id="687">687</th><td><i> * On output, the receive time stamp is replaced with the corresponding</i></td></tr>
<tr><th id="688">688</th><td><i> * PPS edge time if a fix could be made; the PPS fudge is updated to</i></td></tr>
<tr><th id="689">689</th><td><i> * reflect the proper fudge time to apply. (This implies that</i></td></tr>
<tr><th id="690">690</th><td><i> * 'refclock_process_offset()' must be used!)</i></td></tr>
<tr><th id="691">691</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="692">692</th><td><i> */</i></td></tr>
<tr><th id="693">693</th><td><u>#define <dfn class="macro" id="_M/PPS_RELATE_NONE" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</dfn>	 0	/* no pps correlation possible	  */</u></td></tr>
<tr><th id="694">694</th><td><u>#define <dfn class="macro" id="_M/PPS_RELATE_EDGE" data-ref="_M/PPS_RELATE_EDGE">PPS_RELATE_EDGE</dfn>	 1	/* recv time fixed, no phase lock */</u></td></tr>
<tr><th id="695">695</th><td><u>#define <dfn class="macro" id="_M/PPS_RELATE_PHASE" data-ref="_M/PPS_RELATE_PHASE">PPS_RELATE_PHASE</dfn> 2	/* recv time fixed, phase lock ok */</u></td></tr>
<tr><th id="696">696</th><td></td></tr>
<tr><th id="697">697</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="698">698</th><td><dfn class="tu decl def fn" id="refclock_ppsrelate" title='refclock_ppsrelate' data-type='int refclock_ppsrelate(const struct refclockproc * pp, const struct refclock_atom * ap, const l_fp * reftime, l_fp * rd_stamp, double pp_fudge, double * rd_fudge)' data-ref="refclock_ppsrelate" data-ref-filename="refclock_ppsrelate">refclock_ppsrelate</dfn>(</td></tr>
<tr><th id="699">699</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a>  * <dfn class="local col6 decl" id="56pp" title='pp' data-type='const struct refclockproc *' data-ref="56pp" data-ref-filename="56pp">pp</dfn>	    ,	<i>/* for sanity	  */</i></td></tr>
<tr><th id="700">700</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/refclock_atom.h.html#refclock_atom" title='refclock_atom' data-ref="refclock_atom" data-ref-filename="refclock_atom">refclock_atom</a> * <dfn class="local col7 decl" id="57ap" title='ap' data-type='const struct refclock_atom *' data-ref="57ap" data-ref-filename="57ap">ap</dfn>	    ,	<i>/* for PPS io	  */</i></td></tr>
<tr><th id="701">701</th><td>	<em>const</em> <a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>		   * <dfn class="local col8 decl" id="58reftime" title='reftime' data-type='const l_fp *' data-ref="58reftime" data-ref-filename="58reftime">reftime</dfn> ,</td></tr>
<tr><th id="702">702</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>			   * <dfn class="local col9 decl" id="59rd_stamp" title='rd_stamp' data-type='l_fp *' data-ref="59rd_stamp" data-ref-filename="59rd_stamp">rd_stamp</dfn>,	<i>/* i/o read stamp */</i></td></tr>
<tr><th id="703">703</th><td>	<em>double</em>			     <dfn class="local col0 decl" id="60pp_fudge" title='pp_fudge' data-type='double' data-ref="60pp_fudge" data-ref-filename="60pp_fudge">pp_fudge</dfn>,	<i>/* pps fudge	  */</i></td></tr>
<tr><th id="704">704</th><td>	<em>double</em>			   * <dfn class="local col1 decl" id="61rd_fudge" title='rd_fudge' data-type='double *' data-ref="61rd_fudge" data-ref-filename="61rd_fudge">rd_fudge</dfn>	<i>/* i/o read fudge */</i></td></tr>
<tr><th id="705">705</th><td>	)</td></tr>
<tr><th id="706">706</th><td>{</td></tr>
<tr><th id="707">707</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#pps_info_t" title='pps_info_t' data-type='struct pps_info_t' data-ref="pps_info_t" data-ref-filename="pps_info_t">pps_info_t</a>	<dfn class="local col2 decl" id="62pps_info" title='pps_info' data-type='pps_info_t' data-ref="62pps_info" data-ref-filename="62pps_info">pps_info</dfn>;</td></tr>
<tr><th id="708">708</th><td>	<b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> <dfn class="local col3 decl" id="63timeout" title='timeout' data-type='struct timespec' data-ref="63timeout" data-ref-filename="63timeout">timeout</dfn>;</td></tr>
<tr><th id="709">709</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>		<dfn class="local col4 decl" id="64pp_stamp" title='pp_stamp' data-type='l_fp' data-ref="64pp_stamp" data-ref-filename="64pp_stamp">pp_stamp</dfn>, <dfn class="local col5 decl" id="65pp_delta" title='pp_delta' data-type='l_fp' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</dfn>;</td></tr>
<tr><th id="710">710</th><td>	<em>double</em>		<dfn class="local col6 decl" id="66delta" title='delta' data-type='double' data-ref="66delta" data-ref-filename="66delta">delta</dfn>, <dfn class="local col7 decl" id="67idelta" title='idelta' data-type='double' data-ref="67idelta" data-ref-filename="67idelta">idelta</dfn>;</td></tr>
<tr><th id="711">711</th><td></td></tr>
<tr><th id="712">712</th><td>	<b>if</b> (<a class="local col6 ref" href="#56pp" title='pp' data-ref="56pp" data-ref-filename="56pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> == <a class="macro" href="../include/ntp.h.html#417" title="0x3" data-ref="_M/LEAP_NOTINSYNC">LEAP_NOTINSYNC</a>)</td></tr>
<tr><th id="713">713</th><td>		<b>return</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>; <i>/* clock is insane, no chance */</i></td></tr>
<tr><th id="714">714</th><td></td></tr>
<tr><th id="715">715</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(timeout), sizeof(timeout))" data-ref="_M/ZERO">ZERO</a>(<a class="local col3 ref" href="#63timeout" title='timeout' data-ref="63timeout" data-ref-filename="63timeout">timeout</a>);</td></tr>
<tr><th id="716">716</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(pps_info), sizeof(pps_info))" data-ref="_M/ZERO">ZERO</a>(<a class="local col2 ref" href="#62pps_info" title='pps_info' data-ref="62pps_info" data-ref-filename="62pps_info">pps_info</a>);</td></tr>
<tr><th id="717">717</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#time_pps_fetch" title='time_pps_fetch' data-ref="time_pps_fetch" data-ref-filename="time_pps_fetch">time_pps_fetch</a>(<a class="local col7 ref" href="#57ap" title='ap' data-ref="57ap" data-ref-filename="57ap">ap</a>-&gt;<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::handle" title='refclock_atom::handle' data-ref="refclock_atom::handle" data-ref-filename="refclock_atom..handle">handle</a>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#111" title="0x1000" data-ref="_M/PPS_TSFMT_TSPEC">PPS_TSFMT_TSPEC</a>,</td></tr>
<tr><th id="718">718</th><td>			   &amp;<a class="local col2 ref" href="#62pps_info" title='pps_info' data-ref="62pps_info" data-ref-filename="62pps_info">pps_info</a>, &amp;<a class="local col3 ref" href="#63timeout" title='timeout' data-ref="63timeout" data-ref-filename="63timeout">timeout</a>) &lt; <var>0</var>)</td></tr>
<tr><th id="719">719</th><td>		<b>return</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>; <i>/* can't get time stamps */</i></td></tr>
<tr><th id="720">720</th><td></td></tr>
<tr><th id="721">721</th><td>	<i>/* get last active PPS edge before receive */</i></td></tr>
<tr><th id="722">722</th><td>	<b>if</b> (<a class="local col7 ref" href="#57ap" title='ap' data-ref="57ap" data-ref-filename="57ap">ap</a>-&gt;<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::pps_params" title='refclock_atom::pps_params' data-ref="refclock_atom::pps_params" data-ref-filename="refclock_atom..pps_params">pps_params</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#(anonymous)::mode" title='(anonymous struct)::mode' data-ref="(anonymous)::mode" data-ref-filename="(anonymous)..mode">mode</a> &amp; <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#93" title="0x01" data-ref="_M/PPS_CAPTUREASSERT">PPS_CAPTUREASSERT</a>)</td></tr>
<tr><th id="723">723</th><td>		<a class="local col3 ref" href="#63timeout" title='timeout' data-ref="63timeout" data-ref-filename="63timeout">timeout</a> = <a class="local col2 ref" href="#62pps_info" title='pps_info' data-ref="62pps_info" data-ref-filename="62pps_info">pps_info</a>.<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#73" title="assert_tu.tspec" data-ref="_M/assert_timestamp">assert_timestamp</a>;</td></tr>
<tr><th id="724">724</th><td>	<b>else</b> <b>if</b> (<a class="local col7 ref" href="#57ap" title='ap' data-ref="57ap" data-ref-filename="57ap">ap</a>-&gt;<a class="ref field" href="../include/refclock_atom.h.html#refclock_atom::pps_params" title='refclock_atom::pps_params' data-ref="refclock_atom::pps_params" data-ref-filename="refclock_atom..pps_params">pps_params</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#(anonymous)::mode" title='(anonymous struct)::mode' data-ref="(anonymous)::mode" data-ref-filename="(anonymous)..mode">mode</a> &amp; <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#94" title="0x02" data-ref="_M/PPS_CAPTURECLEAR">PPS_CAPTURECLEAR</a>)</td></tr>
<tr><th id="725">725</th><td>		<a class="local col3 ref" href="#63timeout" title='timeout' data-ref="63timeout" data-ref-filename="63timeout">timeout</a> = <a class="local col2 ref" href="#62pps_info" title='pps_info' data-ref="62pps_info" data-ref-filename="62pps_info">pps_info</a>.<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timepps.h.html#74" title="clear_tu.tspec" data-ref="_M/clear_timestamp">clear_timestamp</a>;</td></tr>
<tr><th id="726">726</th><td>	<b>else</b></td></tr>
<tr><th id="727">727</th><td>		<b>return</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>; <i>/* WHICH edge, please?!? */</i></td></tr>
<tr><th id="728">728</th><td></td></tr>
<tr><th id="729">729</th><td>	<i>/* get delta between receive time and PPS time */</i></td></tr>
<tr><th id="730">730</th><td>	<a class="local col4 ref" href="#64pp_stamp" title='pp_stamp' data-ref="64pp_stamp" data-ref-filename="64pp_stamp">pp_stamp</a> = <a class="ref fn" href="../include/timespecops.h.html#tspec_stamp_to_lfp" title='tspec_stamp_to_lfp' data-ref="tspec_stamp_to_lfp" data-ref-filename="tspec_stamp_to_lfp">tspec_stamp_to_lfp</a>(<a class="local col3 ref" href="#63timeout" title='timeout' data-ref="63timeout" data-ref-filename="63timeout">timeout</a>);</td></tr>
<tr><th id="731">731</th><td>	<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a> = *<a class="local col9 ref" href="#59rd_stamp" title='rd_stamp' data-ref="59rd_stamp" data-ref-filename="59rd_stamp">rd_stamp</a>;</td></tr>
<tr><th id="732">732</th><td>	<a class="macro" href="../include/ntp_fp.h.html#231" title="do { u_int32 sub_t = ((&amp;pp_delta)-&gt;l_uf); ((&amp;pp_delta)-&gt;l_uf) -= ((&amp;pp_stamp)-&gt;l_uf); ((&amp;pp_delta)-&gt;Ul_i.Xl_ui) -= ((&amp;pp_stamp)-&gt;Ul_i.Xl_ui) + ((u_int32)((&amp;pp_delta)-&gt;l_uf) &gt; sub_t); } while (0)" data-ref="_M/L_SUB">L_SUB</a>(&amp;<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a>, &amp;<a class="local col4 ref" href="#64pp_stamp" title='pp_stamp' data-ref="64pp_stamp" data-ref-filename="64pp_stamp">pp_stamp</a>);</td></tr>
<tr><th id="733">733</th><td>	<a class="macro" href="../include/ntp_fp.h.html#344" title="do { double d_tmp; u_int64 q_tmp; int M_isneg; q_tmp = ((u_int64)((&amp;pp_delta)-&gt;Ul_i.Xl_ui) &lt;&lt; 32) + ((&amp;pp_delta)-&gt;l_uf); M_isneg = ((((&amp;pp_delta)-&gt;Ul_i.Xl_ui) &amp; 0x80000000) != 0); if (M_isneg) { q_tmp = ~q_tmp + 1; } d_tmp = ldexp((double)q_tmp, -32); if (M_isneg) { d_tmp = -d_tmp; } ((delta)) = d_tmp; } while (0)" data-ref="_M/LFPTOD">LFPTOD</a>(&amp;<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a>, <a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>);</td></tr>
<tr><th id="734">734</th><td>	<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a> += <a class="local col0 ref" href="#60pp_fudge" title='pp_fudge' data-ref="60pp_fudge" data-ref-filename="60pp_fudge">pp_fudge</a> - *<a class="local col1 ref" href="#61rd_fudge" title='rd_fudge' data-ref="61rd_fudge" data-ref-filename="61rd_fudge">rd_fudge</a>;</td></tr>
<tr><th id="735">735</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/math.h.html#fabs" title='fabs' data-ref="fabs" data-ref-filename="fabs">fabs</a>(<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>) &gt; <var>1.5</var>)</td></tr>
<tr><th id="736">736</th><td>		<b>return</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>; <i>/* PPS timeout control */</i></td></tr>
<tr><th id="737">737</th><td>	</td></tr>
<tr><th id="738">738</th><td>	<i>/* eventually warp edges, check phase */</i></td></tr>
<tr><th id="739">739</th><td>	<a class="local col7 ref" href="#67idelta" title='idelta' data-ref="67idelta" data-ref-filename="67idelta">idelta</a>	  = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/math.h.html#floor" title='floor' data-ref="floor" data-ref-filename="floor">floor</a>(<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a> + <var>0.5</var>);</td></tr>
<tr><th id="740">740</th><td>	<a class="local col0 ref" href="#60pp_fudge" title='pp_fudge' data-ref="60pp_fudge" data-ref-filename="60pp_fudge">pp_fudge</a> -= <a class="local col7 ref" href="#67idelta" title='idelta' data-ref="67idelta" data-ref-filename="67idelta">idelta</a>;</td></tr>
<tr><th id="741">741</th><td>	<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>	 -= <a class="local col7 ref" href="#67idelta" title='idelta' data-ref="67idelta" data-ref-filename="67idelta">idelta</a>;</td></tr>
<tr><th id="742">742</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/math.h.html#fabs" title='fabs' data-ref="fabs" data-ref-filename="fabs">fabs</a>(<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>) &gt; <var>0.45</var>)</td></tr>
<tr><th id="743">743</th><td>		<b>return</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>; <i>/* dead band control */</i></td></tr>
<tr><th id="744">744</th><td></td></tr>
<tr><th id="745">745</th><td>	<i>/* we actually have a PPS edge to relate with! */</i></td></tr>
<tr><th id="746">746</th><td>	*<a class="local col9 ref" href="#59rd_stamp" title='rd_stamp' data-ref="59rd_stamp" data-ref-filename="59rd_stamp">rd_stamp</a> = <a class="local col4 ref" href="#64pp_stamp" title='pp_stamp' data-ref="64pp_stamp" data-ref-filename="64pp_stamp">pp_stamp</a>;</td></tr>
<tr><th id="747">747</th><td>	*<a class="local col1 ref" href="#61rd_fudge" title='rd_fudge' data-ref="61rd_fudge" data-ref-filename="61rd_fudge">rd_fudge</a> = <a class="local col0 ref" href="#60pp_fudge" title='pp_fudge' data-ref="60pp_fudge" data-ref-filename="60pp_fudge">pp_fudge</a>;</td></tr>
<tr><th id="748">748</th><td></td></tr>
<tr><th id="749">749</th><td>	<i>/* if whole system out-of-sync, do not try to PLL */</i></td></tr>
<tr><th id="750">750</th><td>	<b>if</b> (<a class="ref" href="../include/ntpd.h.html#sys_leap" title='sys_leap' data-ref="sys_leap" data-ref-filename="sys_leap">sys_leap</a> == <a class="macro" href="../include/ntp.h.html#417" title="0x3" data-ref="_M/LEAP_NOTINSYNC">LEAP_NOTINSYNC</a>)</td></tr>
<tr><th id="751">751</th><td>		<b>return</b> <a class="macro" href="#694" title="1" data-ref="_M/PPS_RELATE_EDGE">PPS_RELATE_EDGE</a>; <i>/* cannot PLL with atom code */</i></td></tr>
<tr><th id="752">752</th><td></td></tr>
<tr><th id="753">753</th><td>	<i>/* check against reftime if ATOM PLL can be used */</i></td></tr>
<tr><th id="754">754</th><td>	<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a> = *<a class="local col8 ref" href="#58reftime" title='reftime' data-ref="58reftime" data-ref-filename="58reftime">reftime</a>;</td></tr>
<tr><th id="755">755</th><td>	<a class="macro" href="../include/ntp_fp.h.html#231" title="do { u_int32 sub_t = ((&amp;pp_delta)-&gt;l_uf); ((&amp;pp_delta)-&gt;l_uf) -= ((&amp;pp_stamp)-&gt;l_uf); ((&amp;pp_delta)-&gt;Ul_i.Xl_ui) -= ((&amp;pp_stamp)-&gt;Ul_i.Xl_ui) + ((u_int32)((&amp;pp_delta)-&gt;l_uf) &gt; sub_t); } while (0)" data-ref="_M/L_SUB">L_SUB</a>(&amp;<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a>, &amp;<a class="local col4 ref" href="#64pp_stamp" title='pp_stamp' data-ref="64pp_stamp" data-ref-filename="64pp_stamp">pp_stamp</a>);</td></tr>
<tr><th id="756">756</th><td>	<a class="macro" href="../include/ntp_fp.h.html#344" title="do { double d_tmp; u_int64 q_tmp; int M_isneg; q_tmp = ((u_int64)((&amp;pp_delta)-&gt;Ul_i.Xl_ui) &lt;&lt; 32) + ((&amp;pp_delta)-&gt;l_uf); M_isneg = ((((&amp;pp_delta)-&gt;Ul_i.Xl_ui) &amp; 0x80000000) != 0); if (M_isneg) { q_tmp = ~q_tmp + 1; } d_tmp = ldexp((double)q_tmp, -32); if (M_isneg) { d_tmp = -d_tmp; } ((delta)) = d_tmp; } while (0)" data-ref="_M/LFPTOD">LFPTOD</a>(&amp;<a class="local col5 ref" href="#65pp_delta" title='pp_delta' data-ref="65pp_delta" data-ref-filename="65pp_delta">pp_delta</a>, <a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>);</td></tr>
<tr><th id="757">757</th><td>	<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a> += <a class="local col0 ref" href="#60pp_fudge" title='pp_fudge' data-ref="60pp_fudge" data-ref-filename="60pp_fudge">pp_fudge</a>;</td></tr>
<tr><th id="758">758</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/math.h.html#fabs" title='fabs' data-ref="fabs" data-ref-filename="fabs">fabs</a>(<a class="local col6 ref" href="#66delta" title='delta' data-ref="66delta" data-ref-filename="66delta">delta</a>) &gt; <var>0.45</var>)</td></tr>
<tr><th id="759">759</th><td>		<b>return</b> <a class="macro" href="#694" title="1" data-ref="_M/PPS_RELATE_EDGE">PPS_RELATE_EDGE</a>; <i>/* cannot PLL with atom code */</i></td></tr>
<tr><th id="760">760</th><td></td></tr>
<tr><th id="761">761</th><td>	<i>/* all checks passed, gets an AAA rating here! */</i></td></tr>
<tr><th id="762">762</th><td>	<b>return</b> <a class="macro" href="#695" title="2" data-ref="_M/PPS_RELATE_PHASE">PPS_RELATE_PHASE</a>; <i>/* can PLL with atom code */</i></td></tr>
<tr><th id="763">763</th><td>}</td></tr>
<tr><th id="764">764</th><td><u>#<span data-ppcond="653">endif</span>	/* HAVE_PPSAPI */</u></td></tr>
<tr><th id="765">765</th><td></td></tr>
<tr><th id="766">766</th><td><i  data-doc="nmea_receive">/*</i></td></tr>
<tr><th id="767">767</th><td><i  data-doc="nmea_receive"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="768">768</th><td><i  data-doc="nmea_receive"> * nmea_receive - receive data from the serial interface</i></td></tr>
<tr><th id="769">769</th><td><i  data-doc="nmea_receive"> *</i></td></tr>
<tr><th id="770">770</th><td><i  data-doc="nmea_receive"> * This is the workhorse for NMEA data evaluation:</i></td></tr>
<tr><th id="771">771</th><td><i  data-doc="nmea_receive"> *</i></td></tr>
<tr><th id="772">772</th><td><i  data-doc="nmea_receive"> * + it checks all NMEA data, and rejects sentences that are not valid</i></td></tr>
<tr><th id="773">773</th><td><i  data-doc="nmea_receive"> *   NMEA sentences</i></td></tr>
<tr><th id="774">774</th><td><i  data-doc="nmea_receive"> * + it checks whether a sentence is known and to be used</i></td></tr>
<tr><th id="775">775</th><td><i  data-doc="nmea_receive"> * + it parses the time and date data from the NMEA data string and</i></td></tr>
<tr><th id="776">776</th><td><i  data-doc="nmea_receive"> *   augments the missing bits. (century in dat, whole date, ...)</i></td></tr>
<tr><th id="777">777</th><td><i  data-doc="nmea_receive"> * + it rejects data that is not from the first accepted sentence in a</i></td></tr>
<tr><th id="778">778</th><td><i  data-doc="nmea_receive"> *   burst</i></td></tr>
<tr><th id="779">779</th><td><i  data-doc="nmea_receive"> * + it eventually replaces the receive time with the PPS edge time.</i></td></tr>
<tr><th id="780">780</th><td><i  data-doc="nmea_receive"> * + it feeds the data to the internal processing stages.</i></td></tr>
<tr><th id="781">781</th><td><i  data-doc="nmea_receive"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="782">782</th><td><i  data-doc="nmea_receive"> */</i></td></tr>
<tr><th id="783">783</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="784">784</th><td><dfn class="tu decl def fn" id="nmea_receive" title='nmea_receive' data-type='void nmea_receive(struct recvbuf * rbufp)' data-ref="nmea_receive" data-ref-filename="nmea_receive">nmea_receive</dfn>(</td></tr>
<tr><th id="785">785</th><td>	<b>struct</b> <a class="type" href="../include/recvbuff.h.html#recvbuf" title='recvbuf' data-ref="recvbuf" data-ref-filename="recvbuf">recvbuf</a> * <dfn class="local col8 decl" id="68rbufp" title='rbufp' data-type='struct recvbuf *' data-ref="68rbufp" data-ref-filename="68rbufp">rbufp</dfn></td></tr>
<tr><th id="786">786</th><td>	)</td></tr>
<tr><th id="787">787</th><td>{</td></tr>
<tr><th id="788">788</th><td>	<i>/* declare &amp; init control structure ptrs */</i></td></tr>
<tr><th id="789">789</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a>	    * <em>const</em> <dfn class="local col9 decl" id="69peer" title='peer' data-type='struct peer *const' data-ref="69peer" data-ref-filename="69peer">peer</dfn> = <a class="local col8 ref" href="#68rbufp" title='rbufp' data-ref="68rbufp" data-ref-filename="68rbufp">rbufp</a>-&gt;<a class="macro" href="../include/recvbuff.h.html#61" title="X_from_where.X_recv_peer" data-ref="_M/recv_peer">recv_peer</a>;</td></tr>
<tr><th id="790">790</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col0 decl" id="70pp" title='pp' data-type='struct refclockproc *const' data-ref="70pp" data-ref-filename="70pp">pp</dfn> = <a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="791">791</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>	    * <em>const</em> <dfn class="local col1 decl" id="71up" title='up' data-type='nmea_unit *const' data-ref="71up" data-ref-filename="71up">up</dfn> = (<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>*)<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a>;</td></tr>
<tr><th id="792">792</th><td></td></tr>
<tr><th id="793">793</th><td>	<i>/* Use these variables to hold data until we decide its worth keeping */</i></td></tr>
<tr><th id="794">794</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> <dfn class="local col2 decl" id="72rdata" title='rdata' data-type='nmea_data' data-ref="72rdata" data-ref-filename="72rdata">rdata</dfn>;</td></tr>
<tr><th id="795">795</th><td>	<em>char</em> 	  <dfn class="local col3 decl" id="73rd_lastcode" title='rd_lastcode' data-type='char [128]' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</dfn>[<a class="macro" href="../include/ntp_refclock.h.html#140" title="128" data-ref="_M/BMAX">BMAX</a>];</td></tr>
<tr><th id="796">796</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a> 	  <dfn class="local col4 decl" id="74rd_timestamp" title='rd_timestamp' data-type='l_fp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</dfn>, <dfn class="local col5 decl" id="75rd_reftime" title='rd_reftime' data-type='l_fp' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</dfn>;</td></tr>
<tr><th id="797">797</th><td>	<em>int</em>	  <dfn class="local col6 decl" id="76rd_lencode" title='rd_lencode' data-type='int' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</dfn>;</td></tr>
<tr><th id="798">798</th><td>	<em>double</em>	  <dfn class="local col7 decl" id="77rd_fudge" title='rd_fudge' data-type='double' data-ref="77rd_fudge" data-ref-filename="77rd_fudge">rd_fudge</dfn>;</td></tr>
<tr><th id="799">799</th><td></td></tr>
<tr><th id="800">800</th><td>	<i>/* working stuff */</i></td></tr>
<tr><th id="801">801</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> <dfn class="local col8 decl" id="78date" title='date' data-type='struct calendar' data-ref="78date" data-ref-filename="78date">date</dfn>;	<i>/* to keep &amp; convert the time stamp */</i></td></tr>
<tr><th id="802">802</th><td>	<b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> <dfn class="local col9 decl" id="79tofs" title='tofs' data-type='struct timespec' data-ref="79tofs" data-ref-filename="79tofs">tofs</dfn>;	<i>/* offset to full-second reftime */</i></td></tr>
<tr><th id="803">803</th><td>	<a class="typedef" href="#gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</a>      <dfn class="local col0 decl" id="80gpsw" title='gpsw' data-type='gps_weektm' data-ref="80gpsw" data-ref-filename="80gpsw">gpsw</dfn>;	<i>/* week time storage */</i></td></tr>
<tr><th id="804">804</th><td>	<i>/* results of sentence/date/time parsing */</i></td></tr>
<tr><th id="805">805</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>		<dfn class="local col1 decl" id="81sentence" title='sentence' data-type='u_char' data-ref="81sentence" data-ref-filename="81sentence">sentence</dfn>;	<i>/* sentence tag */</i></td></tr>
<tr><th id="806">806</th><td>	<em>int</em>		<dfn class="local col2 decl" id="82checkres" title='checkres' data-type='int' data-ref="82checkres" data-ref-filename="82checkres">checkres</dfn>;</td></tr>
<tr><th id="807">807</th><td>	<em>char</em> *		<dfn class="local col3 decl" id="83cp" title='cp' data-type='char *' data-ref="83cp" data-ref-filename="83cp">cp</dfn>;</td></tr>
<tr><th id="808">808</th><td>	<em>int</em>		<dfn class="local col4 decl" id="84rc_date" title='rc_date' data-type='int' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</dfn>;</td></tr>
<tr><th id="809">809</th><td>	<em>int</em>		<dfn class="local col5 decl" id="85rc_time" title='rc_time' data-type='int' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</dfn>;</td></tr>
<tr><th id="810">810</th><td></td></tr>
<tr><th id="811">811</th><td>	<i>/* make sure data has defined pristine state */</i></td></tr>
<tr><th id="812">812</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(tofs), sizeof(tofs))" data-ref="_M/ZERO">ZERO</a>(<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>);</td></tr>
<tr><th id="813">813</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(date), sizeof(date))" data-ref="_M/ZERO">ZERO</a>(<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>);</td></tr>
<tr><th id="814">814</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(gpsw), sizeof(gpsw))" data-ref="_M/ZERO">ZERO</a>(<a class="local col0 ref" href="#80gpsw" title='gpsw' data-ref="80gpsw" data-ref-filename="80gpsw">gpsw</a>);</td></tr>
<tr><th id="815">815</th><td></td></tr>
<tr><th id="816">816</th><td>	<i>/* </i></td></tr>
<tr><th id="817">817</th><td><i>	 * Read the timecode and timestamp, then initialise field</i></td></tr>
<tr><th id="818">818</th><td><i>	 * processing. The &lt;CR&gt;&lt;LF&gt; at the NMEA line end is translated</i></td></tr>
<tr><th id="819">819</th><td><i>	 * to &lt;LF&gt;&lt;LF&gt; by the terminal input routines on most systems,</i></td></tr>
<tr><th id="820">820</th><td><i>	 * and this gives us one spurious empty read per record which we</i></td></tr>
<tr><th id="821">821</th><td><i>	 * better ignore silently.</i></td></tr>
<tr><th id="822">822</th><td><i>	 */</i></td></tr>
<tr><th id="823">823</th><td>	<a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a> = <a class="ref fn" href="../include/ntp_refclock.h.html#refclock_gtlin" title='refclock_gtlin' data-ref="refclock_gtlin" data-ref-filename="refclock_gtlin">refclock_gtlin</a>(<a class="local col8 ref" href="#68rbufp" title='rbufp' data-ref="68rbufp" data-ref-filename="68rbufp">rbufp</a>, <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>,</td></tr>
<tr><th id="824">824</th><td>				    <b>sizeof</b>(<a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>), &amp;<a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>);</td></tr>
<tr><th id="825">825</th><td>	<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> = <a class="tu ref fn" href="#field_init" title='field_init' data-use='c' data-ref="field_init" data-ref-filename="field_init">field_init</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>, <a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a>);</td></tr>
<tr><th id="826">826</th><td>	<b>switch</b> (<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a>) {</td></tr>
<tr><th id="827">827</th><td></td></tr>
<tr><th id="828">828</th><td>	<b>case</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>:</td></tr>
<tr><th id="829">829</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s invalid data: &apos;%s&apos;\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), rd_lastcode); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s invalid data: '%s'\n"</q>,</td></tr>
<tr><th id="830">830</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>));</td></tr>
<tr><th id="831">831</th><td>		<a class="ref fn" href="../include/ntp_refclock.h.html#refclock_report" title='refclock_report' data-ref="refclock_report" data-ref-filename="refclock_report">refclock_report</a>(<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>, <a class="macro" href="../include/ntp.h.html#677" title="2" data-ref="_M/CEVNT_BADREPLY">CEVNT_BADREPLY</a>);</td></tr>
<tr><th id="832">832</th><td>		<b>return</b>;</td></tr>
<tr><th id="833">833</th><td></td></tr>
<tr><th id="834">834</th><td>	<b>case</b> <a class="macro" href="#219" title="-1" data-ref="_M/CHECK_EMPTY">CHECK_EMPTY</a>:</td></tr>
<tr><th id="835">835</th><td>		<b>return</b>;</td></tr>
<tr><th id="836">836</th><td></td></tr>
<tr><th id="837">837</th><td>	<b>default</b>:</td></tr>
<tr><th id="838">838</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s gpsread: %d &apos;%s&apos;\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), rd_lencode, rd_lastcode); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s gpsread: %d '%s'\n"</q>,</td></tr>
<tr><th id="839">839</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a>,</td></tr>
<tr><th id="840">840</th><td>			<a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>));</td></tr>
<tr><th id="841">841</th><td>		<b>break</b>;</td></tr>
<tr><th id="842">842</th><td>	}</td></tr>
<tr><th id="843">843</th><td>	<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::total" title='(anonymous struct)::(anonymous struct)::total' data-use='w' data-ref="(anonymousstruct)::(anonymous)::total" data-ref-filename="(anonymousstruct)..(anonymous)..total">total</a>++;</td></tr>
<tr><th id="844">844</th><td></td></tr>
<tr><th id="845">845</th><td>	<i>/* </i></td></tr>
<tr><th id="846">846</th><td><i>	 * --&gt; below this point we have a valid NMEA sentence &lt;--</i></td></tr>
<tr><th id="847">847</th><td><i>	 *</i></td></tr>
<tr><th id="848">848</th><td><i>	 * Check sentence name. Skip first 2 chars (talker ID) in most</i></td></tr>
<tr><th id="849">849</th><td><i>	 * cases, to allow for $GLGGA and $GPGGA etc. Since the name</i></td></tr>
<tr><th id="850">850</th><td><i>	 * field has at least 5 chars we can simply shift the field</i></td></tr>
<tr><th id="851">851</th><td><i>	 * start.</i></td></tr>
<tr><th id="852">852</th><td><i>	 */</i></td></tr>
<tr><th id="853">853</th><td>	<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> = <a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>0</var>);</td></tr>
<tr><th id="854">854</th><td>	<b>if</b>      (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> + <var>2</var>, <q>"RMC,"</q>, <var>4</var>) == <var>0</var>)</td></tr>
<tr><th id="855">855</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#171" title="0" data-ref="_M/NMEA_GPRMC">NMEA_GPRMC</a>;</td></tr>
<tr><th id="856">856</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> + <var>2</var>, <q>"GGA,"</q>, <var>4</var>) == <var>0</var>)</td></tr>
<tr><th id="857">857</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#172" title="1" data-ref="_M/NMEA_GPGGA">NMEA_GPGGA</a>;</td></tr>
<tr><th id="858">858</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> + <var>2</var>, <q>"GLL,"</q>, <var>4</var>) == <var>0</var>)</td></tr>
<tr><th id="859">859</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#173" title="2" data-ref="_M/NMEA_GPGLL">NMEA_GPGLL</a>;</td></tr>
<tr><th id="860">860</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> + <var>2</var>, <q>"ZDA,"</q>, <var>4</var>) == <var>0</var>)</td></tr>
<tr><th id="861">861</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#174" title="3" data-ref="_M/NMEA_GPZDA">NMEA_GPZDA</a>;</td></tr>
<tr><th id="862">862</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a> + <var>2</var>, <q>"ZDG,"</q>, <var>4</var>) == <var>0</var>)</td></tr>
<tr><th id="863">863</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#184" title="4" data-ref="_M/NMEA_GPZDG">NMEA_GPZDG</a>;</td></tr>
<tr><th id="864">864</th><td>	<b>else</b> <b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#83cp" title='cp' data-ref="83cp" data-ref-filename="83cp">cp</a>,   <q>"PGRMF,"</q>, <var>6</var>) == <var>0</var>) </td></tr>
<tr><th id="865">865</th><td>		<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> = <a class="macro" href="#185" title="5" data-ref="_M/NMEA_PGRMF">NMEA_PGRMF</a>;</td></tr>
<tr><th id="866">866</th><td>	<b>else</b></td></tr>
<tr><th id="867">867</th><td>		<b>return</b>;	<i>/* not something we know about */</i></td></tr>
<tr><th id="868">868</th><td></td></tr>
<tr><th id="869">869</th><td>	<i>/* Eventually output delay measurement now. */</i></td></tr>
<tr><th id="870">870</th><td>	<b>if</b> (<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="macro" href="#94" title="0x80" data-ref="_M/NMEA_DELAYMEAS_MASK">NMEA_DELAYMEAS_MASK</a>) {</td></tr>
<tr><th id="871">871</th><td>		<a class="ref fn" href="../include/ntpd.h.html#mprintf_clock_stats" title='mprintf_clock_stats' data-ref="mprintf_clock_stats" data-ref-filename="mprintf_clock_stats">mprintf_clock_stats</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>, <q>"delay %0.6f %.*s"</q>,</td></tr>
<tr><th id="872">872</th><td>			 <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/math.h.html#ldexp" title='ldexp' data-ref="ldexp" data-ref-filename="ldexp">ldexp</a>(<a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>.<a class="ref field" href="../include/ntp_fp.h.html#(anonymous)::l_uf" title='(anonymous struct)::l_uf' data-ref="(anonymous)::l_uf" data-ref-filename="(anonymous)..l_uf">l_uf</a>, -<var>32</var>),</td></tr>
<tr><th id="873">873</th><td>			 (<em>int</em>)(<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strchr" title='strchr' data-ref="strchr" data-ref-filename="strchr">strchr</a>(<a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>, <kbd>','</kbd>) - <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>),</td></tr>
<tr><th id="874">874</th><td>			 <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>);</td></tr>
<tr><th id="875">875</th><td>	}</td></tr>
<tr><th id="876">876</th><td>	</td></tr>
<tr><th id="877">877</th><td>	<i>/* See if I want to process this message type */</i></td></tr>
<tr><th id="878">878</th><td>	<b>if</b> ((<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="macro" href="#90" title="0x0000FF0FU" data-ref="_M/NMEA_MESSAGE_MASK">NMEA_MESSAGE_MASK</a>) &amp;&amp;</td></tr>
<tr><th id="879">879</th><td>	    !(<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="tu ref" href="#sentence_mode" title='sentence_mode' data-use='r' data-ref="sentence_mode" data-ref-filename="sentence_mode">sentence_mode</a>[<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a>])) {</td></tr>
<tr><th id="880">880</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::filtered" title='(anonymous struct)::(anonymous struct)::filtered' data-use='w' data-ref="(anonymousstruct)::(anonymous)::filtered" data-ref-filename="(anonymousstruct)..(anonymous)..filtered">filtered</a>++;</td></tr>
<tr><th id="881">881</th><td>		<b>return</b>;</td></tr>
<tr><th id="882">882</th><td>	}</td></tr>
<tr><th id="883">883</th><td></td></tr>
<tr><th id="884">884</th><td>	<i>/* </i></td></tr>
<tr><th id="885">885</th><td><i>	 * make sure it came in clean</i></td></tr>
<tr><th id="886">886</th><td><i>	 *</i></td></tr>
<tr><th id="887">887</th><td><i>	 * Apparently, older NMEA specifications (which are expensive)</i></td></tr>
<tr><th id="888">888</th><td><i>	 * did not require the checksum for all sentences.  $GPMRC is</i></td></tr>
<tr><th id="889">889</th><td><i>	 * the only one so far identified which has always been required</i></td></tr>
<tr><th id="890">890</th><td><i>	 * to include a checksum.</i></td></tr>
<tr><th id="891">891</th><td><i>	 *</i></td></tr>
<tr><th id="892">892</th><td><i>	 * Today, most NMEA GPS receivers checksum every sentence.  To</i></td></tr>
<tr><th id="893">893</th><td><i>	 * preserve its error-detection capabilities with modern GPSes</i></td></tr>
<tr><th id="894">894</th><td><i>	 * while allowing operation without checksums on all but $GPMRC,</i></td></tr>
<tr><th id="895">895</th><td><i>	 * we keep track of whether we've ever seen a valid checksum on</i></td></tr>
<tr><th id="896">896</th><td><i>	 * a given sentence, and if so, reject future instances without</i></td></tr>
<tr><th id="897">897</th><td><i>	 * checksum.  ('up-&gt;cksum_type[NMEA_GPRMC]' is set in</i></td></tr>
<tr><th id="898">898</th><td><i>	 * 'nmea_start()' to enforce checksums for $GPRMC right from the</i></td></tr>
<tr><th id="899">899</th><td><i>	 * start.)</i></td></tr>
<tr><th id="900">900</th><td><i>	 */</i></td></tr>
<tr><th id="901">901</th><td>	<b>if</b> (<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::cksum_type" title='(anonymous struct)::cksum_type' data-use='r' data-ref="(anonymous)::cksum_type" data-ref-filename="(anonymous)..cksum_type">cksum_type</a>[<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a>] &lt;= (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a>) {</td></tr>
<tr><th id="902">902</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::cksum_type" title='(anonymous struct)::cksum_type' data-use='w' data-ref="(anonymous)::cksum_type" data-ref-filename="(anonymous)..cksum_type">cksum_type</a>[<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a>] = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a>;</td></tr>
<tr><th id="903">903</th><td>	} <b>else</b> {</td></tr>
<tr><th id="904">904</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s checksum missing: &apos;%s&apos;\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), rd_lastcode); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s checksum missing: '%s'\n"</q>,</td></tr>
<tr><th id="905">905</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>));</td></tr>
<tr><th id="906">906</th><td>		<a class="ref fn" href="../include/ntp_refclock.h.html#refclock_report" title='refclock_report' data-ref="refclock_report" data-ref-filename="refclock_report">refclock_report</a>(<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>, <a class="macro" href="../include/ntp.h.html#677" title="2" data-ref="_M/CEVNT_BADREPLY">CEVNT_BADREPLY</a>);</td></tr>
<tr><th id="907">907</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::malformed" title='(anonymous struct)::(anonymous struct)::malformed' data-use='w' data-ref="(anonymousstruct)::(anonymous)::malformed" data-ref-filename="(anonymousstruct)..(anonymous)..malformed">malformed</a>++;</td></tr>
<tr><th id="908">908</th><td>		<b>return</b>;</td></tr>
<tr><th id="909">909</th><td>	}</td></tr>
<tr><th id="910">910</th><td></td></tr>
<tr><th id="911">911</th><td>	<i>/*</i></td></tr>
<tr><th id="912">912</th><td><i>	 * $GPZDG provides GPS time not UTC, and the two mix poorly.</i></td></tr>
<tr><th id="913">913</th><td><i>	 * Once have processed a $GPZDG, do not process any further UTC</i></td></tr>
<tr><th id="914">914</th><td><i>	 * sentences (all but $GPZDG currently).</i></td></tr>
<tr><th id="915">915</th><td><i>	 */</i> </td></tr>
<tr><th id="916">916</th><td>	<b>if</b> (<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::gps_time" title='(anonymous struct)::gps_time' data-use='r' data-ref="(anonymous)::gps_time" data-ref-filename="(anonymous)..gps_time">gps_time</a> &amp;&amp; <a class="macro" href="#184" title="4" data-ref="_M/NMEA_GPZDG">NMEA_GPZDG</a> != <a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a>) {</td></tr>
<tr><th id="917">917</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::filtered" title='(anonymous struct)::(anonymous struct)::filtered' data-use='w' data-ref="(anonymousstruct)::(anonymous)::filtered" data-ref-filename="(anonymousstruct)..(anonymous)..filtered">filtered</a>++;</td></tr>
<tr><th id="918">918</th><td>		<b>return</b>;</td></tr>
<tr><th id="919">919</th><td>	}</td></tr>
<tr><th id="920">920</th><td></td></tr>
<tr><th id="921">921</th><td>	<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s processing %d bytes, timecode &apos;%s&apos;\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), rd_lencode, rd_lastcode); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s processing %d bytes, timecode '%s'\n"</q>,</td></tr>
<tr><th id="922">922</th><td>		<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a>, <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>));</td></tr>
<tr><th id="923">923</th><td></td></tr>
<tr><th id="924">924</th><td>	<i>/*</i></td></tr>
<tr><th id="925">925</th><td><i>	 * Grab fields depending on clock string type and possibly wipe</i></td></tr>
<tr><th id="926">926</th><td><i>	 * sensitive data from the last timecode.</i></td></tr>
<tr><th id="927">927</th><td><i>	 */</i></td></tr>
<tr><th id="928">928</th><td>	<b>switch</b> (<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a>) {</td></tr>
<tr><th id="929">929</th><td></td></tr>
<tr><th id="930">930</th><td>	<b>case</b> <a class="macro" href="#171" title="0" data-ref="_M/NMEA_GPRMC">NMEA_GPRMC</a>:</td></tr>
<tr><th id="931">931</th><td>		<i>/* Check quality byte, fetch data &amp; time */</i></td></tr>
<tr><th id="932">932</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>	 = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>);</td></tr>
<tr><th id="933">933</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="tu ref fn" href="#parse_qual" title='parse_qual' data-use='c' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>2</var>, <kbd>'A'</kbd>, <var>0</var>);</td></tr>
<tr><th id="934">934</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>	 = <a class="tu ref fn" href="#parse_date" title='parse_date' data-use='c' data-ref="parse_date" data-ref-filename="parse_date">parse_date</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>9</var>, <a class="enum" href="#DATE_1_DDMMYY" title='DATE_1_DDMMYY' data-ref="DATE_1_DDMMYY" data-ref-filename="DATE_1_DDMMYY">DATE_1_DDMMYY</a>)</td></tr>
<tr><th id="935">935</th><td>			&amp;&amp; <a class="tu ref fn" href="#unfold_century" title='unfold_century' data-use='c' data-ref="unfold_century" data-ref-filename="unfold_century">unfold_century</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, <a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>.<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a>);</td></tr>
<tr><th id="936">936</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_refclock.h.html#53" title="0x8" data-ref="_M/CLK_FLAG4">CLK_FLAG4</a> &amp; <a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>)</td></tr>
<tr><th id="937">937</th><td>			<a class="tu ref fn" href="#field_wipe" title='field_wipe' data-use='c' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>3</var>, <var>4</var>, <var>5</var>, <var>6</var>, -<var>1</var>);</td></tr>
<tr><th id="938">938</th><td>		<b>break</b>;</td></tr>
<tr><th id="939">939</th><td></td></tr>
<tr><th id="940">940</th><td>	<b>case</b> <a class="macro" href="#172" title="1" data-ref="_M/NMEA_GPGGA">NMEA_GPGGA</a>:</td></tr>
<tr><th id="941">941</th><td>		<i>/* Check quality byte, fetch time only */</i></td></tr>
<tr><th id="942">942</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>	 = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>);</td></tr>
<tr><th id="943">943</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="tu ref fn" href="#parse_qual" title='parse_qual' data-use='c' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>6</var>, <kbd>'0'</kbd>, <var>1</var>);</td></tr>
<tr><th id="944">944</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>	 = <a class="tu ref fn" href="#unfold_day" title='unfold_day' data-use='c' data-ref="unfold_day" data-ref-filename="unfold_day">unfold_day</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, <a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>.<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a>);</td></tr>
<tr><th id="945">945</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_refclock.h.html#53" title="0x8" data-ref="_M/CLK_FLAG4">CLK_FLAG4</a> &amp; <a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>)</td></tr>
<tr><th id="946">946</th><td>			<a class="tu ref fn" href="#field_wipe" title='field_wipe' data-use='c' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>2</var>, <var>4</var>, -<var>1</var>);</td></tr>
<tr><th id="947">947</th><td>		<b>break</b>;</td></tr>
<tr><th id="948">948</th><td></td></tr>
<tr><th id="949">949</th><td>	<b>case</b> <a class="macro" href="#173" title="2" data-ref="_M/NMEA_GPGLL">NMEA_GPGLL</a>:</td></tr>
<tr><th id="950">950</th><td>		<i>/* Check quality byte, fetch time only */</i></td></tr>
<tr><th id="951">951</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>	 = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>5</var>);</td></tr>
<tr><th id="952">952</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="tu ref fn" href="#parse_qual" title='parse_qual' data-use='c' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>6</var>, <kbd>'A'</kbd>, <var>0</var>);</td></tr>
<tr><th id="953">953</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>	 = <a class="tu ref fn" href="#unfold_day" title='unfold_day' data-use='c' data-ref="unfold_day" data-ref-filename="unfold_day">unfold_day</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, <a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>.<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a>);</td></tr>
<tr><th id="954">954</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_refclock.h.html#53" title="0x8" data-ref="_M/CLK_FLAG4">CLK_FLAG4</a> &amp; <a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>)</td></tr>
<tr><th id="955">955</th><td>			<a class="tu ref fn" href="#field_wipe" title='field_wipe' data-use='c' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>, <var>3</var>, -<var>1</var>);</td></tr>
<tr><th id="956">956</th><td>		<b>break</b>;</td></tr>
<tr><th id="957">957</th><td>	</td></tr>
<tr><th id="958">958</th><td>	<b>case</b> <a class="macro" href="#174" title="3" data-ref="_M/NMEA_GPZDA">NMEA_GPZDA</a>:</td></tr>
<tr><th id="959">959</th><td>		<i>/* No quality.	Assume best, fetch time &amp; full date */</i></td></tr>
<tr><th id="960">960</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="macro" href="../include/ntp.h.html#414" title="0x0" data-ref="_M/LEAP_NOWARNING">LEAP_NOWARNING</a>;</td></tr>
<tr><th id="961">961</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>	 = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>);</td></tr>
<tr><th id="962">962</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>	 = <a class="tu ref fn" href="#parse_date" title='parse_date' data-use='c' data-ref="parse_date" data-ref-filename="parse_date">parse_date</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>2</var>, <a class="enum" href="#DATE_3_DDMMYYYY" title='DATE_3_DDMMYYYY' data-ref="DATE_3_DDMMYYYY" data-ref-filename="DATE_3_DDMMYYYY">DATE_3_DDMMYYYY</a>);</td></tr>
<tr><th id="963">963</th><td>		<b>break</b>;</td></tr>
<tr><th id="964">964</th><td></td></tr>
<tr><th id="965">965</th><td>	<b>case</b> <a class="macro" href="#184" title="4" data-ref="_M/NMEA_GPZDG">NMEA_GPZDG</a>:</td></tr>
<tr><th id="966">966</th><td>		<i>/* Check quality byte, fetch time &amp; full date */</i></td></tr>
<tr><th id="967">967</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>	 = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>);</td></tr>
<tr><th id="968">968</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>	 = <a class="tu ref fn" href="#parse_date" title='parse_date' data-use='c' data-ref="parse_date" data-ref-filename="parse_date">parse_date</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>2</var>, <a class="enum" href="#DATE_3_DDMMYYYY" title='DATE_3_DDMMYYYY' data-ref="DATE_3_DDMMYYYY" data-ref-filename="DATE_3_DDMMYYYY">DATE_3_DDMMYYYY</a>);</td></tr>
<tr><th id="969">969</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="tu ref fn" href="#parse_qual" title='parse_qual' data-use='c' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>4</var>, <kbd>'0'</kbd>, <var>1</var>);</td></tr>
<tr><th id="970">970</th><td>		<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_sec" title='timespec::tv_sec' data-ref="timespec::tv_sec" data-ref-filename="timespec..tv_sec">tv_sec</a> = -<var>1</var>; <i>/* GPZDG is following second */</i></td></tr>
<tr><th id="971">971</th><td>		<b>break</b>;</td></tr>
<tr><th id="972">972</th><td></td></tr>
<tr><th id="973">973</th><td>	<b>case</b> <a class="macro" href="#185" title="5" data-ref="_M/NMEA_PGRMF">NMEA_PGRMF</a>:</td></tr>
<tr><th id="974">974</th><td>		<i>/* get date, time, qualifier and GPS weektime. We need</i></td></tr>
<tr><th id="975">975</th><td><i>		 * date and time-of-day for the century fix, so we read</i></td></tr>
<tr><th id="976">976</th><td><i>		 * them first.</i></td></tr>
<tr><th id="977">977</th><td><i>		 */</i></td></tr>
<tr><th id="978">978</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>  = <a class="tu ref fn" href="#parse_weekdata" title='parse_weekdata' data-use='c' data-ref="parse_weekdata" data-ref-filename="parse_weekdata">parse_weekdata</a>(&amp;<a class="local col0 ref" href="#80gpsw" title='gpsw' data-ref="80gpsw" data-ref-filename="80gpsw">gpsw</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>1</var>, <var>2</var>, <var>5</var>)</td></tr>
<tr><th id="979">979</th><td>		        &amp;&amp; <a class="tu ref fn" href="#parse_date" title='parse_date' data-use='c' data-ref="parse_date" data-ref-filename="parse_date">parse_date</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>3</var>, <a class="enum" href="#DATE_1_DDMMYY" title='DATE_1_DDMMYY' data-ref="DATE_1_DDMMYY" data-ref-filename="DATE_1_DDMMYY">DATE_1_DDMMYY</a>);</td></tr>
<tr><th id="980">980</th><td>		<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a>  = <a class="tu ref fn" href="#parse_time" title='parse_time' data-use='c' data-ref="parse_time" data-ref-filename="parse_time">parse_time</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec::tv_nsec" title='timespec::tv_nsec' data-ref="timespec::tv_nsec" data-ref-filename="timespec..tv_nsec">tv_nsec</a>, &amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>4</var>);</td></tr>
<tr><th id="981">981</th><td>		<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> = <a class="tu ref fn" href="#parse_qual" title='parse_qual' data-use='c' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>11</var>, <kbd>'0'</kbd>, <var>1</var>);		</td></tr>
<tr><th id="982">982</th><td>		<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a>  = <a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a></td></tr>
<tr><th id="983">983</th><td>		        &amp;&amp; <a class="tu ref fn" href="#gpsfix_century" title='gpsfix_century' data-use='c' data-ref="gpsfix_century" data-ref-filename="gpsfix_century">gpsfix_century</a>(&amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col0 ref" href="#80gpsw" title='gpsw' data-ref="80gpsw" data-ref-filename="80gpsw">gpsw</a>, &amp;<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::century_cache" title='(anonymous struct)::century_cache' data-use='a' data-ref="(anonymous)::century_cache" data-ref-filename="(anonymous)..century_cache">century_cache</a>);</td></tr>
<tr><th id="984">984</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_refclock.h.html#53" title="0x8" data-ref="_M/CLK_FLAG4">CLK_FLAG4</a> &amp; <a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::sloppyclockflag" title='refclockproc::sloppyclockflag' data-ref="refclockproc::sloppyclockflag" data-ref-filename="refclockproc..sloppyclockflag">sloppyclockflag</a>)</td></tr>
<tr><th id="985">985</th><td>			<a class="tu ref fn" href="#field_wipe" title='field_wipe' data-use='c' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</a>(&amp;<a class="local col2 ref" href="#72rdata" title='rdata' data-ref="72rdata" data-ref-filename="72rdata">rdata</a>, <var>6</var>, <var>8</var>, -<var>1</var>);</td></tr>
<tr><th id="986">986</th><td>		<b>break</b>;</td></tr>
<tr><th id="987">987</th><td>		</td></tr>
<tr><th id="988">988</th><td>	<b>default</b>:</td></tr>
<tr><th id="989">989</th><td>		<a class="macro" href="../include/ntp_assert.h.html#86" title="((void) ((0) || ((isc_assertion_failed)(&quot;/___NETBSD_SRC___/objdir.amd64/external/bsd/ntp/bin/ntpd/../../../../../../external/bsd/ntp/dist/ntpd/refclock_nmea.c&quot;, 989, isc_assertiontype_invariant, &quot;0&quot;), 0)))" data-ref="_M/INVARIANT">INVARIANT</a>(<var>0</var>);	<i>/* Coverity 97123 */</i></td></tr>
<tr><th id="990">990</th><td>		<b>return</b>;</td></tr>
<tr><th id="991">991</th><td>	}</td></tr>
<tr><th id="992">992</th><td></td></tr>
<tr><th id="993">993</th><td>	<i>/* Check sanity of time-of-day. */</i></td></tr>
<tr><th id="994">994</th><td>	<b>if</b> (<a class="local col5 ref" href="#85rc_time" title='rc_time' data-ref="85rc_time" data-ref-filename="85rc_time">rc_time</a> == <var>0</var>) {	<i>/* no time or conversion error? */</i></td></tr>
<tr><th id="995">995</th><td>		<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> = <a class="macro" href="../include/ntp.h.html#681" title="6" data-ref="_M/CEVNT_BADTIME">CEVNT_BADTIME</a>;</td></tr>
<tr><th id="996">996</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::malformed" title='(anonymous struct)::(anonymous struct)::malformed' data-use='w' data-ref="(anonymousstruct)::(anonymous)::malformed" data-ref-filename="(anonymousstruct)..(anonymous)..malformed">malformed</a>++;</td></tr>
<tr><th id="997">997</th><td>	}</td></tr>
<tr><th id="998">998</th><td>	<i>/* Check sanity of date. */</i></td></tr>
<tr><th id="999">999</th><td>	<b>else</b> <b>if</b> (<a class="local col4 ref" href="#84rc_date" title='rc_date' data-ref="84rc_date" data-ref-filename="84rc_date">rc_date</a> == <var>0</var>) {<i>/* no date or conversion error? */</i></td></tr>
<tr><th id="1000">1000</th><td>		<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> = <a class="macro" href="../include/ntp.h.html#680" title="5" data-ref="_M/CEVNT_BADDATE">CEVNT_BADDATE</a>;</td></tr>
<tr><th id="1001">1001</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::malformed" title='(anonymous struct)::(anonymous struct)::malformed' data-use='w' data-ref="(anonymousstruct)::(anonymous)::malformed" data-ref-filename="(anonymousstruct)..(anonymous)..malformed">malformed</a>++;</td></tr>
<tr><th id="1002">1002</th><td>	}</td></tr>
<tr><th id="1003">1003</th><td>	<i>/* check clock sanity; [bug 2143] */</i></td></tr>
<tr><th id="1004">1004</th><td>	<b>else</b> <b>if</b> (<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::leap" title='refclockproc::leap' data-ref="refclockproc::leap" data-ref-filename="refclockproc..leap">leap</a> == <a class="macro" href="../include/ntp.h.html#417" title="0x3" data-ref="_M/LEAP_NOTINSYNC">LEAP_NOTINSYNC</a>) { <i>/* no good status? */</i></td></tr>
<tr><th id="1005">1005</th><td>		<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> = <a class="macro" href="../include/ntp.h.html#677" title="2" data-ref="_M/CEVNT_BADREPLY">CEVNT_BADREPLY</a>;</td></tr>
<tr><th id="1006">1006</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::rejected" title='(anonymous struct)::(anonymous struct)::rejected' data-use='w' data-ref="(anonymousstruct)::(anonymous)::rejected" data-ref-filename="(anonymousstruct)..(anonymous)..rejected">rejected</a>++;</td></tr>
<tr><th id="1007">1007</th><td>	}</td></tr>
<tr><th id="1008">1008</th><td>	<b>else</b></td></tr>
<tr><th id="1009">1009</th><td>		<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> = -<var>1</var>;</td></tr>
<tr><th id="1010">1010</th><td></td></tr>
<tr><th id="1011">1011</th><td>	<b>if</b> (<a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a> != -<var>1</var>) {</td></tr>
<tr><th id="1012">1012</th><td>		<a class="tu ref fn" href="#save_ltc" title='save_ltc' data-use='c' data-ref="save_ltc" data-ref-filename="save_ltc">save_ltc</a>(<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>, <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>, <a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a>);</td></tr>
<tr><th id="1013">1013</th><td>		<a class="ref fn" href="../include/ntp_refclock.h.html#refclock_report" title='refclock_report' data-ref="refclock_report" data-ref-filename="refclock_report">refclock_report</a>(<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>, <a class="local col2 ref" href="#82checkres" title='checkres' data-ref="82checkres" data-ref-filename="82checkres">checkres</a>);</td></tr>
<tr><th id="1014">1014</th><td>		<b>return</b>;</td></tr>
<tr><th id="1015">1015</th><td>	}</td></tr>
<tr><th id="1016">1016</th><td></td></tr>
<tr><th id="1017">1017</th><td>	<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s effective timecode: %04u-%02u-%02u %02d:%02d:%02d\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), date.year, date.month, date.monthday, date.hour, date.minute, date.second); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s effective timecode: %04u-%02u-%02u %02d:%02d:%02d\n"</q>,</td></tr>
<tr><th id="1018">1018</th><td>		<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>),</td></tr>
<tr><th id="1019">1019</th><td>		<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>, <a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::month" title='calendar::month' data-ref="calendar::month" data-ref-filename="calendar..month">month</a>, <a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::monthday" title='calendar::monthday' data-ref="calendar::monthday" data-ref-filename="calendar..monthday">monthday</a>,</td></tr>
<tr><th id="1020">1020</th><td>		<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::hour" title='calendar::hour' data-ref="calendar::hour" data-ref-filename="calendar..hour">hour</a>, <a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::minute" title='calendar::minute' data-ref="calendar::minute" data-ref-filename="calendar..minute">minute</a>, <a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::second" title='calendar::second' data-ref="calendar::second" data-ref-filename="calendar..second">second</a>));</td></tr>
<tr><th id="1021">1021</th><td></td></tr>
<tr><th id="1022">1022</th><td>	<i>/* Check if we must enter GPS time mode; log so if we do */</i></td></tr>
<tr><th id="1023">1023</th><td>	<b>if</b> (!<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::gps_time" title='(anonymous struct)::gps_time' data-use='r' data-ref="(anonymous)::gps_time" data-ref-filename="(anonymous)..gps_time">gps_time</a> &amp;&amp; (<a class="local col1 ref" href="#81sentence" title='sentence' data-ref="81sentence" data-ref-filename="81sentence">sentence</a> == <a class="macro" href="#184" title="4" data-ref="_M/NMEA_GPZDG">NMEA_GPZDG</a>)) {</td></tr>
<tr><th id="1024">1024</th><td>		<a class="ref fn" href="../include/ntp_stdlib.h.html#msyslog" title='msyslog' data-ref="msyslog" data-ref-filename="msyslog">msyslog</a>(<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#58" title="6" data-ref="_M/LOG_INFO">LOG_INFO</a>, <q>"%s using GPS time as if it were UTC"</q>,</td></tr>
<tr><th id="1025">1025</th><td>			<a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>));</td></tr>
<tr><th id="1026">1026</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::gps_time" title='(anonymous struct)::gps_time' data-use='w' data-ref="(anonymous)::gps_time" data-ref-filename="(anonymous)..gps_time">gps_time</a> = <var>1</var>;</td></tr>
<tr><th id="1027">1027</th><td>	}</td></tr>
<tr><th id="1028">1028</th><td>	</td></tr>
<tr><th id="1029">1029</th><td>	<i>/*</i></td></tr>
<tr><th id="1030">1030</th><td><i>	 * Get the reference time stamp from the calendar buffer.</i></td></tr>
<tr><th id="1031">1031</th><td><i>	 * Process the new sample in the median filter and determine the</i></td></tr>
<tr><th id="1032">1032</th><td><i>	 * timecode timestamp, but only if the PPS is not in control.</i></td></tr>
<tr><th id="1033">1033</th><td><i>	 * Discard sentence if reference time did not change.</i></td></tr>
<tr><th id="1034">1034</th><td><i>	 */</i></td></tr>
<tr><th id="1035">1035</th><td>	<a class="local col5 ref" href="#75rd_reftime" title='rd_reftime' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</a> = <a class="tu ref fn" href="#eval_gps_time" title='eval_gps_time' data-use='c' data-ref="eval_gps_time" data-ref-filename="eval_gps_time">eval_gps_time</a>(<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>, &amp;<a class="local col8 ref" href="#78date" title='date' data-ref="78date" data-ref-filename="78date">date</a>, &amp;<a class="local col9 ref" href="#79tofs" title='tofs' data-ref="79tofs" data-ref-filename="79tofs">tofs</a>, &amp;<a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>);</td></tr>
<tr><th id="1036">1036</th><td>	<b>if</b> (<a class="macro" href="../include/ntp_fp.h.html#247" title="((u_int32)((&amp;up-&gt;last_reftime)-&gt;Ul_i.Xl_ui) == (u_int32)((&amp;rd_reftime)-&gt;Ul_i.Xl_ui) &amp;&amp; (u_int32)((&amp;up-&gt;last_reftime)-&gt;l_uf) == (u_int32)((&amp;rd_reftime)-&gt;l_uf))" data-ref="_M/L_ISEQU">L_ISEQU</a>(&amp;<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::last_reftime" title='(anonymous struct)::last_reftime' data-use='a' data-ref="(anonymous)::last_reftime" data-ref-filename="(anonymous)..last_reftime">last_reftime</a>, &amp;<a class="local col5 ref" href="#75rd_reftime" title='rd_reftime' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</a>)) {</td></tr>
<tr><th id="1037">1037</th><td>		<i>/* Do not touch pp-&gt;a_lastcode on purpose! */</i></td></tr>
<tr><th id="1038">1038</th><td>		<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::filtered" title='(anonymous struct)::(anonymous struct)::filtered' data-use='w' data-ref="(anonymousstruct)::(anonymous)::filtered" data-ref-filename="(anonymousstruct)..(anonymous)..filtered">filtered</a>++;</td></tr>
<tr><th id="1039">1039</th><td>		<b>return</b>;</td></tr>
<tr><th id="1040">1040</th><td>	}</td></tr>
<tr><th id="1041">1041</th><td>	<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::last_reftime" title='(anonymous struct)::last_reftime' data-use='w' data-ref="(anonymous)::last_reftime" data-ref-filename="(anonymous)..last_reftime">last_reftime</a> = <a class="local col5 ref" href="#75rd_reftime" title='rd_reftime' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</a>;</td></tr>
<tr><th id="1042">1042</th><td>	<a class="local col7 ref" href="#77rd_fudge" title='rd_fudge' data-ref="77rd_fudge" data-ref-filename="77rd_fudge">rd_fudge</a> = <a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::fudgetime2" title='refclockproc::fudgetime2' data-ref="refclockproc::fudgetime2" data-ref-filename="refclockproc..fudgetime2">fudgetime2</a>;</td></tr>
<tr><th id="1043">1043</th><td></td></tr>
<tr><th id="1044">1044</th><td>	<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;%s using &apos;%s&apos;\n&quot;, refnumtoa(&amp;peer-&gt;srcadr), rd_lastcode); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"%s using '%s'\n"</q>,</td></tr>
<tr><th id="1045">1045</th><td>		    <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>));</td></tr>
<tr><th id="1046">1046</th><td></td></tr>
<tr><th id="1047">1047</th><td>	<i>/* Data will be accepted. Update stats &amp; log data. */</i></td></tr>
<tr><th id="1048">1048</th><td>	<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::accepted" title='(anonymous struct)::(anonymous struct)::accepted' data-use='w' data-ref="(anonymousstruct)::(anonymous)::accepted" data-ref-filename="(anonymousstruct)..(anonymous)..accepted">accepted</a>++;</td></tr>
<tr><th id="1049">1049</th><td>	<a class="tu ref fn" href="#save_ltc" title='save_ltc' data-use='c' data-ref="save_ltc" data-ref-filename="save_ltc">save_ltc</a>(<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>, <a class="local col3 ref" href="#73rd_lastcode" title='rd_lastcode' data-ref="73rd_lastcode" data-ref-filename="73rd_lastcode">rd_lastcode</a>, <a class="local col6 ref" href="#76rd_lencode" title='rd_lencode' data-ref="76rd_lencode" data-ref-filename="76rd_lencode">rd_lencode</a>);</td></tr>
<tr><th id="1050">1050</th><td>	<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::lastrec" title='refclockproc::lastrec' data-ref="refclockproc::lastrec" data-ref-filename="refclockproc..lastrec">lastrec</a> = <a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>;</td></tr>
<tr><th id="1051">1051</th><td></td></tr>
<tr><th id="1052">1052</th><td><u>#<span data-ppcond="1052">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="1053">1053</th><td>	<i>/*</i></td></tr>
<tr><th id="1054">1054</th><td><i>	 * If we have PPS running, we try to associate the sentence</i></td></tr>
<tr><th id="1055">1055</th><td><i>	 * with the last active edge of the PPS signal.</i></td></tr>
<tr><th id="1056">1056</th><td><i>	 */</i></td></tr>
<tr><th id="1057">1057</th><td>	<b>if</b> (<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_lit" title='(anonymous struct)::ppsapi_lit' data-use='r' data-ref="(anonymous)::ppsapi_lit" data-ref-filename="(anonymous)..ppsapi_lit">ppsapi_lit</a>)</td></tr>
<tr><th id="1058">1058</th><td>		<b>switch</b> (<a class="tu ref fn" href="#refclock_ppsrelate" title='refclock_ppsrelate' data-use='c' data-ref="refclock_ppsrelate" data-ref-filename="refclock_ppsrelate">refclock_ppsrelate</a>(</td></tr>
<tr><th id="1059">1059</th><td>				<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>, &amp;<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::atom" title='(anonymous struct)::atom' data-use='a' data-ref="(anonymous)::atom" data-ref-filename="(anonymous)..atom">atom</a>, &amp;<a class="local col5 ref" href="#75rd_reftime" title='rd_reftime' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</a>, &amp;<a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>,</td></tr>
<tr><th id="1060">1060</th><td>				<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::fudgetime1" title='refclockproc::fudgetime1' data-ref="refclockproc::fudgetime1" data-ref-filename="refclockproc..fudgetime1">fudgetime1</a>,	&amp;<a class="local col7 ref" href="#77rd_fudge" title='rd_fudge' data-ref="77rd_fudge" data-ref-filename="77rd_fudge">rd_fudge</a>))</td></tr>
<tr><th id="1061">1061</th><td>		{</td></tr>
<tr><th id="1062">1062</th><td>		<b>case</b> <a class="macro" href="#695" title="2" data-ref="_M/PPS_RELATE_PHASE">PPS_RELATE_PHASE</a>:</td></tr>
<tr><th id="1063">1063</th><td>			<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-use='w' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</a> = <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="1064">1064</th><td>			<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::precision" title='peer::precision' data-ref="peer::precision" data-ref-filename="peer..precision">precision</a> = <a class="macro" href="#155" title="(-20)" data-ref="_M/PPS_PRECISION">PPS_PRECISION</a>;</td></tr>
<tr><th id="1065">1065</th><td>			<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::flags" title='peer::flags' data-ref="peer::flags" data-ref-filename="peer..flags">flags</a> |= <a class="macro" href="../include/ntp.h.html#459" title="0x0080" data-ref="_M/FLAG_PPS">FLAG_PPS</a>;</td></tr>
<tr><th id="1066">1066</th><td>			<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (2)) mprintf (&quot;%s PPS_RELATE_PHASE\n&quot;, refnumtoa(&amp;peer-&gt;srcadr)); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>2</var>, (<q>"%s PPS_RELATE_PHASE\n"</q>,</td></tr>
<tr><th id="1067">1067</th><td>				    <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>)));</td></tr>
<tr><th id="1068">1068</th><td>			<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::pps_used" title='(anonymous struct)::(anonymous struct)::pps_used' data-use='w' data-ref="(anonymousstruct)::(anonymous)::pps_used" data-ref-filename="(anonymousstruct)..(anonymous)..pps_used">pps_used</a>++;</td></tr>
<tr><th id="1069">1069</th><td>			<b>break</b>;</td></tr>
<tr><th id="1070">1070</th><td>			</td></tr>
<tr><th id="1071">1071</th><td>		<b>case</b> <a class="macro" href="#694" title="1" data-ref="_M/PPS_RELATE_EDGE">PPS_RELATE_EDGE</a>:</td></tr>
<tr><th id="1072">1072</th><td>			<a class="local col1 ref" href="#71up" title='up' data-ref="71up" data-ref-filename="71up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-use='w' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</a> = <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="1073">1073</th><td>			<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::precision" title='peer::precision' data-ref="peer::precision" data-ref-filename="peer..precision">precision</a> = <a class="macro" href="#155" title="(-20)" data-ref="_M/PPS_PRECISION">PPS_PRECISION</a>;</td></tr>
<tr><th id="1074">1074</th><td>			<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (2)) mprintf (&quot;%s PPS_RELATE_EDGE\n&quot;, refnumtoa(&amp;peer-&gt;srcadr)); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>2</var>, (<q>"%s PPS_RELATE_EDGE\n"</q>,</td></tr>
<tr><th id="1075">1075</th><td>				    <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>)));</td></tr>
<tr><th id="1076">1076</th><td>			<b>break</b>;</td></tr>
<tr><th id="1077">1077</th><td>			</td></tr>
<tr><th id="1078">1078</th><td>		<b>case</b> <a class="macro" href="#693" title="0" data-ref="_M/PPS_RELATE_NONE">PPS_RELATE_NONE</a>:</td></tr>
<tr><th id="1079">1079</th><td>		<b>default</b>:</td></tr>
<tr><th id="1080">1080</th><td>			<i>/*</i></td></tr>
<tr><th id="1081">1081</th><td><i>			 * Resetting precision and PPS flag is done in</i></td></tr>
<tr><th id="1082">1082</th><td><i>			 * 'nmea_poll', since it might be a glitch. But</i></td></tr>
<tr><th id="1083">1083</th><td><i>			 * at the end of the poll cycle we know...</i></td></tr>
<tr><th id="1084">1084</th><td><i>			 */</i></td></tr>
<tr><th id="1085">1085</th><td>			<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (2)) mprintf (&quot;%s PPS_RELATE_NONE\n&quot;, refnumtoa(&amp;peer-&gt;srcadr)); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>2</var>, (<q>"%s PPS_RELATE_NONE\n"</q>,</td></tr>
<tr><th id="1086">1086</th><td>				    <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col9 ref" href="#69peer" title='peer' data-ref="69peer" data-ref-filename="69peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>)));</td></tr>
<tr><th id="1087">1087</th><td>			<b>break</b>;</td></tr>
<tr><th id="1088">1088</th><td>		}</td></tr>
<tr><th id="1089">1089</th><td><u>#<span data-ppcond="1052">endif</span> /* HAVE_PPSAPI */</u></td></tr>
<tr><th id="1090">1090</th><td></td></tr>
<tr><th id="1091">1091</th><td>	<a class="ref fn" href="../include/ntp_refclock.h.html#refclock_process_offset" title='refclock_process_offset' data-ref="refclock_process_offset" data-ref-filename="refclock_process_offset">refclock_process_offset</a>(<a class="local col0 ref" href="#70pp" title='pp' data-ref="70pp" data-ref-filename="70pp">pp</a>, <a class="local col5 ref" href="#75rd_reftime" title='rd_reftime' data-ref="75rd_reftime" data-ref-filename="75rd_reftime">rd_reftime</a>, <a class="local col4 ref" href="#74rd_timestamp" title='rd_timestamp' data-ref="74rd_timestamp" data-ref-filename="74rd_timestamp">rd_timestamp</a>, <a class="local col7 ref" href="#77rd_fudge" title='rd_fudge' data-ref="77rd_fudge" data-ref-filename="77rd_fudge">rd_fudge</a>);</td></tr>
<tr><th id="1092">1092</th><td>}</td></tr>
<tr><th id="1093">1093</th><td></td></tr>
<tr><th id="1094">1094</th><td></td></tr>
<tr><th id="1095">1095</th><td><i  data-doc="nmea_poll">/*</i></td></tr>
<tr><th id="1096">1096</th><td><i  data-doc="nmea_poll"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1097">1097</th><td><i  data-doc="nmea_poll"> * nmea_poll - called by the transmit procedure</i></td></tr>
<tr><th id="1098">1098</th><td><i  data-doc="nmea_poll"> *</i></td></tr>
<tr><th id="1099">1099</th><td><i  data-doc="nmea_poll"> * Does the necessary bookkeeping stuff to keep the reported state of</i></td></tr>
<tr><th id="1100">1100</th><td><i  data-doc="nmea_poll"> * the clock in sync with reality.</i></td></tr>
<tr><th id="1101">1101</th><td><i  data-doc="nmea_poll"> *</i></td></tr>
<tr><th id="1102">1102</th><td><i  data-doc="nmea_poll"> * We go to great pains to avoid changing state here, since there may</i></td></tr>
<tr><th id="1103">1103</th><td><i  data-doc="nmea_poll"> * be more than one eavesdropper receiving the same timecode.</i></td></tr>
<tr><th id="1104">1104</th><td><i  data-doc="nmea_poll"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1105">1105</th><td><i  data-doc="nmea_poll"> */</i></td></tr>
<tr><th id="1106">1106</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1107">1107</th><td><dfn class="tu decl def fn" id="nmea_poll" title='nmea_poll' data-type='void nmea_poll(int unit, struct peer * peer)' data-ref="nmea_poll" data-ref-filename="nmea_poll">nmea_poll</dfn>(</td></tr>
<tr><th id="1108">1108</th><td>	<em>int</em>           <dfn class="local col6 decl" id="86unit" title='unit' data-type='int' data-ref="86unit" data-ref-filename="86unit">unit</dfn>,</td></tr>
<tr><th id="1109">1109</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a> * <dfn class="local col7 decl" id="87peer" title='peer' data-type='struct peer *' data-ref="87peer" data-ref-filename="87peer">peer</dfn></td></tr>
<tr><th id="1110">1110</th><td>	)</td></tr>
<tr><th id="1111">1111</th><td>{</td></tr>
<tr><th id="1112">1112</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col8 decl" id="88pp" title='pp' data-type='struct refclockproc *const' data-ref="88pp" data-ref-filename="88pp">pp</dfn> = <a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="1113">1113</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>	    * <em>const</em> <dfn class="local col9 decl" id="89up" title='up' data-type='nmea_unit *const' data-ref="89up" data-ref-filename="89up">up</dfn> = (<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a> *)<a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a>;</td></tr>
<tr><th id="1114">1114</th><td>	</td></tr>
<tr><th id="1115">1115</th><td>	<i>/*</i></td></tr>
<tr><th id="1116">1116</th><td><i>	 * Process median filter samples. If none received, declare a</i></td></tr>
<tr><th id="1117">1117</th><td><i>	 * timeout and keep going.</i></td></tr>
<tr><th id="1118">1118</th><td><i>	 */</i></td></tr>
<tr><th id="1119">1119</th><td><u>#<span data-ppcond="1119">ifdef</span> <a class="macro" href="../../include/config.h.html#691" data-ref="_M/HAVE_PPSAPI">HAVE_PPSAPI</a></u></td></tr>
<tr><th id="1120">1120</th><td>	<i>/*</i></td></tr>
<tr><th id="1121">1121</th><td><i>	 * If we don't have PPS pulses and time stamps, turn PPS down</i></td></tr>
<tr><th id="1122">1122</th><td><i>	 * for now.</i></td></tr>
<tr><th id="1123">1123</th><td><i>	 */</i></td></tr>
<tr><th id="1124">1124</th><td>	<b>if</b> (!<a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-use='r' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</a>) {</td></tr>
<tr><th id="1125">1125</th><td>		<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::flags" title='peer::flags' data-ref="peer::flags" data-ref-filename="peer..flags">flags</a> &amp;= ~<a class="macro" href="../include/ntp.h.html#459" title="0x0080" data-ref="_M/FLAG_PPS">FLAG_PPS</a>;</td></tr>
<tr><th id="1126">1126</th><td>		<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::precision" title='peer::precision' data-ref="peer::precision" data-ref-filename="peer..precision">precision</a> = <a class="macro" href="#154" title="(-9)" data-ref="_M/PRECISION">PRECISION</a>;</td></tr>
<tr><th id="1127">1127</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1128">1128</th><td>		<a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::ppsapi_gate" title='(anonymous struct)::ppsapi_gate' data-use='w' data-ref="(anonymous)::ppsapi_gate" data-ref-filename="(anonymous)..ppsapi_gate">ppsapi_gate</a> = <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1129">1129</th><td>	}</td></tr>
<tr><th id="1130">1130</th><td><u>#<span data-ppcond="1119">endif</span> /* HAVE_PPSAPI */</u></td></tr>
<tr><th id="1131">1131</th><td></td></tr>
<tr><th id="1132">1132</th><td>	<i>/*</i></td></tr>
<tr><th id="1133">1133</th><td><i>	 * If the median filter is empty, claim a timeout. Else process</i></td></tr>
<tr><th id="1134">1134</th><td><i>	 * the input data and keep the stats going.</i></td></tr>
<tr><th id="1135">1135</th><td><i>	 */</i></td></tr>
<tr><th id="1136">1136</th><td>	<b>if</b> (<a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::coderecv" title='refclockproc::coderecv' data-ref="refclockproc::coderecv" data-ref-filename="refclockproc..coderecv">coderecv</a> == <a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::codeproc" title='refclockproc::codeproc' data-ref="refclockproc::codeproc" data-ref-filename="refclockproc..codeproc">codeproc</a>) {</td></tr>
<tr><th id="1137">1137</th><td>		<a class="ref fn" href="../include/ntp_refclock.h.html#refclock_report" title='refclock_report' data-ref="refclock_report" data-ref-filename="refclock_report">refclock_report</a>(<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>, <a class="macro" href="../include/ntp.h.html#676" title="1" data-ref="_M/CEVNT_TIMEOUT">CEVNT_TIMEOUT</a>);</td></tr>
<tr><th id="1138">1138</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1139">1139</th><td>		<a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::polls" title='refclockproc::polls' data-ref="refclockproc::polls" data-ref-filename="refclockproc..polls">polls</a>++;</td></tr>
<tr><th id="1140">1140</th><td>		<a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::lastref" title='refclockproc::lastref' data-ref="refclockproc::lastref" data-ref-filename="refclockproc..lastref">lastref</a> = <a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::lastrec" title='refclockproc::lastrec' data-ref="refclockproc::lastrec" data-ref-filename="refclockproc..lastrec">lastrec</a>;</td></tr>
<tr><th id="1141">1141</th><td>		<a class="ref fn" href="../include/ntpd.h.html#refclock_receive" title='refclock_receive' data-ref="refclock_receive" data-ref-filename="refclock_receive">refclock_receive</a>(<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>);</td></tr>
<tr><th id="1142">1142</th><td>	}</td></tr>
<tr><th id="1143">1143</th><td>	</td></tr>
<tr><th id="1144">1144</th><td>	<i>/*</i></td></tr>
<tr><th id="1145">1145</th><td><i>	 * If extended logging is required, write the tally stats to the</i></td></tr>
<tr><th id="1146">1146</th><td><i>	 * clockstats file; otherwise just do a normal clock stats</i></td></tr>
<tr><th id="1147">1147</th><td><i>	 * record. Clear the tally stats anyway.</i></td></tr>
<tr><th id="1148">1148</th><td><i>	*/</i></td></tr>
<tr><th id="1149">1149</th><td>	<b>if</b> (<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="macro" href="#95" title="0x00010000U" data-ref="_M/NMEA_EXTLOG_MASK">NMEA_EXTLOG_MASK</a>) {</td></tr>
<tr><th id="1150">1150</th><td>		<i>/* Log &amp; reset counters with extended logging */</i></td></tr>
<tr><th id="1151">1151</th><td>		<em>const</em> <em>char</em> *<dfn class="local col0 decl" id="90nmea" title='nmea' data-type='const char *' data-ref="90nmea" data-ref-filename="90nmea">nmea</dfn> = <a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>;</td></tr>
<tr><th id="1152">1152</th><td>		<b>if</b> (*<a class="local col0 ref" href="#90nmea" title='nmea' data-ref="90nmea" data-ref-filename="90nmea">nmea</a> == <kbd>'\0'</kbd>) <a class="local col0 ref" href="#90nmea" title='nmea' data-ref="90nmea" data-ref-filename="90nmea">nmea</a> = <q>"(none)"</q>;</td></tr>
<tr><th id="1153">1153</th><td>		<a class="ref fn" href="../include/ntpd.h.html#mprintf_clock_stats" title='mprintf_clock_stats' data-ref="mprintf_clock_stats" data-ref-filename="mprintf_clock_stats">mprintf_clock_stats</a>(</td></tr>
<tr><th id="1154">1154</th><td>		  &amp;<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>, <q>"%s  %u %u %u %u %u %u"</q>,</td></tr>
<tr><th id="1155">1155</th><td>		  <a class="local col0 ref" href="#90nmea" title='nmea' data-ref="90nmea" data-ref-filename="90nmea">nmea</a>,</td></tr>
<tr><th id="1156">1156</th><td>		  <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::total" title='(anonymous struct)::(anonymous struct)::total' data-use='r' data-ref="(anonymousstruct)::(anonymous)::total" data-ref-filename="(anonymousstruct)..(anonymous)..total">total</a>, <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::accepted" title='(anonymous struct)::(anonymous struct)::accepted' data-use='r' data-ref="(anonymousstruct)::(anonymous)::accepted" data-ref-filename="(anonymousstruct)..(anonymous)..accepted">accepted</a>,</td></tr>
<tr><th id="1157">1157</th><td>		  <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::rejected" title='(anonymous struct)::(anonymous struct)::rejected' data-use='r' data-ref="(anonymousstruct)::(anonymous)::rejected" data-ref-filename="(anonymousstruct)..(anonymous)..rejected">rejected</a>, <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::malformed" title='(anonymous struct)::(anonymous struct)::malformed' data-use='r' data-ref="(anonymousstruct)::(anonymous)::malformed" data-ref-filename="(anonymousstruct)..(anonymous)..malformed">malformed</a>,</td></tr>
<tr><th id="1158">1158</th><td>		  <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::filtered" title='(anonymous struct)::(anonymous struct)::filtered' data-use='r' data-ref="(anonymousstruct)::(anonymous)::filtered" data-ref-filename="(anonymousstruct)..(anonymous)..filtered">filtered</a>, <a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='m' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a>.<a class="tu ref field" href="#(anonymousstruct)::(anonymous)::pps_used" title='(anonymous struct)::(anonymous struct)::pps_used' data-use='r' data-ref="(anonymousstruct)::(anonymous)::pps_used" data-ref-filename="(anonymousstruct)..(anonymous)..pps_used">pps_used</a>);</td></tr>
<tr><th id="1159">1159</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1160">1160</th><td>		<a class="ref fn" href="../include/ntpd.h.html#record_clock_stats" title='record_clock_stats' data-ref="record_clock_stats" data-ref-filename="record_clock_stats">record_clock_stats</a>(&amp;<a class="local col7 ref" href="#87peer" title='peer' data-ref="87peer" data-ref-filename="87peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>, <a class="local col8 ref" href="#88pp" title='pp' data-ref="88pp" data-ref-filename="88pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>);</td></tr>
<tr><th id="1161">1161</th><td>	}</td></tr>
<tr><th id="1162">1162</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(up-&gt;tally), sizeof(up-&gt;tally))" data-ref="_M/ZERO">ZERO</a>(<a class="local col9 ref" href="#89up" title='up' data-ref="89up" data-ref-filename="89up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='a' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally"><a class="tu ref field" href="#(anonymous)::tally" title='(anonymous struct)::tally' data-use='r' data-ref="(anonymous)::tally" data-ref-filename="(anonymous)..tally">tally</a></a>);</td></tr>
<tr><th id="1163">1163</th><td>}</td></tr>
<tr><th id="1164">1164</th><td></td></tr>
<tr><th id="1165">1165</th><td><i  data-doc="save_ltc">/*</i></td></tr>
<tr><th id="1166">1166</th><td><i  data-doc="save_ltc"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1167">1167</th><td><i  data-doc="save_ltc"> * Save the last timecode string, making sure it's properly truncated</i></td></tr>
<tr><th id="1168">1168</th><td><i  data-doc="save_ltc"> * if necessary and NUL terminated in any case.</i></td></tr>
<tr><th id="1169">1169</th><td><i  data-doc="save_ltc"> */</i></td></tr>
<tr><th id="1170">1170</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1171">1171</th><td><dfn class="tu decl def fn" id="save_ltc" title='save_ltc' data-type='void save_ltc(struct refclockproc *const pp, const char *const tc, size_t len)' data-ref="save_ltc" data-ref-filename="save_ltc">save_ltc</dfn>(</td></tr>
<tr><th id="1172">1172</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col1 decl" id="91pp" title='pp' data-type='struct refclockproc *const' data-ref="91pp" data-ref-filename="91pp">pp</dfn>,</td></tr>
<tr><th id="1173">1173</th><td>	<em>const</em> <em>char</em> * <em>const</em>          <dfn class="local col2 decl" id="92tc" title='tc' data-type='const char *const' data-ref="92tc" data-ref-filename="92tc">tc</dfn>,</td></tr>
<tr><th id="1174">1174</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a>                      <dfn class="local col3 decl" id="93len" title='len' data-type='size_t' data-ref="93len" data-ref-filename="93len">len</dfn></td></tr>
<tr><th id="1175">1175</th><td>	)</td></tr>
<tr><th id="1176">1176</th><td>{</td></tr>
<tr><th id="1177">1177</th><td>	<b>if</b> (<a class="local col3 ref" href="#93len" title='len' data-ref="93len" data-ref-filename="93len">len</a> &gt;= <b>sizeof</b>(<a class="local col1 ref" href="#91pp" title='pp' data-ref="91pp" data-ref-filename="91pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>))</td></tr>
<tr><th id="1178">1178</th><td>		<a class="local col3 ref" href="#93len" title='len' data-ref="93len" data-ref-filename="93len">len</a> = <b>sizeof</b>(<a class="local col1 ref" href="#91pp" title='pp' data-ref="91pp" data-ref-filename="91pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>) - <var>1</var>;</td></tr>
<tr><th id="1179">1179</th><td>	<a class="local col1 ref" href="#91pp" title='pp' data-ref="91pp" data-ref-filename="91pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::lencode" title='refclockproc::lencode' data-ref="refclockproc::lencode" data-ref-filename="refclockproc..lencode">lencode</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>)<a class="local col3 ref" href="#93len" title='len' data-ref="93len" data-ref-filename="93len">len</a>;</td></tr>
<tr><th id="1180">1180</th><td>	<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(<a class="local col1 ref" href="#91pp" title='pp' data-ref="91pp" data-ref-filename="91pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>, <a class="local col2 ref" href="#92tc" title='tc' data-ref="92tc" data-ref-filename="92tc">tc</a>, <a class="local col3 ref" href="#93len" title='len' data-ref="93len" data-ref-filename="93len">len</a>);</td></tr>
<tr><th id="1181">1181</th><td>	<a class="local col1 ref" href="#91pp" title='pp' data-ref="91pp" data-ref-filename="91pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::a_lastcode" title='refclockproc::a_lastcode' data-ref="refclockproc::a_lastcode" data-ref-filename="refclockproc..a_lastcode">a_lastcode</a>[<a class="local col3 ref" href="#93len" title='len' data-ref="93len" data-ref-filename="93len">len</a>] = <kbd>'\0'</kbd>;</td></tr>
<tr><th id="1182">1182</th><td>}</td></tr>
<tr><th id="1183">1183</th><td></td></tr>
<tr><th id="1184">1184</th><td></td></tr>
<tr><th id="1185">1185</th><td><u>#<span data-ppcond="1185">if</span> <a class="macro" href="#29" title="0" data-ref="_M/NMEA_WRITE_SUPPORT">NMEA_WRITE_SUPPORT</a></u></td></tr>
<tr><th id="1186">1186</th><td><i>/*</i></td></tr>
<tr><th id="1187">1187</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1188">1188</th><td><i> *  gps_send(fd, cmd, peer)	Sends a command to the GPS receiver.</i></td></tr>
<tr><th id="1189">1189</th><td><i> *   as in gps_send(fd, "rqts,u", peer);</i></td></tr>
<tr><th id="1190">1190</th><td><i> *</i></td></tr>
<tr><th id="1191">1191</th><td><i> * If 'cmd' starts with a '$' it is assumed that this command is in raw</i></td></tr>
<tr><th id="1192">1192</th><td><i> * format, that is, starts with '$', ends with '&lt;cr&gt;&lt;lf&gt;' and that any</i></td></tr>
<tr><th id="1193">1193</th><td><i> * checksum is correctly provided; the command will be send 'as is' in</i></td></tr>
<tr><th id="1194">1194</th><td><i> * that case. Otherwise the function will create the necessary frame</i></td></tr>
<tr><th id="1195">1195</th><td><i> * (start char, chksum, final CRLF) on the fly.</i></td></tr>
<tr><th id="1196">1196</th><td><i> *</i></td></tr>
<tr><th id="1197">1197</th><td><i> * We don't currently send any data, but would like to send RTCM SC104</i></td></tr>
<tr><th id="1198">1198</th><td><i> * messages for differential positioning. It should also give us better</i></td></tr>
<tr><th id="1199">1199</th><td><i> * time. Without a PPS output, we're Just fooling ourselves because of</i></td></tr>
<tr><th id="1200">1200</th><td><i> * the serial code paths</i></td></tr>
<tr><th id="1201">1201</th><td><i> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1202">1202</th><td><i> */</i></td></tr>
<tr><th id="1203">1203</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1204">1204</th><td>gps_send(</td></tr>
<tr><th id="1205">1205</th><td>	<em>int</em>           fd,</td></tr>
<tr><th id="1206">1206</th><td>	<em>const</em> <em>char</em>  * cmd,</td></tr>
<tr><th id="1207">1207</th><td>	<b>struct</b> peer * peer</td></tr>
<tr><th id="1208">1208</th><td>	)</td></tr>
<tr><th id="1209">1209</th><td>{</td></tr>
<tr><th id="1210">1210</th><td>	<i>/* $...*xy&lt;CR&gt;&lt;LF&gt;&lt;NUL&gt; add 7 */</i></td></tr>
<tr><th id="1211">1211</th><td>	<em>char</em>	      buf[NMEA_PROTO_MAXLEN + <var>7</var>];</td></tr>
<tr><th id="1212">1212</th><td>	<em>int</em>	      len;</td></tr>
<tr><th id="1213">1213</th><td>	u_char	      dcs;</td></tr>
<tr><th id="1214">1214</th><td>	<em>const</em> u_char *beg, *end;</td></tr>
<tr><th id="1215">1215</th><td></td></tr>
<tr><th id="1216">1216</th><td>	<b>if</b> (*cmd != <kbd>'$'</kbd>) {</td></tr>
<tr><th id="1217">1217</th><td>		<i>/* get checksum and length */</i></td></tr>
<tr><th id="1218">1218</th><td>		beg = end = (<em>const</em> u_char*)cmd;</td></tr>
<tr><th id="1219">1219</th><td>		dcs = <var>0</var>;</td></tr>
<tr><th id="1220">1220</th><td>		<b>while</b> (*end &gt;= <kbd>' '</kbd> &amp;&amp; *end != <kbd>'*'</kbd>)</td></tr>
<tr><th id="1221">1221</th><td>			dcs ^= *end++;</td></tr>
<tr><th id="1222">1222</th><td>		len = end - beg;</td></tr>
<tr><th id="1223">1223</th><td>		<i>/* format into output buffer with overflow check */</i></td></tr>
<tr><th id="1224">1224</th><td>		len = snprintf(buf, <b>sizeof</b>(buf), <q>"$%.*s*%02X\r\n"</q>,</td></tr>
<tr><th id="1225">1225</th><td>			       len, beg, dcs);</td></tr>
<tr><th id="1226">1226</th><td>		<b>if</b> ((size_t)len &gt;= <b>sizeof</b>(buf)) {</td></tr>
<tr><th id="1227">1227</th><td>			DPRINTF(<var>1</var>, (<q>"%s gps_send: buffer overflow for command '%s'\n"</q>,</td></tr>
<tr><th id="1228">1228</th><td>				    refnumtoa(&amp;peer-&gt;srcadr), cmd));</td></tr>
<tr><th id="1229">1229</th><td>			<b>return</b>;	<i>/* game over player 1 */</i></td></tr>
<tr><th id="1230">1230</th><td>		}</td></tr>
<tr><th id="1231">1231</th><td>		cmd = buf;</td></tr>
<tr><th id="1232">1232</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1233">1233</th><td>		len = strlen(cmd);</td></tr>
<tr><th id="1234">1234</th><td>	}</td></tr>
<tr><th id="1235">1235</th><td></td></tr>
<tr><th id="1236">1236</th><td>	DPRINTF(<var>1</var>, (<q>"%s gps_send: '%.*s'\n"</q>, refnumtoa(&amp;peer-&gt;srcadr),</td></tr>
<tr><th id="1237">1237</th><td>		len - <var>2</var>, cmd));</td></tr>
<tr><th id="1238">1238</th><td></td></tr>
<tr><th id="1239">1239</th><td>	<i>/* send out the whole stuff */</i></td></tr>
<tr><th id="1240">1240</th><td>	<b>if</b> (write(fd, cmd, len) == -<var>1</var>)</td></tr>
<tr><th id="1241">1241</th><td>		refclock_report(peer, CEVNT_FAULT);</td></tr>
<tr><th id="1242">1242</th><td>}</td></tr>
<tr><th id="1243">1243</th><td><u>#<span data-ppcond="1185">endif</span> /* NMEA_WRITE_SUPPORT */</u></td></tr>
<tr><th id="1244">1244</th><td></td></tr>
<tr><th id="1245">1245</th><td><i  data-doc="field_init">/*</i></td></tr>
<tr><th id="1246">1246</th><td><i  data-doc="field_init"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1247">1247</th><td><i  data-doc="field_init"> * helpers for faster field splitting</i></td></tr>
<tr><th id="1248">1248</th><td><i  data-doc="field_init"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1249">1249</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1250">1250</th><td><i  data-doc="field_init"> * set up a field record, check syntax and verify checksum</i></td></tr>
<tr><th id="1251">1251</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1252">1252</th><td><i  data-doc="field_init"> * format is $XXXXX,1,2,3,4*ML</i></td></tr>
<tr><th id="1253">1253</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1254">1254</th><td><i  data-doc="field_init"> * 8-bit XOR of characters between $ and * noninclusive is transmitted</i></td></tr>
<tr><th id="1255">1255</th><td><i  data-doc="field_init"> * in last two chars M and L holding most and least significant nibbles</i></td></tr>
<tr><th id="1256">1256</th><td><i  data-doc="field_init"> * in hex representation such as:</i></td></tr>
<tr><th id="1257">1257</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1258">1258</th><td><i  data-doc="field_init"> *   $GPGLL,5057.970,N,00146.110,E,142451,A*27</i></td></tr>
<tr><th id="1259">1259</th><td><i  data-doc="field_init"> *   $GPVTG,089.0,T,,,15.2,N,,*7F</i></td></tr>
<tr><th id="1260">1260</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1261">1261</th><td><i  data-doc="field_init"> * Some other constraints:</i></td></tr>
<tr><th id="1262">1262</th><td><i  data-doc="field_init"> * + The field name must at least 5 upcase characters or digits and must</i></td></tr>
<tr><th id="1263">1263</th><td><i  data-doc="field_init"> *   start with a character.</i></td></tr>
<tr><th id="1264">1264</th><td><i  data-doc="field_init"> * + The checksum (if present) must be uppercase hex digits.</i></td></tr>
<tr><th id="1265">1265</th><td><i  data-doc="field_init"> * + The length of a sentence is limited to 80 characters (not including</i></td></tr>
<tr><th id="1266">1266</th><td><i  data-doc="field_init"> *   the final CR/LF nor the checksum, but including the leading '$')</i></td></tr>
<tr><th id="1267">1267</th><td><i  data-doc="field_init"> *</i></td></tr>
<tr><th id="1268">1268</th><td><i  data-doc="field_init"> * Return values:</i></td></tr>
<tr><th id="1269">1269</th><td><i  data-doc="field_init"> *  + CHECK_INVALID</i></td></tr>
<tr><th id="1270">1270</th><td><i  data-doc="field_init"> *	The data does not form a valid NMEA sentence or a checksum error</i></td></tr>
<tr><th id="1271">1271</th><td><i  data-doc="field_init"> *	occurred.</i></td></tr>
<tr><th id="1272">1272</th><td><i  data-doc="field_init"> *  + CHECK_VALID</i></td></tr>
<tr><th id="1273">1273</th><td><i  data-doc="field_init"> *	The data is a valid NMEA sentence but contains no checksum.</i></td></tr>
<tr><th id="1274">1274</th><td><i  data-doc="field_init"> *  + CHECK_CSVALID</i></td></tr>
<tr><th id="1275">1275</th><td><i  data-doc="field_init"> *	The data is a valid NMEA sentence and passed the checksum test.</i></td></tr>
<tr><th id="1276">1276</th><td><i  data-doc="field_init"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1277">1277</th><td><i  data-doc="field_init"> */</i></td></tr>
<tr><th id="1278">1278</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1279">1279</th><td><dfn class="tu decl def fn" id="field_init" title='field_init' data-type='int field_init(nmea_data * data, char * cptr, int dlen)' data-ref="field_init" data-ref-filename="field_init">field_init</dfn>(</td></tr>
<tr><th id="1280">1280</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col4 decl" id="94data" title='data' data-type='nmea_data *' data-ref="94data" data-ref-filename="94data">data</dfn>,	<i>/* context structure		       */</i></td></tr>
<tr><th id="1281">1281</th><td>	<em>char</em> 	  * <dfn class="local col5 decl" id="95cptr" title='cptr' data-type='char *' data-ref="95cptr" data-ref-filename="95cptr">cptr</dfn>,	<i>/* start of raw data		       */</i></td></tr>
<tr><th id="1282">1282</th><td>	<em>int</em>	    <dfn class="local col6 decl" id="96dlen" title='dlen' data-type='int' data-ref="96dlen" data-ref-filename="96dlen">dlen</dfn>	<i>/* data len, not counting trailing NUL */</i></td></tr>
<tr><th id="1283">1283</th><td>	)</td></tr>
<tr><th id="1284">1284</th><td>{</td></tr>
<tr><th id="1285">1285</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a> <dfn class="local col7 decl" id="97cs_l" title='cs_l' data-type='u_char' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</dfn>;	<i>/* checksum local computed	*/</i></td></tr>
<tr><th id="1286">1286</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a> <dfn class="local col8 decl" id="98cs_r" title='cs_r' data-type='u_char' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</dfn>;	<i>/* checksum remote given	*/</i></td></tr>
<tr><th id="1287">1287</th><td>	<em>char</em> * <dfn class="local col9 decl" id="99eptr" title='eptr' data-type='char *' data-ref="99eptr" data-ref-filename="99eptr">eptr</dfn>;	<i>/* buffer end end pointer	*/</i></td></tr>
<tr><th id="1288">1288</th><td>	<em>char</em>   <dfn class="local col0 decl" id="100tmp" title='tmp' data-type='char' data-ref="100tmp" data-ref-filename="100tmp">tmp</dfn>;	<i>/* char buffer 			*/</i></td></tr>
<tr><th id="1289">1289</th><td>	</td></tr>
<tr><th id="1290">1290</th><td>	<a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> = <var>0</var>;</td></tr>
<tr><th id="1291">1291</th><td>	<a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a> = <var>0</var>;</td></tr>
<tr><th id="1292">1292</th><td>	<i>/* some basic input constraints */</i></td></tr>
<tr><th id="1293">1293</th><td>	<b>if</b> (<a class="local col6 ref" href="#96dlen" title='dlen' data-ref="96dlen" data-ref-filename="96dlen">dlen</a> &lt; <var>0</var>)</td></tr>
<tr><th id="1294">1294</th><td>		<a class="local col6 ref" href="#96dlen" title='dlen' data-ref="96dlen" data-ref-filename="96dlen">dlen</a> = <var>0</var>;</td></tr>
<tr><th id="1295">1295</th><td>	<a class="local col9 ref" href="#99eptr" title='eptr' data-ref="99eptr" data-ref-filename="99eptr">eptr</a> = <a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> + <a class="local col6 ref" href="#96dlen" title='dlen' data-ref="96dlen" data-ref-filename="96dlen">dlen</a>;</td></tr>
<tr><th id="1296">1296</th><td>	*<a class="local col9 ref" href="#99eptr" title='eptr' data-ref="99eptr" data-ref-filename="99eptr">eptr</a> = <kbd>'\0'</kbd>;</td></tr>
<tr><th id="1297">1297</th><td>	</td></tr>
<tr><th id="1298">1298</th><td>	<i>/* load data context */</i>	</td></tr>
<tr><th id="1299">1299</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='w' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a> = <a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>;</td></tr>
<tr><th id="1300">1300</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='w' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a> = <a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>;</td></tr>
<tr><th id="1301">1301</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cidx" title='(anonymous struct)::cidx' data-use='w' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</a> = <var>0</var>;</td></tr>
<tr><th id="1302">1302</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::blen" title='(anonymous struct)::blen' data-use='w' data-ref="(anonymous)::blen" data-ref-filename="(anonymous)..blen">blen</a> = <a class="local col6 ref" href="#96dlen" title='dlen' data-ref="96dlen" data-ref-filename="96dlen">dlen</a>;</td></tr>
<tr><th id="1303">1303</th><td></td></tr>
<tr><th id="1304">1304</th><td>	<i>/* syntax check follows here. check allowed character</i></td></tr>
<tr><th id="1305">1305</th><td><i>	 * sequences, updating the local computed checksum as we go.</i></td></tr>
<tr><th id="1306">1306</th><td><i>	 *</i></td></tr>
<tr><th id="1307">1307</th><td><i>	 * regex equiv: '^\$[A-Z][A-Z0-9]{4,}[^*]*(\*[0-9A-F]{2})?$'</i></td></tr>
<tr><th id="1308">1308</th><td><i>	 */</i></td></tr>
<tr><th id="1309">1309</th><td></td></tr>
<tr><th id="1310">1310</th><td>	<i>/* -*- start character: '^\$' */</i></td></tr>
<tr><th id="1311">1311</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> == <kbd>'\0'</kbd>)</td></tr>
<tr><th id="1312">1312</th><td>		<b>return</b> <a class="macro" href="#219" title="-1" data-ref="_M/CHECK_EMPTY">CHECK_EMPTY</a>;</td></tr>
<tr><th id="1313">1313</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++ != <kbd>'$'</kbd>)</td></tr>
<tr><th id="1314">1314</th><td>		<b>return</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>;</td></tr>
<tr><th id="1315">1315</th><td></td></tr>
<tr><th id="1316">1316</th><td>	<i>/* -*- advance context beyond start character */</i></td></tr>
<tr><th id="1317">1317</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='w' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a>++;</td></tr>
<tr><th id="1318">1318</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='w' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a>++;</td></tr>
<tr><th id="1319">1319</th><td>	<a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::blen" title='(anonymous struct)::blen' data-use='w' data-ref="(anonymous)::blen" data-ref-filename="(anonymous)..blen">blen</a>--;</td></tr>
<tr><th id="1320">1320</th><td>	</td></tr>
<tr><th id="1321">1321</th><td>	<i>/* -*- field name: '[A-Z][A-Z0-9]{4,},' */</i></td></tr>
<tr><th id="1322">1322</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &lt; <kbd>'A'</kbd> || *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &gt; <kbd>'Z'</kbd>)</td></tr>
<tr><th id="1323">1323</th><td>		<b>return</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>;</td></tr>
<tr><th id="1324">1324</th><td>	<a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> ^= *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++;</td></tr>
<tr><th id="1325">1325</th><td>	<b>while</b> ((*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &gt;= <kbd>'A'</kbd> &amp;&amp; *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &lt;= <kbd>'Z'</kbd>) ||</td></tr>
<tr><th id="1326">1326</th><td>	       (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &gt;= <kbd>'0'</kbd> &amp;&amp; *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &lt;= <kbd>'9'</kbd>)  )</td></tr>
<tr><th id="1327">1327</th><td>		<a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> ^= *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++;</td></tr>
<tr><th id="1328">1328</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> != <kbd>','</kbd> || (<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> - <a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='r' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a>) &lt; <a class="macro" href="#98" title="5" data-ref="_M/NMEA_PROTO_IDLEN">NMEA_PROTO_IDLEN</a>)</td></tr>
<tr><th id="1329">1329</th><td>		<b>return</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>;</td></tr>
<tr><th id="1330">1330</th><td>	<a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> ^= *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++;</td></tr>
<tr><th id="1331">1331</th><td></td></tr>
<tr><th id="1332">1332</th><td>	<i>/* -*- data: '[^*]*' */</i></td></tr>
<tr><th id="1333">1333</th><td>	<b>while</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> &amp;&amp; *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> != <kbd>'*'</kbd>)</td></tr>
<tr><th id="1334">1334</th><td>		<a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> ^= *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++;</td></tr>
<tr><th id="1335">1335</th><td>	</td></tr>
<tr><th id="1336">1336</th><td>	<i>/* -*- checksum field: (\*[0-9A-F]{2})?$ */</i></td></tr>
<tr><th id="1337">1337</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> == <kbd>'\0'</kbd>)</td></tr>
<tr><th id="1338">1338</th><td>		<b>return</b> <a class="macro" href="#221" title="1" data-ref="_M/CHECK_VALID">CHECK_VALID</a>;</td></tr>
<tr><th id="1339">1339</th><td>	<b>if</b> (*<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> != <kbd>'*'</kbd> || <a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> != <a class="local col9 ref" href="#99eptr" title='eptr' data-ref="99eptr" data-ref-filename="99eptr">eptr</a> - <var>3</var> ||</td></tr>
<tr><th id="1340">1340</th><td>	    (<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> - <a class="local col4 ref" href="#94data" title='data' data-ref="94data" data-ref-filename="94data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='r' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a>) &gt;= <a class="macro" href="#100" title="80" data-ref="_M/NMEA_PROTO_MAXLEN">NMEA_PROTO_MAXLEN</a>)</td></tr>
<tr><th id="1341">1341</th><td>		<b>return</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>;</td></tr>
<tr><th id="1342">1342</th><td></td></tr>
<tr><th id="1343">1343</th><td>	<b>for</b> (<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++; (<a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> = *<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>) != <kbd>'\0'</kbd>; <a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a>++) {</td></tr>
<tr><th id="1344">1344</th><td>		<b>if</b> (<a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> &gt;= <kbd>'0'</kbd> &amp;&amp; <a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> &lt;= <kbd>'9'</kbd>)</td></tr>
<tr><th id="1345">1345</th><td>			<a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a> = (<a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a> &lt;&lt; <var>4</var>) + (<a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> - <kbd>'0'</kbd>);</td></tr>
<tr><th id="1346">1346</th><td>		<b>else</b> <b>if</b> (<a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> &gt;= <kbd>'A'</kbd> &amp;&amp; <a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> &lt;= <kbd>'F'</kbd>)</td></tr>
<tr><th id="1347">1347</th><td>			<a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a> = (<a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a> &lt;&lt; <var>4</var>) + (<a class="local col0 ref" href="#100tmp" title='tmp' data-ref="100tmp" data-ref-filename="100tmp">tmp</a> - <kbd>'A'</kbd> + <var>10</var>);</td></tr>
<tr><th id="1348">1348</th><td>		<b>else</b></td></tr>
<tr><th id="1349">1349</th><td>			<b>break</b>;</td></tr>
<tr><th id="1350">1350</th><td>	}</td></tr>
<tr><th id="1351">1351</th><td></td></tr>
<tr><th id="1352">1352</th><td>	<i>/* -*- make sure we are at end of string and csum matches */</i></td></tr>
<tr><th id="1353">1353</th><td>	<b>if</b> (<a class="local col5 ref" href="#95cptr" title='cptr' data-ref="95cptr" data-ref-filename="95cptr">cptr</a> != <a class="local col9 ref" href="#99eptr" title='eptr' data-ref="99eptr" data-ref-filename="99eptr">eptr</a> || <a class="local col7 ref" href="#97cs_l" title='cs_l' data-ref="97cs_l" data-ref-filename="97cs_l">cs_l</a> != <a class="local col8 ref" href="#98cs_r" title='cs_r' data-ref="98cs_r" data-ref-filename="98cs_r">cs_r</a>)</td></tr>
<tr><th id="1354">1354</th><td>		<b>return</b> <a class="macro" href="#220" title="0" data-ref="_M/CHECK_INVALID">CHECK_INVALID</a>;</td></tr>
<tr><th id="1355">1355</th><td></td></tr>
<tr><th id="1356">1356</th><td>	<b>return</b> <a class="macro" href="#222" title="2" data-ref="_M/CHECK_CSVALID">CHECK_CSVALID</a>;</td></tr>
<tr><th id="1357">1357</th><td>}</td></tr>
<tr><th id="1358">1358</th><td></td></tr>
<tr><th id="1359">1359</th><td><i  data-doc="field_parse">/*</i></td></tr>
<tr><th id="1360">1360</th><td><i  data-doc="field_parse"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1361">1361</th><td><i  data-doc="field_parse"> * fetch a data field by index, zero being the name field. If this</i></td></tr>
<tr><th id="1362">1362</th><td><i  data-doc="field_parse"> * function is called repeatedly with increasing indices, the total load</i></td></tr>
<tr><th id="1363">1363</th><td><i  data-doc="field_parse"> * is O(n), n being the length of the string; if it is called with</i></td></tr>
<tr><th id="1364">1364</th><td><i  data-doc="field_parse"> * decreasing indices, the total load is O(n^2). Try not to go backwards</i></td></tr>
<tr><th id="1365">1365</th><td><i  data-doc="field_parse"> * too often.</i></td></tr>
<tr><th id="1366">1366</th><td><i  data-doc="field_parse"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1367">1367</th><td><i  data-doc="field_parse"> */</i></td></tr>
<tr><th id="1368">1368</th><td><em>static</em> <em>char</em> *</td></tr>
<tr><th id="1369">1369</th><td><dfn class="tu decl def fn" id="field_parse" title='field_parse' data-type='char * field_parse(nmea_data * data, int fn)' data-ref="field_parse" data-ref-filename="field_parse">field_parse</dfn>(</td></tr>
<tr><th id="1370">1370</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col1 decl" id="101data" title='data' data-type='nmea_data *' data-ref="101data" data-ref-filename="101data">data</dfn>,</td></tr>
<tr><th id="1371">1371</th><td>	<em>int</em> 	    <dfn class="local col2 decl" id="102fn" title='fn' data-type='int' data-ref="102fn" data-ref-filename="102fn">fn</dfn></td></tr>
<tr><th id="1372">1372</th><td>	)</td></tr>
<tr><th id="1373">1373</th><td>{</td></tr>
<tr><th id="1374">1374</th><td>	<em>char</em> <dfn class="local col3 decl" id="103tmp" title='tmp' data-type='char' data-ref="103tmp" data-ref-filename="103tmp">tmp</dfn>;</td></tr>
<tr><th id="1375">1375</th><td></td></tr>
<tr><th id="1376">1376</th><td>	<b>if</b> (<a class="local col2 ref" href="#102fn" title='fn' data-ref="102fn" data-ref-filename="102fn">fn</a> &lt; <a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cidx" title='(anonymous struct)::cidx' data-use='r' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</a>) {</td></tr>
<tr><th id="1377">1377</th><td>		<a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cidx" title='(anonymous struct)::cidx' data-use='w' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</a> = <var>0</var>;</td></tr>
<tr><th id="1378">1378</th><td>		<a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='w' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a> = <a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='r' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a>;</td></tr>
<tr><th id="1379">1379</th><td>	}</td></tr>
<tr><th id="1380">1380</th><td>	<b>while</b> ((<a class="local col2 ref" href="#102fn" title='fn' data-ref="102fn" data-ref-filename="102fn">fn</a> &gt; <a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cidx" title='(anonymous struct)::cidx' data-use='r' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</a>) &amp;&amp; (<a class="local col3 ref" href="#103tmp" title='tmp' data-ref="103tmp" data-ref-filename="103tmp">tmp</a> = *<a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='r' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a>) != <kbd>'\0'</kbd>) {</td></tr>
<tr><th id="1381">1381</th><td>		<a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cidx" title='(anonymous struct)::cidx' data-use='w' data-ref="(anonymous)::cidx" data-ref-filename="(anonymous)..cidx">cidx</a> += (<a class="local col3 ref" href="#103tmp" title='tmp' data-ref="103tmp" data-ref-filename="103tmp">tmp</a> == <kbd>','</kbd>);</td></tr>
<tr><th id="1382">1382</th><td>		<a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='w' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a>++;</td></tr>
<tr><th id="1383">1383</th><td>	}</td></tr>
<tr><th id="1384">1384</th><td>	<b>return</b> <a class="local col1 ref" href="#101data" title='data' data-ref="101data" data-ref-filename="101data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::cptr" title='(anonymous struct)::cptr' data-use='r' data-ref="(anonymous)::cptr" data-ref-filename="(anonymous)..cptr">cptr</a>;</td></tr>
<tr><th id="1385">1385</th><td>}</td></tr>
<tr><th id="1386">1386</th><td></td></tr>
<tr><th id="1387">1387</th><td><i  data-doc="field_wipe">/*</i></td></tr>
<tr><th id="1388">1388</th><td><i  data-doc="field_wipe"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1389">1389</th><td><i  data-doc="field_wipe"> * Wipe (that is, overwrite with '_') data fields and the checksum in</i></td></tr>
<tr><th id="1390">1390</th><td><i  data-doc="field_wipe"> * the last timecode.  The list of field indices is given as integers</i></td></tr>
<tr><th id="1391">1391</th><td><i  data-doc="field_wipe"> * in a varargs list, preferrably in ascending order, in any case</i></td></tr>
<tr><th id="1392">1392</th><td><i  data-doc="field_wipe"> * terminated by a negative field index.</i></td></tr>
<tr><th id="1393">1393</th><td><i  data-doc="field_wipe"> *</i></td></tr>
<tr><th id="1394">1394</th><td><i  data-doc="field_wipe"> * A maximum number of 8 fields can be overwritten at once to guard</i></td></tr>
<tr><th id="1395">1395</th><td><i  data-doc="field_wipe"> * against runaway (that is, unterminated) argument lists.</i></td></tr>
<tr><th id="1396">1396</th><td><i  data-doc="field_wipe"> *</i></td></tr>
<tr><th id="1397">1397</th><td><i  data-doc="field_wipe"> * This function affects what a remote user can see with</i></td></tr>
<tr><th id="1398">1398</th><td><i  data-doc="field_wipe"> *</i></td></tr>
<tr><th id="1399">1399</th><td><i  data-doc="field_wipe"> * ntpq -c clockvar &lt;server&gt;</i></td></tr>
<tr><th id="1400">1400</th><td><i  data-doc="field_wipe"> *</i></td></tr>
<tr><th id="1401">1401</th><td><i  data-doc="field_wipe"> * Note that this also removes the wiped fields from any clockstats</i></td></tr>
<tr><th id="1402">1402</th><td><i  data-doc="field_wipe"> * log.	 Some NTP operators monitor their NMEA GPS using the change in</i></td></tr>
<tr><th id="1403">1403</th><td><i  data-doc="field_wipe"> * location in clockstats over time as as a proxy for the quality of</i></td></tr>
<tr><th id="1404">1404</th><td><i  data-doc="field_wipe"> * GPS reception and thereby time reported.</i></td></tr>
<tr><th id="1405">1405</th><td><i  data-doc="field_wipe"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1406">1406</th><td><i  data-doc="field_wipe"> */</i></td></tr>
<tr><th id="1407">1407</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1408">1408</th><td><dfn class="tu decl def fn" id="field_wipe" title='field_wipe' data-type='void field_wipe(nmea_data * data)' data-ref="field_wipe" data-ref-filename="field_wipe">field_wipe</dfn>(</td></tr>
<tr><th id="1409">1409</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col4 decl" id="104data" title='data' data-type='nmea_data *' data-ref="104data" data-ref-filename="104data">data</dfn>,</td></tr>
<tr><th id="1410">1410</th><td>	...</td></tr>
<tr><th id="1411">1411</th><td>	)</td></tr>
<tr><th id="1412">1412</th><td>{</td></tr>
<tr><th id="1413">1413</th><td>	<span class='typedef' title='va_list' data-type='__builtin_va_list' data-ref="va_list" data-ref-filename="va_list">va_list</span>	<dfn class="local col5 decl" id="105va" title='va' data-type='va_list' data-ref="105va" data-ref-filename="105va">va</dfn>;		<i>/* vararg index list */</i></td></tr>
<tr><th id="1414">1414</th><td>	<em>int</em>	<dfn class="local col6 decl" id="106fcnt" title='fcnt' data-type='int' data-ref="106fcnt" data-ref-filename="106fcnt">fcnt</dfn>;		<i>/* safeguard against runaway arglist */</i></td></tr>
<tr><th id="1415">1415</th><td>	<em>int</em>	<dfn class="local col7 decl" id="107fidx" title='fidx' data-type='int' data-ref="107fidx" data-ref-filename="107fidx">fidx</dfn>;		<i>/* field to nuke, or -1 for checksum */</i></td></tr>
<tr><th id="1416">1416</th><td>	<em>char</em>  * <dfn class="local col8 decl" id="108cp" title='cp' data-type='char *' data-ref="108cp" data-ref-filename="108cp">cp</dfn>;		<i>/* overwrite destination */</i></td></tr>
<tr><th id="1417">1417</th><td>	</td></tr>
<tr><th id="1418">1418</th><td>	<a class="local col6 ref" href="#106fcnt" title='fcnt' data-ref="106fcnt" data-ref-filename="106fcnt">fcnt</a> = <var>8</var>;</td></tr>
<tr><th id="1419">1419</th><td>	<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="1420">1420</th><td>	<span class="macro" title="__builtin_va_start(va, data)" data-ref="_M/va_start">va_start</span>(<a class="local col5 ref" href="#105va" title='va' data-ref="105va" data-ref-filename="105va">va</a>, <a class="local col4 ref" href="#104data" title='data' data-ref="104data" data-ref-filename="104data">data</a>);</td></tr>
<tr><th id="1421">1421</th><td>	<b>do</b> {</td></tr>
<tr><th id="1422">1422</th><td>		<a class="local col7 ref" href="#107fidx" title='fidx' data-ref="107fidx" data-ref-filename="107fidx">fidx</a> = <span class="macro" title="__builtin_va_arg(va, int)" data-ref="_M/va_arg">va_arg</span>(<a class="local col5 ref" href="#105va" title='va' data-ref="105va" data-ref-filename="105va">va</a>, <em>int</em>);</td></tr>
<tr><th id="1423">1423</th><td>		<b>if</b> (<a class="local col7 ref" href="#107fidx" title='fidx' data-ref="107fidx" data-ref-filename="107fidx">fidx</a> &gt;= <var>0</var> &amp;&amp; <a class="local col7 ref" href="#107fidx" title='fidx' data-ref="107fidx" data-ref-filename="107fidx">fidx</a> &lt;= <a class="macro" href="#101" title="32" data-ref="_M/NMEA_PROTO_FIELDS">NMEA_PROTO_FIELDS</a>) {</td></tr>
<tr><th id="1424">1424</th><td>			<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> = <a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col4 ref" href="#104data" title='data' data-ref="104data" data-ref-filename="104data">data</a>, <a class="local col7 ref" href="#107fidx" title='fidx' data-ref="107fidx" data-ref-filename="107fidx">fidx</a>);</td></tr>
<tr><th id="1425">1425</th><td>		} <b>else</b> {</td></tr>
<tr><th id="1426">1426</th><td>			<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> = <a class="local col4 ref" href="#104data" title='data' data-ref="104data" data-ref-filename="104data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::base" title='(anonymous struct)::base' data-use='r' data-ref="(anonymous)::base" data-ref-filename="(anonymous)..base">base</a> + <a class="local col4 ref" href="#104data" title='data' data-ref="104data" data-ref-filename="104data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::blen" title='(anonymous struct)::blen' data-use='r' data-ref="(anonymous)::blen" data-ref-filename="(anonymous)..blen">blen</a>;</td></tr>
<tr><th id="1427">1427</th><td>			<b>if</b> (<a class="local col4 ref" href="#104data" title='data' data-ref="104data" data-ref-filename="104data">data</a>-&gt;<a class="tu ref field" href="#(anonymous)::blen" title='(anonymous struct)::blen' data-use='r' data-ref="(anonymous)::blen" data-ref-filename="(anonymous)..blen">blen</a> &gt;= <var>3</var> &amp;&amp; <a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a>[-<var>3</var>] == <kbd>'*'</kbd>)</td></tr>
<tr><th id="1428">1428</th><td>				<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> -= <var>2</var>;</td></tr>
<tr><th id="1429">1429</th><td>		}</td></tr>
<tr><th id="1430">1430</th><td>		<b>for</b> ( ; <kbd>'\0'</kbd> != *<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> &amp;&amp; <kbd>'*'</kbd> != *<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> &amp;&amp; <kbd>','</kbd> != *<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a>; <a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a>++)</td></tr>
<tr><th id="1431">1431</th><td>			<b>if</b> (<kbd>'.'</kbd> != *<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a>)</td></tr>
<tr><th id="1432">1432</th><td>				*<a class="local col8 ref" href="#108cp" title='cp' data-ref="108cp" data-ref-filename="108cp">cp</a> = <kbd>'_'</kbd>;</td></tr>
<tr><th id="1433">1433</th><td>	} <b>while</b> (<a class="local col6 ref" href="#106fcnt" title='fcnt' data-ref="106fcnt" data-ref-filename="106fcnt">fcnt</a>-- &amp;&amp; <a class="local col7 ref" href="#107fidx" title='fidx' data-ref="107fidx" data-ref-filename="107fidx">fidx</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="1434">1434</th><td>	<span class="macro" title="__builtin_va_end(va)" data-ref="_M/va_end">va_end</span>(<a class="local col5 ref" href="#105va" title='va' data-ref="105va" data-ref-filename="105va">va</a>);	</td></tr>
<tr><th id="1435">1435</th><td>}</td></tr>
<tr><th id="1436">1436</th><td></td></tr>
<tr><th id="1437">1437</th><td><i  data-doc="parse_qual">/*</i></td></tr>
<tr><th id="1438">1438</th><td><i  data-doc="parse_qual"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1439">1439</th><td><i  data-doc="parse_qual"> * PARSING HELPERS</i></td></tr>
<tr><th id="1440">1440</th><td><i  data-doc="parse_qual"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1441">1441</th><td><i  data-doc="parse_qual"> *</i></td></tr>
<tr><th id="1442">1442</th><td><i  data-doc="parse_qual"> * Check sync status</i></td></tr>
<tr><th id="1443">1443</th><td><i  data-doc="parse_qual"> *</i></td></tr>
<tr><th id="1444">1444</th><td><i  data-doc="parse_qual"> * If the character at the data field start matches the tag value,</i></td></tr>
<tr><th id="1445">1445</th><td><i  data-doc="parse_qual"> * return LEAP_NOWARNING and LEAP_NOTINSYNC otherwise. If the 'inverted'</i></td></tr>
<tr><th id="1446">1446</th><td><i  data-doc="parse_qual"> * flag is given, just the opposite value is returned. If there is no</i></td></tr>
<tr><th id="1447">1447</th><td><i  data-doc="parse_qual"> * data field (*cp points to the NUL byte) the result is LEAP_NOTINSYNC.</i></td></tr>
<tr><th id="1448">1448</th><td><i  data-doc="parse_qual"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1449">1449</th><td><i  data-doc="parse_qual"> */</i></td></tr>
<tr><th id="1450">1450</th><td><em>static</em> <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a></td></tr>
<tr><th id="1451">1451</th><td><dfn class="tu decl def fn" id="parse_qual" title='parse_qual' data-type='u_char parse_qual(nmea_data * rd, int idx, char tag, int inv)' data-ref="parse_qual" data-ref-filename="parse_qual">parse_qual</dfn>(</td></tr>
<tr><th id="1452">1452</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a> * <dfn class="local col9 decl" id="109rd" title='rd' data-type='nmea_data *' data-ref="109rd" data-ref-filename="109rd">rd</dfn>,</td></tr>
<tr><th id="1453">1453</th><td>	<em>int</em>         <dfn class="local col0 decl" id="110idx" title='idx' data-type='int' data-ref="110idx" data-ref-filename="110idx">idx</dfn>,</td></tr>
<tr><th id="1454">1454</th><td>	<em>char</em>        <dfn class="local col1 decl" id="111tag" title='tag' data-type='char' data-ref="111tag" data-ref-filename="111tag">tag</dfn>,</td></tr>
<tr><th id="1455">1455</th><td>	<em>int</em>         <dfn class="local col2 decl" id="112inv" title='inv' data-type='int' data-ref="112inv" data-ref-filename="112inv">inv</dfn></td></tr>
<tr><th id="1456">1456</th><td>	)</td></tr>
<tr><th id="1457">1457</th><td>{</td></tr>
<tr><th id="1458">1458</th><td>	<em>static</em> <em>const</em> <a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a> <dfn class="local col3 decl" id="113table" title='table' data-type='const u_char [2]' data-ref="113table" data-ref-filename="113table">table</dfn>[<var>2</var>] =</td></tr>
<tr><th id="1459">1459</th><td>				{ <a class="macro" href="../include/ntp.h.html#417" title="0x3" data-ref="_M/LEAP_NOTINSYNC">LEAP_NOTINSYNC</a>, <a class="macro" href="../include/ntp.h.html#414" title="0x0" data-ref="_M/LEAP_NOWARNING">LEAP_NOWARNING</a> };</td></tr>
<tr><th id="1460">1460</th><td>	<em>char</em> * <dfn class="local col4 decl" id="114dp" title='dp' data-type='char *' data-ref="114dp" data-ref-filename="114dp">dp</dfn>;</td></tr>
<tr><th id="1461">1461</th><td></td></tr>
<tr><th id="1462">1462</th><td>	<a class="local col4 ref" href="#114dp" title='dp' data-ref="114dp" data-ref-filename="114dp">dp</a> = <a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col9 ref" href="#109rd" title='rd' data-ref="109rd" data-ref-filename="109rd">rd</a>, <a class="local col0 ref" href="#110idx" title='idx' data-ref="110idx" data-ref-filename="110idx">idx</a>);</td></tr>
<tr><th id="1463">1463</th><td>	</td></tr>
<tr><th id="1464">1464</th><td>	<b>return</b> <a class="local col3 ref" href="#113table" title='table' data-ref="113table" data-ref-filename="113table">table</a>[ *<a class="local col4 ref" href="#114dp" title='dp' data-ref="114dp" data-ref-filename="114dp">dp</a> &amp;&amp; ((*<a class="local col4 ref" href="#114dp" title='dp' data-ref="114dp" data-ref-filename="114dp">dp</a> == <a class="local col1 ref" href="#111tag" title='tag' data-ref="111tag" data-ref-filename="111tag">tag</a>) == !<a class="local col2 ref" href="#112inv" title='inv' data-ref="112inv" data-ref-filename="112inv">inv</a>) ];</td></tr>
<tr><th id="1465">1465</th><td>}</td></tr>
<tr><th id="1466">1466</th><td></td></tr>
<tr><th id="1467">1467</th><td><i  data-doc="parse_time">/*</i></td></tr>
<tr><th id="1468">1468</th><td><i  data-doc="parse_time"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1469">1469</th><td><i  data-doc="parse_time"> * Parse a time stamp in HHMMSS[.sss] format with error checking.</i></td></tr>
<tr><th id="1470">1470</th><td><i  data-doc="parse_time"> *</i></td></tr>
<tr><th id="1471">1471</th><td><i  data-doc="parse_time"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1472">1472</th><td><i  data-doc="parse_time"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1473">1473</th><td><i  data-doc="parse_time"> */</i></td></tr>
<tr><th id="1474">1474</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1475">1475</th><td><dfn class="tu decl def fn" id="parse_time" title='parse_time' data-type='int parse_time(struct calendar * jd, long * ns, nmea_data * rd, int idx)' data-ref="parse_time" data-ref-filename="parse_time">parse_time</dfn>(</td></tr>
<tr><th id="1476">1476</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col5 decl" id="115jd" title='jd' data-type='struct calendar *' data-ref="115jd" data-ref-filename="115jd">jd</dfn>,	<i>/* result calendar pointer */</i></td></tr>
<tr><th id="1477">1477</th><td>	<em>long</em>		* <dfn class="local col6 decl" id="116ns" title='ns' data-type='long *' data-ref="116ns" data-ref-filename="116ns">ns</dfn>,	<i>/* storage for nsec fraction */</i></td></tr>
<tr><th id="1478">1478</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a>       * <dfn class="local col7 decl" id="117rd" title='rd' data-type='nmea_data *' data-ref="117rd" data-ref-filename="117rd">rd</dfn>,</td></tr>
<tr><th id="1479">1479</th><td>	<em>int</em>		  <dfn class="local col8 decl" id="118idx" title='idx' data-type='int' data-ref="118idx" data-ref-filename="118idx">idx</dfn></td></tr>
<tr><th id="1480">1480</th><td>	)</td></tr>
<tr><th id="1481">1481</th><td>{</td></tr>
<tr><th id="1482">1482</th><td>	<em>static</em> <em>const</em> <em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="119weight" title='weight' data-type='const unsigned long [4]' data-ref="119weight" data-ref-filename="119weight">weight</dfn>[<var>4</var>] = {</td></tr>
<tr><th id="1483">1483</th><td>		<var>0</var>, <var>100000000</var>, <var>10000000</var>, <var>1000000</var></td></tr>
<tr><th id="1484">1484</th><td>	};</td></tr>
<tr><th id="1485">1485</th><td></td></tr>
<tr><th id="1486">1486</th><td>	<em>int</em>	<dfn class="local col0 decl" id="120rc" title='rc' data-type='int' data-ref="120rc" data-ref-filename="120rc">rc</dfn>;</td></tr>
<tr><th id="1487">1487</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col1 decl" id="121h" title='h' data-type='u_int' data-ref="121h" data-ref-filename="121h">h</dfn>;</td></tr>
<tr><th id="1488">1488</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col2 decl" id="122m" title='m' data-type='u_int' data-ref="122m" data-ref-filename="122m">m</dfn>;</td></tr>
<tr><th id="1489">1489</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col3 decl" id="123s" title='s' data-type='u_int' data-ref="123s" data-ref-filename="123s">s</dfn>;</td></tr>
<tr><th id="1490">1490</th><td>	<em>int</em>	<dfn class="local col4 decl" id="124p1" title='p1' data-type='int' data-ref="124p1" data-ref-filename="124p1">p1</dfn>;</td></tr>
<tr><th id="1491">1491</th><td>	<em>int</em>	<dfn class="local col5 decl" id="125p2" title='p2' data-type='int' data-ref="125p2" data-ref-filename="125p2">p2</dfn>;</td></tr>
<tr><th id="1492">1492</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a>	<dfn class="local col6 decl" id="126f" title='f' data-type='u_long' data-ref="126f" data-ref-filename="126f">f</dfn>;</td></tr>
<tr><th id="1493">1493</th><td>	<em>char</em>  * <dfn class="local col7 decl" id="127dp" title='dp' data-type='char *' data-ref="127dp" data-ref-filename="127dp">dp</dfn>;</td></tr>
<tr><th id="1494">1494</th><td></td></tr>
<tr><th id="1495">1495</th><td>	<a class="local col7 ref" href="#127dp" title='dp' data-ref="127dp" data-ref-filename="127dp">dp</a> = <a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col7 ref" href="#117rd" title='rd' data-ref="117rd" data-ref-filename="117rd">rd</a>, <a class="local col8 ref" href="#118idx" title='idx' data-ref="118idx" data-ref-filename="118idx">idx</a>);</td></tr>
<tr><th id="1496">1496</th><td>	<a class="local col0 ref" href="#120rc" title='rc' data-ref="120rc" data-ref-filename="120rc">rc</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="local col7 ref" href="#127dp" title='dp' data-ref="127dp" data-ref-filename="127dp">dp</a>, <q>"%2u%2u%2u%n.%3lu%n"</q>, &amp;<a class="local col1 ref" href="#121h" title='h' data-ref="121h" data-ref-filename="121h">h</a>, &amp;<a class="local col2 ref" href="#122m" title='m' data-ref="122m" data-ref-filename="122m">m</a>, &amp;<a class="local col3 ref" href="#123s" title='s' data-ref="123s" data-ref-filename="123s">s</a>, &amp;<a class="local col4 ref" href="#124p1" title='p1' data-ref="124p1" data-ref-filename="124p1">p1</a>, &amp;<a class="local col6 ref" href="#126f" title='f' data-ref="126f" data-ref-filename="126f">f</a>, &amp;<a class="local col5 ref" href="#125p2" title='p2' data-ref="125p2" data-ref-filename="125p2">p2</a>);</td></tr>
<tr><th id="1497">1497</th><td>	<b>if</b> (<a class="local col0 ref" href="#120rc" title='rc' data-ref="120rc" data-ref-filename="120rc">rc</a> &lt; <var>3</var> || <a class="local col4 ref" href="#124p1" title='p1' data-ref="124p1" data-ref-filename="124p1">p1</a> != <var>6</var>) {</td></tr>
<tr><th id="1498">1498</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid time code: &apos;%.6s&apos;\n&quot;, dp); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid time code: '%.6s'\n"</q>, <a class="local col7 ref" href="#127dp" title='dp' data-ref="127dp" data-ref-filename="127dp">dp</a>));</td></tr>
<tr><th id="1499">1499</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1500">1500</th><td>	}</td></tr>
<tr><th id="1501">1501</th><td>	</td></tr>
<tr><th id="1502">1502</th><td>	<i>/* value sanity check */</i></td></tr>
<tr><th id="1503">1503</th><td>	<b>if</b> (<a class="local col1 ref" href="#121h" title='h' data-ref="121h" data-ref-filename="121h">h</a> &gt; <var>23</var> || <a class="local col2 ref" href="#122m" title='m' data-ref="122m" data-ref-filename="122m">m</a> &gt; <var>59</var> || <a class="local col3 ref" href="#123s" title='s' data-ref="123s" data-ref-filename="123s">s</a> &gt; <var>60</var>) {</td></tr>
<tr><th id="1504">1504</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid time spec %02u:%02u:%02u\n&quot;, h, m, s); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid time spec %02u:%02u:%02u\n"</q>,</td></tr>
<tr><th id="1505">1505</th><td>			    <a class="local col1 ref" href="#121h" title='h' data-ref="121h" data-ref-filename="121h">h</a>, <a class="local col2 ref" href="#122m" title='m' data-ref="122m" data-ref-filename="122m">m</a>, <a class="local col3 ref" href="#123s" title='s' data-ref="123s" data-ref-filename="123s">s</a>));</td></tr>
<tr><th id="1506">1506</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1507">1507</th><td>	}</td></tr>
<tr><th id="1508">1508</th><td></td></tr>
<tr><th id="1509">1509</th><td>	<a class="local col5 ref" href="#115jd" title='jd' data-ref="115jd" data-ref-filename="115jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::hour" title='calendar::hour' data-ref="calendar::hour" data-ref-filename="calendar..hour">hour</a>   = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col1 ref" href="#121h" title='h' data-ref="121h" data-ref-filename="121h">h</a>;</td></tr>
<tr><th id="1510">1510</th><td>	<a class="local col5 ref" href="#115jd" title='jd' data-ref="115jd" data-ref-filename="115jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::minute" title='calendar::minute' data-ref="calendar::minute" data-ref-filename="calendar..minute">minute</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col2 ref" href="#122m" title='m' data-ref="122m" data-ref-filename="122m">m</a>;</td></tr>
<tr><th id="1511">1511</th><td>	<a class="local col5 ref" href="#115jd" title='jd' data-ref="115jd" data-ref-filename="115jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::second" title='calendar::second' data-ref="calendar::second" data-ref-filename="calendar..second">second</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col3 ref" href="#123s" title='s' data-ref="123s" data-ref-filename="123s">s</a>;</td></tr>
<tr><th id="1512">1512</th><td>	<i>/* if we have a fraction, scale it up to nanoseconds. */</i></td></tr>
<tr><th id="1513">1513</th><td>	<b>if</b> (<a class="local col0 ref" href="#120rc" title='rc' data-ref="120rc" data-ref-filename="120rc">rc</a> == <var>4</var>)</td></tr>
<tr><th id="1514">1514</th><td>		*<a class="local col6 ref" href="#116ns" title='ns' data-ref="116ns" data-ref-filename="116ns">ns</a> = <a class="local col6 ref" href="#126f" title='f' data-ref="126f" data-ref-filename="126f">f</a> * <a class="local col9 ref" href="#119weight" title='weight' data-ref="119weight" data-ref-filename="119weight">weight</a>[<a class="local col5 ref" href="#125p2" title='p2' data-ref="125p2" data-ref-filename="125p2">p2</a> - <a class="local col4 ref" href="#124p1" title='p1' data-ref="124p1" data-ref-filename="124p1">p1</a> - <var>1</var>];</td></tr>
<tr><th id="1515">1515</th><td>	<b>else</b></td></tr>
<tr><th id="1516">1516</th><td>		*<a class="local col6 ref" href="#116ns" title='ns' data-ref="116ns" data-ref-filename="116ns">ns</a> = <var>0</var>;</td></tr>
<tr><th id="1517">1517</th><td></td></tr>
<tr><th id="1518">1518</th><td>	<b>return</b> <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="1519">1519</th><td>}</td></tr>
<tr><th id="1520">1520</th><td></td></tr>
<tr><th id="1521">1521</th><td><i  data-doc="parse_date">/*</i></td></tr>
<tr><th id="1522">1522</th><td><i  data-doc="parse_date"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1523">1523</th><td><i  data-doc="parse_date"> * Parse a date string from an NMEA sentence. This could either be a</i></td></tr>
<tr><th id="1524">1524</th><td><i  data-doc="parse_date"> * partial date in DDMMYY format in one field, or DD,MM,YYYY full date</i></td></tr>
<tr><th id="1525">1525</th><td><i  data-doc="parse_date"> * spec spanning three fields. This function does some extensive error</i></td></tr>
<tr><th id="1526">1526</th><td><i  data-doc="parse_date"> * checking to make sure the date string was consistent.</i></td></tr>
<tr><th id="1527">1527</th><td><i  data-doc="parse_date"> *</i></td></tr>
<tr><th id="1528">1528</th><td><i  data-doc="parse_date"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1529">1529</th><td><i  data-doc="parse_date"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1530">1530</th><td><i  data-doc="parse_date"> */</i></td></tr>
<tr><th id="1531">1531</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1532">1532</th><td><dfn class="tu decl def fn" id="parse_date" title='parse_date' data-type='int parse_date(struct calendar * jd, nmea_data * rd, int idx, enum date_fmt fmt)' data-ref="parse_date" data-ref-filename="parse_date">parse_date</dfn>(</td></tr>
<tr><th id="1533">1533</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col8 decl" id="128jd" title='jd' data-type='struct calendar *' data-ref="128jd" data-ref-filename="128jd">jd</dfn>,	<i>/* result pointer */</i></td></tr>
<tr><th id="1534">1534</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a>       * <dfn class="local col9 decl" id="129rd" title='rd' data-type='nmea_data *' data-ref="129rd" data-ref-filename="129rd">rd</dfn>,</td></tr>
<tr><th id="1535">1535</th><td>	<em>int</em>		  <dfn class="local col0 decl" id="130idx" title='idx' data-type='int' data-ref="130idx" data-ref-filename="130idx">idx</dfn>,</td></tr>
<tr><th id="1536">1536</th><td>	<b>enum</b> <a class="type" href="#date_fmt" title='date_fmt' data-ref="date_fmt" data-ref-filename="date_fmt">date_fmt</a>	  <dfn class="local col1 decl" id="131fmt" title='fmt' data-type='enum date_fmt' data-ref="131fmt" data-ref-filename="131fmt">fmt</dfn></td></tr>
<tr><th id="1537">1537</th><td>	)</td></tr>
<tr><th id="1538">1538</th><td>{</td></tr>
<tr><th id="1539">1539</th><td>	<em>int</em>	<dfn class="local col2 decl" id="132rc" title='rc' data-type='int' data-ref="132rc" data-ref-filename="132rc">rc</dfn>;</td></tr>
<tr><th id="1540">1540</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col3 decl" id="133y" title='y' data-type='u_int' data-ref="133y" data-ref-filename="133y">y</dfn>;</td></tr>
<tr><th id="1541">1541</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col4 decl" id="134m" title='m' data-type='u_int' data-ref="134m" data-ref-filename="134m">m</dfn>;</td></tr>
<tr><th id="1542">1542</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>	<dfn class="local col5 decl" id="135d" title='d' data-type='u_int' data-ref="135d" data-ref-filename="135d">d</dfn>;</td></tr>
<tr><th id="1543">1543</th><td>	<em>int</em>	<dfn class="local col6 decl" id="136p" title='p' data-type='int' data-ref="136p" data-ref-filename="136p">p</dfn>;</td></tr>
<tr><th id="1544">1544</th><td>	<em>char</em>  * <dfn class="local col7 decl" id="137dp" title='dp' data-type='char *' data-ref="137dp" data-ref-filename="137dp">dp</dfn>;</td></tr>
<tr><th id="1545">1545</th><td>	</td></tr>
<tr><th id="1546">1546</th><td>	<a class="local col7 ref" href="#137dp" title='dp' data-ref="137dp" data-ref-filename="137dp">dp</a> = <a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col9 ref" href="#129rd" title='rd' data-ref="129rd" data-ref-filename="129rd">rd</a>, <a class="local col0 ref" href="#130idx" title='idx' data-ref="130idx" data-ref-filename="130idx">idx</a>);</td></tr>
<tr><th id="1547">1547</th><td>	<b>switch</b> (<a class="local col1 ref" href="#131fmt" title='fmt' data-ref="131fmt" data-ref-filename="131fmt">fmt</a>) {</td></tr>
<tr><th id="1548">1548</th><td></td></tr>
<tr><th id="1549">1549</th><td>	<b>case</b> <a class="enum" href="#DATE_1_DDMMYY" title='DATE_1_DDMMYY' data-ref="DATE_1_DDMMYY" data-ref-filename="DATE_1_DDMMYY">DATE_1_DDMMYY</a>:</td></tr>
<tr><th id="1550">1550</th><td>		<a class="local col2 ref" href="#132rc" title='rc' data-ref="132rc" data-ref-filename="132rc">rc</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="local col7 ref" href="#137dp" title='dp' data-ref="137dp" data-ref-filename="137dp">dp</a>, <q>"%2u%2u%2u%n"</q>, &amp;<a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a>, &amp;<a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a>, &amp;<a class="local col3 ref" href="#133y" title='y' data-ref="133y" data-ref-filename="133y">y</a>, &amp;<a class="local col6 ref" href="#136p" title='p' data-ref="136p" data-ref-filename="136p">p</a>);</td></tr>
<tr><th id="1551">1551</th><td>		<b>if</b> (<a class="local col2 ref" href="#132rc" title='rc' data-ref="132rc" data-ref-filename="132rc">rc</a> != <var>3</var> || <a class="local col6 ref" href="#136p" title='p' data-ref="136p" data-ref-filename="136p">p</a> != <var>6</var>) {</td></tr>
<tr><th id="1552">1552</th><td>			<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid date code: &apos;%.6s&apos;\n&quot;, dp); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid date code: '%.6s'\n"</q>,</td></tr>
<tr><th id="1553">1553</th><td>				    <a class="local col7 ref" href="#137dp" title='dp' data-ref="137dp" data-ref-filename="137dp">dp</a>));</td></tr>
<tr><th id="1554">1554</th><td>			<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1555">1555</th><td>		}</td></tr>
<tr><th id="1556">1556</th><td>		<b>break</b>;</td></tr>
<tr><th id="1557">1557</th><td></td></tr>
<tr><th id="1558">1558</th><td>	<b>case</b> <a class="enum" href="#DATE_3_DDMMYYYY" title='DATE_3_DDMMYYYY' data-ref="DATE_3_DDMMYYYY" data-ref-filename="DATE_3_DDMMYYYY">DATE_3_DDMMYYYY</a>:</td></tr>
<tr><th id="1559">1559</th><td>		<a class="local col2 ref" href="#132rc" title='rc' data-ref="132rc" data-ref-filename="132rc">rc</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="local col7 ref" href="#137dp" title='dp' data-ref="137dp" data-ref-filename="137dp">dp</a>, <q>"%2u,%2u,%4u%n"</q>, &amp;<a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a>, &amp;<a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a>, &amp;<a class="local col3 ref" href="#133y" title='y' data-ref="133y" data-ref-filename="133y">y</a>, &amp;<a class="local col6 ref" href="#136p" title='p' data-ref="136p" data-ref-filename="136p">p</a>);</td></tr>
<tr><th id="1560">1560</th><td>		<b>if</b> (<a class="local col2 ref" href="#132rc" title='rc' data-ref="132rc" data-ref-filename="132rc">rc</a> != <var>3</var> || <a class="local col6 ref" href="#136p" title='p' data-ref="136p" data-ref-filename="136p">p</a> != <var>10</var>) {</td></tr>
<tr><th id="1561">1561</th><td>			<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid date code: &apos;%.10s&apos;\n&quot;, dp); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid date code: '%.10s'\n"</q>,</td></tr>
<tr><th id="1562">1562</th><td>				    <a class="local col7 ref" href="#137dp" title='dp' data-ref="137dp" data-ref-filename="137dp">dp</a>));</td></tr>
<tr><th id="1563">1563</th><td>			<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1564">1564</th><td>		}</td></tr>
<tr><th id="1565">1565</th><td>		<b>break</b>;</td></tr>
<tr><th id="1566">1566</th><td></td></tr>
<tr><th id="1567">1567</th><td>	<b>default</b>:</td></tr>
<tr><th id="1568">1568</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid parse format: %d\n&quot;, fmt); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid parse format: %d\n"</q>, <a class="local col1 ref" href="#131fmt" title='fmt' data-ref="131fmt" data-ref-filename="131fmt">fmt</a>));</td></tr>
<tr><th id="1569">1569</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1570">1570</th><td>	}</td></tr>
<tr><th id="1571">1571</th><td></td></tr>
<tr><th id="1572">1572</th><td>	<i>/* value sanity check */</i></td></tr>
<tr><th id="1573">1573</th><td>	<b>if</b> (<a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a> &lt; <var>1</var> || <a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a> &gt; <var>31</var> || <a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a> &lt; <var>1</var> || <a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a> &gt; <var>12</var>) {</td></tr>
<tr><th id="1574">1574</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: invalid date spec (YMD) %04u:%02u:%02u\n&quot;, y, m, d); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: invalid date spec (YMD) %04u:%02u:%02u\n"</q>,</td></tr>
<tr><th id="1575">1575</th><td>			    <a class="local col3 ref" href="#133y" title='y' data-ref="133y" data-ref-filename="133y">y</a>, <a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a>, <a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a>));</td></tr>
<tr><th id="1576">1576</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1577">1577</th><td>	}</td></tr>
<tr><th id="1578">1578</th><td>	</td></tr>
<tr><th id="1579">1579</th><td>	<i>/* store results */</i></td></tr>
<tr><th id="1580">1580</th><td>	<a class="local col8 ref" href="#128jd" title='jd' data-ref="128jd" data-ref-filename="128jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::monthday" title='calendar::monthday' data-ref="calendar::monthday" data-ref-filename="calendar..monthday">monthday</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col5 ref" href="#135d" title='d' data-ref="135d" data-ref-filename="135d">d</a>;</td></tr>
<tr><th id="1581">1581</th><td>	<a class="local col8 ref" href="#128jd" title='jd' data-ref="128jd" data-ref-filename="128jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::month" title='calendar::month' data-ref="calendar::month" data-ref-filename="calendar..month">month</a>    = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>)<a class="local col4 ref" href="#134m" title='m' data-ref="134m" data-ref-filename="134m">m</a>;</td></tr>
<tr><th id="1582">1582</th><td>	<a class="local col8 ref" href="#128jd" title='jd' data-ref="128jd" data-ref-filename="128jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>     = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>)<a class="local col3 ref" href="#133y" title='y' data-ref="133y" data-ref-filename="133y">y</a>;</td></tr>
<tr><th id="1583">1583</th><td></td></tr>
<tr><th id="1584">1584</th><td>	<b>return</b> <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="1585">1585</th><td>}</td></tr>
<tr><th id="1586">1586</th><td></td></tr>
<tr><th id="1587">1587</th><td><i  data-doc="parse_weekdata">/*</i></td></tr>
<tr><th id="1588">1588</th><td><i  data-doc="parse_weekdata"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1589">1589</th><td><i  data-doc="parse_weekdata"> * Parse GPS week time info from an NMEA sentence. This info contains</i></td></tr>
<tr><th id="1590">1590</th><td><i  data-doc="parse_weekdata"> * the GPS week number, the GPS time-of-week and the leap seconds GPS</i></td></tr>
<tr><th id="1591">1591</th><td><i  data-doc="parse_weekdata"> * to UTC.</i></td></tr>
<tr><th id="1592">1592</th><td><i  data-doc="parse_weekdata"> *</i></td></tr>
<tr><th id="1593">1593</th><td><i  data-doc="parse_weekdata"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1594">1594</th><td><i  data-doc="parse_weekdata"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1595">1595</th><td><i  data-doc="parse_weekdata"> */</i></td></tr>
<tr><th id="1596">1596</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1597">1597</th><td><dfn class="tu decl def fn" id="parse_weekdata" title='parse_weekdata' data-type='int parse_weekdata(gps_weektm * wd, nmea_data * rd, int weekidx, int timeidx, int leapidx)' data-ref="parse_weekdata" data-ref-filename="parse_weekdata">parse_weekdata</dfn>(</td></tr>
<tr><th id="1598">1598</th><td>	<a class="typedef" href="#gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</a> * <dfn class="local col8 decl" id="138wd" title='wd' data-type='gps_weektm *' data-ref="138wd" data-ref-filename="138wd">wd</dfn>,</td></tr>
<tr><th id="1599">1599</th><td>	<a class="typedef" href="#nmea_data" title='nmea_data' data-type='struct nmea_data' data-ref="nmea_data" data-ref-filename="nmea_data">nmea_data</a>  * <dfn class="local col9 decl" id="139rd" title='rd' data-type='nmea_data *' data-ref="139rd" data-ref-filename="139rd">rd</dfn>,</td></tr>
<tr><th id="1600">1600</th><td>	<em>int</em>          <dfn class="local col0 decl" id="140weekidx" title='weekidx' data-type='int' data-ref="140weekidx" data-ref-filename="140weekidx">weekidx</dfn>,</td></tr>
<tr><th id="1601">1601</th><td>	<em>int</em>          <dfn class="local col1 decl" id="141timeidx" title='timeidx' data-type='int' data-ref="141timeidx" data-ref-filename="141timeidx">timeidx</dfn>,</td></tr>
<tr><th id="1602">1602</th><td>	<em>int</em>          <dfn class="local col2 decl" id="142leapidx" title='leapidx' data-type='int' data-ref="142leapidx" data-ref-filename="142leapidx">leapidx</dfn></td></tr>
<tr><th id="1603">1603</th><td>	)</td></tr>
<tr><th id="1604">1604</th><td>{</td></tr>
<tr><th id="1605">1605</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a> <dfn class="local col3 decl" id="143secs" title='secs' data-type='u_long' data-ref="143secs" data-ref-filename="143secs">secs</dfn>;</td></tr>
<tr><th id="1606">1606</th><td>	<em>int</em>    <dfn class="local col4 decl" id="144fcnt" title='fcnt' data-type='int' data-ref="144fcnt" data-ref-filename="144fcnt">fcnt</dfn>;</td></tr>
<tr><th id="1607">1607</th><td></td></tr>
<tr><th id="1608">1608</th><td>	<i>/* parse fields and count success */</i></td></tr>
<tr><th id="1609">1609</th><td>	<a class="local col4 ref" href="#144fcnt" title='fcnt' data-ref="144fcnt" data-ref-filename="144fcnt">fcnt</a>  = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col9 ref" href="#139rd" title='rd' data-ref="139rd" data-ref-filename="139rd">rd</a>, <a class="local col0 ref" href="#140weekidx" title='weekidx' data-ref="140weekidx" data-ref-filename="140weekidx">weekidx</a>), <q>"%hu"</q>, &amp;<a class="local col8 ref" href="#138wd" title='wd' data-ref="138wd" data-ref-filename="138wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_week" title='(anonymous struct)::wt_week' data-use='a' data-ref="(anonymous)::wt_week" data-ref-filename="(anonymous)..wt_week">wt_week</a>);</td></tr>
<tr><th id="1610">1610</th><td>	<a class="local col4 ref" href="#144fcnt" title='fcnt' data-ref="144fcnt" data-ref-filename="144fcnt">fcnt</a> += <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col9 ref" href="#139rd" title='rd' data-ref="139rd" data-ref-filename="139rd">rd</a>, <a class="local col1 ref" href="#141timeidx" title='timeidx' data-ref="141timeidx" data-ref-filename="141timeidx">timeidx</a>), <q>"%lu"</q>, &amp;<a class="local col3 ref" href="#143secs" title='secs' data-ref="143secs" data-ref-filename="143secs">secs</a>);</td></tr>
<tr><th id="1611">1611</th><td>	<a class="local col4 ref" href="#144fcnt" title='fcnt' data-ref="144fcnt" data-ref-filename="144fcnt">fcnt</a> += <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#sscanf" title='sscanf' data-ref="sscanf" data-ref-filename="sscanf">sscanf</a>(<a class="tu ref fn" href="#field_parse" title='field_parse' data-use='c' data-ref="field_parse" data-ref-filename="field_parse">field_parse</a>(<a class="local col9 ref" href="#139rd" title='rd' data-ref="139rd" data-ref-filename="139rd">rd</a>, <a class="local col2 ref" href="#142leapidx" title='leapidx' data-ref="142leapidx" data-ref-filename="142leapidx">leapidx</a>), <q>"%hd"</q>, &amp;<a class="local col8 ref" href="#138wd" title='wd' data-ref="138wd" data-ref-filename="138wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_leap" title='(anonymous struct)::wt_leap' data-use='a' data-ref="(anonymous)::wt_leap" data-ref-filename="(anonymous)..wt_leap">wt_leap</a>);</td></tr>
<tr><th id="1612">1612</th><td>	<b>if</b> (<a class="local col4 ref" href="#144fcnt" title='fcnt' data-ref="144fcnt" data-ref-filename="144fcnt">fcnt</a> != <var>3</var> || <a class="local col8 ref" href="#138wd" title='wd' data-ref="138wd" data-ref-filename="138wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_week" title='(anonymous struct)::wt_week' data-use='r' data-ref="(anonymous)::wt_week" data-ref-filename="(anonymous)..wt_week">wt_week</a> &gt;= <var>1024</var> || <a class="local col3 ref" href="#143secs" title='secs' data-ref="143secs" data-ref-filename="143secs">secs</a> &gt;= <var>7</var>*<a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>) {</td></tr>
<tr><th id="1613">1613</th><td>		<a class="macro" href="../include/ntpd.h.html#43" title="do { if (debug &gt;= (1)) mprintf (&quot;nmea: parse_weekdata: invalid weektime spec\n&quot;); } while (0)" data-ref="_M/DPRINTF">DPRINTF</a>(<var>1</var>, (<q>"nmea: parse_weekdata: invalid weektime spec\n"</q>));</td></tr>
<tr><th id="1614">1614</th><td>		<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>;</td></tr>
<tr><th id="1615">1615</th><td>	}</td></tr>
<tr><th id="1616">1616</th><td>	<a class="local col8 ref" href="#138wd" title='wd' data-ref="138wd" data-ref-filename="138wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_time" title='(anonymous struct)::wt_time' data-use='w' data-ref="(anonymous)::wt_time" data-ref-filename="(anonymous)..wt_time">wt_time</a> = (<a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a>)<a class="local col3 ref" href="#143secs" title='secs' data-ref="143secs" data-ref-filename="143secs">secs</a>;</td></tr>
<tr><th id="1617">1617</th><td></td></tr>
<tr><th id="1618">1618</th><td>	<b>return</b> <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="1619">1619</th><td>}</td></tr>
<tr><th id="1620">1620</th><td></td></tr>
<tr><th id="1621">1621</th><td><i  data-doc="unfold_day">/*</i></td></tr>
<tr><th id="1622">1622</th><td><i  data-doc="unfold_day"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1623">1623</th><td><i  data-doc="unfold_day"> * funny calendar-oriented stuff -- perhaps a bit hard to grok.</i></td></tr>
<tr><th id="1624">1624</th><td><i  data-doc="unfold_day"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1625">1625</th><td><i  data-doc="unfold_day"> *</i></td></tr>
<tr><th id="1626">1626</th><td><i  data-doc="unfold_day"> * Unfold a time-of-day (seconds since midnight) around the current</i></td></tr>
<tr><th id="1627">1627</th><td><i  data-doc="unfold_day"> * system time in a manner that guarantees an absolute difference of</i></td></tr>
<tr><th id="1628">1628</th><td><i  data-doc="unfold_day"> * less than 12hrs.</i></td></tr>
<tr><th id="1629">1629</th><td><i  data-doc="unfold_day"> *</i></td></tr>
<tr><th id="1630">1630</th><td><i  data-doc="unfold_day"> * This function is used for NMEA sentences that contain no date</i></td></tr>
<tr><th id="1631">1631</th><td><i  data-doc="unfold_day"> * information. This requires the system clock to be in +/-12hrs</i></td></tr>
<tr><th id="1632">1632</th><td><i  data-doc="unfold_day"> * around the true time, or the clock will synchronize the system 1day</i></td></tr>
<tr><th id="1633">1633</th><td><i  data-doc="unfold_day"> * off if not augmented with a time sources that also provide the</i></td></tr>
<tr><th id="1634">1634</th><td><i  data-doc="unfold_day"> * necessary date information.</i></td></tr>
<tr><th id="1635">1635</th><td><i  data-doc="unfold_day"> *</i></td></tr>
<tr><th id="1636">1636</th><td><i  data-doc="unfold_day"> * The function updates the calendar structure it also uses as</i></td></tr>
<tr><th id="1637">1637</th><td><i  data-doc="unfold_day"> * input to fetch the time from.</i></td></tr>
<tr><th id="1638">1638</th><td><i  data-doc="unfold_day"> *</i></td></tr>
<tr><th id="1639">1639</th><td><i  data-doc="unfold_day"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1640">1640</th><td><i  data-doc="unfold_day"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1641">1641</th><td><i  data-doc="unfold_day"> */</i></td></tr>
<tr><th id="1642">1642</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1643">1643</th><td><dfn class="tu decl def fn" id="unfold_day" title='unfold_day' data-type='int unfold_day(struct calendar * jd, u_int32 rec_ui)' data-ref="unfold_day" data-ref-filename="unfold_day">unfold_day</dfn>(</td></tr>
<tr><th id="1644">1644</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col5 decl" id="145jd" title='jd' data-type='struct calendar *' data-ref="145jd" data-ref-filename="145jd">jd</dfn>,</td></tr>
<tr><th id="1645">1645</th><td>	<a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a>		  <dfn class="local col6 decl" id="146rec_ui" title='rec_ui' data-type='u_int32' data-ref="146rec_ui" data-ref-filename="146rec_ui">rec_ui</dfn></td></tr>
<tr><th id="1646">1646</th><td>	)</td></tr>
<tr><th id="1647">1647</th><td>{</td></tr>
<tr><th id="1648">1648</th><td>	<a class="typedef" href="../include/ntp_types.h.html#vint64" title='vint64' data-type='union vint64' data-ref="vint64" data-ref-filename="vint64">vint64</a>	     <dfn class="local col7 decl" id="147rec_qw" title='rec_qw' data-type='vint64' data-ref="147rec_qw" data-ref-filename="147rec_qw">rec_qw</dfn>;</td></tr>
<tr><th id="1649">1649</th><td>	<a class="typedef" href="../include/ntp_calendar.h.html#ntpcal_split" title='ntpcal_split' data-type='struct ntpcal_split' data-ref="ntpcal_split" data-ref-filename="ntpcal_split">ntpcal_split</a> <dfn class="local col8 decl" id="148rec_ds" title='rec_ds' data-type='ntpcal_split' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</dfn>;</td></tr>
<tr><th id="1650">1650</th><td></td></tr>
<tr><th id="1651">1651</th><td>	<i>/*</i></td></tr>
<tr><th id="1652">1652</th><td><i>	 * basically this is the peridiodic extension of the receive</i></td></tr>
<tr><th id="1653">1653</th><td><i>	 * time - 12hrs to the time-of-day with a period of 1 day.</i></td></tr>
<tr><th id="1654">1654</th><td><i>	 * But we would have to execute this in 64bit arithmetic, and we</i></td></tr>
<tr><th id="1655">1655</th><td><i>	 * cannot assume we can do this; therefore this is done</i></td></tr>
<tr><th id="1656">1656</th><td><i>	 * in split representation.</i></td></tr>
<tr><th id="1657">1657</th><td><i>	 */</i></td></tr>
<tr><th id="1658">1658</th><td>	<a class="local col7 ref" href="#147rec_qw" title='rec_qw' data-ref="147rec_qw" data-ref-filename="147rec_qw">rec_qw</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_ntp_to_ntp" title='ntpcal_ntp_to_ntp' data-ref="ntpcal_ntp_to_ntp" data-ref-filename="ntpcal_ntp_to_ntp">ntpcal_ntp_to_ntp</a>(<a class="local col6 ref" href="#146rec_ui" title='rec_ui' data-ref="146rec_ui" data-ref-filename="146rec_ui">rec_ui</a> - <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>/<var>2</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1659">1659</th><td>	<a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_daysplit" title='ntpcal_daysplit' data-ref="ntpcal_daysplit" data-ref-filename="ntpcal_daysplit">ntpcal_daysplit</a>(&amp;<a class="local col7 ref" href="#147rec_qw" title='rec_qw' data-ref="147rec_qw" data-ref-filename="147rec_qw">rec_qw</a>);</td></tr>
<tr><th id="1660">1660</th><td>	<a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::lo" title='(anonymous struct)::lo' data-ref="(anonymous)::lo" data-ref-filename="(anonymous)..lo">lo</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_periodic_extend" title='ntpcal_periodic_extend' data-ref="ntpcal_periodic_extend" data-ref-filename="ntpcal_periodic_extend">ntpcal_periodic_extend</a>(<a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::lo" title='(anonymous struct)::lo' data-ref="(anonymous)::lo" data-ref-filename="(anonymous)..lo">lo</a>,</td></tr>
<tr><th id="1661">1661</th><td>					   <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_daysec" title='ntpcal_date_to_daysec' data-ref="ntpcal_date_to_daysec" data-ref-filename="ntpcal_date_to_daysec">ntpcal_date_to_daysec</a>(<a class="local col5 ref" href="#145jd" title='jd' data-ref="145jd" data-ref-filename="145jd">jd</a>),</td></tr>
<tr><th id="1662">1662</th><td>					   <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>);</td></tr>
<tr><th id="1663">1663</th><td>	<a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::hi" title='(anonymous struct)::hi' data-ref="(anonymous)::hi" data-ref-filename="(anonymous)..hi">hi</a> += <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_daysec_to_date" title='ntpcal_daysec_to_date' data-ref="ntpcal_daysec_to_date" data-ref-filename="ntpcal_daysec_to_date">ntpcal_daysec_to_date</a>(<a class="local col5 ref" href="#145jd" title='jd' data-ref="145jd" data-ref-filename="145jd">jd</a>, <a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::lo" title='(anonymous struct)::lo' data-ref="(anonymous)::lo" data-ref-filename="(anonymous)..lo">lo</a>);</td></tr>
<tr><th id="1664">1664</th><td>	<b>return</b> (<a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_rd_to_date" title='ntpcal_rd_to_date' data-ref="ntpcal_rd_to_date" data-ref-filename="ntpcal_rd_to_date">ntpcal_rd_to_date</a>(<a class="local col5 ref" href="#145jd" title='jd' data-ref="145jd" data-ref-filename="145jd">jd</a>, <a class="local col8 ref" href="#148rec_ds" title='rec_ds' data-ref="148rec_ds" data-ref-filename="148rec_ds">rec_ds</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::hi" title='(anonymous struct)::hi' data-ref="(anonymous)::hi" data-ref-filename="(anonymous)..hi">hi</a> + <a class="macro" href="../include/ntp_calendar.h.html#418" title="693596" data-ref="_M/DAY_NTP_STARTS">DAY_NTP_STARTS</a>) &gt;= <var>0</var>);</td></tr>
<tr><th id="1665">1665</th><td>}</td></tr>
<tr><th id="1666">1666</th><td></td></tr>
<tr><th id="1667">1667</th><td><i  data-doc="unfold_century">/*</i></td></tr>
<tr><th id="1668">1668</th><td><i  data-doc="unfold_century"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1669">1669</th><td><i  data-doc="unfold_century"> * A 2-digit year is expanded into full year spec around the year found</i></td></tr>
<tr><th id="1670">1670</th><td><i  data-doc="unfold_century"> * in 'jd-&gt;year'. This should be in +79/-19 years around the system time,</i></td></tr>
<tr><th id="1671">1671</th><td><i  data-doc="unfold_century"> * or the result will be off by 100 years.  The assymetric behaviour was</i></td></tr>
<tr><th id="1672">1672</th><td><i  data-doc="unfold_century"> * chosen to enable inital sync for systems that do not have a</i></td></tr>
<tr><th id="1673">1673</th><td><i  data-doc="unfold_century"> * battery-backup clock and start with a date that is typically years in</i></td></tr>
<tr><th id="1674">1674</th><td><i  data-doc="unfold_century"> * the past.</i></td></tr>
<tr><th id="1675">1675</th><td><i  data-doc="unfold_century"> *</i></td></tr>
<tr><th id="1676">1676</th><td><i  data-doc="unfold_century"> * Since the GPS epoch starts at 1980-01-06, the resulting year will be</i></td></tr>
<tr><th id="1677">1677</th><td><i  data-doc="unfold_century"> * not be before 1980 in any case.</i></td></tr>
<tr><th id="1678">1678</th><td><i  data-doc="unfold_century"> *</i></td></tr>
<tr><th id="1679">1679</th><td><i  data-doc="unfold_century"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1680">1680</th><td><i  data-doc="unfold_century"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1681">1681</th><td><i  data-doc="unfold_century"> */</i></td></tr>
<tr><th id="1682">1682</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1683">1683</th><td><dfn class="tu decl def fn" id="unfold_century" title='unfold_century' data-type='int unfold_century(struct calendar * jd, u_int32 rec_ui)' data-ref="unfold_century" data-ref-filename="unfold_century">unfold_century</dfn>(</td></tr>
<tr><th id="1684">1684</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col9 decl" id="149jd" title='jd' data-type='struct calendar *' data-ref="149jd" data-ref-filename="149jd">jd</dfn>,</td></tr>
<tr><th id="1685">1685</th><td>	<a class="typedef" href="../include/ntp_types.h.html#u_int32" title='u_int32' data-type='uint32_t' data-ref="u_int32" data-ref-filename="u_int32">u_int32</a>		  <dfn class="local col0 decl" id="150rec_ui" title='rec_ui' data-type='u_int32' data-ref="150rec_ui" data-ref-filename="150rec_ui">rec_ui</dfn></td></tr>
<tr><th id="1686">1686</th><td>	)</td></tr>
<tr><th id="1687">1687</th><td>{</td></tr>
<tr><th id="1688">1688</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> <dfn class="local col1 decl" id="151rec" title='rec' data-type='struct calendar' data-ref="151rec" data-ref-filename="151rec">rec</dfn>;</td></tr>
<tr><th id="1689">1689</th><td>	<a class="typedef" href="../include/ntp_types.h.html#int32" title='int32' data-type='int32_t' data-ref="int32" data-ref-filename="int32">int32</a>		<dfn class="local col2 decl" id="152baseyear" title='baseyear' data-type='int32' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</dfn>;</td></tr>
<tr><th id="1690">1690</th><td></td></tr>
<tr><th id="1691">1691</th><td>	<a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_ntp_to_date" title='ntpcal_ntp_to_date' data-ref="ntpcal_ntp_to_date" data-ref-filename="ntpcal_ntp_to_date">ntpcal_ntp_to_date</a>(&amp;<a class="local col1 ref" href="#151rec" title='rec' data-ref="151rec" data-ref-filename="151rec">rec</a>, <a class="local col0 ref" href="#150rec_ui" title='rec_ui' data-ref="150rec_ui" data-ref-filename="150rec_ui">rec_ui</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1692">1692</th><td>	<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a> = <a class="local col1 ref" href="#151rec" title='rec' data-ref="151rec" data-ref-filename="151rec">rec</a>.<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a> - <var>20</var>;</td></tr>
<tr><th id="1693">1693</th><td>	<b>if</b> (<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a> &lt; <a class="tu ref" href="#g_gpsMinYear" title='g_gpsMinYear' data-use='r' data-ref="g_gpsMinYear" data-ref-filename="g_gpsMinYear">g_gpsMinYear</a>)</td></tr>
<tr><th id="1694">1694</th><td>		<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a> = <a class="tu ref" href="#g_gpsMinYear" title='g_gpsMinYear' data-use='r' data-ref="g_gpsMinYear" data-ref-filename="g_gpsMinYear">g_gpsMinYear</a>;</td></tr>
<tr><th id="1695">1695</th><td>	<a class="local col9 ref" href="#149jd" title='jd' data-ref="149jd" data-ref-filename="149jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a> = (<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>)<a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_periodic_extend" title='ntpcal_periodic_extend' data-ref="ntpcal_periodic_extend" data-ref-filename="ntpcal_periodic_extend">ntpcal_periodic_extend</a>(<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a>, <a class="local col9 ref" href="#149jd" title='jd' data-ref="149jd" data-ref-filename="149jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>,</td></tr>
<tr><th id="1696">1696</th><td>						   <var>100</var>);</td></tr>
<tr><th id="1697">1697</th><td></td></tr>
<tr><th id="1698">1698</th><td>	<b>return</b> ((<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a> &lt;= <a class="local col9 ref" href="#149jd" title='jd' data-ref="149jd" data-ref-filename="149jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>) &amp;&amp; (<a class="local col2 ref" href="#152baseyear" title='baseyear' data-ref="152baseyear" data-ref-filename="152baseyear">baseyear</a> + <var>100</var> &gt; <a class="local col9 ref" href="#149jd" title='jd' data-ref="149jd" data-ref-filename="149jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a>));</td></tr>
<tr><th id="1699">1699</th><td>}</td></tr>
<tr><th id="1700">1700</th><td></td></tr>
<tr><th id="1701">1701</th><td><i  data-doc="gpsfix_century">/*</i></td></tr>
<tr><th id="1702">1702</th><td><i  data-doc="gpsfix_century"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1703">1703</th><td><i  data-doc="gpsfix_century"> * A 2-digit year is expanded into a full year spec by correlation with</i></td></tr>
<tr><th id="1704">1704</th><td><i  data-doc="gpsfix_century"> * a GPS week number and the current leap second count.</i></td></tr>
<tr><th id="1705">1705</th><td><i  data-doc="gpsfix_century"> *</i></td></tr>
<tr><th id="1706">1706</th><td><i  data-doc="gpsfix_century"> * The GPS week time scale counts weeks since Sunday, 1980-01-06, modulo</i></td></tr>
<tr><th id="1707">1707</th><td><i  data-doc="gpsfix_century"> * 1024 and seconds since start of the week. The GPS time scale is based</i></td></tr>
<tr><th id="1708">1708</th><td><i  data-doc="gpsfix_century"> * on international atomic time (TAI), so the leap second difference to</i></td></tr>
<tr><th id="1709">1709</th><td><i  data-doc="gpsfix_century"> * UTC is also needed for a proper conversion.</i></td></tr>
<tr><th id="1710">1710</th><td><i  data-doc="gpsfix_century"> *</i></td></tr>
<tr><th id="1711">1711</th><td><i  data-doc="gpsfix_century"> * A brute-force analysis (that is, test for every date) shows that a</i></td></tr>
<tr><th id="1712">1712</th><td><i  data-doc="gpsfix_century"> * wrong assignment of the century can not happen between the years 1900</i></td></tr>
<tr><th id="1713">1713</th><td><i  data-doc="gpsfix_century"> * to 2399 when comparing the week signatures for different</i></td></tr>
<tr><th id="1714">1714</th><td><i  data-doc="gpsfix_century"> * centuries. (I *think* that will not happen for 400*1024 years, but I</i></td></tr>
<tr><th id="1715">1715</th><td><i  data-doc="gpsfix_century"> * have no valid proof. -*-perlinger@ntp.org-*-)</i></td></tr>
<tr><th id="1716">1716</th><td><i  data-doc="gpsfix_century"> *</i></td></tr>
<tr><th id="1717">1717</th><td><i  data-doc="gpsfix_century"> * This function is bound to to work between years 1980 and 2399</i></td></tr>
<tr><th id="1718">1718</th><td><i  data-doc="gpsfix_century"> * (inclusive), which should suffice for now ;-)</i></td></tr>
<tr><th id="1719">1719</th><td><i  data-doc="gpsfix_century"> *</i></td></tr>
<tr><th id="1720">1720</th><td><i  data-doc="gpsfix_century"> * Note: This function needs a full date&amp;time spec on input due to the</i></td></tr>
<tr><th id="1721">1721</th><td><i  data-doc="gpsfix_century"> * necessary leap second corrections!</i></td></tr>
<tr><th id="1722">1722</th><td><i  data-doc="gpsfix_century"> *</i></td></tr>
<tr><th id="1723">1723</th><td><i  data-doc="gpsfix_century"> * returns 1 on success, 0 on failure</i></td></tr>
<tr><th id="1724">1724</th><td><i  data-doc="gpsfix_century"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1725">1725</th><td><i  data-doc="gpsfix_century"> */</i></td></tr>
<tr><th id="1726">1726</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1727">1727</th><td><dfn class="tu decl def fn" id="gpsfix_century" title='gpsfix_century' data-type='int gpsfix_century(struct calendar * jd, const gps_weektm * wd, u_short * century)' data-ref="gpsfix_century" data-ref-filename="gpsfix_century">gpsfix_century</dfn>(</td></tr>
<tr><th id="1728">1728</th><td>	<b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a>  * <dfn class="local col3 decl" id="153jd" title='jd' data-type='struct calendar *' data-ref="153jd" data-ref-filename="153jd">jd</dfn>,</td></tr>
<tr><th id="1729">1729</th><td>	<em>const</em> <a class="typedef" href="#gps_weektm" title='gps_weektm' data-type='struct gps_weektm' data-ref="gps_weektm" data-ref-filename="gps_weektm">gps_weektm</a> * <dfn class="local col4 decl" id="154wd" title='wd' data-type='const gps_weektm *' data-ref="154wd" data-ref-filename="154wd">wd</dfn>,</td></tr>
<tr><th id="1730">1730</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a>          * <dfn class="local col5 decl" id="155century" title='century' data-type='u_short *' data-ref="155century" data-ref-filename="155century">century</dfn></td></tr>
<tr><th id="1731">1731</th><td>	) </td></tr>
<tr><th id="1732">1732</th><td>{</td></tr>
<tr><th id="1733">1733</th><td>	<a class="typedef" href="../include/ntp_types.h.html#int32" title='int32' data-type='int32_t' data-ref="int32" data-ref-filename="int32">int32</a>	<dfn class="local col6 decl" id="156days" title='days' data-type='int32' data-ref="156days" data-ref-filename="156days">days</dfn>;</td></tr>
<tr><th id="1734">1734</th><td>	<a class="typedef" href="../include/ntp_types.h.html#int32" title='int32' data-type='int32_t' data-ref="int32" data-ref-filename="int32">int32</a>	<dfn class="local col7 decl" id="157doff" title='doff' data-type='int32' data-ref="157doff" data-ref-filename="157doff">doff</dfn>;</td></tr>
<tr><th id="1735">1735</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a> <dfn class="local col8 decl" id="158week" title='week' data-type='u_short' data-ref="158week" data-ref-filename="158week">week</dfn>;</td></tr>
<tr><th id="1736">1736</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_short" title='u_short' data-type='unsigned short' data-ref="u_short" data-ref-filename="u_short">u_short</a> <dfn class="local col9 decl" id="159year" title='year' data-type='u_short' data-ref="159year" data-ref-filename="159year">year</dfn>;</td></tr>
<tr><th id="1737">1737</th><td>	<em>int</em>     <dfn class="local col0 decl" id="160loop" title='loop' data-type='int' data-ref="160loop" data-ref-filename="160loop">loop</dfn>;</td></tr>
<tr><th id="1738">1738</th><td></td></tr>
<tr><th id="1739">1739</th><td>	<i>/* Get day offset. Assumes that the input time is in range and</i></td></tr>
<tr><th id="1740">1740</th><td><i>	 * that the leap seconds do not shift more than +/-1 day.</i></td></tr>
<tr><th id="1741">1741</th><td><i>	 */</i></td></tr>
<tr><th id="1742">1742</th><td>	<a class="local col7 ref" href="#157doff" title='doff' data-ref="157doff" data-ref-filename="157doff">doff</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_daysec" title='ntpcal_date_to_daysec' data-ref="ntpcal_date_to_daysec" data-ref-filename="ntpcal_date_to_daysec">ntpcal_date_to_daysec</a>(<a class="local col3 ref" href="#153jd" title='jd' data-ref="153jd" data-ref-filename="153jd">jd</a>) + <a class="local col4 ref" href="#154wd" title='wd' data-ref="154wd" data-ref-filename="154wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_leap" title='(anonymous struct)::wt_leap' data-use='r' data-ref="(anonymous)::wt_leap" data-ref-filename="(anonymous)..wt_leap">wt_leap</a>;</td></tr>
<tr><th id="1743">1743</th><td>	<a class="local col7 ref" href="#157doff" title='doff' data-ref="157doff" data-ref-filename="157doff">doff</a> = (<a class="local col7 ref" href="#157doff" title='doff' data-ref="157doff" data-ref-filename="157doff">doff</a> &gt;= <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>) - (<a class="local col7 ref" href="#157doff" title='doff' data-ref="157doff" data-ref-filename="157doff">doff</a> &lt; <var>0</var>);</td></tr>
<tr><th id="1744">1744</th><td></td></tr>
<tr><th id="1745">1745</th><td>	<i>/*</i></td></tr>
<tr><th id="1746">1746</th><td><i>	 * Loop over centuries to get a match, starting with the last</i></td></tr>
<tr><th id="1747">1747</th><td><i>	 * successful one. (Or with the 19th century if the cached value</i></td></tr>
<tr><th id="1748">1748</th><td><i>	 * is out of range...)</i></td></tr>
<tr><th id="1749">1749</th><td><i>	 */</i></td></tr>
<tr><th id="1750">1750</th><td>	<a class="local col9 ref" href="#159year" title='year' data-ref="159year" data-ref-filename="159year">year</a> = <a class="local col3 ref" href="#153jd" title='jd' data-ref="153jd" data-ref-filename="153jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a> % <var>100</var>;</td></tr>
<tr><th id="1751">1751</th><td>	<b>for</b> (<a class="local col0 ref" href="#160loop" title='loop' data-ref="160loop" data-ref-filename="160loop">loop</a> = <var>5</var>; <a class="local col0 ref" href="#160loop" title='loop' data-ref="160loop" data-ref-filename="160loop">loop</a> &gt; <var>0</var>; <a class="local col0 ref" href="#160loop" title='loop' data-ref="160loop" data-ref-filename="160loop">loop</a>--,(*<a class="local col5 ref" href="#155century" title='century' data-ref="155century" data-ref-filename="155century">century</a>)++) {</td></tr>
<tr><th id="1752">1752</th><td>		<b>if</b> (*<a class="local col5 ref" href="#155century" title='century' data-ref="155century" data-ref-filename="155century">century</a> &lt; <var>19</var> || *<a class="local col5 ref" href="#155century" title='century' data-ref="155century" data-ref-filename="155century">century</a> &gt;= <var>24</var>)</td></tr>
<tr><th id="1753">1753</th><td>			*<a class="local col5 ref" href="#155century" title='century' data-ref="155century" data-ref-filename="155century">century</a> = <var>19</var>;</td></tr>
<tr><th id="1754">1754</th><td>		<i>/* Get days and week in GPS epoch */</i></td></tr>
<tr><th id="1755">1755</th><td>		<a class="local col3 ref" href="#153jd" title='jd' data-ref="153jd" data-ref-filename="153jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a> = <a class="local col9 ref" href="#159year" title='year' data-ref="159year" data-ref-filename="159year">year</a> + *<a class="local col5 ref" href="#155century" title='century' data-ref="155century" data-ref-filename="155century">century</a> * <var>100</var>;</td></tr>
<tr><th id="1756">1756</th><td>		<a class="local col6 ref" href="#156days" title='days' data-ref="156days" data-ref-filename="156days">days</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_rd" title='ntpcal_date_to_rd' data-ref="ntpcal_date_to_rd" data-ref-filename="ntpcal_date_to_rd">ntpcal_date_to_rd</a>(<a class="local col3 ref" href="#153jd" title='jd' data-ref="153jd" data-ref-filename="153jd">jd</a>) - <a class="macro" href="#281" title="722820" data-ref="_M/DAY_GPS_STARTS">DAY_GPS_STARTS</a> + <a class="local col7 ref" href="#157doff" title='doff' data-ref="157doff" data-ref-filename="157doff">doff</a>;</td></tr>
<tr><th id="1757">1757</th><td>		<a class="local col8 ref" href="#158week" title='week' data-ref="158week" data-ref-filename="158week">week</a> = (<a class="local col6 ref" href="#156days" title='days' data-ref="156days" data-ref-filename="156days">days</a> / <var>7</var>) % <var>1024</var>;</td></tr>
<tr><th id="1758">1758</th><td>		<b>if</b> (<a class="local col6 ref" href="#156days" title='days' data-ref="156days" data-ref-filename="156days">days</a> &gt;= <var>0</var> &amp;&amp; <a class="local col4 ref" href="#154wd" title='wd' data-ref="154wd" data-ref-filename="154wd">wd</a>-&gt;<a class="tu ref field" href="#(anonymous)::wt_week" title='(anonymous struct)::wt_week' data-use='r' data-ref="(anonymous)::wt_week" data-ref-filename="(anonymous)..wt_week">wt_week</a> == <a class="local col8 ref" href="#158week" title='week' data-ref="158week" data-ref-filename="158week">week</a>)</td></tr>
<tr><th id="1759">1759</th><td>			<b>return</b> <a class="macro" href="../include/ntp_types.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>; <i>/* matched... */</i></td></tr>
<tr><th id="1760">1760</th><td>	}</td></tr>
<tr><th id="1761">1761</th><td></td></tr>
<tr><th id="1762">1762</th><td>	<a class="local col3 ref" href="#153jd" title='jd' data-ref="153jd" data-ref-filename="153jd">jd</a>-&gt;<a class="ref field" href="../include/ntp_calendar.h.html#calendar::year" title='calendar::year' data-ref="calendar::year" data-ref-filename="calendar..year">year</a> = <a class="local col9 ref" href="#159year" title='year' data-ref="159year" data-ref-filename="159year">year</a>;</td></tr>
<tr><th id="1763">1763</th><td>	<b>return</b> <a class="macro" href="../include/ntp_types.h.html#37" title="0" data-ref="_M/FALSE">FALSE</a>; <i>/* match failed... */</i></td></tr>
<tr><th id="1764">1764</th><td>}</td></tr>
<tr><th id="1765">1765</th><td></td></tr>
<tr><th id="1766">1766</th><td><i  data-doc="eval_gps_time">/*</i></td></tr>
<tr><th id="1767">1767</th><td><i  data-doc="eval_gps_time"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1768">1768</th><td><i  data-doc="eval_gps_time"> * And now the final execise: Considering the fact that many (most?)</i></td></tr>
<tr><th id="1769">1769</th><td><i  data-doc="eval_gps_time"> * GPS receivers cannot handle a GPS epoch wrap well, we try to</i></td></tr>
<tr><th id="1770">1770</th><td><i  data-doc="eval_gps_time"> * compensate for that problem by unwrapping a GPS epoch around the</i></td></tr>
<tr><th id="1771">1771</th><td><i  data-doc="eval_gps_time"> * receive stamp. Another execise in periodic unfolding, of course,</i></td></tr>
<tr><th id="1772">1772</th><td><i  data-doc="eval_gps_time"> * but with enough points to take care of.</i></td></tr>
<tr><th id="1773">1773</th><td><i  data-doc="eval_gps_time"> *</i></td></tr>
<tr><th id="1774">1774</th><td><i  data-doc="eval_gps_time"> * Note: The integral part of 'tofs' is intended to handle small(!)</i></td></tr>
<tr><th id="1775">1775</th><td><i  data-doc="eval_gps_time"> * systematic offsets, as -1 for handling $GPZDG, which gives the</i></td></tr>
<tr><th id="1776">1776</th><td><i  data-doc="eval_gps_time"> * following second. (sigh...) The absolute value shall be less than a</i></td></tr>
<tr><th id="1777">1777</th><td><i  data-doc="eval_gps_time"> * day (86400 seconds).</i></td></tr>
<tr><th id="1778">1778</th><td><i  data-doc="eval_gps_time"> * -------------------------------------------------------------------</i></td></tr>
<tr><th id="1779">1779</th><td><i  data-doc="eval_gps_time"> */</i></td></tr>
<tr><th id="1780">1780</th><td><em>static</em> <a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a></td></tr>
<tr><th id="1781">1781</th><td><dfn class="tu decl def fn" id="eval_gps_time" title='eval_gps_time' data-type='l_fp eval_gps_time(struct peer * peer, const struct calendar * gpst, const struct timespec * tofs, const l_fp * xrecv)' data-ref="eval_gps_time" data-ref-filename="eval_gps_time">eval_gps_time</dfn>(</td></tr>
<tr><th id="1782">1782</th><td>	<b>struct</b> <a class="type" href="../include/ntp.h.html#peer" title='peer' data-ref="peer" data-ref-filename="peer">peer</a>           * <dfn class="local col1 decl" id="161peer" title='peer' data-type='struct peer *' data-ref="161peer" data-ref-filename="161peer">peer</dfn>, <i>/* for logging etc */</i></td></tr>
<tr><th id="1783">1783</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../include/ntp_calendar.h.html#calendar" title='calendar' data-ref="calendar" data-ref-filename="calendar">calendar</a> * <dfn class="local col2 decl" id="162gpst" title='gpst' data-type='const struct calendar *' data-ref="162gpst" data-ref-filename="162gpst">gpst</dfn>, <i>/* GPS time stamp  */</i></td></tr>
<tr><th id="1784">1784</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/timespec.h.html#timespec" title='timespec' data-ref="timespec" data-ref-filename="timespec">timespec</a> * <dfn class="local col3 decl" id="163tofs" title='tofs' data-type='const struct timespec *' data-ref="163tofs" data-ref-filename="163tofs">tofs</dfn>, <i>/* GPS frac second &amp; offset */</i></td></tr>
<tr><th id="1785">1785</th><td>	<em>const</em> <a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>            * <dfn class="local col4 decl" id="164xrecv" title='xrecv' data-type='const l_fp *' data-ref="164xrecv" data-ref-filename="164xrecv">xrecv</dfn> <i>/* receive time stamp */</i></td></tr>
<tr><th id="1786">1786</th><td>	)</td></tr>
<tr><th id="1787">1787</th><td>{</td></tr>
<tr><th id="1788">1788</th><td>	<b>struct</b> <a class="type" href="../include/ntp_refclock.h.html#refclockproc" title='refclockproc' data-ref="refclockproc" data-ref-filename="refclockproc">refclockproc</a> * <em>const</em> <dfn class="local col5 decl" id="165pp" title='pp' data-type='struct refclockproc *const' data-ref="165pp" data-ref-filename="165pp">pp</dfn> = <a class="local col1 ref" href="#161peer" title='peer' data-ref="161peer" data-ref-filename="161peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::procptr" title='peer::procptr' data-ref="peer::procptr" data-ref-filename="peer..procptr">procptr</a>;</td></tr>
<tr><th id="1789">1789</th><td>	<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a>	    * <em>const</em> <dfn class="local col6 decl" id="166up" title='up' data-type='nmea_unit *const' data-ref="166up" data-ref-filename="166up">up</dfn> = (<a class="typedef" href="#nmea_unit" title='nmea_unit' data-type='struct nmea_unit' data-ref="nmea_unit" data-ref-filename="nmea_unit">nmea_unit</a> *)<a class="local col5 ref" href="#165pp" title='pp' data-ref="165pp" data-ref-filename="165pp">pp</a>-&gt;<a class="ref field" href="../include/ntp_refclock.h.html#refclockproc::unitptr" title='refclockproc::unitptr' data-ref="refclockproc::unitptr" data-ref-filename="refclockproc..unitptr">unitptr</a>;</td></tr>
<tr><th id="1790">1790</th><td></td></tr>
<tr><th id="1791">1791</th><td>	<a class="typedef" href="../include/ntp_fp.h.html#l_fp" title='l_fp' data-type='struct l_fp' data-ref="l_fp" data-ref-filename="l_fp">l_fp</a>    <dfn class="local col7 decl" id="167retv" title='retv' data-type='l_fp' data-ref="167retv" data-ref-filename="167retv">retv</dfn>;</td></tr>
<tr><th id="1792">1792</th><td></td></tr>
<tr><th id="1793">1793</th><td>	<i>/* components of calculation */</i></td></tr>
<tr><th id="1794">1794</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col8 decl" id="168rcv_sec" title='rcv_sec' data-type='int32_t' data-ref="168rcv_sec" data-ref-filename="168rcv_sec">rcv_sec</dfn>, <dfn class="local col9 decl" id="169rcv_day" title='rcv_day' data-type='int32_t' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</dfn>; <i>/* receive ToD and day */</i></td></tr>
<tr><th id="1795">1795</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col0 decl" id="170gps_sec" title='gps_sec' data-type='int32_t' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</dfn>, <dfn class="local col1 decl" id="171gps_day" title='gps_day' data-type='int32_t' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</dfn>; <i>/* GPS ToD and day in NTP epoch */</i></td></tr>
<tr><th id="1796">1796</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int32_t" title='int32_t' data-type='__int32_t' data-ref="int32_t" data-ref-filename="int32_t">int32_t</a> <dfn class="local col2 decl" id="172adj_day" title='adj_day' data-type='int32_t' data-ref="172adj_day" data-ref-filename="172adj_day">adj_day</dfn>, <dfn class="local col3 decl" id="173weeks" title='weeks' data-type='int32_t' data-ref="173weeks" data-ref-filename="173weeks">weeks</dfn>;   <i>/* adjusted GPS day and week shift */</i></td></tr>
<tr><th id="1797">1797</th><td></td></tr>
<tr><th id="1798">1798</th><td>	<i>/* some temporaries to shuffle data */</i></td></tr>
<tr><th id="1799">1799</th><td>	<a class="typedef" href="../include/ntp_types.h.html#vint64" title='vint64' data-type='union vint64' data-ref="vint64" data-ref-filename="vint64">vint64</a>       <dfn class="local col4 decl" id="174vi64" title='vi64' data-type='vint64' data-ref="174vi64" data-ref-filename="174vi64">vi64</dfn>;</td></tr>
<tr><th id="1800">1800</th><td>	<a class="typedef" href="../include/ntp_calendar.h.html#ntpcal_split" title='ntpcal_split' data-type='struct ntpcal_split' data-ref="ntpcal_split" data-ref-filename="ntpcal_split">ntpcal_split</a> <dfn class="local col5 decl" id="175rs64" title='rs64' data-type='ntpcal_split' data-ref="175rs64" data-ref-filename="175rs64">rs64</dfn>;</td></tr>
<tr><th id="1801">1801</th><td></td></tr>
<tr><th id="1802">1802</th><td>	<i>/* evaluate time stamp from receiver. */</i></td></tr>
<tr><th id="1803">1803</th><td>	<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_daysec" title='ntpcal_date_to_daysec' data-ref="ntpcal_date_to_daysec" data-ref-filename="ntpcal_date_to_daysec">ntpcal_date_to_daysec</a>(<a class="local col2 ref" href="#162gpst" title='gpst' data-ref="162gpst" data-ref-filename="162gpst">gpst</a>);</td></tr>
<tr><th id="1804">1804</th><td>	<a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_date_to_rd" title='ntpcal_date_to_rd' data-ref="ntpcal_date_to_rd" data-ref-filename="ntpcal_date_to_rd">ntpcal_date_to_rd</a>(<a class="local col2 ref" href="#162gpst" title='gpst' data-ref="162gpst" data-ref-filename="162gpst">gpst</a>) - <a class="macro" href="../include/ntp_calendar.h.html#418" title="693596" data-ref="_M/DAY_NTP_STARTS">DAY_NTP_STARTS</a>;</td></tr>
<tr><th id="1805">1805</th><td></td></tr>
<tr><th id="1806">1806</th><td>	<i>/* merge in fractional offset */</i></td></tr>
<tr><th id="1807">1807</th><td>	<a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a> = <a class="ref fn" href="../include/timespecops.h.html#tspec_intv_to_lfp" title='tspec_intv_to_lfp' data-ref="tspec_intv_to_lfp" data-ref-filename="tspec_intv_to_lfp">tspec_intv_to_lfp</a>(*<a class="local col3 ref" href="#163tofs" title='tofs' data-ref="163tofs" data-ref-filename="163tofs">tofs</a>);</td></tr>
<tr><th id="1808">1808</th><td>	<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> += <a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>.<a class="macro" href="../include/ntp_fp.h.html#41" title="Ul_i.Xl_i" data-ref="_M/l_i">l_i</a>;</td></tr>
<tr><th id="1809">1809</th><td></td></tr>
<tr><th id="1810">1810</th><td>	<i>/* If we fully trust the GPS receiver, just combine days and</i></td></tr>
<tr><th id="1811">1811</th><td><i>	 * seconds and be done. */</i></td></tr>
<tr><th id="1812">1812</th><td>	<b>if</b> (<a class="local col1 ref" href="#161peer" title='peer' data-ref="161peer" data-ref-filename="161peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::ttl" title='peer::ttl' data-ref="peer::ttl" data-ref-filename="peer..ttl">ttl</a> &amp; <a class="macro" href="#96" title="0x02000000U" data-ref="_M/NMEA_DATETRUST_MASK">NMEA_DATETRUST_MASK</a>) {</td></tr>
<tr><th id="1813">1813</th><td>		<a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>.<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_dayjoin" title='ntpcal_dayjoin' data-ref="ntpcal_dayjoin" data-ref-filename="ntpcal_dayjoin">ntpcal_dayjoin</a>(<a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a>, <a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a>).<a class="ref field" href="../include/ntp_types.h.html#(anonymous)::D_s" title='(anonymous union)::D_s' data-ref="(anonymous)::D_s" data-ref-filename="(anonymous)..D_s">D_s</a>.<a class="ref field" href="../include/ntp_types.h.html#(anonymousunion)::(anonymous)::lo" title='(anonymous union)::(anonymous struct)::lo' data-ref="(anonymousunion)::(anonymous)::lo" data-ref-filename="(anonymousunion)..(anonymous)..lo">lo</a>;</td></tr>
<tr><th id="1814">1814</th><td>		<b>return</b> <a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>;</td></tr>
<tr><th id="1815">1815</th><td>	}</td></tr>
<tr><th id="1816">1816</th><td></td></tr>
<tr><th id="1817">1817</th><td>	<i>/* So we do not trust the GPS receiver to deliver a correct date</i></td></tr>
<tr><th id="1818">1818</th><td><i>	 * due to the GPS epoch changes. We map the date from the</i></td></tr>
<tr><th id="1819">1819</th><td><i>	 * receiver into the +/-512 week interval around the receive</i></td></tr>
<tr><th id="1820">1820</th><td><i>	 * time in that case. This would be a tad easier with 64bit</i></td></tr>
<tr><th id="1821">1821</th><td><i>	 * calculations, but again, we restrict the code to 32bit ops</i></td></tr>
<tr><th id="1822">1822</th><td><i>	 * when possible. */</i></td></tr>
<tr><th id="1823">1823</th><td></td></tr>
<tr><th id="1824">1824</th><td>	<i>/* - make sure the GPS fractional day is normalised</i></td></tr>
<tr><th id="1825">1825</th><td><i>	 * Applying the offset value might have put us slightly over the</i></td></tr>
<tr><th id="1826">1826</th><td><i>	 * edge of the allowed range for seconds-of-day. Doing a full</i></td></tr>
<tr><th id="1827">1827</th><td><i>	 * division with floor correction is overkill here; a simple</i></td></tr>
<tr><th id="1828">1828</th><td><i>	 * addition or subtraction step is sufficient. Using WHILE loops</i></td></tr>
<tr><th id="1829">1829</th><td><i>	 * gives the right result even if the offset exceeds one day,</i></td></tr>
<tr><th id="1830">1830</th><td><i>	 * which is NOT what it's intented for! */</i></td></tr>
<tr><th id="1831">1831</th><td>	<b>while</b> (<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> &gt;= <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>) {</td></tr>
<tr><th id="1832">1832</th><td>		<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> -= <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>;</td></tr>
<tr><th id="1833">1833</th><td>		<a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a> += <var>1</var>;</td></tr>
<tr><th id="1834">1834</th><td>	}</td></tr>
<tr><th id="1835">1835</th><td>	<b>while</b> (<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="1836">1836</th><td>		<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> += <a class="macro" href="../include/ntp_calendar.h.html#92" title="(((60) * (60)) * (24))" data-ref="_M/SECSPERDAY">SECSPERDAY</a>;</td></tr>
<tr><th id="1837">1837</th><td>		<a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a> -= <var>1</var>;</td></tr>
<tr><th id="1838">1838</th><td>	}</td></tr>
<tr><th id="1839">1839</th><td></td></tr>
<tr><th id="1840">1840</th><td>	<i>/* - get unfold base: day of full recv time - 512 weeks */</i></td></tr>
<tr><th id="1841">1841</th><td>	<a class="local col4 ref" href="#174vi64" title='vi64' data-ref="174vi64" data-ref-filename="174vi64">vi64</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_ntp_to_ntp" title='ntpcal_ntp_to_ntp' data-ref="ntpcal_ntp_to_ntp" data-ref-filename="ntpcal_ntp_to_ntp">ntpcal_ntp_to_ntp</a>(<a class="local col4 ref" href="#164xrecv" title='xrecv' data-ref="164xrecv" data-ref-filename="164xrecv">xrecv</a>-&gt;<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="1842">1842</th><td>	<a class="local col5 ref" href="#175rs64" title='rs64' data-ref="175rs64" data-ref-filename="175rs64">rs64</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_daysplit" title='ntpcal_daysplit' data-ref="ntpcal_daysplit" data-ref-filename="ntpcal_daysplit">ntpcal_daysplit</a>(&amp;<a class="local col4 ref" href="#174vi64" title='vi64' data-ref="174vi64" data-ref-filename="174vi64">vi64</a>);</td></tr>
<tr><th id="1843">1843</th><td>	<a class="local col8 ref" href="#168rcv_sec" title='rcv_sec' data-ref="168rcv_sec" data-ref-filename="168rcv_sec">rcv_sec</a> = <a class="local col5 ref" href="#175rs64" title='rs64' data-ref="175rs64" data-ref-filename="175rs64">rs64</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::lo" title='(anonymous struct)::lo' data-ref="(anonymous)::lo" data-ref-filename="(anonymous)..lo">lo</a>;</td></tr>
<tr><th id="1844">1844</th><td>	<a class="local col9 ref" href="#169rcv_day" title='rcv_day' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</a> = <a class="local col5 ref" href="#175rs64" title='rs64' data-ref="175rs64" data-ref-filename="175rs64">rs64</a>.<a class="ref field" href="../include/ntp_calendar.h.html#(anonymous)::hi" title='(anonymous struct)::hi' data-ref="(anonymous)::hi" data-ref-filename="(anonymous)..hi">hi</a> - <var>512</var> * <var>7</var>;</td></tr>
<tr><th id="1845">1845</th><td></td></tr>
<tr><th id="1846">1846</th><td>	<i>/* - take the fractional days into account</i></td></tr>
<tr><th id="1847">1847</th><td><i>	 * If the fractional day of the GPS time is smaller than the</i></td></tr>
<tr><th id="1848">1848</th><td><i>	 * fractional day of the receive time, we shift the base day for</i></td></tr>
<tr><th id="1849">1849</th><td><i>	 * the unfold by 1. */</i></td></tr>
<tr><th id="1850">1850</th><td>	<b>if</b> (   <a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a>  &lt; <a class="local col8 ref" href="#168rcv_sec" title='rcv_sec' data-ref="168rcv_sec" data-ref-filename="168rcv_sec">rcv_sec</a></td></tr>
<tr><th id="1851">1851</th><td>	   || (<a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a> == <a class="local col8 ref" href="#168rcv_sec" title='rcv_sec' data-ref="168rcv_sec" data-ref-filename="168rcv_sec">rcv_sec</a> &amp;&amp; <a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>.<a class="ref field" href="../include/ntp_fp.h.html#(anonymous)::l_uf" title='(anonymous struct)::l_uf' data-ref="(anonymous)::l_uf" data-ref-filename="(anonymous)..l_uf">l_uf</a> &lt; <a class="local col4 ref" href="#164xrecv" title='xrecv' data-ref="164xrecv" data-ref-filename="164xrecv">xrecv</a>-&gt;<a class="ref field" href="../include/ntp_fp.h.html#(anonymous)::l_uf" title='(anonymous struct)::l_uf' data-ref="(anonymous)::l_uf" data-ref-filename="(anonymous)..l_uf">l_uf</a>))</td></tr>
<tr><th id="1852">1852</th><td>		<a class="local col9 ref" href="#169rcv_day" title='rcv_day' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</a> += <var>1</var>;</td></tr>
<tr><th id="1853">1853</th><td></td></tr>
<tr><th id="1854">1854</th><td>	<i>/* - don't warp ahead of GPS invention! */</i></td></tr>
<tr><th id="1855">1855</th><td>	<b>if</b> (<a class="local col9 ref" href="#169rcv_day" title='rcv_day' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</a> &lt; <a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='r' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a>)</td></tr>
<tr><th id="1856">1856</th><td>		<a class="local col9 ref" href="#169rcv_day" title='rcv_day' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</a> = <a class="tu ref" href="#g_gpsMinBase" title='g_gpsMinBase' data-use='r' data-ref="g_gpsMinBase" data-ref-filename="g_gpsMinBase">g_gpsMinBase</a>;</td></tr>
<tr><th id="1857">1857</th><td></td></tr>
<tr><th id="1858">1858</th><td>	<i>/* - let the magic happen: */</i></td></tr>
<tr><th id="1859">1859</th><td>	<a class="local col2 ref" href="#172adj_day" title='adj_day' data-ref="172adj_day" data-ref-filename="172adj_day">adj_day</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_periodic_extend" title='ntpcal_periodic_extend' data-ref="ntpcal_periodic_extend" data-ref-filename="ntpcal_periodic_extend">ntpcal_periodic_extend</a>(<a class="local col9 ref" href="#169rcv_day" title='rcv_day' data-ref="169rcv_day" data-ref-filename="169rcv_day">rcv_day</a>, <a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a>, <var>1024</var>*<var>7</var>);</td></tr>
<tr><th id="1860">1860</th><td></td></tr>
<tr><th id="1861">1861</th><td>	<i>/* - check if we should log a GPS epoch warp */</i></td></tr>
<tr><th id="1862">1862</th><td>	<a class="local col3 ref" href="#173weeks" title='weeks' data-ref="173weeks" data-ref-filename="173weeks">weeks</a> = (<a class="local col2 ref" href="#172adj_day" title='adj_day' data-ref="172adj_day" data-ref-filename="172adj_day">adj_day</a> - <a class="local col1 ref" href="#171gps_day" title='gps_day' data-ref="171gps_day" data-ref-filename="171gps_day">gps_day</a>) / <var>7</var>;</td></tr>
<tr><th id="1863">1863</th><td>	<b>if</b> (<a class="local col3 ref" href="#173weeks" title='weeks' data-ref="173weeks" data-ref-filename="173weeks">weeks</a> != <a class="local col6 ref" href="#166up" title='up' data-ref="166up" data-ref-filename="166up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::epoch_warp" title='(anonymous struct)::epoch_warp' data-use='r' data-ref="(anonymous)::epoch_warp" data-ref-filename="(anonymous)..epoch_warp">epoch_warp</a>) {</td></tr>
<tr><th id="1864">1864</th><td>		<a class="local col6 ref" href="#166up" title='up' data-ref="166up" data-ref-filename="166up">up</a>-&gt;<a class="tu ref field" href="#(anonymous)::epoch_warp" title='(anonymous struct)::epoch_warp' data-use='w' data-ref="(anonymous)::epoch_warp" data-ref-filename="(anonymous)..epoch_warp">epoch_warp</a> = <a class="local col3 ref" href="#173weeks" title='weeks' data-ref="173weeks" data-ref-filename="173weeks">weeks</a>;</td></tr>
<tr><th id="1865">1865</th><td>		<a class="macro" href="../include/ntp_syslog.h.html#82" title="do { if (ntp_syslogmask &amp; (0x00000100)) msyslog (6, &quot;%s Changed GPS epoch warp to %d weeks&quot;, refnumtoa(&amp;peer-&gt;srcadr), weeks); } while (0)" data-ref="_M/LOGIF">LOGIF</a>(CLOCKINFO, (<a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/syslog.h.html#58" title="6" data-ref="_M/LOG_INFO">LOG_INFO</a>,</td></tr>
<tr><th id="1866">1866</th><td>				  <q>"%s Changed GPS epoch warp to %d weeks"</q>,</td></tr>
<tr><th id="1867">1867</th><td>				  <a class="ref fn" href="../include/ntp_stdlib.h.html#refnumtoa" title='refnumtoa' data-ref="refnumtoa" data-ref-filename="refnumtoa">refnumtoa</a>(&amp;<a class="local col1 ref" href="#161peer" title='peer' data-ref="161peer" data-ref-filename="161peer">peer</a>-&gt;<a class="ref field" href="../include/ntp.h.html#peer::srcadr" title='peer::srcadr' data-ref="peer::srcadr" data-ref-filename="peer..srcadr">srcadr</a>), <a class="local col3 ref" href="#173weeks" title='weeks' data-ref="173weeks" data-ref-filename="173weeks">weeks</a>));</td></tr>
<tr><th id="1868">1868</th><td>	}</td></tr>
<tr><th id="1869">1869</th><td></td></tr>
<tr><th id="1870">1870</th><td>	<i>/* - build result and be done */</i></td></tr>
<tr><th id="1871">1871</th><td>	<a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>.<a class="macro" href="../include/ntp_fp.h.html#40" title="Ul_i.Xl_ui" data-ref="_M/l_ui">l_ui</a> = <a class="ref fn" href="../include/ntp_calendar.h.html#ntpcal_dayjoin" title='ntpcal_dayjoin' data-ref="ntpcal_dayjoin" data-ref-filename="ntpcal_dayjoin">ntpcal_dayjoin</a>(<a class="local col2 ref" href="#172adj_day" title='adj_day' data-ref="172adj_day" data-ref-filename="172adj_day">adj_day</a>, <a class="local col0 ref" href="#170gps_sec" title='gps_sec' data-ref="170gps_sec" data-ref-filename="170gps_sec">gps_sec</a>).<a class="ref field" href="../include/ntp_types.h.html#(anonymous)::D_s" title='(anonymous union)::D_s' data-ref="(anonymous)::D_s" data-ref-filename="(anonymous)..D_s">D_s</a>.<a class="ref field" href="../include/ntp_types.h.html#(anonymousunion)::(anonymous)::lo" title='(anonymous union)::(anonymous struct)::lo' data-ref="(anonymousunion)::(anonymous)::lo" data-ref-filename="(anonymousunion)..(anonymous)..lo">lo</a>;</td></tr>
<tr><th id="1872">1872</th><td>	<b>return</b> <a class="local col7 ref" href="#167retv" title='retv' data-ref="167retv" data-ref-filename="167retv">retv</a>;</td></tr>
<tr><th id="1873">1873</th><td>}</td></tr>
<tr><th id="1874">1874</th><td></td></tr>
<tr><th id="1875">1875</th><td><i  data-doc="nmead_open">/*</i></td></tr>
<tr><th id="1876">1876</th><td><i  data-doc="nmead_open"> * ===================================================================</i></td></tr>
<tr><th id="1877">1877</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1878">1878</th><td><i  data-doc="nmead_open"> * NMEAD support</i></td></tr>
<tr><th id="1879">1879</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1880">1880</th><td><i  data-doc="nmead_open"> * original nmead support added by Jon Miner (cp_n18@yahoo.com)</i></td></tr>
<tr><th id="1881">1881</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1882">1882</th><td><i  data-doc="nmead_open"> * See <a href="http://home.hiwaay.net/~taylorc/gps/nmea-server/">http://home.hiwaay.net/~taylorc/gps/nmea-server/</a></i></td></tr>
<tr><th id="1883">1883</th><td><i  data-doc="nmead_open"> * for information about nmead</i></td></tr>
<tr><th id="1884">1884</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1885">1885</th><td><i  data-doc="nmead_open"> * To use this, you need to create a link from /dev/gpsX to</i></td></tr>
<tr><th id="1886">1886</th><td><i  data-doc="nmead_open"> * the server:port where nmead is running.  Something like this:</i></td></tr>
<tr><th id="1887">1887</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1888">1888</th><td><i  data-doc="nmead_open"> * ln -s server:port /dev/gps1</i></td></tr>
<tr><th id="1889">1889</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1890">1890</th><td><i  data-doc="nmead_open"> * Split into separate function by Juergen Perlinger</i></td></tr>
<tr><th id="1891">1891</th><td><i  data-doc="nmead_open"> * (perlinger-at-ntp-dot-org)</i></td></tr>
<tr><th id="1892">1892</th><td><i  data-doc="nmead_open"> *</i></td></tr>
<tr><th id="1893">1893</th><td><i  data-doc="nmead_open"> * ===================================================================</i></td></tr>
<tr><th id="1894">1894</th><td><i  data-doc="nmead_open"> */</i></td></tr>
<tr><th id="1895">1895</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1896">1896</th><td><dfn class="tu decl def fn" id="nmead_open" title='nmead_open' data-type='int nmead_open(const char * device)' data-ref="nmead_open" data-ref-filename="nmead_open">nmead_open</dfn>(</td></tr>
<tr><th id="1897">1897</th><td>	<em>const</em> <em>char</em> * <dfn class="local col6 decl" id="176device" title='device' data-type='const char *' data-ref="176device" data-ref-filename="176device">device</dfn></td></tr>
<tr><th id="1898">1898</th><td>	)</td></tr>
<tr><th id="1899">1899</th><td>{</td></tr>
<tr><th id="1900">1900</th><td>	<em>int</em>	<dfn class="local col7 decl" id="177fd" title='fd' data-type='int' data-ref="177fd" data-ref-filename="177fd">fd</dfn> = -<var>1</var>;		<i>/* result file descriptor */</i></td></tr>
<tr><th id="1901">1901</th><td>	</td></tr>
<tr><th id="1902">1902</th><td><u>#<span data-ppcond="1902">ifdef</span> <a class="macro" href="../../include/config.h.html#763" data-ref="_M/HAVE_READLINK">HAVE_READLINK</a></u></td></tr>
<tr><th id="1903">1903</th><td>	<em>char</em>	<dfn class="local col8 decl" id="178host" title='host' data-type='char [80]' data-ref="178host" data-ref-filename="178host">host</dfn>[<var>80</var>];		<i>/* link target buffer	*/</i></td></tr>
<tr><th id="1904">1904</th><td>	<em>char</em>  * <dfn class="local col9 decl" id="179port" title='port' data-type='char *' data-ref="179port" data-ref-filename="179port">port</dfn>;			<i>/* port name or number	*/</i></td></tr>
<tr><th id="1905">1905</th><td>	<em>int</em>	<dfn class="local col0 decl" id="180rc" title='rc' data-type='int' data-ref="180rc" data-ref-filename="180rc">rc</dfn>;			<i>/* result code (several)*/</i></td></tr>
<tr><th id="1906">1906</th><td>	<em>int</em>     <dfn class="local col1 decl" id="181sh" title='sh' data-type='int' data-ref="181sh" data-ref-filename="181sh">sh</dfn>;			<i>/* socket handle	*/</i></td></tr>
<tr><th id="1907">1907</th><td>	<b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo" title='addrinfo' data-ref="addrinfo" data-ref-filename="addrinfo">addrinfo</a>	 <dfn class="local col2 decl" id="182ai_hint" title='ai_hint' data-type='struct addrinfo' data-ref="182ai_hint" data-ref-filename="182ai_hint">ai_hint</dfn>;	<i>/* resolution hint	*/</i></td></tr>
<tr><th id="1908">1908</th><td>	<b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo" title='addrinfo' data-ref="addrinfo" data-ref-filename="addrinfo">addrinfo</a>	*<dfn class="local col3 decl" id="183ai_list" title='ai_list' data-type='struct addrinfo *' data-ref="183ai_list" data-ref-filename="183ai_list">ai_list</dfn>;	<i>/* resolution result	*/</i></td></tr>
<tr><th id="1909">1909</th><td>	<b>struct</b> <a class="type" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo" title='addrinfo' data-ref="addrinfo" data-ref-filename="addrinfo">addrinfo</a> *<dfn class="local col4 decl" id="184ai" title='ai' data-type='struct addrinfo *' data-ref="184ai" data-ref-filename="184ai">ai</dfn>;		<i>/* result scan ptr	*/</i></td></tr>
<tr><th id="1910">1910</th><td></td></tr>
<tr><th id="1911">1911</th><td>	<a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a> = -<var>1</var>;</td></tr>
<tr><th id="1912">1912</th><td>	</td></tr>
<tr><th id="1913">1913</th><td>	<i>/* try to read as link, make sure no overflow occurs */</i></td></tr>
<tr><th id="1914">1914</th><td>	<a class="local col0 ref" href="#180rc" title='rc' data-ref="180rc" data-ref-filename="180rc">rc</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/unistd.h.html#readlink" title='readlink' data-ref="readlink" data-ref-filename="readlink">readlink</a>(<a class="local col6 ref" href="#176device" title='device' data-ref="176device" data-ref-filename="176device">device</a>, <a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>, <b>sizeof</b>(<a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>));</td></tr>
<tr><th id="1915">1915</th><td>	<b>if</b> ((<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a>)<a class="local col0 ref" href="#180rc" title='rc' data-ref="180rc" data-ref-filename="180rc">rc</a> &gt;= <b>sizeof</b>(<a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>))</td></tr>
<tr><th id="1916">1916</th><td>		<b>return</b> <a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a>;	<i>/* error / overflow / truncation */</i></td></tr>
<tr><th id="1917">1917</th><td>	<a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>[<a class="local col0 ref" href="#180rc" title='rc' data-ref="180rc" data-ref-filename="180rc">rc</a>] = <kbd>'\0'</kbd>;	<i>/* readlink does not place NUL	*/</i></td></tr>
<tr><th id="1918">1918</th><td></td></tr>
<tr><th id="1919">1919</th><td>	<i>/* get port */</i></td></tr>
<tr><th id="1920">1920</th><td>	<a class="local col9 ref" href="#179port" title='port' data-ref="179port" data-ref-filename="179port">port</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strchr" title='strchr' data-ref="strchr" data-ref-filename="strchr">strchr</a>(<a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>, <kbd>':'</kbd>);</td></tr>
<tr><th id="1921">1921</th><td>	<b>if</b> (!<a class="local col9 ref" href="#179port" title='port' data-ref="179port" data-ref-filename="179port">port</a>)</td></tr>
<tr><th id="1922">1922</th><td>		<b>return</b> <a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a>; <i>/* not 'host:port' syntax ? */</i></td></tr>
<tr><th id="1923">1923</th><td>	*<a class="local col9 ref" href="#179port" title='port' data-ref="179port" data-ref-filename="179port">port</a>++ = <kbd>'\0'</kbd>;	<i>/* put in separator */</i></td></tr>
<tr><th id="1924">1924</th><td>	</td></tr>
<tr><th id="1925">1925</th><td>	<i>/* get address infos and try to open socket</i></td></tr>
<tr><th id="1926">1926</th><td><i>	 *</i></td></tr>
<tr><th id="1927">1927</th><td><i>	 * This getaddrinfo() is naughty in ntpd's nonblocking main</i></td></tr>
<tr><th id="1928">1928</th><td><i>	 * thread, but you have to go out of your wary to use this code</i></td></tr>
<tr><th id="1929">1929</th><td><i>	 * and typically the blocking is at startup where its impact is</i></td></tr>
<tr><th id="1930">1930</th><td><i>	 * reduced. The same holds for the 'connect()', as it is</i></td></tr>
<tr><th id="1931">1931</th><td><i>	 * blocking, too...</i></td></tr>
<tr><th id="1932">1932</th><td><i>	 */</i></td></tr>
<tr><th id="1933">1933</th><td>	<a class="macro" href="../include/ntp_malloc.h.html#61" title="bzero(&amp;(ai_hint), sizeof(ai_hint))" data-ref="_M/ZERO">ZERO</a>(<a class="local col2 ref" href="#182ai_hint" title='ai_hint' data-ref="182ai_hint" data-ref-filename="182ai_hint">ai_hint</a>);</td></tr>
<tr><th id="1934">1934</th><td>	<a class="local col2 ref" href="#182ai_hint" title='ai_hint' data-ref="182ai_hint" data-ref-filename="182ai_hint">ai_hint</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_protocol" title='addrinfo::ai_protocol' data-ref="addrinfo::ai_protocol" data-ref-filename="addrinfo..ai_protocol">ai_protocol</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netinet/in.h.html#82" title="6" data-ref="_M/IPPROTO_TCP">IPPROTO_TCP</a>;</td></tr>
<tr><th id="1935">1935</th><td>	<a class="local col2 ref" href="#182ai_hint" title='ai_hint' data-ref="182ai_hint" data-ref-filename="182ai_hint">ai_hint</a>.<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_socktype" title='addrinfo::ai_socktype' data-ref="addrinfo::ai_socktype" data-ref-filename="addrinfo..ai_socktype">ai_socktype</a> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/socket.h.html#105" title="1" data-ref="_M/SOCK_STREAM">SOCK_STREAM</a>;</td></tr>
<tr><th id="1936">1936</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#getaddrinfo" title='getaddrinfo' data-ref="getaddrinfo" data-ref-filename="getaddrinfo">getaddrinfo</a>(<a class="local col8 ref" href="#178host" title='host' data-ref="178host" data-ref-filename="178host">host</a>, <a class="local col9 ref" href="#179port" title='port' data-ref="179port" data-ref-filename="179port">port</a>, &amp;<a class="local col2 ref" href="#182ai_hint" title='ai_hint' data-ref="182ai_hint" data-ref-filename="182ai_hint">ai_hint</a>, &amp;<a class="local col3 ref" href="#183ai_list" title='ai_list' data-ref="183ai_list" data-ref-filename="183ai_list">ai_list</a>))</td></tr>
<tr><th id="1937">1937</th><td>		<b>return</b> <a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a>;</td></tr>
<tr><th id="1938">1938</th><td>	</td></tr>
<tr><th id="1939">1939</th><td>	<b>for</b> (<a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a> = <a class="local col3 ref" href="#183ai_list" title='ai_list' data-ref="183ai_list" data-ref-filename="183ai_list">ai_list</a>; <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a> &amp;&amp; (<a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a> == -<var>1</var>); <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a> = <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_next" title='addrinfo::ai_next' data-ref="addrinfo::ai_next" data-ref-filename="addrinfo..ai_next">ai_next</a>) {</td></tr>
<tr><th id="1940">1940</th><td>		<a class="local col1 ref" href="#181sh" title='sh' data-ref="181sh" data-ref-filename="181sh">sh</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/socket.h.html#__socket30" title='socket' data-ref="__socket30" data-ref-filename="__socket30">socket</a>(<a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_family" title='addrinfo::ai_family' data-ref="addrinfo::ai_family" data-ref-filename="addrinfo..ai_family">ai_family</a>, <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_socktype" title='addrinfo::ai_socktype' data-ref="addrinfo::ai_socktype" data-ref-filename="addrinfo..ai_socktype">ai_socktype</a>,</td></tr>
<tr><th id="1941">1941</th><td>			    <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_protocol" title='addrinfo::ai_protocol' data-ref="addrinfo::ai_protocol" data-ref-filename="addrinfo..ai_protocol">ai_protocol</a>);</td></tr>
<tr><th id="1942">1942</th><td>		<b>if</b> (<a class="macro" href="../include/ntp_types.h.html#295" title="(-1)" data-ref="_M/INVALID_SOCKET">INVALID_SOCKET</a> == <a class="local col1 ref" href="#181sh" title='sh' data-ref="181sh" data-ref-filename="181sh">sh</a>)</td></tr>
<tr><th id="1943">1943</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1944">1944</th><td>		<a class="local col0 ref" href="#180rc" title='rc' data-ref="180rc" data-ref-filename="180rc">rc</a> = <a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/socket.h.html#connect" title='connect' data-ref="connect" data-ref-filename="connect">connect</a>(<a class="local col1 ref" href="#181sh" title='sh' data-ref="181sh" data-ref-filename="181sh">sh</a>, <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_addr" title='addrinfo::ai_addr' data-ref="addrinfo::ai_addr" data-ref-filename="addrinfo..ai_addr">ai_addr</a>, <a class="local col4 ref" href="#184ai" title='ai' data-ref="184ai" data-ref-filename="184ai">ai</a>-&gt;<a class="ref field" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#addrinfo::ai_addrlen" title='addrinfo::ai_addrlen' data-ref="addrinfo::ai_addrlen" data-ref-filename="addrinfo..ai_addrlen">ai_addrlen</a>);</td></tr>
<tr><th id="1945">1945</th><td>		<b>if</b> (-<var>1</var> != <a class="local col0 ref" href="#180rc" title='rc' data-ref="180rc" data-ref-filename="180rc">rc</a>)</td></tr>
<tr><th id="1946">1946</th><td>			<a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a> = <a class="local col1 ref" href="#181sh" title='sh' data-ref="181sh" data-ref-filename="181sh">sh</a>;</td></tr>
<tr><th id="1947">1947</th><td>		<b>else</b></td></tr>
<tr><th id="1948">1948</th><td>			<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/unistd.h.html#close" title='close' data-ref="close" data-ref-filename="close">close</a>(<a class="local col1 ref" href="#181sh" title='sh' data-ref="181sh" data-ref-filename="181sh">sh</a>);</td></tr>
<tr><th id="1949">1949</th><td>	}</td></tr>
<tr><th id="1950">1950</th><td>	<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/netdb.h.html#freeaddrinfo" title='freeaddrinfo' data-ref="freeaddrinfo" data-ref-filename="freeaddrinfo">freeaddrinfo</a>(<a class="local col3 ref" href="#183ai_list" title='ai_list' data-ref="183ai_list" data-ref-filename="183ai_list">ai_list</a>);</td></tr>
<tr><th id="1951">1951</th><td><u>#<span data-ppcond="1902">else</span></u></td></tr>
<tr><th id="1952">1952</th><td>	fd = -<var>1</var>;</td></tr>
<tr><th id="1953">1953</th><td><u>#<span data-ppcond="1902">endif</span></u></td></tr>
<tr><th id="1954">1954</th><td></td></tr>
<tr><th id="1955">1955</th><td>	<b>return</b> <a class="local col7 ref" href="#177fd" title='fd' data-ref="177fd" data-ref-filename="177fd">fd</a>;</td></tr>
<tr><th id="1956">1956</th><td>}</td></tr>
<tr><th id="1957">1957</th><td><u>#<span data-ppcond="27">else</span></u></td></tr>
<tr><th id="1958">1958</th><td>NONEMPTY_TRANSLATION_UNIT</td></tr>
<tr><th id="1959">1959</th><td><u>#<span data-ppcond="27">endif</span> /* REFCLOCK &amp;&amp; CLOCK_NMEA */</u></td></tr>
<tr><th id="1960">1960</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
