<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>libzfs_changelist.c source code [netbsd/external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="prop_changelist,prop_changenode "/>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c'; var root_path = '../../../../../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../../../..'>netbsd</a>/<a href='../../../../../..'>external</a>/<a href='../../../../..'>cddl</a>/<a href='../../../..'>osnet</a>/<a href='../../..'>dist</a>/<a href='../..'>lib</a>/<a href='..'>libzfs</a>/<a href='./'>common</a>/<a href='libzfs_changelist.c.html'>libzfs_changelist.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * CDDL HEADER START</i></td></tr>
<tr><th id="3">3</th><td><i> *</i></td></tr>
<tr><th id="4">4</th><td><i> * The contents of this file are subject to the terms of the</i></td></tr>
<tr><th id="5">5</th><td><i> * Common Development and Distribution License (the "License").</i></td></tr>
<tr><th id="6">6</th><td><i> * You may not use this file except in compliance with the License.</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE</i></td></tr>
<tr><th id="9">9</th><td><i> * or <a href="http://www.opensolaris.org/os/licensing">http://www.opensolaris.org/os/licensing</a>.</i></td></tr>
<tr><th id="10">10</th><td><i> * See the License for the specific language governing permissions</i></td></tr>
<tr><th id="11">11</th><td><i> * and limitations under the License.</i></td></tr>
<tr><th id="12">12</th><td><i> *</i></td></tr>
<tr><th id="13">13</th><td><i> * When distributing Covered Code, include this CDDL HEADER in each</i></td></tr>
<tr><th id="14">14</th><td><i> * file and include the License file at usr/src/OPENSOLARIS.LICENSE.</i></td></tr>
<tr><th id="15">15</th><td><i> * If applicable, add the following below this CDDL HEADER, with the</i></td></tr>
<tr><th id="16">16</th><td><i> * fields enclosed by brackets "[]" replaced with your own identifying</i></td></tr>
<tr><th id="17">17</th><td><i> * information: Portions Copyright [yyyy] [name of copyright owner]</i></td></tr>
<tr><th id="18">18</th><td><i> *</i></td></tr>
<tr><th id="19">19</th><td><i> * CDDL HEADER END</i></td></tr>
<tr><th id="20">20</th><td><i> */</i></td></tr>
<tr><th id="21">21</th><td></td></tr>
<tr><th id="22">22</th><td><i>/*</i></td></tr>
<tr><th id="23">23</th><td><i> * Copyright 2010 Sun Microsystems, Inc.  All rights reserved.</i></td></tr>
<tr><th id="24">24</th><td><i> * Use is subject to license terms.</i></td></tr>
<tr><th id="25">25</th><td><i> *</i></td></tr>
<tr><th id="26">26</th><td><i> * Portions Copyright 2007 Ramprakash Jelari</i></td></tr>
<tr><th id="27">27</th><td><i> * Copyright (c) 2011 Pawel Jakub Dawidek &lt;pawel@dawidek.net&gt;.</i></td></tr>
<tr><th id="28">28</th><td><i> * All rights reserved.</i></td></tr>
<tr><th id="29">29</th><td><i> * Copyright (c) 2014, 2015 by Delphix. All rights reserved.</i></td></tr>
<tr><th id="30">30</th><td><i> * Copyright 2016 Igor Kozhukhov &lt;ikozhukhov@gmail.com&gt;</i></td></tr>
<tr><th id="31">31</th><td><i> */</i></td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../../head/libintl.h.html">&lt;libintl.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../../libuutil/common/libuutil.h.html">&lt;libuutil.h&gt;</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include &lt;stddef.h&gt;</u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="../../../../include/stdlib.h.html">&lt;stdlib.h&gt;</a></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html">&lt;string.h&gt;</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="../../../../include/unistd.h.html">&lt;unistd.h&gt;</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="../../../../include/zone.h.html">&lt;zone.h&gt;</a></u></td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td><u>#include <a href="libzfs.h.html">&lt;libzfs.h&gt;</a></u></td></tr>
<tr><th id="42">42</th><td></td></tr>
<tr><th id="43">43</th><td><u>#include <a href="libzfs_impl.h.html">"libzfs_impl.h"</a></u></td></tr>
<tr><th id="44">44</th><td></td></tr>
<tr><th id="45">45</th><td><i>/*</i></td></tr>
<tr><th id="46">46</th><td><i> * Structure to keep track of dataset state.  Before changing the 'sharenfs' or</i></td></tr>
<tr><th id="47">47</th><td><i> * 'mountpoint' property, we record whether the filesystem was previously</i></td></tr>
<tr><th id="48">48</th><td><i> * mounted/shared.  This prior state dictates whether we remount/reshare the</i></td></tr>
<tr><th id="49">49</th><td><i> * dataset after the property has been changed.</i></td></tr>
<tr><th id="50">50</th><td><i> *</i></td></tr>
<tr><th id="51">51</th><td><i> * The interface consists of the following sequence of functions:</i></td></tr>
<tr><th id="52">52</th><td><i> *</i></td></tr>
<tr><th id="53">53</th><td><i> * 	changelist_gather()</i></td></tr>
<tr><th id="54">54</th><td><i> * 	changelist_prefix()</i></td></tr>
<tr><th id="55">55</th><td><i> * 	&lt; change property &gt;</i></td></tr>
<tr><th id="56">56</th><td><i> * 	changelist_postfix()</i></td></tr>
<tr><th id="57">57</th><td><i> * 	changelist_free()</i></td></tr>
<tr><th id="58">58</th><td><i> *</i></td></tr>
<tr><th id="59">59</th><td><i> * Other interfaces:</i></td></tr>
<tr><th id="60">60</th><td><i> *</i></td></tr>
<tr><th id="61">61</th><td><i> * changelist_remove() - remove a node from a gathered list</i></td></tr>
<tr><th id="62">62</th><td><i> * changelist_rename() - renames all datasets appropriately when doing a rename</i></td></tr>
<tr><th id="63">63</th><td><i> * changelist_unshare() - unshares all the nodes in a given changelist</i></td></tr>
<tr><th id="64">64</th><td><i> * changelist_haszonedchild() - check if there is any child exported to</i></td></tr>
<tr><th id="65">65</th><td><i> *				a local zone</i></td></tr>
<tr><th id="66">66</th><td><i> */</i></td></tr>
<tr><th id="67">67</th><td><b>typedef</b> <b>struct</b> <dfn class="type def" id="prop_changenode" title='prop_changenode' data-ref="prop_changenode" data-ref-filename="prop_changenode"><a class="type" href="#prop_changenode" title='prop_changenode' data-ref="prop_changenode" data-ref-filename="prop_changenode">prop_changenode</a></dfn> {</td></tr>
<tr><th id="68">68</th><td>	<a class="typedef" href="libzfs.h.html#zfs_handle_t" title='zfs_handle_t' data-type='struct zfs_handle' data-ref="zfs_handle_t" data-ref-filename="zfs_handle_t">zfs_handle_t</a>		*<dfn class="tu decl field" id="prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-type='zfs_handle_t *' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</dfn>;</td></tr>
<tr><th id="69">69</th><td>	<em>int</em>			<dfn class="tu decl field" id="prop_changenode::cn_shared" title='prop_changenode::cn_shared' data-type='int' data-ref="prop_changenode::cn_shared" data-ref-filename="prop_changenode..cn_shared">cn_shared</dfn>;</td></tr>
<tr><th id="70">70</th><td>	<em>int</em>			<dfn class="tu decl field" id="prop_changenode::cn_mounted" title='prop_changenode::cn_mounted' data-type='int' data-ref="prop_changenode::cn_mounted" data-ref-filename="prop_changenode..cn_mounted">cn_mounted</dfn>;</td></tr>
<tr><th id="71">71</th><td>	<em>int</em>			<dfn class="tu decl field" id="prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-type='int' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</dfn>;</td></tr>
<tr><th id="72">72</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="tu decl field" id="prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-type='boolean_t' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</dfn>;	<i  data-doc="prop_changenode::cn_needpost">/* is postfix() needed? */</i></td></tr>
<tr><th id="73">73</th><td>	<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_list_node_t" title='uu_list_node_t' data-type='struct uu_list_node' data-ref="uu_list_node_t" data-ref-filename="uu_list_node_t">uu_list_node_t</a>		<dfn class="tu decl field" id="prop_changenode::cn_listnode" title='prop_changenode::cn_listnode' data-type='uu_list_node_t' data-ref="prop_changenode::cn_listnode" data-ref-filename="prop_changenode..cn_listnode">cn_listnode</dfn>;</td></tr>
<tr><th id="74">74</th><td>} <dfn class="typedef" id="prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</dfn>;</td></tr>
<tr><th id="75">75</th><td></td></tr>
<tr><th id="76">76</th><td><b>struct</b> <dfn class="type def" id="prop_changelist" title='prop_changelist' data-ref="prop_changelist" data-ref-filename="prop_changelist">prop_changelist</dfn> {</td></tr>
<tr><th id="77">77</th><td>	<a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zfs_prop_t" title='zfs_prop_t' data-type='enum zfs_prop_t' data-ref="zfs_prop_t" data-ref-filename="zfs_prop_t">zfs_prop_t</a>		<dfn class="decl field" id="prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</dfn>;</td></tr>
<tr><th id="78">78</th><td>	<a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zfs_prop_t" title='zfs_prop_t' data-type='enum zfs_prop_t' data-ref="zfs_prop_t" data-ref-filename="zfs_prop_t">zfs_prop_t</a>		<dfn class="decl field" id="prop_changelist::cl_realprop" title='prop_changelist::cl_realprop' data-ref="prop_changelist::cl_realprop" data-ref-filename="prop_changelist..cl_realprop">cl_realprop</dfn>;</td></tr>
<tr><th id="79">79</th><td>	<a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zfs_prop_t" title='zfs_prop_t' data-type='enum zfs_prop_t' data-ref="zfs_prop_t" data-ref-filename="zfs_prop_t">zfs_prop_t</a>		<dfn class="decl field" id="prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</dfn>;  <i>/* used with sharenfs/sharesmb */</i></td></tr>
<tr><th id="80">80</th><td>	<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_list_pool_t" title='uu_list_pool_t' data-type='struct uu_list_pool' data-ref="uu_list_pool_t" data-ref-filename="uu_list_pool_t">uu_list_pool_t</a>		*<dfn class="decl field" id="prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</dfn>;</td></tr>
<tr><th id="81">81</th><td>	<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_list_t" title='uu_list_t' data-type='struct uu_list' data-ref="uu_list_t" data-ref-filename="uu_list_t">uu_list_t</a>		*<dfn class="decl field" id="prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</dfn>;</td></tr>
<tr><th id="82">82</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="decl field" id="prop_changelist::cl_waslegacy" title='prop_changelist::cl_waslegacy' data-ref="prop_changelist::cl_waslegacy" data-ref-filename="prop_changelist..cl_waslegacy">cl_waslegacy</dfn>;</td></tr>
<tr><th id="83">83</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="decl field" id="prop_changelist::cl_allchildren" title='prop_changelist::cl_allchildren' data-ref="prop_changelist::cl_allchildren" data-ref-filename="prop_changelist..cl_allchildren">cl_allchildren</dfn>;</td></tr>
<tr><th id="84">84</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="decl field" id="prop_changelist::cl_alldependents" title='prop_changelist::cl_alldependents' data-ref="prop_changelist::cl_alldependents" data-ref-filename="prop_changelist..cl_alldependents">cl_alldependents</dfn>;</td></tr>
<tr><th id="85">85</th><td>	<em>int</em>			<dfn class="decl field" id="prop_changelist::cl_mflags" title='prop_changelist::cl_mflags' data-ref="prop_changelist::cl_mflags" data-ref-filename="prop_changelist..cl_mflags">cl_mflags</dfn>;	<i>/* Mount flags */</i></td></tr>
<tr><th id="86">86</th><td>	<em>int</em>			<dfn class="decl field" id="prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</dfn>;	<i>/* Gather request flags */</i></td></tr>
<tr><th id="87">87</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="decl field" id="prop_changelist::cl_haszonedchild" title='prop_changelist::cl_haszonedchild' data-ref="prop_changelist::cl_haszonedchild" data-ref-filename="prop_changelist..cl_haszonedchild">cl_haszonedchild</dfn>;</td></tr>
<tr><th id="88">88</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a>		<dfn class="decl field" id="prop_changelist::cl_sorted" title='prop_changelist::cl_sorted' data-ref="prop_changelist::cl_sorted" data-ref-filename="prop_changelist..cl_sorted">cl_sorted</dfn>;</td></tr>
<tr><th id="89">89</th><td>};</td></tr>
<tr><th id="90">90</th><td></td></tr>
<tr><th id="91">91</th><td><i>/*</i></td></tr>
<tr><th id="92">92</th><td><i> * If the property is 'mountpoint', go through and unmount filesystems as</i></td></tr>
<tr><th id="93">93</th><td><i> * necessary.  We don't do the same for 'sharenfs', because we can just re-share</i></td></tr>
<tr><th id="94">94</th><td><i> * with different options without interrupting service. We do handle 'sharesmb'</i></td></tr>
<tr><th id="95">95</th><td><i> * since there may be old resource names that need to be removed.</i></td></tr>
<tr><th id="96">96</th><td><i> */</i></td></tr>
<tr><th id="97">97</th><td><em>int</em></td></tr>
<tr><th id="98">98</th><td><dfn class="decl def fn" id="changelist_prefix" title='changelist_prefix' data-ref="changelist_prefix" data-ref-filename="changelist_prefix">changelist_prefix</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col2 decl" id="62clp" title='clp' data-type='prop_changelist_t *' data-ref="62clp" data-ref-filename="62clp">clp</dfn>)</td></tr>
<tr><th id="99">99</th><td>{</td></tr>
<tr><th id="100">100</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col3 decl" id="63cn" title='cn' data-type='prop_changenode_t *' data-ref="63cn" data-ref-filename="63cn">cn</dfn>;</td></tr>
<tr><th id="101">101</th><td>	<em>int</em> <dfn class="local col4 decl" id="64ret" title='ret' data-type='int' data-ref="64ret" data-ref-filename="64ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td>	<b>if</b> (<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a> &amp;&amp;</td></tr>
<tr><th id="104">104</th><td>	    <a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>)</td></tr>
<tr><th id="105">105</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td>	<b>for</b> (<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_first" title='uu_list_first' data-ref="uu_list_first" data-ref-filename="uu_list_first">uu_list_first</a>(<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>); <a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="108">108</th><td>	    <a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_next" title='uu_list_next' data-ref="uu_list_next" data-ref-filename="uu_list_next">uu_list_next</a>(<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>)) {</td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td>		<i>/* if a previous loop failed, set the remaining to false */</i></td></tr>
<tr><th id="111">111</th><td>		<b>if</b> (<a class="local col4 ref" href="#64ret" title='ret' data-ref="64ret" data-ref-filename="64ret">ret</a> == -<var>1</var>) {</td></tr>
<tr><th id="112">112</th><td>			<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='w' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>;</td></tr>
<tr><th id="113">113</th><td>			<b>continue</b>;</td></tr>
<tr><th id="114">114</th><td>		}</td></tr>
<tr><th id="115">115</th><td></td></tr>
<tr><th id="116">116</th><td>		<i>/*</i></td></tr>
<tr><th id="117">117</th><td><i>		 * If we are in the global zone, but this dataset is exported</i></td></tr>
<tr><th id="118">118</th><td><i>		 * to a local zone, do nothing.</i></td></tr>
<tr><th id="119">119</th><td><i>		 */</i></td></tr>
<tr><th id="120">120</th><td>		<b>if</b> (<a class="ref fn" href="../../../../sys/sys/zone.h.html#getzoneid" title='getzoneid' data-ref="getzoneid" data-ref-filename="getzoneid">getzoneid</a>() == <a class="macro" href="../../../../sys/sys/zone.h.html#64" title="0" data-ref="_M/GLOBAL_ZONEID">GLOBAL_ZONEID</a> &amp;&amp; <a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-use='r' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</a>)</td></tr>
<tr><th id="121">121</th><td>			<b>continue</b>;</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td>		<b>if</b> (!<a class="macro" href="libzfs_impl.h.html#100" title="((cn-&gt;cn_handle)-&gt;zfs_head_type == ZFS_TYPE_VOLUME)" data-ref="_M/ZFS_IS_VOLUME">ZFS_IS_VOLUME</a>(<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>)) {</td></tr>
<tr><th id="124">124</th><td>			<i>/*</i></td></tr>
<tr><th id="125">125</th><td><i>			 * Do the property specific processing.</i></td></tr>
<tr><th id="126">126</th><td><i>			 */</i></td></tr>
<tr><th id="127">127</th><td>			<b>switch</b> (<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a>) {</td></tr>
<tr><th id="128">128</th><td>			<b>case</b> <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>:</td></tr>
<tr><th id="129">129</th><td>				<b>if</b> (<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> &amp; <a class="macro" href="libzfs_impl.h.html#163" title="0x02" data-ref="_M/CL_GATHER_DONT_UNMOUNT">CL_GATHER_DONT_UNMOUNT</a>)</td></tr>
<tr><th id="130">130</th><td>					<b>break</b>;</td></tr>
<tr><th id="131">131</th><td>				<b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_unmount" title='zfs_unmount' data-ref="zfs_unmount" data-ref-filename="zfs_unmount">zfs_unmount</a>(<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="132">132</th><td>				    <a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_mflags" title='prop_changelist::cl_mflags' data-ref="prop_changelist::cl_mflags" data-ref-filename="prop_changelist..cl_mflags">cl_mflags</a>) != <var>0</var>) {</td></tr>
<tr><th id="133">133</th><td>					<a class="local col4 ref" href="#64ret" title='ret' data-ref="64ret" data-ref-filename="64ret">ret</a> = -<var>1</var>;</td></tr>
<tr><th id="134">134</th><td>					<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='w' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>;</td></tr>
<tr><th id="135">135</th><td>				}</td></tr>
<tr><th id="136">136</th><td>				<b>break</b>;</td></tr>
<tr><th id="137">137</th><td>			<b>case</b> <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>:</td></tr>
<tr><th id="138">138</th><td>				(<em>void</em>) <a class="ref fn" href="libzfs.h.html#zfs_unshare_smb" title='zfs_unshare_smb' data-ref="zfs_unshare_smb" data-ref-filename="zfs_unshare_smb">zfs_unshare_smb</a>(<a class="local col3 ref" href="#63cn" title='cn' data-ref="63cn" data-ref-filename="63cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="139">139</th><td>				<b>break</b>;</td></tr>
<tr><th id="140">140</th><td></td></tr>
<tr><th id="141">141</th><td>			<b>default</b>:</td></tr>
<tr><th id="142">142</th><td>				<b>break</b>;</td></tr>
<tr><th id="143">143</th><td>			}</td></tr>
<tr><th id="144">144</th><td>		}</td></tr>
<tr><th id="145">145</th><td>	}</td></tr>
<tr><th id="146">146</th><td></td></tr>
<tr><th id="147">147</th><td>	<b>if</b> (<a class="local col4 ref" href="#64ret" title='ret' data-ref="64ret" data-ref-filename="64ret">ret</a> == -<var>1</var>)</td></tr>
<tr><th id="148">148</th><td>		(<em>void</em>) <a class="ref fn" href="#changelist_postfix" title='changelist_postfix' data-ref="changelist_postfix" data-ref-filename="changelist_postfix">changelist_postfix</a>(<a class="local col2 ref" href="#62clp" title='clp' data-ref="62clp" data-ref-filename="62clp">clp</a>);</td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td>	<b>return</b> (<a class="local col4 ref" href="#64ret" title='ret' data-ref="64ret" data-ref-filename="64ret">ret</a>);</td></tr>
<tr><th id="151">151</th><td>}</td></tr>
<tr><th id="152">152</th><td></td></tr>
<tr><th id="153">153</th><td><i>/*</i></td></tr>
<tr><th id="154">154</th><td><i> * If the property is 'mountpoint' or 'sharenfs', go through and remount and/or</i></td></tr>
<tr><th id="155">155</th><td><i> * reshare the filesystems as necessary.  In changelist_gather() we recorded</i></td></tr>
<tr><th id="156">156</th><td><i> * whether the filesystem was previously shared or mounted.  The action we take</i></td></tr>
<tr><th id="157">157</th><td><i> * depends on the previous state, and whether the value was previously 'legacy'.</i></td></tr>
<tr><th id="158">158</th><td><i> * For non-legacy properties, we only remount/reshare the filesystem if it was</i></td></tr>
<tr><th id="159">159</th><td><i> * previously mounted/shared.  Otherwise, we always remount/reshare the</i></td></tr>
<tr><th id="160">160</th><td><i> * filesystem.</i></td></tr>
<tr><th id="161">161</th><td><i> */</i></td></tr>
<tr><th id="162">162</th><td><em>int</em></td></tr>
<tr><th id="163">163</th><td><dfn class="decl def fn" id="changelist_postfix" title='changelist_postfix' data-ref="changelist_postfix" data-ref-filename="changelist_postfix">changelist_postfix</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col5 decl" id="65clp" title='clp' data-type='prop_changelist_t *' data-ref="65clp" data-ref-filename="65clp">clp</dfn>)</td></tr>
<tr><th id="164">164</th><td>{</td></tr>
<tr><th id="165">165</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col6 decl" id="66cn" title='cn' data-type='prop_changenode_t *' data-ref="66cn" data-ref-filename="66cn">cn</dfn>;</td></tr>
<tr><th id="166">166</th><td>	<em>char</em> <dfn class="local col7 decl" id="67shareopts" title='shareopts' data-type='char [1024]' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</dfn>[<a class="macro" href="libzfs.h.html#54" title="1024" data-ref="_M/ZFS_MAXPROPLEN">ZFS_MAXPROPLEN</a>];</td></tr>
<tr><th id="167">167</th><td>	<em>int</em> <dfn class="local col8 decl" id="68errors" title='errors' data-type='int' data-ref="68errors" data-ref-filename="68errors">errors</dfn> = <var>0</var>;</td></tr>
<tr><th id="168">168</th><td>	<a class="typedef" href="libzfs.h.html#libzfs_handle_t" title='libzfs_handle_t' data-type='struct libzfs_handle' data-ref="libzfs_handle_t" data-ref-filename="libzfs_handle_t">libzfs_handle_t</a> *<dfn class="local col9 decl" id="69hdl" title='hdl' data-type='libzfs_handle_t *' data-ref="69hdl" data-ref-filename="69hdl">hdl</dfn>;</td></tr>
<tr><th id="169">169</th><td></td></tr>
<tr><th id="170">170</th><td>	<i>/*</i></td></tr>
<tr><th id="171">171</th><td><i>	 * If we're changing the mountpoint, attempt to destroy the underlying</i></td></tr>
<tr><th id="172">172</th><td><i>	 * mountpoint.  All other datasets will have inherited from this dataset</i></td></tr>
<tr><th id="173">173</th><td><i>	 * (in which case their mountpoints exist in the filesystem in the new</i></td></tr>
<tr><th id="174">174</th><td><i>	 * location), or have explicit mountpoints set (in which case they won't</i></td></tr>
<tr><th id="175">175</th><td><i>	 * be in the changelist).</i></td></tr>
<tr><th id="176">176</th><td><i>	 */</i></td></tr>
<tr><th id="177">177</th><td>	<b>if</b> ((<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_last" title='uu_list_last' data-ref="uu_list_last" data-ref-filename="uu_list_last">uu_list_last</a>(<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>)) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="178">178</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td>	<b>if</b> (<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a> &amp;&amp;</td></tr>
<tr><th id="181">181</th><td>	    !(<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> &amp; <a class="macro" href="libzfs_impl.h.html#163" title="0x02" data-ref="_M/CL_GATHER_DONT_UNMOUNT">CL_GATHER_DONT_UNMOUNT</a>)) {</td></tr>
<tr><th id="182">182</th><td>		<a class="ref fn" href="libzfs_impl.h.html#remove_mountpoint" title='remove_mountpoint' data-ref="remove_mountpoint" data-ref-filename="remove_mountpoint">remove_mountpoint</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="183">183</th><td>	}</td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td>	<i>/*</i></td></tr>
<tr><th id="186">186</th><td><i>	 * It is possible that the changelist_prefix() used libshare</i></td></tr>
<tr><th id="187">187</th><td><i>	 * to unshare some entries. Since libshare caches data, an</i></td></tr>
<tr><th id="188">188</th><td><i>	 * attempt to reshare during postfix can fail unless libshare</i></td></tr>
<tr><th id="189">189</th><td><i>	 * is uninitialized here so that it will reinitialize later.</i></td></tr>
<tr><th id="190">190</th><td><i>	 */</i></td></tr>
<tr><th id="191">191</th><td>	<b>if</b> (<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="192">192</th><td>		<a class="local col9 ref" href="#69hdl" title='hdl' data-ref="69hdl" data-ref-filename="69hdl">hdl</a> = <a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>;</td></tr>
<tr><th id="193">193</th><td>		<a class="macro" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/assert.h.html#58" title="((hdl != ((void*)0)) ? (void)0 : __assert13(&quot;/___NETBSD_SRC___/objdir.amd64/compat/amd64/i386/external/cddl/osnet/lib/libzfs/../../../../../../../../../external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c&quot;, 193, __func__, &quot;hdl != NULL&quot;))" data-ref="_M/assert">assert</a>(<a class="local col9 ref" href="#69hdl" title='hdl' data-ref="69hdl" data-ref-filename="69hdl">hdl</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="194">194</th><td>		<a class="ref fn" href="libzfs_impl.h.html#zfs_uninit_libshare" title='zfs_uninit_libshare' data-ref="zfs_uninit_libshare" data-ref-filename="zfs_uninit_libshare">zfs_uninit_libshare</a>(<a class="local col9 ref" href="#69hdl" title='hdl' data-ref="69hdl" data-ref-filename="69hdl">hdl</a>);</td></tr>
<tr><th id="195">195</th><td>	}</td></tr>
<tr><th id="196">196</th><td></td></tr>
<tr><th id="197">197</th><td>	<i>/*</i></td></tr>
<tr><th id="198">198</th><td><i>	 * We walk the datasets in reverse, because we want to mount any parent</i></td></tr>
<tr><th id="199">199</th><td><i>	 * datasets before mounting the children.  We walk all datasets even if</i></td></tr>
<tr><th id="200">200</th><td><i>	 * there are errors.</i></td></tr>
<tr><th id="201">201</th><td><i>	 */</i></td></tr>
<tr><th id="202">202</th><td>	<b>for</b> (<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_last" title='uu_list_last' data-ref="uu_list_last" data-ref-filename="uu_list_last">uu_list_last</a>(<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>); <a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="203">203</th><td>	    <a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_prev" title='uu_list_prev' data-ref="uu_list_prev" data-ref-filename="uu_list_prev">uu_list_prev</a>(<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>)) {</td></tr>
<tr><th id="204">204</th><td></td></tr>
<tr><th id="205">205</th><td>		<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a> <dfn class="local col0 decl" id="70sharenfs" title='sharenfs' data-type='boolean_t' data-ref="70sharenfs" data-ref-filename="70sharenfs">sharenfs</dfn>;</td></tr>
<tr><th id="206">206</th><td>		<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a> <dfn class="local col1 decl" id="71sharesmb" title='sharesmb' data-type='boolean_t' data-ref="71sharesmb" data-ref-filename="71sharesmb">sharesmb</dfn>;</td></tr>
<tr><th id="207">207</th><td>		<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a> <dfn class="local col2 decl" id="72mounted" title='mounted' data-type='boolean_t' data-ref="72mounted" data-ref-filename="72mounted">mounted</dfn>;</td></tr>
<tr><th id="208">208</th><td></td></tr>
<tr><th id="209">209</th><td>		<i>/*</i></td></tr>
<tr><th id="210">210</th><td><i>		 * If we are in the global zone, but this dataset is exported</i></td></tr>
<tr><th id="211">211</th><td><i>		 * to a local zone, do nothing.</i></td></tr>
<tr><th id="212">212</th><td><i>		 */</i></td></tr>
<tr><th id="213">213</th><td>		<b>if</b> (<a class="ref fn" href="../../../../sys/sys/zone.h.html#getzoneid" title='getzoneid' data-ref="getzoneid" data-ref-filename="getzoneid">getzoneid</a>() == <a class="macro" href="../../../../sys/sys/zone.h.html#64" title="0" data-ref="_M/GLOBAL_ZONEID">GLOBAL_ZONEID</a> &amp;&amp; <a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-use='r' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</a>)</td></tr>
<tr><th id="214">214</th><td>			<b>continue</b>;</td></tr>
<tr><th id="215">215</th><td></td></tr>
<tr><th id="216">216</th><td>		<i>/* Only do post-processing if it's required */</i></td></tr>
<tr><th id="217">217</th><td>		<b>if</b> (!<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='r' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a>)</td></tr>
<tr><th id="218">218</th><td>			<b>continue</b>;</td></tr>
<tr><th id="219">219</th><td>		<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='w' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>;</td></tr>
<tr><th id="220">220</th><td></td></tr>
<tr><th id="221">221</th><td>		<a class="ref fn" href="libzfs.h.html#zfs_refresh_properties" title='zfs_refresh_properties' data-ref="zfs_refresh_properties" data-ref-filename="zfs_refresh_properties">zfs_refresh_properties</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="222">222</th><td></td></tr>
<tr><th id="223">223</th><td>		<b>if</b> (<a class="macro" href="libzfs_impl.h.html#100" title="((cn-&gt;cn_handle)-&gt;zfs_head_type == ZFS_TYPE_VOLUME)" data-ref="_M/ZFS_IS_VOLUME">ZFS_IS_VOLUME</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>))</td></tr>
<tr><th id="224">224</th><td>			<b>continue</b>;</td></tr>
<tr><th id="225">225</th><td></td></tr>
<tr><th id="226">226</th><td>		<i>/*</i></td></tr>
<tr><th id="227">227</th><td><i>		 * Remount if previously mounted or mountpoint was legacy,</i></td></tr>
<tr><th id="228">228</th><td><i>		 * or sharenfs or sharesmb  property is set.</i></td></tr>
<tr><th id="229">229</th><td><i>		 */</i></td></tr>
<tr><th id="230">230</th><td>		<a class="local col0 ref" href="#70sharenfs" title='sharenfs' data-ref="70sharenfs" data-ref-filename="70sharenfs">sharenfs</a> = ((<a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a>,</td></tr>
<tr><th id="231">231</th><td>		    <a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>, <b>sizeof</b> (<a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>), <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>,</td></tr>
<tr><th id="232">232</th><td>		    <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) == <var>0</var>) &amp;&amp; (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>, <q>"off"</q>) != <var>0</var>));</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td>		<a class="local col1 ref" href="#71sharesmb" title='sharesmb' data-ref="71sharesmb" data-ref-filename="71sharesmb">sharesmb</a> = ((<a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>,</td></tr>
<tr><th id="235">235</th><td>		    <a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>, <b>sizeof</b> (<a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>), <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>,</td></tr>
<tr><th id="236">236</th><td>		    <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) == <var>0</var>) &amp;&amp; (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col7 ref" href="#67shareopts" title='shareopts' data-ref="67shareopts" data-ref-filename="67shareopts">shareopts</a>, <q>"off"</q>) != <var>0</var>));</td></tr>
<tr><th id="237">237</th><td></td></tr>
<tr><th id="238">238</th><td>		<a class="local col2 ref" href="#72mounted" title='mounted' data-ref="72mounted" data-ref-filename="72mounted">mounted</a> = (<a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> &amp; <a class="macro" href="libzfs_impl.h.html#163" title="0x02" data-ref="_M/CL_GATHER_DONT_UNMOUNT">CL_GATHER_DONT_UNMOUNT</a>) ||</td></tr>
<tr><th id="239">239</th><td>		    <a class="ref fn" href="libzfs.h.html#zfs_is_mounted" title='zfs_is_mounted' data-ref="zfs_is_mounted" data-ref-filename="zfs_is_mounted">zfs_is_mounted</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="240">240</th><td></td></tr>
<tr><th id="241">241</th><td>		<b>if</b> (!<a class="local col2 ref" href="#72mounted" title='mounted' data-ref="72mounted" data-ref-filename="72mounted">mounted</a> &amp;&amp; (<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_mounted" title='prop_changenode::cn_mounted' data-use='r' data-ref="prop_changenode::cn_mounted" data-ref-filename="prop_changenode..cn_mounted">cn_mounted</a> ||</td></tr>
<tr><th id="242">242</th><td>		    ((<a class="local col0 ref" href="#70sharenfs" title='sharenfs' data-ref="70sharenfs" data-ref-filename="70sharenfs">sharenfs</a> || <a class="local col1 ref" href="#71sharesmb" title='sharesmb' data-ref="71sharesmb" data-ref-filename="71sharesmb">sharesmb</a> || <a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_waslegacy" title='prop_changelist::cl_waslegacy' data-ref="prop_changelist::cl_waslegacy" data-ref-filename="prop_changelist..cl_waslegacy">cl_waslegacy</a>) &amp;&amp;</td></tr>
<tr><th id="243">243</th><td>		    (<a class="ref fn" href="libzfs.h.html#zfs_prop_get_int" title='zfs_prop_get_int' data-ref="zfs_prop_get_int" data-ref-filename="zfs_prop_get_int">zfs_prop_get_int</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>,</td></tr>
<tr><th id="244">244</th><td>		    <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_CANMOUNT" title='ZFS_PROP_CANMOUNT' data-ref="ZFS_PROP_CANMOUNT" data-ref-filename="ZFS_PROP_CANMOUNT">ZFS_PROP_CANMOUNT</a>) == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_CANMOUNT_ON" title='ZFS_CANMOUNT_ON' data-ref="ZFS_CANMOUNT_ON" data-ref-filename="ZFS_CANMOUNT_ON">ZFS_CANMOUNT_ON</a>)))) {</td></tr>
<tr><th id="245">245</th><td></td></tr>
<tr><th id="246">246</th><td>			<b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_mount" title='zfs_mount' data-ref="zfs_mount" data-ref-filename="zfs_mount">zfs_mount</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>) != <var>0</var>)</td></tr>
<tr><th id="247">247</th><td>				<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a>++;</td></tr>
<tr><th id="248">248</th><td>			<b>else</b></td></tr>
<tr><th id="249">249</th><td>				<a class="local col2 ref" href="#72mounted" title='mounted' data-ref="72mounted" data-ref-filename="72mounted">mounted</a> = <a class="macro" href="../../../uts/common/fs/zfs/sys/zfs_debug.h.html#34" title="1" data-ref="_M/TRUE">TRUE</a>;</td></tr>
<tr><th id="250">250</th><td>		}</td></tr>
<tr><th id="251">251</th><td></td></tr>
<tr><th id="252">252</th><td>		<i>/*</i></td></tr>
<tr><th id="253">253</th><td><i>		 * If the file system is mounted we always re-share even</i></td></tr>
<tr><th id="254">254</th><td><i>		 * if the filesystem is currently shared, so that we can</i></td></tr>
<tr><th id="255">255</th><td><i>		 * adopt any new options.</i></td></tr>
<tr><th id="256">256</th><td><i>		 */</i></td></tr>
<tr><th id="257">257</th><td>		<b>if</b> (<a class="local col0 ref" href="#70sharenfs" title='sharenfs' data-ref="70sharenfs" data-ref-filename="70sharenfs">sharenfs</a> &amp;&amp; <a class="local col2 ref" href="#72mounted" title='mounted' data-ref="72mounted" data-ref-filename="72mounted">mounted</a>)</td></tr>
<tr><th id="258">258</th><td>			<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a> += <a class="ref fn" href="libzfs.h.html#zfs_share_nfs" title='zfs_share_nfs' data-ref="zfs_share_nfs" data-ref-filename="zfs_share_nfs">zfs_share_nfs</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="259">259</th><td>		<b>else</b> <b>if</b> (<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_shared" title='prop_changenode::cn_shared' data-use='r' data-ref="prop_changenode::cn_shared" data-ref-filename="prop_changenode..cn_shared">cn_shared</a> || <a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_waslegacy" title='prop_changelist::cl_waslegacy' data-ref="prop_changelist::cl_waslegacy" data-ref-filename="prop_changelist..cl_waslegacy">cl_waslegacy</a>)</td></tr>
<tr><th id="260">260</th><td>			<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a> += <a class="ref fn" href="libzfs.h.html#zfs_unshare_nfs" title='zfs_unshare_nfs' data-ref="zfs_unshare_nfs" data-ref-filename="zfs_unshare_nfs">zfs_unshare_nfs</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="261">261</th><td>		<b>if</b> (<a class="local col1 ref" href="#71sharesmb" title='sharesmb' data-ref="71sharesmb" data-ref-filename="71sharesmb">sharesmb</a> &amp;&amp; <a class="local col2 ref" href="#72mounted" title='mounted' data-ref="72mounted" data-ref-filename="72mounted">mounted</a>)</td></tr>
<tr><th id="262">262</th><td>			<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a> += <a class="ref fn" href="libzfs.h.html#zfs_share_smb" title='zfs_share_smb' data-ref="zfs_share_smb" data-ref-filename="zfs_share_smb">zfs_share_smb</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="263">263</th><td>		<b>else</b> <b>if</b> (<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_shared" title='prop_changenode::cn_shared' data-use='r' data-ref="prop_changenode::cn_shared" data-ref-filename="prop_changenode..cn_shared">cn_shared</a> || <a class="local col5 ref" href="#65clp" title='clp' data-ref="65clp" data-ref-filename="65clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_waslegacy" title='prop_changelist::cl_waslegacy' data-ref="prop_changelist::cl_waslegacy" data-ref-filename="prop_changelist..cl_waslegacy">cl_waslegacy</a>)</td></tr>
<tr><th id="264">264</th><td>			<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a> += <a class="ref fn" href="libzfs.h.html#zfs_unshare_smb" title='zfs_unshare_smb' data-ref="zfs_unshare_smb" data-ref-filename="zfs_unshare_smb">zfs_unshare_smb</a>(<a class="local col6 ref" href="#66cn" title='cn' data-ref="66cn" data-ref-filename="66cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="265">265</th><td>	}</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td>	<b>return</b> (<a class="local col8 ref" href="#68errors" title='errors' data-ref="68errors" data-ref-filename="68errors">errors</a> ? -<var>1</var> : <var>0</var>);</td></tr>
<tr><th id="268">268</th><td>}</td></tr>
<tr><th id="269">269</th><td></td></tr>
<tr><th id="270">270</th><td><i>/*</i></td></tr>
<tr><th id="271">271</th><td><i> * Is this "dataset" a child of "parent"?</i></td></tr>
<tr><th id="272">272</th><td><i> */</i></td></tr>
<tr><th id="273">273</th><td><a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a></td></tr>
<tr><th id="274">274</th><td><dfn class="decl def fn" id="isa_child_of" title='isa_child_of' data-ref="isa_child_of" data-ref-filename="isa_child_of">isa_child_of</dfn>(<em>const</em> <em>char</em> *<dfn class="local col3 decl" id="73dataset" title='dataset' data-type='const char *' data-ref="73dataset" data-ref-filename="73dataset">dataset</dfn>, <em>const</em> <em>char</em> *<dfn class="local col4 decl" id="74parent" title='parent' data-type='const char *' data-ref="74parent" data-ref-filename="74parent">parent</dfn>)</td></tr>
<tr><th id="275">275</th><td>{</td></tr>
<tr><th id="276">276</th><td>	<em>int</em> <dfn class="local col5 decl" id="75len" title='len' data-type='int' data-ref="75len" data-ref-filename="75len">len</dfn>;</td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td>	<a class="local col5 ref" href="#75len" title='len' data-ref="75len" data-ref-filename="75len">len</a> = <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strlen" title='strlen' data-ref="strlen" data-ref-filename="strlen">strlen</a>(<a class="local col4 ref" href="#74parent" title='parent' data-ref="74parent" data-ref-filename="74parent">parent</a>);</td></tr>
<tr><th id="279">279</th><td></td></tr>
<tr><th id="280">280</th><td>	<b>if</b> (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col3 ref" href="#73dataset" title='dataset' data-ref="73dataset" data-ref-filename="73dataset">dataset</a>, <a class="local col4 ref" href="#74parent" title='parent' data-ref="74parent" data-ref-filename="74parent">parent</a>, <a class="local col5 ref" href="#75len" title='len' data-ref="75len" data-ref-filename="75len">len</a>) == <var>0</var> &amp;&amp;</td></tr>
<tr><th id="281">281</th><td>	    (<a class="local col3 ref" href="#73dataset" title='dataset' data-ref="73dataset" data-ref-filename="73dataset">dataset</a>[<a class="local col5 ref" href="#75len" title='len' data-ref="75len" data-ref-filename="75len">len</a>] == <kbd>'@'</kbd> || <a class="local col3 ref" href="#73dataset" title='dataset' data-ref="73dataset" data-ref-filename="73dataset">dataset</a>[<a class="local col5 ref" href="#75len" title='len' data-ref="75len" data-ref-filename="75len">len</a>] == <kbd>'/'</kbd> ||</td></tr>
<tr><th id="282">282</th><td>	    <a class="local col3 ref" href="#73dataset" title='dataset' data-ref="73dataset" data-ref-filename="73dataset">dataset</a>[<a class="local col5 ref" href="#75len" title='len' data-ref="75len" data-ref-filename="75len">len</a>] == <kbd>'\0'</kbd>))</td></tr>
<tr><th id="283">283</th><td>		<b>return</b> (<a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>);</td></tr>
<tr><th id="284">284</th><td>	<b>else</b></td></tr>
<tr><th id="285">285</th><td>		<b>return</b> (<a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>);</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td>}</td></tr>
<tr><th id="288">288</th><td></td></tr>
<tr><th id="289">289</th><td><i>/*</i></td></tr>
<tr><th id="290">290</th><td><i> * If we rename a filesystem, child filesystem handles are no longer valid</i></td></tr>
<tr><th id="291">291</th><td><i> * since we identify each dataset by its name in the ZFS namespace.  As a</i></td></tr>
<tr><th id="292">292</th><td><i> * result, we have to go through and fix up all the names appropriately.  We</i></td></tr>
<tr><th id="293">293</th><td><i> * could do this automatically if libzfs kept track of all open handles, but</i></td></tr>
<tr><th id="294">294</th><td><i> * this is a lot less work.</i></td></tr>
<tr><th id="295">295</th><td><i> */</i></td></tr>
<tr><th id="296">296</th><td><em>void</em></td></tr>
<tr><th id="297">297</th><td><dfn class="decl def fn" id="changelist_rename" title='changelist_rename' data-ref="changelist_rename" data-ref-filename="changelist_rename">changelist_rename</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col6 decl" id="76clp" title='clp' data-type='prop_changelist_t *' data-ref="76clp" data-ref-filename="76clp">clp</dfn>, <em>const</em> <em>char</em> *<dfn class="local col7 decl" id="77src" title='src' data-type='const char *' data-ref="77src" data-ref-filename="77src">src</dfn>, <em>const</em> <em>char</em> *<dfn class="local col8 decl" id="78dst" title='dst' data-type='const char *' data-ref="78dst" data-ref-filename="78dst">dst</dfn>)</td></tr>
<tr><th id="298">298</th><td>{</td></tr>
<tr><th id="299">299</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col9 decl" id="79cn" title='cn' data-type='prop_changenode_t *' data-ref="79cn" data-ref-filename="79cn">cn</dfn>;</td></tr>
<tr><th id="300">300</th><td>	<em>char</em> <dfn class="local col0 decl" id="80newname" title='newname' data-type='char [256]' data-ref="80newname" data-ref-filename="80newname">newname</dfn>[<a class="macro" href="../../../uts/common/sys/fs/zfs.h.html#83" title="256" data-ref="_M/ZFS_MAX_DATASET_NAME_LEN">ZFS_MAX_DATASET_NAME_LEN</a>];</td></tr>
<tr><th id="301">301</th><td></td></tr>
<tr><th id="302">302</th><td>	<b>for</b> (<a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_first" title='uu_list_first' data-ref="uu_list_first" data-ref-filename="uu_list_first">uu_list_first</a>(<a class="local col6 ref" href="#76clp" title='clp' data-ref="76clp" data-ref-filename="76clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>); <a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="303">303</th><td>	    <a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_next" title='uu_list_next' data-ref="uu_list_next" data-ref-filename="uu_list_next">uu_list_next</a>(<a class="local col6 ref" href="#76clp" title='clp' data-ref="76clp" data-ref-filename="76clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>)) {</td></tr>
<tr><th id="304">304</th><td>		<i>/*</i></td></tr>
<tr><th id="305">305</th><td><i>		 * Do not rename a clone that's not in the source hierarchy.</i></td></tr>
<tr><th id="306">306</th><td><i>		 */</i></td></tr>
<tr><th id="307">307</th><td>		<b>if</b> (!<a class="ref fn" href="#isa_child_of" title='isa_child_of' data-ref="isa_child_of" data-ref-filename="isa_child_of">isa_child_of</a>(<a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_name" title='zfs_handle::zfs_name' data-ref="zfs_handle::zfs_name" data-ref-filename="zfs_handle..zfs_name">zfs_name</a>, <a class="local col7 ref" href="#77src" title='src' data-ref="77src" data-ref-filename="77src">src</a>))</td></tr>
<tr><th id="308">308</th><td>			<b>continue</b>;</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td>		<i>/*</i></td></tr>
<tr><th id="311">311</th><td><i>		 * Destroy the previous mountpoint if needed.</i></td></tr>
<tr><th id="312">312</th><td><i>		 */</i></td></tr>
<tr><th id="313">313</th><td>		<a class="ref fn" href="libzfs_impl.h.html#remove_mountpoint" title='remove_mountpoint' data-ref="remove_mountpoint" data-ref-filename="remove_mountpoint">remove_mountpoint</a>(<a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="314">314</th><td></td></tr>
<tr><th id="315">315</th><td>		(<em>void</em>) <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strlcpy" title='strlcpy' data-ref="strlcpy" data-ref-filename="strlcpy">strlcpy</a>(<a class="local col0 ref" href="#80newname" title='newname' data-ref="80newname" data-ref-filename="80newname">newname</a>, <a class="local col8 ref" href="#78dst" title='dst' data-ref="78dst" data-ref-filename="78dst">dst</a>, <b>sizeof</b> (<a class="local col0 ref" href="#80newname" title='newname' data-ref="80newname" data-ref-filename="80newname">newname</a>));</td></tr>
<tr><th id="316">316</th><td>		(<em>void</em>) <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcat" title='strcat' data-ref="strcat" data-ref-filename="strcat">strcat</a>(<a class="local col0 ref" href="#80newname" title='newname' data-ref="80newname" data-ref-filename="80newname">newname</a>, <a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_name" title='zfs_handle::zfs_name' data-ref="zfs_handle::zfs_name" data-ref-filename="zfs_handle..zfs_name">zfs_name</a> + <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strlen" title='strlen' data-ref="strlen" data-ref-filename="strlen">strlen</a>(<a class="local col7 ref" href="#77src" title='src' data-ref="77src" data-ref-filename="77src">src</a>));</td></tr>
<tr><th id="317">317</th><td></td></tr>
<tr><th id="318">318</th><td>		(<em>void</em>) <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strlcpy" title='strlcpy' data-ref="strlcpy" data-ref-filename="strlcpy">strlcpy</a>(<a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_name" title='zfs_handle::zfs_name' data-ref="zfs_handle::zfs_name" data-ref-filename="zfs_handle..zfs_name">zfs_name</a>, <a class="local col0 ref" href="#80newname" title='newname' data-ref="80newname" data-ref-filename="80newname">newname</a>,</td></tr>
<tr><th id="319">319</th><td>		    <b>sizeof</b> (<a class="local col9 ref" href="#79cn" title='cn' data-ref="79cn" data-ref-filename="79cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_name" title='zfs_handle::zfs_name' data-ref="zfs_handle::zfs_name" data-ref-filename="zfs_handle..zfs_name">zfs_name</a>));</td></tr>
<tr><th id="320">320</th><td>	}</td></tr>
<tr><th id="321">321</th><td>}</td></tr>
<tr><th id="322">322</th><td></td></tr>
<tr><th id="323">323</th><td><i>/*</i></td></tr>
<tr><th id="324">324</th><td><i> * Given a gathered changelist for the 'sharenfs' or 'sharesmb' property,</i></td></tr>
<tr><th id="325">325</th><td><i> * unshare all the datasets in the list.</i></td></tr>
<tr><th id="326">326</th><td><i> */</i></td></tr>
<tr><th id="327">327</th><td><em>int</em></td></tr>
<tr><th id="328">328</th><td><dfn class="decl def fn" id="changelist_unshare" title='changelist_unshare' data-ref="changelist_unshare" data-ref-filename="changelist_unshare">changelist_unshare</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col1 decl" id="81clp" title='clp' data-type='prop_changelist_t *' data-ref="81clp" data-ref-filename="81clp">clp</dfn>, <a class="typedef" href="libzfs_impl.h.html#zfs_share_proto_t" title='zfs_share_proto_t' data-type='enum zfs_share_proto_t' data-ref="zfs_share_proto_t" data-ref-filename="zfs_share_proto_t">zfs_share_proto_t</a> *<dfn class="local col2 decl" id="82proto" title='proto' data-type='zfs_share_proto_t *' data-ref="82proto" data-ref-filename="82proto">proto</dfn>)</td></tr>
<tr><th id="329">329</th><td>{</td></tr>
<tr><th id="330">330</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col3 decl" id="83cn" title='cn' data-type='prop_changenode_t *' data-ref="83cn" data-ref-filename="83cn">cn</dfn>;</td></tr>
<tr><th id="331">331</th><td>	<em>int</em> <dfn class="local col4 decl" id="84ret" title='ret' data-type='int' data-ref="84ret" data-ref-filename="84ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="332">332</th><td></td></tr>
<tr><th id="333">333</th><td>	<b>if</b> (<a class="local col1 ref" href="#81clp" title='clp' data-ref="81clp" data-ref-filename="81clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a> &amp;&amp;</td></tr>
<tr><th id="334">334</th><td>	    <a class="local col1 ref" href="#81clp" title='clp' data-ref="81clp" data-ref-filename="81clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>)</td></tr>
<tr><th id="335">335</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td>	<b>for</b> (<a class="local col3 ref" href="#83cn" title='cn' data-ref="83cn" data-ref-filename="83cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_first" title='uu_list_first' data-ref="uu_list_first" data-ref-filename="uu_list_first">uu_list_first</a>(<a class="local col1 ref" href="#81clp" title='clp' data-ref="81clp" data-ref-filename="81clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>); <a class="local col3 ref" href="#83cn" title='cn' data-ref="83cn" data-ref-filename="83cn">cn</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="338">338</th><td>	    <a class="local col3 ref" href="#83cn" title='cn' data-ref="83cn" data-ref-filename="83cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_next" title='uu_list_next' data-ref="uu_list_next" data-ref-filename="uu_list_next">uu_list_next</a>(<a class="local col1 ref" href="#81clp" title='clp' data-ref="81clp" data-ref-filename="81clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col3 ref" href="#83cn" title='cn' data-ref="83cn" data-ref-filename="83cn">cn</a>)) {</td></tr>
<tr><th id="339">339</th><td>		<b>if</b> (<a class="ref fn" href="libzfs_impl.h.html#zfs_unshare_proto" title='zfs_unshare_proto' data-ref="zfs_unshare_proto" data-ref-filename="zfs_unshare_proto">zfs_unshare_proto</a>(<a class="local col3 ref" href="#83cn" title='cn' data-ref="83cn" data-ref-filename="83cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <a class="local col2 ref" href="#82proto" title='proto' data-ref="82proto" data-ref-filename="82proto">proto</a>) != <var>0</var>)</td></tr>
<tr><th id="340">340</th><td>			<a class="local col4 ref" href="#84ret" title='ret' data-ref="84ret" data-ref-filename="84ret">ret</a> = -<var>1</var>;</td></tr>
<tr><th id="341">341</th><td>	}</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td>	<b>return</b> (<a class="local col4 ref" href="#84ret" title='ret' data-ref="84ret" data-ref-filename="84ret">ret</a>);</td></tr>
<tr><th id="344">344</th><td>}</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td><i>/*</i></td></tr>
<tr><th id="347">347</th><td><i> * Check if there is any child exported to a local zone in a given changelist.</i></td></tr>
<tr><th id="348">348</th><td><i> * This information has already been recorded while gathering the changelist</i></td></tr>
<tr><th id="349">349</th><td><i> * via changelist_gather().</i></td></tr>
<tr><th id="350">350</th><td><i> */</i></td></tr>
<tr><th id="351">351</th><td><em>int</em></td></tr>
<tr><th id="352">352</th><td><dfn class="decl def fn" id="changelist_haszonedchild" title='changelist_haszonedchild' data-ref="changelist_haszonedchild" data-ref-filename="changelist_haszonedchild">changelist_haszonedchild</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col5 decl" id="85clp" title='clp' data-type='prop_changelist_t *' data-ref="85clp" data-ref-filename="85clp">clp</dfn>)</td></tr>
<tr><th id="353">353</th><td>{</td></tr>
<tr><th id="354">354</th><td>	<b>return</b> (<a class="local col5 ref" href="#85clp" title='clp' data-ref="85clp" data-ref-filename="85clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_haszonedchild" title='prop_changelist::cl_haszonedchild' data-ref="prop_changelist::cl_haszonedchild" data-ref-filename="prop_changelist..cl_haszonedchild">cl_haszonedchild</a>);</td></tr>
<tr><th id="355">355</th><td>}</td></tr>
<tr><th id="356">356</th><td></td></tr>
<tr><th id="357">357</th><td><i>/*</i></td></tr>
<tr><th id="358">358</th><td><i> * Remove a node from a gathered list.</i></td></tr>
<tr><th id="359">359</th><td><i> */</i></td></tr>
<tr><th id="360">360</th><td><em>void</em></td></tr>
<tr><th id="361">361</th><td><dfn class="decl def fn" id="changelist_remove" title='changelist_remove' data-ref="changelist_remove" data-ref-filename="changelist_remove">changelist_remove</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col6 decl" id="86clp" title='clp' data-type='prop_changelist_t *' data-ref="86clp" data-ref-filename="86clp">clp</dfn>, <em>const</em> <em>char</em> *<dfn class="local col7 decl" id="87name" title='name' data-type='const char *' data-ref="87name" data-ref-filename="87name">name</dfn>)</td></tr>
<tr><th id="362">362</th><td>{</td></tr>
<tr><th id="363">363</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col8 decl" id="88cn" title='cn' data-type='prop_changenode_t *' data-ref="88cn" data-ref-filename="88cn">cn</dfn>;</td></tr>
<tr><th id="364">364</th><td></td></tr>
<tr><th id="365">365</th><td>	<b>for</b> (<a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_first" title='uu_list_first' data-ref="uu_list_first" data-ref-filename="uu_list_first">uu_list_first</a>(<a class="local col6 ref" href="#86clp" title='clp' data-ref="86clp" data-ref-filename="86clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>); <a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="366">366</th><td>	    <a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_next" title='uu_list_next' data-ref="uu_list_next" data-ref-filename="uu_list_next">uu_list_next</a>(<a class="local col6 ref" href="#86clp" title='clp' data-ref="86clp" data-ref-filename="86clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a>)) {</td></tr>
<tr><th id="367">367</th><td></td></tr>
<tr><th id="368">368</th><td>		<b>if</b> (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_name" title='zfs_handle::zfs_name' data-ref="zfs_handle::zfs_name" data-ref-filename="zfs_handle..zfs_name">zfs_name</a>, <a class="local col7 ref" href="#87name" title='name' data-ref="87name" data-ref-filename="87name">name</a>) == <var>0</var>) {</td></tr>
<tr><th id="369">369</th><td>			<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_remove" title='uu_list_remove' data-ref="uu_list_remove" data-ref-filename="uu_list_remove">uu_list_remove</a>(<a class="local col6 ref" href="#86clp" title='clp' data-ref="86clp" data-ref-filename="86clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a>);</td></tr>
<tr><th id="370">370</th><td>			<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="371">371</th><td>			<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#free" title='free' data-ref="free" data-ref-filename="free">free</a>(<a class="local col8 ref" href="#88cn" title='cn' data-ref="88cn" data-ref-filename="88cn">cn</a>);</td></tr>
<tr><th id="372">372</th><td>			<b>return</b>;</td></tr>
<tr><th id="373">373</th><td>		}</td></tr>
<tr><th id="374">374</th><td>	}</td></tr>
<tr><th id="375">375</th><td>}</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td><i>/*</i></td></tr>
<tr><th id="378">378</th><td><i> * Release any memory associated with a changelist.</i></td></tr>
<tr><th id="379">379</th><td><i> */</i></td></tr>
<tr><th id="380">380</th><td><em>void</em></td></tr>
<tr><th id="381">381</th><td><dfn class="decl def fn" id="changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</dfn>(<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col9 decl" id="89clp" title='clp' data-type='prop_changelist_t *' data-ref="89clp" data-ref-filename="89clp">clp</dfn>)</td></tr>
<tr><th id="382">382</th><td>{</td></tr>
<tr><th id="383">383</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col0 decl" id="90cn" title='cn' data-type='prop_changenode_t *' data-ref="90cn" data-ref-filename="90cn">cn</dfn>;</td></tr>
<tr><th id="384">384</th><td>	<em>void</em> *<dfn class="local col1 decl" id="91cookie" title='cookie' data-type='void *' data-ref="91cookie" data-ref-filename="91cookie">cookie</dfn>;</td></tr>
<tr><th id="385">385</th><td></td></tr>
<tr><th id="386">386</th><td>	<b>if</b> (<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>) {</td></tr>
<tr><th id="387">387</th><td>		<a class="local col1 ref" href="#91cookie" title='cookie' data-ref="91cookie" data-ref-filename="91cookie">cookie</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="388">388</th><td>		<b>while</b> ((<a class="local col0 ref" href="#90cn" title='cn' data-ref="90cn" data-ref-filename="90cn">cn</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_teardown" title='uu_list_teardown' data-ref="uu_list_teardown" data-ref-filename="uu_list_teardown">uu_list_teardown</a>(<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, &amp;<a class="local col1 ref" href="#91cookie" title='cookie' data-ref="91cookie" data-ref-filename="91cookie">cookie</a>)) != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="389">389</th><td>			<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col0 ref" href="#90cn" title='cn' data-ref="90cn" data-ref-filename="90cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>);</td></tr>
<tr><th id="390">390</th><td>			<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#free" title='free' data-ref="free" data-ref-filename="free">free</a>(<a class="local col0 ref" href="#90cn" title='cn' data-ref="90cn" data-ref-filename="90cn">cn</a>);</td></tr>
<tr><th id="391">391</th><td>		}</td></tr>
<tr><th id="392">392</th><td></td></tr>
<tr><th id="393">393</th><td>		<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_destroy" title='uu_list_destroy' data-ref="uu_list_destroy" data-ref-filename="uu_list_destroy">uu_list_destroy</a>(<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>);</td></tr>
<tr><th id="394">394</th><td>	}</td></tr>
<tr><th id="395">395</th><td>	<b>if</b> (<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a>)</td></tr>
<tr><th id="396">396</th><td>		<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_pool_destroy" title='uu_list_pool_destroy' data-ref="uu_list_pool_destroy" data-ref-filename="uu_list_pool_destroy">uu_list_pool_destroy</a>(<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a>);</td></tr>
<tr><th id="397">397</th><td></td></tr>
<tr><th id="398">398</th><td>	<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#free" title='free' data-ref="free" data-ref-filename="free">free</a>(<a class="local col9 ref" href="#89clp" title='clp' data-ref="89clp" data-ref-filename="89clp">clp</a>);</td></tr>
<tr><th id="399">399</th><td>}</td></tr>
<tr><th id="400">400</th><td></td></tr>
<tr><th id="401">401</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="402">402</th><td><dfn class="tu decl def fn" id="change_one" title='change_one' data-type='int change_one(zfs_handle_t * zhp, void * data)' data-ref="change_one" data-ref-filename="change_one">change_one</dfn>(<a class="typedef" href="libzfs.h.html#zfs_handle_t" title='zfs_handle_t' data-type='struct zfs_handle' data-ref="zfs_handle_t" data-ref-filename="zfs_handle_t">zfs_handle_t</a> *<dfn class="local col2 decl" id="92zhp" title='zhp' data-type='zfs_handle_t *' data-ref="92zhp" data-ref-filename="92zhp">zhp</dfn>, <em>void</em> *<dfn class="local col3 decl" id="93data" title='data' data-type='void *' data-ref="93data" data-ref-filename="93data">data</dfn>)</td></tr>
<tr><th id="403">403</th><td>{</td></tr>
<tr><th id="404">404</th><td>	<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col4 decl" id="94clp" title='clp' data-type='prop_changelist_t *' data-ref="94clp" data-ref-filename="94clp">clp</dfn> = <a class="local col3 ref" href="#93data" title='data' data-ref="93data" data-ref-filename="93data">data</a>;</td></tr>
<tr><th id="405">405</th><td>	<em>char</em> <dfn class="local col5 decl" id="95property" title='property' data-type='char [1024]' data-ref="95property" data-ref-filename="95property">property</dfn>[<a class="macro" href="libzfs.h.html#54" title="1024" data-ref="_M/ZFS_MAXPROPLEN">ZFS_MAXPROPLEN</a>];</td></tr>
<tr><th id="406">406</th><td>	<em>char</em> <dfn class="local col6 decl" id="96where" title='where' data-type='char [64]' data-ref="96where" data-ref-filename="96where">where</dfn>[<var>64</var>];</td></tr>
<tr><th id="407">407</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col7 decl" id="97cn" title='cn' data-type='prop_changenode_t *' data-ref="97cn" data-ref-filename="97cn">cn</dfn>;</td></tr>
<tr><th id="408">408</th><td>	<a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zprop_source_t" title='zprop_source_t' data-type='enum zprop_source_t' data-ref="zprop_source_t" data-ref-filename="zprop_source_t">zprop_source_t</a> <dfn class="local col8 decl" id="98sourcetype" title='sourcetype' data-type='zprop_source_t' data-ref="98sourcetype" data-ref-filename="98sourcetype">sourcetype</dfn>;</td></tr>
<tr><th id="409">409</th><td>	<a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zprop_source_t" title='zprop_source_t' data-type='enum zprop_source_t' data-ref="zprop_source_t" data-ref-filename="zprop_source_t">zprop_source_t</a> <dfn class="local col9 decl" id="99share_sourcetype" title='share_sourcetype' data-type='zprop_source_t' data-ref="99share_sourcetype" data-ref-filename="99share_sourcetype">share_sourcetype</dfn>;</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td>	<i>/*</i></td></tr>
<tr><th id="412">412</th><td><i>	 * We only want to unmount/unshare those filesystems that may inherit</i></td></tr>
<tr><th id="413">413</th><td><i>	 * from the target filesystem.  If we find any filesystem with a</i></td></tr>
<tr><th id="414">414</th><td><i>	 * locally set mountpoint, we ignore any children since changing the</i></td></tr>
<tr><th id="415">415</th><td><i>	 * property will not affect them.  If this is a rename, we iterate</i></td></tr>
<tr><th id="416">416</th><td><i>	 * over all children regardless, since we need them unmounted in</i></td></tr>
<tr><th id="417">417</th><td><i>	 * order to do the rename.  Also, if this is a volume and we're doing</i></td></tr>
<tr><th id="418">418</th><td><i>	 * a rename, then always add it to the changelist.</i></td></tr>
<tr><th id="419">419</th><td><i>	 */</i></td></tr>
<tr><th id="420">420</th><td></td></tr>
<tr><th id="421">421</th><td>	<b>if</b> (!(<a class="macro" href="libzfs_impl.h.html#100" title="((zhp)-&gt;zfs_head_type == ZFS_TYPE_VOLUME)" data-ref="_M/ZFS_IS_VOLUME">ZFS_IS_VOLUME</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>) &amp;&amp; <a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_realprop" title='prop_changelist::cl_realprop' data-ref="prop_changelist::cl_realprop" data-ref-filename="prop_changelist..cl_realprop">cl_realprop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_NAME" title='ZFS_PROP_NAME' data-ref="ZFS_PROP_NAME" data-ref-filename="ZFS_PROP_NAME">ZFS_PROP_NAME</a>) &amp;&amp;</td></tr>
<tr><th id="422">422</th><td>	    <a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>, <a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a>, <a class="local col5 ref" href="#95property" title='property' data-ref="95property" data-ref-filename="95property">property</a>,</td></tr>
<tr><th id="423">423</th><td>	    <b>sizeof</b> (<a class="local col5 ref" href="#95property" title='property' data-ref="95property" data-ref-filename="95property">property</a>), &amp;<a class="local col8 ref" href="#98sourcetype" title='sourcetype' data-ref="98sourcetype" data-ref-filename="98sourcetype">sourcetype</a>, <a class="local col6 ref" href="#96where" title='where' data-ref="96where" data-ref-filename="96where">where</a>, <b>sizeof</b> (<a class="local col6 ref" href="#96where" title='where' data-ref="96where" data-ref-filename="96where">where</a>),</td></tr>
<tr><th id="424">424</th><td>	    <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) != <var>0</var>) {</td></tr>
<tr><th id="425">425</th><td>		<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>);</td></tr>
<tr><th id="426">426</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="427">427</th><td>	}</td></tr>
<tr><th id="428">428</th><td></td></tr>
<tr><th id="429">429</th><td>	<i>/*</i></td></tr>
<tr><th id="430">430</th><td><i>	 * If we are "watching" sharenfs or sharesmb</i></td></tr>
<tr><th id="431">431</th><td><i>	 * then check out the companion property which is tracked</i></td></tr>
<tr><th id="432">432</th><td><i>	 * in cl_shareprop</i></td></tr>
<tr><th id="433">433</th><td><i>	 */</i></td></tr>
<tr><th id="434">434</th><td>	<b>if</b> (<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</a> != <a class="macro" href="../../../uts/common/sys/fs/zfs.h.html#217" title="-1" data-ref="_M/ZPROP_INVAL">ZPROP_INVAL</a> &amp;&amp;</td></tr>
<tr><th id="435">435</th><td>	    <a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>, <a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</a>, <a class="local col5 ref" href="#95property" title='property' data-ref="95property" data-ref-filename="95property">property</a>,</td></tr>
<tr><th id="436">436</th><td>	    <b>sizeof</b> (<a class="local col5 ref" href="#95property" title='property' data-ref="95property" data-ref-filename="95property">property</a>), &amp;<a class="local col9 ref" href="#99share_sourcetype" title='share_sourcetype' data-ref="99share_sourcetype" data-ref-filename="99share_sourcetype">share_sourcetype</a>, <a class="local col6 ref" href="#96where" title='where' data-ref="96where" data-ref-filename="96where">where</a>, <b>sizeof</b> (<a class="local col6 ref" href="#96where" title='where' data-ref="96where" data-ref-filename="96where">where</a>),</td></tr>
<tr><th id="437">437</th><td>	    <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) != <var>0</var>) {</td></tr>
<tr><th id="438">438</th><td>		<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>);</td></tr>
<tr><th id="439">439</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="440">440</th><td>	}</td></tr>
<tr><th id="441">441</th><td></td></tr>
<tr><th id="442">442</th><td>	<b>if</b> (<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_alldependents" title='prop_changelist::cl_alldependents' data-ref="prop_changelist::cl_alldependents" data-ref-filename="prop_changelist..cl_alldependents">cl_alldependents</a> || <a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_allchildren" title='prop_changelist::cl_allchildren' data-ref="prop_changelist::cl_allchildren" data-ref-filename="prop_changelist..cl_allchildren">cl_allchildren</a> ||</td></tr>
<tr><th id="443">443</th><td>	    <a class="local col8 ref" href="#98sourcetype" title='sourcetype' data-ref="98sourcetype" data-ref-filename="98sourcetype">sourcetype</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZPROP_SRC_DEFAULT" title='ZPROP_SRC_DEFAULT' data-ref="ZPROP_SRC_DEFAULT" data-ref-filename="ZPROP_SRC_DEFAULT">ZPROP_SRC_DEFAULT</a> ||</td></tr>
<tr><th id="444">444</th><td>	    <a class="local col8 ref" href="#98sourcetype" title='sourcetype' data-ref="98sourcetype" data-ref-filename="98sourcetype">sourcetype</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZPROP_SRC_INHERITED" title='ZPROP_SRC_INHERITED' data-ref="ZPROP_SRC_INHERITED" data-ref-filename="ZPROP_SRC_INHERITED">ZPROP_SRC_INHERITED</a> ||</td></tr>
<tr><th id="445">445</th><td>	    (<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</a> != <a class="macro" href="../../../uts/common/sys/fs/zfs.h.html#217" title="-1" data-ref="_M/ZPROP_INVAL">ZPROP_INVAL</a> &amp;&amp;</td></tr>
<tr><th id="446">446</th><td>	    (<a class="local col9 ref" href="#99share_sourcetype" title='share_sourcetype' data-ref="99share_sourcetype" data-ref-filename="99share_sourcetype">share_sourcetype</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZPROP_SRC_DEFAULT" title='ZPROP_SRC_DEFAULT' data-ref="ZPROP_SRC_DEFAULT" data-ref-filename="ZPROP_SRC_DEFAULT">ZPROP_SRC_DEFAULT</a> ||</td></tr>
<tr><th id="447">447</th><td>	    <a class="local col9 ref" href="#99share_sourcetype" title='share_sourcetype' data-ref="99share_sourcetype" data-ref-filename="99share_sourcetype">share_sourcetype</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZPROP_SRC_INHERITED" title='ZPROP_SRC_INHERITED' data-ref="ZPROP_SRC_INHERITED" data-ref-filename="ZPROP_SRC_INHERITED">ZPROP_SRC_INHERITED</a>))) {</td></tr>
<tr><th id="448">448</th><td>		<b>if</b> ((<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a> = <a class="ref fn" href="libzfs_impl.h.html#zfs_alloc" title='zfs_alloc' data-ref="zfs_alloc" data-ref-filename="zfs_alloc">zfs_alloc</a>(<a class="ref fn" href="libzfs.h.html#zfs_get_handle" title='zfs_get_handle' data-ref="zfs_get_handle" data-ref-filename="zfs_get_handle">zfs_get_handle</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>),</td></tr>
<tr><th id="449">449</th><td>		    <b>sizeof</b> (<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a>))) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="450">450</th><td>			<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>);</td></tr>
<tr><th id="451">451</th><td>			<b>return</b> (-<var>1</var>);</td></tr>
<tr><th id="452">452</th><td>		}</td></tr>
<tr><th id="453">453</th><td></td></tr>
<tr><th id="454">454</th><td>		<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='w' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a> = <a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>;</td></tr>
<tr><th id="455">455</th><td>		<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_mounted" title='prop_changenode::cn_mounted' data-use='w' data-ref="prop_changenode::cn_mounted" data-ref-filename="prop_changenode..cn_mounted">cn_mounted</a> = (<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> &amp; <a class="macro" href="libzfs_impl.h.html#159" title="0x01" data-ref="_M/CL_GATHER_MOUNT_ALWAYS">CL_GATHER_MOUNT_ALWAYS</a>) ||</td></tr>
<tr><th id="456">456</th><td>		    <a class="ref fn" href="libzfs.h.html#zfs_is_mounted" title='zfs_is_mounted' data-ref="zfs_is_mounted" data-ref-filename="zfs_is_mounted">zfs_is_mounted</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="457">457</th><td>		<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_shared" title='prop_changenode::cn_shared' data-use='w' data-ref="prop_changenode::cn_shared" data-ref-filename="prop_changenode..cn_shared">cn_shared</a> = <a class="ref fn" href="libzfs.h.html#zfs_is_shared" title='zfs_is_shared' data-ref="zfs_is_shared" data-ref-filename="zfs_is_shared">zfs_is_shared</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>);</td></tr>
<tr><th id="458">458</th><td>		<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-use='w' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</a> = <a class="ref fn" href="libzfs.h.html#zfs_prop_get_int" title='zfs_prop_get_int' data-ref="zfs_prop_get_int" data-ref-filename="zfs_prop_get_int">zfs_prop_get_int</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_ZONED" title='ZFS_PROP_ZONED' data-ref="ZFS_PROP_ZONED" data-ref-filename="ZFS_PROP_ZONED">ZFS_PROP_ZONED</a>);</td></tr>
<tr><th id="459">459</th><td>		<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='w' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="460">460</th><td></td></tr>
<tr><th id="461">461</th><td>		<i>/* Indicate if any child is exported to a local zone. */</i></td></tr>
<tr><th id="462">462</th><td>		<b>if</b> (<a class="ref fn" href="../../../../sys/sys/zone.h.html#getzoneid" title='getzoneid' data-ref="getzoneid" data-ref-filename="getzoneid">getzoneid</a>() == <a class="macro" href="../../../../sys/sys/zone.h.html#64" title="0" data-ref="_M/GLOBAL_ZONEID">GLOBAL_ZONEID</a> &amp;&amp; <a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-use='r' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</a>)</td></tr>
<tr><th id="463">463</th><td>			<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_haszonedchild" title='prop_changelist::cl_haszonedchild' data-ref="prop_changelist::cl_haszonedchild" data-ref-filename="prop_changelist..cl_haszonedchild">cl_haszonedchild</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="464">464</th><td></td></tr>
<tr><th id="465">465</th><td>		<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_node_init" title='uu_list_node_init' data-ref="uu_list_node_init" data-ref-filename="uu_list_node_init">uu_list_node_init</a>(<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>, &amp;<a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_listnode" title='prop_changenode::cn_listnode' data-use='a' data-ref="prop_changenode::cn_listnode" data-ref-filename="prop_changenode..cn_listnode">cn_listnode</a>, <a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a>);</td></tr>
<tr><th id="466">466</th><td></td></tr>
<tr><th id="467">467</th><td>		<b>if</b> (<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_sorted" title='prop_changelist::cl_sorted' data-ref="prop_changelist::cl_sorted" data-ref-filename="prop_changelist..cl_sorted">cl_sorted</a>) {</td></tr>
<tr><th id="468">468</th><td>			<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_list_index_t" title='uu_list_index_t' data-type='uintptr_t' data-ref="uu_list_index_t" data-ref-filename="uu_list_index_t">uu_list_index_t</a> <dfn class="local col0 decl" id="100idx" title='idx' data-type='uu_list_index_t' data-ref="100idx" data-ref-filename="100idx">idx</dfn>;</td></tr>
<tr><th id="469">469</th><td></td></tr>
<tr><th id="470">470</th><td>			(<em>void</em>) <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_find" title='uu_list_find' data-ref="uu_list_find" data-ref-filename="uu_list_find">uu_list_find</a>(<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="471">471</th><td>			    &amp;<a class="local col0 ref" href="#100idx" title='idx' data-ref="100idx" data-ref-filename="100idx">idx</a>);</td></tr>
<tr><th id="472">472</th><td>			<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_insert" title='uu_list_insert' data-ref="uu_list_insert" data-ref-filename="uu_list_insert">uu_list_insert</a>(<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>, <a class="local col0 ref" href="#100idx" title='idx' data-ref="100idx" data-ref-filename="100idx">idx</a>);</td></tr>
<tr><th id="473">473</th><td>		} <b>else</b> {</td></tr>
<tr><th id="474">474</th><td>			<i>/*</i></td></tr>
<tr><th id="475">475</th><td><i>			 * Add this child to beginning of the list. Children</i></td></tr>
<tr><th id="476">476</th><td><i>			 * below this one in the hierarchy will get added above</i></td></tr>
<tr><th id="477">477</th><td><i>			 * this one in the list. This produces a list in</i></td></tr>
<tr><th id="478">478</th><td><i>			 * reverse dataset name order.</i></td></tr>
<tr><th id="479">479</th><td><i>			 * This is necessary when the original mountpoint</i></td></tr>
<tr><th id="480">480</th><td><i>			 * is legacy or none.</i></td></tr>
<tr><th id="481">481</th><td><i>			 */</i></td></tr>
<tr><th id="482">482</th><td>			<a class="macro" href="libzfs.h.html#754" title="((uu_list_insert_before(clp-&gt;cl_list, uu_list_first(clp-&gt;cl_list), cn) == 0) ? (void)0 : __assert13(&quot;/___NETBSD_SRC___/objdir.amd64/compat/amd64/i386/external/cddl/osnet/lib/libzfs/../../../../../../../../../external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c&quot;, 483, __func__, &quot;uu_list_insert_before(clp-&gt;cl_list, uu_list_first(clp-&gt;cl_list), cn) == 0&quot;))" data-ref="_M/verify">verify</a>(<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_insert_before" title='uu_list_insert_before' data-ref="uu_list_insert_before" data-ref-filename="uu_list_insert_before">uu_list_insert_before</a>(<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>,</td></tr>
<tr><th id="483">483</th><td>			    <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_first" title='uu_list_first' data-ref="uu_list_first" data-ref-filename="uu_list_first">uu_list_first</a>(<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>), <a class="local col7 ref" href="#97cn" title='cn' data-ref="97cn" data-ref-filename="97cn">cn</a>) == <var>0</var>);</td></tr>
<tr><th id="484">484</th><td>		}</td></tr>
<tr><th id="485">485</th><td></td></tr>
<tr><th id="486">486</th><td>		<b>if</b> (!<a class="local col4 ref" href="#94clp" title='clp' data-ref="94clp" data-ref-filename="94clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_alldependents" title='prop_changelist::cl_alldependents' data-ref="prop_changelist::cl_alldependents" data-ref-filename="prop_changelist..cl_alldependents">cl_alldependents</a>)</td></tr>
<tr><th id="487">487</th><td>			<b>return</b> (<a class="ref fn" href="libzfs.h.html#zfs_iter_children" title='zfs_iter_children' data-ref="zfs_iter_children" data-ref-filename="zfs_iter_children">zfs_iter_children</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>, <a class="tu ref fn" href="#change_one" title='change_one' data-use='r' data-ref="change_one" data-ref-filename="change_one">change_one</a>, <a class="local col3 ref" href="#93data" title='data' data-ref="93data" data-ref-filename="93data">data</a>));</td></tr>
<tr><th id="488">488</th><td>	} <b>else</b> {</td></tr>
<tr><th id="489">489</th><td>		<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col2 ref" href="#92zhp" title='zhp' data-ref="92zhp" data-ref-filename="92zhp">zhp</a>);</td></tr>
<tr><th id="490">490</th><td>	}</td></tr>
<tr><th id="491">491</th><td></td></tr>
<tr><th id="492">492</th><td>	<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="493">493</th><td>}</td></tr>
<tr><th id="494">494</th><td></td></tr>
<tr><th id="495">495</th><td><i  data-doc="compare_mountpoints">/*ARGSUSED*/</i></td></tr>
<tr><th id="496">496</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="497">497</th><td><dfn class="tu decl def fn" id="compare_mountpoints" title='compare_mountpoints' data-type='int compare_mountpoints(const void * a, const void * b, void * unused)' data-ref="compare_mountpoints" data-ref-filename="compare_mountpoints">compare_mountpoints</dfn>(<em>const</em> <em>void</em> *<dfn class="local col1 decl" id="101a" title='a' data-type='const void *' data-ref="101a" data-ref-filename="101a">a</dfn>, <em>const</em> <em>void</em> *<dfn class="local col2 decl" id="102b" title='b' data-type='const void *' data-ref="102b" data-ref-filename="102b">b</dfn>, <em>void</em> *<dfn class="local col3 decl" id="103unused" title='unused' data-type='void *' data-ref="103unused" data-ref-filename="103unused">unused</dfn>)</td></tr>
<tr><th id="498">498</th><td>{</td></tr>
<tr><th id="499">499</th><td>	<em>const</em> <a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col4 decl" id="104ca" title='ca' data-type='const prop_changenode_t *' data-ref="104ca" data-ref-filename="104ca">ca</dfn> = <a class="local col1 ref" href="#101a" title='a' data-ref="101a" data-ref-filename="101a">a</a>;</td></tr>
<tr><th id="500">500</th><td>	<em>const</em> <a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col5 decl" id="105cb" title='cb' data-type='const prop_changenode_t *' data-ref="105cb" data-ref-filename="105cb">cb</dfn> = <a class="local col2 ref" href="#102b" title='b' data-ref="102b" data-ref-filename="102b">b</a>;</td></tr>
<tr><th id="501">501</th><td></td></tr>
<tr><th id="502">502</th><td>	<em>char</em> <dfn class="local col6 decl" id="106mounta" title='mounta' data-type='char [1024]' data-ref="106mounta" data-ref-filename="106mounta">mounta</dfn>[<a class="macro" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/sys/param.h.html#368" title="1024" data-ref="_M/MAXPATHLEN">MAXPATHLEN</a>];</td></tr>
<tr><th id="503">503</th><td>	<em>char</em> <dfn class="local col7 decl" id="107mountb" title='mountb' data-type='char [1024]' data-ref="107mountb" data-ref-filename="107mountb">mountb</dfn>[<a class="macro" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/sys/param.h.html#368" title="1024" data-ref="_M/MAXPATHLEN">MAXPATHLEN</a>];</td></tr>
<tr><th id="504">504</th><td></td></tr>
<tr><th id="505">505</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a> <dfn class="local col8 decl" id="108hasmounta" title='hasmounta' data-type='boolean_t' data-ref="108hasmounta" data-ref-filename="108hasmounta">hasmounta</dfn>, <dfn class="local col9 decl" id="109hasmountb" title='hasmountb' data-type='boolean_t' data-ref="109hasmountb" data-ref-filename="109hasmountb">hasmountb</dfn>;</td></tr>
<tr><th id="506">506</th><td></td></tr>
<tr><th id="507">507</th><td>	<i>/*</i></td></tr>
<tr><th id="508">508</th><td><i>	 * When unsharing or unmounting filesystems, we need to do it in</i></td></tr>
<tr><th id="509">509</th><td><i>	 * mountpoint order.  This allows the user to have a mountpoint</i></td></tr>
<tr><th id="510">510</th><td><i>	 * hierarchy that is different from the dataset hierarchy, and still</i></td></tr>
<tr><th id="511">511</th><td><i>	 * allow it to be changed.  However, if either dataset doesn't have a</i></td></tr>
<tr><th id="512">512</th><td><i>	 * mountpoint (because it is a volume or a snapshot), we place it at the</i></td></tr>
<tr><th id="513">513</th><td><i>	 * end of the list, because it doesn't affect our change at all.</i></td></tr>
<tr><th id="514">514</th><td><i>	 */</i></td></tr>
<tr><th id="515">515</th><td>	<a class="local col8 ref" href="#108hasmounta" title='hasmounta' data-ref="108hasmounta" data-ref-filename="108hasmounta">hasmounta</a> = (<a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col4 ref" href="#104ca" title='ca' data-ref="104ca" data-ref-filename="104ca">ca</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>, <a class="local col6 ref" href="#106mounta" title='mounta' data-ref="106mounta" data-ref-filename="106mounta">mounta</a>,</td></tr>
<tr><th id="516">516</th><td>	    <b>sizeof</b> (<a class="local col6 ref" href="#106mounta" title='mounta' data-ref="106mounta" data-ref-filename="106mounta">mounta</a>), <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>, <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) == <var>0</var>);</td></tr>
<tr><th id="517">517</th><td>	<a class="local col9 ref" href="#109hasmountb" title='hasmountb' data-ref="109hasmountb" data-ref-filename="109hasmountb">hasmountb</a> = (<a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col5 ref" href="#105cb" title='cb' data-ref="105cb" data-ref-filename="105cb">cb</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='r' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>, <a class="local col7 ref" href="#107mountb" title='mountb' data-ref="107mountb" data-ref-filename="107mountb">mountb</a>,</td></tr>
<tr><th id="518">518</th><td>	    <b>sizeof</b> (<a class="local col7 ref" href="#107mountb" title='mountb' data-ref="107mountb" data-ref-filename="107mountb">mountb</a>), <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>, <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) == <var>0</var>);</td></tr>
<tr><th id="519">519</th><td></td></tr>
<tr><th id="520">520</th><td>	<b>if</b> (!<a class="local col8 ref" href="#108hasmounta" title='hasmounta' data-ref="108hasmounta" data-ref-filename="108hasmounta">hasmounta</a> &amp;&amp; <a class="local col9 ref" href="#109hasmountb" title='hasmountb' data-ref="109hasmountb" data-ref-filename="109hasmountb">hasmountb</a>)</td></tr>
<tr><th id="521">521</th><td>		<b>return</b> (-<var>1</var>);</td></tr>
<tr><th id="522">522</th><td>	<b>else</b> <b>if</b> (<a class="local col8 ref" href="#108hasmounta" title='hasmounta' data-ref="108hasmounta" data-ref-filename="108hasmounta">hasmounta</a> &amp;&amp; !<a class="local col9 ref" href="#109hasmountb" title='hasmountb' data-ref="109hasmountb" data-ref-filename="109hasmountb">hasmountb</a>)</td></tr>
<tr><th id="523">523</th><td>		<b>return</b> (<var>1</var>);</td></tr>
<tr><th id="524">524</th><td>	<b>else</b> <b>if</b> (!<a class="local col8 ref" href="#108hasmounta" title='hasmounta' data-ref="108hasmounta" data-ref-filename="108hasmounta">hasmounta</a> &amp;&amp; !<a class="local col9 ref" href="#109hasmountb" title='hasmountb' data-ref="109hasmountb" data-ref-filename="109hasmountb">hasmountb</a>)</td></tr>
<tr><th id="525">525</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="526">526</th><td>	<b>else</b></td></tr>
<tr><th id="527">527</th><td>		<b>return</b> (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col7 ref" href="#107mountb" title='mountb' data-ref="107mountb" data-ref-filename="107mountb">mountb</a>, <a class="local col6 ref" href="#106mounta" title='mounta' data-ref="106mounta" data-ref-filename="106mounta">mounta</a>));</td></tr>
<tr><th id="528">528</th><td>}</td></tr>
<tr><th id="529">529</th><td></td></tr>
<tr><th id="530">530</th><td><i>/*</i></td></tr>
<tr><th id="531">531</th><td><i> * Given a ZFS handle and a property, construct a complete list of datasets</i></td></tr>
<tr><th id="532">532</th><td><i> * that need to be modified as part of this process.  For anything but the</i></td></tr>
<tr><th id="533">533</th><td><i> * 'mountpoint' and 'sharenfs' properties, this just returns an empty list.</i></td></tr>
<tr><th id="534">534</th><td><i> * Otherwise, we iterate over all children and look for any datasets that</i></td></tr>
<tr><th id="535">535</th><td><i> * inherit the property.  For each such dataset, we add it to the list and</i></td></tr>
<tr><th id="536">536</th><td><i> * mark whether it was shared beforehand.</i></td></tr>
<tr><th id="537">537</th><td><i> */</i></td></tr>
<tr><th id="538">538</th><td><a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *</td></tr>
<tr><th id="539">539</th><td><dfn class="decl def fn" id="changelist_gather" title='changelist_gather' data-ref="changelist_gather" data-ref-filename="changelist_gather">changelist_gather</dfn>(<a class="typedef" href="libzfs.h.html#zfs_handle_t" title='zfs_handle_t' data-type='struct zfs_handle' data-ref="zfs_handle_t" data-ref-filename="zfs_handle_t">zfs_handle_t</a> *<dfn class="local col0 decl" id="110zhp" title='zhp' data-type='zfs_handle_t *' data-ref="110zhp" data-ref-filename="110zhp">zhp</dfn>, <a class="typedef" href="../../../uts/common/sys/fs/zfs.h.html#zfs_prop_t" title='zfs_prop_t' data-type='enum zfs_prop_t' data-ref="zfs_prop_t" data-ref-filename="zfs_prop_t">zfs_prop_t</a> <dfn class="local col1 decl" id="111prop" title='prop' data-type='zfs_prop_t' data-ref="111prop" data-ref-filename="111prop">prop</dfn>, <em>int</em> <dfn class="local col2 decl" id="112gather_flags" title='gather_flags' data-type='int' data-ref="112gather_flags" data-ref-filename="112gather_flags">gather_flags</dfn>,</td></tr>
<tr><th id="540">540</th><td>    <em>int</em> <dfn class="local col3 decl" id="113mnt_flags" title='mnt_flags' data-type='int' data-ref="113mnt_flags" data-ref-filename="113mnt_flags">mnt_flags</dfn>)</td></tr>
<tr><th id="541">541</th><td>{</td></tr>
<tr><th id="542">542</th><td>	<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a> *<dfn class="local col4 decl" id="114clp" title='clp' data-type='prop_changelist_t *' data-ref="114clp" data-ref-filename="114clp">clp</dfn>;</td></tr>
<tr><th id="543">543</th><td>	<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a> *<dfn class="local col5 decl" id="115cn" title='cn' data-type='prop_changenode_t *' data-ref="115cn" data-ref-filename="115cn">cn</dfn>;</td></tr>
<tr><th id="544">544</th><td>	<a class="typedef" href="libzfs.h.html#zfs_handle_t" title='zfs_handle_t' data-type='struct zfs_handle' data-ref="zfs_handle_t" data-ref-filename="zfs_handle_t">zfs_handle_t</a> *<dfn class="local col6 decl" id="116temp" title='temp' data-type='zfs_handle_t *' data-ref="116temp" data-ref-filename="116temp">temp</dfn>;</td></tr>
<tr><th id="545">545</th><td>	<em>char</em> <dfn class="local col7 decl" id="117property" title='property' data-type='char [1024]' data-ref="117property" data-ref-filename="117property">property</dfn>[<a class="macro" href="libzfs.h.html#54" title="1024" data-ref="_M/ZFS_MAXPROPLEN">ZFS_MAXPROPLEN</a>];</td></tr>
<tr><th id="546">546</th><td>	<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_compare_fn_t" title='uu_compare_fn_t' data-type='int (const void *, const void *, void *)' data-ref="uu_compare_fn_t" data-ref-filename="uu_compare_fn_t">uu_compare_fn_t</a> *<dfn class="local col8 decl" id="118compare" title='compare' data-type='uu_compare_fn_t *' data-ref="118compare" data-ref-filename="118compare">compare</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="547">547</th><td>	<a class="typedef" href="../../../../sys/sys/opentypes.h.html#boolean_t" title='boolean_t' data-type='int' data-ref="boolean_t" data-ref-filename="boolean_t">boolean_t</a> <dfn class="local col9 decl" id="119legacy" title='legacy' data-type='boolean_t' data-ref="119legacy" data-ref-filename="119legacy">legacy</dfn> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>;</td></tr>
<tr><th id="548">548</th><td></td></tr>
<tr><th id="549">549</th><td>	<b>if</b> ((<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a> = <a class="ref fn" href="libzfs_impl.h.html#zfs_alloc" title='zfs_alloc' data-ref="zfs_alloc" data-ref-filename="zfs_alloc">zfs_alloc</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>, <b>sizeof</b> (<a class="typedef" href="libzfs_impl.h.html#prop_changelist_t" title='prop_changelist_t' data-type='struct prop_changelist' data-ref="prop_changelist_t" data-ref-filename="prop_changelist_t">prop_changelist_t</a>))) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="550">550</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="551">551</th><td></td></tr>
<tr><th id="552">552</th><td>	<i>/*</i></td></tr>
<tr><th id="553">553</th><td><i>	 * For mountpoint-related tasks, we want to sort everything by</i></td></tr>
<tr><th id="554">554</th><td><i>	 * mountpoint, so that we mount and unmount them in the appropriate</i></td></tr>
<tr><th id="555">555</th><td><i>	 * order, regardless of their position in the hierarchy.</i></td></tr>
<tr><th id="556">556</th><td><i>	 */</i></td></tr>
<tr><th id="557">557</th><td>	<b>if</b> (<a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_NAME" title='ZFS_PROP_NAME' data-ref="ZFS_PROP_NAME" data-ref-filename="ZFS_PROP_NAME">ZFS_PROP_NAME</a> || <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_ZONED" title='ZFS_PROP_ZONED' data-ref="ZFS_PROP_ZONED" data-ref-filename="ZFS_PROP_ZONED">ZFS_PROP_ZONED</a> ||</td></tr>
<tr><th id="558">558</th><td>	    <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a> || <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a> ||</td></tr>
<tr><th id="559">559</th><td>	    <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>) {</td></tr>
<tr><th id="560">560</th><td></td></tr>
<tr><th id="561">561</th><td>		<b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_prop_get" title='zfs_prop_get' data-ref="zfs_prop_get" data-ref-filename="zfs_prop_get">zfs_prop_get</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>,</td></tr>
<tr><th id="562">562</th><td>		    <a class="local col7 ref" href="#117property" title='property' data-ref="117property" data-ref-filename="117property">property</a>, <b>sizeof</b> (<a class="local col7 ref" href="#117property" title='property' data-ref="117property" data-ref-filename="117property">property</a>),</td></tr>
<tr><th id="563">563</th><td>		    <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <var>0</var>, <a class="macro" href="../../../../sys/sys/opentypes.h.html#35" title="0" data-ref="_M/B_FALSE">B_FALSE</a>) == <var>0</var> &amp;&amp;</td></tr>
<tr><th id="564">564</th><td>		    (<a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col7 ref" href="#117property" title='property' data-ref="117property" data-ref-filename="117property">property</a>, <q>"legacy"</q>) == <var>0</var> ||</td></tr>
<tr><th id="565">565</th><td>		    <a class="ref fn" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col7 ref" href="#117property" title='property' data-ref="117property" data-ref-filename="117property">property</a>, <q>"none"</q>) == <var>0</var>)) {</td></tr>
<tr><th id="566">566</th><td></td></tr>
<tr><th id="567">567</th><td>			<a class="local col9 ref" href="#119legacy" title='legacy' data-ref="119legacy" data-ref-filename="119legacy">legacy</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="568">568</th><td>		}</td></tr>
<tr><th id="569">569</th><td>		<b>if</b> (!<a class="local col9 ref" href="#119legacy" title='legacy' data-ref="119legacy" data-ref-filename="119legacy">legacy</a>) {</td></tr>
<tr><th id="570">570</th><td>			<a class="local col8 ref" href="#118compare" title='compare' data-ref="118compare" data-ref-filename="118compare">compare</a> = <a class="tu ref fn" href="#compare_mountpoints" title='compare_mountpoints' data-use='r' data-ref="compare_mountpoints" data-ref-filename="compare_mountpoints">compare_mountpoints</a>;</td></tr>
<tr><th id="571">571</th><td>			<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_sorted" title='prop_changelist::cl_sorted' data-ref="prop_changelist::cl_sorted" data-ref-filename="prop_changelist..cl_sorted">cl_sorted</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="572">572</th><td>		}</td></tr>
<tr><th id="573">573</th><td>	}</td></tr>
<tr><th id="574">574</th><td></td></tr>
<tr><th id="575">575</th><td>	<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_pool_create" title='uu_list_pool_create' data-ref="uu_list_pool_create" data-ref-filename="uu_list_pool_create">uu_list_pool_create</a>(<q>"changelist_pool"</q>,</td></tr>
<tr><th id="576">576</th><td>	    <b>sizeof</b> (<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a>),</td></tr>
<tr><th id="577">577</th><td>	    <span class="macro" title="__builtin_offsetof(prop_changenode_t, cn_listnode)" data-ref="_M/offsetof">offsetof</span>(<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a>, cn_listnode),</td></tr>
<tr><th id="578">578</th><td>	    <a class="local col8 ref" href="#118compare" title='compare' data-ref="118compare" data-ref-filename="118compare">compare</a>, <var>0</var>);</td></tr>
<tr><th id="579">579</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="580">580</th><td>		<a class="macro" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/assert.h.html#58" title="((uu_error() == 3) ? (void)0 : __assert13(&quot;/___NETBSD_SRC___/objdir.amd64/compat/amd64/i386/external/cddl/osnet/lib/libzfs/../../../../../../../../../external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c&quot;, 580, __func__, &quot;uu_error() == UU_ERROR_NO_MEMORY&quot;))" data-ref="_M/assert">assert</a>(<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_error" title='uu_error' data-ref="uu_error" data-ref-filename="uu_error">uu_error</a>() == <a class="macro" href="../../libuutil/common/libuutil.h.html#48" title="3" data-ref="_M/UU_ERROR_NO_MEMORY">UU_ERROR_NO_MEMORY</a>);</td></tr>
<tr><th id="581">581</th><td>		(<em>void</em>) <a class="ref fn" href="libzfs_impl.h.html#zfs_error" title='zfs_error' data-ref="zfs_error" data-ref-filename="zfs_error">zfs_error</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>, <a class="enum" href="libzfs.h.html#EZFS_NOMEM" title='EZFS_NOMEM' data-ref="EZFS_NOMEM" data-ref-filename="EZFS_NOMEM">EZFS_NOMEM</a>, <q>"internal error"</q>);</td></tr>
<tr><th id="582">582</th><td>		<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="583">583</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="584">584</th><td>	}</td></tr>
<tr><th id="585">585</th><td></td></tr>
<tr><th id="586">586</th><td>	<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a> = <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_create" title='uu_list_create' data-ref="uu_list_create" data-ref-filename="uu_list_create">uu_list_create</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="587">587</th><td>	    <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_sorted" title='prop_changelist::cl_sorted' data-ref="prop_changelist::cl_sorted" data-ref-filename="prop_changelist..cl_sorted">cl_sorted</a> ? <a class="macro" href="../../libuutil/common/libuutil.h.html#257" title="0x00000002" data-ref="_M/UU_LIST_SORTED">UU_LIST_SORTED</a> : <var>0</var>);</td></tr>
<tr><th id="588">588</th><td>	<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> = <a class="local col2 ref" href="#112gather_flags" title='gather_flags' data-ref="112gather_flags" data-ref-filename="112gather_flags">gather_flags</a>;</td></tr>
<tr><th id="589">589</th><td>	<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_mflags" title='prop_changelist::cl_mflags' data-ref="prop_changelist::cl_mflags" data-ref-filename="prop_changelist..cl_mflags">cl_mflags</a> = <a class="local col3 ref" href="#113mnt_flags" title='mnt_flags' data-ref="113mnt_flags" data-ref-filename="113mnt_flags">mnt_flags</a>;</td></tr>
<tr><th id="590">590</th><td></td></tr>
<tr><th id="591">591</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="592">592</th><td>		<a class="macro" href="../../../../../../../objdir.amd64/destdir.amd64/usr/include/assert.h.html#58" title="((uu_error() == 3) ? (void)0 : __assert13(&quot;/___NETBSD_SRC___/objdir.amd64/compat/amd64/i386/external/cddl/osnet/lib/libzfs/../../../../../../../../../external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c&quot;, 592, __func__, &quot;uu_error() == UU_ERROR_NO_MEMORY&quot;))" data-ref="_M/assert">assert</a>(<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_error" title='uu_error' data-ref="uu_error" data-ref-filename="uu_error">uu_error</a>() == <a class="macro" href="../../libuutil/common/libuutil.h.html#48" title="3" data-ref="_M/UU_ERROR_NO_MEMORY">UU_ERROR_NO_MEMORY</a>);</td></tr>
<tr><th id="593">593</th><td>		(<em>void</em>) <a class="ref fn" href="libzfs_impl.h.html#zfs_error" title='zfs_error' data-ref="zfs_error" data-ref-filename="zfs_error">zfs_error</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>, <a class="enum" href="libzfs.h.html#EZFS_NOMEM" title='EZFS_NOMEM' data-ref="EZFS_NOMEM" data-ref-filename="EZFS_NOMEM">EZFS_NOMEM</a>, <q>"internal error"</q>);</td></tr>
<tr><th id="594">594</th><td>		<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="595">595</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="596">596</th><td>	}</td></tr>
<tr><th id="597">597</th><td></td></tr>
<tr><th id="598">598</th><td>	<i>/*</i></td></tr>
<tr><th id="599">599</th><td><i>	 * If this is a rename or the 'zoned' property, we pretend we're</i></td></tr>
<tr><th id="600">600</th><td><i>	 * changing the mountpoint and flag it so we can catch all children in</i></td></tr>
<tr><th id="601">601</th><td><i>	 * change_one().</i></td></tr>
<tr><th id="602">602</th><td><i>	 *</i></td></tr>
<tr><th id="603">603</th><td><i>	 * Flag cl_alldependents to catch all children plus the dependents</i></td></tr>
<tr><th id="604">604</th><td><i>	 * (clones) that are not in the hierarchy.</i></td></tr>
<tr><th id="605">605</th><td><i>	 */</i></td></tr>
<tr><th id="606">606</th><td>	<b>if</b> (<a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_NAME" title='ZFS_PROP_NAME' data-ref="ZFS_PROP_NAME" data-ref-filename="ZFS_PROP_NAME">ZFS_PROP_NAME</a>) {</td></tr>
<tr><th id="607">607</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>;</td></tr>
<tr><th id="608">608</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_alldependents" title='prop_changelist::cl_alldependents' data-ref="prop_changelist::cl_alldependents" data-ref-filename="prop_changelist..cl_alldependents">cl_alldependents</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="609">609</th><td>	} <b>else</b> <b>if</b> (<a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_ZONED" title='ZFS_PROP_ZONED' data-ref="ZFS_PROP_ZONED" data-ref-filename="ZFS_PROP_ZONED">ZFS_PROP_ZONED</a>) {</td></tr>
<tr><th id="610">610</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>;</td></tr>
<tr><th id="611">611</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_allchildren" title='prop_changelist::cl_allchildren' data-ref="prop_changelist::cl_allchildren" data-ref-filename="prop_changelist..cl_allchildren">cl_allchildren</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="612">612</th><td>	} <b>else</b> <b>if</b> (<a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_CANMOUNT" title='ZFS_PROP_CANMOUNT' data-ref="ZFS_PROP_CANMOUNT" data-ref-filename="ZFS_PROP_CANMOUNT">ZFS_PROP_CANMOUNT</a>) {</td></tr>
<tr><th id="613">613</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>;</td></tr>
<tr><th id="614">614</th><td>	} <b>else</b> <b>if</b> (<a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_VOLSIZE" title='ZFS_PROP_VOLSIZE' data-ref="ZFS_PROP_VOLSIZE" data-ref-filename="ZFS_PROP_VOLSIZE">ZFS_PROP_VOLSIZE</a>) {</td></tr>
<tr><th id="615">615</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>;</td></tr>
<tr><th id="616">616</th><td>	} <b>else</b> {</td></tr>
<tr><th id="617">617</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> = <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a>;</td></tr>
<tr><th id="618">618</th><td>	}</td></tr>
<tr><th id="619">619</th><td>	<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_realprop" title='prop_changelist::cl_realprop' data-ref="prop_changelist::cl_realprop" data-ref-filename="prop_changelist..cl_realprop">cl_realprop</a> = <a class="local col1 ref" href="#111prop" title='prop' data-ref="111prop" data-ref-filename="111prop">prop</a>;</td></tr>
<tr><th id="620">620</th><td></td></tr>
<tr><th id="621">621</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a> &amp;&amp;</td></tr>
<tr><th id="622">622</th><td>	    <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a> &amp;&amp;</td></tr>
<tr><th id="623">623</th><td>	    <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> != <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>)</td></tr>
<tr><th id="624">624</th><td>		<b>return</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="625">625</th><td></td></tr>
<tr><th id="626">626</th><td>	<i>/*</i></td></tr>
<tr><th id="627">627</th><td><i>	 * If watching SHARENFS or SHARESMB then</i></td></tr>
<tr><th id="628">628</th><td><i>	 * also watch its companion property.</i></td></tr>
<tr><th id="629">629</th><td><i>	 */</i></td></tr>
<tr><th id="630">630</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a>)</td></tr>
<tr><th id="631">631</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>;</td></tr>
<tr><th id="632">632</th><td>	<b>else</b> <b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARESMB" title='ZFS_PROP_SHARESMB' data-ref="ZFS_PROP_SHARESMB" data-ref-filename="ZFS_PROP_SHARESMB">ZFS_PROP_SHARESMB</a>)</td></tr>
<tr><th id="633">633</th><td>		<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_shareprop" title='prop_changelist::cl_shareprop' data-ref="prop_changelist::cl_shareprop" data-ref-filename="prop_changelist..cl_shareprop">cl_shareprop</a> = <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_SHARENFS" title='ZFS_PROP_SHARENFS' data-ref="ZFS_PROP_SHARENFS" data-ref-filename="ZFS_PROP_SHARENFS">ZFS_PROP_SHARENFS</a>;</td></tr>
<tr><th id="634">634</th><td></td></tr>
<tr><th id="635">635</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_alldependents" title='prop_changelist::cl_alldependents' data-ref="prop_changelist::cl_alldependents" data-ref-filename="prop_changelist..cl_alldependents">cl_alldependents</a>) {</td></tr>
<tr><th id="636">636</th><td>		<b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_iter_dependents" title='zfs_iter_dependents' data-ref="zfs_iter_dependents" data-ref-filename="zfs_iter_dependents">zfs_iter_dependents</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>, <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>, <a class="tu ref fn" href="#change_one" title='change_one' data-use='r' data-ref="change_one" data-ref-filename="change_one">change_one</a>, <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>) != <var>0</var>) {</td></tr>
<tr><th id="637">637</th><td>			<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="638">638</th><td>			<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="639">639</th><td>		}</td></tr>
<tr><th id="640">640</th><td>	} <b>else</b> <b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_iter_children" title='zfs_iter_children' data-ref="zfs_iter_children" data-ref-filename="zfs_iter_children">zfs_iter_children</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>, <a class="tu ref fn" href="#change_one" title='change_one' data-use='r' data-ref="change_one" data-ref-filename="change_one">change_one</a>, <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>) != <var>0</var>) {</td></tr>
<tr><th id="641">641</th><td>		<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="642">642</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="643">643</th><td>	}</td></tr>
<tr><th id="644">644</th><td></td></tr>
<tr><th id="645">645</th><td>	<i>/*</i></td></tr>
<tr><th id="646">646</th><td><i>	 * We have to re-open ourselves because we auto-close all the handles</i></td></tr>
<tr><th id="647">647</th><td><i>	 * and can't tell the difference.</i></td></tr>
<tr><th id="648">648</th><td><i>	 */</i></td></tr>
<tr><th id="649">649</th><td>	<b>if</b> ((<a class="local col6 ref" href="#116temp" title='temp' data-ref="116temp" data-ref-filename="116temp">temp</a> = <a class="ref fn" href="libzfs.h.html#zfs_open" title='zfs_open' data-ref="zfs_open" data-ref-filename="zfs_open">zfs_open</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>, <a class="ref fn" href="libzfs.h.html#zfs_get_name" title='zfs_get_name' data-ref="zfs_get_name" data-ref-filename="zfs_get_name">zfs_get_name</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>),</td></tr>
<tr><th id="650">650</th><td>	    <a class="macro" href="../../../uts/common/sys/fs/zfs.h.html#74" title="(ZFS_TYPE_FILESYSTEM | ZFS_TYPE_VOLUME | ZFS_TYPE_SNAPSHOT)" data-ref="_M/ZFS_TYPE_DATASET">ZFS_TYPE_DATASET</a>)) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="651">651</th><td>		<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="652">652</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="653">653</th><td>	}</td></tr>
<tr><th id="654">654</th><td></td></tr>
<tr><th id="655">655</th><td>	<i>/*</i></td></tr>
<tr><th id="656">656</th><td><i>	 * Always add ourself to the list.  We add ourselves to the end so that</i></td></tr>
<tr><th id="657">657</th><td><i>	 * we're the last to be unmounted.</i></td></tr>
<tr><th id="658">658</th><td><i>	 */</i></td></tr>
<tr><th id="659">659</th><td>	<b>if</b> ((<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a> = <a class="ref fn" href="libzfs_impl.h.html#zfs_alloc" title='zfs_alloc' data-ref="zfs_alloc" data-ref-filename="zfs_alloc">zfs_alloc</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>-&gt;<a class="ref field" href="libzfs_impl.h.html#zfs_handle::zfs_hdl" title='zfs_handle::zfs_hdl' data-ref="zfs_handle::zfs_hdl" data-ref-filename="zfs_handle..zfs_hdl">zfs_hdl</a>,</td></tr>
<tr><th id="660">660</th><td>	    <b>sizeof</b> (<a class="typedef" href="#prop_changenode_t" title='prop_changenode_t' data-type='struct prop_changenode' data-ref="prop_changenode_t" data-ref-filename="prop_changenode_t">prop_changenode_t</a>))) == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="661">661</th><td>		<a class="ref fn" href="libzfs.h.html#zfs_close" title='zfs_close' data-ref="zfs_close" data-ref-filename="zfs_close">zfs_close</a>(<a class="local col6 ref" href="#116temp" title='temp' data-ref="116temp" data-ref-filename="116temp">temp</a>);</td></tr>
<tr><th id="662">662</th><td>		<a class="ref fn" href="#changelist_free" title='changelist_free' data-ref="changelist_free" data-ref-filename="changelist_free">changelist_free</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="663">663</th><td>		<b>return</b> (<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="664">664</th><td>	}</td></tr>
<tr><th id="665">665</th><td></td></tr>
<tr><th id="666">666</th><td>	<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_handle" title='prop_changenode::cn_handle' data-use='w' data-ref="prop_changenode::cn_handle" data-ref-filename="prop_changenode..cn_handle">cn_handle</a> = <a class="local col6 ref" href="#116temp" title='temp' data-ref="116temp" data-ref-filename="116temp">temp</a>;</td></tr>
<tr><th id="667">667</th><td>	<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_mounted" title='prop_changenode::cn_mounted' data-use='w' data-ref="prop_changenode::cn_mounted" data-ref-filename="prop_changenode..cn_mounted">cn_mounted</a> = (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_gflags" title='prop_changelist::cl_gflags' data-ref="prop_changelist::cl_gflags" data-ref-filename="prop_changelist..cl_gflags">cl_gflags</a> &amp; <a class="macro" href="libzfs_impl.h.html#159" title="0x01" data-ref="_M/CL_GATHER_MOUNT_ALWAYS">CL_GATHER_MOUNT_ALWAYS</a>) ||</td></tr>
<tr><th id="668">668</th><td>	    <a class="ref fn" href="libzfs.h.html#zfs_is_mounted" title='zfs_is_mounted' data-ref="zfs_is_mounted" data-ref-filename="zfs_is_mounted">zfs_is_mounted</a>(<a class="local col6 ref" href="#116temp" title='temp' data-ref="116temp" data-ref-filename="116temp">temp</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="669">669</th><td>	<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_shared" title='prop_changenode::cn_shared' data-use='w' data-ref="prop_changenode::cn_shared" data-ref-filename="prop_changenode..cn_shared">cn_shared</a> = <a class="ref fn" href="libzfs.h.html#zfs_is_shared" title='zfs_is_shared' data-ref="zfs_is_shared" data-ref-filename="zfs_is_shared">zfs_is_shared</a>(<a class="local col6 ref" href="#116temp" title='temp' data-ref="116temp" data-ref-filename="116temp">temp</a>);</td></tr>
<tr><th id="670">670</th><td>	<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_zoned" title='prop_changenode::cn_zoned' data-use='w' data-ref="prop_changenode::cn_zoned" data-ref-filename="prop_changenode..cn_zoned">cn_zoned</a> = <a class="ref fn" href="libzfs.h.html#zfs_prop_get_int" title='zfs_prop_get_int' data-ref="zfs_prop_get_int" data-ref-filename="zfs_prop_get_int">zfs_prop_get_int</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_ZONED" title='ZFS_PROP_ZONED' data-ref="ZFS_PROP_ZONED" data-ref-filename="ZFS_PROP_ZONED">ZFS_PROP_ZONED</a>);</td></tr>
<tr><th id="671">671</th><td>	<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_needpost" title='prop_changenode::cn_needpost' data-use='w' data-ref="prop_changenode::cn_needpost" data-ref-filename="prop_changenode..cn_needpost">cn_needpost</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="672">672</th><td></td></tr>
<tr><th id="673">673</th><td>	<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_node_init" title='uu_list_node_init' data-ref="uu_list_node_init" data-ref-filename="uu_list_node_init">uu_list_node_init</a>(<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>, &amp;<a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>-&gt;<a class="tu ref field" href="#prop_changenode::cn_listnode" title='prop_changenode::cn_listnode' data-use='a' data-ref="prop_changenode::cn_listnode" data-ref-filename="prop_changenode..cn_listnode">cn_listnode</a>, <a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_pool" title='prop_changelist::cl_pool' data-ref="prop_changelist::cl_pool" data-ref-filename="prop_changelist..cl_pool">cl_pool</a>);</td></tr>
<tr><th id="674">674</th><td>	<b>if</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_sorted" title='prop_changelist::cl_sorted' data-ref="prop_changelist::cl_sorted" data-ref-filename="prop_changelist..cl_sorted">cl_sorted</a>) {</td></tr>
<tr><th id="675">675</th><td>		<a class="typedef" href="../../libuutil/common/libuutil.h.html#uu_list_index_t" title='uu_list_index_t' data-type='uintptr_t' data-ref="uu_list_index_t" data-ref-filename="uu_list_index_t">uu_list_index_t</a> <dfn class="local col0 decl" id="120idx" title='idx' data-type='uu_list_index_t' data-ref="120idx" data-ref-filename="120idx">idx</dfn>;</td></tr>
<tr><th id="676">676</th><td>		(<em>void</em>) <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_find" title='uu_list_find' data-ref="uu_list_find" data-ref-filename="uu_list_find">uu_list_find</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, &amp;<a class="local col0 ref" href="#120idx" title='idx' data-ref="120idx" data-ref-filename="120idx">idx</a>);</td></tr>
<tr><th id="677">677</th><td>		<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_insert" title='uu_list_insert' data-ref="uu_list_insert" data-ref-filename="uu_list_insert">uu_list_insert</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>, <a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>, <a class="local col0 ref" href="#120idx" title='idx' data-ref="120idx" data-ref-filename="120idx">idx</a>);</td></tr>
<tr><th id="678">678</th><td>	} <b>else</b> {</td></tr>
<tr><th id="679">679</th><td>		<i>/*</i></td></tr>
<tr><th id="680">680</th><td><i>		 * Add the target dataset to the end of the list.</i></td></tr>
<tr><th id="681">681</th><td><i>		 * The list is not really unsorted. The list will be</i></td></tr>
<tr><th id="682">682</th><td><i>		 * in reverse dataset name order. This is necessary</i></td></tr>
<tr><th id="683">683</th><td><i>		 * when the original mountpoint is legacy or none.</i></td></tr>
<tr><th id="684">684</th><td><i>		 */</i></td></tr>
<tr><th id="685">685</th><td>		<a class="macro" href="libzfs.h.html#754" title="((uu_list_insert_after(clp-&gt;cl_list, uu_list_last(clp-&gt;cl_list), cn) == 0) ? (void)0 : __assert13(&quot;/___NETBSD_SRC___/objdir.amd64/compat/amd64/i386/external/cddl/osnet/lib/libzfs/../../../../../../../../../external/cddl/osnet/dist/lib/libzfs/common/libzfs_changelist.c&quot;, 686, __func__, &quot;uu_list_insert_after(clp-&gt;cl_list, uu_list_last(clp-&gt;cl_list), cn) == 0&quot;))" data-ref="_M/verify">verify</a>(<a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_insert_after" title='uu_list_insert_after' data-ref="uu_list_insert_after" data-ref-filename="uu_list_insert_after">uu_list_insert_after</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>,</td></tr>
<tr><th id="686">686</th><td>		    <a class="ref fn" href="../../libuutil/common/libuutil.h.html#uu_list_last" title='uu_list_last' data-ref="uu_list_last" data-ref-filename="uu_list_last">uu_list_last</a>(<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_list" title='prop_changelist::cl_list' data-ref="prop_changelist::cl_list" data-ref-filename="prop_changelist..cl_list">cl_list</a>), <a class="local col5 ref" href="#115cn" title='cn' data-ref="115cn" data-ref-filename="115cn">cn</a>) == <var>0</var>);</td></tr>
<tr><th id="687">687</th><td>	}</td></tr>
<tr><th id="688">688</th><td></td></tr>
<tr><th id="689">689</th><td>	<i>/*</i></td></tr>
<tr><th id="690">690</th><td><i>	 * If the mountpoint property was previously 'legacy', or 'none',</i></td></tr>
<tr><th id="691">691</th><td><i>	 * record it as the behavior of changelist_postfix() will be different.</i></td></tr>
<tr><th id="692">692</th><td><i>	 */</i></td></tr>
<tr><th id="693">693</th><td>	<b>if</b> ((<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_prop" title='prop_changelist::cl_prop' data-ref="prop_changelist::cl_prop" data-ref-filename="prop_changelist..cl_prop">cl_prop</a> == <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_MOUNTPOINT" title='ZFS_PROP_MOUNTPOINT' data-ref="ZFS_PROP_MOUNTPOINT" data-ref-filename="ZFS_PROP_MOUNTPOINT">ZFS_PROP_MOUNTPOINT</a>) &amp;&amp; <a class="local col9 ref" href="#119legacy" title='legacy' data-ref="119legacy" data-ref-filename="119legacy">legacy</a>) {</td></tr>
<tr><th id="694">694</th><td>		<i>/*</i></td></tr>
<tr><th id="695">695</th><td><i>		 * do not automatically mount ex-legacy datasets if</i></td></tr>
<tr><th id="696">696</th><td><i>		 * we specifically set canmount to noauto</i></td></tr>
<tr><th id="697">697</th><td><i>		 */</i></td></tr>
<tr><th id="698">698</th><td>		<b>if</b> (<a class="ref fn" href="libzfs.h.html#zfs_prop_get_int" title='zfs_prop_get_int' data-ref="zfs_prop_get_int" data-ref-filename="zfs_prop_get_int">zfs_prop_get_int</a>(<a class="local col0 ref" href="#110zhp" title='zhp' data-ref="110zhp" data-ref-filename="110zhp">zhp</a>, <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_PROP_CANMOUNT" title='ZFS_PROP_CANMOUNT' data-ref="ZFS_PROP_CANMOUNT" data-ref-filename="ZFS_PROP_CANMOUNT">ZFS_PROP_CANMOUNT</a>) !=</td></tr>
<tr><th id="699">699</th><td>		    <a class="enum" href="../../../uts/common/sys/fs/zfs.h.html#ZFS_CANMOUNT_NOAUTO" title='ZFS_CANMOUNT_NOAUTO' data-ref="ZFS_CANMOUNT_NOAUTO" data-ref-filename="ZFS_CANMOUNT_NOAUTO">ZFS_CANMOUNT_NOAUTO</a>)</td></tr>
<tr><th id="700">700</th><td>			<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>-&gt;<a class="ref field" href="#prop_changelist::cl_waslegacy" title='prop_changelist::cl_waslegacy' data-ref="prop_changelist::cl_waslegacy" data-ref-filename="prop_changelist..cl_waslegacy">cl_waslegacy</a> = <a class="macro" href="../../../../sys/sys/opentypes.h.html#36" title="1" data-ref="_M/B_TRUE">B_TRUE</a>;</td></tr>
<tr><th id="701">701</th><td>	}</td></tr>
<tr><th id="702">702</th><td></td></tr>
<tr><th id="703">703</th><td>	<b>return</b> (<a class="local col4 ref" href="#114clp" title='clp' data-ref="114clp" data-ref-filename="114clp">clp</a>);</td></tr>
<tr><th id="704">704</th><td>}</td></tr>
<tr><th id="705">705</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
