<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>vgreduce.c source code [netbsd/external/gpl2/lvm2/dist/tools/vgreduce.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/external/gpl2/lvm2/dist/tools/vgreduce.c'; var root_path = '../../../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../..'>netbsd</a>/<a href='../../../..'>external</a>/<a href='../../..'>gpl2</a>/<a href='../..'>lvm2</a>/<a href='..'>dist</a>/<a href='./'>tools</a>/<a href='vgreduce.c.html'>vgreduce.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: vgreduce.c,v 1.1.1.2 2009/12/02 00:25:57 haad Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright (C) 2001-2004 Sistina Software, Inc. All rights reserved.</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (C) 2004-2009 Red Hat, Inc. All rights reserved.</i></td></tr>
<tr><th id="6">6</th><td><i> *</i></td></tr>
<tr><th id="7">7</th><td><i> * This file is part of LVM2.</i></td></tr>
<tr><th id="8">8</th><td><i> *</i></td></tr>
<tr><th id="9">9</th><td><i> * This copyrighted material is made available to anyone wishing to use,</i></td></tr>
<tr><th id="10">10</th><td><i> * modify, copy, or redistribute it subject to the terms and conditions</i></td></tr>
<tr><th id="11">11</th><td><i> * of the GNU Lesser General Public License v.2.1.</i></td></tr>
<tr><th id="12">12</th><td><i> *</i></td></tr>
<tr><th id="13">13</th><td><i> * You should have received a copy of the GNU Lesser General Public License</i></td></tr>
<tr><th id="14">14</th><td><i> * along with this program; if not, write to the Free Software Foundation,</i></td></tr>
<tr><th id="15">15</th><td><i> * Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</i></td></tr>
<tr><th id="16">16</th><td><i> */</i></td></tr>
<tr><th id="17">17</th><td></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="tools.h.html">"tools.h"</a></u></td></tr>
<tr><th id="19">19</th><td><u>#include <a href="../include/lv_alloc.h.html">"lv_alloc.h"</a></u></td></tr>
<tr><th id="20">20</th><td></td></tr>
<tr><th id="21">21</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="_remove_pv" title='_remove_pv' data-type='int _remove_pv(struct volume_group * vg, struct pv_list * pvl, int silent)' data-ref="_remove_pv" data-ref-filename="_remove_pv">_remove_pv</dfn>(<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col1 decl" id="1vg" title='vg' data-type='struct volume_group *' data-ref="1vg" data-ref-filename="1vg">vg</dfn>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#pv_list" title='pv_list' data-ref="pv_list" data-ref-filename="pv_list">pv_list</a> *<dfn class="local col2 decl" id="2pvl" title='pvl' data-type='struct pv_list *' data-ref="2pvl" data-ref-filename="2pvl">pvl</dfn>, <em>int</em> <dfn class="local col3 decl" id="3silent" title='silent' data-type='int' data-ref="3silent" data-ref-filename="3silent">silent</dfn>)</td></tr>
<tr><th id="22">22</th><td>{</td></tr>
<tr><th id="23">23</th><td>	<em>char</em> <dfn class="local col4 decl" id="4uuid" title='uuid' data-type='char [64]' data-ref="4uuid" data-ref-filename="4uuid">uuid</dfn>[<var>64</var>] <b>__attribute</b>((aligned(<var>8</var>)));</td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td>	<b>if</b> (<a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pv_count" title='volume_group::pv_count' data-ref="volume_group::pv_count" data-ref-filename="volume_group..pv_count">pv_count</a> == <var>1</var>) {</td></tr>
<tr><th id="26">26</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 26 , -1, &quot;Volume Groups must always contain at least one PV&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Volume Groups must always contain at least one PV"</q>);</td></tr>
<tr><th id="27">27</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="28">28</th><td>	}</td></tr>
<tr><th id="29">29</th><td></td></tr>
<tr><th id="30">30</th><td>	<b>if</b> (!<a class="ref fn" href="../include/uuid.h.html#id_write_format" title='id_write_format' data-ref="id_write_format" data-ref-filename="id_write_format">id_write_format</a>(&amp;<a class="local col2 ref" href="#2pvl" title='pvl' data-ref="2pvl" data-ref-filename="2pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::id" title='physical_volume::id' data-ref="physical_volume::id" data-ref-filename="physical_volume..id">id</a>, <a class="local col4 ref" href="#4uuid" title='uuid' data-ref="4uuid" data-ref-filename="4uuid">uuid</a>, <b>sizeof</b>(<a class="local col4 ref" href="#4uuid" title='uuid' data-ref="4uuid" data-ref-filename="4uuid">uuid</a>)))</td></tr>
<tr><th id="31">31</th><td>		<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 31 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td>	<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 33 , 0, &quot;Removing PV with UUID %s from VG %s&quot;, uuid, vg-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Removing PV with UUID %s from VG %s"</q>, <a class="local col4 ref" href="#4uuid" title='uuid' data-ref="4uuid" data-ref-filename="4uuid">uuid</a>, <a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="34">34</th><td></td></tr>
<tr><th id="35">35</th><td>	<b>if</b> (<a class="local col2 ref" href="#2pvl" title='pvl' data-ref="2pvl" data-ref-filename="2pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::pe_alloc_count" title='physical_volume::pe_alloc_count' data-ref="physical_volume::pe_alloc_count" data-ref-filename="physical_volume..pe_alloc_count">pe_alloc_count</a>) {</td></tr>
<tr><th id="36">36</th><td>		<b>if</b> (!<a class="local col3 ref" href="#3silent" title='silent' data-ref="3silent" data-ref-filename="3silent">silent</a>)</td></tr>
<tr><th id="37">37</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 38 , -1, &quot;LVs still present on PV with UUID %s: &quot; &quot;Can&apos;t remove from VG %s&quot;, uuid, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"LVs still present on PV with UUID %s: "</q></td></tr>
<tr><th id="38">38</th><td>				  <q>"Can't remove from VG %s"</q>, <a class="local col4 ref" href="#4uuid" title='uuid' data-ref="4uuid" data-ref-filename="4uuid">uuid</a>, <a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="39">39</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="40">40</th><td>	}</td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td>	<a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::free_count" title='volume_group::free_count' data-ref="volume_group::free_count" data-ref-filename="volume_group..free_count">free_count</a> -= <a class="local col2 ref" href="#2pvl" title='pvl' data-ref="2pvl" data-ref-filename="2pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::pe_count" title='physical_volume::pe_count' data-ref="physical_volume::pe_count" data-ref-filename="physical_volume..pe_count">pe_count</a>;</td></tr>
<tr><th id="43">43</th><td>	<a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::extent_count" title='volume_group::extent_count' data-ref="volume_group::extent_count" data-ref-filename="volume_group..extent_count">extent_count</a> -= <a class="local col2 ref" href="#2pvl" title='pvl' data-ref="2pvl" data-ref-filename="2pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::pe_count" title='physical_volume::pe_count' data-ref="physical_volume::pe_count" data-ref-filename="physical_volume..pe_count">pe_count</a>;</td></tr>
<tr><th id="44">44</th><td>	<a class="local col1 ref" href="#1vg" title='vg' data-ref="1vg" data-ref-filename="1vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pv_count" title='volume_group::pv_count' data-ref="volume_group::pv_count" data-ref-filename="volume_group..pv_count">pv_count</a>--;</td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td>	<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_del" title='dm_list_del' data-ref="dm_list_del" data-ref-filename="dm_list_del">dm_list_del</a>(&amp;<a class="local col2 ref" href="#2pvl" title='pvl' data-ref="2pvl" data-ref-filename="2pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::list" title='pv_list::list' data-ref="pv_list::list" data-ref-filename="pv_list..list">list</a>);</td></tr>
<tr><th id="47">47</th><td></td></tr>
<tr><th id="48">48</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="49">49</th><td>}</td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="_remove_lv" title='_remove_lv' data-type='int _remove_lv(struct cmd_context * cmd, struct logical_volume * lv, int * list_unsafe, struct dm_list * lvs_changed)' data-ref="_remove_lv" data-ref-filename="_remove_lv">_remove_lv</dfn>(<b>struct</b> <a class="type" href="../include/toolcontext.h.html#cmd_context" title='cmd_context' data-ref="cmd_context" data-ref-filename="cmd_context">cmd_context</a> *<dfn class="local col5 decl" id="5cmd" title='cmd' data-type='struct cmd_context *' data-ref="5cmd" data-ref-filename="5cmd">cmd</dfn>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#logical_volume" title='logical_volume' data-ref="logical_volume" data-ref-filename="logical_volume">logical_volume</a> *<dfn class="local col6 decl" id="6lv" title='lv' data-type='struct logical_volume *' data-ref="6lv" data-ref-filename="6lv">lv</dfn>,</td></tr>
<tr><th id="52">52</th><td>		      <em>int</em> *<dfn class="local col7 decl" id="7list_unsafe" title='list_unsafe' data-type='int *' data-ref="7list_unsafe" data-ref-filename="7list_unsafe">list_unsafe</dfn>, <b>struct</b> <a class="type" href="../include/libdevmapper.h.html#dm_list" title='dm_list' data-ref="dm_list" data-ref-filename="dm_list">dm_list</a> *<dfn class="local col8 decl" id="8lvs_changed" title='lvs_changed' data-type='struct dm_list *' data-ref="8lvs_changed" data-ref-filename="8lvs_changed">lvs_changed</dfn>)</td></tr>
<tr><th id="53">53</th><td>{</td></tr>
<tr><th id="54">54</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_segment" title='lv_segment' data-ref="lv_segment" data-ref-filename="lv_segment">lv_segment</a> *<dfn class="local col9 decl" id="9snap_seg" title='snap_seg' data-type='struct lv_segment *' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</dfn>;</td></tr>
<tr><th id="55">55</th><td>	<b>struct</b> <a class="type" href="../include/libdevmapper.h.html#dm_list" title='dm_list' data-ref="dm_list" data-ref-filename="dm_list">dm_list</a> *<dfn class="local col0 decl" id="10snh" title='snh' data-type='struct dm_list *' data-ref="10snh" data-ref-filename="10snh">snh</dfn>, *<dfn class="local col1 decl" id="11snht" title='snht' data-type='struct dm_list *' data-ref="11snht" data-ref-filename="11snht">snht</dfn>;</td></tr>
<tr><th id="56">56</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#logical_volume" title='logical_volume' data-ref="logical_volume" data-ref-filename="logical_volume">logical_volume</a> *<dfn class="local col2 decl" id="12cow" title='cow' data-type='struct logical_volume *' data-ref="12cow" data-ref-filename="12cow">cow</dfn>;</td></tr>
<tr><th id="57">57</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_list" title='lv_list' data-ref="lv_list" data-ref-filename="lv_list">lv_list</a> *<dfn class="local col3 decl" id="13lvl" title='lvl' data-type='struct lv_list *' data-ref="13lvl" data-ref-filename="13lvl">lvl</dfn>;</td></tr>
<tr><th id="58">58</th><td>	<b>struct</b> <a class="type" href="../include/activate.h.html#lvinfo" title='lvinfo' data-ref="lvinfo" data-ref-filename="lvinfo">lvinfo</a> <dfn class="local col4 decl" id="14info" title='info' data-type='struct lvinfo' data-ref="14info" data-ref-filename="14info">info</dfn>;</td></tr>
<tr><th id="59">59</th><td>	<em>int</em> <dfn class="local col5 decl" id="15first" title='first' data-type='int' data-ref="15first" data-ref-filename="15first">first</dfn> = <var>1</var>;</td></tr>
<tr><th id="60">60</th><td></td></tr>
<tr><th id="61">61</th><td>	<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 62 , 0, &quot;%s/%s has missing extents: removing (including &quot; &quot;dependencies)&quot;, lv-&gt;vg-&gt;name, lv-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"%s/%s has missing extents: removing (including "</q></td></tr>
<tr><th id="62">62</th><td>		    <q>"dependencies)"</q>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::vg" title='logical_volume::vg' data-ref="logical_volume::vg" data-ref-filename="logical_volume..vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td>	<i>/* FIXME Cope properly with stacked devices &amp; snapshots. */</i></td></tr>
<tr><th id="65">65</th><td></td></tr>
<tr><th id="66">66</th><td>	<i>/* If snapshot device is missing, deactivate origin. */</i></td></tr>
<tr><th id="67">67</th><td>	<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#lv_is_cow" title='lv_is_cow' data-ref="lv_is_cow" data-ref-filename="lv_is_cow">lv_is_cow</a>(<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>) &amp;&amp; (<a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a> = <a class="ref fn" href="../include/metadata-exported.h.html#find_cow" title='find_cow' data-ref="find_cow" data-ref-filename="find_cow">find_cow</a>(<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>))) {</td></tr>
<tr><th id="68">68</th><td>		<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 69 , 0, &quot;Deactivating (if active) logical volume %s &quot; &quot;(origin of %s)&quot;, snap_seg-&gt;origin-&gt;name, lv-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Deactivating (if active) logical volume %s "</q></td></tr>
<tr><th id="69">69</th><td>			    <q>"(origin of %s)"</q>, <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td>		<b>if</b> (!<a class="ref fn" href="../include/lvm-globals.h.html#test_mode" title='test_mode' data-ref="test_mode" data-ref-filename="test_mode">test_mode</a>() &amp;&amp; !<a class="macro" href="../include/locking.h.html#137" title="lock_vol(cmd, (snap_seg-&gt;origin)-&gt;lvid.s, (0x00000008U | 0x00000000U) | ((vg_status(((snap_seg-&gt;origin)-&gt;vg)) &amp; 0x00000400U) ? 0x00000080U : 0))" data-ref="_M/deactivate_lv">deactivate_lv</a>(<a class="local col5 ref" href="#5cmd" title='cmd' data-ref="5cmd" data-ref-filename="5cmd">cmd</a>, <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>)) {</td></tr>
<tr><th id="72">72</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 73 , -1, &quot;Failed to deactivate LV %s&quot;, snap_seg-&gt;origin-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to deactivate LV %s"</q>,</td></tr>
<tr><th id="73">73</th><td>				  <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="74">74</th><td>			<b>return</b> <var>0</var>;</td></tr>
<tr><th id="75">75</th><td>		}</td></tr>
<tr><th id="76">76</th><td></td></tr>
<tr><th id="77">77</th><td>		<i>/* Use the origin LV */</i></td></tr>
<tr><th id="78">78</th><td>		<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a> = <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>;</td></tr>
<tr><th id="79">79</th><td>	}</td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td>	<i>/* Remove snapshot dependencies */</i></td></tr>
<tr><th id="82">82</th><td>	<a class="macro" href="../include/libdevmapper.h.html#793" title="for (snh = (&amp;lv-&gt;snapshot_segs)-&gt;n, snht = snh-&gt;n; snh != &amp;lv-&gt;snapshot_segs; snh = snht, snht = snh-&gt;n)" data-ref="_M/dm_list_iterate_safe">dm_list_iterate_safe</a>(<a class="local col0 ref" href="#10snh" title='snh' data-ref="10snh" data-ref-filename="10snh">snh</a>, <a class="local col1 ref" href="#11snht" title='snht' data-ref="11snht" data-ref-filename="11snht">snht</a>, &amp;<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::snapshot_segs" title='logical_volume::snapshot_segs' data-ref="logical_volume::snapshot_segs" data-ref-filename="logical_volume..snapshot_segs">snapshot_segs</a>) {</td></tr>
<tr><th id="83">83</th><td>		<a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a> = <a class="macro" href="../include/libdevmapper.h.html#750" title="((struct lv_segment *)((uintptr_t)(snh) - (uintptr_t)&amp;((struct lv_segment *) 0)-&gt;origin_list))" data-ref="_M/dm_list_struct_base">dm_list_struct_base</a>(<a class="local col0 ref" href="#10snh" title='snh' data-ref="10snh" data-ref-filename="10snh">snh</a>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_segment" title='lv_segment' data-ref="lv_segment" data-ref-filename="lv_segment">lv_segment</a>,</td></tr>
<tr><th id="84">84</th><td>					    <a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin_list" title='lv_segment::origin_list' data-ref="lv_segment::origin_list" data-ref-filename="lv_segment..origin_list">origin_list</a>);</td></tr>
<tr><th id="85">85</th><td>		<a class="local col2 ref" href="#12cow" title='cow' data-ref="12cow" data-ref-filename="12cow">cow</a> = <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::cow" title='lv_segment::cow' data-ref="lv_segment::cow" data-ref-filename="lv_segment..cow">cow</a>;</td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td>		<b>if</b> (<a class="local col5 ref" href="#15first" title='first' data-ref="15first" data-ref-filename="15first">first</a> &amp;&amp; !<a class="ref fn" href="../include/lvm-globals.h.html#test_mode" title='test_mode' data-ref="test_mode" data-ref-filename="test_mode">test_mode</a>() &amp;&amp;</td></tr>
<tr><th id="88">88</th><td>		    !<a class="macro" href="../include/locking.h.html#137" title="lock_vol(cmd, (snap_seg-&gt;origin)-&gt;lvid.s, (0x00000008U | 0x00000000U) | ((vg_status(((snap_seg-&gt;origin)-&gt;vg)) &amp; 0x00000400U) ? 0x00000080U : 0))" data-ref="_M/deactivate_lv">deactivate_lv</a>(<a class="local col5 ref" href="#5cmd" title='cmd' data-ref="5cmd" data-ref-filename="5cmd">cmd</a>, <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>)) {</td></tr>
<tr><th id="89">89</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 90 , -1, &quot;Failed to deactivate LV %s&quot;, snap_seg-&gt;origin-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to deactivate LV %s"</q>,</td></tr>
<tr><th id="90">90</th><td>				  <a class="local col9 ref" href="#9snap_seg" title='snap_seg' data-ref="9snap_seg" data-ref-filename="9snap_seg">snap_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::origin" title='lv_segment::origin' data-ref="lv_segment::origin" data-ref-filename="lv_segment..origin">origin</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="91">91</th><td>			<b>return</b> <var>0</var>;</td></tr>
<tr><th id="92">92</th><td>		}</td></tr>
<tr><th id="93">93</th><td></td></tr>
<tr><th id="94">94</th><td>		*<a class="local col7 ref" href="#7list_unsafe" title='list_unsafe' data-ref="7list_unsafe" data-ref-filename="7list_unsafe">list_unsafe</a> = <var>1</var>;	<i>/* May remove caller's lvht! */</i></td></tr>
<tr><th id="95">95</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_remove_snapshot" title='vg_remove_snapshot' data-ref="vg_remove_snapshot" data-ref-filename="vg_remove_snapshot">vg_remove_snapshot</a>(<a class="local col2 ref" href="#12cow" title='cow' data-ref="12cow" data-ref-filename="12cow">cow</a>))</td></tr>
<tr><th id="96">96</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 96 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="97">97</th><td>		<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 98 , 0, &quot;Removing LV %s from VG %s&quot;, cow-&gt;name, lv-&gt;vg-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Removing LV %s from VG %s"</q>, <a class="local col2 ref" href="#12cow" title='cow' data-ref="12cow" data-ref-filename="12cow">cow</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>,</td></tr>
<tr><th id="98">98</th><td>			    <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::vg" title='logical_volume::vg' data-ref="logical_volume::vg" data-ref-filename="logical_volume..vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="99">99</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#lv_remove" title='lv_remove' data-ref="lv_remove" data-ref-filename="lv_remove">lv_remove</a>(<a class="local col2 ref" href="#12cow" title='cow' data-ref="12cow" data-ref-filename="12cow">cow</a>))</td></tr>
<tr><th id="100">100</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 100 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="101">101</th><td></td></tr>
<tr><th id="102">102</th><td>		<a class="local col5 ref" href="#15first" title='first' data-ref="15first" data-ref-filename="15first">first</a> = <var>0</var>;</td></tr>
<tr><th id="103">103</th><td>	}</td></tr>
<tr><th id="104">104</th><td></td></tr>
<tr><th id="105">105</th><td>	<i>/*</i></td></tr>
<tr><th id="106">106</th><td><i>	 * If LV is active, replace it with error segment</i></td></tr>
<tr><th id="107">107</th><td><i>	 * and add to list of LVs to be removed later.</i></td></tr>
<tr><th id="108">108</th><td><i>	 * Doesn't apply to snapshots/origins yet - they're already deactivated.</i></td></tr>
<tr><th id="109">109</th><td><i>	 */</i></td></tr>
<tr><th id="110">110</th><td>	<i>/*</i></td></tr>
<tr><th id="111">111</th><td><i>	 * If the LV is a part of mirror segment,</i></td></tr>
<tr><th id="112">112</th><td><i>	 * the mirrored LV also should be cleaned up.</i></td></tr>
<tr><th id="113">113</th><td><i>	 * Clean-up is currently done by caller (_make_vg_consistent()).</i></td></tr>
<tr><th id="114">114</th><td><i>	 */</i></td></tr>
<tr><th id="115">115</th><td>	<b>if</b> ((<a class="ref fn" href="../include/activate.h.html#lv_info" title='lv_info' data-ref="lv_info" data-ref-filename="lv_info">lv_info</a>(<a class="local col5 ref" href="#5cmd" title='cmd' data-ref="5cmd" data-ref-filename="5cmd">cmd</a>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>, &amp;<a class="local col4 ref" href="#14info" title='info' data-ref="14info" data-ref-filename="14info">info</a>, <var>0</var>, <var>0</var>) &amp;&amp; <a class="local col4 ref" href="#14info" title='info' data-ref="14info" data-ref-filename="14info">info</a>.<a class="ref field" href="../include/activate.h.html#lvinfo::exists" title='lvinfo::exists' data-ref="lvinfo::exists" data-ref-filename="lvinfo..exists">exists</a>) ||</td></tr>
<tr><th id="116">116</th><td>	    <a class="ref fn" href="../include/metadata-exported.h.html#find_mirror_seg" title='find_mirror_seg' data-ref="find_mirror_seg" data-ref-filename="find_mirror_seg">find_mirror_seg</a>(<a class="ref fn" href="../include/metadata-exported.h.html#first_seg" title='first_seg' data-ref="first_seg" data-ref-filename="first_seg">first_seg</a>(<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>))) {</td></tr>
<tr><th id="117">117</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#replace_lv_with_error_segment" title='replace_lv_with_error_segment' data-ref="replace_lv_with_error_segment" data-ref-filename="replace_lv_with_error_segment">replace_lv_with_error_segment</a>(<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>))</td></tr>
<tr><th id="118">118</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 118 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="119">119</th><td></td></tr>
<tr><th id="120">120</th><td>		<b>if</b> (!(<a class="local col3 ref" href="#13lvl" title='lvl' data-ref="13lvl" data-ref-filename="13lvl">lvl</a> = <a class="ref fn" href="../include/libdevmapper.h.html#dm_pool_alloc" title='dm_pool_alloc' data-ref="dm_pool_alloc" data-ref-filename="dm_pool_alloc">dm_pool_alloc</a>(<a class="local col5 ref" href="#5cmd" title='cmd' data-ref="5cmd" data-ref-filename="5cmd">cmd</a>-&gt;<a class="ref field" href="../include/toolcontext.h.html#cmd_context::mem" title='cmd_context::mem' data-ref="cmd_context::mem" data-ref-filename="cmd_context..mem">mem</a>, <b>sizeof</b>(*<a class="local col3 ref" href="#13lvl" title='lvl' data-ref="13lvl" data-ref-filename="13lvl">lvl</a>)))) {</td></tr>
<tr><th id="121">121</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 121 , -1, &quot;lv_list alloc failed&quot;)" data-ref="_M/log_error">log_error</a>(<q>"lv_list alloc failed"</q>);</td></tr>
<tr><th id="122">122</th><td>			<b>return</b> <var>0</var>;</td></tr>
<tr><th id="123">123</th><td>		}</td></tr>
<tr><th id="124">124</th><td>		<a class="local col3 ref" href="#13lvl" title='lvl' data-ref="13lvl" data-ref-filename="13lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a> = <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>;</td></tr>
<tr><th id="125">125</th><td>		<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_add" title='dm_list_add' data-ref="dm_list_add" data-ref-filename="dm_list_add">dm_list_add</a>(<a class="local col8 ref" href="#8lvs_changed" title='lvs_changed' data-ref="8lvs_changed" data-ref-filename="8lvs_changed">lvs_changed</a>, &amp;<a class="local col3 ref" href="#13lvl" title='lvl' data-ref="13lvl" data-ref-filename="13lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::list" title='lv_list::list' data-ref="lv_list::list" data-ref-filename="lv_list..list">list</a>);</td></tr>
<tr><th id="126">126</th><td>	} <b>else</b> {</td></tr>
<tr><th id="127">127</th><td>		<i>/* Remove LV immediately. */</i></td></tr>
<tr><th id="128">128</th><td>		<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 128 , 0, &quot;Removing LV %s from VG %s&quot;, lv-&gt;name, lv-&gt;vg-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Removing LV %s from VG %s"</q>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>, <a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::vg" title='logical_volume::vg' data-ref="logical_volume::vg" data-ref-filename="logical_volume..vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="129">129</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#lv_remove" title='lv_remove' data-ref="lv_remove" data-ref-filename="lv_remove">lv_remove</a>(<a class="local col6 ref" href="#6lv" title='lv' data-ref="6lv" data-ref-filename="6lv">lv</a>))</td></tr>
<tr><th id="130">130</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 130 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="131">131</th><td>	}</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="134">134</th><td>}</td></tr>
<tr><th id="135">135</th><td></td></tr>
<tr><th id="136">136</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="_consolidate_vg" title='_consolidate_vg' data-type='int _consolidate_vg(struct cmd_context * cmd, struct volume_group * vg)' data-ref="_consolidate_vg" data-ref-filename="_consolidate_vg">_consolidate_vg</dfn>(<b>struct</b> <a class="type" href="../include/toolcontext.h.html#cmd_context" title='cmd_context' data-ref="cmd_context" data-ref-filename="cmd_context">cmd_context</a> *<dfn class="local col6 decl" id="16cmd" title='cmd' data-type='struct cmd_context *' data-ref="16cmd" data-ref-filename="16cmd">cmd</dfn>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col7 decl" id="17vg" title='vg' data-type='struct volume_group *' data-ref="17vg" data-ref-filename="17vg">vg</dfn>)</td></tr>
<tr><th id="137">137</th><td>{</td></tr>
<tr><th id="138">138</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#pv_list" title='pv_list' data-ref="pv_list" data-ref-filename="pv_list">pv_list</a> *<dfn class="local col8 decl" id="18pvl" title='pvl' data-type='struct pv_list *' data-ref="18pvl" data-ref-filename="18pvl">pvl</dfn>;</td></tr>
<tr><th id="139">139</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_list" title='lv_list' data-ref="lv_list" data-ref-filename="lv_list">lv_list</a> *<dfn class="local col9 decl" id="19lvl" title='lvl' data-type='struct lv_list *' data-ref="19lvl" data-ref-filename="19lvl">lvl</dfn>;</td></tr>
<tr><th id="140">140</th><td>	<em>int</em> <dfn class="local col0 decl" id="20r" title='r' data-type='int' data-ref="20r" data-ref-filename="20r">r</dfn> = <var>1</var>;</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td>	<a class="macro" href="../include/libdevmapper.h.html#811" title="for (lvl = ((typeof(*lvl) *)((uintptr_t)(((&amp;vg-&gt;lvs))-&gt;n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)); &amp;lvl-&gt;list != ((&amp;vg-&gt;lvs)); lvl = ((typeof(*lvl) *)((uintptr_t)(lvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col9 ref" href="#19lvl" title='lvl' data-ref="19lvl" data-ref-filename="19lvl">lvl</a>, &amp;<a class="local col7 ref" href="#17vg" title='vg' data-ref="17vg" data-ref-filename="17vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::lvs" title='volume_group::lvs' data-ref="volume_group::lvs" data-ref-filename="volume_group..lvs">lvs</a>)</td></tr>
<tr><th id="143">143</th><td>		<b>if</b> (<a class="local col9 ref" href="#19lvl" title='lvl' data-ref="19lvl" data-ref-filename="19lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::status" title='logical_volume::status' data-ref="logical_volume::status" data-ref-filename="logical_volume..status">status</a> &amp; <a class="macro" href="../include/metadata-exported.h.html#67" title="0x01000000U" data-ref="_M/PARTIAL_LV">PARTIAL_LV</a>) {</td></tr>
<tr><th id="144">144</th><td>			<a class="macro" href="../include/log.h.html#62" title="print_log(4 | 128, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 145 , 0, &quot;WARNING: Partial LV %s needs to be repaired &quot; &quot;or removed. &quot;, lvl-&gt;lv-&gt;name)" data-ref="_M/log_warn">log_warn</a>(<q>"WARNING: Partial LV %s needs to be repaired "</q></td></tr>
<tr><th id="145">145</th><td>				 <q>"or removed. "</q>, <a class="local col9 ref" href="#19lvl" title='lvl' data-ref="19lvl" data-ref-filename="19lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="146">146</th><td>			<a class="local col0 ref" href="#20r" title='r' data-ref="20r" data-ref-filename="20r">r</a> = <var>0</var>;</td></tr>
<tr><th id="147">147</th><td>		}</td></tr>
<tr><th id="148">148</th><td></td></tr>
<tr><th id="149">149</th><td>	<b>if</b> (!<a class="local col0 ref" href="#20r" title='r' data-ref="20r" data-ref-filename="20r">r</a>) {</td></tr>
<tr><th id="150">150</th><td>		<a class="local col6 ref" href="#16cmd" title='cmd' data-ref="16cmd" data-ref-filename="16cmd">cmd</a>-&gt;<a class="ref field" href="../include/toolcontext.h.html#cmd_context::handles_missing_pvs" title='cmd_context::handles_missing_pvs' data-ref="cmd_context::handles_missing_pvs" data-ref-filename="cmd_context..handles_missing_pvs">handles_missing_pvs</a> = <var>1</var>;</td></tr>
<tr><th id="151">151</th><td>		<a class="macro" href="../include/log.h.html#62" title="print_log(4 | 128, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 151 , 0, &quot;WARNING: There are still partial LVs in VG %s.&quot;, vg-&gt;name)" data-ref="_M/log_warn">log_warn</a>(<q>"WARNING: There are still partial LVs in VG %s."</q>, <a class="local col7 ref" href="#17vg" title='vg' data-ref="17vg" data-ref-filename="17vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="152">152</th><td>		<a class="macro" href="../include/log.h.html#62" title="print_log(4 | 128, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 152 , 0, &quot;To remove them unconditionally use: vgreduce --removemissing --force.&quot;)" data-ref="_M/log_warn">log_warn</a>(<q>"To remove them unconditionally use: vgreduce --removemissing --force."</q>);</td></tr>
<tr><th id="153">153</th><td>		<a class="macro" href="../include/log.h.html#62" title="print_log(4 | 128, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 153 , 0, &quot;Proceeding to remove empty missing PVs.&quot;)" data-ref="_M/log_warn">log_warn</a>(<q>"Proceeding to remove empty missing PVs."</q>);</td></tr>
<tr><th id="154">154</th><td>	}</td></tr>
<tr><th id="155">155</th><td></td></tr>
<tr><th id="156">156</th><td>	<a class="macro" href="../include/libdevmapper.h.html#811" title="for (pvl = ((typeof(*pvl) *)((uintptr_t)(((&amp;vg-&gt;pvs))-&gt;n) - (uintptr_t)&amp;((typeof(*pvl) *) 0)-&gt;list)); &amp;pvl-&gt;list != ((&amp;vg-&gt;pvs)); pvl = ((typeof(*pvl) *)((uintptr_t)(pvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*pvl) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col8 ref" href="#18pvl" title='pvl' data-ref="18pvl" data-ref-filename="18pvl">pvl</a>, &amp;<a class="local col7 ref" href="#17vg" title='vg' data-ref="17vg" data-ref-filename="17vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pvs" title='volume_group::pvs' data-ref="volume_group::pvs" data-ref-filename="volume_group..pvs">pvs</a>) {</td></tr>
<tr><th id="157">157</th><td>		<b>if</b> (<a class="local col8 ref" href="#18pvl" title='pvl' data-ref="18pvl" data-ref-filename="18pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::dev" title='physical_volume::dev' data-ref="physical_volume::dev" data-ref-filename="physical_volume..dev">dev</a> &amp;&amp; !(<a class="local col8 ref" href="#18pvl" title='pvl' data-ref="18pvl" data-ref-filename="18pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::status" title='physical_volume::status' data-ref="physical_volume::status" data-ref-filename="physical_volume..status">status</a> &amp; <a class="macro" href="../include/metadata-exported.h.html#66" title="0x00800000U" data-ref="_M/MISSING_PV">MISSING_PV</a>))</td></tr>
<tr><th id="158">158</th><td>			<b>continue</b>;</td></tr>
<tr><th id="159">159</th><td>		<b>if</b> (<a class="local col0 ref" href="#20r" title='r' data-ref="20r" data-ref-filename="20r">r</a> &amp;&amp; !<a class="tu ref fn" href="#_remove_pv" title='_remove_pv' data-use='c' data-ref="_remove_pv" data-ref-filename="_remove_pv">_remove_pv</a>(<a class="local col7 ref" href="#17vg" title='vg' data-ref="17vg" data-ref-filename="17vg">vg</a>, <a class="local col8 ref" href="#18pvl" title='pvl' data-ref="18pvl" data-ref-filename="18pvl">pvl</a>, <var>0</var>))</td></tr>
<tr><th id="160">160</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 160 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="161">161</th><td>	}</td></tr>
<tr><th id="162">162</th><td></td></tr>
<tr><th id="163">163</th><td>	<b>return</b> <a class="local col0 ref" href="#20r" title='r' data-ref="20r" data-ref-filename="20r">r</a>;</td></tr>
<tr><th id="164">164</th><td>}</td></tr>
<tr><th id="165">165</th><td></td></tr>
<tr><th id="166">166</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="_make_vg_consistent" title='_make_vg_consistent' data-type='int _make_vg_consistent(struct cmd_context * cmd, struct volume_group * vg)' data-ref="_make_vg_consistent" data-ref-filename="_make_vg_consistent">_make_vg_consistent</dfn>(<b>struct</b> <a class="type" href="../include/toolcontext.h.html#cmd_context" title='cmd_context' data-ref="cmd_context" data-ref-filename="cmd_context">cmd_context</a> *<dfn class="local col1 decl" id="21cmd" title='cmd' data-type='struct cmd_context *' data-ref="21cmd" data-ref-filename="21cmd">cmd</dfn>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col2 decl" id="22vg" title='vg' data-type='struct volume_group *' data-ref="22vg" data-ref-filename="22vg">vg</dfn>)</td></tr>
<tr><th id="167">167</th><td>{</td></tr>
<tr><th id="168">168</th><td>	<b>struct</b> <a class="type" href="../include/libdevmapper.h.html#dm_list" title='dm_list' data-ref="dm_list" data-ref-filename="dm_list">dm_list</a> *<dfn class="local col3 decl" id="23pvh" title='pvh' data-type='struct dm_list *' data-ref="23pvh" data-ref-filename="23pvh">pvh</dfn>, *<dfn class="local col4 decl" id="24pvht" title='pvht' data-type='struct dm_list *' data-ref="24pvht" data-ref-filename="24pvht">pvht</dfn>;</td></tr>
<tr><th id="169">169</th><td>	<b>struct</b> <a class="type" href="../include/libdevmapper.h.html#dm_list" title='dm_list' data-ref="dm_list" data-ref-filename="dm_list">dm_list</a> *<dfn class="local col5 decl" id="25lvh" title='lvh' data-type='struct dm_list *' data-ref="25lvh" data-ref-filename="25lvh">lvh</dfn>, *<dfn class="local col6 decl" id="26lvht" title='lvht' data-type='struct dm_list *' data-ref="26lvht" data-ref-filename="26lvht">lvht</dfn>;</td></tr>
<tr><th id="170">170</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#pv_list" title='pv_list' data-ref="pv_list" data-ref-filename="pv_list">pv_list</a> *<dfn class="local col7 decl" id="27pvl" title='pvl' data-type='struct pv_list *' data-ref="27pvl" data-ref-filename="27pvl">pvl</dfn>;</td></tr>
<tr><th id="171">171</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_list" title='lv_list' data-ref="lv_list" data-ref-filename="lv_list">lv_list</a> *<dfn class="local col8 decl" id="28lvl" title='lvl' data-type='struct lv_list *' data-ref="28lvl" data-ref-filename="28lvl">lvl</dfn>, *<dfn class="local col9 decl" id="29lvl2" title='lvl2' data-type='struct lv_list *' data-ref="29lvl2" data-ref-filename="29lvl2">lvl2</dfn>, *<dfn class="local col0 decl" id="30lvlt" title='lvlt' data-type='struct lv_list *' data-ref="30lvlt" data-ref-filename="30lvlt">lvlt</dfn>;</td></tr>
<tr><th id="172">172</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#logical_volume" title='logical_volume' data-ref="logical_volume" data-ref-filename="logical_volume">logical_volume</a> *<dfn class="local col1 decl" id="31lv" title='lv' data-type='struct logical_volume *' data-ref="31lv" data-ref-filename="31lv">lv</dfn>;</td></tr>
<tr><th id="173">173</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#physical_volume" title='physical_volume' data-ref="physical_volume" data-ref-filename="physical_volume">physical_volume</a> *<dfn class="local col2 decl" id="32pv" title='pv' data-type='struct physical_volume *' data-ref="32pv" data-ref-filename="32pv">pv</dfn>;</td></tr>
<tr><th id="174">174</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_segment" title='lv_segment' data-ref="lv_segment" data-ref-filename="lv_segment">lv_segment</a> *<dfn class="local col3 decl" id="33seg" title='seg' data-type='struct lv_segment *' data-ref="33seg" data-ref-filename="33seg">seg</dfn>, *<dfn class="local col4 decl" id="34mirrored_seg" title='mirrored_seg' data-type='struct lv_segment *' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</dfn>;</td></tr>
<tr><th id="175">175</th><td>	<em>unsigned</em> <dfn class="local col5 decl" id="35s" title='s' data-type='unsigned int' data-ref="35s" data-ref-filename="35s">s</dfn>;</td></tr>
<tr><th id="176">176</th><td>	<a class="typedef" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="36mimages" title='mimages' data-type='uint32_t' data-ref="36mimages" data-ref-filename="36mimages">mimages</dfn>, <dfn class="local col7 decl" id="37remove_log" title='remove_log' data-type='uint32_t' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</dfn>;</td></tr>
<tr><th id="177">177</th><td>	<em>int</em> <dfn class="local col8 decl" id="38list_unsafe" title='list_unsafe' data-type='int' data-ref="38list_unsafe" data-ref-filename="38list_unsafe">list_unsafe</dfn>, <dfn class="local col9 decl" id="39only_mirror_images_found" title='only_mirror_images_found' data-type='int' data-ref="39only_mirror_images_found" data-ref-filename="39only_mirror_images_found">only_mirror_images_found</dfn>;</td></tr>
<tr><th id="178">178</th><td>	<a class="macro" href="../include/libdevmapper.h.html#684" title="struct dm_list lvs_changed = { &amp;(lvs_changed), &amp;(lvs_changed) }" data-ref="_M/DM_LIST_INIT">DM_LIST_INIT</a>(<dfn class="local col0 decl" id="40lvs_changed" title='lvs_changed' data-type='struct dm_list' data-ref="40lvs_changed" data-ref-filename="40lvs_changed"><a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed"><a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed"><a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed"><a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a></a></a></a></dfn>);</td></tr>
<tr><th id="179">179</th><td>	<a class="local col9 ref" href="#39only_mirror_images_found" title='only_mirror_images_found' data-ref="39only_mirror_images_found" data-ref-filename="39only_mirror_images_found">only_mirror_images_found</a> = <var>1</var>;</td></tr>
<tr><th id="180">180</th><td></td></tr>
<tr><th id="181">181</th><td>	<i>/* Deactivate &amp; remove necessary LVs */</i></td></tr>
<tr><th id="182">182</th><td>      <dfn class="lbl" id="41restart_loop" data-ref="41restart_loop" data-ref-filename="41restart_loop">restart_loop</dfn>:</td></tr>
<tr><th id="183">183</th><td>	<a class="local col8 ref" href="#38list_unsafe" title='list_unsafe' data-ref="38list_unsafe" data-ref-filename="38list_unsafe">list_unsafe</a> = <var>0</var>;	<i>/* Set if we delete a different list-member */</i></td></tr>
<tr><th id="184">184</th><td></td></tr>
<tr><th id="185">185</th><td>	<a class="macro" href="../include/libdevmapper.h.html#793" title="for (lvh = (&amp;vg-&gt;lvs)-&gt;n, lvht = lvh-&gt;n; lvh != &amp;vg-&gt;lvs; lvh = lvht, lvht = lvh-&gt;n)" data-ref="_M/dm_list_iterate_safe">dm_list_iterate_safe</a>(<a class="local col5 ref" href="#25lvh" title='lvh' data-ref="25lvh" data-ref-filename="25lvh">lvh</a>, <a class="local col6 ref" href="#26lvht" title='lvht' data-ref="26lvht" data-ref-filename="26lvht">lvht</a>, &amp;<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::lvs" title='volume_group::lvs' data-ref="volume_group::lvs" data-ref-filename="volume_group..lvs">lvs</a>) {</td></tr>
<tr><th id="186">186</th><td>		<a class="local col1 ref" href="#31lv" title='lv' data-ref="31lv" data-ref-filename="31lv">lv</a> = <a class="macro" href="../include/libdevmapper.h.html#757" title="((struct lv_list *)((uintptr_t)((lvh)) - (uintptr_t)&amp;((struct lv_list *) 0)-&gt;list))" data-ref="_M/dm_list_item">dm_list_item</a>(<a class="local col5 ref" href="#25lvh" title='lvh' data-ref="25lvh" data-ref-filename="25lvh">lvh</a>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#lv_list" title='lv_list' data-ref="lv_list" data-ref-filename="lv_list">lv_list</a>)-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>;</td></tr>
<tr><th id="187">187</th><td></td></tr>
<tr><th id="188">188</th><td>		<i>/* Are any segments of this LV on missing PVs? */</i></td></tr>
<tr><th id="189">189</th><td>		<a class="macro" href="../include/libdevmapper.h.html#811" title="for (seg = ((typeof(*seg) *)((uintptr_t)(((&amp;lv-&gt;segments))-&gt;n) - (uintptr_t)&amp;((typeof(*seg) *) 0)-&gt;list)); &amp;seg-&gt;list != ((&amp;lv-&gt;segments)); seg = ((typeof(*seg) *)((uintptr_t)(seg-&gt;list.n) - (uintptr_t)&amp;((typeof(*seg) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>, &amp;<a class="local col1 ref" href="#31lv" title='lv' data-ref="31lv" data-ref-filename="31lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::segments" title='logical_volume::segments' data-ref="logical_volume::segments" data-ref-filename="logical_volume..segments">segments</a>) {</td></tr>
<tr><th id="190">190</th><td>			<b>for</b> (<a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a> = <var>0</var>; <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a> &lt; <a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::area_count" title='lv_segment::area_count' data-ref="lv_segment::area_count" data-ref-filename="lv_segment..area_count">area_count</a>; <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>++) {</td></tr>
<tr><th id="191">191</th><td>				<b>if</b> (<a class="macro" href="../include/metadata-exported.h.html#310" title="(seg)-&gt;areas[(s)].type" data-ref="_M/seg_type">seg_type</a>(<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>, <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>) != <a class="enum" href="../include/metadata-exported.h.html#AREA_PV" title='AREA_PV' data-ref="AREA_PV" data-ref-filename="AREA_PV">AREA_PV</a>)</td></tr>
<tr><th id="192">192</th><td>					<b>continue</b>;</td></tr>
<tr><th id="193">193</th><td></td></tr>
<tr><th id="194">194</th><td>				<i>/* FIXME Also check for segs on deleted LVs (incl pvmove) */</i></td></tr>
<tr><th id="195">195</th><td></td></tr>
<tr><th id="196">196</th><td>				<a class="local col2 ref" href="#32pv" title='pv' data-ref="32pv" data-ref-filename="32pv">pv</a> = <a class="macro" href="../include/metadata-exported.h.html#311" title="(seg)-&gt;areas[(s)].u.pv.pvseg-&gt;pv" data-ref="_M/seg_pv">seg_pv</a>(<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>, <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>);</td></tr>
<tr><th id="197">197</th><td>				<b>if</b> (!<a class="local col2 ref" href="#32pv" title='pv' data-ref="32pv" data-ref-filename="32pv">pv</a> || !<a class="ref fn" href="../include/metadata-exported.h.html#pv_dev" title='pv_dev' data-ref="pv_dev" data-ref-filename="pv_dev">pv_dev</a>(<a class="local col2 ref" href="#32pv" title='pv' data-ref="32pv" data-ref-filename="32pv">pv</a>) ||</td></tr>
<tr><th id="198">198</th><td>				    (<a class="local col2 ref" href="#32pv" title='pv' data-ref="32pv" data-ref-filename="32pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::status" title='physical_volume::status' data-ref="physical_volume::status" data-ref-filename="physical_volume..status">status</a> &amp; <a class="macro" href="../include/metadata-exported.h.html#66" title="0x00800000U" data-ref="_M/MISSING_PV">MISSING_PV</a>)) {</td></tr>
<tr><th id="199">199</th><td>					<b>if</b> (<a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, <a class="enum" href="args.h.html#50" title='mirrorsonly_ARG' data-ref="mirrorsonly_ARG" data-ref-filename="mirrorsonly_ARG">mirrorsonly_ARG</a>) &amp;&amp;</td></tr>
<tr><th id="200">200</th><td>					    !(<a class="local col1 ref" href="#31lv" title='lv' data-ref="31lv" data-ref-filename="31lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::status" title='logical_volume::status' data-ref="logical_volume::status" data-ref-filename="logical_volume..status">status</a> &amp; <a class="macro" href="../include/metadata-exported.h.html#60" title="0x00040000U" data-ref="_M/MIRROR_IMAGE">MIRROR_IMAGE</a>)) {</td></tr>
<tr><th id="201">201</th><td>						<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 201 , -1, &quot;Non-mirror-image LV %s found: can&apos;t remove.&quot;, lv-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Non-mirror-image LV %s found: can't remove."</q>, <a class="local col1 ref" href="#31lv" title='lv' data-ref="31lv" data-ref-filename="31lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="202">202</th><td>						<a class="local col9 ref" href="#39only_mirror_images_found" title='only_mirror_images_found' data-ref="39only_mirror_images_found" data-ref-filename="39only_mirror_images_found">only_mirror_images_found</a> = <var>0</var>;</td></tr>
<tr><th id="203">203</th><td>						<b>continue</b>;</td></tr>
<tr><th id="204">204</th><td>					}</td></tr>
<tr><th id="205">205</th><td>					<b>if</b> (!<a class="tu ref fn" href="#_remove_lv" title='_remove_lv' data-use='c' data-ref="_remove_lv" data-ref-filename="_remove_lv">_remove_lv</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, <a class="local col1 ref" href="#31lv" title='lv' data-ref="31lv" data-ref-filename="31lv">lv</a>, &amp;<a class="local col8 ref" href="#38list_unsafe" title='list_unsafe' data-ref="38list_unsafe" data-ref-filename="38list_unsafe">list_unsafe</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>))</td></tr>
<tr><th id="206">206</th><td>						<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 206 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="207">207</th><td>					<b>if</b> (<a class="local col8 ref" href="#38list_unsafe" title='list_unsafe' data-ref="38list_unsafe" data-ref-filename="38list_unsafe">list_unsafe</a>)</td></tr>
<tr><th id="208">208</th><td>						<b>goto</b> <a class="lbl" href="#41restart_loop" data-ref="41restart_loop" data-ref-filename="41restart_loop">restart_loop</a>;</td></tr>
<tr><th id="209">209</th><td>				}</td></tr>
<tr><th id="210">210</th><td>			}</td></tr>
<tr><th id="211">211</th><td>		}</td></tr>
<tr><th id="212">212</th><td>	}</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td>	<b>if</b> (!<a class="local col9 ref" href="#39only_mirror_images_found" title='only_mirror_images_found' data-ref="39only_mirror_images_found" data-ref-filename="39only_mirror_images_found">only_mirror_images_found</a>) {</td></tr>
<tr><th id="215">215</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 215 , -1, &quot;Aborting because --mirrorsonly was specified.&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Aborting because --mirrorsonly was specified."</q>);</td></tr>
<tr><th id="216">216</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="217">217</th><td>	}</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td>	<i>/*</i></td></tr>
<tr><th id="220">220</th><td><i>	 * Remove missing PVs. FIXME: This duplicates _consolidate_vg above,</i></td></tr>
<tr><th id="221">221</th><td><i>	 * but we cannot use that right now, since the LV removal code in this</i></td></tr>
<tr><th id="222">222</th><td><i>	 * function leaves the VG in a "somewhat inconsistent" state and</i></td></tr>
<tr><th id="223">223</th><td><i>	 * _consolidate_vg doesn't like that -- specifically, mirrors are fixed</i></td></tr>
<tr><th id="224">224</th><td><i>	 * up *after* the PVs are removed. All this should be gradually</i></td></tr>
<tr><th id="225">225</th><td><i>	 * superseded by lvconvert --repair.</i></td></tr>
<tr><th id="226">226</th><td><i>	 */</i></td></tr>
<tr><th id="227">227</th><td>	<a class="macro" href="../include/libdevmapper.h.html#793" title="for (pvh = (&amp;vg-&gt;pvs)-&gt;n, pvht = pvh-&gt;n; pvh != &amp;vg-&gt;pvs; pvh = pvht, pvht = pvh-&gt;n)" data-ref="_M/dm_list_iterate_safe">dm_list_iterate_safe</a>(<a class="local col3 ref" href="#23pvh" title='pvh' data-ref="23pvh" data-ref-filename="23pvh">pvh</a>, <a class="local col4 ref" href="#24pvht" title='pvht' data-ref="24pvht" data-ref-filename="24pvht">pvht</a>, &amp;<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pvs" title='volume_group::pvs' data-ref="volume_group::pvs" data-ref-filename="volume_group..pvs">pvs</a>) {</td></tr>
<tr><th id="228">228</th><td>		<a class="local col7 ref" href="#27pvl" title='pvl' data-ref="27pvl" data-ref-filename="27pvl">pvl</a> = <a class="macro" href="../include/libdevmapper.h.html#757" title="((struct pv_list *)((uintptr_t)((pvh)) - (uintptr_t)&amp;((struct pv_list *) 0)-&gt;list))" data-ref="_M/dm_list_item">dm_list_item</a>(<a class="local col3 ref" href="#23pvh" title='pvh' data-ref="23pvh" data-ref-filename="23pvh">pvh</a>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#pv_list" title='pv_list' data-ref="pv_list" data-ref-filename="pv_list">pv_list</a>);</td></tr>
<tr><th id="229">229</th><td>		<b>if</b> (<a class="local col7 ref" href="#27pvl" title='pvl' data-ref="27pvl" data-ref-filename="27pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::pv" title='pv_list::pv' data-ref="pv_list::pv" data-ref-filename="pv_list..pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::dev" title='physical_volume::dev' data-ref="physical_volume::dev" data-ref-filename="physical_volume..dev">dev</a>)</td></tr>
<tr><th id="230">230</th><td>			<b>continue</b>;</td></tr>
<tr><th id="231">231</th><td>		<b>if</b> (!<a class="tu ref fn" href="#_remove_pv" title='_remove_pv' data-use='c' data-ref="_remove_pv" data-ref-filename="_remove_pv">_remove_pv</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>, <a class="local col7 ref" href="#27pvl" title='pvl' data-ref="27pvl" data-ref-filename="27pvl">pvl</a>, <var>0</var>))</td></tr>
<tr><th id="232">232</th><td>			<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 232 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="233">233</th><td>	}</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td>	<i>/* FIXME Recovery.  For now people must clean up by hand. */</i></td></tr>
<tr><th id="236">236</th><td></td></tr>
<tr><th id="237">237</th><td>	<b>if</b> (!<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_empty" title='dm_list_empty' data-ref="dm_list_empty" data-ref-filename="dm_list_empty">dm_list_empty</a>(&amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>)) {</td></tr>
<tr><th id="238">238</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_write" title='vg_write' data-ref="vg_write" data-ref-filename="vg_write">vg_write</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>)) {</td></tr>
<tr><th id="239">239</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 240 , -1, &quot;Failed to write out a consistent VG for %s&quot;, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to write out a consistent VG for %s"</q>,</td></tr>
<tr><th id="240">240</th><td>				  <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="241">241</th><td>			<b>return</b> <var>0</var>;</td></tr>
<tr><th id="242">242</th><td>		}</td></tr>
<tr><th id="243">243</th><td></td></tr>
<tr><th id="244">244</th><td>		<b>if</b> (!<a class="ref fn" href="../include/lvm-globals.h.html#test_mode" title='test_mode' data-ref="test_mode" data-ref-filename="test_mode">test_mode</a>()) {</td></tr>
<tr><th id="245">245</th><td>			<i>/* Suspend lvs_changed */</i></td></tr>
<tr><th id="246">246</th><td>			<b>if</b> (!<a class="ref fn" href="../include/locking.h.html#suspend_lvs" title='suspend_lvs' data-ref="suspend_lvs" data-ref-filename="suspend_lvs">suspend_lvs</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>)) {</td></tr>
<tr><th id="247">247</th><td>				<a class="macro" href="../include/log.h.html#66" title="print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 247 , 0, &quot;&lt;backtrace&gt;&quot;)" data-ref="_M/stack">stack</a>;</td></tr>
<tr><th id="248">248</th><td>				<a class="ref fn" href="../include/metadata-exported.h.html#vg_revert" title='vg_revert' data-ref="vg_revert" data-ref-filename="vg_revert">vg_revert</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>);</td></tr>
<tr><th id="249">249</th><td>				<b>return</b> <var>0</var>;</td></tr>
<tr><th id="250">250</th><td>			}</td></tr>
<tr><th id="251">251</th><td>		}</td></tr>
<tr><th id="252">252</th><td></td></tr>
<tr><th id="253">253</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_commit" title='vg_commit' data-ref="vg_commit" data-ref-filename="vg_commit">vg_commit</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>)) {</td></tr>
<tr><th id="254">254</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 255 , -1, &quot;Failed to commit consistent VG for %s&quot;, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to commit consistent VG for %s"</q>,</td></tr>
<tr><th id="255">255</th><td>				  <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="256">256</th><td>			<a class="ref fn" href="../include/metadata-exported.h.html#vg_revert" title='vg_revert' data-ref="vg_revert" data-ref-filename="vg_revert">vg_revert</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>);</td></tr>
<tr><th id="257">257</th><td>			<b>return</b> <var>0</var>;</td></tr>
<tr><th id="258">258</th><td>		}</td></tr>
<tr><th id="259">259</th><td></td></tr>
<tr><th id="260">260</th><td>		<b>if</b> (!<a class="ref fn" href="../include/lvm-globals.h.html#test_mode" title='test_mode' data-ref="test_mode" data-ref-filename="test_mode">test_mode</a>()) {</td></tr>
<tr><th id="261">261</th><td>			<b>if</b> (!<a class="ref fn" href="../include/locking.h.html#resume_lvs" title='resume_lvs' data-ref="resume_lvs" data-ref-filename="resume_lvs">resume_lvs</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>)) {</td></tr>
<tr><th id="262">262</th><td>				<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 262 , -1, &quot;Failed to resume LVs using error segments.&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Failed to resume LVs using error segments."</q>);</td></tr>
<tr><th id="263">263</th><td>				<b>return</b> <var>0</var>;</td></tr>
<tr><th id="264">264</th><td>			}</td></tr>
<tr><th id="265">265</th><td>		}</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td>  <dfn class="lbl" id="42lvs_changed_altered" data-ref="42lvs_changed_altered" data-ref-filename="42lvs_changed_altered">lvs_changed_altered</dfn>:</td></tr>
<tr><th id="268">268</th><td>		<i>/* Remove lost mirror images from mirrors */</i></td></tr>
<tr><th id="269">269</th><td>		<a class="macro" href="../include/libdevmapper.h.html#811" title="for (lvl = ((typeof(*lvl) *)((uintptr_t)(((&amp;vg-&gt;lvs))-&gt;n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)); &amp;lvl-&gt;list != ((&amp;vg-&gt;lvs)); lvl = ((typeof(*lvl) *)((uintptr_t)(lvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>, &amp;<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::lvs" title='volume_group::lvs' data-ref="volume_group::lvs" data-ref-filename="volume_group..lvs">lvs</a>) {</td></tr>
<tr><th id="270">270</th><td>  <dfn class="lbl" id="43mirrored_seg_altered" data-ref="43mirrored_seg_altered" data-ref-filename="43mirrored_seg_altered">mirrored_seg_altered</dfn>:</td></tr>
<tr><th id="271">271</th><td>			<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a> = <a class="ref fn" href="../include/metadata-exported.h.html#first_seg" title='first_seg' data-ref="first_seg" data-ref-filename="first_seg">first_seg</a>(<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>);</td></tr>
<tr><th id="272">272</th><td>			<b>if</b> (!<a class="macro" href="../include/segtype.h.html#42" title="((mirrored_seg)-&gt;segtype-&gt;flags &amp; 0x00000004U ? 1 : 0)" data-ref="_M/seg_is_mirrored">seg_is_mirrored</a>(<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>))</td></tr>
<tr><th id="273">273</th><td>				<b>continue</b>;</td></tr>
<tr><th id="274">274</th><td></td></tr>
<tr><th id="275">275</th><td>			<a class="local col6 ref" href="#36mimages" title='mimages' data-ref="36mimages" data-ref-filename="36mimages">mimages</a> = <a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::area_count" title='lv_segment::area_count' data-ref="lv_segment::area_count" data-ref-filename="lv_segment..area_count">area_count</a>;</td></tr>
<tr><th id="276">276</th><td>			<a class="local col7 ref" href="#37remove_log" title='remove_log' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</a> = <var>0</var>;</td></tr>
<tr><th id="277">277</th><td></td></tr>
<tr><th id="278">278</th><td>			<b>for</b> (<a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a> = <var>0</var>; <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a> &lt; <a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::area_count" title='lv_segment::area_count' data-ref="lv_segment::area_count" data-ref-filename="lv_segment..area_count">area_count</a>; <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>++) {</td></tr>
<tr><th id="279">279</th><td>				<a class="macro" href="../include/libdevmapper.h.html#830" title="for (lvl2 = ((typeof(*lvl2) *)((uintptr_t)(((&amp;lvs_changed))-&gt;n) - (uintptr_t)&amp;((typeof(*lvl2) *) 0)-&gt;list)), lvlt = ((typeof(*lvl2) *)((uintptr_t)(lvl2-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl2) *) 0)-&gt;list)); &amp;lvl2-&gt;list != ((&amp;lvs_changed)); lvl2 = lvlt, lvlt = ((typeof(*lvl2) *)((uintptr_t)(lvl2-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl2) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items_safe">dm_list_iterate_items_safe</a>(<a class="local col9 ref" href="#29lvl2" title='lvl2' data-ref="29lvl2" data-ref-filename="29lvl2">lvl2</a>, <a class="local col0 ref" href="#30lvlt" title='lvlt' data-ref="30lvlt" data-ref-filename="30lvlt">lvlt</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>) {</td></tr>
<tr><th id="280">280</th><td>					<b>if</b> (<a class="macro" href="../include/metadata-exported.h.html#310" title="(mirrored_seg)-&gt;areas[(s)].type" data-ref="_M/seg_type">seg_type</a>(<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>, <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>) != <a class="enum" href="../include/metadata-exported.h.html#AREA_LV" title='AREA_LV' data-ref="AREA_LV" data-ref-filename="AREA_LV">AREA_LV</a> ||</td></tr>
<tr><th id="281">281</th><td>					    <a class="local col9 ref" href="#29lvl2" title='lvl2' data-ref="29lvl2" data-ref-filename="29lvl2">lvl2</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a> != <a class="macro" href="../include/metadata-exported.h.html#312" title="(mirrored_seg)-&gt;areas[(s)].u.lv.lv" data-ref="_M/seg_lv">seg_lv</a>(<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>, <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>))</td></tr>
<tr><th id="282">282</th><td>						<b>continue</b>;</td></tr>
<tr><th id="283">283</th><td>					<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_del" title='dm_list_del' data-ref="dm_list_del" data-ref-filename="dm_list_del">dm_list_del</a>(&amp;<a class="local col9 ref" href="#29lvl2" title='lvl2' data-ref="29lvl2" data-ref-filename="29lvl2">lvl2</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::list" title='lv_list::list' data-ref="lv_list::list" data-ref-filename="lv_list..list">list</a>);</td></tr>
<tr><th id="284">284</th><td>					<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#shift_mirror_images" title='shift_mirror_images' data-ref="shift_mirror_images" data-ref-filename="shift_mirror_images">shift_mirror_images</a>(<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>, <a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>))</td></tr>
<tr><th id="285">285</th><td>						<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 285 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="286">286</th><td>					<a class="local col6 ref" href="#36mimages" title='mimages' data-ref="36mimages" data-ref-filename="36mimages">mimages</a>--;	<i>/* FIXME Assumes uniqueness */</i></td></tr>
<tr><th id="287">287</th><td>				}</td></tr>
<tr><th id="288">288</th><td>			}</td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td>			<b>if</b> (<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::log_lv" title='lv_segment::log_lv' data-ref="lv_segment::log_lv" data-ref-filename="lv_segment..log_lv">log_lv</a>) {</td></tr>
<tr><th id="291">291</th><td>				<a class="macro" href="../include/libdevmapper.h.html#811" title="for (seg = ((typeof(*seg) *)((uintptr_t)(((&amp;mirrored_seg-&gt;log_lv-&gt;segments))-&gt;n) - (uintptr_t)&amp;((typeof(*seg) *) 0)-&gt;list)); &amp;seg-&gt;list != ((&amp;mirrored_seg-&gt;log_lv-&gt;segments)); seg = ((typeof(*seg) *)((uintptr_t)(seg-&gt;list.n) - (uintptr_t)&amp;((typeof(*seg) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>, &amp;<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::log_lv" title='lv_segment::log_lv' data-ref="lv_segment::log_lv" data-ref-filename="lv_segment..log_lv">log_lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::segments" title='logical_volume::segments' data-ref="logical_volume::segments" data-ref-filename="logical_volume..segments">segments</a>) {</td></tr>
<tr><th id="292">292</th><td>					<i>/* FIXME: The second test shouldn't be required */</i></td></tr>
<tr><th id="293">293</th><td>					<b>if</b> ((<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::segtype" title='lv_segment::segtype' data-ref="lv_segment::segtype" data-ref-filename="lv_segment..segtype">segtype</a> ==</td></tr>
<tr><th id="294">294</th><td>					     <a class="ref fn" href="../include/segtype.h.html#get_segtype_from_string" title='get_segtype_from_string' data-ref="get_segtype_from_string" data-ref-filename="get_segtype_from_string">get_segtype_from_string</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::cmd" title='volume_group::cmd' data-ref="volume_group::cmd" data-ref-filename="volume_group..cmd">cmd</a>, <q>"error"</q>))) {</td></tr>
<tr><th id="295">295</th><td>						<a class="macro" href="../include/log.h.html#69" title="print_log(4, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 296 , 0, &quot;The log device for %s/%s has failed.&quot;, vg-&gt;name, mirrored_seg-&gt;lv-&gt;name)" data-ref="_M/log_print">log_print</a>(<q>"The log device for %s/%s has failed."</q>,</td></tr>
<tr><th id="296">296</th><td>							  <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>, <a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::lv" title='lv_segment::lv' data-ref="lv_segment::lv" data-ref-filename="lv_segment..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="297">297</th><td>						<a class="local col7 ref" href="#37remove_log" title='remove_log' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</a> = <var>1</var>;</td></tr>
<tr><th id="298">298</th><td>						<b>break</b>;</td></tr>
<tr><th id="299">299</th><td>					}</td></tr>
<tr><th id="300">300</th><td>					<b>if</b> (!<a class="ref fn" href="../../../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#strcmp" title='strcmp' data-ref="strcmp" data-ref-filename="strcmp">strcmp</a>(<a class="local col3 ref" href="#33seg" title='seg' data-ref="33seg" data-ref-filename="33seg">seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::segtype" title='lv_segment::segtype' data-ref="lv_segment::segtype" data-ref-filename="lv_segment..segtype">segtype</a>-&gt;<a class="ref field" href="../include/segtype.h.html#segment_type::name" title='segment_type::name' data-ref="segment_type::name" data-ref-filename="segment_type..name">name</a>, <q>"error"</q>)) {</td></tr>
<tr><th id="301">301</th><td>						<a class="macro" href="../include/log.h.html#69" title="print_log(4, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 302 , 0, &quot;Log device for %s/%s has failed.&quot;, vg-&gt;name, mirrored_seg-&gt;lv-&gt;name)" data-ref="_M/log_print">log_print</a>(<q>"Log device for %s/%s has failed."</q>,</td></tr>
<tr><th id="302">302</th><td>							  <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>, <a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::lv" title='lv_segment::lv' data-ref="lv_segment::lv" data-ref-filename="lv_segment..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="303">303</th><td>						<a class="local col7 ref" href="#37remove_log" title='remove_log' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</a> = <var>1</var>;</td></tr>
<tr><th id="304">304</th><td>						<b>break</b>;</td></tr>
<tr><th id="305">305</th><td>					}</td></tr>
<tr><th id="306">306</th><td>				}</td></tr>
<tr><th id="307">307</th><td>			}</td></tr>
<tr><th id="308">308</th><td></td></tr>
<tr><th id="309">309</th><td>			<b>if</b> ((<a class="local col6 ref" href="#36mimages" title='mimages' data-ref="36mimages" data-ref-filename="36mimages">mimages</a> != <a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_segment::area_count" title='lv_segment::area_count' data-ref="lv_segment::area_count" data-ref-filename="lv_segment..area_count">area_count</a>) || <a class="local col7 ref" href="#37remove_log" title='remove_log' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</a>){</td></tr>
<tr><th id="310">310</th><td>				<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#reconfigure_mirror_images" title='reconfigure_mirror_images' data-ref="reconfigure_mirror_images" data-ref-filename="reconfigure_mirror_images">reconfigure_mirror_images</a>(<a class="local col4 ref" href="#34mirrored_seg" title='mirrored_seg' data-ref="34mirrored_seg" data-ref-filename="34mirrored_seg">mirrored_seg</a>, <a class="local col6 ref" href="#36mimages" title='mimages' data-ref="36mimages" data-ref-filename="36mimages">mimages</a>,</td></tr>
<tr><th id="311">311</th><td>							       <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col7 ref" href="#37remove_log" title='remove_log' data-ref="37remove_log" data-ref-filename="37remove_log">remove_log</a>))</td></tr>
<tr><th id="312">312</th><td>					<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 312 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="313">313</th><td></td></tr>
<tr><th id="314">314</th><td>				<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_write" title='vg_write' data-ref="vg_write" data-ref-filename="vg_write">vg_write</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>)) {</td></tr>
<tr><th id="315">315</th><td>					<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 316 , -1, &quot;Failed to write out updated &quot; &quot;VG for %s&quot;, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to write out updated "</q></td></tr>
<tr><th id="316">316</th><td>						  <q>"VG for %s"</q>, <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="317">317</th><td>					<b>return</b> <var>0</var>;</td></tr>
<tr><th id="318">318</th><td>				}</td></tr>
<tr><th id="319">319</th><td>		</td></tr>
<tr><th id="320">320</th><td>				<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_commit" title='vg_commit' data-ref="vg_commit" data-ref-filename="vg_commit">vg_commit</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>)) {</td></tr>
<tr><th id="321">321</th><td>					<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 322 , -1, &quot;Failed to commit updated VG &quot; &quot;for %s&quot;, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to commit updated VG "</q></td></tr>
<tr><th id="322">322</th><td>						  <q>"for %s"</q>, <a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="323">323</th><td>					<a class="ref fn" href="../include/metadata-exported.h.html#vg_revert" title='vg_revert' data-ref="vg_revert" data-ref-filename="vg_revert">vg_revert</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>);</td></tr>
<tr><th id="324">324</th><td>					<b>return</b> <var>0</var>;</td></tr>
<tr><th id="325">325</th><td>				}</td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td>				<i>/* mirrored LV no longer has valid mimages.</i></td></tr>
<tr><th id="328">328</th><td><i>				 * So add it to lvs_changed for removal.</i></td></tr>
<tr><th id="329">329</th><td><i>				 * For this LV may be an area of other mirror,</i></td></tr>
<tr><th id="330">330</th><td><i>				 * restart the loop. */</i></td></tr>
<tr><th id="331">331</th><td>				<b>if</b> (!<a class="local col6 ref" href="#36mimages" title='mimages' data-ref="36mimages" data-ref-filename="36mimages">mimages</a>) {</td></tr>
<tr><th id="332">332</th><td>					<b>if</b> (!<a class="tu ref fn" href="#_remove_lv" title='_remove_lv' data-use='c' data-ref="_remove_lv" data-ref-filename="_remove_lv">_remove_lv</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>,</td></tr>
<tr><th id="333">333</th><td>						 &amp;<a class="local col8 ref" href="#38list_unsafe" title='list_unsafe' data-ref="38list_unsafe" data-ref-filename="38list_unsafe">list_unsafe</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>))</td></tr>
<tr><th id="334">334</th><td>						<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 334 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="335">335</th><td>					<b>goto</b> <a class="lbl" href="#42lvs_changed_altered" data-ref="42lvs_changed_altered" data-ref-filename="42lvs_changed_altered">lvs_changed_altered</a>;</td></tr>
<tr><th id="336">336</th><td>				}</td></tr>
<tr><th id="337">337</th><td></td></tr>
<tr><th id="338">338</th><td>				<i>/* As a result of reconfigure_mirror_images(),</i></td></tr>
<tr><th id="339">339</th><td><i>				 * first_seg(lv) may now be different seg.</i></td></tr>
<tr><th id="340">340</th><td><i>				 * e.g. a temporary layer might be removed.</i></td></tr>
<tr><th id="341">341</th><td><i>				 * So check the mirrored_seg again. */</i></td></tr>
<tr><th id="342">342</th><td>				<b>goto</b> <a class="lbl" href="#43mirrored_seg_altered" data-ref="43mirrored_seg_altered" data-ref-filename="43mirrored_seg_altered">mirrored_seg_altered</a>;</td></tr>
<tr><th id="343">343</th><td>			}</td></tr>
<tr><th id="344">344</th><td>		}</td></tr>
<tr><th id="345">345</th><td></td></tr>
<tr><th id="346">346</th><td>		<i>/* Deactivate error LVs */</i></td></tr>
<tr><th id="347">347</th><td>		<b>if</b> (!<a class="ref fn" href="../include/lvm-globals.h.html#test_mode" title='test_mode' data-ref="test_mode" data-ref-filename="test_mode">test_mode</a>()) {</td></tr>
<tr><th id="348">348</th><td>			<a class="macro" href="../include/libdevmapper.h.html#830" title="for (lvl = ((typeof(*lvl) *)((uintptr_t)(((&amp;lvs_changed))-&gt;n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)), lvlt = ((typeof(*lvl) *)((uintptr_t)(lvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)); &amp;lvl-&gt;list != ((&amp;lvs_changed)); lvl = lvlt, lvlt = ((typeof(*lvl) *)((uintptr_t)(lvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items_safe">dm_list_iterate_items_safe</a>(<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>, <a class="local col0 ref" href="#30lvlt" title='lvlt' data-ref="30lvlt" data-ref-filename="30lvlt">lvlt</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>) {</td></tr>
<tr><th id="349">349</th><td>				<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 350 , 0, &quot;Deactivating (if active) logical volume %s&quot;, lvl-&gt;lv-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Deactivating (if active) logical volume %s"</q>,</td></tr>
<tr><th id="350">350</th><td>					    <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="351">351</th><td></td></tr>
<tr><th id="352">352</th><td>				<b>if</b> (!<a class="macro" href="../include/locking.h.html#137" title="lock_vol(cmd, (lvl-&gt;lv)-&gt;lvid.s, (0x00000008U | 0x00000000U) | ((vg_status(((lvl-&gt;lv)-&gt;vg)) &amp; 0x00000400U) ? 0x00000080U : 0))" data-ref="_M/deactivate_lv">deactivate_lv</a>(<a class="local col1 ref" href="#21cmd" title='cmd' data-ref="21cmd" data-ref-filename="21cmd">cmd</a>, <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>)) {</td></tr>
<tr><th id="353">353</th><td>					<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 354 , -1, &quot;Failed to deactivate LV %s&quot;, lvl-&gt;lv-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to deactivate LV %s"</q>,</td></tr>
<tr><th id="354">354</th><td>						  <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>);</td></tr>
<tr><th id="355">355</th><td>					<i>/*</i></td></tr>
<tr><th id="356">356</th><td><i>					 * We failed to deactivate.</i></td></tr>
<tr><th id="357">357</th><td><i>					 * Probably because this was a mirror log.</i></td></tr>
<tr><th id="358">358</th><td><i>					 * Don't try to lv_remove it.</i></td></tr>
<tr><th id="359">359</th><td><i>					 * Continue work on others.</i></td></tr>
<tr><th id="360">360</th><td><i>					 */</i></td></tr>
<tr><th id="361">361</th><td>					<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_del" title='dm_list_del' data-ref="dm_list_del" data-ref-filename="dm_list_del">dm_list_del</a>(&amp;<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::list" title='lv_list::list' data-ref="lv_list::list" data-ref-filename="lv_list..list">list</a>);</td></tr>
<tr><th id="362">362</th><td>				}</td></tr>
<tr><th id="363">363</th><td>			}</td></tr>
<tr><th id="364">364</th><td>		}</td></tr>
<tr><th id="365">365</th><td></td></tr>
<tr><th id="366">366</th><td>		<i>/* Remove remaining LVs */</i></td></tr>
<tr><th id="367">367</th><td>		<a class="macro" href="../include/libdevmapper.h.html#811" title="for (lvl = ((typeof(*lvl) *)((uintptr_t)(((&amp;lvs_changed))-&gt;n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)); &amp;lvl-&gt;list != ((&amp;lvs_changed)); lvl = ((typeof(*lvl) *)((uintptr_t)(lvl-&gt;list.n) - (uintptr_t)&amp;((typeof(*lvl) *) 0)-&gt;list)))" data-ref="_M/dm_list_iterate_items">dm_list_iterate_items</a>(<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>, &amp;<a class="local col0 ref" href="#178" title='lvs_changed' data-ref="40lvs_changed" data-ref-filename="40lvs_changed">lvs_changed</a>) {</td></tr>
<tr><th id="368">368</th><td>			<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 369 , 0, &quot;Removing LV %s from VG %s&quot;, lvl-&gt;lv-&gt;name, lvl-&gt;lv-&gt;vg-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Removing LV %s from VG %s"</q>, <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>,</td></tr>
<tr><th id="369">369</th><td>				    <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::vg" title='logical_volume::vg' data-ref="logical_volume::vg" data-ref-filename="logical_volume..vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="370">370</th><td>				<i>/* Skip LVs already removed by mirror code */</i></td></tr>
<tr><th id="371">371</th><td>				<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#find_lv_in_vg" title='find_lv_in_vg' data-ref="find_lv_in_vg" data-ref-filename="find_lv_in_vg">find_lv_in_vg</a>(<a class="local col2 ref" href="#22vg" title='vg' data-ref="22vg" data-ref-filename="22vg">vg</a>, <a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#logical_volume::name" title='logical_volume::name' data-ref="logical_volume::name" data-ref-filename="logical_volume..name">name</a>) &amp;&amp;</td></tr>
<tr><th id="372">372</th><td>				    !<a class="ref fn" href="../include/metadata-exported.h.html#lv_remove" title='lv_remove' data-ref="lv_remove" data-ref-filename="lv_remove">lv_remove</a>(<a class="local col8 ref" href="#28lvl" title='lvl' data-ref="28lvl" data-ref-filename="28lvl">lvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#lv_list::lv" title='lv_list::lv' data-ref="lv_list::lv" data-ref-filename="lv_list..lv">lv</a>))</td></tr>
<tr><th id="373">373</th><td>					<a class="macro" href="../include/log.h.html#81" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 373 , 0, &quot;&lt;backtrace&gt;&quot;); return 0; } while (0)" data-ref="_M/return_0">return_0</a>;</td></tr>
<tr><th id="374">374</th><td>		}</td></tr>
<tr><th id="375">375</th><td>	}</td></tr>
<tr><th id="376">376</th><td></td></tr>
<tr><th id="377">377</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="378">378</th><td>}</td></tr>
<tr><th id="379">379</th><td></td></tr>
<tr><th id="380">380</th><td><i  data-doc="_vgreduce_single">/* Or take pv_name instead? */</i></td></tr>
<tr><th id="381">381</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="_vgreduce_single" title='_vgreduce_single' data-type='int _vgreduce_single(struct cmd_context * cmd, struct volume_group * vg, struct physical_volume * pv, void * handle)' data-ref="_vgreduce_single" data-ref-filename="_vgreduce_single">_vgreduce_single</dfn>(<b>struct</b> <a class="type" href="../include/toolcontext.h.html#cmd_context" title='cmd_context' data-ref="cmd_context" data-ref-filename="cmd_context">cmd_context</a> *<dfn class="local col4 decl" id="44cmd" title='cmd' data-type='struct cmd_context *' data-ref="44cmd" data-ref-filename="44cmd">cmd</dfn>, <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col5 decl" id="45vg" title='vg' data-type='struct volume_group *' data-ref="45vg" data-ref-filename="45vg">vg</dfn>,</td></tr>
<tr><th id="382">382</th><td>			    <b>struct</b> <a class="type" href="../include/metadata-exported.h.html#physical_volume" title='physical_volume' data-ref="physical_volume" data-ref-filename="physical_volume">physical_volume</a> *<dfn class="local col6 decl" id="46pv" title='pv' data-type='struct physical_volume *' data-ref="46pv" data-ref-filename="46pv">pv</dfn>,</td></tr>
<tr><th id="383">383</th><td>			    <em>void</em> *<dfn class="local col7 decl" id="47handle" title='handle' data-type='void *' data-ref="47handle" data-ref-filename="47handle">handle</dfn> <b>__attribute</b>((unused)))</td></tr>
<tr><th id="384">384</th><td>{</td></tr>
<tr><th id="385">385</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#pv_list" title='pv_list' data-ref="pv_list" data-ref-filename="pv_list">pv_list</a> *<dfn class="local col8 decl" id="48pvl" title='pvl' data-type='struct pv_list *' data-ref="48pvl" data-ref-filename="48pvl">pvl</dfn>;</td></tr>
<tr><th id="386">386</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col9 decl" id="49orphan_vg" title='orphan_vg' data-type='struct volume_group *' data-ref="49orphan_vg" data-ref-filename="49orphan_vg">orphan_vg</dfn> = <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="387">387</th><td>	<em>int</em> <dfn class="local col0 decl" id="50r" title='r' data-type='int' data-ref="50r" data-ref-filename="50r">r</dfn> = <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="388">388</th><td>	<em>const</em> <em>char</em> *<dfn class="local col1 decl" id="51name" title='name' data-type='const char *' data-ref="51name" data-ref-filename="51name">name</dfn> = <a class="ref fn" href="../include/metadata-exported.h.html#pv_dev_name" title='pv_dev_name' data-ref="pv_dev_name" data-ref-filename="pv_dev_name">pv_dev_name</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>);</td></tr>
<tr><th id="389">389</th><td></td></tr>
<tr><th id="390">390</th><td>	<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#pv_pe_alloc_count" title='pv_pe_alloc_count' data-ref="pv_pe_alloc_count" data-ref-filename="pv_pe_alloc_count">pv_pe_alloc_count</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>)) {</td></tr>
<tr><th id="391">391</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 391 , -1, &quot;Physical volume \&quot;%s\&quot; still in use&quot;, name)" data-ref="_M/log_error">log_error</a>(<q>"Physical volume \"%s\" still in use"</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>);</td></tr>
<tr><th id="392">392</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="393">393</th><td>	}</td></tr>
<tr><th id="394">394</th><td></td></tr>
<tr><th id="395">395</th><td>	<b>if</b> (<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pv_count" title='volume_group::pv_count' data-ref="volume_group::pv_count" data-ref-filename="volume_group..pv_count">pv_count</a> == <var>1</var>) {</td></tr>
<tr><th id="396">396</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 397 , -1, &quot;Can&apos;t remove final physical volume \&quot;%s\&quot; from &quot; &quot;volume group \&quot;%s\&quot;&quot;, name, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Can't remove final physical volume \"%s\" from "</q></td></tr>
<tr><th id="397">397</th><td>			  <q>"volume group \"%s\""</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="398">398</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="399">399</th><td>	}</td></tr>
<tr><th id="400">400</th><td></td></tr>
<tr><th id="401">401</th><td>	<b>if</b> (!<a class="ref fn" href="../include/locking.h.html#lock_vol" title='lock_vol' data-ref="lock_vol" data-ref-filename="lock_vol">lock_vol</a>(<a class="local col4 ref" href="#44cmd" title='cmd' data-ref="44cmd" data-ref-filename="44cmd">cmd</a>, <a class="macro" href="../include/locking.h.html#100" title="&quot;#orphans&quot;" data-ref="_M/VG_ORPHANS">VG_ORPHANS</a>, <a class="macro" href="../include/locking.h.html#109" title="(0x00000000U | 0x00000004U | 0x00000020U)" data-ref="_M/LCK_VG_WRITE">LCK_VG_WRITE</a>)) {</td></tr>
<tr><th id="402">402</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 402 , -1, &quot;Can&apos;t get lock for orphan PVs&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Can't get lock for orphan PVs"</q>);</td></tr>
<tr><th id="403">403</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="404">404</th><td>	}</td></tr>
<tr><th id="405">405</th><td></td></tr>
<tr><th id="406">406</th><td>	<a class="local col8 ref" href="#48pvl" title='pvl' data-ref="48pvl" data-ref-filename="48pvl">pvl</a> = <a class="ref fn" href="../include/metadata-exported.h.html#find_pv_in_vg" title='find_pv_in_vg' data-ref="find_pv_in_vg" data-ref-filename="find_pv_in_vg">find_pv_in_vg</a>(<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>);</td></tr>
<tr><th id="407">407</th><td></td></tr>
<tr><th id="408">408</th><td>	<b>if</b> (!<a class="ref fn" href="../include/archiver.h.html#archive" title='archive' data-ref="archive" data-ref-filename="archive">archive</a>(<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>))</td></tr>
<tr><th id="409">409</th><td>		<a class="macro" href="../include/log.h.html#84" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 409 , 0, &quot;&lt;backtrace&gt;&quot;); goto bad; } while (0)" data-ref="_M/goto_bad">goto_bad</a>;</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td>	<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 411 , 0, &quot;Removing \&quot;%s\&quot; from volume group \&quot;%s\&quot;&quot;, name, vg-&gt;name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Removing \"%s\" from volume group \"%s\""</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="412">412</th><td></td></tr>
<tr><th id="413">413</th><td>	<b>if</b> (<a class="local col8 ref" href="#48pvl" title='pvl' data-ref="48pvl" data-ref-filename="48pvl">pvl</a>)</td></tr>
<tr><th id="414">414</th><td>		<a class="ref fn" href="../include/libdevmapper.h.html#dm_list_del" title='dm_list_del' data-ref="dm_list_del" data-ref-filename="dm_list_del">dm_list_del</a>(&amp;<a class="local col8 ref" href="#48pvl" title='pvl' data-ref="48pvl" data-ref-filename="48pvl">pvl</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#pv_list::list" title='pv_list::list' data-ref="pv_list::list" data-ref-filename="pv_list..list">list</a>);</td></tr>
<tr><th id="415">415</th><td></td></tr>
<tr><th id="416">416</th><td>	<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::vg_name" title='physical_volume::vg_name' data-ref="physical_volume::vg_name" data-ref-filename="physical_volume..vg_name">vg_name</a> = <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::fid" title='volume_group::fid' data-ref="volume_group::fid" data-ref-filename="volume_group..fid">fid</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#format_instance::fmt" title='format_instance::fmt' data-ref="format_instance::fmt" data-ref-filename="format_instance..fmt">fmt</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#format_type::orphan_vg_name" title='format_type::orphan_vg_name' data-ref="format_type::orphan_vg_name" data-ref-filename="format_type..orphan_vg_name">orphan_vg_name</a>;</td></tr>
<tr><th id="417">417</th><td>	<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::status" title='physical_volume::status' data-ref="physical_volume::status" data-ref-filename="physical_volume..status">status</a> = <a class="macro" href="../include/metadata-exported.h.html#47" title="0x00000008U" data-ref="_M/ALLOCATABLE_PV">ALLOCATABLE_PV</a>;</td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td>	<b>if</b> (!<a class="ref fn" href="../include/device.h.html#dev_get_size" title='dev_get_size' data-ref="dev_get_size" data-ref-filename="dev_get_size">dev_get_size</a>(<a class="ref fn" href="../include/metadata-exported.h.html#pv_dev" title='pv_dev' data-ref="pv_dev" data-ref-filename="pv_dev">pv_dev</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>), &amp;<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#physical_volume::size" title='physical_volume::size' data-ref="physical_volume::size" data-ref-filename="physical_volume..size">size</a>)) {</td></tr>
<tr><th id="420">420</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 420 , -1, &quot;%s: Couldn&apos;t get size.&quot;, pv_dev_name(pv))" data-ref="_M/log_error">log_error</a>(<q>"%s: Couldn't get size."</q>, <a class="ref fn" href="../include/metadata-exported.h.html#pv_dev_name" title='pv_dev_name' data-ref="pv_dev_name" data-ref-filename="pv_dev_name">pv_dev_name</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>));</td></tr>
<tr><th id="421">421</th><td>		<b>goto</b> <a class="lbl" href="#52bad" data-ref="52bad" data-ref-filename="52bad">bad</a>;</td></tr>
<tr><th id="422">422</th><td>	}</td></tr>
<tr><th id="423">423</th><td></td></tr>
<tr><th id="424">424</th><td>	<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pv_count" title='volume_group::pv_count' data-ref="volume_group::pv_count" data-ref-filename="volume_group..pv_count">pv_count</a>--;</td></tr>
<tr><th id="425">425</th><td>	<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::free_count" title='volume_group::free_count' data-ref="volume_group::free_count" data-ref-filename="volume_group..free_count">free_count</a> -= <a class="ref fn" href="../include/metadata-exported.h.html#pv_pe_count" title='pv_pe_count' data-ref="pv_pe_count" data-ref-filename="pv_pe_count">pv_pe_count</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>) - <a class="ref fn" href="../include/metadata-exported.h.html#pv_pe_alloc_count" title='pv_pe_alloc_count' data-ref="pv_pe_alloc_count" data-ref-filename="pv_pe_alloc_count">pv_pe_alloc_count</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>);</td></tr>
<tr><th id="426">426</th><td>	<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::extent_count" title='volume_group::extent_count' data-ref="volume_group::extent_count" data-ref-filename="volume_group..extent_count">extent_count</a> -= <a class="ref fn" href="../include/metadata-exported.h.html#pv_pe_count" title='pv_pe_count' data-ref="pv_pe_count" data-ref-filename="pv_pe_count">pv_pe_count</a>(<a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>);</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td>	<a class="local col9 ref" href="#49orphan_vg" title='orphan_vg' data-ref="49orphan_vg" data-ref-filename="49orphan_vg">orphan_vg</a> = <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_for_update" title='vg_read_for_update' data-ref="vg_read_for_update" data-ref-filename="vg_read_for_update">vg_read_for_update</a>(<a class="local col4 ref" href="#44cmd" title='cmd' data-ref="44cmd" data-ref-filename="44cmd">cmd</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::fid" title='volume_group::fid' data-ref="volume_group::fid" data-ref-filename="volume_group..fid">fid</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#format_instance::fmt" title='format_instance::fmt' data-ref="format_instance::fmt" data-ref-filename="format_instance..fmt">fmt</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#format_type::orphan_vg_name" title='format_type::orphan_vg_name' data-ref="format_type::orphan_vg_name" data-ref-filename="format_type..orphan_vg_name">orphan_vg_name</a>,</td></tr>
<tr><th id="429">429</th><td>				       <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <var>0</var>);</td></tr>
<tr><th id="430">430</th><td></td></tr>
<tr><th id="431">431</th><td>	<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col9 ref" href="#49orphan_vg" title='orphan_vg' data-ref="49orphan_vg" data-ref-filename="49orphan_vg">orphan_vg</a>))</td></tr>
<tr><th id="432">432</th><td>		<b>goto</b> <a class="lbl" href="#52bad" data-ref="52bad" data-ref-filename="52bad">bad</a>;</td></tr>
<tr><th id="433">433</th><td></td></tr>
<tr><th id="434">434</th><td>	<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_split_mdas" title='vg_split_mdas' data-ref="vg_split_mdas" data-ref-filename="vg_split_mdas">vg_split_mdas</a>(<a class="local col4 ref" href="#44cmd" title='cmd' data-ref="44cmd" data-ref-filename="44cmd">cmd</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>, <a class="local col9 ref" href="#49orphan_vg" title='orphan_vg' data-ref="49orphan_vg" data-ref-filename="49orphan_vg">orphan_vg</a>) || !<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::pv_count" title='volume_group::pv_count' data-ref="volume_group::pv_count" data-ref-filename="volume_group..pv_count">pv_count</a>) {</td></tr>
<tr><th id="435">435</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 436 , -1, &quot;Cannot remove final metadata area on \&quot;%s\&quot; from \&quot;%s\&quot;&quot;, name, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Cannot remove final metadata area on \"%s\" from \"%s\""</q>,</td></tr>
<tr><th id="436">436</th><td>			  <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="437">437</th><td>		<b>goto</b> <a class="lbl" href="#52bad" data-ref="52bad" data-ref-filename="52bad">bad</a>;</td></tr>
<tr><th id="438">438</th><td>	}</td></tr>
<tr><th id="439">439</th><td></td></tr>
<tr><th id="440">440</th><td>	<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_write" title='vg_write' data-ref="vg_write" data-ref-filename="vg_write">vg_write</a>(<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>) || !<a class="ref fn" href="../include/metadata-exported.h.html#vg_commit" title='vg_commit' data-ref="vg_commit" data-ref-filename="vg_commit">vg_commit</a>(<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>)) {</td></tr>
<tr><th id="441">441</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 442 , -1, &quot;Removal of physical volume \&quot;%s\&quot; from &quot; &quot;\&quot;%s\&quot; failed&quot;, name, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Removal of physical volume \"%s\" from "</q></td></tr>
<tr><th id="442">442</th><td>			  <q>"\"%s\" failed"</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="443">443</th><td>		<b>goto</b> <a class="lbl" href="#52bad" data-ref="52bad" data-ref-filename="52bad">bad</a>;</td></tr>
<tr><th id="444">444</th><td>	}</td></tr>
<tr><th id="445">445</th><td></td></tr>
<tr><th id="446">446</th><td>	<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#pv_write" title='pv_write' data-ref="pv_write" data-ref-filename="pv_write">pv_write</a>(<a class="local col4 ref" href="#44cmd" title='cmd' data-ref="44cmd" data-ref-filename="44cmd">cmd</a>, <a class="local col6 ref" href="#46pv" title='pv' data-ref="46pv" data-ref-filename="46pv">pv</a>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/common_int_const.h.html#50" title="-1L" data-ref="_M/INT64_C">INT64_C</a>(-<var>1</var>))) {</td></tr>
<tr><th id="447">447</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 449 , -1, &quot;Failed to clear metadata from physical &quot; &quot;volume \&quot;%s\&quot; &quot; &quot;after removal from \&quot;%s\&quot;&quot;, name, vg-&gt;name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to clear metadata from physical "</q></td></tr>
<tr><th id="448">448</th><td>			  <q>"volume \"%s\" "</q></td></tr>
<tr><th id="449">449</th><td>			  <q>"after removal from \"%s\""</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="450">450</th><td>		<b>goto</b> <a class="lbl" href="#52bad" data-ref="52bad" data-ref-filename="52bad">bad</a>;</td></tr>
<tr><th id="451">451</th><td>	}</td></tr>
<tr><th id="452">452</th><td></td></tr>
<tr><th id="453">453</th><td>	<a class="ref fn" href="../include/archiver.h.html#backup" title='backup' data-ref="backup" data-ref-filename="backup">backup</a>(<a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>);</td></tr>
<tr><th id="454">454</th><td></td></tr>
<tr><th id="455">455</th><td>	<a class="macro" href="../include/log.h.html#69" title="print_log(4, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 455 , 0, &quot;Removed \&quot;%s\&quot; from volume group \&quot;%s\&quot;&quot;, name, vg-&gt;name)" data-ref="_M/log_print">log_print</a>(<q>"Removed \"%s\" from volume group \"%s\""</q>, <a class="local col1 ref" href="#51name" title='name' data-ref="51name" data-ref-filename="51name">name</a>, <a class="local col5 ref" href="#45vg" title='vg' data-ref="45vg" data-ref-filename="45vg">vg</a>-&gt;<a class="ref field" href="../include/metadata-exported.h.html#volume_group::name" title='volume_group::name' data-ref="volume_group::name" data-ref-filename="volume_group..name">name</a>);</td></tr>
<tr><th id="456">456</th><td>	<a class="local col0 ref" href="#50r" title='r' data-ref="50r" data-ref-filename="50r">r</a> = <a class="macro" href="../include/errors.h.html#21" title="1" data-ref="_M/ECMD_PROCESSED">ECMD_PROCESSED</a>;</td></tr>
<tr><th id="457">457</th><td><dfn class="lbl" id="52bad" data-ref="52bad" data-ref-filename="52bad">bad</dfn>:</td></tr>
<tr><th id="458">458</th><td>	<a class="macro" href="../include/locking.h.html#129" title="do { lock_vol(cmd, &quot;#orphans&quot;, (0x00000000U | 0x00000006U)); vg_release(orphan_vg); } while (0)" data-ref="_M/unlock_and_release_vg">unlock_and_release_vg</a>(<a class="local col4 ref" href="#44cmd" title='cmd' data-ref="44cmd" data-ref-filename="44cmd">cmd</a>, <a class="local col9 ref" href="#49orphan_vg" title='orphan_vg' data-ref="49orphan_vg" data-ref-filename="49orphan_vg">orphan_vg</a>, <a class="macro" href="../include/locking.h.html#100" title="&quot;#orphans&quot;" data-ref="_M/VG_ORPHANS">VG_ORPHANS</a>);</td></tr>
<tr><th id="459">459</th><td>	<b>return</b> <a class="local col0 ref" href="#50r" title='r' data-ref="50r" data-ref-filename="50r">r</a>;</td></tr>
<tr><th id="460">460</th><td>}</td></tr>
<tr><th id="461">461</th><td></td></tr>
<tr><th id="462">462</th><td><em>int</em> <dfn class="decl def fn" id="vgreduce" title='vgreduce' data-ref="vgreduce" data-ref-filename="vgreduce">vgreduce</dfn>(<b>struct</b> <a class="type" href="../include/toolcontext.h.html#cmd_context" title='cmd_context' data-ref="cmd_context" data-ref-filename="cmd_context">cmd_context</a> *<dfn class="local col3 decl" id="53cmd" title='cmd' data-type='struct cmd_context *' data-ref="53cmd" data-ref-filename="53cmd">cmd</dfn>, <em>int</em> <dfn class="local col4 decl" id="54argc" title='argc' data-type='int' data-ref="54argc" data-ref-filename="54argc">argc</dfn>, <em>char</em> **<dfn class="local col5 decl" id="55argv" title='argv' data-type='char **' data-ref="55argv" data-ref-filename="55argv">argv</dfn>)</td></tr>
<tr><th id="463">463</th><td>{</td></tr>
<tr><th id="464">464</th><td>	<b>struct</b> <a class="type" href="../include/metadata-exported.h.html#volume_group" title='volume_group' data-ref="volume_group" data-ref-filename="volume_group">volume_group</a> *<dfn class="local col6 decl" id="56vg" title='vg' data-type='struct volume_group *' data-ref="56vg" data-ref-filename="56vg">vg</dfn>;</td></tr>
<tr><th id="465">465</th><td>	<em>char</em> *<dfn class="local col7 decl" id="57vg_name" title='vg_name' data-type='char *' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</dfn>;</td></tr>
<tr><th id="466">466</th><td>	<em>int</em> <dfn class="local col8 decl" id="58ret" title='ret' data-type='int' data-ref="58ret" data-ref-filename="58ret">ret</dfn> = <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="467">467</th><td>	<em>int</em> <dfn class="local col9 decl" id="59fixed" title='fixed' data-type='int' data-ref="59fixed" data-ref-filename="59fixed">fixed</dfn> = <var>1</var>;</td></tr>
<tr><th id="468">468</th><td>	<em>int</em> <dfn class="local col0 decl" id="60repairing" title='repairing' data-type='int' data-ref="60repairing" data-ref-filename="60repairing">repairing</dfn> = <a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#40" title='removemissing_ARG' data-ref="removemissing_ARG" data-ref-filename="removemissing_ARG">removemissing_ARG</a>);</td></tr>
<tr><th id="469">469</th><td>	<em>int</em> <dfn class="local col1 decl" id="61saved_ignore_suspended_devices" title='saved_ignore_suspended_devices' data-type='int' data-ref="61saved_ignore_suspended_devices" data-ref-filename="61saved_ignore_suspended_devices">saved_ignore_suspended_devices</dfn> = <a class="ref fn" href="../include/lvm-globals.h.html#ignore_suspended_devices" title='ignore_suspended_devices' data-ref="ignore_suspended_devices" data-ref-filename="ignore_suspended_devices">ignore_suspended_devices</a>();</td></tr>
<tr><th id="470">470</th><td></td></tr>
<tr><th id="471">471</th><td>	<b>if</b> (!<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a> &amp;&amp; !<a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="472">472</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 473 , -1, &quot;Please give volume group name and &quot; &quot;physical volume paths&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Please give volume group name and "</q></td></tr>
<tr><th id="473">473</th><td>			  <q>"physical volume paths"</q>);</td></tr>
<tr><th id="474">474</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="475">475</th><td>	}</td></tr>
<tr><th id="476">476</th><td>	</td></tr>
<tr><th id="477">477</th><td>	<b>if</b> (!<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a> &amp;&amp; <a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="478">478</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 478 , -1, &quot;Please give volume group name&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Please give volume group name"</q>);</td></tr>
<tr><th id="479">479</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="480">480</th><td>	}</td></tr>
<tr><th id="481">481</th><td></td></tr>
<tr><th id="482">482</th><td>	<b>if</b> (<a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#50" title='mirrorsonly_ARG' data-ref="mirrorsonly_ARG" data-ref-filename="mirrorsonly_ARG">mirrorsonly_ARG</a>) &amp;&amp; !<a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="483">483</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 483 , -1, &quot;--mirrorsonly requires --removemissing&quot;)" data-ref="_M/log_error">log_error</a>(<q>"--mirrorsonly requires --removemissing"</q>);</td></tr>
<tr><th id="484">484</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="485">485</th><td>	}</td></tr>
<tr><th id="486">486</th><td></td></tr>
<tr><th id="487">487</th><td>	<b>if</b> (<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a> == <var>1</var> &amp;&amp; !<a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#78" title='all_ARG' data-ref="all_ARG" data-ref-filename="all_ARG">all_ARG</a>) &amp;&amp; !<a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="488">488</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 488 , -1, &quot;Please enter physical volume paths or option -a&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Please enter physical volume paths or option -a"</q>);</td></tr>
<tr><th id="489">489</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="490">490</th><td>	}</td></tr>
<tr><th id="491">491</th><td></td></tr>
<tr><th id="492">492</th><td>	<b>if</b> (<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a> &gt; <var>1</var> &amp;&amp; <a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#78" title='all_ARG' data-ref="all_ARG" data-ref-filename="all_ARG">all_ARG</a>)) {</td></tr>
<tr><th id="493">493</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 494 , -1, &quot;Option -a and physical volume paths mutually &quot; &quot;exclusive&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Option -a and physical volume paths mutually "</q></td></tr>
<tr><th id="494">494</th><td>			  <q>"exclusive"</q>);</td></tr>
<tr><th id="495">495</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="496">496</th><td>	}</td></tr>
<tr><th id="497">497</th><td></td></tr>
<tr><th id="498">498</th><td>	<b>if</b> (<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a> &gt; <var>1</var> &amp;&amp; <a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="499">499</th><td>		<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 499 , -1, &quot;Please only specify the volume group&quot;)" data-ref="_M/log_error">log_error</a>(<q>"Please only specify the volume group"</q>);</td></tr>
<tr><th id="500">500</th><td>		<b>return</b> <a class="macro" href="../include/errors.h.html#23" title="3" data-ref="_M/EINVALID_CMD_LINE">EINVALID_CMD_LINE</a>;</td></tr>
<tr><th id="501">501</th><td>	}</td></tr>
<tr><th id="502">502</th><td></td></tr>
<tr><th id="503">503</th><td>	<a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a> = <a class="ref fn" href="toollib.h.html#skip_dev_dir" title='skip_dev_dir' data-ref="skip_dev_dir" data-ref-filename="skip_dev_dir">skip_dev_dir</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col5 ref" href="#55argv" title='argv' data-ref="55argv" data-ref-filename="55argv">argv</a>[<var>0</var>], <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="504">504</th><td>	<a class="local col5 ref" href="#55argv" title='argv' data-ref="55argv" data-ref-filename="55argv">argv</a>++;</td></tr>
<tr><th id="505">505</th><td>	<a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a>--;</td></tr>
<tr><th id="506">506</th><td></td></tr>
<tr><th id="507">507</th><td>	<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 507 , 0, &quot;Finding volume group \&quot;%s\&quot;&quot;, vg_name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Finding volume group \"%s\""</q>, <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="508">508</th><td></td></tr>
<tr><th id="509">509</th><td>	<b>if</b> (<a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="510">510</th><td>		<a class="ref fn" href="../include/lvm-globals.h.html#init_ignore_suspended_devices" title='init_ignore_suspended_devices' data-ref="init_ignore_suspended_devices" data-ref-filename="init_ignore_suspended_devices">init_ignore_suspended_devices</a>(<var>1</var>);</td></tr>
<tr><th id="511">511</th><td>		<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>-&gt;<a class="ref field" href="../include/toolcontext.h.html#cmd_context::handles_missing_pvs" title='cmd_context::handles_missing_pvs' data-ref="cmd_context::handles_missing_pvs" data-ref-filename="cmd_context..handles_missing_pvs">handles_missing_pvs</a> = <var>1</var>;</td></tr>
<tr><th id="512">512</th><td>	}</td></tr>
<tr><th id="513">513</th><td></td></tr>
<tr><th id="514">514</th><td>	<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a> = <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_for_update" title='vg_read_for_update' data-ref="vg_read_for_update" data-ref-filename="vg_read_for_update">vg_read_for_update</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../include/metadata-exported.h.html#98" title="0x00020000U" data-ref="_M/READ_ALLOW_EXPORTED">READ_ALLOW_EXPORTED</a>);</td></tr>
<tr><th id="515">515</th><td>	<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) == <a class="macro" href="../include/metadata-exported.h.html#112" title="0x00000080U" data-ref="_M/FAILED_ALLOCATION">FAILED_ALLOCATION</a> ||</td></tr>
<tr><th id="516">516</th><td>	    <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) == <a class="macro" href="../include/metadata-exported.h.html#107" title="0x00000004U" data-ref="_M/FAILED_NOTFOUND">FAILED_NOTFOUND</a>)</td></tr>
<tr><th id="517">517</th><td>		<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 517 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="518">518</th><td></td></tr>
<tr><th id="519">519</th><td>	<i>/* FIXME We want to allow read-only VGs to be changed here? */</i></td></tr>
<tr><th id="520">520</th><td>	<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) &amp;&amp; <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) != <a class="macro" href="../include/metadata-exported.h.html#108" title="0x00000008U" data-ref="_M/FAILED_READ_ONLY">FAILED_READ_ONLY</a></td></tr>
<tr><th id="521">521</th><td>	    &amp;&amp; !<a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#40" title='removemissing_ARG' data-ref="removemissing_ARG" data-ref-filename="removemissing_ARG">removemissing_ARG</a>))</td></tr>
<tr><th id="522">522</th><td>		<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 522 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="523">523</th><td></td></tr>
<tr><th id="524">524</th><td>	<b>if</b> (<a class="local col0 ref" href="#60repairing" title='repairing' data-ref="60repairing" data-ref-filename="60repairing">repairing</a>) {</td></tr>
<tr><th id="525">525</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) &amp;&amp; !<a class="ref fn" href="../include/metadata-exported.h.html#vg_missing_pv_count" title='vg_missing_pv_count' data-ref="vg_missing_pv_count" data-ref-filename="vg_missing_pv_count">vg_missing_pv_count</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>)) {</td></tr>
<tr><th id="526">526</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 527 , -1, &quot;Volume group \&quot;%s\&quot; is already consistent&quot;, vg_name)" data-ref="_M/log_error">log_error</a>(<q>"Volume group \"%s\" is already consistent"</q>,</td></tr>
<tr><th id="527">527</th><td>				  <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="528">528</th><td>			<a class="local col8 ref" href="#58ret" title='ret' data-ref="58ret" data-ref-filename="58ret">ret</a> = <a class="macro" href="../include/errors.h.html#21" title="1" data-ref="_M/ECMD_PROCESSED">ECMD_PROCESSED</a>;</td></tr>
<tr><th id="529">529</th><td>			<b>goto</b> <a class="lbl" href="#62out" data-ref="62out" data-ref-filename="62out">out</a>;</td></tr>
<tr><th id="530">530</th><td>		}</td></tr>
<tr><th id="531">531</th><td></td></tr>
<tr><th id="532">532</th><td>		<a class="ref fn" href="../include/metadata-exported.h.html#vg_release" title='vg_release' data-ref="vg_release" data-ref-filename="vg_release">vg_release</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>);</td></tr>
<tr><th id="533">533</th><td>		<a class="macro" href="../include/log.h.html#68" title="print_log(5, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 533 , 0, &quot;Trying to open VG %s for recovery...&quot;, vg_name)" data-ref="_M/log_verbose">log_verbose</a>(<q>"Trying to open VG %s for recovery..."</q>, <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="534">534</th><td></td></tr>
<tr><th id="535">535</th><td>		<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a> = <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_for_update" title='vg_read_for_update' data-ref="vg_read_for_update" data-ref-filename="vg_read_for_update">vg_read_for_update</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="536">536</th><td>					<a class="macro" href="../include/metadata-exported.h.html#97" title="0x00010000U" data-ref="_M/READ_ALLOW_INCONSISTENT">READ_ALLOW_INCONSISTENT</a></td></tr>
<tr><th id="537">537</th><td>					| <a class="macro" href="../include/metadata-exported.h.html#98" title="0x00020000U" data-ref="_M/READ_ALLOW_EXPORTED">READ_ALLOW_EXPORTED</a>);</td></tr>
<tr><th id="538">538</th><td></td></tr>
<tr><th id="539">539</th><td>		<b>if</b> (<a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) &amp;&amp; <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) != <a class="macro" href="../include/metadata-exported.h.html#108" title="0x00000008U" data-ref="_M/FAILED_READ_ONLY">FAILED_READ_ONLY</a></td></tr>
<tr><th id="540">540</th><td>		    &amp;&amp; <a class="ref fn" href="../include/metadata-exported.h.html#vg_read_error" title='vg_read_error' data-ref="vg_read_error" data-ref-filename="vg_read_error">vg_read_error</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) != <a class="macro" href="../include/metadata-exported.h.html#105" title="0x00000001U" data-ref="_M/FAILED_INCONSISTENT">FAILED_INCONSISTENT</a>)</td></tr>
<tr><th id="541">541</th><td>			<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 541 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="542">542</th><td></td></tr>
<tr><th id="543">543</th><td>		<b>if</b> (!<a class="ref fn" href="../include/archiver.h.html#archive" title='archive' data-ref="archive" data-ref-filename="archive">archive</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>))</td></tr>
<tr><th id="544">544</th><td>			<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 544 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="545">545</th><td></td></tr>
<tr><th id="546">546</th><td>		<b>if</b> (<a class="ref fn" href="tools.h.html#arg_count" title='arg_count' data-ref="arg_count" data-ref-filename="arg_count">arg_count</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="enum" href="args.h.html#92" title='force_ARG' data-ref="force_ARG" data-ref-filename="force_ARG">force_ARG</a>)) {</td></tr>
<tr><th id="547">547</th><td>			<b>if</b> (!<a class="tu ref fn" href="#_make_vg_consistent" title='_make_vg_consistent' data-use='c' data-ref="_make_vg_consistent" data-ref-filename="_make_vg_consistent">_make_vg_consistent</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>))</td></tr>
<tr><th id="548">548</th><td>				<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 548 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="549">549</th><td>		} <b>else</b></td></tr>
<tr><th id="550">550</th><td>			<a class="local col9 ref" href="#59fixed" title='fixed' data-ref="59fixed" data-ref-filename="59fixed">fixed</a> = <a class="tu ref fn" href="#_consolidate_vg" title='_consolidate_vg' data-use='c' data-ref="_consolidate_vg" data-ref-filename="_consolidate_vg">_consolidate_vg</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>);</td></tr>
<tr><th id="551">551</th><td></td></tr>
<tr><th id="552">552</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_write" title='vg_write' data-ref="vg_write" data-ref-filename="vg_write">vg_write</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>) || !<a class="ref fn" href="../include/metadata-exported.h.html#vg_commit" title='vg_commit' data-ref="vg_commit" data-ref-filename="vg_commit">vg_commit</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>)) {</td></tr>
<tr><th id="553">553</th><td>			<a class="macro" href="../include/log.h.html#70" title="print_log(3, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 554 , -1, &quot;Failed to write out a consistent VG for %s&quot;, vg_name)" data-ref="_M/log_error">log_error</a>(<q>"Failed to write out a consistent VG for %s"</q>,</td></tr>
<tr><th id="554">554</th><td>				  <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="555">555</th><td>			<b>goto</b> <a class="lbl" href="#62out" data-ref="62out" data-ref-filename="62out">out</a>;</td></tr>
<tr><th id="556">556</th><td>		}</td></tr>
<tr><th id="557">557</th><td>		<a class="ref fn" href="../include/archiver.h.html#backup" title='backup' data-ref="backup" data-ref-filename="backup">backup</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>);</td></tr>
<tr><th id="558">558</th><td></td></tr>
<tr><th id="559">559</th><td>		<b>if</b> (<a class="local col9 ref" href="#59fixed" title='fixed' data-ref="59fixed" data-ref-filename="59fixed">fixed</a>) {</td></tr>
<tr><th id="560">560</th><td>			<a class="macro" href="../include/log.h.html#69" title="print_log(4, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 561 , 0, &quot;Wrote out consistent volume group %s&quot;, vg_name)" data-ref="_M/log_print">log_print</a>(<q>"Wrote out consistent volume group %s"</q>,</td></tr>
<tr><th id="561">561</th><td>				  <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="562">562</th><td>			<a class="local col8 ref" href="#58ret" title='ret' data-ref="58ret" data-ref-filename="58ret">ret</a> = <a class="macro" href="../include/errors.h.html#21" title="1" data-ref="_M/ECMD_PROCESSED">ECMD_PROCESSED</a>;</td></tr>
<tr><th id="563">563</th><td>		} <b>else</b></td></tr>
<tr><th id="564">564</th><td>			<a class="local col8 ref" href="#58ret" title='ret' data-ref="58ret" data-ref-filename="58ret">ret</a> = <a class="macro" href="../include/errors.h.html#24" title="5" data-ref="_M/ECMD_FAILED">ECMD_FAILED</a>;</td></tr>
<tr><th id="565">565</th><td></td></tr>
<tr><th id="566">566</th><td>	} <b>else</b> {</td></tr>
<tr><th id="567">567</th><td>		<b>if</b> (!<a class="ref fn" href="../include/metadata-exported.h.html#vg_check_status" title='vg_check_status' data-ref="vg_check_status" data-ref-filename="vg_check_status">vg_check_status</a>(<a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>, <a class="macro" href="../include/metadata-exported.h.html#43" title="0x00000002U" data-ref="_M/EXPORTED_VG">EXPORTED_VG</a> | <a class="macro" href="../include/metadata-exported.h.html#75" title="0x00000200U" data-ref="_M/LVM_WRITE">LVM_WRITE</a> | <a class="macro" href="../include/metadata-exported.h.html#44" title="0x00000004U" data-ref="_M/RESIZEABLE_VG">RESIZEABLE_VG</a>))</td></tr>
<tr><th id="568">568</th><td>			<a class="macro" href="../include/log.h.html#83" title="do { print_log(7, &quot;/___NETBSD_SRC___/objdir.amd64/external/gpl2/lvm2/sbin/lvm/../../../../../../external/gpl2/lvm2/dist/tools/vgreduce.c&quot;, 568 , 0, &quot;&lt;backtrace&gt;&quot;); goto out; } while (0)" data-ref="_M/goto_out">goto_out</a>;</td></tr>
<tr><th id="569">569</th><td></td></tr>
<tr><th id="570">570</th><td>		<i>/* FIXME: Pass private struct through to all these functions */</i></td></tr>
<tr><th id="571">571</th><td>		<i>/* and update in batch here? */</i></td></tr>
<tr><th id="572">572</th><td>		<a class="local col8 ref" href="#58ret" title='ret' data-ref="58ret" data-ref-filename="58ret">ret</a> = <a class="ref fn" href="toollib.h.html#process_each_pv" title='process_each_pv' data-ref="process_each_pv" data-ref-filename="process_each_pv">process_each_pv</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col4 ref" href="#54argc" title='argc' data-ref="54argc" data-ref-filename="54argc">argc</a>, <a class="local col5 ref" href="#55argv" title='argv' data-ref="55argv" data-ref-filename="55argv">argv</a>, <a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>, <a class="macro" href="../include/metadata-exported.h.html#102" title="0x00100000U" data-ref="_M/READ_FOR_UPDATE">READ_FOR_UPDATE</a>, <var>0</var>, <a class="macro" href="../../../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="573">573</th><td>				      <a class="tu ref fn" href="#_vgreduce_single" title='_vgreduce_single' data-use='r' data-ref="_vgreduce_single" data-ref-filename="_vgreduce_single">_vgreduce_single</a>);</td></tr>
<tr><th id="574">574</th><td></td></tr>
<tr><th id="575">575</th><td>	}</td></tr>
<tr><th id="576">576</th><td><dfn class="lbl" id="62out" data-ref="62out" data-ref-filename="62out">out</dfn>:</td></tr>
<tr><th id="577">577</th><td>	<a class="ref fn" href="../include/lvm-globals.h.html#init_ignore_suspended_devices" title='init_ignore_suspended_devices' data-ref="init_ignore_suspended_devices" data-ref-filename="init_ignore_suspended_devices">init_ignore_suspended_devices</a>(<a class="local col1 ref" href="#61saved_ignore_suspended_devices" title='saved_ignore_suspended_devices' data-ref="61saved_ignore_suspended_devices" data-ref-filename="61saved_ignore_suspended_devices">saved_ignore_suspended_devices</a>);</td></tr>
<tr><th id="578">578</th><td>	<a class="macro" href="../include/locking.h.html#129" title="do { lock_vol(cmd, vg_name, (0x00000000U | 0x00000006U)); vg_release(vg); } while (0)" data-ref="_M/unlock_and_release_vg">unlock_and_release_vg</a>(<a class="local col3 ref" href="#53cmd" title='cmd' data-ref="53cmd" data-ref-filename="53cmd">cmd</a>, <a class="local col6 ref" href="#56vg" title='vg' data-ref="56vg" data-ref-filename="56vg">vg</a>, <a class="local col7 ref" href="#57vg_name" title='vg_name' data-ref="57vg_name" data-ref-filename="57vg_name">vg_name</a>);</td></tr>
<tr><th id="579">579</th><td></td></tr>
<tr><th id="580">580</th><td>	<b>return</b> <a class="local col8 ref" href="#58ret" title='ret' data-ref="58ret" data-ref-filename="58ret">ret</a>;</td></tr>
<tr><th id="581">581</th><td></td></tr>
<tr><th id="582">582</th><td><i>/******* FIXME</i></td></tr>
<tr><th id="583">583</th><td><i>	log_error ("no empty physical volumes found in volume group \"%s\"", vg_name);</i></td></tr>
<tr><th id="584">584</th><td><i></i></td></tr>
<tr><th id="585">585</th><td><i>	log_verbose</i></td></tr>
<tr><th id="586">586</th><td><i>	    ("volume group \"%s\" will be reduced by %d physical volume%s",</i></td></tr>
<tr><th id="587">587</th><td><i>	     vg_name, np, np &gt; 1 ? "s" : "");</i></td></tr>
<tr><th id="588">588</th><td><i>	log_verbose ("reducing volume group \"%s\" by physical volume \"%s\"",</i></td></tr>
<tr><th id="589">589</th><td><i>		     vg_name, pv_names[p]);</i></td></tr>
<tr><th id="590">590</th><td><i></i></td></tr>
<tr><th id="591">591</th><td><i>	log_print</i></td></tr>
<tr><th id="592">592</th><td><i>	    ("volume group \"%s\" %ssuccessfully reduced by physical volume%s:",</i></td></tr>
<tr><th id="593">593</th><td><i>	     vg_name, error &gt; 0 ? "NOT " : "", p &gt; 1 ? "s" : "");</i></td></tr>
<tr><th id="594">594</th><td><i>		log_print("%s", pv_this[p]-&gt;pv_name);</i></td></tr>
<tr><th id="595">595</th><td><i>********/</i></td></tr>
<tr><th id="596">596</th><td></td></tr>
<tr><th id="597">597</th><td>}</td></tr>
<tr><th id="598">598</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
