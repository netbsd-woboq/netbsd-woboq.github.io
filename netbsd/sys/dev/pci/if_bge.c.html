<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>if_bge.c source code [netbsd/sys/dev/pci/if_bge.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="bge_load_rx_thresh,bge_product,bge_revision "/>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/sys/dev/pci/if_bge.c'; var root_path = '../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>netbsd</a>/<a href='../..'>sys</a>/<a href='..'>dev</a>/<a href='./'>pci</a>/<a href='if_bge.c.html'>if_bge.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: if_bge.c,v 1.335 2019/07/09 08:46:58 msaitoh Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright (c) 2001 Wind River Systems</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (c) 1997, 1998, 1999, 2001</i></td></tr>
<tr><th id="6">6</th><td><i> *	Bill Paul &lt;wpaul@windriver.com&gt;.  All rights reserved.</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * Redistribution and use in source and binary forms, with or without</i></td></tr>
<tr><th id="9">9</th><td><i> * modification, are permitted provided that the following conditions</i></td></tr>
<tr><th id="10">10</th><td><i> * are met:</i></td></tr>
<tr><th id="11">11</th><td><i> * 1. Redistributions of source code must retain the above copyright</i></td></tr>
<tr><th id="12">12</th><td><i> *    notice, this list of conditions and the following disclaimer.</i></td></tr>
<tr><th id="13">13</th><td><i> * 2. Redistributions in binary form must reproduce the above copyright</i></td></tr>
<tr><th id="14">14</th><td><i> *    notice, this list of conditions and the following disclaimer in the</i></td></tr>
<tr><th id="15">15</th><td><i> *    documentation and/or other materials provided with the distribution.</i></td></tr>
<tr><th id="16">16</th><td><i> * 3. All advertising materials mentioning features or use of this software</i></td></tr>
<tr><th id="17">17</th><td><i> *    must display the following acknowledgement:</i></td></tr>
<tr><th id="18">18</th><td><i> *	This product includes software developed by Bill Paul.</i></td></tr>
<tr><th id="19">19</th><td><i> * 4. Neither the name of the author nor the names of any co-contributors</i></td></tr>
<tr><th id="20">20</th><td><i> *    may be used to endorse or promote products derived from this software</i></td></tr>
<tr><th id="21">21</th><td><i> *    without specific prior written permission.</i></td></tr>
<tr><th id="22">22</th><td><i> *</i></td></tr>
<tr><th id="23">23</th><td><i> * THIS SOFTWARE IS PROVIDED BY Bill Paul AND CONTRIBUTORS ``AS IS'' AND</i></td></tr>
<tr><th id="24">24</th><td><i> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</i></td></tr>
<tr><th id="25">25</th><td><i> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</i></td></tr>
<tr><th id="26">26</th><td><i> * ARE DISCLAIMED.  IN NO EVENT SHALL Bill Paul OR THE VOICES IN HIS HEAD</i></td></tr>
<tr><th id="27">27</th><td><i> * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</i></td></tr>
<tr><th id="28">28</th><td><i> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</i></td></tr>
<tr><th id="29">29</th><td><i> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</i></td></tr>
<tr><th id="30">30</th><td><i> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</i></td></tr>
<tr><th id="31">31</th><td><i> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</i></td></tr>
<tr><th id="32">32</th><td><i> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF</i></td></tr>
<tr><th id="33">33</th><td><i> * THE POSSIBILITY OF SUCH DAMAGE.</i></td></tr>
<tr><th id="34">34</th><td><i> *</i></td></tr>
<tr><th id="35">35</th><td><i> * $FreeBSD: if_bge.c,v 1.13 2002/04/04 06:01:31 wpaul Exp $</i></td></tr>
<tr><th id="36">36</th><td><i> */</i></td></tr>
<tr><th id="37">37</th><td></td></tr>
<tr><th id="38">38</th><td><i>/*</i></td></tr>
<tr><th id="39">39</th><td><i> * Broadcom BCM570x family gigabit ethernet driver for NetBSD.</i></td></tr>
<tr><th id="40">40</th><td><i> *</i></td></tr>
<tr><th id="41">41</th><td><i> * NetBSD version by:</i></td></tr>
<tr><th id="42">42</th><td><i> *</i></td></tr>
<tr><th id="43">43</th><td><i> *	Frank van der Linden &lt;fvdl@wasabisystems.com&gt;</i></td></tr>
<tr><th id="44">44</th><td><i> *	Jason Thorpe &lt;thorpej@wasabisystems.com&gt;</i></td></tr>
<tr><th id="45">45</th><td><i> *	Jonathan Stone &lt;jonathan@dsg.stanford.edu&gt;</i></td></tr>
<tr><th id="46">46</th><td><i> *</i></td></tr>
<tr><th id="47">47</th><td><i> * Originally written for FreeBSD by Bill Paul &lt;wpaul@windriver.com&gt;</i></td></tr>
<tr><th id="48">48</th><td><i> * Senior Engineer, Wind River Systems</i></td></tr>
<tr><th id="49">49</th><td><i> */</i></td></tr>
<tr><th id="50">50</th><td></td></tr>
<tr><th id="51">51</th><td><i>/*</i></td></tr>
<tr><th id="52">52</th><td><i> * The Broadcom BCM5700 is based on technology originally developed by</i></td></tr>
<tr><th id="53">53</th><td><i> * Alteon Networks as part of the Tigon I and Tigon II gigabit ethernet</i></td></tr>
<tr><th id="54">54</th><td><i> * MAC chips. The BCM5700, sometimes referred to as the Tigon III, has</i></td></tr>
<tr><th id="55">55</th><td><i> * two on-board MIPS R4000 CPUs and can have as much as 16MB of external</i></td></tr>
<tr><th id="56">56</th><td><i> * SSRAM. The BCM5700 supports TCP, UDP and IP checksum offload, jumbo</i></td></tr>
<tr><th id="57">57</th><td><i> * frames, highly configurable RX filtering, and 16 RX and TX queues</i></td></tr>
<tr><th id="58">58</th><td><i> * (which, along with RX filter rules, can be used for QOS applications).</i></td></tr>
<tr><th id="59">59</th><td><i> * Other features, such as TCP segmentation, may be available as part</i></td></tr>
<tr><th id="60">60</th><td><i> * of value-added firmware updates. Unlike the Tigon I and Tigon II,</i></td></tr>
<tr><th id="61">61</th><td><i> * firmware images can be stored in hardware and need not be compiled</i></td></tr>
<tr><th id="62">62</th><td><i> * into the driver.</i></td></tr>
<tr><th id="63">63</th><td><i> *</i></td></tr>
<tr><th id="64">64</th><td><i> * The BCM5700 supports the PCI v2.2 and PCI-X v1.0 standards, and will</i></td></tr>
<tr><th id="65">65</th><td><i> * function in a 32-bit/64-bit 33/66MHz bus, or a 64-bit/133MHz bus.</i></td></tr>
<tr><th id="66">66</th><td><i> *</i></td></tr>
<tr><th id="67">67</th><td><i> * The BCM5701 is a single-chip solution incorporating both the BCM5700</i></td></tr>
<tr><th id="68">68</th><td><i> * MAC and a BCM5401 10/100/1000 PHY. Unlike the BCM5700, the BCM5701</i></td></tr>
<tr><th id="69">69</th><td><i> * does not support external SSRAM.</i></td></tr>
<tr><th id="70">70</th><td><i> *</i></td></tr>
<tr><th id="71">71</th><td><i> * Broadcom also produces a variation of the BCM5700 under the "Altima"</i></td></tr>
<tr><th id="72">72</th><td><i> * brand name, which is functionally similar but lacks PCI-X support.</i></td></tr>
<tr><th id="73">73</th><td><i> *</i></td></tr>
<tr><th id="74">74</th><td><i> * Without external SSRAM, you can only have at most 4 TX rings,</i></td></tr>
<tr><th id="75">75</th><td><i> * and the use of the mini RX ring is disabled. This seems to imply</i></td></tr>
<tr><th id="76">76</th><td><i> * that these features are simply not available on the BCM5701. As a</i></td></tr>
<tr><th id="77">77</th><td><i> * result, this driver does not implement any support for the mini RX</i></td></tr>
<tr><th id="78">78</th><td><i> * ring.</i></td></tr>
<tr><th id="79">79</th><td><i> */</i></td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><u>#include <a href="../../sys/cdefs.h.html">&lt;sys/cdefs.h&gt;</a></u></td></tr>
<tr><th id="82">82</th><td><a class="macro" href="../../sys/cdefs_elf.h.html#156" title="__asm(&quot;.pushsection &quot; &quot;.ident&quot; &quot;\n&quot; &quot;.asciz \&quot;&quot; &quot;$NetBSD: if_bge.c,v 1.335 2019/07/09 08:46:58 msaitoh Exp $&quot; &quot;\&quot;\n&quot; &quot;.popsection&quot;)" data-ref="_M/__KERNEL_RCSID">__KERNEL_RCSID</a>(<var>0</var>, <q>"$NetBSD: if_bge.c,v 1.335 2019/07/09 08:46:58 msaitoh Exp $"</q>);</td></tr>
<tr><th id="83">83</th><td></td></tr>
<tr><th id="84">84</th><td><u>#include <a href="../../sys/param.h.html">&lt;sys/param.h&gt;</a></u></td></tr>
<tr><th id="85">85</th><td><u>#include <a href="../../sys/systm.h.html">&lt;sys/systm.h&gt;</a></u></td></tr>
<tr><th id="86">86</th><td><u>#include <a href="../../sys/callout.h.html">&lt;sys/callout.h&gt;</a></u></td></tr>
<tr><th id="87">87</th><td><u>#include <a href="../../sys/sockio.h.html">&lt;sys/sockio.h&gt;</a></u></td></tr>
<tr><th id="88">88</th><td><u>#include <a href="../../sys/mbuf.h.html">&lt;sys/mbuf.h&gt;</a></u></td></tr>
<tr><th id="89">89</th><td><u>#include <a href="../../sys/malloc.h.html">&lt;sys/malloc.h&gt;</a></u></td></tr>
<tr><th id="90">90</th><td><u>#include <a href="../../sys/kernel.h.html">&lt;sys/kernel.h&gt;</a></u></td></tr>
<tr><th id="91">91</th><td><u>#include <a href="../../sys/device.h.html">&lt;sys/device.h&gt;</a></u></td></tr>
<tr><th id="92">92</th><td><u>#include <a href="../../sys/socket.h.html">&lt;sys/socket.h&gt;</a></u></td></tr>
<tr><th id="93">93</th><td><u>#include <a href="../../sys/sysctl.h.html">&lt;sys/sysctl.h&gt;</a></u></td></tr>
<tr><th id="94">94</th><td><u>#include <a href="../../sys/rndsource.h.html">&lt;sys/rndsource.h&gt;</a></u></td></tr>
<tr><th id="95">95</th><td></td></tr>
<tr><th id="96">96</th><td><u>#include <a href="../../net/if.h.html">&lt;net/if.h&gt;</a></u></td></tr>
<tr><th id="97">97</th><td><u>#include <a href="../../net/if_dl.h.html">&lt;net/if_dl.h&gt;</a></u></td></tr>
<tr><th id="98">98</th><td><u>#include <a href="../../net/if_media.h.html">&lt;net/if_media.h&gt;</a></u></td></tr>
<tr><th id="99">99</th><td><u>#include <a href="../../net/if_ether.h.html">&lt;net/if_ether.h&gt;</a></u></td></tr>
<tr><th id="100">100</th><td><u>#include <a href="../../net/bpf.h.html">&lt;net/bpf.h&gt;</a></u></td></tr>
<tr><th id="101">101</th><td></td></tr>
<tr><th id="102">102</th><td><u>#<span data-ppcond="102">ifdef</span> <span class="macro" data-ref="_M/INET">INET</span></u></td></tr>
<tr><th id="103">103</th><td><u>#include &lt;netinet/in.h&gt;</u></td></tr>
<tr><th id="104">104</th><td><u>#include &lt;netinet/in_systm.h&gt;</u></td></tr>
<tr><th id="105">105</th><td><u>#include &lt;netinet/in_var.h&gt;</u></td></tr>
<tr><th id="106">106</th><td><u>#include &lt;netinet/ip.h&gt;</u></td></tr>
<tr><th id="107">107</th><td><u>#<span data-ppcond="102">endif</span></u></td></tr>
<tr><th id="108">108</th><td></td></tr>
<tr><th id="109">109</th><td><i>/* Headers for TCP Segmentation Offload (TSO) */</i></td></tr>
<tr><th id="110">110</th><td><u>#include <a href="../../netinet/in_systm.h.html">&lt;netinet/in_systm.h&gt;</a>		/* n_time for &lt;netinet/ip.h&gt;... */</u></td></tr>
<tr><th id="111">111</th><td><u>#include <a href="../../netinet/in.h.html">&lt;netinet/in.h&gt;</a>			/* ip_{src,dst}, for &lt;netinet/ip.h&gt; */</u></td></tr>
<tr><th id="112">112</th><td><u>#include <a href="../../netinet/ip.h.html">&lt;netinet/ip.h&gt;</a>			/* for struct ip */</u></td></tr>
<tr><th id="113">113</th><td><u>#include <a href="../../netinet/tcp.h.html">&lt;netinet/tcp.h&gt;</a>		/* for struct tcphdr */</u></td></tr>
<tr><th id="114">114</th><td></td></tr>
<tr><th id="115">115</th><td><u>#include <a href="pcireg.h.html">&lt;dev/pci/pcireg.h&gt;</a></u></td></tr>
<tr><th id="116">116</th><td><u>#include <a href="pcivar.h.html">&lt;dev/pci/pcivar.h&gt;</a></u></td></tr>
<tr><th id="117">117</th><td><u>#include <a href="pcidevs.h.html">&lt;dev/pci/pcidevs.h&gt;</a></u></td></tr>
<tr><th id="118">118</th><td></td></tr>
<tr><th id="119">119</th><td><u>#include <a href="../mii/mii.h.html">&lt;dev/mii/mii.h&gt;</a></u></td></tr>
<tr><th id="120">120</th><td><u>#include <a href="../mii/miivar.h.html">&lt;dev/mii/miivar.h&gt;</a></u></td></tr>
<tr><th id="121">121</th><td><u>#include <a href="../mii/miidevs.h.html">&lt;dev/mii/miidevs.h&gt;</a></u></td></tr>
<tr><th id="122">122</th><td><u>#include <a href="../mii/brgphyreg.h.html">&lt;dev/mii/brgphyreg.h&gt;</a></u></td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td><u>#include <a href="if_bgereg.h.html">&lt;dev/pci/if_bgereg.h&gt;</a></u></td></tr>
<tr><th id="125">125</th><td><u>#include <a href="if_bgevar.h.html">&lt;dev/pci/if_bgevar.h&gt;</a></u></td></tr>
<tr><th id="126">126</th><td></td></tr>
<tr><th id="127">127</th><td><u>#include <a href="../../../common/include/prop/proplib.h.html">&lt;prop/proplib.h&gt;</a></u></td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td><u>#define <dfn class="macro" id="_M/ETHER_MIN_NOPAD" data-ref="_M/ETHER_MIN_NOPAD">ETHER_MIN_NOPAD</dfn> (ETHER_MIN_LEN - ETHER_CRC_LEN) /* i.e., 60 */</u></td></tr>
<tr><th id="130">130</th><td></td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td><i>/*</i></td></tr>
<tr><th id="133">133</th><td><i> * Tunable thresholds for rx-side bge interrupt mitigation.</i></td></tr>
<tr><th id="134">134</th><td><i> */</i></td></tr>
<tr><th id="135">135</th><td></td></tr>
<tr><th id="136">136</th><td><i>/*</i></td></tr>
<tr><th id="137">137</th><td><i> * The pairs of values below were obtained from empirical measurement</i></td></tr>
<tr><th id="138">138</th><td><i> * on bcm5700 rev B2; they ar designed to give roughly 1 receive</i></td></tr>
<tr><th id="139">139</th><td><i> * interrupt for every N packets received, where N is, approximately,</i></td></tr>
<tr><th id="140">140</th><td><i> * the second value (rx_max_bds) in each pair.  The values are chosen</i></td></tr>
<tr><th id="141">141</th><td><i> * such that moving from one pair to the succeeding pair was observed</i></td></tr>
<tr><th id="142">142</th><td><i> * to roughly halve interrupt rate under sustained input packet load.</i></td></tr>
<tr><th id="143">143</th><td><i> * The values were empirically chosen to avoid overflowing internal</i></td></tr>
<tr><th id="144">144</th><td><i> * limits on the  bcm5700: increasing rx_ticks much beyond 600</i></td></tr>
<tr><th id="145">145</th><td><i> * results in internal wrapping and higher interrupt rates.</i></td></tr>
<tr><th id="146">146</th><td><i> * The limit of 46 frames was chosen to match NFS workloads.</i></td></tr>
<tr><th id="147">147</th><td><i> *</i></td></tr>
<tr><th id="148">148</th><td><i> * These values also work well on bcm5701, bcm5704C, and (less</i></td></tr>
<tr><th id="149">149</th><td><i> * tested) bcm5703.  On other chipsets, (including the Altima chip</i></td></tr>
<tr><th id="150">150</th><td><i> * family), the larger values may overflow internal chip limits,</i></td></tr>
<tr><th id="151">151</th><td><i> * leading to increasing interrupt rates rather than lower interrupt</i></td></tr>
<tr><th id="152">152</th><td><i> * rates.</i></td></tr>
<tr><th id="153">153</th><td><i> *</i></td></tr>
<tr><th id="154">154</th><td><i> * Applications using heavy interrupt mitigation (interrupting every</i></td></tr>
<tr><th id="155">155</th><td><i> * 32 or 46 frames) in both directions may need to increase the TCP</i></td></tr>
<tr><th id="156">156</th><td><i> * windowsize to above 131072 bytes (e.g., to 199608 bytes) to sustain</i></td></tr>
<tr><th id="157">157</th><td><i> * full link bandwidth, due to ACKs and window updates lingering</i></td></tr>
<tr><th id="158">158</th><td><i> * in the RX queue during the 30-to-40-frame interrupt-mitigation window.</i></td></tr>
<tr><th id="159">159</th><td><i> */</i></td></tr>
<tr><th id="160">160</th><td><em>static</em> <em>const</em> <b>struct</b> <dfn class="type def" id="bge_load_rx_thresh" title='bge_load_rx_thresh' data-ref="bge_load_rx_thresh" data-ref-filename="bge_load_rx_thresh"><a class="type" href="#bge_load_rx_thresh" title='bge_load_rx_thresh' data-ref="bge_load_rx_thresh" data-ref-filename="bge_load_rx_thresh">bge_load_rx_thresh</a></dfn> {</td></tr>
<tr><th id="161">161</th><td>	<em>int</em> <dfn class="tu decl field" id="bge_load_rx_thresh::rx_ticks" title='bge_load_rx_thresh::rx_ticks' data-type='int' data-ref="bge_load_rx_thresh::rx_ticks" data-ref-filename="bge_load_rx_thresh..rx_ticks">rx_ticks</dfn>;</td></tr>
<tr><th id="162">162</th><td>	<em>int</em> <dfn class="tu decl field" id="bge_load_rx_thresh::rx_max_bds" title='bge_load_rx_thresh::rx_max_bds' data-type='int' data-ref="bge_load_rx_thresh::rx_max_bds" data-ref-filename="bge_load_rx_thresh..rx_max_bds">rx_max_bds</dfn>; }</td></tr>
<tr><th id="163">163</th><td><dfn class="tu decl def" id="bge_rx_threshes" title='bge_rx_threshes' data-type='const struct bge_load_rx_thresh [7]' data-ref="bge_rx_threshes" data-ref-filename="bge_rx_threshes">bge_rx_threshes</dfn>[] = {</td></tr>
<tr><th id="164">164</th><td>	{ <var>16</var>,	<var>1</var> },	<i>/* rx_max_bds = 1 disables interrupt mitigation */</i></td></tr>
<tr><th id="165">165</th><td>	{ <var>32</var>,	<var>2</var> },</td></tr>
<tr><th id="166">166</th><td>	{ <var>50</var>,	<var>4</var> },</td></tr>
<tr><th id="167">167</th><td>	{ <var>100</var>,	<var>8</var> },</td></tr>
<tr><th id="168">168</th><td>	{ <var>192</var>, <var>16</var> },</td></tr>
<tr><th id="169">169</th><td>	{ <var>416</var>, <var>32</var> },</td></tr>
<tr><th id="170">170</th><td>	{ <var>598</var>, <var>46</var> }</td></tr>
<tr><th id="171">171</th><td>};</td></tr>
<tr><th id="172">172</th><td><u>#define <dfn class="macro" id="_M/NBGE_RX_THRESH" data-ref="_M/NBGE_RX_THRESH">NBGE_RX_THRESH</dfn> (sizeof(<a class="tu ref" href="#bge_rx_threshes" title='bge_rx_threshes' data-use='r' data-ref="bge_rx_threshes" data-ref-filename="bge_rx_threshes">bge_rx_threshes</a>) / sizeof(<a class="tu ref" href="#bge_rx_threshes" title='bge_rx_threshes' data-use='r' data-ref="bge_rx_threshes" data-ref-filename="bge_rx_threshes">bge_rx_threshes</a>[0]))</u></td></tr>
<tr><th id="173">173</th><td></td></tr>
<tr><th id="174">174</th><td><i  data-doc="bge_auto_thresh">/* XXX patchable; should be sysctl'able */</i></td></tr>
<tr><th id="175">175</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="bge_auto_thresh" title='bge_auto_thresh' data-type='int' data-ref="bge_auto_thresh" data-ref-filename="bge_auto_thresh">bge_auto_thresh</dfn> = <var>1</var>;</td></tr>
<tr><th id="176">176</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="bge_rx_thresh_lvl" title='bge_rx_thresh_lvl' data-type='int' data-ref="bge_rx_thresh_lvl" data-ref-filename="bge_rx_thresh_lvl">bge_rx_thresh_lvl</dfn>;</td></tr>
<tr><th id="177">177</th><td></td></tr>
<tr><th id="178">178</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="bge_rxthresh_nodenum" title='bge_rxthresh_nodenum' data-type='int' data-ref="bge_rxthresh_nodenum" data-ref-filename="bge_rxthresh_nodenum">bge_rxthresh_nodenum</dfn>;</td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td><b>typedef</b> <em>int</em> (*<dfn class="typedef" id="bge_eaddr_fcn_t" title='bge_eaddr_fcn_t' data-type='int (*)(struct bge_softc *, uint8_t *)' data-ref="bge_eaddr_fcn_t" data-ref-filename="bge_eaddr_fcn_t">bge_eaddr_fcn_t</dfn>)(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <a class="tu decl fn" href="#bge_chipid" title='bge_chipid' data-type='uint32_t bge_chipid(const struct pci_attach_args * )' data-ref="bge_chipid" data-ref-filename="bge_chipid">bge_chipid</a>(<em>const</em> <b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *);</td></tr>
<tr><th id="183">183</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_can_use_msi" title='bge_can_use_msi' data-type='int bge_can_use_msi(struct bge_softc * )' data-ref="bge_can_use_msi" data-ref-filename="bge_can_use_msi">bge_can_use_msi</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="184">184</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_probe" title='bge_probe' data-type='int bge_probe(device_t , cfdata_t , void * )' data-ref="bge_probe" data-ref-filename="bge_probe">bge_probe</a>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <a class="typedef" href="../../sys/device.h.html#cfdata_t" title='cfdata_t' data-type='struct cfdata *' data-ref="cfdata_t" data-ref-filename="cfdata_t">cfdata_t</a>, <em>void</em> *);</td></tr>
<tr><th id="185">185</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_attach" title='bge_attach' data-type='void bge_attach(device_t , device_t , void * )' data-ref="bge_attach" data-ref-filename="bge_attach">bge_attach</a>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <em>void</em> *);</td></tr>
<tr><th id="186">186</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_detach" title='bge_detach' data-type='int bge_detach(device_t , int )' data-ref="bge_detach" data-ref-filename="bge_detach">bge_detach</a>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <em>int</em>);</td></tr>
<tr><th id="187">187</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_release_resources" title='bge_release_resources' data-type='void bge_release_resources(struct bge_softc * )' data-ref="bge_release_resources" data-ref-filename="bge_release_resources">bge_release_resources</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="188">188</th><td></td></tr>
<tr><th id="189">189</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_get_eaddr_fw" title='bge_get_eaddr_fw' data-type='int bge_get_eaddr_fw(struct bge_softc * , uint8_t * )' data-ref="bge_get_eaddr_fw" data-ref-filename="bge_get_eaddr_fw">bge_get_eaddr_fw</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="190">190</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_get_eaddr_mem" title='bge_get_eaddr_mem' data-type='int bge_get_eaddr_mem(struct bge_softc * , uint8_t * )' data-ref="bge_get_eaddr_mem" data-ref-filename="bge_get_eaddr_mem">bge_get_eaddr_mem</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="191">191</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_get_eaddr_nvram" title='bge_get_eaddr_nvram' data-type='int bge_get_eaddr_nvram(struct bge_softc * , uint8_t * )' data-ref="bge_get_eaddr_nvram" data-ref-filename="bge_get_eaddr_nvram">bge_get_eaddr_nvram</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="192">192</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_get_eaddr_eeprom" title='bge_get_eaddr_eeprom' data-type='int bge_get_eaddr_eeprom(struct bge_softc * , uint8_t * )' data-ref="bge_get_eaddr_eeprom" data-ref-filename="bge_get_eaddr_eeprom">bge_get_eaddr_eeprom</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="193">193</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_get_eaddr" title='bge_get_eaddr' data-type='int bge_get_eaddr(struct bge_softc * , uint8_t * )' data-ref="bge_get_eaddr" data-ref-filename="bge_get_eaddr">bge_get_eaddr</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>[]);</td></tr>
<tr><th id="194">194</th><td></td></tr>
<tr><th id="195">195</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_txeof" title='bge_txeof' data-type='void bge_txeof(struct bge_softc * )' data-ref="bge_txeof" data-ref-filename="bge_txeof">bge_txeof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="196">196</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_rxcsum" title='bge_rxcsum' data-type='void bge_rxcsum(struct bge_softc * , struct bge_rx_bd * , struct mbuf * )' data-ref="bge_rxcsum" data-ref-filename="bge_rxcsum">bge_rxcsum</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a> *, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *);</td></tr>
<tr><th id="197">197</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_rxeof" title='bge_rxeof' data-type='void bge_rxeof(struct bge_softc * )' data-ref="bge_rxeof" data-ref-filename="bge_rxeof">bge_rxeof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="198">198</th><td></td></tr>
<tr><th id="199">199</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_asf_driver_up" title='bge_asf_driver_up' data-type='void bge_asf_driver_up(struct bge_softc * )' data-ref="bge_asf_driver_up" data-ref-filename="bge_asf_driver_up">bge_asf_driver_up</a> (<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="200">200</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_tick" title='bge_tick' data-type='void bge_tick(void * )' data-ref="bge_tick" data-ref-filename="bge_tick">bge_tick</a>(<em>void</em> *);</td></tr>
<tr><th id="201">201</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_stats_update" title='bge_stats_update' data-type='void bge_stats_update(struct bge_softc * )' data-ref="bge_stats_update" data-ref-filename="bge_stats_update">bge_stats_update</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="202">202</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_stats_update_regs" title='bge_stats_update_regs' data-type='void bge_stats_update_regs(struct bge_softc * )' data-ref="bge_stats_update_regs" data-ref-filename="bge_stats_update_regs">bge_stats_update_regs</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="203">203</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_encap" title='bge_encap' data-type='int bge_encap(struct bge_softc * , struct mbuf * , uint32_t * )' data-ref="bge_encap" data-ref-filename="bge_encap">bge_encap</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> *);</td></tr>
<tr><th id="204">204</th><td></td></tr>
<tr><th id="205">205</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_intr" title='bge_intr' data-type='int bge_intr(void * )' data-ref="bge_intr" data-ref-filename="bge_intr">bge_intr</a>(<em>void</em> *);</td></tr>
<tr><th id="206">206</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_start" title='bge_start' data-type='void bge_start(struct ifnet * )' data-ref="bge_start" data-ref-filename="bge_start">bge_start</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *);</td></tr>
<tr><th id="207">207</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_ifflags_cb" title='bge_ifflags_cb' data-type='int bge_ifflags_cb(struct ethercom * )' data-ref="bge_ifflags_cb" data-ref-filename="bge_ifflags_cb">bge_ifflags_cb</a>(<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ethercom" title='ethercom' data-ref="ethercom" data-ref-filename="ethercom">ethercom</a> *);</td></tr>
<tr><th id="208">208</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_ioctl" title='bge_ioctl' data-type='int bge_ioctl(struct ifnet * , u_long , void * )' data-ref="bge_ioctl" data-ref-filename="bge_ioctl">bge_ioctl</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *, <a class="typedef" href="../../sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a>, <em>void</em> *);</td></tr>
<tr><th id="209">209</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_init" title='bge_init' data-type='int bge_init(struct ifnet * )' data-ref="bge_init" data-ref-filename="bge_init">bge_init</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *);</td></tr>
<tr><th id="210">210</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_stop" title='bge_stop' data-type='void bge_stop(struct ifnet * , int )' data-ref="bge_stop" data-ref-filename="bge_stop">bge_stop</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *, <em>int</em>);</td></tr>
<tr><th id="211">211</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_watchdog" title='bge_watchdog' data-type='void bge_watchdog(struct ifnet * )' data-ref="bge_watchdog" data-ref-filename="bge_watchdog">bge_watchdog</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *);</td></tr>
<tr><th id="212">212</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_ifmedia_upd" title='bge_ifmedia_upd' data-type='int bge_ifmedia_upd(struct ifnet * )' data-ref="bge_ifmedia_upd" data-ref-filename="bge_ifmedia_upd">bge_ifmedia_upd</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *);</td></tr>
<tr><th id="213">213</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ifmedia_sts" title='bge_ifmedia_sts' data-type='void bge_ifmedia_sts(struct ifnet * , struct ifmediareq * )' data-ref="bge_ifmedia_sts" data-ref-filename="bge_ifmedia_sts">bge_ifmedia_sts</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *, <b>struct</b> <a class="type" href="../../net/if.h.html#ifmediareq" title='ifmediareq' data-ref="ifmediareq" data-ref-filename="ifmediareq">ifmediareq</a> *);</td></tr>
<tr><th id="214">214</th><td></td></tr>
<tr><th id="215">215</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <a class="tu decl fn" href="#bge_nvram_getbyte" title='bge_nvram_getbyte' data-type='uint8_t bge_nvram_getbyte(struct bge_softc * , int , uint8_t * )' data-ref="bge_nvram_getbyte" data-ref-filename="bge_nvram_getbyte">bge_nvram_getbyte</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *);</td></tr>
<tr><th id="216">216</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_read_nvram" title='bge_read_nvram' data-type='int bge_read_nvram(struct bge_softc * , uint8_t * , int , int )' data-ref="bge_read_nvram" data-ref-filename="bge_read_nvram">bge_read_nvram</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="217">217</th><td></td></tr>
<tr><th id="218">218</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <a class="tu decl fn" href="#bge_eeprom_getbyte" title='bge_eeprom_getbyte' data-type='uint8_t bge_eeprom_getbyte(struct bge_softc * , int , uint8_t * )' data-ref="bge_eeprom_getbyte" data-ref-filename="bge_eeprom_getbyte">bge_eeprom_getbyte</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *);</td></tr>
<tr><th id="219">219</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_read_eeprom" title='bge_read_eeprom' data-type='int bge_read_eeprom(struct bge_softc * , void * , int , int )' data-ref="bge_read_eeprom" data-ref-filename="bge_read_eeprom">bge_read_eeprom</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>void</em> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="220">220</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_setmulti" title='bge_setmulti' data-type='void bge_setmulti(struct bge_softc * )' data-ref="bge_setmulti" data-ref-filename="bge_setmulti">bge_setmulti</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="221">221</th><td></td></tr>
<tr><th id="222">222</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_handle_events" title='bge_handle_events' data-type='void bge_handle_events(struct bge_softc * )' data-ref="bge_handle_events" data-ref-filename="bge_handle_events">bge_handle_events</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="223">223</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_alloc_jumbo_mem" title='bge_alloc_jumbo_mem' data-type='int bge_alloc_jumbo_mem(struct bge_softc * )' data-ref="bge_alloc_jumbo_mem" data-ref-filename="bge_alloc_jumbo_mem">bge_alloc_jumbo_mem</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="224">224</th><td><u>#<span data-ppcond="224">if</span> 0 /* XXX */</u></td></tr>
<tr><th id="225">225</th><td><em>static</em> <em>void</em> bge_free_jumbo_mem(<b>struct</b> bge_softc *);</td></tr>
<tr><th id="226">226</th><td><u>#<span data-ppcond="224">endif</span></u></td></tr>
<tr><th id="227">227</th><td><em>static</em> <em>void</em> *<a class="tu decl fn" href="#bge_jalloc" title='bge_jalloc' data-type='void * bge_jalloc(struct bge_softc * )' data-ref="bge_jalloc" data-ref-filename="bge_jalloc">bge_jalloc</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="228">228</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_jfree" title='bge_jfree' data-type='void bge_jfree(struct mbuf * , void * , size_t , void * )' data-ref="bge_jfree" data-ref-filename="bge_jfree">bge_jfree</a>(<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *, <em>void</em> *, <a class="typedef" href="../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a>, <em>void</em> *);</td></tr>
<tr><th id="229">229</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-type='int bge_newbuf_std(struct bge_softc * , int , struct mbuf * , bus_dmamap_t )' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *,</td></tr>
<tr><th id="230">230</th><td>			       <a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dmamap_t" title='bus_dmamap_t' data-type='struct x86_bus_dmamap *' data-ref="bus_dmamap_t" data-ref-filename="bus_dmamap_t">bus_dmamap_t</a>);</td></tr>
<tr><th id="231">231</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-type='int bge_newbuf_jumbo(struct bge_softc * , int , struct mbuf * )' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *);</td></tr>
<tr><th id="232">232</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_init_rx_ring_std" title='bge_init_rx_ring_std' data-type='int bge_init_rx_ring_std(struct bge_softc * )' data-ref="bge_init_rx_ring_std" data-ref-filename="bge_init_rx_ring_std">bge_init_rx_ring_std</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="233">233</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_free_rx_ring_std" title='bge_free_rx_ring_std' data-type='void bge_free_rx_ring_std(struct bge_softc * m, _Bool )' data-ref="bge_free_rx_ring_std" data-ref-filename="bge_free_rx_ring_std">bge_free_rx_ring_std</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="1m" title='m' data-type='struct bge_softc *' data-ref="1m" data-ref-filename="1m">m</dfn>, <a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a>);</td></tr>
<tr><th id="234">234</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_init_rx_ring_jumbo" title='bge_init_rx_ring_jumbo' data-type='int bge_init_rx_ring_jumbo(struct bge_softc * )' data-ref="bge_init_rx_ring_jumbo" data-ref-filename="bge_init_rx_ring_jumbo">bge_init_rx_ring_jumbo</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="235">235</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_free_rx_ring_jumbo" title='bge_free_rx_ring_jumbo' data-type='void bge_free_rx_ring_jumbo(struct bge_softc * )' data-ref="bge_free_rx_ring_jumbo" data-ref-filename="bge_free_rx_ring_jumbo">bge_free_rx_ring_jumbo</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="236">236</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_free_tx_ring" title='bge_free_tx_ring' data-type='void bge_free_tx_ring(struct bge_softc * m, _Bool )' data-ref="bge_free_tx_ring" data-ref-filename="bge_free_tx_ring">bge_free_tx_ring</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col2 decl" id="2m" title='m' data-type='struct bge_softc *' data-ref="2m" data-ref-filename="2m">m</dfn>, <a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a>);</td></tr>
<tr><th id="237">237</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_init_tx_ring" title='bge_init_tx_ring' data-type='int bge_init_tx_ring(struct bge_softc * )' data-ref="bge_init_tx_ring" data-ref-filename="bge_init_tx_ring">bge_init_tx_ring</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="238">238</th><td></td></tr>
<tr><th id="239">239</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_chipinit" title='bge_chipinit' data-type='int bge_chipinit(struct bge_softc * )' data-ref="bge_chipinit" data-ref-filename="bge_chipinit">bge_chipinit</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="240">240</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_blockinit" title='bge_blockinit' data-type='int bge_blockinit(struct bge_softc * )' data-ref="bge_blockinit" data-ref-filename="bge_blockinit">bge_blockinit</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="241">241</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_phy_addr" title='bge_phy_addr' data-type='int bge_phy_addr(struct bge_softc * )' data-ref="bge_phy_addr" data-ref-filename="bge_phy_addr">bge_phy_addr</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="242">242</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <a class="tu decl fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-type='uint32_t bge_readmem_ind(struct bge_softc * , int )' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="243">243</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-type='void bge_writemem_ind(struct bge_softc * , int , int )' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="244">244</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_writembx" title='bge_writembx' data-type='void bge_writembx(struct bge_softc * , int , int )' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="245">245</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_writembx_flush" title='bge_writembx_flush' data-type='void bge_writembx_flush(struct bge_softc * , int , int )' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="246">246</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_writemem_direct" title='bge_writemem_direct' data-type='void bge_writemem_direct(struct bge_softc * , int , int )' data-ref="bge_writemem_direct" data-ref-filename="bge_writemem_direct">bge_writemem_direct</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="247">247</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_writereg_ind" title='bge_writereg_ind' data-type='void bge_writereg_ind(struct bge_softc * , int , int )' data-ref="bge_writereg_ind" data-ref-filename="bge_writereg_ind">bge_writereg_ind</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="248">248</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_set_max_readrq" title='bge_set_max_readrq' data-type='void bge_set_max_readrq(struct bge_softc * )' data-ref="bge_set_max_readrq" data-ref-filename="bge_set_max_readrq">bge_set_max_readrq</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="249">249</th><td></td></tr>
<tr><th id="250">250</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_miibus_readreg" title='bge_miibus_readreg' data-type='int bge_miibus_readreg(device_t , int , int , uint16_t * )' data-ref="bge_miibus_readreg" data-ref-filename="bge_miibus_readreg">bge_miibus_readreg</a>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <em>int</em>, <em>int</em>, <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> *);</td></tr>
<tr><th id="251">251</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_miibus_writereg" title='bge_miibus_writereg' data-type='int bge_miibus_writereg(device_t , int , int , uint16_t )' data-ref="bge_miibus_writereg" data-ref-filename="bge_miibus_writereg">bge_miibus_writereg</a>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a>, <em>int</em>, <em>int</em>, <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a>);</td></tr>
<tr><th id="252">252</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_miibus_statchg" title='bge_miibus_statchg' data-type='void bge_miibus_statchg(struct ifnet * )' data-ref="bge_miibus_statchg" data-ref-filename="bge_miibus_statchg">bge_miibus_statchg</a>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *);</td></tr>
<tr><th id="253">253</th><td></td></tr>
<tr><th id="254">254</th><td><u>#define <dfn class="macro" id="_M/BGE_RESET_SHUTDOWN" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</dfn>	0</u></td></tr>
<tr><th id="255">255</th><td><u>#define	<dfn class="macro" id="_M/BGE_RESET_START" data-ref="_M/BGE_RESET_START">BGE_RESET_START</dfn>		1</u></td></tr>
<tr><th id="256">256</th><td><u>#define	<dfn class="macro" id="_M/BGE_RESET_SUSPEND" data-ref="_M/BGE_RESET_SUSPEND">BGE_RESET_SUSPEND</dfn>	2</u></td></tr>
<tr><th id="257">257</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_sig_post_reset" title='bge_sig_post_reset' data-type='void bge_sig_post_reset(struct bge_softc * , int )' data-ref="bge_sig_post_reset" data-ref-filename="bge_sig_post_reset">bge_sig_post_reset</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="258">258</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_sig_legacy" title='bge_sig_legacy' data-type='void bge_sig_legacy(struct bge_softc * , int )' data-ref="bge_sig_legacy" data-ref-filename="bge_sig_legacy">bge_sig_legacy</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="259">259</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_sig_pre_reset" title='bge_sig_pre_reset' data-type='void bge_sig_pre_reset(struct bge_softc * , int )' data-ref="bge_sig_pre_reset" data-ref-filename="bge_sig_pre_reset">bge_sig_pre_reset</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="260">260</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_wait_for_event_ack" title='bge_wait_for_event_ack' data-type='void bge_wait_for_event_ack(struct bge_softc * )' data-ref="bge_wait_for_event_ack" data-ref-filename="bge_wait_for_event_ack">bge_wait_for_event_ack</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="261">261</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_stop_fw" title='bge_stop_fw' data-type='void bge_stop_fw(struct bge_softc * )' data-ref="bge_stop_fw" data-ref-filename="bge_stop_fw">bge_stop_fw</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="262">262</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_reset" title='bge_reset' data-type='int bge_reset(struct bge_softc * )' data-ref="bge_reset" data-ref-filename="bge_reset">bge_reset</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="263">263</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_link_upd" title='bge_link_upd' data-type='void bge_link_upd(struct bge_softc * )' data-ref="bge_link_upd" data-ref-filename="bge_link_upd">bge_link_upd</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="264">264</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_sysctl_init" title='bge_sysctl_init' data-type='void bge_sysctl_init(struct bge_softc * )' data-ref="bge_sysctl_init" data-ref-filename="bge_sysctl_init">bge_sysctl_init</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="265">265</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_sysctl_verify" title='bge_sysctl_verify' data-type='int bge_sysctl_verify(const int * , u_int , void * , size_t * , const void * , size_t , const int * , struct lwp * , const struct sysctlnode * )' data-ref="bge_sysctl_verify" data-ref-filename="bge_sysctl_verify">bge_sysctl_verify</a>(<a class="macro" href="../../sys/sysctl.h.html#954" title="const int *, u_int, void *, size_t *, const void *, size_t, const int *, struct lwp *, const struct sysctlnode *" data-ref="_M/SYSCTLFN_PROTO">SYSCTLFN_PROTO</a>);</td></tr>
<tr><th id="266">266</th><td></td></tr>
<tr><th id="267">267</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ape_lock_init" title='bge_ape_lock_init' data-type='void bge_ape_lock_init(struct bge_softc * )' data-ref="bge_ape_lock_init" data-ref-filename="bge_ape_lock_init">bge_ape_lock_init</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="268">268</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ape_read_fw_ver" title='bge_ape_read_fw_ver' data-type='void bge_ape_read_fw_ver(struct bge_softc * )' data-ref="bge_ape_read_fw_ver" data-ref-filename="bge_ape_read_fw_ver">bge_ape_read_fw_ver</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *);</td></tr>
<tr><th id="269">269</th><td><em>static</em> <em>int</em> <a class="tu decl fn" href="#bge_ape_lock" title='bge_ape_lock' data-type='int bge_ape_lock(struct bge_softc * , int )' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="270">270</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-type='void bge_ape_unlock(struct bge_softc * , int )' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="271">271</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ape_send_event" title='bge_ape_send_event' data-type='void bge_ape_send_event(struct bge_softc * , uint32_t )' data-ref="bge_ape_send_event" data-ref-filename="bge_ape_send_event">bge_ape_send_event</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>);</td></tr>
<tr><th id="272">272</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#bge_ape_driver_state_change" title='bge_ape_driver_state_change' data-type='void bge_ape_driver_state_change(struct bge_softc * , int )' data-ref="bge_ape_driver_state_change" data-ref-filename="bge_ape_driver_state_change">bge_ape_driver_state_change</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>);</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td><u>#<span data-ppcond="274">ifdef</span> <span class="macro" data-ref="_M/BGE_DEBUG">BGE_DEBUG</span></u></td></tr>
<tr><th id="275">275</th><td><u>#define DPRINTF(x)	if (bgedebug) printf x</u></td></tr>
<tr><th id="276">276</th><td><u>#define DPRINTFN(n, x)	if (bgedebug &gt;= (n)) printf x</u></td></tr>
<tr><th id="277">277</th><td><u>#define BGE_TSO_PRINTF(x)  do { if (bge_tso_debug) printf x ;} while (0)</u></td></tr>
<tr><th id="278">278</th><td><em>int</em>	bgedebug = <var>0</var>;</td></tr>
<tr><th id="279">279</th><td><em>int</em>	bge_tso_debug = <var>0</var>;</td></tr>
<tr><th id="280">280</th><td><em>void</em>		bge_debug_info(<b>struct</b> bge_softc *);</td></tr>
<tr><th id="281">281</th><td><u>#<span data-ppcond="274">else</span></u></td></tr>
<tr><th id="282">282</th><td><u>#define <dfn class="macro" id="_M/DPRINTF" data-ref="_M/DPRINTF">DPRINTF</dfn>(x)</u></td></tr>
<tr><th id="283">283</th><td><u>#define <dfn class="macro" id="_M/DPRINTFN" data-ref="_M/DPRINTFN">DPRINTFN</dfn>(n, x)</u></td></tr>
<tr><th id="284">284</th><td><u>#define <dfn class="macro" id="_M/BGE_TSO_PRINTF" data-ref="_M/BGE_TSO_PRINTF">BGE_TSO_PRINTF</dfn>(x)</u></td></tr>
<tr><th id="285">285</th><td><u>#<span data-ppcond="274">endif</span></u></td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td><u>#<span data-ppcond="287">ifdef</span> <span class="macro" data-ref="_M/BGE_EVENT_COUNTERS">BGE_EVENT_COUNTERS</span></u></td></tr>
<tr><th id="288">288</th><td><u>#define	BGE_EVCNT_INCR(ev)	(ev).ev_count++</u></td></tr>
<tr><th id="289">289</th><td><u>#define	BGE_EVCNT_ADD(ev, val)	(ev).ev_count += (val)</u></td></tr>
<tr><th id="290">290</th><td><u>#define	BGE_EVCNT_UPD(ev, val)	(ev).ev_count = (val)</u></td></tr>
<tr><th id="291">291</th><td><u>#<span data-ppcond="287">else</span></u></td></tr>
<tr><th id="292">292</th><td><u>#define	<dfn class="macro" id="_M/BGE_EVCNT_INCR" data-ref="_M/BGE_EVCNT_INCR">BGE_EVCNT_INCR</dfn>(ev)	/* nothing */</u></td></tr>
<tr><th id="293">293</th><td><u>#define	<dfn class="macro" id="_M/BGE_EVCNT_ADD" data-ref="_M/BGE_EVCNT_ADD">BGE_EVCNT_ADD</dfn>(ev, val)	/* nothing */</u></td></tr>
<tr><th id="294">294</th><td><u>#define	<dfn class="macro" id="_M/BGE_EVCNT_UPD" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</dfn>(ev, val)	/* nothing */</u></td></tr>
<tr><th id="295">295</th><td><u>#<span data-ppcond="287">endif</span></u></td></tr>
<tr><th id="296">296</th><td></td></tr>
<tr><th id="297">297</th><td><u>#define <dfn class="macro" id="_M/VIDDID" data-ref="_M/VIDDID">VIDDID</dfn>(a, b) PCI_VENDOR_ ## a, PCI_PRODUCT_ ## a ## _ ## b</u></td></tr>
<tr><th id="298">298</th><td><i>/*</i></td></tr>
<tr><th id="299">299</th><td><i> * The BCM5700 documentation seems to indicate that the hardware still has the</i></td></tr>
<tr><th id="300">300</th><td><i> * Alteon vendor ID burned into it, though it should always be overridden by</i></td></tr>
<tr><th id="301">301</th><td><i> * the value in the EEPROM.  We'll check for it anyway.</i></td></tr>
<tr><th id="302">302</th><td><i> */</i></td></tr>
<tr><th id="303">303</th><td><em>static</em> <em>const</em> <b>struct</b> <dfn class="type def" id="bge_product" title='bge_product' data-ref="bge_product" data-ref-filename="bge_product"><a class="type" href="#bge_product" title='bge_product' data-ref="bge_product" data-ref-filename="bge_product">bge_product</a></dfn> {</td></tr>
<tr><th id="304">304</th><td>	<a class="typedef" href="pcireg.h.html#pci_vendor_id_t" title='pci_vendor_id_t' data-type='u_int16_t' data-ref="pci_vendor_id_t" data-ref-filename="pci_vendor_id_t">pci_vendor_id_t</a>		<dfn class="tu decl field" id="bge_product::bp_vendor" title='bge_product::bp_vendor' data-type='pci_vendor_id_t' data-ref="bge_product::bp_vendor" data-ref-filename="bge_product..bp_vendor">bp_vendor</dfn>;</td></tr>
<tr><th id="305">305</th><td>	<a class="typedef" href="pcireg.h.html#pci_product_id_t" title='pci_product_id_t' data-type='u_int16_t' data-ref="pci_product_id_t" data-ref-filename="pci_product_id_t">pci_product_id_t</a>	<dfn class="tu decl field" id="bge_product::bp_product" title='bge_product::bp_product' data-type='pci_product_id_t' data-ref="bge_product::bp_product" data-ref-filename="bge_product..bp_product">bp_product</dfn>;</td></tr>
<tr><th id="306">306</th><td>	<em>const</em> <em>char</em>		*<dfn class="tu decl field" id="bge_product::bp_name" title='bge_product::bp_name' data-type='const char *' data-ref="bge_product::bp_name" data-ref-filename="bge_product..bp_name">bp_name</dfn>;</td></tr>
<tr><th id="307">307</th><td>} <dfn class="tu decl def" id="bge_products" title='bge_products' data-type='const struct bge_product [99]' data-ref="bge_products" data-ref-filename="bge_products">bge_products</dfn>[] = {</td></tr>
<tr><th id="308">308</th><td>	{ <a class="macro" href="#297" title="0x12ae, 0x0003" data-ref="_M/VIDDID">VIDDID</a>(ALTEON,   BCM5700),	<q>"Broadcom BCM5700 Gigabit"</q> },</td></tr>
<tr><th id="309">309</th><td>	{ <a class="macro" href="#297" title="0x12ae, 0x0004" data-ref="_M/VIDDID">VIDDID</a>(ALTEON,   BCM5701),	<q>"Broadcom BCM5701 Gigabit"</q> },</td></tr>
<tr><th id="310">310</th><td>	{ <a class="macro" href="#297" title="0x173b, 0x03e8" data-ref="_M/VIDDID">VIDDID</a>(ALTIMA,   AC1000),	<q>"Altima AC1000 Gigabit"</q> },</td></tr>
<tr><th id="311">311</th><td>	{ <a class="macro" href="#297" title="0x173b, 0x03e9" data-ref="_M/VIDDID">VIDDID</a>(ALTIMA,   AC1001),	<q>"Altima AC1001 Gigabit"</q> },</td></tr>
<tr><th id="312">312</th><td>	{ <a class="macro" href="#297" title="0x173b, 0x03eb" data-ref="_M/VIDDID">VIDDID</a>(ALTIMA,   AC1003),	<q>"Altima AC1003 Gigabit"</q> },</td></tr>
<tr><th id="313">313</th><td>	{ <a class="macro" href="#297" title="0x173b, 0x03ea" data-ref="_M/VIDDID">VIDDID</a>(ALTIMA,   AC9100),	<q>"Altima AC9100 Gigabit"</q> },</td></tr>
<tr><th id="314">314</th><td>	{ <a class="macro" href="#297" title="0x106b, 0x1645" data-ref="_M/VIDDID">VIDDID</a>(APPLE,	   BCM5701),	<q>"APPLE BCM5701 Gigabit"</q> },</td></tr>
<tr><th id="315">315</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1644" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5700),	<q>"Broadcom BCM5700 Gigabit"</q> },</td></tr>
<tr><th id="316">316</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1645" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5701),	<q>"Broadcom BCM5701 Gigabit"</q> },</td></tr>
<tr><th id="317">317</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1646" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5702),	<q>"Broadcom BCM5702 Gigabit"</q> },</td></tr>
<tr><th id="318">318</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x164d" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5702FE),	<q>"Broadcom BCM5702FE Fast"</q> },</td></tr>
<tr><th id="319">319</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16a6" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5702X),	<q>"Broadcom BCM5702X Gigabit"</q> },</td></tr>
<tr><th id="320">320</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1647" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5703),	<q>"Broadcom BCM5703 Gigabit"</q> },</td></tr>
<tr><th id="321">321</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16a7" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5703X),	<q>"Broadcom BCM5703X Gigabit"</q> },</td></tr>
<tr><th id="322">322</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16c7" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5703_ALT),<q>"Broadcom BCM5703 Gigabit"</q> },</td></tr>
<tr><th id="323">323</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1648" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5704C),	<q>"Broadcom BCM5704C Dual Gigabit"</q> },</td></tr>
<tr><th id="324">324</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16a8" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5704S),	<q>"Broadcom BCM5704S Dual Gigabit"</q> },</td></tr>
<tr><th id="325">325</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1649" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5704S_ALT),<q>"Broadcom BCM5704S Dual Gigabit"</q> },</td></tr>
<tr><th id="326">326</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1653" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5705),	<q>"Broadcom BCM5705 Gigabit"</q> },</td></tr>
<tr><th id="327">327</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x166e" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5705F),	<q>"Broadcom BCM5705F Gigabit"</q> },</td></tr>
<tr><th id="328">328</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1654" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5705K),	<q>"Broadcom BCM5705K Gigabit"</q> },</td></tr>
<tr><th id="329">329</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x165d" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5705M),	<q>"Broadcom BCM5705M Gigabit"</q> },</td></tr>
<tr><th id="330">330</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x165e" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5705M_ALT),<q>"Broadcom BCM5705M Gigabit"</q> },</td></tr>
<tr><th id="331">331</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1668" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5714),	<q>"Broadcom BCM5714 Gigabit"</q> },</td></tr>
<tr><th id="332">332</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1669" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5714S),	<q>"Broadcom BCM5714S Gigabit"</q> },</td></tr>
<tr><th id="333">333</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1678" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5715),	<q>"Broadcom BCM5715 Gigabit"</q> },</td></tr>
<tr><th id="334">334</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1679" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5715S),	<q>"Broadcom BCM5715S Gigabit"</q> },</td></tr>
<tr><th id="335">335</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1655" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5717),	<q>"Broadcom BCM5717 Gigabit"</q> },</td></tr>
<tr><th id="336">336</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1665" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5717C),	<q>"Broadcom BCM5717 Gigabit"</q> },</td></tr>
<tr><th id="337">337</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1656" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5718),	<q>"Broadcom BCM5718 Gigabit"</q> },</td></tr>
<tr><th id="338">338</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1657" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5719),	<q>"Broadcom BCM5719 Gigabit"</q> },</td></tr>
<tr><th id="339">339</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x165f" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5720),	<q>"Broadcom BCM5720 Gigabit"</q> },</td></tr>
<tr><th id="340">340</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1659" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5721),	<q>"Broadcom BCM5721 Gigabit"</q> },</td></tr>
<tr><th id="341">341</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x165a" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5722),	<q>"Broadcom BCM5722 Gigabit"</q> },</td></tr>
<tr><th id="342">342</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x165b" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5723),	<q>"Broadcom BCM5723 Gigabit"</q> },</td></tr>
<tr><th id="343">343</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1643" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5725),	<q>"Broadcom BCM5725 Gigabit"</q> },</td></tr>
<tr><th id="344">344</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16f3" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5727),	<q>"Broadcom BCM5727 Gigabit"</q> },</td></tr>
<tr><th id="345">345</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1676" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5750),	<q>"Broadcom BCM5750 Gigabit"</q> },</td></tr>
<tr><th id="346">346</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1677" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5751),	<q>"Broadcom BCM5751 Gigabit"</q> },</td></tr>
<tr><th id="347">347</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x167e" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5751F),	<q>"Broadcom BCM5751F Gigabit"</q> },</td></tr>
<tr><th id="348">348</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x167d" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5751M),	<q>"Broadcom BCM5751M Gigabit"</q> },</td></tr>
<tr><th id="349">349</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1600" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5752),	<q>"Broadcom BCM5752 Gigabit"</q> },</td></tr>
<tr><th id="350">350</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1601" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5752M),	<q>"Broadcom BCM5752M Gigabit"</q> },</td></tr>
<tr><th id="351">351</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16f7" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5753),	<q>"Broadcom BCM5753 Gigabit"</q> },</td></tr>
<tr><th id="352">352</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16fe" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5753F),	<q>"Broadcom BCM5753F Gigabit"</q> },</td></tr>
<tr><th id="353">353</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16fd" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5753M),	<q>"Broadcom BCM5753M Gigabit"</q> },</td></tr>
<tr><th id="354">354</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x167a" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5754),	<q>"Broadcom BCM5754 Gigabit"</q> },</td></tr>
<tr><th id="355">355</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1672" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5754M),	<q>"Broadcom BCM5754M Gigabit"</q> },</td></tr>
<tr><th id="356">356</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x167b" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5755),	<q>"Broadcom BCM5755 Gigabit"</q> },</td></tr>
<tr><th id="357">357</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1673" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5755M),	<q>"Broadcom BCM5755M Gigabit"</q> },</td></tr>
<tr><th id="358">358</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1674" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5756),	<q>"Broadcom BCM5756 Gigabit"</q> },</td></tr>
<tr><th id="359">359</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1681" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5761),	<q>"Broadcom BCM5761 Gigabit"</q> },</td></tr>
<tr><th id="360">360</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1680" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5761E),	<q>"Broadcom BCM5761E Gigabit"</q> },</td></tr>
<tr><th id="361">361</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1688" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5761S),	<q>"Broadcom BCM5761S Gigabit"</q> },</td></tr>
<tr><th id="362">362</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1689" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5761SE),	<q>"Broadcom BCM5761SE Gigabit"</q> },</td></tr>
<tr><th id="363">363</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1687" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5762),	<q>"Broadcom BCM5762 Gigabit"</q> },</td></tr>
<tr><th id="364">364</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1684" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5764),	<q>"Broadcom BCM5764 Gigabit"</q> },</td></tr>
<tr><th id="365">365</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x166a" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5780),	<q>"Broadcom BCM5780 Gigabit"</q> },</td></tr>
<tr><th id="366">366</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x166b" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5780S),	<q>"Broadcom BCM5780S Gigabit"</q> },</td></tr>
<tr><th id="367">367</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16dd" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5781),	<q>"Broadcom BCM5781 Gigabit"</q> },</td></tr>
<tr><th id="368">368</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1696" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5782),	<q>"Broadcom BCM5782 Gigabit"</q> },</td></tr>
<tr><th id="369">369</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1698" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5784M),	<q>"BCM5784M NetLink 1000baseT"</q> },</td></tr>
<tr><th id="370">370</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16a0" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5785F),	<q>"BCM5785F NetLink 10/100"</q> },</td></tr>
<tr><th id="371">371</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1699" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5785G),	<q>"BCM5785G NetLink 1000baseT"</q> },</td></tr>
<tr><th id="372">372</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x169a" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5786),	<q>"Broadcom BCM5786 Gigabit"</q> },</td></tr>
<tr><th id="373">373</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x169b" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5787),	<q>"Broadcom BCM5787 Gigabit"</q> },</td></tr>
<tr><th id="374">374</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x167f" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5787F),	<q>"Broadcom BCM5787F 10/100"</q> },</td></tr>
<tr><th id="375">375</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1693" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5787M),	<q>"Broadcom BCM5787M Gigabit"</q> },</td></tr>
<tr><th id="376">376</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x169c" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5788),	<q>"Broadcom BCM5788 Gigabit"</q> },</td></tr>
<tr><th id="377">377</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x169d" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5789),	<q>"Broadcom BCM5789 Gigabit"</q> },</td></tr>
<tr><th id="378">378</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x170d" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5901),	<q>"Broadcom BCM5901 Fast"</q> },</td></tr>
<tr><th id="379">379</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x170e" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5901A2),	<q>"Broadcom BCM5901A2 Fast"</q> },</td></tr>
<tr><th id="380">380</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16ff" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5903M),	<q>"Broadcom BCM5903M Fast"</q> },</td></tr>
<tr><th id="381">381</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1712" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5906),	<q>"Broadcom BCM5906 Fast"</q> },</td></tr>
<tr><th id="382">382</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1713" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM5906M),	<q>"Broadcom BCM5906M Fast"</q> },</td></tr>
<tr><th id="383">383</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1690" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57760),	<q>"Broadcom BCM57760 Gigabit"</q> },</td></tr>
<tr><th id="384">384</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b0" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57761),	<q>"Broadcom BCM57761 Gigabit"</q> },</td></tr>
<tr><th id="385">385</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1682" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57762),	<q>"Broadcom BCM57762 Gigabit"</q> },</td></tr>
<tr><th id="386">386</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1642" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57764),	<q>"Broadcom BCM57764 Gigabit"</q> },</td></tr>
<tr><th id="387">387</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b4" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57765),	<q>"Broadcom BCM57765 Gigabit"</q> },</td></tr>
<tr><th id="388">388</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1686" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57766),	<q>"Broadcom BCM57766 Gigabit"</q> },</td></tr>
<tr><th id="389">389</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1683" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57767),	<q>"Broadcom BCM57767 Gigabit"</q> },</td></tr>
<tr><th id="390">390</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1692" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57780),	<q>"Broadcom BCM57780 Gigabit"</q> },</td></tr>
<tr><th id="391">391</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b1" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57781),	<q>"Broadcom BCM57781 Gigabit"</q> },</td></tr>
<tr><th id="392">392</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b7" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57782),	<q>"Broadcom BCM57782 Gigabit"</q> },</td></tr>
<tr><th id="393">393</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b5" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57785),	<q>"Broadcom BCM57785 Gigabit"</q> },</td></tr>
<tr><th id="394">394</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b3" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57786),	<q>"Broadcom BCM57786 Gigabit"</q> },</td></tr>
<tr><th id="395">395</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1641" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57787),	<q>"Broadcom BCM57787 Gigabit"</q> },</td></tr>
<tr><th id="396">396</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1691" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57788),	<q>"Broadcom BCM57788 Gigabit"</q> },</td></tr>
<tr><th id="397">397</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x1694" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57790),	<q>"Broadcom BCM57790 Gigabit"</q> },</td></tr>
<tr><th id="398">398</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b2" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57791),	<q>"Broadcom BCM57791 Gigabit"</q> },</td></tr>
<tr><th id="399">399</th><td>	{ <a class="macro" href="#297" title="0x14e4, 0x16b6" data-ref="_M/VIDDID">VIDDID</a>(BROADCOM, BCM57795),	<q>"Broadcom BCM57795 Gigabit"</q> },</td></tr>
<tr><th id="400">400</th><td>	{ <a class="macro" href="#297" title="0x1148, 0x4400" data-ref="_M/VIDDID">VIDDID</a>(SCHNEIDERKOCH, SK_9DX1),<q>"SysKonnect SK-9Dx1 Gigabit"</q> },</td></tr>
<tr><th id="401">401</th><td>	{ <a class="macro" href="#297" title="0x1148, 0x4500" data-ref="_M/VIDDID">VIDDID</a>(SCHNEIDERKOCH, SK_9MXX),<q>"SysKonnect SK-9Mxx Gigabit"</q> },</td></tr>
<tr><th id="402">402</th><td>	{ <a class="macro" href="#297" title="0x10b7, 0x0003" data-ref="_M/VIDDID">VIDDID</a>(<var>3COM</var>, <var>3C996</var>),		<q>"3Com 3c996 Gigabit"</q> },</td></tr>
<tr><th id="403">403</th><td>	{ <a class="macro" href="#297" title="0x10cf, 0x11a2" data-ref="_M/VIDDID">VIDDID</a>(FUJITSU4, PW008GE4),	<q>"Fujitsu PW008GE4 Gigabit"</q> },</td></tr>
<tr><th id="404">404</th><td>	{ <a class="macro" href="#297" title="0x10cf, 0x11a1" data-ref="_M/VIDDID">VIDDID</a>(FUJITSU4, PW008GE5),	<q>"Fujitsu PW008GE5 Gigabit"</q> },</td></tr>
<tr><th id="405">405</th><td>	{ <a class="macro" href="#297" title="0x10cf, 0x11cc" data-ref="_M/VIDDID">VIDDID</a>(FUJITSU4, PP250_450_LAN),<q>"Fujitsu Primepower 250/450 Gigabit"</q> },</td></tr>
<tr><th id="406">406</th><td>	{ <var>0</var>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> },</td></tr>
<tr><th id="407">407</th><td>};</td></tr>
<tr><th id="408">408</th><td></td></tr>
<tr><th id="409">409</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_JUMBO_CAPABLE" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</dfn>(sc)	((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_JUMBO_CAPABLE)</u></td></tr>
<tr><th id="410">410</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_5700_FAMILY" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_5700_FAMILY)</u></td></tr>
<tr><th id="411">411</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_5705_PLUS" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_5705_PLUS)</u></td></tr>
<tr><th id="412">412</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_5714_FAMILY" data-ref="_M/BGE_IS_5714_FAMILY">BGE_IS_5714_FAMILY</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_5714_FAMILY)</u></td></tr>
<tr><th id="413">413</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_575X_PLUS" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_575X_PLUS)</u></td></tr>
<tr><th id="414">414</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_5755_PLUS" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_5755_PLUS)</u></td></tr>
<tr><th id="415">415</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_57765_FAMILY" data-ref="_M/BGE_IS_57765_FAMILY">BGE_IS_57765_FAMILY</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_57765_FAMILY)</u></td></tr>
<tr><th id="416">416</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_57765_PLUS" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_57765_PLUS)</u></td></tr>
<tr><th id="417">417</th><td><u>#define <dfn class="macro" id="_M/BGE_IS_5717_PLUS" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</dfn>(sc)		((sc)-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; BGEF_5717_PLUS)</u></td></tr>
<tr><th id="418">418</th><td></td></tr>
<tr><th id="419">419</th><td><em>static</em> <em>const</em> <b>struct</b> <dfn class="type def" id="bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision"><a class="type" href="#bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision">bge_revision</a></dfn> {</td></tr>
<tr><th id="420">420</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="tu decl field" id="bge_revision::br_chipid" title='bge_revision::br_chipid' data-type='uint32_t' data-ref="bge_revision::br_chipid" data-ref-filename="bge_revision..br_chipid">br_chipid</dfn>;</td></tr>
<tr><th id="421">421</th><td>	<em>const</em> <em>char</em>		*<dfn class="tu decl field" id="bge_revision::br_name" title='bge_revision::br_name' data-type='const char *' data-ref="bge_revision::br_name" data-ref-filename="bge_revision..br_name">br_name</dfn>;</td></tr>
<tr><th id="422">422</th><td>} <dfn class="tu decl def" id="bge_revisions" title='bge_revisions' data-type='const struct bge_revision [70]' data-ref="bge_revisions" data-ref-filename="bge_revisions">bge_revisions</dfn>[] = {</td></tr>
<tr><th id="423">423</th><td>	{ <a class="macro" href="if_bgereg.h.html#285" title="0x7000" data-ref="_M/BGE_CHIPID_BCM5700_A0">BGE_CHIPID_BCM5700_A0</a>, <q>"BCM5700 A0"</q> },</td></tr>
<tr><th id="424">424</th><td>	{ <a class="macro" href="if_bgereg.h.html#286" title="0x7001" data-ref="_M/BGE_CHIPID_BCM5700_A1">BGE_CHIPID_BCM5700_A1</a>, <q>"BCM5700 A1"</q> },</td></tr>
<tr><th id="425">425</th><td>	{ <a class="macro" href="if_bgereg.h.html#287" title="0x7100" data-ref="_M/BGE_CHIPID_BCM5700_B0">BGE_CHIPID_BCM5700_B0</a>, <q>"BCM5700 B0"</q> },</td></tr>
<tr><th id="426">426</th><td>	{ <a class="macro" href="if_bgereg.h.html#288" title="0x7101" data-ref="_M/BGE_CHIPID_BCM5700_B1">BGE_CHIPID_BCM5700_B1</a>, <q>"BCM5700 B1"</q> },</td></tr>
<tr><th id="427">427</th><td>	{ <a class="macro" href="if_bgereg.h.html#289" title="0x7102" data-ref="_M/BGE_CHIPID_BCM5700_B2">BGE_CHIPID_BCM5700_B2</a>, <q>"BCM5700 B2"</q> },</td></tr>
<tr><th id="428">428</th><td>	{ <a class="macro" href="if_bgereg.h.html#290" title="0x7103" data-ref="_M/BGE_CHIPID_BCM5700_B3">BGE_CHIPID_BCM5700_B3</a>, <q>"BCM5700 B3"</q> },</td></tr>
<tr><th id="429">429</th><td>	{ <a class="macro" href="if_bgereg.h.html#291" title="0x7104" data-ref="_M/BGE_CHIPID_BCM5700_ALTIMA">BGE_CHIPID_BCM5700_ALTIMA</a>, <q>"BCM5700 Altima"</q> },</td></tr>
<tr><th id="430">430</th><td>	{ <a class="macro" href="if_bgereg.h.html#292" title="0x7200" data-ref="_M/BGE_CHIPID_BCM5700_C0">BGE_CHIPID_BCM5700_C0</a>, <q>"BCM5700 C0"</q> },</td></tr>
<tr><th id="431">431</th><td>	{ <a class="macro" href="if_bgereg.h.html#293" title="0x0000" data-ref="_M/BGE_CHIPID_BCM5701_A0">BGE_CHIPID_BCM5701_A0</a>, <q>"BCM5701 A0"</q> },</td></tr>
<tr><th id="432">432</th><td>	{ <a class="macro" href="if_bgereg.h.html#294" title="0x0100" data-ref="_M/BGE_CHIPID_BCM5701_B0">BGE_CHIPID_BCM5701_B0</a>, <q>"BCM5701 B0"</q> },</td></tr>
<tr><th id="433">433</th><td>	{ <a class="macro" href="if_bgereg.h.html#295" title="0x0102" data-ref="_M/BGE_CHIPID_BCM5701_B2">BGE_CHIPID_BCM5701_B2</a>, <q>"BCM5701 B2"</q> },</td></tr>
<tr><th id="434">434</th><td>	{ <a class="macro" href="if_bgereg.h.html#296" title="0x0105" data-ref="_M/BGE_CHIPID_BCM5701_B5">BGE_CHIPID_BCM5701_B5</a>, <q>"BCM5701 B5"</q> },</td></tr>
<tr><th id="435">435</th><td>	{ <a class="macro" href="if_bgereg.h.html#297" title="0x1000" data-ref="_M/BGE_CHIPID_BCM5703_A0">BGE_CHIPID_BCM5703_A0</a>, <q>"BCM5702/5703 A0"</q> },</td></tr>
<tr><th id="436">436</th><td>	{ <a class="macro" href="if_bgereg.h.html#298" title="0x1001" data-ref="_M/BGE_CHIPID_BCM5703_A1">BGE_CHIPID_BCM5703_A1</a>, <q>"BCM5702/5703 A1"</q> },</td></tr>
<tr><th id="437">437</th><td>	{ <a class="macro" href="if_bgereg.h.html#299" title="0x1002" data-ref="_M/BGE_CHIPID_BCM5703_A2">BGE_CHIPID_BCM5703_A2</a>, <q>"BCM5702/5703 A2"</q> },</td></tr>
<tr><th id="438">438</th><td>	{ <a class="macro" href="if_bgereg.h.html#300" title="0x1003" data-ref="_M/BGE_CHIPID_BCM5703_A3">BGE_CHIPID_BCM5703_A3</a>, <q>"BCM5702/5703 A3"</q> },</td></tr>
<tr><th id="439">439</th><td>	{ <a class="macro" href="if_bgereg.h.html#301" title="0x1100" data-ref="_M/BGE_CHIPID_BCM5703_B0">BGE_CHIPID_BCM5703_B0</a>, <q>"BCM5702/5703 B0"</q> },</td></tr>
<tr><th id="440">440</th><td>	{ <a class="macro" href="if_bgereg.h.html#302" title="0x2000" data-ref="_M/BGE_CHIPID_BCM5704_A0">BGE_CHIPID_BCM5704_A0</a>, <q>"BCM5704 A0"</q> },</td></tr>
<tr><th id="441">441</th><td>	{ <a class="macro" href="if_bgereg.h.html#303" title="0x2001" data-ref="_M/BGE_CHIPID_BCM5704_A1">BGE_CHIPID_BCM5704_A1</a>, <q>"BCM5704 A1"</q> },</td></tr>
<tr><th id="442">442</th><td>	{ <a class="macro" href="if_bgereg.h.html#304" title="0x2002" data-ref="_M/BGE_CHIPID_BCM5704_A2">BGE_CHIPID_BCM5704_A2</a>, <q>"BCM5704 A2"</q> },</td></tr>
<tr><th id="443">443</th><td>	{ <a class="macro" href="if_bgereg.h.html#305" title="0x2003" data-ref="_M/BGE_CHIPID_BCM5704_A3">BGE_CHIPID_BCM5704_A3</a>, <q>"BCM5704 A3"</q> },</td></tr>
<tr><th id="444">444</th><td>	{ <a class="macro" href="if_bgereg.h.html#306" title="0x2100" data-ref="_M/BGE_CHIPID_BCM5704_B0">BGE_CHIPID_BCM5704_B0</a>, <q>"BCM5704 B0"</q> },</td></tr>
<tr><th id="445">445</th><td>	{ <a class="macro" href="if_bgereg.h.html#307" title="0x3000" data-ref="_M/BGE_CHIPID_BCM5705_A0">BGE_CHIPID_BCM5705_A0</a>, <q>"BCM5705 A0"</q> },</td></tr>
<tr><th id="446">446</th><td>	{ <a class="macro" href="if_bgereg.h.html#308" title="0x3001" data-ref="_M/BGE_CHIPID_BCM5705_A1">BGE_CHIPID_BCM5705_A1</a>, <q>"BCM5705 A1"</q> },</td></tr>
<tr><th id="447">447</th><td>	{ <a class="macro" href="if_bgereg.h.html#309" title="0x3002" data-ref="_M/BGE_CHIPID_BCM5705_A2">BGE_CHIPID_BCM5705_A2</a>, <q>"BCM5705 A2"</q> },</td></tr>
<tr><th id="448">448</th><td>	{ <a class="macro" href="if_bgereg.h.html#310" title="0x3003" data-ref="_M/BGE_CHIPID_BCM5705_A3">BGE_CHIPID_BCM5705_A3</a>, <q>"BCM5705 A3"</q> },</td></tr>
<tr><th id="449">449</th><td>	{ <a class="macro" href="if_bgereg.h.html#311" title="0x4000" data-ref="_M/BGE_CHIPID_BCM5750_A0">BGE_CHIPID_BCM5750_A0</a>, <q>"BCM5750 A0"</q> },</td></tr>
<tr><th id="450">450</th><td>	{ <a class="macro" href="if_bgereg.h.html#312" title="0x4001" data-ref="_M/BGE_CHIPID_BCM5750_A1">BGE_CHIPID_BCM5750_A1</a>, <q>"BCM5750 A1"</q> },</td></tr>
<tr><th id="451">451</th><td>	{ <a class="macro" href="if_bgereg.h.html#313" title="0x4003" data-ref="_M/BGE_CHIPID_BCM5750_A3">BGE_CHIPID_BCM5750_A3</a>, <q>"BCM5750 A3"</q> },</td></tr>
<tr><th id="452">452</th><td>	{ <a class="macro" href="if_bgereg.h.html#314" title="0x4010" data-ref="_M/BGE_CHIPID_BCM5750_B0">BGE_CHIPID_BCM5750_B0</a>, <q>"BCM5750 B0"</q> },</td></tr>
<tr><th id="453">453</th><td>	{ <a class="macro" href="if_bgereg.h.html#315" title="0x4101" data-ref="_M/BGE_CHIPID_BCM5750_B1">BGE_CHIPID_BCM5750_B1</a>, <q>"BCM5750 B1"</q> },</td></tr>
<tr><th id="454">454</th><td>	{ <a class="macro" href="if_bgereg.h.html#316" title="0x4200" data-ref="_M/BGE_CHIPID_BCM5750_C0">BGE_CHIPID_BCM5750_C0</a>, <q>"BCM5750 C0"</q> },</td></tr>
<tr><th id="455">455</th><td>	{ <a class="macro" href="if_bgereg.h.html#317" title="0x4201" data-ref="_M/BGE_CHIPID_BCM5750_C1">BGE_CHIPID_BCM5750_C1</a>, <q>"BCM5750 C1"</q> },</td></tr>
<tr><th id="456">456</th><td>	{ <a class="macro" href="if_bgereg.h.html#318" title="0x4202" data-ref="_M/BGE_CHIPID_BCM5750_C2">BGE_CHIPID_BCM5750_C2</a>, <q>"BCM5750 C2"</q> },</td></tr>
<tr><th id="457">457</th><td>	{ <a class="macro" href="if_bgereg.h.html#325" title="0x6000" data-ref="_M/BGE_CHIPID_BCM5752_A0">BGE_CHIPID_BCM5752_A0</a>, <q>"BCM5752 A0"</q> },</td></tr>
<tr><th id="458">458</th><td>	{ <a class="macro" href="if_bgereg.h.html#326" title="0x6001" data-ref="_M/BGE_CHIPID_BCM5752_A1">BGE_CHIPID_BCM5752_A1</a>, <q>"BCM5752 A1"</q> },</td></tr>
<tr><th id="459">459</th><td>	{ <a class="macro" href="if_bgereg.h.html#327" title="0x6002" data-ref="_M/BGE_CHIPID_BCM5752_A2">BGE_CHIPID_BCM5752_A2</a>, <q>"BCM5752 A2"</q> },</td></tr>
<tr><th id="460">460</th><td>	{ <a class="macro" href="if_bgereg.h.html#319" title="0x5000" data-ref="_M/BGE_CHIPID_BCM5714_A0">BGE_CHIPID_BCM5714_A0</a>, <q>"BCM5714 A0"</q> },</td></tr>
<tr><th id="461">461</th><td>	{ <a class="macro" href="if_bgereg.h.html#328" title="0x8000" data-ref="_M/BGE_CHIPID_BCM5714_B0">BGE_CHIPID_BCM5714_B0</a>, <q>"BCM5714 B0"</q> },</td></tr>
<tr><th id="462">462</th><td>	{ <a class="macro" href="if_bgereg.h.html#329" title="0x8003" data-ref="_M/BGE_CHIPID_BCM5714_B3">BGE_CHIPID_BCM5714_B3</a>, <q>"BCM5714 B3"</q> },</td></tr>
<tr><th id="463">463</th><td>	{ <a class="macro" href="if_bgereg.h.html#330" title="0x9000" data-ref="_M/BGE_CHIPID_BCM5715_A0">BGE_CHIPID_BCM5715_A0</a>, <q>"BCM5715 A0"</q> },</td></tr>
<tr><th id="464">464</th><td>	{ <a class="macro" href="if_bgereg.h.html#331" title="0x9001" data-ref="_M/BGE_CHIPID_BCM5715_A1">BGE_CHIPID_BCM5715_A1</a>, <q>"BCM5715 A1"</q> },</td></tr>
<tr><th id="465">465</th><td>	{ <a class="macro" href="if_bgereg.h.html#332" title="0x9003" data-ref="_M/BGE_CHIPID_BCM5715_A3">BGE_CHIPID_BCM5715_A3</a>, <q>"BCM5715 A3"</q> },</td></tr>
<tr><th id="466">466</th><td>	{ <a class="macro" href="if_bgereg.h.html#345" title="0x05717000" data-ref="_M/BGE_CHIPID_BCM5717_A0">BGE_CHIPID_BCM5717_A0</a>, <q>"BCM5717 A0"</q> },</td></tr>
<tr><th id="467">467</th><td>	{ <a class="macro" href="if_bgereg.h.html#346" title="0x05717100" data-ref="_M/BGE_CHIPID_BCM5717_B0">BGE_CHIPID_BCM5717_B0</a>, <q>"BCM5717 B0"</q> },</td></tr>
<tr><th id="468">468</th><td>	{ <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a>, <q>"BCM5719 A0"</q> },</td></tr>
<tr><th id="469">469</th><td>	{ <a class="macro" href="if_bgereg.h.html#348" title="0x05720000" data-ref="_M/BGE_CHIPID_BCM5720_A0">BGE_CHIPID_BCM5720_A0</a>, <q>"BCM5720 A0"</q> },</td></tr>
<tr><th id="470">470</th><td>	{ <a class="macro" href="if_bgereg.h.html#333" title="0xa000" data-ref="_M/BGE_CHIPID_BCM5755_A0">BGE_CHIPID_BCM5755_A0</a>, <q>"BCM5755 A0"</q> },</td></tr>
<tr><th id="471">471</th><td>	{ <a class="macro" href="if_bgereg.h.html#334" title="0xa001" data-ref="_M/BGE_CHIPID_BCM5755_A1">BGE_CHIPID_BCM5755_A1</a>, <q>"BCM5755 A1"</q> },</td></tr>
<tr><th id="472">472</th><td>	{ <a class="macro" href="if_bgereg.h.html#335" title="0xa002" data-ref="_M/BGE_CHIPID_BCM5755_A2">BGE_CHIPID_BCM5755_A2</a>, <q>"BCM5755 A2"</q> },</td></tr>
<tr><th id="473">473</th><td>	{ <a class="macro" href="if_bgereg.h.html#336" title="0xa200" data-ref="_M/BGE_CHIPID_BCM5755_C0">BGE_CHIPID_BCM5755_C0</a>, <q>"BCM5755 C0"</q> },</td></tr>
<tr><th id="474">474</th><td>	{ <a class="macro" href="if_bgereg.h.html#320" title="0x5761000" data-ref="_M/BGE_CHIPID_BCM5761_A0">BGE_CHIPID_BCM5761_A0</a>, <q>"BCM5761 A0"</q> },</td></tr>
<tr><th id="475">475</th><td>	{ <a class="macro" href="if_bgereg.h.html#321" title="0x5761100" data-ref="_M/BGE_CHIPID_BCM5761_A1">BGE_CHIPID_BCM5761_A1</a>, <q>"BCM5761 A1"</q> },</td></tr>
<tr><th id="476">476</th><td>	{ <a class="macro" href="if_bgereg.h.html#349" title="0x05762000" data-ref="_M/BGE_CHIPID_BCM5762_A0">BGE_CHIPID_BCM5762_A0</a>, <q>"BCM5762 A0"</q> },</td></tr>
<tr><th id="477">477</th><td>	{ <a class="macro" href="if_bgereg.h.html#350" title="0x05762100" data-ref="_M/BGE_CHIPID_BCM5762_B0">BGE_CHIPID_BCM5762_B0</a>, <q>"BCM5762 B0"</q> },</td></tr>
<tr><th id="478">478</th><td>	{ <a class="macro" href="if_bgereg.h.html#322" title="0x5784000" data-ref="_M/BGE_CHIPID_BCM5784_A0">BGE_CHIPID_BCM5784_A0</a>, <q>"BCM5784 A0"</q> },</td></tr>
<tr><th id="479">479</th><td>	{ <a class="macro" href="if_bgereg.h.html#323" title="0x5784001" data-ref="_M/BGE_CHIPID_BCM5784_A1">BGE_CHIPID_BCM5784_A1</a>, <q>"BCM5784 A1"</q> },</td></tr>
<tr><th id="480">480</th><td>	{ <a class="macro" href="if_bgereg.h.html#324" title="0x5784100" data-ref="_M/BGE_CHIPID_BCM5784_B0">BGE_CHIPID_BCM5784_B0</a>, <q>"BCM5784 B0"</q> },</td></tr>
<tr><th id="481">481</th><td>	<i>/* 5754 and 5787 share the same ASIC ID */</i></td></tr>
<tr><th id="482">482</th><td>	{ <a class="macro" href="if_bgereg.h.html#337" title="0xb000" data-ref="_M/BGE_CHIPID_BCM5787_A0">BGE_CHIPID_BCM5787_A0</a>, <q>"BCM5754/5787 A0"</q> },</td></tr>
<tr><th id="483">483</th><td>	{ <a class="macro" href="if_bgereg.h.html#338" title="0xb001" data-ref="_M/BGE_CHIPID_BCM5787_A1">BGE_CHIPID_BCM5787_A1</a>, <q>"BCM5754/5787 A1"</q> },</td></tr>
<tr><th id="484">484</th><td>	{ <a class="macro" href="if_bgereg.h.html#339" title="0xb002" data-ref="_M/BGE_CHIPID_BCM5787_A2">BGE_CHIPID_BCM5787_A2</a>, <q>"BCM5754/5787 A2"</q> },</td></tr>
<tr><th id="485">485</th><td>	{ <a class="macro" href="if_bgereg.h.html#340" title="0xc000" data-ref="_M/BGE_CHIPID_BCM5906_A0">BGE_CHIPID_BCM5906_A0</a>, <q>"BCM5906 A0"</q> },</td></tr>
<tr><th id="486">486</th><td>	{ <a class="macro" href="if_bgereg.h.html#341" title="0xc001" data-ref="_M/BGE_CHIPID_BCM5906_A1">BGE_CHIPID_BCM5906_A1</a>, <q>"BCM5906 A1"</q> },</td></tr>
<tr><th id="487">487</th><td>	{ <a class="macro" href="if_bgereg.h.html#342" title="0xc002" data-ref="_M/BGE_CHIPID_BCM5906_A2">BGE_CHIPID_BCM5906_A2</a>, <q>"BCM5906 A2"</q> },</td></tr>
<tr><th id="488">488</th><td>	{ <a class="macro" href="if_bgereg.h.html#351" title="0x57785000" data-ref="_M/BGE_CHIPID_BCM57765_A0">BGE_CHIPID_BCM57765_A0</a>, <q>"BCM57765 A0"</q> },</td></tr>
<tr><th id="489">489</th><td>	{ <a class="macro" href="if_bgereg.h.html#352" title="0x57785100" data-ref="_M/BGE_CHIPID_BCM57765_B0">BGE_CHIPID_BCM57765_B0</a>, <q>"BCM57765 B0"</q> },</td></tr>
<tr><th id="490">490</th><td>	{ <a class="macro" href="if_bgereg.h.html#353" title="0x57766000" data-ref="_M/BGE_CHIPID_BCM57766_A0">BGE_CHIPID_BCM57766_A0</a>, <q>"BCM57766 A0"</q> },</td></tr>
<tr><th id="491">491</th><td>	{ <a class="macro" href="if_bgereg.h.html#343" title="0x57780000" data-ref="_M/BGE_CHIPID_BCM57780_A0">BGE_CHIPID_BCM57780_A0</a>, <q>"BCM57780 A0"</q> },</td></tr>
<tr><th id="492">492</th><td>	{ <a class="macro" href="if_bgereg.h.html#344" title="0x57780001" data-ref="_M/BGE_CHIPID_BCM57780_A1">BGE_CHIPID_BCM57780_A1</a>, <q>"BCM57780 A1"</q> },</td></tr>
<tr><th id="493">493</th><td></td></tr>
<tr><th id="494">494</th><td>	{ <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> }</td></tr>
<tr><th id="495">495</th><td>};</td></tr>
<tr><th id="496">496</th><td></td></tr>
<tr><th id="497">497</th><td><i  data-doc="bge_majorrevs">/*</i></td></tr>
<tr><th id="498">498</th><td><i  data-doc="bge_majorrevs"> * Some defaults for major revisions, so that newer steppings</i></td></tr>
<tr><th id="499">499</th><td><i  data-doc="bge_majorrevs"> * that we don't know about have a shot at working.</i></td></tr>
<tr><th id="500">500</th><td><i  data-doc="bge_majorrevs"> */</i></td></tr>
<tr><th id="501">501</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="#bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision">bge_revision</a> <dfn class="tu decl def" id="bge_majorrevs" title='bge_majorrevs' data-type='const struct bge_revision [24]' data-ref="bge_majorrevs" data-ref-filename="bge_majorrevs">bge_majorrevs</dfn>[] = {</td></tr>
<tr><th id="502">502</th><td>	{ <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a>, <q>"unknown BCM5700"</q> },</td></tr>
<tr><th id="503">503</th><td>	{ <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a>, <q>"unknown BCM5701"</q> },</td></tr>
<tr><th id="504">504</th><td>	{ <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a>, <q>"unknown BCM5703"</q> },</td></tr>
<tr><th id="505">505</th><td>	{ <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>, <q>"unknown BCM5704"</q> },</td></tr>
<tr><th id="506">506</th><td>	{ <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a>, <q>"unknown BCM5705"</q> },</td></tr>
<tr><th id="507">507</th><td>	{ <a class="macro" href="if_bgereg.h.html#362" title="0x04" data-ref="_M/BGE_ASICREV_BCM5750">BGE_ASICREV_BCM5750</a>, <q>"unknown BCM5750"</q> },</td></tr>
<tr><th id="508">508</th><td>	{ <a class="macro" href="if_bgereg.h.html#367" title="0x09" data-ref="_M/BGE_ASICREV_BCM5714">BGE_ASICREV_BCM5714</a>, <q>"unknown BCM5714"</q> },</td></tr>
<tr><th id="509">509</th><td>	{ <a class="macro" href="if_bgereg.h.html#363" title="0x05" data-ref="_M/BGE_ASICREV_BCM5714_A0">BGE_ASICREV_BCM5714_A0</a>, <q>"unknown BCM5714"</q> },</td></tr>
<tr><th id="510">510</th><td>	{ <a class="macro" href="if_bgereg.h.html#364" title="0x06" data-ref="_M/BGE_ASICREV_BCM5752">BGE_ASICREV_BCM5752</a>, <q>"unknown BCM5752"</q> },</td></tr>
<tr><th id="511">511</th><td>	{ <a class="macro" href="if_bgereg.h.html#366" title="0x08" data-ref="_M/BGE_ASICREV_BCM5780">BGE_ASICREV_BCM5780</a>, <q>"unknown BCM5780"</q> },</td></tr>
<tr><th id="512">512</th><td>	{ <a class="macro" href="if_bgereg.h.html#368" title="0x0a" data-ref="_M/BGE_ASICREV_BCM5755">BGE_ASICREV_BCM5755</a>, <q>"unknown BCM5755"</q> },</td></tr>
<tr><th id="513">513</th><td>	{ <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>, <q>"unknown BCM5761"</q> },</td></tr>
<tr><th id="514">514</th><td>	{ <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a>, <q>"unknown BCM5784"</q> },</td></tr>
<tr><th id="515">515</th><td>	{ <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>, <q>"unknown BCM5785"</q> },</td></tr>
<tr><th id="516">516</th><td>	<i>/* 5754 and 5787 share the same ASIC ID */</i></td></tr>
<tr><th id="517">517</th><td>	{ <a class="macro" href="if_bgereg.h.html#369" title="0x0b" data-ref="_M/BGE_ASICREV_BCM5787">BGE_ASICREV_BCM5787</a>, <q>"unknown BCM5754/5787"</q> },</td></tr>
<tr><th id="518">518</th><td>	{ <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>, <q>"unknown BCM5906"</q> },</td></tr>
<tr><th id="519">519</th><td>	{ <a class="macro" href="if_bgereg.h.html#379" title="0x57785" data-ref="_M/BGE_ASICREV_BCM57765">BGE_ASICREV_BCM57765</a>, <q>"unknown BCM57765"</q> },</td></tr>
<tr><th id="520">520</th><td>	{ <a class="macro" href="if_bgereg.h.html#380" title="0x57766" data-ref="_M/BGE_ASICREV_BCM57766">BGE_ASICREV_BCM57766</a>, <q>"unknown BCM57766"</q> },</td></tr>
<tr><th id="521">521</th><td>	{ <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>, <q>"unknown BCM57780"</q> },</td></tr>
<tr><th id="522">522</th><td>	{ <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a>, <q>"unknown BCM5717"</q> },</td></tr>
<tr><th id="523">523</th><td>	{ <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>, <q>"unknown BCM5719"</q> },</td></tr>
<tr><th id="524">524</th><td>	{ <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>, <q>"unknown BCM5720"</q> },</td></tr>
<tr><th id="525">525</th><td>	{ <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>, <q>"unknown BCM5762"</q> },</td></tr>
<tr><th id="526">526</th><td></td></tr>
<tr><th id="527">527</th><td>	{ <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> }</td></tr>
<tr><th id="528">528</th><td>};</td></tr>
<tr><th id="529">529</th><td></td></tr>
<tr><th id="530">530</th><td><em>static</em> <em>int</em> <dfn class="tu decl def" id="bge_allow_asf" title='bge_allow_asf' data-type='int' data-ref="bge_allow_asf" data-ref-filename="bge_allow_asf">bge_allow_asf</dfn> = <var>1</var>;</td></tr>
<tr><th id="531">531</th><td></td></tr>
<tr><th id="532">532</th><td><a class="macro" href="../../sys/device.h.html#336" title="struct cfattach bge_ca = { .ca_name = &quot;bge&quot;, .ca_devsize = sizeof(struct bge_softc), .ca_flags = (0x0080) | 0x0002, .ca_match = bge_probe, .ca_attach = bge_attach, .ca_detach = bge_detach, .ca_activate = ((void *)0), .ca_rescan = ((void *)0), .ca_childdetached = ((void *)0), }" data-ref="_M/CFATTACH_DECL3_NEW">CFATTACH_DECL3_NEW</a>(bge, <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a>),</td></tr>
<tr><th id="533">533</th><td>    <a class="tu ref fn" href="#bge_probe" title='bge_probe' data-ref="bge_probe" data-ref-filename="bge_probe">bge_probe</a>, <a class="tu ref fn" href="#bge_attach" title='bge_attach' data-ref="bge_attach" data-ref-filename="bge_attach">bge_attach</a>, <a class="tu ref fn" href="#bge_detach" title='bge_detach' data-ref="bge_detach" data-ref-filename="bge_detach">bge_detach</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/device.h.html#206" title="0x0080" data-ref="_M/DVF_DETACH_SHUTDOWN">DVF_DETACH_SHUTDOWN</a>);</td></tr>
<tr><th id="534">534</th><td></td></tr>
<tr><th id="535">535</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a></td></tr>
<tr><th id="536">536</th><td><dfn class="tu decl def fn" id="bge_readmem_ind" title='bge_readmem_ind' data-type='uint32_t bge_readmem_ind(struct bge_softc * sc, int off)' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="3sc" title='sc' data-type='struct bge_softc *' data-ref="3sc" data-ref-filename="3sc">sc</dfn>, <em>int</em> <dfn class="local col4 decl" id="4off" title='off' data-type='int' data-ref="4off" data-ref-filename="4off">off</dfn>)</td></tr>
<tr><th id="537">537</th><td>{</td></tr>
<tr><th id="538">538</th><td>	<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a> <dfn class="local col5 decl" id="5val" title='val' data-type='pcireg_t' data-ref="5val" data-ref-filename="5val">val</dfn>;</td></tr>
<tr><th id="539">539</th><td></td></tr>
<tr><th id="540">540</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a> &amp;&amp;</td></tr>
<tr><th id="541">541</th><td>	    <a class="local col4 ref" href="#4off" title='off' data-ref="4off" data-ref-filename="4off">off</a> &gt;= <a class="macro" href="if_bgereg.h.html#71" title="0x00000300" data-ref="_M/BGE_STATS_BLOCK">BGE_STATS_BLOCK</a> &amp;&amp; <a class="local col4 ref" href="#4off" title='off' data-ref="4off" data-ref-filename="4off">off</a> &lt; <a class="macro" href="if_bgereg.h.html#95" title="0x00004000" data-ref="_M/BGE_SEND_RING_1_TO_4">BGE_SEND_RING_1_TO_4</a>)</td></tr>
<tr><th id="542">542</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="543">543</th><td></td></tr>
<tr><th id="544">544</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#234" title="0x7C" data-ref="_M/BGE_PCI_MEMWIN_BASEADDR">BGE_PCI_MEMWIN_BASEADDR</a>, <a class="local col4 ref" href="#4off" title='off' data-ref="4off" data-ref-filename="4off">off</a>);</td></tr>
<tr><th id="545">545</th><td>	<a class="local col5 ref" href="#5val" title='val' data-ref="5val" data-ref-filename="5val">val</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#236" title="0x84" data-ref="_M/BGE_PCI_MEMWIN_DATA">BGE_PCI_MEMWIN_DATA</a>);</td></tr>
<tr><th id="546">546</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#3sc" title='sc' data-ref="3sc" data-ref-filename="3sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#234" title="0x7C" data-ref="_M/BGE_PCI_MEMWIN_BASEADDR">BGE_PCI_MEMWIN_BASEADDR</a>, <var>0</var>);</td></tr>
<tr><th id="547">547</th><td>	<b>return</b> <a class="local col5 ref" href="#5val" title='val' data-ref="5val" data-ref-filename="5val">val</a>;</td></tr>
<tr><th id="548">548</th><td>}</td></tr>
<tr><th id="549">549</th><td></td></tr>
<tr><th id="550">550</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="551">551</th><td><dfn class="tu decl def fn" id="bge_writemem_ind" title='bge_writemem_ind' data-type='void bge_writemem_ind(struct bge_softc * sc, int off, int val)' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="6sc" title='sc' data-type='struct bge_softc *' data-ref="6sc" data-ref-filename="6sc">sc</dfn>, <em>int</em> <dfn class="local col7 decl" id="7off" title='off' data-type='int' data-ref="7off" data-ref-filename="7off">off</dfn>, <em>int</em> <dfn class="local col8 decl" id="8val" title='val' data-type='int' data-ref="8val" data-ref-filename="8val">val</dfn>)</td></tr>
<tr><th id="552">552</th><td>{</td></tr>
<tr><th id="553">553</th><td></td></tr>
<tr><th id="554">554</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#234" title="0x7C" data-ref="_M/BGE_PCI_MEMWIN_BASEADDR">BGE_PCI_MEMWIN_BASEADDR</a>, <a class="local col7 ref" href="#7off" title='off' data-ref="7off" data-ref-filename="7off">off</a>);</td></tr>
<tr><th id="555">555</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#236" title="0x84" data-ref="_M/BGE_PCI_MEMWIN_DATA">BGE_PCI_MEMWIN_DATA</a>, <a class="local col8 ref" href="#8val" title='val' data-ref="8val" data-ref-filename="8val">val</a>);</td></tr>
<tr><th id="556">556</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#6sc" title='sc' data-ref="6sc" data-ref-filename="6sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#234" title="0x7C" data-ref="_M/BGE_PCI_MEMWIN_BASEADDR">BGE_PCI_MEMWIN_BASEADDR</a>, <var>0</var>);</td></tr>
<tr><th id="557">557</th><td>}</td></tr>
<tr><th id="558">558</th><td></td></tr>
<tr><th id="559">559</th><td><i  data-doc="bge_set_max_readrq">/*</i></td></tr>
<tr><th id="560">560</th><td><i  data-doc="bge_set_max_readrq"> * PCI Express only</i></td></tr>
<tr><th id="561">561</th><td><i  data-doc="bge_set_max_readrq"> */</i></td></tr>
<tr><th id="562">562</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="563">563</th><td><dfn class="tu decl def fn" id="bge_set_max_readrq" title='bge_set_max_readrq' data-type='void bge_set_max_readrq(struct bge_softc * sc)' data-ref="bge_set_max_readrq" data-ref-filename="bge_set_max_readrq">bge_set_max_readrq</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col9 decl" id="9sc" title='sc' data-type='struct bge_softc *' data-ref="9sc" data-ref-filename="9sc">sc</dfn>)</td></tr>
<tr><th id="564">564</th><td>{</td></tr>
<tr><th id="565">565</th><td>	<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a> <dfn class="local col0 decl" id="10val" title='val' data-type='pcireg_t' data-ref="10val" data-ref-filename="10val">val</dfn>;</td></tr>
<tr><th id="566">566</th><td></td></tr>
<tr><th id="567">567</th><td>	<a class="local col0 ref" href="#10val" title='val' data-ref="10val" data-ref-filename="10val">val</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a></td></tr>
<tr><th id="568">568</th><td>	    + <a class="macro" href="pcireg.h.html#982" title="0x08" data-ref="_M/PCIE_DCSR">PCIE_DCSR</a>);</td></tr>
<tr><th id="569">569</th><td>	<a class="local col0 ref" href="#10val" title='val' data-ref="10val" data-ref-filename="10val">val</a> &amp;= ~<a class="macro" href="pcireg.h.html#993" title="(((((uintmax_t)((( ((14))&gt;((12)))?((14)):((12))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((14))&gt;((12)))?((14)):((12))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((14))&lt;=((12)))?((14)):((12)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((14))&lt;=((12)))?((14)):((12)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/PCIE_DCSR_MAX_READ_REQ">PCIE_DCSR_MAX_READ_REQ</a>;</td></tr>
<tr><th id="570">570</th><td>	<b>switch</b> (<a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_expmrq" title='bge_softc::bge_expmrq' data-ref="bge_softc::bge_expmrq" data-ref-filename="bge_softc..bge_expmrq">bge_expmrq</a>) {</td></tr>
<tr><th id="571">571</th><td>	<b>case</b> <var>2048</var>:</td></tr>
<tr><th id="572">572</th><td>		<a class="local col0 ref" href="#10val" title='val' data-ref="10val" data-ref-filename="10val">val</a> |= <a class="macro" href="if_bgereg.h.html#219" title="0x4000" data-ref="_M/BGE_PCIE_DEVCTL_MAX_READRQ_2048">BGE_PCIE_DEVCTL_MAX_READRQ_2048</a>;</td></tr>
<tr><th id="573">573</th><td>		<b>break</b>;</td></tr>
<tr><th id="574">574</th><td>	<b>case</b> <var>4096</var>:</td></tr>
<tr><th id="575">575</th><td>		<a class="local col0 ref" href="#10val" title='val' data-ref="10val" data-ref-filename="10val">val</a> |= <a class="macro" href="if_bgereg.h.html#220" title="0x5000" data-ref="_M/BGE_PCIE_DEVCTL_MAX_READRQ_4096">BGE_PCIE_DEVCTL_MAX_READRQ_4096</a>;</td></tr>
<tr><th id="576">576</th><td>		<b>break</b>;</td></tr>
<tr><th id="577">577</th><td>	<b>default</b>:</td></tr>
<tr><th id="578">578</th><td>		<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"incorrect expmrq value(%d)"</q>, <a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_expmrq" title='bge_softc::bge_expmrq' data-ref="bge_softc::bge_expmrq" data-ref-filename="bge_softc..bge_expmrq">bge_expmrq</a>);</td></tr>
<tr><th id="579">579</th><td>		<b>break</b>;</td></tr>
<tr><th id="580">580</th><td>	}</td></tr>
<tr><th id="581">581</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col9 ref" href="#9sc" title='sc' data-ref="9sc" data-ref-filename="9sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a></td></tr>
<tr><th id="582">582</th><td>	    + <a class="macro" href="pcireg.h.html#982" title="0x08" data-ref="_M/PCIE_DCSR">PCIE_DCSR</a>, <a class="local col0 ref" href="#10val" title='val' data-ref="10val" data-ref-filename="10val">val</a>);</td></tr>
<tr><th id="583">583</th><td>}</td></tr>
<tr><th id="584">584</th><td></td></tr>
<tr><th id="585">585</th><td><u>#<span data-ppcond="585">ifdef</span> <span class="macro" data-ref="_M/notdef">notdef</span></u></td></tr>
<tr><th id="586">586</th><td><em>static</em> uint32_t</td></tr>
<tr><th id="587">587</th><td>bge_readreg_ind(<b>struct</b> bge_softc *sc, <em>int</em> off)</td></tr>
<tr><th id="588">588</th><td>{</td></tr>
<tr><th id="589">589</th><td>	pci_conf_write(sc-&gt;sc_pc, sc-&gt;sc_pcitag, BGE_PCI_REG_BASEADDR, off);</td></tr>
<tr><th id="590">590</th><td>	<b>return</b> (pci_conf_read(sc-&gt;sc_pc, sc-&gt;sc_pcitag, BGE_PCI_REG_DATA));</td></tr>
<tr><th id="591">591</th><td>}</td></tr>
<tr><th id="592">592</th><td><u>#<span data-ppcond="585">endif</span></u></td></tr>
<tr><th id="593">593</th><td></td></tr>
<tr><th id="594">594</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="595">595</th><td><dfn class="tu decl def fn" id="bge_writereg_ind" title='bge_writereg_ind' data-type='void bge_writereg_ind(struct bge_softc * sc, int off, int val)' data-ref="bge_writereg_ind" data-ref-filename="bge_writereg_ind">bge_writereg_ind</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="11sc" title='sc' data-type='struct bge_softc *' data-ref="11sc" data-ref-filename="11sc">sc</dfn>, <em>int</em> <dfn class="local col2 decl" id="12off" title='off' data-type='int' data-ref="12off" data-ref-filename="12off">off</dfn>, <em>int</em> <dfn class="local col3 decl" id="13val" title='val' data-type='int' data-ref="13val" data-ref-filename="13val">val</dfn>)</td></tr>
<tr><th id="596">596</th><td>{</td></tr>
<tr><th id="597">597</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col1 ref" href="#11sc" title='sc' data-ref="11sc" data-ref-filename="11sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col1 ref" href="#11sc" title='sc' data-ref="11sc" data-ref-filename="11sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#233" title="0x78" data-ref="_M/BGE_PCI_REG_BASEADDR">BGE_PCI_REG_BASEADDR</a>, <a class="local col2 ref" href="#12off" title='off' data-ref="12off" data-ref-filename="12off">off</a>);</td></tr>
<tr><th id="598">598</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col1 ref" href="#11sc" title='sc' data-ref="11sc" data-ref-filename="11sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col1 ref" href="#11sc" title='sc' data-ref="11sc" data-ref-filename="11sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#235" title="0x80" data-ref="_M/BGE_PCI_REG_DATA">BGE_PCI_REG_DATA</a>, <a class="local col3 ref" href="#13val" title='val' data-ref="13val" data-ref-filename="13val">val</a>);</td></tr>
<tr><th id="599">599</th><td>}</td></tr>
<tr><th id="600">600</th><td></td></tr>
<tr><th id="601">601</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="602">602</th><td><dfn class="tu decl def fn" id="bge_writemem_direct" title='bge_writemem_direct' data-type='void bge_writemem_direct(struct bge_softc * sc, int off, int val)' data-ref="bge_writemem_direct" data-ref-filename="bge_writemem_direct">bge_writemem_direct</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col4 decl" id="14sc" title='sc' data-type='struct bge_softc *' data-ref="14sc" data-ref-filename="14sc">sc</dfn>, <em>int</em> <dfn class="local col5 decl" id="15off" title='off' data-type='int' data-ref="15off" data-ref-filename="15off">off</dfn>, <em>int</em> <dfn class="local col6 decl" id="16val" title='val' data-type='int' data-ref="16val" data-ref-filename="16val">val</dfn>)</td></tr>
<tr><th id="603">603</th><td>{</td></tr>
<tr><th id="604">604</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, off, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col4 ref" href="#14sc" title='sc' data-ref="14sc" data-ref-filename="14sc">sc</a>, <a class="local col5 ref" href="#15off" title='off' data-ref="15off" data-ref-filename="15off">off</a>, <a class="local col6 ref" href="#16val" title='val' data-ref="16val" data-ref-filename="16val">val</a>);</td></tr>
<tr><th id="605">605</th><td>}</td></tr>
<tr><th id="606">606</th><td></td></tr>
<tr><th id="607">607</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="608">608</th><td><dfn class="tu decl def fn" id="bge_writembx" title='bge_writembx' data-type='void bge_writembx(struct bge_softc * sc, int off, int val)' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="17sc" title='sc' data-type='struct bge_softc *' data-ref="17sc" data-ref-filename="17sc">sc</dfn>, <em>int</em> <dfn class="local col8 decl" id="18off" title='off' data-type='int' data-ref="18off" data-ref-filename="18off">off</dfn>, <em>int</em> <dfn class="local col9 decl" id="19val" title='val' data-type='int' data-ref="19val" data-ref-filename="19val">val</dfn>)</td></tr>
<tr><th id="609">609</th><td>{</td></tr>
<tr><th id="610">610</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#17sc" title='sc' data-ref="17sc" data-ref-filename="17sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="611">611</th><td>		<a class="local col8 ref" href="#18off" title='off' data-ref="18off" data-ref-filename="18off">off</a> += <a class="macro" href="if_bgereg.h.html#1708" title="0x5800" data-ref="_M/BGE_LPMBX_IRQ0_HI">BGE_LPMBX_IRQ0_HI</a> - <a class="macro" href="if_bgereg.h.html#489" title="0x0200" data-ref="_M/BGE_MBX_IRQ0_HI">BGE_MBX_IRQ0_HI</a>;</td></tr>
<tr><th id="612">612</th><td></td></tr>
<tr><th id="613">613</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, off, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#17sc" title='sc' data-ref="17sc" data-ref-filename="17sc">sc</a>, <a class="local col8 ref" href="#18off" title='off' data-ref="18off" data-ref-filename="18off">off</a>, <a class="local col9 ref" href="#19val" title='val' data-ref="19val" data-ref-filename="19val">val</a>);</td></tr>
<tr><th id="614">614</th><td>}</td></tr>
<tr><th id="615">615</th><td></td></tr>
<tr><th id="616">616</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="617">617</th><td><dfn class="tu decl def fn" id="bge_writembx_flush" title='bge_writembx_flush' data-type='void bge_writembx_flush(struct bge_softc * sc, int off, int val)' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="20sc" title='sc' data-type='struct bge_softc *' data-ref="20sc" data-ref-filename="20sc">sc</dfn>, <em>int</em> <dfn class="local col1 decl" id="21off" title='off' data-type='int' data-ref="21off" data-ref-filename="21off">off</dfn>, <em>int</em> <dfn class="local col2 decl" id="22val" title='val' data-type='int' data-ref="22val" data-ref-filename="22val">val</dfn>)</td></tr>
<tr><th id="618">618</th><td>{</td></tr>
<tr><th id="619">619</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#20sc" title='sc' data-ref="20sc" data-ref-filename="20sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="620">620</th><td>		<a class="local col1 ref" href="#21off" title='off' data-ref="21off" data-ref-filename="21off">off</a> += <a class="macro" href="if_bgereg.h.html#1708" title="0x5800" data-ref="_M/BGE_LPMBX_IRQ0_HI">BGE_LPMBX_IRQ0_HI</a> - <a class="macro" href="if_bgereg.h.html#489" title="0x0200" data-ref="_M/BGE_MBX_IRQ0_HI">BGE_MBX_IRQ0_HI</a>;</td></tr>
<tr><th id="621">621</th><td></td></tr>
<tr><th id="622">622</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, off, val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, off); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col0 ref" href="#20sc" title='sc' data-ref="20sc" data-ref-filename="20sc">sc</a>, <a class="local col1 ref" href="#21off" title='off' data-ref="21off" data-ref-filename="21off">off</a>, <a class="local col2 ref" href="#22val" title='val' data-ref="22val" data-ref-filename="22val">val</a>);</td></tr>
<tr><th id="623">623</th><td>}</td></tr>
<tr><th id="624">624</th><td></td></tr>
<tr><th id="625">625</th><td><i  data-doc="bge_ape_lock_init">/*</i></td></tr>
<tr><th id="626">626</th><td><i  data-doc="bge_ape_lock_init"> * Clear all stale locks and select the lock for this driver instance.</i></td></tr>
<tr><th id="627">627</th><td><i  data-doc="bge_ape_lock_init"> */</i></td></tr>
<tr><th id="628">628</th><td><em>void</em></td></tr>
<tr><th id="629">629</th><td><dfn class="tu decl def fn" id="bge_ape_lock_init" title='bge_ape_lock_init' data-type='void bge_ape_lock_init(struct bge_softc * sc)' data-ref="bge_ape_lock_init" data-ref-filename="bge_ape_lock_init">bge_ape_lock_init</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="23sc" title='sc' data-type='struct bge_softc *' data-ref="23sc" data-ref-filename="23sc">sc</dfn>)</td></tr>
<tr><th id="630">630</th><td>{</td></tr>
<tr><th id="631">631</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col4 decl" id="24pa" title='pa' data-type='struct pci_attach_args *' data-ref="24pa" data-ref-filename="24pa">pa</dfn> = &amp;(<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pa" title='bge_softc::bge_pa' data-ref="bge_softc::bge_pa" data-ref-filename="bge_softc..bge_pa">bge_pa</a>);</td></tr>
<tr><th id="632">632</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="25bit" title='bit' data-type='uint32_t' data-ref="25bit" data-ref-filename="25bit">bit</dfn>, <dfn class="local col6 decl" id="26regbase" title='regbase' data-type='uint32_t' data-ref="26regbase" data-ref-filename="26regbase">regbase</dfn>;</td></tr>
<tr><th id="633">633</th><td>	<em>int</em> <dfn class="local col7 decl" id="27i" title='i' data-type='int' data-ref="27i" data-ref-filename="27i">i</dfn>;</td></tr>
<tr><th id="634">634</th><td></td></tr>
<tr><th id="635">635</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>)</td></tr>
<tr><th id="636">636</th><td>		<a class="local col6 ref" href="#26regbase" title='regbase' data-ref="26regbase" data-ref-filename="26regbase">regbase</a> = <a class="macro" href="if_bgereg.h.html#2120" title="0x004C" data-ref="_M/BGE_APE_LOCK_GRANT">BGE_APE_LOCK_GRANT</a>;</td></tr>
<tr><th id="637">637</th><td>	<b>else</b></td></tr>
<tr><th id="638">638</th><td>		<a class="local col6 ref" href="#26regbase" title='regbase' data-ref="26regbase" data-ref-filename="26regbase">regbase</a> = <a class="macro" href="if_bgereg.h.html#2201" title="0x8420" data-ref="_M/BGE_APE_PER_LOCK_GRANT">BGE_APE_PER_LOCK_GRANT</a>;</td></tr>
<tr><th id="639">639</th><td></td></tr>
<tr><th id="640">640</th><td>	<i>/* Clear any stale locks. */</i></td></tr>
<tr><th id="641">641</th><td>	<b>for</b> (<a class="local col7 ref" href="#27i" title='i' data-ref="27i" data-ref-filename="27i">i</a> = <a class="macro" href="if_bgereg.h.html#2214" title="0" data-ref="_M/BGE_APE_LOCK_PHY0">BGE_APE_LOCK_PHY0</a>; <a class="local col7 ref" href="#27i" title='i' data-ref="27i" data-ref-filename="27i">i</a> &lt;= <a class="macro" href="if_bgereg.h.html#2220" title="7" data-ref="_M/BGE_APE_LOCK_GPIO">BGE_APE_LOCK_GPIO</a>; <a class="local col7 ref" href="#27i" title='i' data-ref="27i" data-ref-filename="27i">i</a>++) {</td></tr>
<tr><th id="642">642</th><td>		<b>switch</b> (<a class="local col7 ref" href="#27i" title='i' data-ref="27i" data-ref-filename="27i">i</a>) {</td></tr>
<tr><th id="643">643</th><td>		<b>case</b> <a class="macro" href="if_bgereg.h.html#2214" title="0" data-ref="_M/BGE_APE_LOCK_PHY0">BGE_APE_LOCK_PHY0</a>:</td></tr>
<tr><th id="644">644</th><td>		<b>case</b> <a class="macro" href="if_bgereg.h.html#2216" title="2" data-ref="_M/BGE_APE_LOCK_PHY1">BGE_APE_LOCK_PHY1</a>:</td></tr>
<tr><th id="645">645</th><td>		<b>case</b> <a class="macro" href="if_bgereg.h.html#2217" title="3" data-ref="_M/BGE_APE_LOCK_PHY2">BGE_APE_LOCK_PHY2</a>:</td></tr>
<tr><th id="646">646</th><td>		<b>case</b> <a class="macro" href="if_bgereg.h.html#2219" title="5" data-ref="_M/BGE_APE_LOCK_PHY3">BGE_APE_LOCK_PHY3</a>:</td></tr>
<tr><th id="647">647</th><td>			<a class="local col5 ref" href="#25bit" title='bit' data-ref="25bit" data-ref-filename="25bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="648">648</th><td>			<b>break</b>;</td></tr>
<tr><th id="649">649</th><td>		<b>default</b>:</td></tr>
<tr><th id="650">650</th><td>			<b>if</b> (<a class="local col4 ref" href="#24pa" title='pa' data-ref="24pa" data-ref-filename="24pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="651">651</th><td>				<a class="local col5 ref" href="#25bit" title='bit' data-ref="25bit" data-ref-filename="25bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="652">652</th><td>			<b>else</b></td></tr>
<tr><th id="653">653</th><td>				<a class="local col5 ref" href="#25bit" title='bit' data-ref="25bit" data-ref-filename="25bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col4 ref" href="#24pa" title='pa' data-ref="24pa" data-ref-filename="24pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="654">654</th><td>		}</td></tr>
<tr><th id="655">655</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, regbase + 4 * i, bit)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>, <a class="local col6 ref" href="#26regbase" title='regbase' data-ref="26regbase" data-ref-filename="26regbase">regbase</a> + <var>4</var> * <a class="local col7 ref" href="#27i" title='i' data-ref="27i" data-ref-filename="27i">i</a>, <a class="local col5 ref" href="#25bit" title='bit' data-ref="25bit" data-ref-filename="25bit">bit</a>);</td></tr>
<tr><th id="656">656</th><td>	}</td></tr>
<tr><th id="657">657</th><td></td></tr>
<tr><th id="658">658</th><td>	<i>/* Select the PHY lock based on the device's function number. */</i></td></tr>
<tr><th id="659">659</th><td>	<b>switch</b> (<a class="local col4 ref" href="#24pa" title='pa' data-ref="24pa" data-ref-filename="24pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>) {</td></tr>
<tr><th id="660">660</th><td>	<b>case</b> <var>0</var>:</td></tr>
<tr><th id="661">661</th><td>		<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a> = <a class="macro" href="if_bgereg.h.html#2214" title="0" data-ref="_M/BGE_APE_LOCK_PHY0">BGE_APE_LOCK_PHY0</a>;</td></tr>
<tr><th id="662">662</th><td>		<b>break</b>;</td></tr>
<tr><th id="663">663</th><td>	<b>case</b> <var>1</var>:</td></tr>
<tr><th id="664">664</th><td>		<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a> = <a class="macro" href="if_bgereg.h.html#2216" title="2" data-ref="_M/BGE_APE_LOCK_PHY1">BGE_APE_LOCK_PHY1</a>;</td></tr>
<tr><th id="665">665</th><td>		<b>break</b>;</td></tr>
<tr><th id="666">666</th><td>	<b>case</b> <var>2</var>:</td></tr>
<tr><th id="667">667</th><td>		<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a> = <a class="macro" href="if_bgereg.h.html#2217" title="3" data-ref="_M/BGE_APE_LOCK_PHY2">BGE_APE_LOCK_PHY2</a>;</td></tr>
<tr><th id="668">668</th><td>		<b>break</b>;</td></tr>
<tr><th id="669">669</th><td>	<b>case</b> <var>3</var>:</td></tr>
<tr><th id="670">670</th><td>		<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a> = <a class="macro" href="if_bgereg.h.html#2219" title="5" data-ref="_M/BGE_APE_LOCK_PHY3">BGE_APE_LOCK_PHY3</a>;</td></tr>
<tr><th id="671">671</th><td>		<b>break</b>;</td></tr>
<tr><th id="672">672</th><td>	<b>default</b>:</td></tr>
<tr><th id="673">673</th><td>		<a class="ref fn" href="../../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"%s: PHY lock not supported on function\n"</q>,</td></tr>
<tr><th id="674">674</th><td>		    <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col3 ref" href="#23sc" title='sc' data-ref="23sc" data-ref-filename="23sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>));</td></tr>
<tr><th id="675">675</th><td>		<b>break</b>;</td></tr>
<tr><th id="676">676</th><td>	}</td></tr>
<tr><th id="677">677</th><td>}</td></tr>
<tr><th id="678">678</th><td></td></tr>
<tr><th id="679">679</th><td><i  data-doc="bge_ape_read_fw_ver">/*</i></td></tr>
<tr><th id="680">680</th><td><i  data-doc="bge_ape_read_fw_ver"> * Check for APE firmware, set flags, and print version info.</i></td></tr>
<tr><th id="681">681</th><td><i  data-doc="bge_ape_read_fw_ver"> */</i></td></tr>
<tr><th id="682">682</th><td><em>void</em></td></tr>
<tr><th id="683">683</th><td><dfn class="tu decl def fn" id="bge_ape_read_fw_ver" title='bge_ape_read_fw_ver' data-type='void bge_ape_read_fw_ver(struct bge_softc * sc)' data-ref="bge_ape_read_fw_ver" data-ref-filename="bge_ape_read_fw_ver">bge_ape_read_fw_ver</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="28sc" title='sc' data-type='struct bge_softc *' data-ref="28sc" data-ref-filename="28sc">sc</dfn>)</td></tr>
<tr><th id="684">684</th><td>{</td></tr>
<tr><th id="685">685</th><td>	<em>const</em> <em>char</em> *<dfn class="local col9 decl" id="29fwtype" title='fwtype' data-type='const char *' data-ref="29fwtype" data-ref-filename="29fwtype">fwtype</dfn>;</td></tr>
<tr><th id="686">686</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="30apedata" title='apedata' data-type='uint32_t' data-ref="30apedata" data-ref-filename="30apedata">apedata</dfn>, <dfn class="local col1 decl" id="31features" title='features' data-type='uint32_t' data-ref="31features" data-ref-filename="31features">features</dfn>;</td></tr>
<tr><th id="687">687</th><td></td></tr>
<tr><th id="688">688</th><td>	<i>/* Check for a valid APE signature in shared memory. */</i></td></tr>
<tr><th id="689">689</th><td>	<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4000)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2131" title="0x4000" data-ref="_M/BGE_APE_SEG_SIG">BGE_APE_SEG_SIG</a>);</td></tr>
<tr><th id="690">690</th><td>	<b>if</b> (<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> != <a class="macro" href="if_bgereg.h.html#2140" title="0x41504521" data-ref="_M/BGE_APE_SEG_SIG_MAGIC">BGE_APE_SEG_SIG_MAGIC</a>) {</td></tr>
<tr><th id="691">691</th><td>		<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp;= ~ <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>;</td></tr>
<tr><th id="692">692</th><td>		<b>return</b>;</td></tr>
<tr><th id="693">693</th><td>	}</td></tr>
<tr><th id="694">694</th><td></td></tr>
<tr><th id="695">695</th><td>	<i>/* Check if APE firmware is running. */</i></td></tr>
<tr><th id="696">696</th><td>	<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x400C)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2132" title="0x400C" data-ref="_M/BGE_APE_FW_STATUS">BGE_APE_FW_STATUS</a>);</td></tr>
<tr><th id="697">697</th><td>	<b>if</b> ((<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2142" title="0x00000100" data-ref="_M/BGE_APE_FW_STATUS_READY">BGE_APE_FW_STATUS_READY</a>) == <var>0</var>) {</td></tr>
<tr><th id="698">698</th><td>		<a class="ref fn" href="../../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"%s: APE signature found but FW status not ready! "</q></td></tr>
<tr><th id="699">699</th><td>		    <q>"0x%08x\n"</q>, <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>), <a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a>);</td></tr>
<tr><th id="700">700</th><td>		<b>return</b>;</td></tr>
<tr><th id="701">701</th><td>	}</td></tr>
<tr><th id="702">702</th><td></td></tr>
<tr><th id="703">703</th><td>	<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> |= <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>;</td></tr>
<tr><th id="704">704</th><td></td></tr>
<tr><th id="705">705</th><td>	<i>/* Fetch the APE firwmare type and version. */</i></td></tr>
<tr><th id="706">706</th><td>	<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4018)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2135" title="0x4018" data-ref="_M/BGE_APE_FW_VERSION">BGE_APE_FW_VERSION</a>);</td></tr>
<tr><th id="707">707</th><td>	<a class="local col1 ref" href="#31features" title='features' data-ref="31features" data-ref-filename="31features">features</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4010)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2133" title="0x4010" data-ref="_M/BGE_APE_FW_FEATURES">BGE_APE_FW_FEATURES</a>);</td></tr>
<tr><th id="708">708</th><td>	<b>if</b> ((<a class="local col1 ref" href="#31features" title='features' data-ref="31features" data-ref-filename="31features">features</a> &amp; <a class="macro" href="if_bgereg.h.html#2145" title="0x00000002" data-ref="_M/BGE_APE_FW_FEATURE_NCSI">BGE_APE_FW_FEATURE_NCSI</a>) != <var>0</var>) {</td></tr>
<tr><th id="709">709</th><td>		<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> |= <a class="macro" href="if_bgevar.h.html#292" title="0x00000004" data-ref="_M/BGE_MFW_TYPE_NCSI">BGE_MFW_TYPE_NCSI</a>;</td></tr>
<tr><th id="710">710</th><td>		<a class="local col9 ref" href="#29fwtype" title='fwtype' data-ref="29fwtype" data-ref-filename="29fwtype">fwtype</a> = <q>"NCSI"</q>;</td></tr>
<tr><th id="711">711</th><td>	} <b>else</b> <b>if</b> ((<a class="local col1 ref" href="#31features" title='features' data-ref="31features" data-ref-filename="31features">features</a> &amp; <a class="macro" href="if_bgereg.h.html#2144" title="0x00000001" data-ref="_M/BGE_APE_FW_FEATURE_DASH">BGE_APE_FW_FEATURE_DASH</a>) != <var>0</var>) {</td></tr>
<tr><th id="712">712</th><td>		<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> |= <a class="macro" href="if_bgevar.h.html#293" title="0x00000008" data-ref="_M/BGE_MFW_TYPE_DASH">BGE_MFW_TYPE_DASH</a>;</td></tr>
<tr><th id="713">713</th><td>		<a class="local col9 ref" href="#29fwtype" title='fwtype' data-ref="29fwtype" data-ref-filename="29fwtype">fwtype</a> = <q>"DASH"</q>;</td></tr>
<tr><th id="714">714</th><td>	} <b>else</b></td></tr>
<tr><th id="715">715</th><td>		<a class="local col9 ref" href="#29fwtype" title='fwtype' data-ref="29fwtype" data-ref-filename="29fwtype">fwtype</a> = <q>"UNKN"</q>;</td></tr>
<tr><th id="716">716</th><td></td></tr>
<tr><th id="717">717</th><td>	<i>/* Print the APE firmware version. */</i></td></tr>
<tr><th id="718">718</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_normal_dev" title='aprint_normal_dev' data-ref="aprint_normal_dev" data-ref-filename="aprint_normal_dev">aprint_normal_dev</a>(<a class="local col8 ref" href="#28sc" title='sc' data-ref="28sc" data-ref-filename="28sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"APE firmware %s %d.%d.%d.%d\n"</q>, <a class="local col9 ref" href="#29fwtype" title='fwtype' data-ref="29fwtype" data-ref-filename="29fwtype">fwtype</a>,</td></tr>
<tr><th id="719">719</th><td>	    (<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2147" title="0xFF000000" data-ref="_M/BGE_APE_FW_VERSION_MAJMSK">BGE_APE_FW_VERSION_MAJMSK</a>) &gt;&gt; <a class="macro" href="if_bgereg.h.html#2148" title="24" data-ref="_M/BGE_APE_FW_VERSION_MAJSFT">BGE_APE_FW_VERSION_MAJSFT</a>,</td></tr>
<tr><th id="720">720</th><td>	    (<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2149" title="0x00FF0000" data-ref="_M/BGE_APE_FW_VERSION_MINMSK">BGE_APE_FW_VERSION_MINMSK</a>) &gt;&gt; <a class="macro" href="if_bgereg.h.html#2150" title="16" data-ref="_M/BGE_APE_FW_VERSION_MINSFT">BGE_APE_FW_VERSION_MINSFT</a>,</td></tr>
<tr><th id="721">721</th><td>	    (<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2151" title="0x0000FF00" data-ref="_M/BGE_APE_FW_VERSION_REVMSK">BGE_APE_FW_VERSION_REVMSK</a>) &gt;&gt; <a class="macro" href="if_bgereg.h.html#2152" title="8" data-ref="_M/BGE_APE_FW_VERSION_REVSFT">BGE_APE_FW_VERSION_REVSFT</a>,</td></tr>
<tr><th id="722">722</th><td>	    (<a class="local col0 ref" href="#30apedata" title='apedata' data-ref="30apedata" data-ref-filename="30apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2153" title="0x000000FF" data-ref="_M/BGE_APE_FW_VERSION_BLDMSK">BGE_APE_FW_VERSION_BLDMSK</a>));</td></tr>
<tr><th id="723">723</th><td>}</td></tr>
<tr><th id="724">724</th><td></td></tr>
<tr><th id="725">725</th><td><em>int</em></td></tr>
<tr><th id="726">726</th><td><dfn class="tu decl def fn" id="bge_ape_lock" title='bge_ape_lock' data-type='int bge_ape_lock(struct bge_softc * sc, int locknum)' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col2 decl" id="32sc" title='sc' data-type='struct bge_softc *' data-ref="32sc" data-ref-filename="32sc">sc</dfn>, <em>int</em> <dfn class="local col3 decl" id="33locknum" title='locknum' data-type='int' data-ref="33locknum" data-ref-filename="33locknum">locknum</dfn>)</td></tr>
<tr><th id="727">727</th><td>{</td></tr>
<tr><th id="728">728</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col4 decl" id="34pa" title='pa' data-type='struct pci_attach_args *' data-ref="34pa" data-ref-filename="34pa">pa</dfn> = &amp;(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pa" title='bge_softc::bge_pa' data-ref="bge_softc::bge_pa" data-ref-filename="bge_softc..bge_pa">bge_pa</a>);</td></tr>
<tr><th id="729">729</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="35bit" title='bit' data-type='uint32_t' data-ref="35bit" data-ref-filename="35bit">bit</dfn>, <dfn class="local col6 decl" id="36gnt" title='gnt' data-type='uint32_t' data-ref="36gnt" data-ref-filename="36gnt">gnt</dfn>, <dfn class="local col7 decl" id="37req" title='req' data-type='uint32_t' data-ref="37req" data-ref-filename="37req">req</dfn>, <dfn class="local col8 decl" id="38status" title='status' data-type='uint32_t' data-ref="38status" data-ref-filename="38status">status</dfn>;</td></tr>
<tr><th id="730">730</th><td>	<em>int</em> <dfn class="local col9 decl" id="39i" title='i' data-type='int' data-ref="39i" data-ref-filename="39i">i</dfn>, <dfn class="local col0 decl" id="40off" title='off' data-type='int' data-ref="40off" data-ref-filename="40off">off</dfn>;</td></tr>
<tr><th id="731">731</th><td></td></tr>
<tr><th id="732">732</th><td>	<b>if</b> ((<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) == <var>0</var>)</td></tr>
<tr><th id="733">733</th><td>		<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="734">734</th><td></td></tr>
<tr><th id="735">735</th><td>	<i>/* Lock request/grant registers have different bases. */</i></td></tr>
<tr><th id="736">736</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>) {</td></tr>
<tr><th id="737">737</th><td>		<a class="local col7 ref" href="#37req" title='req' data-ref="37req" data-ref-filename="37req">req</a> = <a class="macro" href="if_bgereg.h.html#2119" title="0x002C" data-ref="_M/BGE_APE_LOCK_REQ">BGE_APE_LOCK_REQ</a>;</td></tr>
<tr><th id="738">738</th><td>		<a class="local col6 ref" href="#36gnt" title='gnt' data-ref="36gnt" data-ref-filename="36gnt">gnt</a> = <a class="macro" href="if_bgereg.h.html#2120" title="0x004C" data-ref="_M/BGE_APE_LOCK_GRANT">BGE_APE_LOCK_GRANT</a>;</td></tr>
<tr><th id="739">739</th><td>	} <b>else</b> {</td></tr>
<tr><th id="740">740</th><td>		<a class="local col7 ref" href="#37req" title='req' data-ref="37req" data-ref-filename="37req">req</a> = <a class="macro" href="if_bgereg.h.html#2200" title="0x8400" data-ref="_M/BGE_APE_PER_LOCK_REQ">BGE_APE_PER_LOCK_REQ</a>;</td></tr>
<tr><th id="741">741</th><td>		<a class="local col6 ref" href="#36gnt" title='gnt' data-ref="36gnt" data-ref-filename="36gnt">gnt</a> = <a class="macro" href="if_bgereg.h.html#2201" title="0x8420" data-ref="_M/BGE_APE_PER_LOCK_GRANT">BGE_APE_PER_LOCK_GRANT</a>;</td></tr>
<tr><th id="742">742</th><td>	}</td></tr>
<tr><th id="743">743</th><td></td></tr>
<tr><th id="744">744</th><td>	<a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a> = <var>4</var> * <a class="local col3 ref" href="#33locknum" title='locknum' data-ref="33locknum" data-ref-filename="33locknum">locknum</a>;</td></tr>
<tr><th id="745">745</th><td></td></tr>
<tr><th id="746">746</th><td>	<b>switch</b> (<a class="local col3 ref" href="#33locknum" title='locknum' data-ref="33locknum" data-ref-filename="33locknum">locknum</a>) {</td></tr>
<tr><th id="747">747</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2220" title="7" data-ref="_M/BGE_APE_LOCK_GPIO">BGE_APE_LOCK_GPIO</a>:</td></tr>
<tr><th id="748">748</th><td>		<i>/* Lock required when using GPIO. */</i></td></tr>
<tr><th id="749">749</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>)</td></tr>
<tr><th id="750">750</th><td>			<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="751">751</th><td>		<b>if</b> (<a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="752">752</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2126" title="0x00001000" data-ref="_M/BGE_APE_LOCK_REQ_DRIVER0">BGE_APE_LOCK_REQ_DRIVER0</a>;</td></tr>
<tr><th id="753">753</th><td>		<b>else</b></td></tr>
<tr><th id="754">754</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="755">755</th><td>		<b>break</b>;</td></tr>
<tr><th id="756">756</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2215" title="1" data-ref="_M/BGE_APE_LOCK_GRC">BGE_APE_LOCK_GRC</a>:</td></tr>
<tr><th id="757">757</th><td>		<i>/* Lock required to reset the device. */</i></td></tr>
<tr><th id="758">758</th><td>		<b>if</b> (<a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="759">759</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2126" title="0x00001000" data-ref="_M/BGE_APE_LOCK_REQ_DRIVER0">BGE_APE_LOCK_REQ_DRIVER0</a>;</td></tr>
<tr><th id="760">760</th><td>		<b>else</b></td></tr>
<tr><th id="761">761</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="762">762</th><td>		<b>break</b>;</td></tr>
<tr><th id="763">763</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2218" title="4" data-ref="_M/BGE_APE_LOCK_MEM">BGE_APE_LOCK_MEM</a>:</td></tr>
<tr><th id="764">764</th><td>		<i>/* Lock required when accessing certain APE memory. */</i></td></tr>
<tr><th id="765">765</th><td>		<b>if</b> (<a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="766">766</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2126" title="0x00001000" data-ref="_M/BGE_APE_LOCK_REQ_DRIVER0">BGE_APE_LOCK_REQ_DRIVER0</a>;</td></tr>
<tr><th id="767">767</th><td>		<b>else</b></td></tr>
<tr><th id="768">768</th><td>			<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col4 ref" href="#34pa" title='pa' data-ref="34pa" data-ref-filename="34pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="769">769</th><td>		<b>break</b>;</td></tr>
<tr><th id="770">770</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2214" title="0" data-ref="_M/BGE_APE_LOCK_PHY0">BGE_APE_LOCK_PHY0</a>:</td></tr>
<tr><th id="771">771</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2216" title="2" data-ref="_M/BGE_APE_LOCK_PHY1">BGE_APE_LOCK_PHY1</a>:</td></tr>
<tr><th id="772">772</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2217" title="3" data-ref="_M/BGE_APE_LOCK_PHY2">BGE_APE_LOCK_PHY2</a>:</td></tr>
<tr><th id="773">773</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2219" title="5" data-ref="_M/BGE_APE_LOCK_PHY3">BGE_APE_LOCK_PHY3</a>:</td></tr>
<tr><th id="774">774</th><td>		<i>/* Lock required when accessing PHYs. */</i></td></tr>
<tr><th id="775">775</th><td>		<a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2126" title="0x00001000" data-ref="_M/BGE_APE_LOCK_REQ_DRIVER0">BGE_APE_LOCK_REQ_DRIVER0</a>;</td></tr>
<tr><th id="776">776</th><td>		<b>break</b>;</td></tr>
<tr><th id="777">777</th><td>	<b>default</b>:</td></tr>
<tr><th id="778">778</th><td>		<b>return</b> (<a class="macro" href="../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="779">779</th><td>	}</td></tr>
<tr><th id="780">780</th><td></td></tr>
<tr><th id="781">781</th><td>	<i>/* Request a lock. */</i></td></tr>
<tr><th id="782">782</th><td>	<a class="macro" href="if_bgevar.h.html#131" title="do { bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, req + off, bit); bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, req + off); } while(0)" data-ref="_M/APE_WRITE_4_FLUSH">APE_WRITE_4_FLUSH</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>, <a class="local col7 ref" href="#37req" title='req' data-ref="37req" data-ref-filename="37req">req</a> + <a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a>, <a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a>);</td></tr>
<tr><th id="783">783</th><td></td></tr>
<tr><th id="784">784</th><td>	<i>/* Wait up to 1 second to acquire lock. */</i></td></tr>
<tr><th id="785">785</th><td>	<b>for</b> (<a class="local col9 ref" href="#39i" title='i' data-ref="39i" data-ref-filename="39i">i</a> = <var>0</var>; <a class="local col9 ref" href="#39i" title='i' data-ref="39i" data-ref-filename="39i">i</a> &lt; <var>20000</var>; <a class="local col9 ref" href="#39i" title='i' data-ref="39i" data-ref-filename="39i">i</a>++) {</td></tr>
<tr><th id="786">786</th><td>		<a class="local col8 ref" href="#38status" title='status' data-ref="38status" data-ref-filename="38status">status</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, gnt + off)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>, <a class="local col6 ref" href="#36gnt" title='gnt' data-ref="36gnt" data-ref-filename="36gnt">gnt</a> + <a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a>);</td></tr>
<tr><th id="787">787</th><td>		<b>if</b> (<a class="local col8 ref" href="#38status" title='status' data-ref="38status" data-ref-filename="38status">status</a> == <a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a>)</td></tr>
<tr><th id="788">788</th><td>			<b>break</b>;</td></tr>
<tr><th id="789">789</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(50)" data-ref="_M/DELAY">DELAY</a>(<var>50</var>);</td></tr>
<tr><th id="790">790</th><td>	}</td></tr>
<tr><th id="791">791</th><td></td></tr>
<tr><th id="792">792</th><td>	<i>/* Handle any errors. */</i></td></tr>
<tr><th id="793">793</th><td>	<b>if</b> (<a class="local col8 ref" href="#38status" title='status' data-ref="38status" data-ref-filename="38status">status</a> != <a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a>) {</td></tr>
<tr><th id="794">794</th><td>		<a class="ref fn" href="../../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"%s: APE lock %d request failed! "</q></td></tr>
<tr><th id="795">795</th><td>		    <q>"request = 0x%04x[0x%04x], status = 0x%04x[0x%04x]\n"</q>,</td></tr>
<tr><th id="796">796</th><td>		    <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>),</td></tr>
<tr><th id="797">797</th><td>		    <a class="local col3 ref" href="#33locknum" title='locknum' data-ref="33locknum" data-ref-filename="33locknum">locknum</a>, <a class="local col7 ref" href="#37req" title='req' data-ref="37req" data-ref-filename="37req">req</a> + <a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a>, <a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a> &amp; <var>0xFFFF</var>, <a class="local col6 ref" href="#36gnt" title='gnt' data-ref="36gnt" data-ref-filename="36gnt">gnt</a> + <a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a>,</td></tr>
<tr><th id="798">798</th><td>		    <a class="local col8 ref" href="#38status" title='status' data-ref="38status" data-ref-filename="38status">status</a> &amp; <var>0xFFFF</var>);</td></tr>
<tr><th id="799">799</th><td>		<i>/* Revoke the lock request. */</i></td></tr>
<tr><th id="800">800</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, gnt + off, bit)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col2 ref" href="#32sc" title='sc' data-ref="32sc" data-ref-filename="32sc">sc</a>, <a class="local col6 ref" href="#36gnt" title='gnt' data-ref="36gnt" data-ref-filename="36gnt">gnt</a> + <a class="local col0 ref" href="#40off" title='off' data-ref="40off" data-ref-filename="40off">off</a>, <a class="local col5 ref" href="#35bit" title='bit' data-ref="35bit" data-ref-filename="35bit">bit</a>);</td></tr>
<tr><th id="801">801</th><td>		<b>return</b> (<a class="macro" href="../../sys/errno.h.html#58" title="16" data-ref="_M/EBUSY">EBUSY</a>);</td></tr>
<tr><th id="802">802</th><td>	}</td></tr>
<tr><th id="803">803</th><td></td></tr>
<tr><th id="804">804</th><td>	<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="805">805</th><td>}</td></tr>
<tr><th id="806">806</th><td></td></tr>
<tr><th id="807">807</th><td><em>void</em></td></tr>
<tr><th id="808">808</th><td><dfn class="tu decl def fn" id="bge_ape_unlock" title='bge_ape_unlock' data-type='void bge_ape_unlock(struct bge_softc * sc, int locknum)' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="41sc" title='sc' data-type='struct bge_softc *' data-ref="41sc" data-ref-filename="41sc">sc</dfn>, <em>int</em> <dfn class="local col2 decl" id="42locknum" title='locknum' data-type='int' data-ref="42locknum" data-ref-filename="42locknum">locknum</dfn>)</td></tr>
<tr><th id="809">809</th><td>{</td></tr>
<tr><th id="810">810</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col3 decl" id="43pa" title='pa' data-type='struct pci_attach_args *' data-ref="43pa" data-ref-filename="43pa">pa</dfn> = &amp;(<a class="local col1 ref" href="#41sc" title='sc' data-ref="41sc" data-ref-filename="41sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pa" title='bge_softc::bge_pa' data-ref="bge_softc::bge_pa" data-ref-filename="bge_softc..bge_pa">bge_pa</a>);</td></tr>
<tr><th id="811">811</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="44bit" title='bit' data-type='uint32_t' data-ref="44bit" data-ref-filename="44bit">bit</dfn>, <dfn class="local col5 decl" id="45gnt" title='gnt' data-type='uint32_t' data-ref="45gnt" data-ref-filename="45gnt">gnt</dfn>;</td></tr>
<tr><th id="812">812</th><td>	<em>int</em> <dfn class="local col6 decl" id="46off" title='off' data-type='int' data-ref="46off" data-ref-filename="46off">off</dfn>;</td></tr>
<tr><th id="813">813</th><td></td></tr>
<tr><th id="814">814</th><td>	<b>if</b> ((<a class="local col1 ref" href="#41sc" title='sc' data-ref="41sc" data-ref-filename="41sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) == <var>0</var>)</td></tr>
<tr><th id="815">815</th><td>		<b>return</b>;</td></tr>
<tr><th id="816">816</th><td></td></tr>
<tr><th id="817">817</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col1 ref" href="#41sc" title='sc' data-ref="41sc" data-ref-filename="41sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>)</td></tr>
<tr><th id="818">818</th><td>		<a class="local col5 ref" href="#45gnt" title='gnt' data-ref="45gnt" data-ref-filename="45gnt">gnt</a> = <a class="macro" href="if_bgereg.h.html#2120" title="0x004C" data-ref="_M/BGE_APE_LOCK_GRANT">BGE_APE_LOCK_GRANT</a>;</td></tr>
<tr><th id="819">819</th><td>	<b>else</b></td></tr>
<tr><th id="820">820</th><td>		<a class="local col5 ref" href="#45gnt" title='gnt' data-ref="45gnt" data-ref-filename="45gnt">gnt</a> = <a class="macro" href="if_bgereg.h.html#2201" title="0x8420" data-ref="_M/BGE_APE_PER_LOCK_GRANT">BGE_APE_PER_LOCK_GRANT</a>;</td></tr>
<tr><th id="821">821</th><td></td></tr>
<tr><th id="822">822</th><td>	<a class="local col6 ref" href="#46off" title='off' data-ref="46off" data-ref-filename="46off">off</a> = <var>4</var> * <a class="local col2 ref" href="#42locknum" title='locknum' data-ref="42locknum" data-ref-filename="42locknum">locknum</a>;</td></tr>
<tr><th id="823">823</th><td></td></tr>
<tr><th id="824">824</th><td>	<b>switch</b> (<a class="local col2 ref" href="#42locknum" title='locknum' data-ref="42locknum" data-ref-filename="42locknum">locknum</a>) {</td></tr>
<tr><th id="825">825</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2220" title="7" data-ref="_M/BGE_APE_LOCK_GPIO">BGE_APE_LOCK_GPIO</a>:</td></tr>
<tr><th id="826">826</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col1 ref" href="#41sc" title='sc' data-ref="41sc" data-ref-filename="41sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>)</td></tr>
<tr><th id="827">827</th><td>			<b>return</b>;</td></tr>
<tr><th id="828">828</th><td>		<b>if</b> (<a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="829">829</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="830">830</th><td>		<b>else</b></td></tr>
<tr><th id="831">831</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="832">832</th><td>		<b>break</b>;</td></tr>
<tr><th id="833">833</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2215" title="1" data-ref="_M/BGE_APE_LOCK_GRC">BGE_APE_LOCK_GRC</a>:</td></tr>
<tr><th id="834">834</th><td>		<b>if</b> (<a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="835">835</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="836">836</th><td>		<b>else</b></td></tr>
<tr><th id="837">837</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="838">838</th><td>		<b>break</b>;</td></tr>
<tr><th id="839">839</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2218" title="4" data-ref="_M/BGE_APE_LOCK_MEM">BGE_APE_LOCK_MEM</a>:</td></tr>
<tr><th id="840">840</th><td>		<b>if</b> (<a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a> == <var>0</var>)</td></tr>
<tr><th id="841">841</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="842">842</th><td>		<b>else</b></td></tr>
<tr><th id="843">843</th><td>			<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = (<var>1</var> &lt;&lt; <a class="local col3 ref" href="#43pa" title='pa' data-ref="43pa" data-ref-filename="43pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>);</td></tr>
<tr><th id="844">844</th><td>		<b>break</b>;</td></tr>
<tr><th id="845">845</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2214" title="0" data-ref="_M/BGE_APE_LOCK_PHY0">BGE_APE_LOCK_PHY0</a>:</td></tr>
<tr><th id="846">846</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2216" title="2" data-ref="_M/BGE_APE_LOCK_PHY1">BGE_APE_LOCK_PHY1</a>:</td></tr>
<tr><th id="847">847</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2217" title="3" data-ref="_M/BGE_APE_LOCK_PHY2">BGE_APE_LOCK_PHY2</a>:</td></tr>
<tr><th id="848">848</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#2219" title="5" data-ref="_M/BGE_APE_LOCK_PHY3">BGE_APE_LOCK_PHY3</a>:</td></tr>
<tr><th id="849">849</th><td>		<a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a> = <a class="macro" href="if_bgereg.h.html#2128" title="0x00001000" data-ref="_M/BGE_APE_LOCK_GRANT_DRIVER0">BGE_APE_LOCK_GRANT_DRIVER0</a>;</td></tr>
<tr><th id="850">850</th><td>		<b>break</b>;</td></tr>
<tr><th id="851">851</th><td>	<b>default</b>:</td></tr>
<tr><th id="852">852</th><td>		<b>return</b>;</td></tr>
<tr><th id="853">853</th><td>	}</td></tr>
<tr><th id="854">854</th><td></td></tr>
<tr><th id="855">855</th><td>	<i>/* Write and flush for consecutive bge_ape_lock() */</i></td></tr>
<tr><th id="856">856</th><td>	<a class="macro" href="if_bgevar.h.html#131" title="do { bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, gnt + off, bit); bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, gnt + off); } while(0)" data-ref="_M/APE_WRITE_4_FLUSH">APE_WRITE_4_FLUSH</a>(<a class="local col1 ref" href="#41sc" title='sc' data-ref="41sc" data-ref-filename="41sc">sc</a>, <a class="local col5 ref" href="#45gnt" title='gnt' data-ref="45gnt" data-ref-filename="45gnt">gnt</a> + <a class="local col6 ref" href="#46off" title='off' data-ref="46off" data-ref-filename="46off">off</a>, <a class="local col4 ref" href="#44bit" title='bit' data-ref="44bit" data-ref-filename="44bit">bit</a>);</td></tr>
<tr><th id="857">857</th><td>}</td></tr>
<tr><th id="858">858</th><td></td></tr>
<tr><th id="859">859</th><td><i  data-doc="bge_ape_send_event">/*</i></td></tr>
<tr><th id="860">860</th><td><i  data-doc="bge_ape_send_event"> * Send an event to the APE firmware.</i></td></tr>
<tr><th id="861">861</th><td><i  data-doc="bge_ape_send_event"> */</i></td></tr>
<tr><th id="862">862</th><td><em>void</em></td></tr>
<tr><th id="863">863</th><td><dfn class="tu decl def fn" id="bge_ape_send_event" title='bge_ape_send_event' data-type='void bge_ape_send_event(struct bge_softc * sc, uint32_t event)' data-ref="bge_ape_send_event" data-ref-filename="bge_ape_send_event">bge_ape_send_event</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="47sc" title='sc' data-type='struct bge_softc *' data-ref="47sc" data-ref-filename="47sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="48event" title='event' data-type='uint32_t' data-ref="48event" data-ref-filename="48event">event</dfn>)</td></tr>
<tr><th id="864">864</th><td>{</td></tr>
<tr><th id="865">865</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="49apedata" title='apedata' data-type='uint32_t' data-ref="49apedata" data-ref-filename="49apedata">apedata</dfn>;</td></tr>
<tr><th id="866">866</th><td>	<em>int</em> <dfn class="local col0 decl" id="50i" title='i' data-type='int' data-ref="50i" data-ref-filename="50i">i</dfn>;</td></tr>
<tr><th id="867">867</th><td></td></tr>
<tr><th id="868">868</th><td>	<i>/* NCSI does not support APE events. */</i></td></tr>
<tr><th id="869">869</th><td>	<b>if</b> ((<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) == <var>0</var>)</td></tr>
<tr><th id="870">870</th><td>		<b>return</b>;</td></tr>
<tr><th id="871">871</th><td></td></tr>
<tr><th id="872">872</th><td>	<i>/* Wait up to 1ms for APE to service previous event. */</i></td></tr>
<tr><th id="873">873</th><td>	<b>for</b> (<a class="local col0 ref" href="#50i" title='i' data-ref="50i" data-ref-filename="50i">i</a> = <var>10</var>; <a class="local col0 ref" href="#50i" title='i' data-ref="50i" data-ref-filename="50i">i</a> &gt; <var>0</var>; <a class="local col0 ref" href="#50i" title='i' data-ref="50i" data-ref-filename="50i">i</a>--) {</td></tr>
<tr><th id="874">874</th><td>		<b>if</b> (<a class="tu ref fn" href="#bge_ape_lock" title='bge_ape_lock' data-use='c' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2218" title="4" data-ref="_M/BGE_APE_LOCK_MEM">BGE_APE_LOCK_MEM</a>) != <var>0</var>)</td></tr>
<tr><th id="875">875</th><td>			<b>break</b>;</td></tr>
<tr><th id="876">876</th><td>		<a class="local col9 ref" href="#49apedata" title='apedata' data-ref="49apedata" data-ref-filename="49apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4300)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2187" title="0x4300" data-ref="_M/BGE_APE_EVENT_STATUS">BGE_APE_EVENT_STATUS</a>);</td></tr>
<tr><th id="877">877</th><td>		<b>if</b> ((<a class="local col9 ref" href="#49apedata" title='apedata' data-ref="49apedata" data-ref-filename="49apedata">apedata</a> &amp; <a class="macro" href="if_bgereg.h.html#2195" title="0x80000000" data-ref="_M/BGE_APE_EVENT_STATUS_EVENT_PENDING">BGE_APE_EVENT_STATUS_EVENT_PENDING</a>) == <var>0</var>) {</td></tr>
<tr><th id="878">878</th><td>			<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4300, event | 0x80000000)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2187" title="0x4300" data-ref="_M/BGE_APE_EVENT_STATUS">BGE_APE_EVENT_STATUS</a>, <a class="local col8 ref" href="#48event" title='event' data-ref="48event" data-ref-filename="48event">event</a> |</td></tr>
<tr><th id="879">879</th><td>			    <a class="macro" href="if_bgereg.h.html#2195" title="0x80000000" data-ref="_M/BGE_APE_EVENT_STATUS_EVENT_PENDING">BGE_APE_EVENT_STATUS_EVENT_PENDING</a>);</td></tr>
<tr><th id="880">880</th><td>			<a class="tu ref fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-use='c' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2218" title="4" data-ref="_M/BGE_APE_LOCK_MEM">BGE_APE_LOCK_MEM</a>);</td></tr>
<tr><th id="881">881</th><td>			<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x000C, 0x00000001)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2118" title="0x000C" data-ref="_M/BGE_APE_EVENT">BGE_APE_EVENT</a>, <a class="macro" href="if_bgereg.h.html#2124" title="0x00000001" data-ref="_M/BGE_APE_EVENT_1">BGE_APE_EVENT_1</a>);</td></tr>
<tr><th id="882">882</th><td>			<b>break</b>;</td></tr>
<tr><th id="883">883</th><td>		}</td></tr>
<tr><th id="884">884</th><td>		<a class="tu ref fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-use='c' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2218" title="4" data-ref="_M/BGE_APE_LOCK_MEM">BGE_APE_LOCK_MEM</a>);</td></tr>
<tr><th id="885">885</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(100)" data-ref="_M/DELAY">DELAY</a>(<var>100</var>);</td></tr>
<tr><th id="886">886</th><td>	}</td></tr>
<tr><th id="887">887</th><td>	<b>if</b> (<a class="local col0 ref" href="#50i" title='i' data-ref="50i" data-ref-filename="50i">i</a> == <var>0</var>) {</td></tr>
<tr><th id="888">888</th><td>		<a class="ref fn" href="../../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"%s: APE event 0x%08x send timed out\n"</q>,</td></tr>
<tr><th id="889">889</th><td>		    <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col7 ref" href="#47sc" title='sc' data-ref="47sc" data-ref-filename="47sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>), <a class="local col8 ref" href="#48event" title='event' data-ref="48event" data-ref-filename="48event">event</a>);</td></tr>
<tr><th id="890">890</th><td>	}</td></tr>
<tr><th id="891">891</th><td>}</td></tr>
<tr><th id="892">892</th><td></td></tr>
<tr><th id="893">893</th><td><em>void</em></td></tr>
<tr><th id="894">894</th><td><dfn class="tu decl def fn" id="bge_ape_driver_state_change" title='bge_ape_driver_state_change' data-type='void bge_ape_driver_state_change(struct bge_softc * sc, int kind)' data-ref="bge_ape_driver_state_change" data-ref-filename="bge_ape_driver_state_change">bge_ape_driver_state_change</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="51sc" title='sc' data-type='struct bge_softc *' data-ref="51sc" data-ref-filename="51sc">sc</dfn>, <em>int</em> <dfn class="local col2 decl" id="52kind" title='kind' data-type='int' data-ref="52kind" data-ref-filename="52kind">kind</dfn>)</td></tr>
<tr><th id="895">895</th><td>{</td></tr>
<tr><th id="896">896</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="53apedata" title='apedata' data-type='uint32_t' data-ref="53apedata" data-ref-filename="53apedata">apedata</dfn>, <dfn class="local col4 decl" id="54event" title='event' data-type='uint32_t' data-ref="54event" data-ref-filename="54event">event</dfn>;</td></tr>
<tr><th id="897">897</th><td></td></tr>
<tr><th id="898">898</th><td>	<b>if</b> ((<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) == <var>0</var>)</td></tr>
<tr><th id="899">899</th><td>		<b>return</b>;</td></tr>
<tr><th id="900">900</th><td></td></tr>
<tr><th id="901">901</th><td>	<b>switch</b> (<a class="local col2 ref" href="#52kind" title='kind' data-ref="52kind" data-ref-filename="52kind">kind</a>) {</td></tr>
<tr><th id="902">902</th><td>	<b>case</b> <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>:</td></tr>
<tr><th id="903">903</th><td>		<i>/* If this is the first load, clear the load counter. */</i></td></tr>
<tr><th id="904">904</th><td>		<a class="local col3 ref" href="#53apedata" title='apedata' data-ref="53apedata" data-ref-filename="53apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4200)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2156" title="0x4200" data-ref="_M/BGE_APE_HOST_SEG_SIG">BGE_APE_HOST_SEG_SIG</a>);</td></tr>
<tr><th id="905">905</th><td>		<b>if</b> (<a class="local col3 ref" href="#53apedata" title='apedata' data-ref="53apedata" data-ref-filename="53apedata">apedata</a> != <a class="macro" href="if_bgereg.h.html#2166" title="0x484F5354" data-ref="_M/BGE_APE_HOST_SEG_SIG_MAGIC">BGE_APE_HOST_SEG_SIG_MAGIC</a>)</td></tr>
<tr><th id="906">906</th><td>			<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4208, 0)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2158" title="0x4208" data-ref="_M/BGE_APE_HOST_INIT_COUNT">BGE_APE_HOST_INIT_COUNT</a>, <var>0</var>);</td></tr>
<tr><th id="907">907</th><td>		<b>else</b> {</td></tr>
<tr><th id="908">908</th><td>			<a class="local col3 ref" href="#53apedata" title='apedata' data-ref="53apedata" data-ref-filename="53apedata">apedata</a> = <a class="macro" href="if_bgevar.h.html#128" title="bus_space_read_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4208)" data-ref="_M/APE_READ_4">APE_READ_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2158" title="0x4208" data-ref="_M/BGE_APE_HOST_INIT_COUNT">BGE_APE_HOST_INIT_COUNT</a>);</td></tr>
<tr><th id="909">909</th><td>			<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4208, ++apedata)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2158" title="0x4208" data-ref="_M/BGE_APE_HOST_INIT_COUNT">BGE_APE_HOST_INIT_COUNT</a>, ++<a class="local col3 ref" href="#53apedata" title='apedata' data-ref="53apedata" data-ref-filename="53apedata">apedata</a>);</td></tr>
<tr><th id="910">910</th><td>		}</td></tr>
<tr><th id="911">911</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4200, 0x484F5354)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2156" title="0x4200" data-ref="_M/BGE_APE_HOST_SEG_SIG">BGE_APE_HOST_SEG_SIG</a>,</td></tr>
<tr><th id="912">912</th><td>		    <a class="macro" href="if_bgereg.h.html#2166" title="0x484F5354" data-ref="_M/BGE_APE_HOST_SEG_SIG_MAGIC">BGE_APE_HOST_SEG_SIG_MAGIC</a>);</td></tr>
<tr><th id="913">913</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4204, 0x00000020)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2157" title="0x4204" data-ref="_M/BGE_APE_HOST_SEG_LEN">BGE_APE_HOST_SEG_LEN</a>,</td></tr>
<tr><th id="914">914</th><td>		    <a class="macro" href="if_bgereg.h.html#2168" title="0x00000020" data-ref="_M/BGE_APE_HOST_SEG_LEN_MAGIC">BGE_APE_HOST_SEG_LEN_MAGIC</a>);</td></tr>
<tr><th id="915">915</th><td></td></tr>
<tr><th id="916">916</th><td>		<i>/* Add some version info if bge(4) supports it. */</i></td></tr>
<tr><th id="917">917</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x420C, (0xF6000000 | ((1) &amp; 0xffd) &lt;&lt; 16 | ((0) &amp; 0xff) &lt;&lt; 8))" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2159" title="0x420C" data-ref="_M/BGE_APE_HOST_DRIVER_ID">BGE_APE_HOST_DRIVER_ID</a>,</td></tr>
<tr><th id="918">918</th><td>		    <a class="macro" href="if_bgereg.h.html#2171" title="(0xF6000000 | ((1) &amp; 0xffd) &lt;&lt; 16 | ((0) &amp; 0xff) &lt;&lt; 8)" data-ref="_M/BGE_APE_HOST_DRIVER_ID_MAGIC">BGE_APE_HOST_DRIVER_ID_MAGIC</a>(<var>1</var>, <var>0</var>));</td></tr>
<tr><th id="919">919</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4210, 0x00000001)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2160" title="0x4210" data-ref="_M/BGE_APE_HOST_BEHAVIOR">BGE_APE_HOST_BEHAVIOR</a>,</td></tr>
<tr><th id="920">920</th><td>		    <a class="macro" href="if_bgereg.h.html#2175" title="0x00000001" data-ref="_M/BGE_APE_HOST_BEHAV_NO_PHYLOCK">BGE_APE_HOST_BEHAV_NO_PHYLOCK</a>);</td></tr>
<tr><th id="921">921</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x4214, 0)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2161" title="0x4214" data-ref="_M/BGE_APE_HOST_HEARTBEAT_INT_MS">BGE_APE_HOST_HEARTBEAT_INT_MS</a>,</td></tr>
<tr><th id="922">922</th><td>		    <a class="macro" href="if_bgereg.h.html#2177" title="0" data-ref="_M/BGE_APE_HOST_HEARTBEAT_INT_DISABLE">BGE_APE_HOST_HEARTBEAT_INT_DISABLE</a>);</td></tr>
<tr><th id="923">923</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x421C, 0x00000001)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2163" title="0x421C" data-ref="_M/BGE_APE_HOST_DRVR_STATE">BGE_APE_HOST_DRVR_STATE</a>,</td></tr>
<tr><th id="924">924</th><td>		    <a class="macro" href="if_bgereg.h.html#2180" title="0x00000001" data-ref="_M/BGE_APE_HOST_DRVR_STATE_START">BGE_APE_HOST_DRVR_STATE_START</a>);</td></tr>
<tr><th id="925">925</th><td>		<a class="local col4 ref" href="#54event" title='event' data-ref="54event" data-ref-filename="54event">event</a> = <a class="macro" href="if_bgereg.h.html#2191" title="0x00010000" data-ref="_M/BGE_APE_EVENT_STATUS_STATE_START">BGE_APE_EVENT_STATUS_STATE_START</a>;</td></tr>
<tr><th id="926">926</th><td>		<b>break</b>;</td></tr>
<tr><th id="927">927</th><td>	<b>case</b> <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>:</td></tr>
<tr><th id="928">928</th><td>		<a class="macro" href="if_bgevar.h.html#125" title="bus_space_write_4(sc-&gt;bge_apetag, sc-&gt;bge_apehandle, 0x421C, 0x00000002)" data-ref="_M/APE_WRITE_4">APE_WRITE_4</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2163" title="0x421C" data-ref="_M/BGE_APE_HOST_DRVR_STATE">BGE_APE_HOST_DRVR_STATE</a>,</td></tr>
<tr><th id="929">929</th><td>		    <a class="macro" href="if_bgereg.h.html#2181" title="0x00000002" data-ref="_M/BGE_APE_HOST_DRVR_STATE_UNLOAD">BGE_APE_HOST_DRVR_STATE_UNLOAD</a>);</td></tr>
<tr><th id="930">930</th><td>		<a class="local col4 ref" href="#54event" title='event' data-ref="54event" data-ref-filename="54event">event</a> = <a class="macro" href="if_bgereg.h.html#2192" title="0x00020000" data-ref="_M/BGE_APE_EVENT_STATUS_STATE_UNLOAD">BGE_APE_EVENT_STATUS_STATE_UNLOAD</a>;</td></tr>
<tr><th id="931">931</th><td>		<b>break</b>;</td></tr>
<tr><th id="932">932</th><td>	<b>case</b> <a class="macro" href="#256" title="2" data-ref="_M/BGE_RESET_SUSPEND">BGE_RESET_SUSPEND</a>:</td></tr>
<tr><th id="933">933</th><td>		<a class="local col4 ref" href="#54event" title='event' data-ref="54event" data-ref-filename="54event">event</a> = <a class="macro" href="if_bgereg.h.html#2194" title="0x00040000" data-ref="_M/BGE_APE_EVENT_STATUS_STATE_SUSPEND">BGE_APE_EVENT_STATUS_STATE_SUSPEND</a>;</td></tr>
<tr><th id="934">934</th><td>		<b>break</b>;</td></tr>
<tr><th id="935">935</th><td>	<b>default</b>:</td></tr>
<tr><th id="936">936</th><td>		<b>return</b>;</td></tr>
<tr><th id="937">937</th><td>	}</td></tr>
<tr><th id="938">938</th><td></td></tr>
<tr><th id="939">939</th><td>	<a class="tu ref fn" href="#bge_ape_send_event" title='bge_ape_send_event' data-use='c' data-ref="bge_ape_send_event" data-ref-filename="bge_ape_send_event">bge_ape_send_event</a>(<a class="local col1 ref" href="#51sc" title='sc' data-ref="51sc" data-ref-filename="51sc">sc</a>, <a class="local col4 ref" href="#54event" title='event' data-ref="54event" data-ref-filename="54event">event</a> | <a class="macro" href="if_bgereg.h.html#2189" title="0x00000010" data-ref="_M/BGE_APE_EVENT_STATUS_DRIVER_EVNT">BGE_APE_EVENT_STATUS_DRIVER_EVNT</a> |</td></tr>
<tr><th id="940">940</th><td>	    <a class="macro" href="if_bgereg.h.html#2190" title="0x00000500" data-ref="_M/BGE_APE_EVENT_STATUS_STATE_CHNGE">BGE_APE_EVENT_STATUS_STATE_CHNGE</a>);</td></tr>
<tr><th id="941">941</th><td>}</td></tr>
<tr><th id="942">942</th><td></td></tr>
<tr><th id="943">943</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a></td></tr>
<tr><th id="944">944</th><td><dfn class="tu decl def fn" id="bge_nvram_getbyte" title='bge_nvram_getbyte' data-type='uint8_t bge_nvram_getbyte(struct bge_softc * sc, int addr, uint8_t * dest)' data-ref="bge_nvram_getbyte" data-ref-filename="bge_nvram_getbyte">bge_nvram_getbyte</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="55sc" title='sc' data-type='struct bge_softc *' data-ref="55sc" data-ref-filename="55sc">sc</dfn>, <em>int</em> <dfn class="local col6 decl" id="56addr" title='addr' data-type='int' data-ref="56addr" data-ref-filename="56addr">addr</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *<dfn class="local col7 decl" id="57dest" title='dest' data-type='uint8_t *' data-ref="57dest" data-ref-filename="57dest">dest</dfn>)</td></tr>
<tr><th id="945">945</th><td>{</td></tr>
<tr><th id="946">946</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="58access" title='access' data-type='uint32_t' data-ref="58access" data-ref-filename="58access">access</dfn>, <dfn class="local col9 decl" id="59byte" title='byte' data-type='uint32_t' data-ref="59byte" data-ref-filename="59byte">byte</dfn> = <var>0</var>;</td></tr>
<tr><th id="947">947</th><td>	<em>int</em> <dfn class="local col0 decl" id="60i" title='i' data-type='int' data-ref="60i" data-ref-filename="60i">i</dfn>;</td></tr>
<tr><th id="948">948</th><td></td></tr>
<tr><th id="949">949</th><td>	<i>/* Lock. */</i></td></tr>
<tr><th id="950">950</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1922" title="0x7020" data-ref="_M/BGE_NVRAM_SWARB">BGE_NVRAM_SWARB</a>, <a class="macro" href="if_bgereg.h.html#1942" title="0x00000002" data-ref="_M/BGE_NVRAMSWARB_SET1">BGE_NVRAMSWARB_SET1</a>);</td></tr>
<tr><th id="951">951</th><td>	<b>for</b> (<a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> = <var>0</var>; <a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> &lt; <var>8000</var>; <a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a>++) {</td></tr>
<tr><th id="952">952</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1922" title="0x7020" data-ref="_M/BGE_NVRAM_SWARB">BGE_NVRAM_SWARB</a>) &amp; <a class="macro" href="if_bgereg.h.html#1950" title="0x00000200" data-ref="_M/BGE_NVRAMSWARB_GNT1">BGE_NVRAMSWARB_GNT1</a>)</td></tr>
<tr><th id="953">953</th><td>			<b>break</b>;</td></tr>
<tr><th id="954">954</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(20)" data-ref="_M/DELAY">DELAY</a>(<var>20</var>);</td></tr>
<tr><th id="955">955</th><td>	}</td></tr>
<tr><th id="956">956</th><td>	<b>if</b> (<a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> == <var>8000</var>)</td></tr>
<tr><th id="957">957</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="958">958</th><td></td></tr>
<tr><th id="959">959</th><td>	<i>/* Enable access. */</i></td></tr>
<tr><th id="960">960</th><td>	<a class="local col8 ref" href="#58access" title='access' data-ref="58access" data-ref-filename="58access">access</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7024)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1923" title="0x7024" data-ref="_M/BGE_NVRAM_ACCESS">BGE_NVRAM_ACCESS</a>);</td></tr>
<tr><th id="961">961</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7024, access | 0x00000001)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1923" title="0x7024" data-ref="_M/BGE_NVRAM_ACCESS">BGE_NVRAM_ACCESS</a>, <a class="local col8 ref" href="#58access" title='access' data-ref="58access" data-ref-filename="58access">access</a> | <a class="macro" href="if_bgereg.h.html#1958" title="0x00000001" data-ref="_M/BGE_NVRAMACC_ENABLE">BGE_NVRAMACC_ENABLE</a>);</td></tr>
<tr><th id="962">962</th><td></td></tr>
<tr><th id="963">963</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x700c, addr &amp; 0xfffffffc)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1917" title="0x700c" data-ref="_M/BGE_NVRAM_ADDR">BGE_NVRAM_ADDR</a>, <a class="local col6 ref" href="#56addr" title='addr' data-ref="56addr" data-ref-filename="56addr">addr</a> &amp; <var>0xfffffffc</var>);</td></tr>
<tr><th id="964">964</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7000, (0x00000080|0x00000100| 0x00000010|0x00000008))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1914" title="0x7000" data-ref="_M/BGE_NVRAM_CMD">BGE_NVRAM_CMD</a>, <a class="macro" href="if_bgereg.h.html#1934" title="(0x00000080|0x00000100| 0x00000010|0x00000008)" data-ref="_M/BGE_NVRAM_READCMD">BGE_NVRAM_READCMD</a>);</td></tr>
<tr><th id="965">965</th><td>	<b>for</b> (<a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> = <var>0</var>; <a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>10</var>; <a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a>++) {</td></tr>
<tr><th id="966">966</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="967">967</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7000)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1914" title="0x7000" data-ref="_M/BGE_NVRAM_CMD">BGE_NVRAM_CMD</a>) &amp; <a class="macro" href="if_bgereg.h.html#1927" title="0x00000008" data-ref="_M/BGE_NVRAMCMD_DONE">BGE_NVRAMCMD_DONE</a>) {</td></tr>
<tr><th id="968">968</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="969">969</th><td>			<b>break</b>;</td></tr>
<tr><th id="970">970</th><td>		}</td></tr>
<tr><th id="971">971</th><td>	}</td></tr>
<tr><th id="972">972</th><td></td></tr>
<tr><th id="973">973</th><td>	<b>if</b> (<a class="local col0 ref" href="#60i" title='i' data-ref="60i" data-ref-filename="60i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>10</var>) {</td></tr>
<tr><th id="974">974</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"nvram read timed out\n"</q>);</td></tr>
<tr><th id="975">975</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="976">976</th><td>	}</td></tr>
<tr><th id="977">977</th><td></td></tr>
<tr><th id="978">978</th><td>	<i>/* Get result. */</i></td></tr>
<tr><th id="979">979</th><td>	<a class="local col9 ref" href="#59byte" title='byte' data-ref="59byte" data-ref-filename="59byte">byte</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7010)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1918" title="0x7010" data-ref="_M/BGE_NVRAM_RDDATA">BGE_NVRAM_RDDATA</a>);</td></tr>
<tr><th id="980">980</th><td></td></tr>
<tr><th id="981">981</th><td>	*<a class="local col7 ref" href="#57dest" title='dest' data-ref="57dest" data-ref-filename="57dest">dest</a> = (<a class="macro" href="../../sys/bswap.h.html#67" title="((uint32_t)(__builtin_constant_p((byte)) ? (((uint32_t)(((((byte) &amp; 0xff000000) &gt;&gt; 24) | (((byte) &amp; 0x00ff0000) &gt;&gt; 8) | (((byte) &amp; 0x0000ff00) &lt;&lt; 8) | (((byte) &amp; 0x000000ff) &lt;&lt; 24))))) : __byte_swap_u32_variable(byte)))" data-ref="_M/bswap32">bswap32</a>(<a class="local col9 ref" href="#59byte" title='byte' data-ref="59byte" data-ref-filename="59byte">byte</a>) &gt;&gt; ((<a class="local col6 ref" href="#56addr" title='addr' data-ref="56addr" data-ref-filename="56addr">addr</a> % <var>4</var>) * <var>8</var>)) &amp; <var>0xFF</var>;</td></tr>
<tr><th id="982">982</th><td></td></tr>
<tr><th id="983">983</th><td>	<i>/* Disable access. */</i></td></tr>
<tr><th id="984">984</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7024, access)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1923" title="0x7024" data-ref="_M/BGE_NVRAM_ACCESS">BGE_NVRAM_ACCESS</a>, <a class="local col8 ref" href="#58access" title='access' data-ref="58access" data-ref-filename="58access">access</a>);</td></tr>
<tr><th id="985">985</th><td></td></tr>
<tr><th id="986">986</th><td>	<i>/* Unlock. */</i></td></tr>
<tr><th id="987">987</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020, 0x00000020); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col5 ref" href="#55sc" title='sc' data-ref="55sc" data-ref-filename="55sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1922" title="0x7020" data-ref="_M/BGE_NVRAM_SWARB">BGE_NVRAM_SWARB</a>, <a class="macro" href="if_bgereg.h.html#1946" title="0x00000020" data-ref="_M/BGE_NVRAMSWARB_CLR1">BGE_NVRAMSWARB_CLR1</a>);</td></tr>
<tr><th id="988">988</th><td></td></tr>
<tr><th id="989">989</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="990">990</th><td>}</td></tr>
<tr><th id="991">991</th><td></td></tr>
<tr><th id="992">992</th><td><i  data-doc="bge_read_nvram">/*</i></td></tr>
<tr><th id="993">993</th><td><i  data-doc="bge_read_nvram"> * Read a sequence of bytes from NVRAM.</i></td></tr>
<tr><th id="994">994</th><td><i  data-doc="bge_read_nvram"> */</i></td></tr>
<tr><th id="995">995</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="996">996</th><td><dfn class="tu decl def fn" id="bge_read_nvram" title='bge_read_nvram' data-type='int bge_read_nvram(struct bge_softc * sc, uint8_t * dest, int off, int cnt)' data-ref="bge_read_nvram" data-ref-filename="bge_read_nvram">bge_read_nvram</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="61sc" title='sc' data-type='struct bge_softc *' data-ref="61sc" data-ref-filename="61sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *<dfn class="local col2 decl" id="62dest" title='dest' data-type='uint8_t *' data-ref="62dest" data-ref-filename="62dest">dest</dfn>, <em>int</em> <dfn class="local col3 decl" id="63off" title='off' data-type='int' data-ref="63off" data-ref-filename="63off">off</dfn>, <em>int</em> <dfn class="local col4 decl" id="64cnt" title='cnt' data-type='int' data-ref="64cnt" data-ref-filename="64cnt">cnt</dfn>)</td></tr>
<tr><th id="997">997</th><td>{</td></tr>
<tr><th id="998">998</th><td>	<em>int</em> <dfn class="local col5 decl" id="65error" title='error' data-type='int' data-ref="65error" data-ref-filename="65error">error</dfn> = <var>0</var>, <dfn class="local col6 decl" id="66i" title='i' data-type='int' data-ref="66i" data-ref-filename="66i">i</dfn>;</td></tr>
<tr><th id="999">999</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col7 decl" id="67byte" title='byte' data-type='uint8_t' data-ref="67byte" data-ref-filename="67byte">byte</dfn> = <var>0</var>;</td></tr>
<tr><th id="1000">1000</th><td></td></tr>
<tr><th id="1001">1001</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col1 ref" href="#61sc" title='sc' data-ref="61sc" data-ref-filename="61sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="1002">1002</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1003">1003</th><td></td></tr>
<tr><th id="1004">1004</th><td>	<b>for</b> (<a class="local col6 ref" href="#66i" title='i' data-ref="66i" data-ref-filename="66i">i</a> = <var>0</var>; <a class="local col6 ref" href="#66i" title='i' data-ref="66i" data-ref-filename="66i">i</a> &lt; <a class="local col4 ref" href="#64cnt" title='cnt' data-ref="64cnt" data-ref-filename="64cnt">cnt</a>; <a class="local col6 ref" href="#66i" title='i' data-ref="66i" data-ref-filename="66i">i</a>++) {</td></tr>
<tr><th id="1005">1005</th><td>		<a class="local col5 ref" href="#65error" title='error' data-ref="65error" data-ref-filename="65error">error</a> = <a class="tu ref fn" href="#bge_nvram_getbyte" title='bge_nvram_getbyte' data-use='c' data-ref="bge_nvram_getbyte" data-ref-filename="bge_nvram_getbyte">bge_nvram_getbyte</a>(<a class="local col1 ref" href="#61sc" title='sc' data-ref="61sc" data-ref-filename="61sc">sc</a>, <a class="local col3 ref" href="#63off" title='off' data-ref="63off" data-ref-filename="63off">off</a> + <a class="local col6 ref" href="#66i" title='i' data-ref="66i" data-ref-filename="66i">i</a>, &amp;<a class="local col7 ref" href="#67byte" title='byte' data-ref="67byte" data-ref-filename="67byte">byte</a>);</td></tr>
<tr><th id="1006">1006</th><td>		<b>if</b> (<a class="local col5 ref" href="#65error" title='error' data-ref="65error" data-ref-filename="65error">error</a>)</td></tr>
<tr><th id="1007">1007</th><td>			<b>break</b>;</td></tr>
<tr><th id="1008">1008</th><td>		*(<a class="local col2 ref" href="#62dest" title='dest' data-ref="62dest" data-ref-filename="62dest">dest</a> + <a class="local col6 ref" href="#66i" title='i' data-ref="66i" data-ref-filename="66i">i</a>) = <a class="local col7 ref" href="#67byte" title='byte' data-ref="67byte" data-ref-filename="67byte">byte</a>;</td></tr>
<tr><th id="1009">1009</th><td>	}</td></tr>
<tr><th id="1010">1010</th><td></td></tr>
<tr><th id="1011">1011</th><td>	<b>return</b> (<a class="local col5 ref" href="#65error" title='error' data-ref="65error" data-ref-filename="65error">error</a> ? <var>1</var> : <var>0</var>);</td></tr>
<tr><th id="1012">1012</th><td>}</td></tr>
<tr><th id="1013">1013</th><td></td></tr>
<tr><th id="1014">1014</th><td><i  data-doc="bge_eeprom_getbyte">/*</i></td></tr>
<tr><th id="1015">1015</th><td><i  data-doc="bge_eeprom_getbyte"> * Read a byte of data stored in the EEPROM at address 'addr.' The</i></td></tr>
<tr><th id="1016">1016</th><td><i  data-doc="bge_eeprom_getbyte"> * BCM570x supports both the traditional bitbang interface and an</i></td></tr>
<tr><th id="1017">1017</th><td><i  data-doc="bge_eeprom_getbyte"> * auto access interface for reading the EEPROM. We use the auto</i></td></tr>
<tr><th id="1018">1018</th><td><i  data-doc="bge_eeprom_getbyte"> * access method.</i></td></tr>
<tr><th id="1019">1019</th><td><i  data-doc="bge_eeprom_getbyte"> */</i></td></tr>
<tr><th id="1020">1020</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a></td></tr>
<tr><th id="1021">1021</th><td><dfn class="tu decl def fn" id="bge_eeprom_getbyte" title='bge_eeprom_getbyte' data-type='uint8_t bge_eeprom_getbyte(struct bge_softc * sc, int addr, uint8_t * dest)' data-ref="bge_eeprom_getbyte" data-ref-filename="bge_eeprom_getbyte">bge_eeprom_getbyte</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="68sc" title='sc' data-type='struct bge_softc *' data-ref="68sc" data-ref-filename="68sc">sc</dfn>, <em>int</em> <dfn class="local col9 decl" id="69addr" title='addr' data-type='int' data-ref="69addr" data-ref-filename="69addr">addr</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *<dfn class="local col0 decl" id="70dest" title='dest' data-type='uint8_t *' data-ref="70dest" data-ref-filename="70dest">dest</dfn>)</td></tr>
<tr><th id="1022">1022</th><td>{</td></tr>
<tr><th id="1023">1023</th><td>	<em>int</em> <dfn class="local col1 decl" id="71i" title='i' data-type='int' data-ref="71i" data-ref-filename="71i">i</dfn>;</td></tr>
<tr><th id="1024">1024</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="72byte" title='byte' data-type='uint32_t' data-ref="72byte" data-ref-filename="72byte">byte</dfn> = <var>0</var>;</td></tr>
<tr><th id="1025">1025</th><td></td></tr>
<tr><th id="1026">1026</th><td>	<i>/*</i></td></tr>
<tr><th id="1027">1027</th><td><i>	 * Enable use of auto EEPROM access so we can avoid</i></td></tr>
<tr><th id="1028">1028</th><td><i>	 * having to use the bitbang method.</i></td></tr>
<tr><th id="1029">1029</th><td><i>	 */</i></td></tr>
<tr><th id="1030">1030</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808) | (0x01000000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>, <a class="macro" href="if_bgereg.h.html#2069" title="0x01000000" data-ref="_M/BGE_MLC_AUTO_EEPROM">BGE_MLC_AUTO_EEPROM</a>);</td></tr>
<tr><th id="1031">1031</th><td></td></tr>
<tr><th id="1032">1032</th><td>	<i>/* Reset the EEPROM, load the clock period. */</i></td></tr>
<tr><th id="1033">1033</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6838, 0x20000000 | ((0x60 &amp; 0x1FF) &lt;&lt; 16))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1902" title="0x6838" data-ref="_M/BGE_EE_ADDR">BGE_EE_ADDR</a>,</td></tr>
<tr><th id="1034">1034</th><td>	    <a class="macro" href="if_bgereg.h.html#2084" title="0x20000000" data-ref="_M/BGE_EEADDR_RESET">BGE_EEADDR_RESET</a> | <a class="macro" href="if_bgereg.h.html#2089" title="((0x60 &amp; 0x1FF) &lt;&lt; 16)" data-ref="_M/BGE_EEHALFCLK">BGE_EEHALFCLK</a>(<a class="macro" href="if_bgereg.h.html#2090" title="0x60" data-ref="_M/BGE_HALFCLK_384SCL">BGE_HALFCLK_384SCL</a>));</td></tr>
<tr><th id="1035">1035</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(20)" data-ref="_M/DELAY">DELAY</a>(<var>20</var>);</td></tr>
<tr><th id="1036">1036</th><td></td></tr>
<tr><th id="1037">1037</th><td>	<i>/* Issue the read EEPROM command. */</i></td></tr>
<tr><th id="1038">1038</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6838, (((0x60 &amp; 0x1FF) &lt;&lt; 16)|((0 &amp; 7) &lt;&lt; 26)| 0x02000000|0x80000000|0x40000000) | addr)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1902" title="0x6838" data-ref="_M/BGE_EE_ADDR">BGE_EE_ADDR</a>, <a class="macro" href="if_bgereg.h.html#2091" title="(((0x60 &amp; 0x1FF) &lt;&lt; 16)|((0 &amp; 7) &lt;&lt; 26)| 0x02000000|0x80000000|0x40000000)" data-ref="_M/BGE_EE_READCMD">BGE_EE_READCMD</a> | <a class="local col9 ref" href="#69addr" title='addr' data-ref="69addr" data-ref-filename="69addr">addr</a>);</td></tr>
<tr><th id="1039">1039</th><td></td></tr>
<tr><th id="1040">1040</th><td>	<i>/* Wait for completion */</i></td></tr>
<tr><th id="1041">1041</th><td>	<b>for</b> (<a class="local col1 ref" href="#71i" title='i' data-ref="71i" data-ref-filename="71i">i</a> = <var>0</var>; <a class="local col1 ref" href="#71i" title='i' data-ref="71i" data-ref-filename="71i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>10</var>; <a class="local col1 ref" href="#71i" title='i' data-ref="71i" data-ref-filename="71i">i</a>++) {</td></tr>
<tr><th id="1042">1042</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="1043">1043</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6838)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1902" title="0x6838" data-ref="_M/BGE_EE_ADDR">BGE_EE_ADDR</a>) &amp; <a class="macro" href="if_bgereg.h.html#2085" title="0x40000000" data-ref="_M/BGE_EEADDR_DONE">BGE_EEADDR_DONE</a>)</td></tr>
<tr><th id="1044">1044</th><td>			<b>break</b>;</td></tr>
<tr><th id="1045">1045</th><td>	}</td></tr>
<tr><th id="1046">1046</th><td></td></tr>
<tr><th id="1047">1047</th><td>	<b>if</b> (<a class="local col1 ref" href="#71i" title='i' data-ref="71i" data-ref-filename="71i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>10</var>) {</td></tr>
<tr><th id="1048">1048</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"eeprom read timed out\n"</q>);</td></tr>
<tr><th id="1049">1049</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="1050">1050</th><td>	}</td></tr>
<tr><th id="1051">1051</th><td></td></tr>
<tr><th id="1052">1052</th><td>	<i>/* Get result. */</i></td></tr>
<tr><th id="1053">1053</th><td>	<a class="local col2 ref" href="#72byte" title='byte' data-ref="72byte" data-ref-filename="72byte">byte</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x683C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col8 ref" href="#68sc" title='sc' data-ref="68sc" data-ref-filename="68sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1903" title="0x683C" data-ref="_M/BGE_EE_DATA">BGE_EE_DATA</a>);</td></tr>
<tr><th id="1054">1054</th><td></td></tr>
<tr><th id="1055">1055</th><td>	*<a class="local col0 ref" href="#70dest" title='dest' data-ref="70dest" data-ref-filename="70dest">dest</a> = (<a class="local col2 ref" href="#72byte" title='byte' data-ref="72byte" data-ref-filename="72byte">byte</a> &gt;&gt; ((<a class="local col9 ref" href="#69addr" title='addr' data-ref="69addr" data-ref-filename="69addr">addr</a> % <var>4</var>) * <var>8</var>)) &amp; <var>0xFF</var>;</td></tr>
<tr><th id="1056">1056</th><td></td></tr>
<tr><th id="1057">1057</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1058">1058</th><td>}</td></tr>
<tr><th id="1059">1059</th><td></td></tr>
<tr><th id="1060">1060</th><td><i  data-doc="bge_read_eeprom">/*</i></td></tr>
<tr><th id="1061">1061</th><td><i  data-doc="bge_read_eeprom"> * Read a sequence of bytes from the EEPROM.</i></td></tr>
<tr><th id="1062">1062</th><td><i  data-doc="bge_read_eeprom"> */</i></td></tr>
<tr><th id="1063">1063</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1064">1064</th><td><dfn class="tu decl def fn" id="bge_read_eeprom" title='bge_read_eeprom' data-type='int bge_read_eeprom(struct bge_softc * sc, void * destv, int off, int cnt)' data-ref="bge_read_eeprom" data-ref-filename="bge_read_eeprom">bge_read_eeprom</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="73sc" title='sc' data-type='struct bge_softc *' data-ref="73sc" data-ref-filename="73sc">sc</dfn>, <em>void</em> *<dfn class="local col4 decl" id="74destv" title='destv' data-type='void *' data-ref="74destv" data-ref-filename="74destv">destv</dfn>, <em>int</em> <dfn class="local col5 decl" id="75off" title='off' data-type='int' data-ref="75off" data-ref-filename="75off">off</dfn>, <em>int</em> <dfn class="local col6 decl" id="76cnt" title='cnt' data-type='int' data-ref="76cnt" data-ref-filename="76cnt">cnt</dfn>)</td></tr>
<tr><th id="1065">1065</th><td>{</td></tr>
<tr><th id="1066">1066</th><td>	<em>int</em> <dfn class="local col7 decl" id="77error" title='error' data-type='int' data-ref="77error" data-ref-filename="77error">error</dfn> = <var>0</var>, <dfn class="local col8 decl" id="78i" title='i' data-type='int' data-ref="78i" data-ref-filename="78i">i</dfn>;</td></tr>
<tr><th id="1067">1067</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col9 decl" id="79byte" title='byte' data-type='uint8_t' data-ref="79byte" data-ref-filename="79byte">byte</dfn> = <var>0</var>;</td></tr>
<tr><th id="1068">1068</th><td>	<em>char</em> *<dfn class="local col0 decl" id="80dest" title='dest' data-type='char *' data-ref="80dest" data-ref-filename="80dest">dest</dfn> = <a class="local col4 ref" href="#74destv" title='destv' data-ref="74destv" data-ref-filename="74destv">destv</a>;</td></tr>
<tr><th id="1069">1069</th><td></td></tr>
<tr><th id="1070">1070</th><td>	<b>for</b> (<a class="local col8 ref" href="#78i" title='i' data-ref="78i" data-ref-filename="78i">i</a> = <var>0</var>; <a class="local col8 ref" href="#78i" title='i' data-ref="78i" data-ref-filename="78i">i</a> &lt; <a class="local col6 ref" href="#76cnt" title='cnt' data-ref="76cnt" data-ref-filename="76cnt">cnt</a>; <a class="local col8 ref" href="#78i" title='i' data-ref="78i" data-ref-filename="78i">i</a>++) {</td></tr>
<tr><th id="1071">1071</th><td>		<a class="local col7 ref" href="#77error" title='error' data-ref="77error" data-ref-filename="77error">error</a> = <a class="tu ref fn" href="#bge_eeprom_getbyte" title='bge_eeprom_getbyte' data-use='c' data-ref="bge_eeprom_getbyte" data-ref-filename="bge_eeprom_getbyte">bge_eeprom_getbyte</a>(<a class="local col3 ref" href="#73sc" title='sc' data-ref="73sc" data-ref-filename="73sc">sc</a>, <a class="local col5 ref" href="#75off" title='off' data-ref="75off" data-ref-filename="75off">off</a> + <a class="local col8 ref" href="#78i" title='i' data-ref="78i" data-ref-filename="78i">i</a>, &amp;<a class="local col9 ref" href="#79byte" title='byte' data-ref="79byte" data-ref-filename="79byte">byte</a>);</td></tr>
<tr><th id="1072">1072</th><td>		<b>if</b> (<a class="local col7 ref" href="#77error" title='error' data-ref="77error" data-ref-filename="77error">error</a>)</td></tr>
<tr><th id="1073">1073</th><td>			<b>break</b>;</td></tr>
<tr><th id="1074">1074</th><td>		*(<a class="local col0 ref" href="#80dest" title='dest' data-ref="80dest" data-ref-filename="80dest">dest</a> + <a class="local col8 ref" href="#78i" title='i' data-ref="78i" data-ref-filename="78i">i</a>) = <a class="local col9 ref" href="#79byte" title='byte' data-ref="79byte" data-ref-filename="79byte">byte</a>;</td></tr>
<tr><th id="1075">1075</th><td>	}</td></tr>
<tr><th id="1076">1076</th><td></td></tr>
<tr><th id="1077">1077</th><td>	<b>return</b> (<a class="local col7 ref" href="#77error" title='error' data-ref="77error" data-ref-filename="77error">error</a> ? <var>1</var> : <var>0</var>);</td></tr>
<tr><th id="1078">1078</th><td>}</td></tr>
<tr><th id="1079">1079</th><td></td></tr>
<tr><th id="1080">1080</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1081">1081</th><td><dfn class="tu decl def fn" id="bge_miibus_readreg" title='bge_miibus_readreg' data-type='int bge_miibus_readreg(device_t dev, int phy, int reg, uint16_t * val)' data-ref="bge_miibus_readreg" data-ref-filename="bge_miibus_readreg">bge_miibus_readreg</dfn>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col1 decl" id="81dev" title='dev' data-type='device_t' data-ref="81dev" data-ref-filename="81dev">dev</dfn>, <em>int</em> <dfn class="local col2 decl" id="82phy" title='phy' data-type='int' data-ref="82phy" data-ref-filename="82phy">phy</dfn>, <em>int</em> <dfn class="local col3 decl" id="83reg" title='reg' data-type='int' data-ref="83reg" data-ref-filename="83reg">reg</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> *<dfn class="local col4 decl" id="84val" title='val' data-type='uint16_t *' data-ref="84val" data-ref-filename="84val">val</dfn>)</td></tr>
<tr><th id="1082">1082</th><td>{</td></tr>
<tr><th id="1083">1083</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="85sc" title='sc' data-type='struct bge_softc *' data-ref="85sc" data-ref-filename="85sc">sc</dfn> = <a class="ref fn" href="../../sys/device.h.html#device_private" title='device_private' data-ref="device_private" data-ref-filename="device_private">device_private</a>(<a class="local col1 ref" href="#81dev" title='dev' data-ref="81dev" data-ref-filename="81dev">dev</a>);</td></tr>
<tr><th id="1084">1084</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="86data" title='data' data-type='uint32_t' data-ref="86data" data-ref-filename="86data">data</dfn>;</td></tr>
<tr><th id="1085">1085</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="87autopoll" title='autopoll' data-type='uint32_t' data-ref="87autopoll" data-ref-filename="87autopoll">autopoll</dfn>;</td></tr>
<tr><th id="1086">1086</th><td>	<em>int</em> <dfn class="local col8 decl" id="88rv" title='rv' data-type='int' data-ref="88rv" data-ref-filename="88rv">rv</dfn> = <var>0</var>;</td></tr>
<tr><th id="1087">1087</th><td>	<em>int</em> <dfn class="local col9 decl" id="89i" title='i' data-type='int' data-ref="89i" data-ref-filename="89i">i</dfn>;</td></tr>
<tr><th id="1088">1088</th><td></td></tr>
<tr><th id="1089">1089</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_ape_lock" title='bge_ape_lock' data-use='c' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a>) != <var>0</var>)</td></tr>
<tr><th id="1090">1090</th><td>		<b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1091">1091</th><td></td></tr>
<tr><th id="1092">1092</th><td>	<i>/* Reading with autopolling on may trigger PCI errors */</i></td></tr>
<tr><th id="1093">1093</th><td>	<a class="local col7 ref" href="#87autopoll" title='autopoll' data-ref="87autopoll" data-ref-filename="87autopoll">autopoll</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>);</td></tr>
<tr><th id="1094">1094</th><td>	<b>if</b> (<a class="local col7 ref" href="#87autopoll" title='autopoll' data-ref="87autopoll" data-ref-filename="87autopoll">autopoll</a> &amp; <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>) {</td></tr>
<tr><th id="1095">1095</th><td>		<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000004))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>);</td></tr>
<tr><th id="1096">1096</th><td>		<a class="macro" href="if_bgevar.h.html#118" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454) &amp; ~(0x00000010))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454); } while(0)" data-ref="_M/BGE_CLRBIT_FLUSH">BGE_CLRBIT_FLUSH</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>);</td></tr>
<tr><th id="1097">1097</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(80)" data-ref="_M/DELAY">DELAY</a>(<var>80</var>);</td></tr>
<tr><th id="1098">1098</th><td>	}</td></tr>
<tr><th id="1099">1099</th><td></td></tr>
<tr><th id="1100">1100</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C, 0x08000000 | 0x20000000 | ((phy &amp; 0x1F) &lt;&lt; 21) | ((reg &amp; 0x1F) &lt;&lt; 16)); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>, <a class="macro" href="if_bgereg.h.html#853" title="0x08000000" data-ref="_M/BGE_MICMD_READ">BGE_MICMD_READ</a> | <a class="macro" href="if_bgereg.h.html#848" title="0x20000000" data-ref="_M/BGE_MICOMM_BUSY">BGE_MICOMM_BUSY</a> |</td></tr>
<tr><th id="1101">1101</th><td>	    <a class="macro" href="if_bgereg.h.html#851" title="((phy &amp; 0x1F) &lt;&lt; 21)" data-ref="_M/BGE_MIPHY">BGE_MIPHY</a>(<a class="local col2 ref" href="#82phy" title='phy' data-ref="82phy" data-ref-filename="82phy">phy</a>) | <a class="macro" href="if_bgereg.h.html#850" title="((reg &amp; 0x1F) &lt;&lt; 16)" data-ref="_M/BGE_MIREG">BGE_MIREG</a>(<a class="local col3 ref" href="#83reg" title='reg' data-ref="83reg" data-ref-filename="83reg">reg</a>));</td></tr>
<tr><th id="1102">1102</th><td></td></tr>
<tr><th id="1103">1103</th><td>	<b>for</b> (<a class="local col9 ref" href="#89i" title='i' data-ref="89i" data-ref-filename="89i">i</a> = <var>0</var>; <a class="local col9 ref" href="#89i" title='i' data-ref="89i" data-ref-filename="89i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>; <a class="local col9 ref" href="#89i" title='i' data-ref="89i" data-ref-filename="89i">i</a>++) {</td></tr>
<tr><th id="1104">1104</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(10)" data-ref="_M/delay">delay</a>(<var>10</var>);</td></tr>
<tr><th id="1105">1105</th><td>		<a class="local col6 ref" href="#86data" title='data' data-ref="86data" data-ref-filename="86data">data</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>);</td></tr>
<tr><th id="1106">1106</th><td>		<b>if</b> (!(<a class="local col6 ref" href="#86data" title='data' data-ref="86data" data-ref-filename="86data">data</a> &amp; <a class="macro" href="if_bgereg.h.html#848" title="0x20000000" data-ref="_M/BGE_MICOMM_BUSY">BGE_MICOMM_BUSY</a>)) {</td></tr>
<tr><th id="1107">1107</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(5)" data-ref="_M/DELAY">DELAY</a>(<var>5</var>);</td></tr>
<tr><th id="1108">1108</th><td>			<a class="local col6 ref" href="#86data" title='data' data-ref="86data" data-ref-filename="86data">data</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>);</td></tr>
<tr><th id="1109">1109</th><td>			<b>break</b>;</td></tr>
<tr><th id="1110">1110</th><td>		}</td></tr>
<tr><th id="1111">1111</th><td>	}</td></tr>
<tr><th id="1112">1112</th><td></td></tr>
<tr><th id="1113">1113</th><td>	<b>if</b> (<a class="local col9 ref" href="#89i" title='i' data-ref="89i" data-ref-filename="89i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>) {</td></tr>
<tr><th id="1114">1114</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"PHY read timed out\n"</q>);</td></tr>
<tr><th id="1115">1115</th><td>		<a class="local col8 ref" href="#88rv" title='rv' data-ref="88rv" data-ref-filename="88rv">rv</a> = <a class="macro" href="../../sys/errno.h.html#111" title="60" data-ref="_M/ETIMEDOUT">ETIMEDOUT</a>;</td></tr>
<tr><th id="1116">1116</th><td>	} <b>else</b> <b>if</b> ((<a class="local col6 ref" href="#86data" title='data' data-ref="86data" data-ref-filename="86data">data</a> &amp; <a class="macro" href="if_bgereg.h.html#847" title="0x10000000" data-ref="_M/BGE_MICOMM_READFAIL">BGE_MICOMM_READFAIL</a>) != <var>0</var>)</td></tr>
<tr><th id="1117">1117</th><td>		<a class="local col8 ref" href="#88rv" title='rv' data-ref="88rv" data-ref-filename="88rv">rv</a> = -<var>1</var>;</td></tr>
<tr><th id="1118">1118</th><td>	<b>else</b></td></tr>
<tr><th id="1119">1119</th><td>		*<a class="local col4 ref" href="#84val" title='val' data-ref="84val" data-ref-filename="84val">val</a> = <a class="local col6 ref" href="#86data" title='data' data-ref="86data" data-ref-filename="86data">data</a> &amp; <a class="macro" href="if_bgereg.h.html#843" title="0x0000FFFF" data-ref="_M/BGE_MICOMM_DATA">BGE_MICOMM_DATA</a>;</td></tr>
<tr><th id="1120">1120</th><td></td></tr>
<tr><th id="1121">1121</th><td>	<b>if</b> (<a class="local col7 ref" href="#87autopoll" title='autopoll' data-ref="87autopoll" data-ref-filename="87autopoll">autopoll</a> &amp; <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>) {</td></tr>
<tr><th id="1122">1122</th><td>		<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000004))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>);</td></tr>
<tr><th id="1123">1123</th><td>		<a class="macro" href="if_bgevar.h.html#111" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454) | (0x00000010))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454); } while(0)" data-ref="_M/BGE_SETBIT_FLUSH">BGE_SETBIT_FLUSH</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>);</td></tr>
<tr><th id="1124">1124</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(80)" data-ref="_M/DELAY">DELAY</a>(<var>80</var>);</td></tr>
<tr><th id="1125">1125</th><td>	}</td></tr>
<tr><th id="1126">1126</th><td></td></tr>
<tr><th id="1127">1127</th><td>	<a class="tu ref fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-use='c' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>, <a class="local col5 ref" href="#85sc" title='sc' data-ref="85sc" data-ref-filename="85sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a>);</td></tr>
<tr><th id="1128">1128</th><td></td></tr>
<tr><th id="1129">1129</th><td>	<b>return</b> <a class="local col8 ref" href="#88rv" title='rv' data-ref="88rv" data-ref-filename="88rv">rv</a>;</td></tr>
<tr><th id="1130">1130</th><td>}</td></tr>
<tr><th id="1131">1131</th><td></td></tr>
<tr><th id="1132">1132</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1133">1133</th><td><dfn class="tu decl def fn" id="bge_miibus_writereg" title='bge_miibus_writereg' data-type='int bge_miibus_writereg(device_t dev, int phy, int reg, uint16_t val)' data-ref="bge_miibus_writereg" data-ref-filename="bge_miibus_writereg">bge_miibus_writereg</dfn>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col0 decl" id="90dev" title='dev' data-type='device_t' data-ref="90dev" data-ref-filename="90dev">dev</dfn>, <em>int</em> <dfn class="local col1 decl" id="91phy" title='phy' data-type='int' data-ref="91phy" data-ref-filename="91phy">phy</dfn>, <em>int</em> <dfn class="local col2 decl" id="92reg" title='reg' data-type='int' data-ref="92reg" data-ref-filename="92reg">reg</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> <dfn class="local col3 decl" id="93val" title='val' data-type='uint16_t' data-ref="93val" data-ref-filename="93val">val</dfn>)</td></tr>
<tr><th id="1134">1134</th><td>{</td></tr>
<tr><th id="1135">1135</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col4 decl" id="94sc" title='sc' data-type='struct bge_softc *' data-ref="94sc" data-ref-filename="94sc">sc</dfn> = <a class="ref fn" href="../../sys/device.h.html#device_private" title='device_private' data-ref="device_private" data-ref-filename="device_private">device_private</a>(<a class="local col0 ref" href="#90dev" title='dev' data-ref="90dev" data-ref-filename="90dev">dev</a>);</td></tr>
<tr><th id="1136">1136</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="95autopoll" title='autopoll' data-type='uint32_t' data-ref="95autopoll" data-ref-filename="95autopoll">autopoll</dfn>;</td></tr>
<tr><th id="1137">1137</th><td>	<em>int</em> <dfn class="local col6 decl" id="96i" title='i' data-type='int' data-ref="96i" data-ref-filename="96i">i</dfn>;</td></tr>
<tr><th id="1138">1138</th><td></td></tr>
<tr><th id="1139">1139</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a> &amp;&amp;</td></tr>
<tr><th id="1140">1140</th><td>	    (<a class="local col2 ref" href="#92reg" title='reg' data-ref="92reg" data-ref-filename="92reg">reg</a> == <a class="macro" href="../mii/mii.h.html#220" title="0x09" data-ref="_M/MII_GTCR">MII_GTCR</a> || <a class="local col2 ref" href="#92reg" title='reg' data-ref="92reg" data-ref-filename="92reg">reg</a> == <a class="macro" href="../mii/brgphyreg.h.html#126" title="0x18" data-ref="_M/BRGPHY_MII_AUXCTL">BRGPHY_MII_AUXCTL</a>))</td></tr>
<tr><th id="1141">1141</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1142">1142</th><td></td></tr>
<tr><th id="1143">1143</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_ape_lock" title='bge_ape_lock' data-use='c' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a>) != <var>0</var>)</td></tr>
<tr><th id="1144">1144</th><td>		<b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1145">1145</th><td></td></tr>
<tr><th id="1146">1146</th><td>	<i>/* Reading with autopolling on may trigger PCI errors */</i></td></tr>
<tr><th id="1147">1147</th><td>	<a class="local col5 ref" href="#95autopoll" title='autopoll' data-ref="95autopoll" data-ref-filename="95autopoll">autopoll</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>);</td></tr>
<tr><th id="1148">1148</th><td>	<b>if</b> (<a class="local col5 ref" href="#95autopoll" title='autopoll' data-ref="95autopoll" data-ref-filename="95autopoll">autopoll</a> &amp; <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>) {</td></tr>
<tr><th id="1149">1149</th><td>		<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000004))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>);</td></tr>
<tr><th id="1150">1150</th><td>		<a class="macro" href="if_bgevar.h.html#118" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454) &amp; ~(0x00000010))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454); } while(0)" data-ref="_M/BGE_CLRBIT_FLUSH">BGE_CLRBIT_FLUSH</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>);</td></tr>
<tr><th id="1151">1151</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(80)" data-ref="_M/DELAY">DELAY</a>(<var>80</var>);</td></tr>
<tr><th id="1152">1152</th><td>	}</td></tr>
<tr><th id="1153">1153</th><td></td></tr>
<tr><th id="1154">1154</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C, 0x04000000 | 0x20000000 | ((phy &amp; 0x1F) &lt;&lt; 21) | ((reg &amp; 0x1F) &lt;&lt; 16) | val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>, <a class="macro" href="if_bgereg.h.html#852" title="0x04000000" data-ref="_M/BGE_MICMD_WRITE">BGE_MICMD_WRITE</a> | <a class="macro" href="if_bgereg.h.html#848" title="0x20000000" data-ref="_M/BGE_MICOMM_BUSY">BGE_MICOMM_BUSY</a> |</td></tr>
<tr><th id="1155">1155</th><td>	    <a class="macro" href="if_bgereg.h.html#851" title="((phy &amp; 0x1F) &lt;&lt; 21)" data-ref="_M/BGE_MIPHY">BGE_MIPHY</a>(<a class="local col1 ref" href="#91phy" title='phy' data-ref="91phy" data-ref-filename="91phy">phy</a>) | <a class="macro" href="if_bgereg.h.html#850" title="((reg &amp; 0x1F) &lt;&lt; 16)" data-ref="_M/BGE_MIREG">BGE_MIREG</a>(<a class="local col2 ref" href="#92reg" title='reg' data-ref="92reg" data-ref-filename="92reg">reg</a>) | <a class="local col3 ref" href="#93val" title='val' data-ref="93val" data-ref-filename="93val">val</a>);</td></tr>
<tr><th id="1156">1156</th><td></td></tr>
<tr><th id="1157">1157</th><td>	<b>for</b> (<a class="local col6 ref" href="#96i" title='i' data-ref="96i" data-ref-filename="96i">i</a> = <var>0</var>; <a class="local col6 ref" href="#96i" title='i' data-ref="96i" data-ref-filename="96i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>; <a class="local col6 ref" href="#96i" title='i' data-ref="96i" data-ref-filename="96i">i</a>++) {</td></tr>
<tr><th id="1158">1158</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(10)" data-ref="_M/delay">delay</a>(<var>10</var>);</td></tr>
<tr><th id="1159">1159</th><td>		<b>if</b> (!(<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>) &amp; <a class="macro" href="if_bgereg.h.html#848" title="0x20000000" data-ref="_M/BGE_MICOMM_BUSY">BGE_MICOMM_BUSY</a>)) {</td></tr>
<tr><th id="1160">1160</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(5)" data-ref="_M/delay">delay</a>(<var>5</var>);</td></tr>
<tr><th id="1161">1161</th><td>			<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x044C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#644" title="0x044C" data-ref="_M/BGE_MI_COMM">BGE_MI_COMM</a>);</td></tr>
<tr><th id="1162">1162</th><td>			<b>break</b>;</td></tr>
<tr><th id="1163">1163</th><td>		}</td></tr>
<tr><th id="1164">1164</th><td>	}</td></tr>
<tr><th id="1165">1165</th><td></td></tr>
<tr><th id="1166">1166</th><td>	<b>if</b> (<a class="local col5 ref" href="#95autopoll" title='autopoll' data-ref="95autopoll" data-ref-filename="95autopoll">autopoll</a> &amp; <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>) {</td></tr>
<tr><th id="1167">1167</th><td>		<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000004))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>);</td></tr>
<tr><th id="1168">1168</th><td>		<a class="macro" href="if_bgevar.h.html#111" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454) | (0x00000010))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454); } while(0)" data-ref="_M/BGE_SETBIT_FLUSH">BGE_SETBIT_FLUSH</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>);</td></tr>
<tr><th id="1169">1169</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(80)" data-ref="_M/delay">delay</a>(<var>80</var>);</td></tr>
<tr><th id="1170">1170</th><td>	}</td></tr>
<tr><th id="1171">1171</th><td></td></tr>
<tr><th id="1172">1172</th><td>	<a class="tu ref fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-use='c' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>, <a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_ape_lock" title='bge_softc::bge_phy_ape_lock' data-ref="bge_softc::bge_phy_ape_lock" data-ref-filename="bge_softc..bge_phy_ape_lock">bge_phy_ape_lock</a>);</td></tr>
<tr><th id="1173">1173</th><td></td></tr>
<tr><th id="1174">1174</th><td>	<b>if</b> (<a class="local col6 ref" href="#96i" title='i' data-ref="96i" data-ref-filename="96i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>) {</td></tr>
<tr><th id="1175">1175</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col4 ref" href="#94sc" title='sc' data-ref="94sc" data-ref-filename="94sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"PHY read timed out\n"</q>);</td></tr>
<tr><th id="1176">1176</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#111" title="60" data-ref="_M/ETIMEDOUT">ETIMEDOUT</a>;</td></tr>
<tr><th id="1177">1177</th><td>	}</td></tr>
<tr><th id="1178">1178</th><td></td></tr>
<tr><th id="1179">1179</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1180">1180</th><td>}</td></tr>
<tr><th id="1181">1181</th><td></td></tr>
<tr><th id="1182">1182</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1183">1183</th><td><dfn class="tu decl def fn" id="bge_miibus_statchg" title='bge_miibus_statchg' data-type='void bge_miibus_statchg(struct ifnet * ifp)' data-ref="bge_miibus_statchg" data-ref-filename="bge_miibus_statchg">bge_miibus_statchg</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col7 decl" id="97ifp" title='ifp' data-type='struct ifnet *' data-ref="97ifp" data-ref-filename="97ifp">ifp</dfn>)</td></tr>
<tr><th id="1184">1184</th><td>{</td></tr>
<tr><th id="1185">1185</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="98sc" title='sc' data-type='struct bge_softc *' data-ref="98sc" data-ref-filename="98sc">sc</dfn> = <a class="local col7 ref" href="#97ifp" title='ifp' data-ref="97ifp" data-ref-filename="97ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="1186">1186</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col9 decl" id="99mii" title='mii' data-type='struct mii_data *' data-ref="99mii" data-ref-filename="99mii">mii</dfn> = &amp;<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="1187">1187</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="100mac_mode" title='mac_mode' data-type='uint32_t' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</dfn>, <dfn class="local col1 decl" id="101rx_mode" title='rx_mode' data-type='uint32_t' data-ref="101rx_mode" data-ref-filename="101rx_mode">rx_mode</dfn>, <dfn class="local col2 decl" id="102tx_mode" title='tx_mode' data-type='uint32_t' data-ref="102tx_mode" data-ref-filename="102tx_mode">tx_mode</dfn>;</td></tr>
<tr><th id="1188">1188</th><td></td></tr>
<tr><th id="1189">1189</th><td>	<i>/*</i></td></tr>
<tr><th id="1190">1190</th><td><i>	 * Get flow control negotiation result.</i></td></tr>
<tr><th id="1191">1191</th><td><i>	 */</i></td></tr>
<tr><th id="1192">1192</th><td>	<b>if</b> (<a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media.ifm_cur-&gt;ifm_media) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media.ifm_cur-&gt;ifm_media) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media.ifm_cur-&gt;ifm_media) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>.<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_cur" title='ifmedia::ifm_cur' data-ref="ifmedia::ifm_cur" data-ref-filename="ifmedia..ifm_cur">ifm_cur</a>-&gt;<a class="ref field" href="../../net/if_media.h.html#ifmedia_entry::ifm_media" title='ifmedia_entry::ifm_media' data-ref="ifmedia_entry::ifm_media" data-ref-filename="ifmedia_entry..ifm_media">ifm_media</a>) == <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a> &amp;&amp;</td></tr>
<tr><th id="1193">1193</th><td>	    (<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a> &amp; <a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>) != <a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a>)</td></tr>
<tr><th id="1194">1194</th><td>		<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a> = <a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a> &amp; <a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>;</td></tr>
<tr><th id="1195">1195</th><td></td></tr>
<tr><th id="1196">1196</th><td>	<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="1197">1197</th><td>	    <a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a> &amp;&amp;</td></tr>
<tr><th id="1198">1198</th><td>	    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) != <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>)</td></tr>
<tr><th id="1199">1199</th><td>		<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000001))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="1200">1200</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="1201">1201</th><td>	    (!(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a>) ||</td></tr>
<tr><th id="1202">1202</th><td>	    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) == <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>))</td></tr>
<tr><th id="1203">1203</th><td>		<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000001))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="1204">1204</th><td></td></tr>
<tr><th id="1205">1205</th><td>	<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>))</td></tr>
<tr><th id="1206">1206</th><td>		<b>return</b>;</td></tr>
<tr><th id="1207">1207</th><td></td></tr>
<tr><th id="1208">1208</th><td>	<i>/* Set the port mode (MII/GMII) to match the link speed. */</i></td></tr>
<tr><th id="1209">1209</th><td>	<a class="local col0 ref" href="#100mac_mode" title='mac_mode' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>) &amp;</td></tr>
<tr><th id="1210">1210</th><td>	    ~(<a class="macro" href="if_bgereg.h.html#699" title="0x0000000C" data-ref="_M/BGE_MACMODE_PORTMODE">BGE_MACMODE_PORTMODE</a> | <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a>);</td></tr>
<tr><th id="1211">1211</th><td>	<a class="local col2 ref" href="#102tx_mode" title='tx_mode' data-ref="102tx_mode" data-ref-filename="102tx_mode">tx_mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>);</td></tr>
<tr><th id="1212">1212</th><td>	<a class="local col1 ref" href="#101rx_mode" title='rx_mode' data-ref="101rx_mode" data-ref-filename="101rx_mode">rx_mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>);</td></tr>
<tr><th id="1213">1213</th><td>	<b>if</b> (<a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) == <a class="macro" href="../../net/if_media.h.html#231" title="16" data-ref="_M/IFM_1000_T">IFM_1000_T</a> ||</td></tr>
<tr><th id="1214">1214</th><td>	    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) == <a class="macro" href="../../net/if_media.h.html#226" title="11" data-ref="_M/IFM_1000_SX">IFM_1000_SX</a>)</td></tr>
<tr><th id="1215">1215</th><td>		<a class="local col0 ref" href="#100mac_mode" title='mac_mode' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</a> |= <a class="macro" href="if_bgereg.h.html#723" title="0x00000008" data-ref="_M/BGE_PORTMODE_GMII">BGE_PORTMODE_GMII</a>;</td></tr>
<tr><th id="1216">1216</th><td>	<b>else</b></td></tr>
<tr><th id="1217">1217</th><td>		<a class="local col0 ref" href="#100mac_mode" title='mac_mode' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</a> |= <a class="macro" href="if_bgereg.h.html#722" title="0x00000004" data-ref="_M/BGE_PORTMODE_MII">BGE_PORTMODE_MII</a>;</td></tr>
<tr><th id="1218">1218</th><td></td></tr>
<tr><th id="1219">1219</th><td>	<a class="local col2 ref" href="#102tx_mode" title='tx_mode' data-ref="102tx_mode" data-ref-filename="102tx_mode">tx_mode</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#775" title="0x00000010" data-ref="_M/BGE_TXMODE_FLOWCTL_ENABLE">BGE_TXMODE_FLOWCTL_ENABLE</a>;</td></tr>
<tr><th id="1220">1220</th><td>	<a class="local col1 ref" href="#101rx_mode" title='rx_mode' data-ref="101rx_mode" data-ref-filename="101rx_mode">rx_mode</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#800" title="0x00000004" data-ref="_M/BGE_RXMODE_FLOWCTL_ENABLE">BGE_RXMODE_FLOWCTL_ENABLE</a>;</td></tr>
<tr><th id="1221">1221</th><td>	<b>if</b> ((<a class="local col9 ref" href="#99mii" title='mii' data-ref="99mii" data-ref-filename="99mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a> &amp; <a class="macro" href="../../net/if_media.h.html#193" title="0x00100000" data-ref="_M/IFM_FDX">IFM_FDX</a>) != <var>0</var>) {</td></tr>
<tr><th id="1222">1222</th><td>		<b>if</b> (<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a> &amp; <a class="macro" href="../../net/if_media.h.html#323" title="0x00000400" data-ref="_M/IFM_ETH_TXPAUSE">IFM_ETH_TXPAUSE</a>)</td></tr>
<tr><th id="1223">1223</th><td>			<a class="local col2 ref" href="#102tx_mode" title='tx_mode' data-ref="102tx_mode" data-ref-filename="102tx_mode">tx_mode</a> |= <a class="macro" href="if_bgereg.h.html#775" title="0x00000010" data-ref="_M/BGE_TXMODE_FLOWCTL_ENABLE">BGE_TXMODE_FLOWCTL_ENABLE</a>;</td></tr>
<tr><th id="1224">1224</th><td>		<b>if</b> (<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a> &amp; <a class="macro" href="../../net/if_media.h.html#322" title="0x00000200" data-ref="_M/IFM_ETH_RXPAUSE">IFM_ETH_RXPAUSE</a>)</td></tr>
<tr><th id="1225">1225</th><td>			<a class="local col1 ref" href="#101rx_mode" title='rx_mode' data-ref="101rx_mode" data-ref-filename="101rx_mode">rx_mode</a> |= <a class="macro" href="if_bgereg.h.html#800" title="0x00000004" data-ref="_M/BGE_RXMODE_FLOWCTL_ENABLE">BGE_RXMODE_FLOWCTL_ENABLE</a>;</td></tr>
<tr><th id="1226">1226</th><td>	} <b>else</b></td></tr>
<tr><th id="1227">1227</th><td>		<a class="local col0 ref" href="#100mac_mode" title='mac_mode' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</a> |= <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a>;</td></tr>
<tr><th id="1228">1228</th><td></td></tr>
<tr><th id="1229">1229</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, mac_mode); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>, <a class="local col0 ref" href="#100mac_mode" title='mac_mode' data-ref="100mac_mode" data-ref-filename="100mac_mode">mac_mode</a>);</td></tr>
<tr><th id="1230">1230</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="1231">1231</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C, tx_mode)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>, <a class="local col2 ref" href="#102tx_mode" title='tx_mode' data-ref="102tx_mode" data-ref-filename="102tx_mode">tx_mode</a>);</td></tr>
<tr><th id="1232">1232</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, rx_mode)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col8 ref" href="#98sc" title='sc' data-ref="98sc" data-ref-filename="98sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="local col1 ref" href="#101rx_mode" title='rx_mode' data-ref="101rx_mode" data-ref-filename="101rx_mode">rx_mode</a>);</td></tr>
<tr><th id="1233">1233</th><td>}</td></tr>
<tr><th id="1234">1234</th><td></td></tr>
<tr><th id="1235">1235</th><td><i  data-doc="bge_set_thresh">/*</i></td></tr>
<tr><th id="1236">1236</th><td><i  data-doc="bge_set_thresh"> * Update rx threshold levels to values in a particular slot</i></td></tr>
<tr><th id="1237">1237</th><td><i  data-doc="bge_set_thresh"> * of the interrupt-mitigation table bge_rx_threshes.</i></td></tr>
<tr><th id="1238">1238</th><td><i  data-doc="bge_set_thresh"> */</i></td></tr>
<tr><th id="1239">1239</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1240">1240</th><td><dfn class="tu decl def fn" id="bge_set_thresh" title='bge_set_thresh' data-type='void bge_set_thresh(struct ifnet * ifp, int lvl)' data-ref="bge_set_thresh" data-ref-filename="bge_set_thresh">bge_set_thresh</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col3 decl" id="103ifp" title='ifp' data-type='struct ifnet *' data-ref="103ifp" data-ref-filename="103ifp">ifp</dfn>, <em>int</em> <dfn class="local col4 decl" id="104lvl" title='lvl' data-type='int' data-ref="104lvl" data-ref-filename="104lvl">lvl</dfn>)</td></tr>
<tr><th id="1241">1241</th><td>{</td></tr>
<tr><th id="1242">1242</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="105sc" title='sc' data-type='struct bge_softc *' data-ref="105sc" data-ref-filename="105sc">sc</dfn> = <a class="local col3 ref" href="#103ifp" title='ifp' data-ref="103ifp" data-ref-filename="103ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="1243">1243</th><td>	<em>int</em> <dfn class="local col6 decl" id="106s" title='s' data-type='int' data-ref="106s" data-ref-filename="106s">s</dfn>;</td></tr>
<tr><th id="1244">1244</th><td></td></tr>
<tr><th id="1245">1245</th><td>	<i>/* For now, just save the new Rx-intr thresholds and record</i></td></tr>
<tr><th id="1246">1246</th><td><i>	 * that a threshold update is pending.  Updating the hardware</i></td></tr>
<tr><th id="1247">1247</th><td><i>	 * registers here (even at splhigh()) is observed to</i></td></tr>
<tr><th id="1248">1248</th><td><i>	 * occasionaly cause glitches where Rx-interrupts are not</i></td></tr>
<tr><th id="1249">1249</th><td><i>	 * honoured for up to 10 seconds. jonathan@NetBSD.org, 2003-04-05</i></td></tr>
<tr><th id="1250">1250</th><td><i>	 */</i></td></tr>
<tr><th id="1251">1251</th><td>	<a class="local col6 ref" href="#106s" title='s' data-ref="106s" data-ref-filename="106s">s</a> = <a class="macro" href="../../sys/intr.h.html#92" title="splvm()" data-ref="_M/splnet">splnet</a>();</td></tr>
<tr><th id="1252">1252</th><td>	<a class="local col5 ref" href="#105sc" title='sc' data-ref="105sc" data-ref-filename="105sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_coal_ticks" title='bge_softc::bge_rx_coal_ticks' data-ref="bge_softc::bge_rx_coal_ticks" data-ref-filename="bge_softc..bge_rx_coal_ticks">bge_rx_coal_ticks</a> = <a class="tu ref" href="#bge_rx_threshes" title='bge_rx_threshes' data-use='m' data-ref="bge_rx_threshes" data-ref-filename="bge_rx_threshes">bge_rx_threshes</a>[<a class="local col4 ref" href="#104lvl" title='lvl' data-ref="104lvl" data-ref-filename="104lvl">lvl</a>].<a class="tu ref field" href="#bge_load_rx_thresh::rx_ticks" title='bge_load_rx_thresh::rx_ticks' data-use='r' data-ref="bge_load_rx_thresh::rx_ticks" data-ref-filename="bge_load_rx_thresh..rx_ticks">rx_ticks</a>;</td></tr>
<tr><th id="1253">1253</th><td>	<a class="local col5 ref" href="#105sc" title='sc' data-ref="105sc" data-ref-filename="105sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_max_coal_bds" title='bge_softc::bge_rx_max_coal_bds' data-ref="bge_softc::bge_rx_max_coal_bds" data-ref-filename="bge_softc..bge_rx_max_coal_bds">bge_rx_max_coal_bds</a> = <a class="tu ref" href="#bge_rx_threshes" title='bge_rx_threshes' data-use='m' data-ref="bge_rx_threshes" data-ref-filename="bge_rx_threshes">bge_rx_threshes</a>[<a class="local col4 ref" href="#104lvl" title='lvl' data-ref="104lvl" data-ref-filename="104lvl">lvl</a>].<a class="tu ref field" href="#bge_load_rx_thresh::rx_max_bds" title='bge_load_rx_thresh::rx_max_bds' data-use='r' data-ref="bge_load_rx_thresh::rx_max_bds" data-ref-filename="bge_load_rx_thresh..rx_max_bds">rx_max_bds</a>;</td></tr>
<tr><th id="1254">1254</th><td>	<a class="local col5 ref" href="#105sc" title='sc' data-ref="105sc" data-ref-filename="105sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pending_rxintr_change" title='bge_softc::bge_pending_rxintr_change' data-ref="bge_softc::bge_pending_rxintr_change" data-ref-filename="bge_softc..bge_pending_rxintr_change">bge_pending_rxintr_change</a> = <var>1</var>;</td></tr>
<tr><th id="1255">1255</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col6 ref" href="#106s" title='s' data-ref="106s" data-ref-filename="106s">s</a>);</td></tr>
<tr><th id="1256">1256</th><td>}</td></tr>
<tr><th id="1257">1257</th><td></td></tr>
<tr><th id="1258">1258</th><td></td></tr>
<tr><th id="1259">1259</th><td><i  data-doc="bge_update_all_threshes">/*</i></td></tr>
<tr><th id="1260">1260</th><td><i  data-doc="bge_update_all_threshes"> * Update Rx thresholds of all bge devices</i></td></tr>
<tr><th id="1261">1261</th><td><i  data-doc="bge_update_all_threshes"> */</i></td></tr>
<tr><th id="1262">1262</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1263">1263</th><td><dfn class="tu decl def fn" id="bge_update_all_threshes" title='bge_update_all_threshes' data-type='void bge_update_all_threshes(int lvl)' data-ref="bge_update_all_threshes" data-ref-filename="bge_update_all_threshes">bge_update_all_threshes</dfn>(<em>int</em> <dfn class="local col7 decl" id="107lvl" title='lvl' data-type='int' data-ref="107lvl" data-ref-filename="107lvl">lvl</dfn>)</td></tr>
<tr><th id="1264">1264</th><td>{</td></tr>
<tr><th id="1265">1265</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col8 decl" id="108ifp" title='ifp' data-type='struct ifnet *' data-ref="108ifp" data-ref-filename="108ifp">ifp</dfn>;</td></tr>
<tr><th id="1266">1266</th><td>	<em>const</em> <em>char</em> * <em>const</em> <dfn class="local col9 decl" id="109namebuf" title='namebuf' data-type='const char *const' data-ref="109namebuf" data-ref-filename="109namebuf">namebuf</dfn> = <q>"bge"</q>;</td></tr>
<tr><th id="1267">1267</th><td>	<em>int</em> <dfn class="local col0 decl" id="110namelen" title='namelen' data-type='int' data-ref="110namelen" data-ref-filename="110namelen">namelen</dfn>;</td></tr>
<tr><th id="1268">1268</th><td>	<em>int</em> <dfn class="local col1 decl" id="111s" title='s' data-type='int' data-ref="111s" data-ref-filename="111s">s</dfn>;</td></tr>
<tr><th id="1269">1269</th><td></td></tr>
<tr><th id="1270">1270</th><td>	<b>if</b> (<a class="local col7 ref" href="#107lvl" title='lvl' data-ref="107lvl" data-ref-filename="107lvl">lvl</a> &lt; <var>0</var>)</td></tr>
<tr><th id="1271">1271</th><td>		<a class="local col7 ref" href="#107lvl" title='lvl' data-ref="107lvl" data-ref-filename="107lvl">lvl</a> = <var>0</var>;</td></tr>
<tr><th id="1272">1272</th><td>	<b>else</b> <b>if</b> (<a class="local col7 ref" href="#107lvl" title='lvl' data-ref="107lvl" data-ref-filename="107lvl">lvl</a> &gt;= <a class="macro" href="#172" title="(sizeof(bge_rx_threshes) / sizeof(bge_rx_threshes[0]))" data-ref="_M/NBGE_RX_THRESH">NBGE_RX_THRESH</a>)</td></tr>
<tr><th id="1273">1273</th><td>		<a class="local col7 ref" href="#107lvl" title='lvl' data-ref="107lvl" data-ref-filename="107lvl">lvl</a> = <a class="macro" href="#172" title="(sizeof(bge_rx_threshes) / sizeof(bge_rx_threshes[0]))" data-ref="_M/NBGE_RX_THRESH">NBGE_RX_THRESH</a> - <var>1</var>;</td></tr>
<tr><th id="1274">1274</th><td></td></tr>
<tr><th id="1275">1275</th><td>	<a class="local col0 ref" href="#110namelen" title='namelen' data-ref="110namelen" data-ref-filename="110namelen">namelen</a> = <a class="macro" href="../../lib/libkern/libkern.h.html#402" title="__builtin_strlen(namebuf)" data-ref="_M/strlen">strlen</a>(<a class="local col9 ref" href="#109namebuf" title='namebuf' data-ref="109namebuf" data-ref-filename="109namebuf">namebuf</a>);</td></tr>
<tr><th id="1276">1276</th><td>	<i>/*</i></td></tr>
<tr><th id="1277">1277</th><td><i>	 * Now search all the interfaces for this name/number</i></td></tr>
<tr><th id="1278">1278</th><td><i>	 */</i></td></tr>
<tr><th id="1279">1279</th><td>	<a class="local col1 ref" href="#111s" title='s' data-ref="111s" data-ref-filename="111s">s</a> = <a class="ref fn" href="../../sys/pserialize.h.html#pserialize_read_enter" title='pserialize_read_enter' data-ref="pserialize_read_enter" data-ref-filename="pserialize_read_enter">pserialize_read_enter</a>();</td></tr>
<tr><th id="1280">1280</th><td>	<a class="macro" href="../../net/if.h.html#1284" title="for (((ifp)) = ((struct ifnet *)(_pslist_reader_first_container(((&amp;ifnet_pslist)), __builtin_offsetof(struct ifnet, if_pslist_entry))) + (0 * sizeof((pslist_reader_first((&amp;ifnet_pslist))) - &amp;((struct ifnet *)(((char *)(pslist_reader_first((&amp;ifnet_pslist)))) - __builtin_offsetof(struct ifnet, if_pslist_entry)))-&gt;if_pslist_entry))); ((ifp)) != ((void *)0); ((ifp)) = ((struct ifnet *)(_pslist_reader_next_container(&amp;(((ifp)))-&gt;if_pslist_entry, __builtin_offsetof(struct ifnet, if_pslist_entry))) + (0 * sizeof((pslist_reader_next(&amp;(((ifp)))-&gt;if_pslist_entry)) - &amp;((struct ifnet *)(((char *)(pslist_reader_next(&amp;(((ifp)))-&gt;if_pslist_entry))) - __builtin_offsetof(struct ifnet, if_pslist_entry)))-&gt;if_pslist_entry))))" data-ref="_M/IFNET_READER_FOREACH">IFNET_READER_FOREACH</a>(<a class="local col8 ref" href="#108ifp" title='ifp' data-ref="108ifp" data-ref-filename="108ifp">ifp</a>) {</td></tr>
<tr><th id="1281">1281</th><td>		<b>if</b> (<a class="ref fn" href="../../lib/libkern/libkern.h.html#strncmp" title='strncmp' data-ref="strncmp" data-ref-filename="strncmp">strncmp</a>(<a class="local col8 ref" href="#108ifp" title='ifp' data-ref="108ifp" data-ref-filename="108ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_xname" title='ifnet::if_xname' data-ref="ifnet::if_xname" data-ref-filename="ifnet..if_xname">if_xname</a>, <a class="local col9 ref" href="#109namebuf" title='namebuf' data-ref="109namebuf" data-ref-filename="109namebuf">namebuf</a>, <a class="local col0 ref" href="#110namelen" title='namelen' data-ref="110namelen" data-ref-filename="110namelen">namelen</a>) != <var>0</var>)</td></tr>
<tr><th id="1282">1282</th><td>		      <b>continue</b>;</td></tr>
<tr><th id="1283">1283</th><td>		<i>/* We got a match: update if doing auto-threshold-tuning */</i></td></tr>
<tr><th id="1284">1284</th><td>		<b>if</b> (<a class="tu ref" href="#bge_auto_thresh" title='bge_auto_thresh' data-use='r' data-ref="bge_auto_thresh" data-ref-filename="bge_auto_thresh">bge_auto_thresh</a>)</td></tr>
<tr><th id="1285">1285</th><td>			<a class="tu ref fn" href="#bge_set_thresh" title='bge_set_thresh' data-use='c' data-ref="bge_set_thresh" data-ref-filename="bge_set_thresh">bge_set_thresh</a>(<a class="local col8 ref" href="#108ifp" title='ifp' data-ref="108ifp" data-ref-filename="108ifp">ifp</a>, <a class="local col7 ref" href="#107lvl" title='lvl' data-ref="107lvl" data-ref-filename="107lvl">lvl</a>);</td></tr>
<tr><th id="1286">1286</th><td>	}</td></tr>
<tr><th id="1287">1287</th><td>	<a class="ref fn" href="../../sys/pserialize.h.html#pserialize_read_exit" title='pserialize_read_exit' data-ref="pserialize_read_exit" data-ref-filename="pserialize_read_exit">pserialize_read_exit</a>(<a class="local col1 ref" href="#111s" title='s' data-ref="111s" data-ref-filename="111s">s</a>);</td></tr>
<tr><th id="1288">1288</th><td>}</td></tr>
<tr><th id="1289">1289</th><td></td></tr>
<tr><th id="1290">1290</th><td><i  data-doc="bge_handle_events">/*</i></td></tr>
<tr><th id="1291">1291</th><td><i  data-doc="bge_handle_events"> * Handle events that have triggered interrupts.</i></td></tr>
<tr><th id="1292">1292</th><td><i  data-doc="bge_handle_events"> */</i></td></tr>
<tr><th id="1293">1293</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1294">1294</th><td><dfn class="tu decl def fn" id="bge_handle_events" title='bge_handle_events' data-type='void bge_handle_events(struct bge_softc * sc)' data-ref="bge_handle_events" data-ref-filename="bge_handle_events">bge_handle_events</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col2 decl" id="112sc" title='sc' data-type='struct bge_softc *' data-ref="112sc" data-ref-filename="112sc">sc</dfn>)</td></tr>
<tr><th id="1295">1295</th><td>{</td></tr>
<tr><th id="1296">1296</th><td></td></tr>
<tr><th id="1297">1297</th><td>	<b>return</b>;</td></tr>
<tr><th id="1298">1298</th><td>}</td></tr>
<tr><th id="1299">1299</th><td></td></tr>
<tr><th id="1300">1300</th><td><i  data-doc="bge_alloc_jumbo_mem">/*</i></td></tr>
<tr><th id="1301">1301</th><td><i  data-doc="bge_alloc_jumbo_mem"> * Memory management for jumbo frames.</i></td></tr>
<tr><th id="1302">1302</th><td><i  data-doc="bge_alloc_jumbo_mem"> */</i></td></tr>
<tr><th id="1303">1303</th><td></td></tr>
<tr><th id="1304">1304</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1305">1305</th><td><dfn class="tu decl def fn" id="bge_alloc_jumbo_mem" title='bge_alloc_jumbo_mem' data-type='int bge_alloc_jumbo_mem(struct bge_softc * sc)' data-ref="bge_alloc_jumbo_mem" data-ref-filename="bge_alloc_jumbo_mem">bge_alloc_jumbo_mem</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="113sc" title='sc' data-type='struct bge_softc *' data-ref="113sc" data-ref-filename="113sc">sc</dfn>)</td></tr>
<tr><th id="1306">1306</th><td>{</td></tr>
<tr><th id="1307">1307</th><td>	<em>char</em> *<dfn class="local col4 decl" id="114ptr" title='ptr' data-type='char *' data-ref="114ptr" data-ref-filename="114ptr">ptr</dfn>, *<dfn class="local col5 decl" id="115kva" title='kva' data-type='char *' data-ref="115kva" data-ref-filename="115kva">kva</dfn>;</td></tr>
<tr><th id="1308">1308</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dma_segment_t" title='bus_dma_segment_t' data-type='struct x86_bus_dma_segment' data-ref="bus_dma_segment_t" data-ref-filename="bus_dma_segment_t">bus_dma_segment_t</a>	<dfn class="local col6 decl" id="116seg" title='seg' data-type='bus_dma_segment_t' data-ref="116seg" data-ref-filename="116seg">seg</dfn>;</td></tr>
<tr><th id="1309">1309</th><td>	<em>int</em>		<dfn class="local col7 decl" id="117i" title='i' data-type='int' data-ref="117i" data-ref-filename="117i">i</dfn>, <dfn class="local col8 decl" id="118rseg" title='rseg' data-type='int' data-ref="118rseg" data-ref-filename="118rseg">rseg</dfn>, <dfn class="local col9 decl" id="119state" title='state' data-type='int' data-ref="119state" data-ref-filename="119state">state</dfn>, <dfn class="local col0 decl" id="120error" title='error' data-type='int' data-ref="120error" data-ref-filename="120error">error</dfn>;</td></tr>
<tr><th id="1310">1310</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_jpool_entry" title='bge_jpool_entry' data-ref="bge_jpool_entry" data-ref-filename="bge_jpool_entry">bge_jpool_entry</a>	 *<dfn class="local col1 decl" id="121entry" title='entry' data-type='struct bge_jpool_entry *' data-ref="121entry" data-ref-filename="121entry">entry</dfn>;</td></tr>
<tr><th id="1311">1311</th><td></td></tr>
<tr><th id="1312">1312</th><td>	<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a> = <a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> = <var>0</var>;</td></tr>
<tr><th id="1313">1313</th><td></td></tr>
<tr><th id="1314">1314</th><td>	<i>/* Grab a big chunk o' storage. */</i></td></tr>
<tr><th id="1315">1315</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_alloc" title='bus_dmamem_alloc' data-ref="bus_dmamem_alloc" data-ref-filename="bus_dmamem_alloc">bus_dmamem_alloc</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>, <a class="macro" href="../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <var>0</var>,</td></tr>
<tr><th id="1316">1316</th><td>	     &amp;<a class="local col6 ref" href="#116seg" title='seg' data-ref="116seg" data-ref-filename="116seg">seg</a>, <var>1</var>, &amp;<a class="local col8 ref" href="#118rseg" title='rseg' data-ref="118rseg" data-ref-filename="118rseg">rseg</a>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="1317">1317</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't alloc rx buffers\n"</q>);</td></tr>
<tr><th id="1318">1318</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1319">1319</th><td>	}</td></tr>
<tr><th id="1320">1320</th><td></td></tr>
<tr><th id="1321">1321</th><td>	<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a> = <var>1</var>;</td></tr>
<tr><th id="1322">1322</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_map" title='bus_dmamem_map' data-ref="bus_dmamem_map" data-ref-filename="bus_dmamem_map">bus_dmamem_map</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#116seg" title='seg' data-ref="116seg" data-ref-filename="116seg">seg</a>, <a class="local col8 ref" href="#118rseg" title='rseg' data-ref="118rseg" data-ref-filename="118rseg">rseg</a>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>, (<em>void</em> **)&amp;<a class="local col5 ref" href="#115kva" title='kva' data-ref="115kva" data-ref-filename="115kva">kva</a>,</td></tr>
<tr><th id="1323">1323</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="1324">1324</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="1325">1325</th><td>		    <q>"can't map DMA buffers (%d bytes)\n"</q>, (<em>int</em>)<a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>);</td></tr>
<tr><th id="1326">1326</th><td>		<a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> = <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1327">1327</th><td>		<b>goto</b> <a class="lbl" href="#122out" data-ref="122out" data-ref-filename="122out">out</a>;</td></tr>
<tr><th id="1328">1328</th><td>	}</td></tr>
<tr><th id="1329">1329</th><td></td></tr>
<tr><th id="1330">1330</th><td>	<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a> = <var>2</var>;</td></tr>
<tr><th id="1331">1331</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_create" title='bus_dmamap_create' data-ref="bus_dmamap_create" data-ref-filename="bus_dmamap_create">bus_dmamap_create</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>, <var>1</var>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>, <var>0</var>,</td></tr>
<tr><th id="1332">1332</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>, &amp;<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>)) {</td></tr>
<tr><th id="1333">1333</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't create DMA map\n"</q>);</td></tr>
<tr><th id="1334">1334</th><td>		<a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> = <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1335">1335</th><td>		<b>goto</b> <a class="lbl" href="#122out" data-ref="122out" data-ref-filename="122out">out</a>;</td></tr>
<tr><th id="1336">1336</th><td>	}</td></tr>
<tr><th id="1337">1337</th><td></td></tr>
<tr><th id="1338">1338</th><td>	<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a> = <var>3</var>;</td></tr>
<tr><th id="1339">1339</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_load" title='bus_dmamap_load' data-ref="bus_dmamap_load" data-ref-filename="bus_dmamap_load">bus_dmamap_load</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>,</td></tr>
<tr><th id="1340">1340</th><td>	    <a class="local col5 ref" href="#115kva" title='kva' data-ref="115kva" data-ref-filename="115kva">kva</a>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="1341">1341</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't load DMA map\n"</q>);</td></tr>
<tr><th id="1342">1342</th><td>		<a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> = <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1343">1343</th><td>		<b>goto</b> <a class="lbl" href="#122out" data-ref="122out" data-ref-filename="122out">out</a>;</td></tr>
<tr><th id="1344">1344</th><td>	}</td></tr>
<tr><th id="1345">1345</th><td></td></tr>
<tr><th id="1346">1346</th><td>	<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a> = <var>4</var>;</td></tr>
<tr><th id="1347">1347</th><td>	<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jumbo_buf" title='bge_chain_data::bge_jumbo_buf' data-ref="bge_chain_data::bge_jumbo_buf" data-ref-filename="bge_chain_data..bge_jumbo_buf">bge_jumbo_buf</a> = (<em>void</em> *)<a class="local col5 ref" href="#115kva" title='kva' data-ref="115kva" data-ref-filename="115kva">kva</a>;</td></tr>
<tr><th id="1348">1348</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>1</var>,(<q>"bge_jumbo_buf = %p\n"</q>, sc-&gt;bge_cdata.bge_jumbo_buf));</td></tr>
<tr><th id="1349">1349</th><td></td></tr>
<tr><th id="1350">1350</th><td>	<a class="macro" href="../../sys/queue.h.html#148" title="do { (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first = ((void *)0); } while ( 0)" data-ref="_M/SLIST_INIT">SLIST_INIT</a>(&amp;<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jfree_listhead" title='bge_softc::bge_jfree_listhead' data-ref="bge_softc::bge_jfree_listhead" data-ref-filename="bge_softc..bge_jfree_listhead">bge_jfree_listhead</a>);</td></tr>
<tr><th id="1351">1351</th><td>	<a class="macro" href="../../sys/queue.h.html#148" title="do { (&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first = ((void *)0); } while ( 0)" data-ref="_M/SLIST_INIT">SLIST_INIT</a>(&amp;<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jinuse_listhead" title='bge_softc::bge_jinuse_listhead' data-ref="bge_softc::bge_jinuse_listhead" data-ref-filename="bge_softc..bge_jinuse_listhead">bge_jinuse_listhead</a>);</td></tr>
<tr><th id="1352">1352</th><td></td></tr>
<tr><th id="1353">1353</th><td>	<i>/*</i></td></tr>
<tr><th id="1354">1354</th><td><i>	 * Now divide it up into 9K pieces and save the addresses</i></td></tr>
<tr><th id="1355">1355</th><td><i>	 * in an array.</i></td></tr>
<tr><th id="1356">1356</th><td><i>	 */</i></td></tr>
<tr><th id="1357">1357</th><td>	<a class="local col4 ref" href="#114ptr" title='ptr' data-ref="114ptr" data-ref-filename="114ptr">ptr</a> = <a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jumbo_buf" title='bge_chain_data::bge_jumbo_buf' data-ref="bge_chain_data::bge_jumbo_buf" data-ref-filename="bge_chain_data..bge_jumbo_buf">bge_jumbo_buf</a>;</td></tr>
<tr><th id="1358">1358</th><td>	<b>for</b> (<a class="local col7 ref" href="#117i" title='i' data-ref="117i" data-ref-filename="117i">i</a> = <var>0</var>; <a class="local col7 ref" href="#117i" title='i' data-ref="117i" data-ref-filename="117i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#155" title="384" data-ref="_M/BGE_JSLOTS">BGE_JSLOTS</a>; <a class="local col7 ref" href="#117i" title='i' data-ref="117i" data-ref-filename="117i">i</a>++) {</td></tr>
<tr><th id="1359">1359</th><td>		<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jslots" title='bge_chain_data::bge_jslots' data-ref="bge_chain_data::bge_jslots" data-ref-filename="bge_chain_data..bge_jslots">bge_jslots</a>[<a class="local col7 ref" href="#117i" title='i' data-ref="117i" data-ref-filename="117i">i</a>] = <a class="local col4 ref" href="#114ptr" title='ptr' data-ref="114ptr" data-ref-filename="114ptr">ptr</a>;</td></tr>
<tr><th id="1360">1360</th><td>		<a class="local col4 ref" href="#114ptr" title='ptr' data-ref="114ptr" data-ref-filename="114ptr">ptr</a> += <a class="macro" href="if_bgevar.h.html#158" title="((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t))))" data-ref="_M/BGE_JLEN">BGE_JLEN</a>;</td></tr>
<tr><th id="1361">1361</th><td>		<a class="local col1 ref" href="#121entry" title='entry' data-ref="121entry" data-ref-filename="121entry">entry</a> = <a class="macro" href="../../sys/malloc.h.html#70" title="kern_malloc(sizeof(struct bge_jpool_entry), 0x0001)" data-ref="_M/malloc">malloc</a>(<b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_jpool_entry" title='bge_jpool_entry' data-ref="bge_jpool_entry" data-ref-filename="bge_jpool_entry">bge_jpool_entry</a>),</td></tr>
<tr><th id="1362">1362</th><td>		    M_DEVBUF, <a class="macro" href="../../sys/malloc.h.html#43" title="0x0001" data-ref="_M/M_NOWAIT">M_NOWAIT</a>);</td></tr>
<tr><th id="1363">1363</th><td>		<b>if</b> (<a class="local col1 ref" href="#121entry" title='entry' data-ref="121entry" data-ref-filename="121entry">entry</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1364">1364</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="1365">1365</th><td>			    <q>"no memory for jumbo buffer queue!\n"</q>);</td></tr>
<tr><th id="1366">1366</th><td>			<a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> = <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1367">1367</th><td>			<b>goto</b> <a class="lbl" href="#122out" data-ref="122out" data-ref-filename="122out">out</a>;</td></tr>
<tr><th id="1368">1368</th><td>		}</td></tr>
<tr><th id="1369">1369</th><td>		<a class="local col1 ref" href="#121entry" title='entry' data-ref="121entry" data-ref-filename="121entry">entry</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::slot" title='bge_jpool_entry::slot' data-ref="bge_jpool_entry::slot" data-ref-filename="bge_jpool_entry..slot">slot</a> = <a class="local col7 ref" href="#117i" title='i' data-ref="117i" data-ref-filename="117i">i</a>;</td></tr>
<tr><th id="1370">1370</th><td>		<a class="macro" href="../../sys/queue.h.html#157" title="do { (entry)-&gt;jpool_entries.sle_next = (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first; (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first = (entry); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jfree_listhead" title='bge_softc::bge_jfree_listhead' data-ref="bge_softc::bge_jfree_listhead" data-ref-filename="bge_softc..bge_jfree_listhead">bge_jfree_listhead</a>,</td></tr>
<tr><th id="1371">1371</th><td>				 <a class="local col1 ref" href="#121entry" title='entry' data-ref="121entry" data-ref-filename="121entry">entry</a>, <a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::jpool_entries" title='bge_jpool_entry::jpool_entries' data-ref="bge_jpool_entry::jpool_entries" data-ref-filename="bge_jpool_entry..jpool_entries">jpool_entries</a>);</td></tr>
<tr><th id="1372">1372</th><td>	}</td></tr>
<tr><th id="1373">1373</th><td><dfn class="lbl" id="122out" data-ref="122out" data-ref-filename="122out">out</dfn>:</td></tr>
<tr><th id="1374">1374</th><td>	<b>if</b> (<a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a> != <var>0</var>) {</td></tr>
<tr><th id="1375">1375</th><td>		<b>switch</b> (<a class="local col9 ref" href="#119state" title='state' data-ref="119state" data-ref-filename="119state">state</a>) {</td></tr>
<tr><th id="1376">1376</th><td>		<b>case</b> <var>4</var>:</td></tr>
<tr><th id="1377">1377</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>,</td></tr>
<tr><th id="1378">1378</th><td>			    <a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>);</td></tr>
<tr><th id="1379">1379</th><td>			<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="1380">1380</th><td>		<b>case</b> <var>3</var>:</td></tr>
<tr><th id="1381">1381</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>,</td></tr>
<tr><th id="1382">1382</th><td>			    <a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>);</td></tr>
<tr><th id="1383">1383</th><td>			<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="1384">1384</th><td>		<b>case</b> <var>2</var>:</td></tr>
<tr><th id="1385">1385</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_unmap" title='bus_dmamem_unmap' data-ref="bus_dmamem_unmap" data-ref-filename="bus_dmamem_unmap">bus_dmamem_unmap</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col5 ref" href="#115kva" title='kva' data-ref="115kva" data-ref-filename="115kva">kva</a>, <a class="macro" href="if_bgevar.h.html#162" title="((((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) + ((1 &lt;&lt; 12) - (((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t)))) * 384) % (1 &lt;&lt; 12)))" data-ref="_M/BGE_JMEM">BGE_JMEM</a>);</td></tr>
<tr><th id="1386">1386</th><td>			<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="1387">1387</th><td>		<b>case</b> <var>1</var>:</td></tr>
<tr><th id="1388">1388</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_free" title='bus_dmamem_free' data-ref="bus_dmamem_free" data-ref-filename="bus_dmamem_free">bus_dmamem_free</a>(<a class="local col3 ref" href="#113sc" title='sc' data-ref="113sc" data-ref-filename="113sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#116seg" title='seg' data-ref="116seg" data-ref-filename="116seg">seg</a>, <a class="local col8 ref" href="#118rseg" title='rseg' data-ref="118rseg" data-ref-filename="118rseg">rseg</a>);</td></tr>
<tr><th id="1389">1389</th><td>			<b>break</b>;</td></tr>
<tr><th id="1390">1390</th><td>		<b>default</b>:</td></tr>
<tr><th id="1391">1391</th><td>			<b>break</b>;</td></tr>
<tr><th id="1392">1392</th><td>		}</td></tr>
<tr><th id="1393">1393</th><td>	}</td></tr>
<tr><th id="1394">1394</th><td></td></tr>
<tr><th id="1395">1395</th><td>	<b>return</b> <a class="local col0 ref" href="#120error" title='error' data-ref="120error" data-ref-filename="120error">error</a>;</td></tr>
<tr><th id="1396">1396</th><td>}</td></tr>
<tr><th id="1397">1397</th><td></td></tr>
<tr><th id="1398">1398</th><td><i  data-doc="bge_jalloc">/*</i></td></tr>
<tr><th id="1399">1399</th><td><i  data-doc="bge_jalloc"> * Allocate a jumbo buffer.</i></td></tr>
<tr><th id="1400">1400</th><td><i  data-doc="bge_jalloc"> */</i></td></tr>
<tr><th id="1401">1401</th><td><em>static</em> <em>void</em> *</td></tr>
<tr><th id="1402">1402</th><td><dfn class="tu decl def fn" id="bge_jalloc" title='bge_jalloc' data-type='void * bge_jalloc(struct bge_softc * sc)' data-ref="bge_jalloc" data-ref-filename="bge_jalloc">bge_jalloc</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="123sc" title='sc' data-type='struct bge_softc *' data-ref="123sc" data-ref-filename="123sc">sc</dfn>)</td></tr>
<tr><th id="1403">1403</th><td>{</td></tr>
<tr><th id="1404">1404</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_jpool_entry" title='bge_jpool_entry' data-ref="bge_jpool_entry" data-ref-filename="bge_jpool_entry">bge_jpool_entry</a>	 *<dfn class="local col4 decl" id="124entry" title='entry' data-type='struct bge_jpool_entry *' data-ref="124entry" data-ref-filename="124entry">entry</dfn>;</td></tr>
<tr><th id="1405">1405</th><td></td></tr>
<tr><th id="1406">1406</th><td>	<a class="local col4 ref" href="#124entry" title='entry' data-ref="124entry" data-ref-filename="124entry">entry</a> = <a class="macro" href="../../sys/queue.h.html#129" title="((&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first)" data-ref="_M/SLIST_FIRST">SLIST_FIRST</a>(&amp;<a class="local col3 ref" href="#123sc" title='sc' data-ref="123sc" data-ref-filename="123sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jfree_listhead" title='bge_softc::bge_jfree_listhead' data-ref="bge_softc::bge_jfree_listhead" data-ref-filename="bge_softc..bge_jfree_listhead">bge_jfree_listhead</a>);</td></tr>
<tr><th id="1407">1407</th><td></td></tr>
<tr><th id="1408">1408</th><td>	<b>if</b> (<a class="local col4 ref" href="#124entry" title='entry' data-ref="124entry" data-ref-filename="124entry">entry</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1409">1409</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#123sc" title='sc' data-ref="123sc" data-ref-filename="123sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"no free jumbo buffers\n"</q>);</td></tr>
<tr><th id="1410">1410</th><td>		<b>return</b> <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1411">1411</th><td>	}</td></tr>
<tr><th id="1412">1412</th><td></td></tr>
<tr><th id="1413">1413</th><td>	<a class="macro" href="../../sys/queue.h.html#167" title="do { (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first = (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first-&gt;jpool_entries.sle_next; } while ( 0)" data-ref="_M/SLIST_REMOVE_HEAD">SLIST_REMOVE_HEAD</a>(&amp;<a class="local col3 ref" href="#123sc" title='sc' data-ref="123sc" data-ref-filename="123sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jfree_listhead" title='bge_softc::bge_jfree_listhead' data-ref="bge_softc::bge_jfree_listhead" data-ref-filename="bge_softc..bge_jfree_listhead">bge_jfree_listhead</a>, <a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::jpool_entries" title='bge_jpool_entry::jpool_entries' data-ref="bge_jpool_entry::jpool_entries" data-ref-filename="bge_jpool_entry..jpool_entries">jpool_entries</a>);</td></tr>
<tr><th id="1414">1414</th><td>	<a class="macro" href="../../sys/queue.h.html#157" title="do { (entry)-&gt;jpool_entries.sle_next = (&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first; (&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first = (entry); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col3 ref" href="#123sc" title='sc' data-ref="123sc" data-ref-filename="123sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jinuse_listhead" title='bge_softc::bge_jinuse_listhead' data-ref="bge_softc::bge_jinuse_listhead" data-ref-filename="bge_softc..bge_jinuse_listhead">bge_jinuse_listhead</a>, <a class="local col4 ref" href="#124entry" title='entry' data-ref="124entry" data-ref-filename="124entry">entry</a>, <a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::jpool_entries" title='bge_jpool_entry::jpool_entries' data-ref="bge_jpool_entry::jpool_entries" data-ref-filename="bge_jpool_entry..jpool_entries">jpool_entries</a>);</td></tr>
<tr><th id="1415">1415</th><td>	<b>return</b> (<a class="local col3 ref" href="#123sc" title='sc' data-ref="123sc" data-ref-filename="123sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jslots" title='bge_chain_data::bge_jslots' data-ref="bge_chain_data::bge_jslots" data-ref-filename="bge_chain_data..bge_jslots">bge_jslots</a>[<a class="local col4 ref" href="#124entry" title='entry' data-ref="124entry" data-ref-filename="124entry">entry</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::slot" title='bge_jpool_entry::slot' data-ref="bge_jpool_entry::slot" data-ref-filename="bge_jpool_entry..slot">slot</a>]);</td></tr>
<tr><th id="1416">1416</th><td>}</td></tr>
<tr><th id="1417">1417</th><td></td></tr>
<tr><th id="1418">1418</th><td><i  data-doc="bge_jfree">/*</i></td></tr>
<tr><th id="1419">1419</th><td><i  data-doc="bge_jfree"> * Release a jumbo buffer.</i></td></tr>
<tr><th id="1420">1420</th><td><i  data-doc="bge_jfree"> */</i></td></tr>
<tr><th id="1421">1421</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1422">1422</th><td><dfn class="tu decl def fn" id="bge_jfree" title='bge_jfree' data-type='void bge_jfree(struct mbuf * m, void * buf, size_t size, void * arg)' data-ref="bge_jfree" data-ref-filename="bge_jfree">bge_jfree</dfn>(<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col5 decl" id="125m" title='m' data-type='struct mbuf *' data-ref="125m" data-ref-filename="125m">m</dfn>, <em>void</em> *<dfn class="local col6 decl" id="126buf" title='buf' data-type='void *' data-ref="126buf" data-ref-filename="126buf">buf</dfn>, <a class="typedef" href="../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col7 decl" id="127size" title='size' data-type='size_t' data-ref="127size" data-ref-filename="127size">size</dfn>, <em>void</em> *<dfn class="local col8 decl" id="128arg" title='arg' data-type='void *' data-ref="128arg" data-ref-filename="128arg">arg</dfn>)</td></tr>
<tr><th id="1423">1423</th><td>{</td></tr>
<tr><th id="1424">1424</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_jpool_entry" title='bge_jpool_entry' data-ref="bge_jpool_entry" data-ref-filename="bge_jpool_entry">bge_jpool_entry</a> *<dfn class="local col9 decl" id="129entry" title='entry' data-type='struct bge_jpool_entry *' data-ref="129entry" data-ref-filename="129entry">entry</dfn>;</td></tr>
<tr><th id="1425">1425</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="130sc" title='sc' data-type='struct bge_softc *' data-ref="130sc" data-ref-filename="130sc">sc</dfn>;</td></tr>
<tr><th id="1426">1426</th><td>	<em>int</em> <dfn class="local col1 decl" id="131i" title='i' data-type='int' data-ref="131i" data-ref-filename="131i">i</dfn>, <dfn class="local col2 decl" id="132s" title='s' data-type='int' data-ref="132s" data-ref-filename="132s">s</dfn>;</td></tr>
<tr><th id="1427">1427</th><td></td></tr>
<tr><th id="1428">1428</th><td>	<i>/* Extract the softc struct pointer. */</i></td></tr>
<tr><th id="1429">1429</th><td>	<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a> = (<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *)<a class="local col8 ref" href="#128arg" title='arg' data-ref="128arg" data-ref-filename="128arg">arg</a>;</td></tr>
<tr><th id="1430">1430</th><td></td></tr>
<tr><th id="1431">1431</th><td>	<b>if</b> (<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1432">1432</th><td>		<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"bge_jfree: can't find softc pointer!"</q>);</td></tr>
<tr><th id="1433">1433</th><td></td></tr>
<tr><th id="1434">1434</th><td>	<i>/* calculate the slot this buffer belongs to */</i></td></tr>
<tr><th id="1435">1435</th><td></td></tr>
<tr><th id="1436">1436</th><td>	<a class="local col1 ref" href="#131i" title='i' data-ref="131i" data-ref-filename="131i">i</a> = ((<em>char</em> *)<a class="local col6 ref" href="#126buf" title='buf' data-ref="126buf" data-ref-filename="126buf">buf</a></td></tr>
<tr><th id="1437">1437</th><td>	     - (<em>char</em> *)<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jumbo_buf" title='bge_chain_data::bge_jumbo_buf' data-ref="bge_chain_data::bge_jumbo_buf" data-ref-filename="bge_chain_data..bge_jumbo_buf">bge_jumbo_buf</a>) / <a class="macro" href="if_bgevar.h.html#158" title="((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t))))" data-ref="_M/BGE_JLEN">BGE_JLEN</a>;</td></tr>
<tr><th id="1438">1438</th><td></td></tr>
<tr><th id="1439">1439</th><td>	<b>if</b> ((<a class="local col1 ref" href="#131i" title='i' data-ref="131i" data-ref-filename="131i">i</a> &lt; <var>0</var>) || (<a class="local col1 ref" href="#131i" title='i' data-ref="131i" data-ref-filename="131i">i</a> &gt;= <a class="macro" href="if_bgevar.h.html#155" title="384" data-ref="_M/BGE_JSLOTS">BGE_JSLOTS</a>))</td></tr>
<tr><th id="1440">1440</th><td>		<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"bge_jfree: asked to free buffer that we don't manage!"</q>);</td></tr>
<tr><th id="1441">1441</th><td></td></tr>
<tr><th id="1442">1442</th><td>	<a class="local col2 ref" href="#132s" title='s' data-ref="132s" data-ref-filename="132s">s</a> = <a class="ref fn" href="../../sys/spl.h.html#56" title='splvm' data-ref="splvm" data-ref-filename="splvm">splvm</a>();</td></tr>
<tr><th id="1443">1443</th><td>	<a class="local col9 ref" href="#129entry" title='entry' data-ref="129entry" data-ref-filename="129entry">entry</a> = <a class="macro" href="../../sys/queue.h.html#129" title="((&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first)" data-ref="_M/SLIST_FIRST">SLIST_FIRST</a>(&amp;<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jinuse_listhead" title='bge_softc::bge_jinuse_listhead' data-ref="bge_softc::bge_jinuse_listhead" data-ref-filename="bge_softc..bge_jinuse_listhead">bge_jinuse_listhead</a>);</td></tr>
<tr><th id="1444">1444</th><td>	<b>if</b> (<a class="local col9 ref" href="#129entry" title='entry' data-ref="129entry" data-ref-filename="129entry">entry</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1445">1445</th><td>		<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"bge_jfree: buffer not in use!"</q>);</td></tr>
<tr><th id="1446">1446</th><td>	<a class="local col9 ref" href="#129entry" title='entry' data-ref="129entry" data-ref-filename="129entry">entry</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::slot" title='bge_jpool_entry::slot' data-ref="bge_jpool_entry::slot" data-ref-filename="bge_jpool_entry..slot">slot</a> = <a class="local col1 ref" href="#131i" title='i' data-ref="131i" data-ref-filename="131i">i</a>;</td></tr>
<tr><th id="1447">1447</th><td>	<a class="macro" href="../../sys/queue.h.html#167" title="do { (&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first = (&amp;sc-&gt;bge_jinuse_listhead)-&gt;slh_first-&gt;jpool_entries.sle_next; } while ( 0)" data-ref="_M/SLIST_REMOVE_HEAD">SLIST_REMOVE_HEAD</a>(&amp;<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jinuse_listhead" title='bge_softc::bge_jinuse_listhead' data-ref="bge_softc::bge_jinuse_listhead" data-ref-filename="bge_softc..bge_jinuse_listhead">bge_jinuse_listhead</a>, <a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::jpool_entries" title='bge_jpool_entry::jpool_entries' data-ref="bge_jpool_entry::jpool_entries" data-ref-filename="bge_jpool_entry..jpool_entries">jpool_entries</a>);</td></tr>
<tr><th id="1448">1448</th><td>	<a class="macro" href="../../sys/queue.h.html#157" title="do { (entry)-&gt;jpool_entries.sle_next = (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first; (&amp;sc-&gt;bge_jfree_listhead)-&gt;slh_first = (entry); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col0 ref" href="#130sc" title='sc' data-ref="130sc" data-ref-filename="130sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jfree_listhead" title='bge_softc::bge_jfree_listhead' data-ref="bge_softc::bge_jfree_listhead" data-ref-filename="bge_softc..bge_jfree_listhead">bge_jfree_listhead</a>, <a class="local col9 ref" href="#129entry" title='entry' data-ref="129entry" data-ref-filename="129entry">entry</a>, <a class="ref field" href="if_bgevar.h.html#bge_jpool_entry::jpool_entries" title='bge_jpool_entry::jpool_entries' data-ref="bge_jpool_entry::jpool_entries" data-ref-filename="bge_jpool_entry..jpool_entries">jpool_entries</a>);</td></tr>
<tr><th id="1449">1449</th><td></td></tr>
<tr><th id="1450">1450</th><td>	<b>if</b> (<a class="macro" href="../../sys/cdefs.h.html#487" title="__builtin_expect((m != ((void *)0)) != 0, 1)" data-ref="_M/__predict_true">__predict_true</a>(<a class="local col5 ref" href="#125m" title='m' data-ref="125m" data-ref-filename="125m">m</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>))</td></tr>
<tr><th id="1451">1451</th><td>		<a class="macro" href="../../sys/pool.h.html#359" title="pool_cache_put_paddr((mb_cache), (m), ((paddr_t) -1))" data-ref="_M/pool_cache_put">pool_cache_put</a>(<a class="ref" href="../../sys/mbuf.h.html#mb_cache" title='mb_cache' data-ref="mb_cache" data-ref-filename="mb_cache">mb_cache</a>, <a class="local col5 ref" href="#125m" title='m' data-ref="125m" data-ref-filename="125m">m</a>);</td></tr>
<tr><th id="1452">1452</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col2 ref" href="#132s" title='s' data-ref="132s" data-ref-filename="132s">s</a>);</td></tr>
<tr><th id="1453">1453</th><td>}</td></tr>
<tr><th id="1454">1454</th><td></td></tr>
<tr><th id="1455">1455</th><td></td></tr>
<tr><th id="1456">1456</th><td><i  data-doc="bge_newbuf_std">/*</i></td></tr>
<tr><th id="1457">1457</th><td><i  data-doc="bge_newbuf_std"> * Initialize a standard receive ring descriptor.</i></td></tr>
<tr><th id="1458">1458</th><td><i  data-doc="bge_newbuf_std"> */</i></td></tr>
<tr><th id="1459">1459</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1460">1460</th><td><dfn class="tu decl def fn" id="bge_newbuf_std" title='bge_newbuf_std' data-type='int bge_newbuf_std(struct bge_softc * sc, int i, struct mbuf * m, bus_dmamap_t dmamap)' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="133sc" title='sc' data-type='struct bge_softc *' data-ref="133sc" data-ref-filename="133sc">sc</dfn>, <em>int</em> <dfn class="local col4 decl" id="134i" title='i' data-type='int' data-ref="134i" data-ref-filename="134i">i</dfn>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col5 decl" id="135m" title='m' data-type='struct mbuf *' data-ref="135m" data-ref-filename="135m">m</dfn>,</td></tr>
<tr><th id="1461">1461</th><td>    <a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dmamap_t" title='bus_dmamap_t' data-type='struct x86_bus_dmamap *' data-ref="bus_dmamap_t" data-ref-filename="bus_dmamap_t">bus_dmamap_t</a> <dfn class="local col6 decl" id="136dmamap" title='dmamap' data-type='bus_dmamap_t' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</dfn>)</td></tr>
<tr><th id="1462">1462</th><td>{</td></tr>
<tr><th id="1463">1463</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a>		*<dfn class="local col7 decl" id="137m_new" title='m_new' data-type='struct mbuf *' data-ref="137m_new" data-ref-filename="137m_new">m_new</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1464">1464</th><td>	<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>	*<dfn class="local col8 decl" id="138r" title='r' data-type='struct bge_rx_bd *' data-ref="138r" data-ref-filename="138r">r</dfn>;</td></tr>
<tr><th id="1465">1465</th><td>	<em>int</em>			<dfn class="local col9 decl" id="139error" title='error' data-type='int' data-ref="139error" data-ref-filename="139error">error</dfn>;</td></tr>
<tr><th id="1466">1466</th><td></td></tr>
<tr><th id="1467">1467</th><td>	<b>if</b> (<a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1468">1468</th><td>		<a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a> = <a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a>];</td></tr>
<tr><th id="1469">1469</th><td></td></tr>
<tr><th id="1470">1470</th><td>	<b>if</b> (<a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1471">1471</th><td>		<a class="local col9 ref" href="#139error" title='error' data-ref="139error" data-ref-filename="139error">error</a> = <a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_create" title='bus_dmamap_create' data-ref="bus_dmamap_create" data-ref-filename="bus_dmamap_create">bus_dmamap_create</a>(<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="macro" href="../../arch/amd64/include/param.h.html#92" title="(1 &lt;&lt; 11)" data-ref="_M/MCLBYTES">MCLBYTES</a>, <var>1</var>,</td></tr>
<tr><th id="1472">1472</th><td>		    <a class="macro" href="../../arch/amd64/include/param.h.html#92" title="(1 &lt;&lt; 11)" data-ref="_M/MCLBYTES">MCLBYTES</a>, <var>0</var>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>, &amp;<a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>);</td></tr>
<tr><th id="1473">1473</th><td>		<b>if</b> (<a class="local col9 ref" href="#139error" title='error' data-ref="139error" data-ref-filename="139error">error</a> != <var>0</var>)</td></tr>
<tr><th id="1474">1474</th><td>			<b>return</b> <a class="local col9 ref" href="#139error" title='error' data-ref="139error" data-ref-filename="139error">error</a>;</td></tr>
<tr><th id="1475">1475</th><td>	}</td></tr>
<tr><th id="1476">1476</th><td></td></tr>
<tr><th id="1477">1477</th><td>	<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a>] = <a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>;</td></tr>
<tr><th id="1478">1478</th><td></td></tr>
<tr><th id="1479">1479</th><td>	<b>if</b> (<a class="local col5 ref" href="#135m" title='m' data-ref="135m" data-ref-filename="135m">m</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1480">1480</th><td>		<a class="macro" href="../../sys/mbuf.h.html#450" title="m_new = m_gethdr((0x0001), (1))" data-ref="_M/MGETHDR">MGETHDR</a>(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>, <a class="macro" href="../../sys/mbuf.h.html#410" title="0x0001" data-ref="_M/M_DONTWAIT">M_DONTWAIT</a>, <a class="macro" href="../../sys/mbuf.h.html#386" title="1" data-ref="_M/MT_DATA">MT_DATA</a>);</td></tr>
<tr><th id="1481">1481</th><td>		<b>if</b> (<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1482">1482</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1483">1483</th><td></td></tr>
<tr><th id="1484">1484</th><td>		<a class="macro" href="../../sys/mbuf.h.html#474" title="m_clget((m_new), (0x0001))" data-ref="_M/MCLGET">MCLGET</a>(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>, <a class="macro" href="../../sys/mbuf.h.html#410" title="0x0001" data-ref="_M/M_DONTWAIT">M_DONTWAIT</a>);</td></tr>
<tr><th id="1485">1485</th><td>		<b>if</b> (!(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#305" title="m_hdr.mh_flags" data-ref="_M/m_flags">m_flags</a> &amp; <a class="macro" href="../../sys/mbuf.h.html#334" title="0x00000001" data-ref="_M/M_EXT">M_EXT</a>)) {</td></tr>
<tr><th id="1486">1486</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>);</td></tr>
<tr><th id="1487">1487</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1488">1488</th><td>		}</td></tr>
<tr><th id="1489">1489</th><td>		<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> = <a class="macro" href="../../arch/amd64/include/param.h.html#92" title="(1 &lt;&lt; 11)" data-ref="_M/MCLBYTES">MCLBYTES</a>;</td></tr>
<tr><th id="1490">1490</th><td></td></tr>
<tr><th id="1491">1491</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1492">1492</th><td>		<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a> = <a class="local col5 ref" href="#135m" title='m' data-ref="135m" data-ref-filename="135m">m</a>;</td></tr>
<tr><th id="1493">1493</th><td>		<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> = <a class="macro" href="../../arch/amd64/include/param.h.html#92" title="(1 &lt;&lt; 11)" data-ref="_M/MCLBYTES">MCLBYTES</a>;</td></tr>
<tr><th id="1494">1494</th><td>		<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> = <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#311" title="M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage" data-ref="_M/m_ext">m_ext</a>.<a class="ref field" href="../../sys/mbuf.h.html#_m_ext_storage::ext_buf" title='_m_ext_storage::ext_buf' data-ref="_m_ext_storage::ext_buf" data-ref-filename="_m_ext_storage..ext_buf">ext_buf</a>;</td></tr>
<tr><th id="1495">1495</th><td>	}</td></tr>
<tr><th id="1496">1496</th><td>	<b>if</b> (!(<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2683" title="0x00400000" data-ref="_M/BGEF_RX_ALIGNBUG">BGEF_RX_ALIGNBUG</a>))</td></tr>
<tr><th id="1497">1497</th><td>	    <a class="ref fn" href="../../sys/mbuf.h.html#m_adj" title='m_adj' data-ref="m_adj" data-ref-filename="m_adj">m_adj</a>(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>, <a class="macro" href="../../net/if_ether.h.html#74" title="2" data-ref="_M/ETHER_ALIGN">ETHER_ALIGN</a>);</td></tr>
<tr><th id="1498">1498</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_load_mbuf" title='bus_dmamap_load_mbuf' data-ref="bus_dmamap_load_mbuf" data-ref-filename="bus_dmamap_load_mbuf">bus_dmamap_load_mbuf</a>(<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>, <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>,</td></tr>
<tr><th id="1499">1499</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#319" title="0x100" data-ref="_M/BUS_DMA_READ">BUS_DMA_READ</a> | <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="1500">1500</th><td>		<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>);</td></tr>
<tr><th id="1501">1501</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1502">1502</th><td>	}</td></tr>
<tr><th id="1503">1503</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>, <var>0</var>, <a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_mapsize" title='x86_bus_dmamap::dm_mapsize' data-ref="x86_bus_dmamap::dm_mapsize" data-ref-filename="x86_bus_dmamap..dm_mapsize">dm_mapsize</a>,</td></tr>
<tr><th id="1504">1504</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a>);</td></tr>
<tr><th id="1505">1505</th><td></td></tr>
<tr><th id="1506">1506</th><td>	<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a>] = <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>;</td></tr>
<tr><th id="1507">1507</th><td>	<a class="local col8 ref" href="#138r" title='r' data-ref="138r" data-ref-filename="138r">r</a> = &amp;<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_rx_std_ring" title='bge_ring_data::bge_rx_std_ring' data-ref="bge_ring_data::bge_rx_std_ring" data-ref-filename="bge_ring_data..bge_rx_std_ring">bge_rx_std_ring</a>[<a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a>];</td></tr>
<tr><th id="1508">1508</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (r-&gt;bge_addr).bge_addr_lo = ((uint64_t) (dmamap-&gt;dm_segs[0].ds_addr) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (r-&gt;bge_addr).bge_addr_hi = ((uint64_t) (dmamap-&gt;dm_segs[0].ds_addr) &gt;&gt; 32); else (r-&gt;bge_addr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col8 ref" href="#138r" title='r' data-ref="138r" data-ref-filename="138r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_addr" title='bge_rx_bd::bge_addr' data-ref="bge_rx_bd::bge_addr" data-ref-filename="bge_rx_bd..bge_addr">bge_addr</a>, <a class="local col6 ref" href="#136dmamap" title='dmamap' data-ref="136dmamap" data-ref-filename="136dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_segs" title='x86_bus_dmamap::dm_segs' data-ref="x86_bus_dmamap::dm_segs" data-ref-filename="x86_bus_dmamap..dm_segs">dm_segs</a>[<var>0</var>].<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dma_segment::ds_addr" title='x86_bus_dma_segment::ds_addr' data-ref="x86_bus_dma_segment::ds_addr" data-ref-filename="x86_bus_dma_segment..ds_addr">ds_addr</a>);</td></tr>
<tr><th id="1509">1509</th><td>	<a class="local col8 ref" href="#138r" title='r' data-ref="138r" data-ref-filename="138r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> = <a class="macro" href="if_bgereg.h.html#2318" title="0x0004" data-ref="_M/BGE_RXBDFLAG_END">BGE_RXBDFLAG_END</a>;</td></tr>
<tr><th id="1510">1510</th><td>	<a class="local col8 ref" href="#138r" title='r' data-ref="138r" data-ref-filename="138r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_len" title='bge_rx_bd::bge_len' data-ref="bge_rx_bd::bge_len" data-ref-filename="bge_rx_bd..bge_len">bge_len</a> = <a class="local col7 ref" href="#137m_new" title='m_new' data-ref="137m_new" data-ref-filename="137m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>;</td></tr>
<tr><th id="1511">1511</th><td>	<a class="local col8 ref" href="#138r" title='r' data-ref="138r" data-ref-filename="138r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_idx" title='bge_rx_bd::bge_idx' data-ref="bge_rx_bd::bge_idx" data-ref-filename="bge_rx_bd..bge_idx">bge_idx</a> = <a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a>;</td></tr>
<tr><th id="1512">1512</th><td></td></tr>
<tr><th id="1513">1513</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#133sc" title='sc' data-ref="133sc" data-ref-filename="133sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="1514">1514</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_rx_std_ring)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_rx_std_ring) +</td></tr>
<tr><th id="1515">1515</th><td>		<a class="local col4 ref" href="#134i" title='i' data-ref="134i" data-ref-filename="134i">i</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>),</td></tr>
<tr><th id="1516">1516</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>),</td></tr>
<tr><th id="1517">1517</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#328" title="0x04" data-ref="_M/BUS_DMASYNC_PREWRITE">BUS_DMASYNC_PREWRITE</a> | <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a>);</td></tr>
<tr><th id="1518">1518</th><td></td></tr>
<tr><th id="1519">1519</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1520">1520</th><td>}</td></tr>
<tr><th id="1521">1521</th><td></td></tr>
<tr><th id="1522">1522</th><td><i  data-doc="bge_newbuf_jumbo">/*</i></td></tr>
<tr><th id="1523">1523</th><td><i  data-doc="bge_newbuf_jumbo"> * Initialize a jumbo receive ring descriptor. This allocates</i></td></tr>
<tr><th id="1524">1524</th><td><i  data-doc="bge_newbuf_jumbo"> * a jumbo buffer from the pool managed internally by the driver.</i></td></tr>
<tr><th id="1525">1525</th><td><i  data-doc="bge_newbuf_jumbo"> */</i></td></tr>
<tr><th id="1526">1526</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1527">1527</th><td><dfn class="tu decl def fn" id="bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-type='int bge_newbuf_jumbo(struct bge_softc * sc, int i, struct mbuf * m)' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="140sc" title='sc' data-type='struct bge_softc *' data-ref="140sc" data-ref-filename="140sc">sc</dfn>, <em>int</em> <dfn class="local col1 decl" id="141i" title='i' data-type='int' data-ref="141i" data-ref-filename="141i">i</dfn>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col2 decl" id="142m" title='m' data-type='struct mbuf *' data-ref="142m" data-ref-filename="142m">m</dfn>)</td></tr>
<tr><th id="1528">1528</th><td>{</td></tr>
<tr><th id="1529">1529</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col3 decl" id="143m_new" title='m_new' data-type='struct mbuf *' data-ref="143m_new" data-ref-filename="143m_new">m_new</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1530">1530</th><td>	<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a> *<dfn class="local col4 decl" id="144r" title='r' data-type='struct bge_rx_bd *' data-ref="144r" data-ref-filename="144r">r</dfn>;</td></tr>
<tr><th id="1531">1531</th><td>	<em>void</em> *<dfn class="local col5 decl" id="145buf" title='buf' data-type='void *' data-ref="145buf" data-ref-filename="145buf">buf</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1532">1532</th><td></td></tr>
<tr><th id="1533">1533</th><td>	<b>if</b> (<a class="local col2 ref" href="#142m" title='m' data-ref="142m" data-ref-filename="142m">m</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1534">1534</th><td></td></tr>
<tr><th id="1535">1535</th><td>		<i>/* Allocate the mbuf. */</i></td></tr>
<tr><th id="1536">1536</th><td>		<a class="macro" href="../../sys/mbuf.h.html#450" title="m_new = m_gethdr((0x0001), (1))" data-ref="_M/MGETHDR">MGETHDR</a>(<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>, <a class="macro" href="../../sys/mbuf.h.html#410" title="0x0001" data-ref="_M/M_DONTWAIT">M_DONTWAIT</a>, <a class="macro" href="../../sys/mbuf.h.html#386" title="1" data-ref="_M/MT_DATA">MT_DATA</a>);</td></tr>
<tr><th id="1537">1537</th><td>		<b>if</b> (<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1538">1538</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1539">1539</th><td></td></tr>
<tr><th id="1540">1540</th><td>		<i>/* Allocate the jumbo buffer */</i></td></tr>
<tr><th id="1541">1541</th><td>		<a class="local col5 ref" href="#145buf" title='buf' data-ref="145buf" data-ref-filename="145buf">buf</a> = <a class="tu ref fn" href="#bge_jalloc" title='bge_jalloc' data-use='c' data-ref="bge_jalloc" data-ref-filename="bge_jalloc">bge_jalloc</a>(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>);</td></tr>
<tr><th id="1542">1542</th><td>		<b>if</b> (<a class="local col5 ref" href="#145buf" title='buf' data-ref="145buf" data-ref-filename="145buf">buf</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1543">1543</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>);</td></tr>
<tr><th id="1544">1544</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="1545">1545</th><td>			    <q>"jumbo allocation failed -- packet dropped!\n"</q>);</td></tr>
<tr><th id="1546">1546</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1547">1547</th><td>		}</td></tr>
<tr><th id="1548">1548</th><td></td></tr>
<tr><th id="1549">1549</th><td>		<i>/* Attach the buffer to the mbuf. */</i></td></tr>
<tr><th id="1550">1550</th><td>		<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> = <a class="macro" href="if_bgereg.h.html#2634" title="9018" data-ref="_M/BGE_JUMBO_FRAMELEN">BGE_JUMBO_FRAMELEN</a>;</td></tr>
<tr><th id="1551">1551</th><td>		<a class="macro" href="../../sys/mbuf.h.html#491" title="do { do { (__builtin_expect(((((m_new)-&gt;m_hdr.mh_flags &amp; 0x00000001) == 0)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;((m_new)-&gt;m_flags &amp; M_EXT) == 0&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 1552)); (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref = (m_new); (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_refcnt = 1; } while ( 0); (m_new)-&gt;m_hdr.mh_data = (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_buf = (char *)(buf); (m_new)-&gt;m_hdr.mh_flags = ((m_new)-&gt;m_hdr.mh_flags &amp; ~(0x00000001|0xff000000)) | 0x00000001; (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_size = (9018); (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_free = (bge_jfree); (m_new)-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_arg = (sc); ( (void)0); } while ( 0)" data-ref="_M/MEXTADD">MEXTADD</a>(<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>, <a class="local col5 ref" href="#145buf" title='buf' data-ref="145buf" data-ref-filename="145buf">buf</a>, <a class="macro" href="if_bgereg.h.html#2634" title="9018" data-ref="_M/BGE_JUMBO_FRAMELEN">BGE_JUMBO_FRAMELEN</a>, M_DEVBUF,</td></tr>
<tr><th id="1552">1552</th><td>		    <a class="tu ref fn" href="#bge_jfree" title='bge_jfree' data-use='r' data-ref="bge_jfree" data-ref-filename="bge_jfree">bge_jfree</a>, <a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>);</td></tr>
<tr><th id="1553">1553</th><td>		<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#305" title="m_hdr.mh_flags" data-ref="_M/m_flags">m_flags</a> |= <a class="macro" href="../../sys/mbuf.h.html#364" title="0x08000000" data-ref="_M/M_EXT_RW">M_EXT_RW</a>;</td></tr>
<tr><th id="1554">1554</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1555">1555</th><td>		<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a> = <a class="local col2 ref" href="#142m" title='m' data-ref="142m" data-ref-filename="142m">m</a>;</td></tr>
<tr><th id="1556">1556</th><td>		<a class="local col5 ref" href="#145buf" title='buf' data-ref="145buf" data-ref-filename="145buf">buf</a> = <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> = <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#311" title="M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage" data-ref="_M/m_ext">m_ext</a>.<a class="ref field" href="../../sys/mbuf.h.html#_m_ext_storage::ext_buf" title='_m_ext_storage::ext_buf' data-ref="_m_ext_storage::ext_buf" data-ref-filename="_m_ext_storage..ext_buf">ext_buf</a>;</td></tr>
<tr><th id="1557">1557</th><td>		<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#311" title="M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage" data-ref="_M/m_ext">m_ext</a>.<a class="ref field" href="../../sys/mbuf.h.html#_m_ext_storage::ext_size" title='_m_ext_storage::ext_size' data-ref="_m_ext_storage::ext_size" data-ref-filename="_m_ext_storage..ext_size">ext_size</a> = <a class="macro" href="if_bgereg.h.html#2634" title="9018" data-ref="_M/BGE_JUMBO_FRAMELEN">BGE_JUMBO_FRAMELEN</a>;</td></tr>
<tr><th id="1558">1558</th><td>	}</td></tr>
<tr><th id="1559">1559</th><td>	<b>if</b> (!(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2683" title="0x00400000" data-ref="_M/BGEF_RX_ALIGNBUG">BGEF_RX_ALIGNBUG</a>))</td></tr>
<tr><th id="1560">1560</th><td>	    <a class="ref fn" href="../../sys/mbuf.h.html#m_adj" title='m_adj' data-ref="m_adj" data-ref-filename="m_adj">m_adj</a>(<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>, <a class="macro" href="../../net/if_ether.h.html#74" title="2" data-ref="_M/ETHER_ALIGN">ETHER_ALIGN</a>);</td></tr>
<tr><th id="1561">1561</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>,</td></tr>
<tr><th id="1562">1562</th><td>	    <a class="macro" href="../../sys/mbuf.h.html#147" title="((char *)((m_new)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>, <em>char</em> *) - (<em>char</em> *)<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jumbo_buf" title='bge_chain_data::bge_jumbo_buf' data-ref="bge_chain_data::bge_jumbo_buf" data-ref-filename="bge_chain_data..bge_jumbo_buf">bge_jumbo_buf</a>,</td></tr>
<tr><th id="1563">1563</th><td>	    <a class="macro" href="if_bgevar.h.html#158" title="((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t))))" data-ref="_M/BGE_JLEN">BGE_JLEN</a>, <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a>);</td></tr>
<tr><th id="1564">1564</th><td>	<i>/* Set up the descriptor. */</i></td></tr>
<tr><th id="1565">1565</th><td>	<a class="local col4 ref" href="#144r" title='r' data-ref="144r" data-ref-filename="144r">r</a> = &amp;<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_rx_jumbo_ring" title='bge_ring_data::bge_rx_jumbo_ring' data-ref="bge_ring_data::bge_rx_jumbo_ring" data-ref-filename="bge_ring_data..bge_rx_jumbo_ring">bge_rx_jumbo_ring</a>[<a class="local col1 ref" href="#141i" title='i' data-ref="141i" data-ref-filename="141i">i</a>];</td></tr>
<tr><th id="1566">1566</th><td>	<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col1 ref" href="#141i" title='i' data-ref="141i" data-ref-filename="141i">i</a>] = <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>;</td></tr>
<tr><th id="1567">1567</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (r-&gt;bge_addr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_cdata.bge_rx_jumbo_map-&gt;dm_segs[0].ds_addr + (((char *)(((m_new))-&gt;m_hdr.mh_data)) - (char *)(sc)-&gt;bge_cdata.bge_jumbo_buf))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (r-&gt;bge_addr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_cdata.bge_rx_jumbo_map-&gt;dm_segs[0].ds_addr + (((char *)(((m_new))-&gt;m_hdr.mh_data)) - (char *)(sc)-&gt;bge_cdata.bge_jumbo_buf))) &gt;&gt; 32); else (r-&gt;bge_addr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col4 ref" href="#144r" title='r' data-ref="144r" data-ref-filename="144r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_addr" title='bge_rx_bd::bge_addr' data-ref="bge_rx_bd::bge_addr" data-ref-filename="bge_rx_bd..bge_addr">bge_addr</a>, <a class="macro" href="if_bgevar.h.html#227" title="((sc)-&gt;bge_cdata.bge_rx_jumbo_map-&gt;dm_segs[0].ds_addr + (((char *)(((m_new))-&gt;m_hdr.mh_data)) - (char *)(sc)-&gt;bge_cdata.bge_jumbo_buf))" data-ref="_M/BGE_JUMBO_DMA_ADDR">BGE_JUMBO_DMA_ADDR</a>(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>, <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>));</td></tr>
<tr><th id="1568">1568</th><td>	<a class="local col4 ref" href="#144r" title='r' data-ref="144r" data-ref-filename="144r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> = <a class="macro" href="if_bgereg.h.html#2318" title="0x0004" data-ref="_M/BGE_RXBDFLAG_END">BGE_RXBDFLAG_END</a> | <a class="macro" href="if_bgereg.h.html#2319" title="0x0020" data-ref="_M/BGE_RXBDFLAG_JUMBO_RING">BGE_RXBDFLAG_JUMBO_RING</a>;</td></tr>
<tr><th id="1569">1569</th><td>	<a class="local col4 ref" href="#144r" title='r' data-ref="144r" data-ref-filename="144r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_len" title='bge_rx_bd::bge_len' data-ref="bge_rx_bd::bge_len" data-ref-filename="bge_rx_bd..bge_len">bge_len</a> = <a class="local col3 ref" href="#143m_new" title='m_new' data-ref="143m_new" data-ref-filename="143m_new">m_new</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>;</td></tr>
<tr><th id="1570">1570</th><td>	<a class="local col4 ref" href="#144r" title='r' data-ref="144r" data-ref-filename="144r">r</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_idx" title='bge_rx_bd::bge_idx' data-ref="bge_rx_bd::bge_idx" data-ref-filename="bge_rx_bd..bge_idx">bge_idx</a> = <a class="local col1 ref" href="#141i" title='i' data-ref="141i" data-ref-filename="141i">i</a>;</td></tr>
<tr><th id="1571">1571</th><td></td></tr>
<tr><th id="1572">1572</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col0 ref" href="#140sc" title='sc' data-ref="140sc" data-ref-filename="140sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="1573">1573</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_rx_jumbo_ring)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_rx_jumbo_ring) +</td></tr>
<tr><th id="1574">1574</th><td>		<a class="local col1 ref" href="#141i" title='i' data-ref="141i" data-ref-filename="141i">i</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>),</td></tr>
<tr><th id="1575">1575</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>),</td></tr>
<tr><th id="1576">1576</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#328" title="0x04" data-ref="_M/BUS_DMASYNC_PREWRITE">BUS_DMASYNC_PREWRITE</a> | <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a>);</td></tr>
<tr><th id="1577">1577</th><td></td></tr>
<tr><th id="1578">1578</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1579">1579</th><td>}</td></tr>
<tr><th id="1580">1580</th><td></td></tr>
<tr><th id="1581">1581</th><td><i  data-doc="bge_init_rx_ring_std">/*</i></td></tr>
<tr><th id="1582">1582</th><td><i  data-doc="bge_init_rx_ring_std"> * The standard receive ring has 512 entries in it. At 2K per mbuf cluster,</i></td></tr>
<tr><th id="1583">1583</th><td><i  data-doc="bge_init_rx_ring_std"> * that's 1MB or memory, which is a lot. For now, we fill only the first</i></td></tr>
<tr><th id="1584">1584</th><td><i  data-doc="bge_init_rx_ring_std"> * 256 ring entries and hope that our CPU is fast enough to keep up with</i></td></tr>
<tr><th id="1585">1585</th><td><i  data-doc="bge_init_rx_ring_std"> * the NIC.</i></td></tr>
<tr><th id="1586">1586</th><td><i  data-doc="bge_init_rx_ring_std"> */</i></td></tr>
<tr><th id="1587">1587</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1588">1588</th><td><dfn class="tu decl def fn" id="bge_init_rx_ring_std" title='bge_init_rx_ring_std' data-type='int bge_init_rx_ring_std(struct bge_softc * sc)' data-ref="bge_init_rx_ring_std" data-ref-filename="bge_init_rx_ring_std">bge_init_rx_ring_std</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="146sc" title='sc' data-type='struct bge_softc *' data-ref="146sc" data-ref-filename="146sc">sc</dfn>)</td></tr>
<tr><th id="1589">1589</th><td>{</td></tr>
<tr><th id="1590">1590</th><td>	<em>int</em> <dfn class="local col7 decl" id="147i" title='i' data-type='int' data-ref="147i" data-ref-filename="147i">i</dfn>;</td></tr>
<tr><th id="1591">1591</th><td></td></tr>
<tr><th id="1592">1592</th><td>	<b>if</b> (<a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2686" title="0x40000000" data-ref="_M/BGEF_RXRING_VALID">BGEF_RXRING_VALID</a>)</td></tr>
<tr><th id="1593">1593</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1594">1594</th><td></td></tr>
<tr><th id="1595">1595</th><td>	<b>for</b> (<a class="local col7 ref" href="#147i" title='i' data-ref="147i" data-ref-filename="147i">i</a> = <var>0</var>; <a class="local col7 ref" href="#147i" title='i' data-ref="147i" data-ref-filename="147i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#153" title="256" data-ref="_M/BGE_SSLOTS">BGE_SSLOTS</a>; <a class="local col7 ref" href="#147i" title='i' data-ref="147i" data-ref-filename="147i">i</a>++) {</td></tr>
<tr><th id="1596">1596</th><td>		<b>if</b> (<a class="tu ref fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-use='c' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>, <a class="local col7 ref" href="#147i" title='i' data-ref="147i" data-ref-filename="147i">i</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <var>0</var>) == <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>)</td></tr>
<tr><th id="1597">1597</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1598">1598</th><td>	}</td></tr>
<tr><th id="1599">1599</th><td></td></tr>
<tr><th id="1600">1600</th><td>	<a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a> = <a class="local col7 ref" href="#147i" title='i' data-ref="147i" data-ref-filename="147i">i</a> - <var>1</var>;</td></tr>
<tr><th id="1601">1601</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>, <a class="macro" href="if_bgereg.h.html#516" title="0x026C" data-ref="_M/BGE_MBX_RX_STD_PROD_LO">BGE_MBX_RX_STD_PROD_LO</a>, <a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>);</td></tr>
<tr><th id="1602">1602</th><td></td></tr>
<tr><th id="1603">1603</th><td>	<a class="local col6 ref" href="#146sc" title='sc' data-ref="146sc" data-ref-filename="146sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2686" title="0x40000000" data-ref="_M/BGEF_RXRING_VALID">BGEF_RXRING_VALID</a>;</td></tr>
<tr><th id="1604">1604</th><td></td></tr>
<tr><th id="1605">1605</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1606">1606</th><td>}</td></tr>
<tr><th id="1607">1607</th><td></td></tr>
<tr><th id="1608">1608</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1609">1609</th><td><dfn class="tu decl def fn" id="bge_free_rx_ring_std" title='bge_free_rx_ring_std' data-type='void bge_free_rx_ring_std(struct bge_softc * sc, _Bool disable)' data-ref="bge_free_rx_ring_std" data-ref-filename="bge_free_rx_ring_std">bge_free_rx_ring_std</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="148sc" title='sc' data-type='struct bge_softc *' data-ref="148sc" data-ref-filename="148sc">sc</dfn>, <a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col9 decl" id="149disable" title='disable' data-type='_Bool' data-ref="149disable" data-ref-filename="149disable">disable</dfn>)</td></tr>
<tr><th id="1610">1610</th><td>{</td></tr>
<tr><th id="1611">1611</th><td>	<em>int</em> <dfn class="local col0 decl" id="150i" title='i' data-type='int' data-ref="150i" data-ref-filename="150i">i</dfn>;</td></tr>
<tr><th id="1612">1612</th><td></td></tr>
<tr><th id="1613">1613</th><td>	<b>if</b> (!(<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2686" title="0x40000000" data-ref="_M/BGEF_RXRING_VALID">BGEF_RXRING_VALID</a>))</td></tr>
<tr><th id="1614">1614</th><td>		<b>return</b>;</td></tr>
<tr><th id="1615">1615</th><td></td></tr>
<tr><th id="1616">1616</th><td>	<b>for</b> (<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a> = <var>0</var>; <a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#2447" title="512" data-ref="_M/BGE_STD_RX_RING_CNT">BGE_STD_RX_RING_CNT</a>; <a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>++) {</td></tr>
<tr><th id="1617">1617</th><td>		<b>if</b> (<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>] != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1618">1618</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>]);</td></tr>
<tr><th id="1619">1619</th><td>			<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1620">1620</th><td>			<b>if</b> (<a class="local col9 ref" href="#149disable" title='disable' data-ref="149disable" data-ref-filename="149disable">disable</a>) {</td></tr>
<tr><th id="1621">1621</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>,</td></tr>
<tr><th id="1622">1622</th><td>				    <a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>]);</td></tr>
<tr><th id="1623">1623</th><td>				<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1624">1624</th><td>			}</td></tr>
<tr><th id="1625">1625</th><td>		}</td></tr>
<tr><th id="1626">1626</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#382" title="__builtin_memset((char *)&amp;sc-&gt;bge_rdata-&gt;bge_rx_std_ring[i], 0, sizeof(struct bge_rx_bd))" data-ref="_M/memset">memset</a>((<em>char</em> *)&amp;<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_rx_std_ring" title='bge_ring_data::bge_rx_std_ring' data-ref="bge_ring_data::bge_rx_std_ring" data-ref-filename="bge_ring_data..bge_rx_std_ring">bge_rx_std_ring</a>[<a class="local col0 ref" href="#150i" title='i' data-ref="150i" data-ref-filename="150i">i</a>], <var>0</var>,</td></tr>
<tr><th id="1627">1627</th><td>		    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>));</td></tr>
<tr><th id="1628">1628</th><td>	}</td></tr>
<tr><th id="1629">1629</th><td></td></tr>
<tr><th id="1630">1630</th><td>	<a class="local col8 ref" href="#148sc" title='sc' data-ref="148sc" data-ref-filename="148sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2686" title="0x40000000" data-ref="_M/BGEF_RXRING_VALID">BGEF_RXRING_VALID</a>;</td></tr>
<tr><th id="1631">1631</th><td>}</td></tr>
<tr><th id="1632">1632</th><td></td></tr>
<tr><th id="1633">1633</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1634">1634</th><td><dfn class="tu decl def fn" id="bge_init_rx_ring_jumbo" title='bge_init_rx_ring_jumbo' data-type='int bge_init_rx_ring_jumbo(struct bge_softc * sc)' data-ref="bge_init_rx_ring_jumbo" data-ref-filename="bge_init_rx_ring_jumbo">bge_init_rx_ring_jumbo</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="151sc" title='sc' data-type='struct bge_softc *' data-ref="151sc" data-ref-filename="151sc">sc</dfn>)</td></tr>
<tr><th id="1635">1635</th><td>{</td></tr>
<tr><th id="1636">1636</th><td>	<em>int</em> <dfn class="local col2 decl" id="152i" title='i' data-type='int' data-ref="152i" data-ref-filename="152i">i</dfn>;</td></tr>
<tr><th id="1637">1637</th><td>	<em>volatile</em> <b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rcb" title='bge_rcb' data-ref="bge_rcb" data-ref-filename="bge_rcb">bge_rcb</a> *<dfn class="local col3 decl" id="153rcb" title='rcb' data-type='volatile struct bge_rcb *' data-ref="153rcb" data-ref-filename="153rcb">rcb</dfn>;</td></tr>
<tr><th id="1638">1638</th><td></td></tr>
<tr><th id="1639">1639</th><td>	<b>if</b> (<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2687" title="0x80000000" data-ref="_M/BGEF_JUMBO_RXRING_VALID">BGEF_JUMBO_RXRING_VALID</a>)</td></tr>
<tr><th id="1640">1640</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1641">1641</th><td></td></tr>
<tr><th id="1642">1642</th><td>	<b>for</b> (<a class="local col2 ref" href="#152i" title='i' data-ref="152i" data-ref-filename="152i">i</a> = <var>0</var>; <a class="local col2 ref" href="#152i" title='i' data-ref="152i" data-ref-filename="152i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#2448" title="256" data-ref="_M/BGE_JUMBO_RX_RING_CNT">BGE_JUMBO_RX_RING_CNT</a>; <a class="local col2 ref" href="#152i" title='i' data-ref="152i" data-ref-filename="152i">i</a>++) {</td></tr>
<tr><th id="1643">1643</th><td>		<b>if</b> (<a class="tu ref fn" href="#bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-use='c' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</a>(<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>, <a class="local col2 ref" href="#152i" title='i' data-ref="152i" data-ref-filename="152i">i</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) == <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>)</td></tr>
<tr><th id="1644">1644</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1645">1645</th><td>	}</td></tr>
<tr><th id="1646">1646</th><td></td></tr>
<tr><th id="1647">1647</th><td>	<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a> = <a class="local col2 ref" href="#152i" title='i' data-ref="152i" data-ref-filename="152i">i</a> - <var>1</var>;</td></tr>
<tr><th id="1648">1648</th><td>	<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2687" title="0x80000000" data-ref="_M/BGEF_JUMBO_RXRING_VALID">BGEF_JUMBO_RXRING_VALID</a>;</td></tr>
<tr><th id="1649">1649</th><td></td></tr>
<tr><th id="1650">1650</th><td>	<a class="local col3 ref" href="#153rcb" title='rcb' data-ref="153rcb" data-ref-filename="153rcb">rcb</a> = &amp;<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_info" title='bge_ring_data::bge_info' data-ref="bge_ring_data::bge_info" data-ref-filename="bge_ring_data..bge_info">bge_info</a>.<a class="ref field" href="if_bgereg.h.html#bge_gib::bge_jumbo_rx_rcb" title='bge_gib::bge_jumbo_rx_rcb' data-ref="bge_gib::bge_jumbo_rx_rcb" data-ref-filename="bge_gib..bge_jumbo_rx_rcb">bge_jumbo_rx_rcb</a>;</td></tr>
<tr><th id="1651">1651</th><td>	<a class="local col3 ref" href="#153rcb" title='rcb' data-ref="153rcb" data-ref-filename="153rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> = <var>0</var>;</td></tr>
<tr><th id="1652">1652</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2448, rcb-&gt;bge_maxlen_flags)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1122" title="0x2448" data-ref="_M/BGE_RX_JUMBO_RCB_MAXLEN_FLAGS">BGE_RX_JUMBO_RCB_MAXLEN_FLAGS</a>, <a class="local col3 ref" href="#153rcb" title='rcb' data-ref="153rcb" data-ref-filename="153rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a>);</td></tr>
<tr><th id="1653">1653</th><td></td></tr>
<tr><th id="1654">1654</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>, <a class="macro" href="if_bgereg.h.html#518" title="0x0274" data-ref="_M/BGE_MBX_RX_JUMBO_PROD_LO">BGE_MBX_RX_JUMBO_PROD_LO</a>, <a class="local col1 ref" href="#151sc" title='sc' data-ref="151sc" data-ref-filename="151sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>);</td></tr>
<tr><th id="1655">1655</th><td></td></tr>
<tr><th id="1656">1656</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1657">1657</th><td>}</td></tr>
<tr><th id="1658">1658</th><td></td></tr>
<tr><th id="1659">1659</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1660">1660</th><td><dfn class="tu decl def fn" id="bge_free_rx_ring_jumbo" title='bge_free_rx_ring_jumbo' data-type='void bge_free_rx_ring_jumbo(struct bge_softc * sc)' data-ref="bge_free_rx_ring_jumbo" data-ref-filename="bge_free_rx_ring_jumbo">bge_free_rx_ring_jumbo</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col4 decl" id="154sc" title='sc' data-type='struct bge_softc *' data-ref="154sc" data-ref-filename="154sc">sc</dfn>)</td></tr>
<tr><th id="1661">1661</th><td>{</td></tr>
<tr><th id="1662">1662</th><td>	<em>int</em> <dfn class="local col5 decl" id="155i" title='i' data-type='int' data-ref="155i" data-ref-filename="155i">i</dfn>;</td></tr>
<tr><th id="1663">1663</th><td></td></tr>
<tr><th id="1664">1664</th><td>	<b>if</b> (!(<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2687" title="0x80000000" data-ref="_M/BGEF_JUMBO_RXRING_VALID">BGEF_JUMBO_RXRING_VALID</a>))</td></tr>
<tr><th id="1665">1665</th><td>		<b>return</b>;</td></tr>
<tr><th id="1666">1666</th><td></td></tr>
<tr><th id="1667">1667</th><td>	<b>for</b> (<a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a> = <var>0</var>; <a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#2448" title="256" data-ref="_M/BGE_JUMBO_RX_RING_CNT">BGE_JUMBO_RX_RING_CNT</a>; <a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a>++) {</td></tr>
<tr><th id="1668">1668</th><td>		<b>if</b> (<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a>] != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1669">1669</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a>]);</td></tr>
<tr><th id="1670">1670</th><td>			<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1671">1671</th><td>		}</td></tr>
<tr><th id="1672">1672</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#382" title="__builtin_memset((char *)&amp;sc-&gt;bge_rdata-&gt;bge_rx_jumbo_ring[i], 0, sizeof(struct bge_rx_bd))" data-ref="_M/memset">memset</a>((<em>char</em> *)&amp;<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_rx_jumbo_ring" title='bge_ring_data::bge_rx_jumbo_ring' data-ref="bge_ring_data::bge_rx_jumbo_ring" data-ref-filename="bge_ring_data..bge_rx_jumbo_ring">bge_rx_jumbo_ring</a>[<a class="local col5 ref" href="#155i" title='i' data-ref="155i" data-ref-filename="155i">i</a>], <var>0</var>,</td></tr>
<tr><th id="1673">1673</th><td>		    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>));</td></tr>
<tr><th id="1674">1674</th><td>	}</td></tr>
<tr><th id="1675">1675</th><td></td></tr>
<tr><th id="1676">1676</th><td>	<a class="local col4 ref" href="#154sc" title='sc' data-ref="154sc" data-ref-filename="154sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2687" title="0x80000000" data-ref="_M/BGEF_JUMBO_RXRING_VALID">BGEF_JUMBO_RXRING_VALID</a>;</td></tr>
<tr><th id="1677">1677</th><td>}</td></tr>
<tr><th id="1678">1678</th><td></td></tr>
<tr><th id="1679">1679</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1680">1680</th><td><dfn class="tu decl def fn" id="bge_free_tx_ring" title='bge_free_tx_ring' data-type='void bge_free_tx_ring(struct bge_softc * sc, _Bool disable)' data-ref="bge_free_tx_ring" data-ref-filename="bge_free_tx_ring">bge_free_tx_ring</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="156sc" title='sc' data-type='struct bge_softc *' data-ref="156sc" data-ref-filename="156sc">sc</dfn>, <a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col7 decl" id="157disable" title='disable' data-type='_Bool' data-ref="157disable" data-ref-filename="157disable">disable</dfn>)</td></tr>
<tr><th id="1681">1681</th><td>{</td></tr>
<tr><th id="1682">1682</th><td>	<em>int</em> <dfn class="local col8 decl" id="158i" title='i' data-type='int' data-ref="158i" data-ref-filename="158i">i</dfn>;</td></tr>
<tr><th id="1683">1683</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#txdmamap_pool_entry" title='txdmamap_pool_entry' data-ref="txdmamap_pool_entry" data-ref-filename="txdmamap_pool_entry">txdmamap_pool_entry</a> *<dfn class="local col9 decl" id="159dma" title='dma' data-type='struct txdmamap_pool_entry *' data-ref="159dma" data-ref-filename="159dma">dma</dfn>;</td></tr>
<tr><th id="1684">1684</th><td></td></tr>
<tr><th id="1685">1685</th><td>	<b>if</b> (!(<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2685" title="0x20000000" data-ref="_M/BGEF_TXRING_VALID">BGEF_TXRING_VALID</a>))</td></tr>
<tr><th id="1686">1686</th><td>		<b>return</b>;</td></tr>
<tr><th id="1687">1687</th><td></td></tr>
<tr><th id="1688">1688</th><td>	<b>for</b> (<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a> = <var>0</var>; <a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>; <a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>++) {</td></tr>
<tr><th id="1689">1689</th><td>		<b>if</b> (<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>] != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1690">1690</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>]);</td></tr>
<tr><th id="1691">1691</th><td>			<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1692">1692</th><td>			<a class="macro" href="../../sys/queue.h.html#157" title="do { (sc-&gt;txdma[i])-&gt;link.sle_next = (&amp;sc-&gt;txdma_list)-&gt;slh_first; (&amp;sc-&gt;txdma_list)-&gt;slh_first = (sc-&gt;txdma[i]); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>, <a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma" title='bge_softc::txdma' data-ref="bge_softc::txdma" data-ref-filename="bge_softc..txdma">txdma</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>],</td></tr>
<tr><th id="1693">1693</th><td>					    <a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::link" title='txdmamap_pool_entry::link' data-ref="txdmamap_pool_entry::link" data-ref-filename="txdmamap_pool_entry..link">link</a>);</td></tr>
<tr><th id="1694">1694</th><td>			<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma" title='bge_softc::txdma' data-ref="bge_softc::txdma" data-ref-filename="bge_softc..txdma">txdma</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>] = <var>0</var>;</td></tr>
<tr><th id="1695">1695</th><td>		}</td></tr>
<tr><th id="1696">1696</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#382" title="__builtin_memset((char *)&amp;sc-&gt;bge_rdata-&gt;bge_tx_ring[i], 0, sizeof(struct bge_tx_bd))" data-ref="_M/memset">memset</a>((<em>char</em> *)&amp;<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_tx_ring" title='bge_ring_data::bge_tx_ring' data-ref="bge_ring_data::bge_tx_ring" data-ref-filename="bge_ring_data..bge_tx_ring">bge_tx_ring</a>[<a class="local col8 ref" href="#158i" title='i' data-ref="158i" data-ref-filename="158i">i</a>], <var>0</var>,</td></tr>
<tr><th id="1697">1697</th><td>		    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a>));</td></tr>
<tr><th id="1698">1698</th><td>	}</td></tr>
<tr><th id="1699">1699</th><td></td></tr>
<tr><th id="1700">1700</th><td>	<b>if</b> (<a class="local col7 ref" href="#157disable" title='disable' data-ref="157disable" data-ref-filename="157disable">disable</a>) {</td></tr>
<tr><th id="1701">1701</th><td>		<b>while</b> ((<a class="local col9 ref" href="#159dma" title='dma' data-ref="159dma" data-ref-filename="159dma">dma</a> = <a class="macro" href="../../sys/queue.h.html#129" title="((&amp;sc-&gt;txdma_list)-&gt;slh_first)" data-ref="_M/SLIST_FIRST">SLIST_FIRST</a>(&amp;<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>))) {</td></tr>
<tr><th id="1702">1702</th><td>			<a class="macro" href="../../sys/queue.h.html#167" title="do { (&amp;sc-&gt;txdma_list)-&gt;slh_first = (&amp;sc-&gt;txdma_list)-&gt;slh_first-&gt;link.sle_next; } while ( 0)" data-ref="_M/SLIST_REMOVE_HEAD">SLIST_REMOVE_HEAD</a>(&amp;<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>, <a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::link" title='txdmamap_pool_entry::link' data-ref="txdmamap_pool_entry::link" data-ref-filename="txdmamap_pool_entry..link">link</a>);</td></tr>
<tr><th id="1703">1703</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#159dma" title='dma' data-ref="159dma" data-ref-filename="159dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a>);</td></tr>
<tr><th id="1704">1704</th><td>			<b>if</b> (<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dma64" title='bge_softc::bge_dma64' data-ref="bge_softc::bge_dma64" data-ref-filename="bge_softc..bge_dma64">bge_dma64</a>) {</td></tr>
<tr><th id="1705">1705</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>,</td></tr>
<tr><th id="1706">1706</th><td>				    <a class="local col9 ref" href="#159dma" title='dma' data-ref="159dma" data-ref-filename="159dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a>);</td></tr>
<tr><th id="1707">1707</th><td>			}</td></tr>
<tr><th id="1708">1708</th><td>			<a class="macro" href="../../sys/malloc.h.html#71" title="kern_free(dma)" data-ref="_M/free">free</a>(<a class="local col9 ref" href="#159dma" title='dma' data-ref="159dma" data-ref-filename="159dma">dma</a>, M_DEVBUF);</td></tr>
<tr><th id="1709">1709</th><td>		}</td></tr>
<tr><th id="1710">1710</th><td>		<a class="macro" href="../../sys/queue.h.html#148" title="do { (&amp;sc-&gt;txdma_list)-&gt;slh_first = ((void *)0); } while ( 0)" data-ref="_M/SLIST_INIT">SLIST_INIT</a>(&amp;<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>);</td></tr>
<tr><th id="1711">1711</th><td>	}</td></tr>
<tr><th id="1712">1712</th><td></td></tr>
<tr><th id="1713">1713</th><td>	<a class="local col6 ref" href="#156sc" title='sc' data-ref="156sc" data-ref-filename="156sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2685" title="0x20000000" data-ref="_M/BGEF_TXRING_VALID">BGEF_TXRING_VALID</a>;</td></tr>
<tr><th id="1714">1714</th><td>}</td></tr>
<tr><th id="1715">1715</th><td></td></tr>
<tr><th id="1716">1716</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1717">1717</th><td><dfn class="tu decl def fn" id="bge_init_tx_ring" title='bge_init_tx_ring' data-type='int bge_init_tx_ring(struct bge_softc * sc)' data-ref="bge_init_tx_ring" data-ref-filename="bge_init_tx_ring">bge_init_tx_ring</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="160sc" title='sc' data-type='struct bge_softc *' data-ref="160sc" data-ref-filename="160sc">sc</dfn>)</td></tr>
<tr><th id="1718">1718</th><td>{</td></tr>
<tr><th id="1719">1719</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col1 decl" id="161ifp" title='ifp' data-type='struct ifnet *' data-ref="161ifp" data-ref-filename="161ifp">ifp</dfn> = &amp;<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="1720">1720</th><td>	<em>int</em> <dfn class="local col2 decl" id="162i" title='i' data-type='int' data-ref="162i" data-ref-filename="162i">i</dfn>;</td></tr>
<tr><th id="1721">1721</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dmamap_t" title='bus_dmamap_t' data-type='struct x86_bus_dmamap *' data-ref="bus_dmamap_t" data-ref-filename="bus_dmamap_t">bus_dmamap_t</a> <dfn class="local col3 decl" id="163dmamap" title='dmamap' data-type='bus_dmamap_t' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</dfn>, <dfn class="local col4 decl" id="164dmamap32" title='dmamap32' data-type='bus_dmamap_t' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</dfn>;</td></tr>
<tr><th id="1722">1722</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_size_t" title='bus_size_t' data-type='size_t' data-ref="bus_size_t" data-ref-filename="bus_size_t">bus_size_t</a> <dfn class="local col5 decl" id="165maxsegsz" title='maxsegsz' data-type='bus_size_t' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</dfn>;</td></tr>
<tr><th id="1723">1723</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#txdmamap_pool_entry" title='txdmamap_pool_entry' data-ref="txdmamap_pool_entry" data-ref-filename="txdmamap_pool_entry">txdmamap_pool_entry</a> *<dfn class="local col6 decl" id="166dma" title='dma' data-type='struct txdmamap_pool_entry *' data-ref="166dma" data-ref-filename="166dma">dma</dfn>;</td></tr>
<tr><th id="1724">1724</th><td></td></tr>
<tr><th id="1725">1725</th><td>	<b>if</b> (<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2685" title="0x20000000" data-ref="_M/BGEF_TXRING_VALID">BGEF_TXRING_VALID</a>)</td></tr>
<tr><th id="1726">1726</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1727">1727</th><td></td></tr>
<tr><th id="1728">1728</th><td>	<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_txcnt" title='bge_softc::bge_txcnt' data-ref="bge_softc::bge_txcnt" data-ref-filename="bge_softc..bge_txcnt">bge_txcnt</a> = <var>0</var>;</td></tr>
<tr><th id="1729">1729</th><td>	<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a> = <var>0</var>;</td></tr>
<tr><th id="1730">1730</th><td></td></tr>
<tr><th id="1731">1731</th><td>	<i>/* Initialize transmit producer index for host-memory send ring. */</i></td></tr>
<tr><th id="1732">1732</th><td>	<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_prodidx" title='bge_softc::bge_tx_prodidx' data-ref="bge_softc::bge_tx_prodidx" data-ref-filename="bge_softc..bge_tx_prodidx">bge_tx_prodidx</a> = <var>0</var>;</td></tr>
<tr><th id="1733">1733</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>, <a class="macro" href="if_bgereg.h.html#554" title="0x0304" data-ref="_M/BGE_MBX_TX_HOST_PROD0_LO">BGE_MBX_TX_HOST_PROD0_LO</a>, <a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_prodidx" title='bge_softc::bge_tx_prodidx' data-ref="bge_softc::bge_tx_prodidx" data-ref-filename="bge_softc..bge_tx_prodidx">bge_tx_prodidx</a>);</td></tr>
<tr><th id="1734">1734</th><td>	<i>/* 5700 b2 errata */</i></td></tr>
<tr><th id="1735">1735</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#386" title="0x71" data-ref="_M/BGE_CHIPREV_5700_BX">BGE_CHIPREV_5700_BX</a>)</td></tr>
<tr><th id="1736">1736</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>, <a class="macro" href="if_bgereg.h.html#554" title="0x0304" data-ref="_M/BGE_MBX_TX_HOST_PROD0_LO">BGE_MBX_TX_HOST_PROD0_LO</a>, <a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_prodidx" title='bge_softc::bge_tx_prodidx' data-ref="bge_softc::bge_tx_prodidx" data-ref-filename="bge_softc..bge_tx_prodidx">bge_tx_prodidx</a>);</td></tr>
<tr><th id="1737">1737</th><td></td></tr>
<tr><th id="1738">1738</th><td>	<i>/* NIC-memory send ring not used; initialize to zero. */</i></td></tr>
<tr><th id="1739">1739</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>, <a class="macro" href="if_bgereg.h.html#586" title="0x0384" data-ref="_M/BGE_MBX_TX_NIC_PROD0_LO">BGE_MBX_TX_NIC_PROD0_LO</a>, <var>0</var>);</td></tr>
<tr><th id="1740">1740</th><td>	<i>/* 5700 b2 errata */</i></td></tr>
<tr><th id="1741">1741</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#386" title="0x71" data-ref="_M/BGE_CHIPREV_5700_BX">BGE_CHIPREV_5700_BX</a>)</td></tr>
<tr><th id="1742">1742</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>, <a class="macro" href="if_bgereg.h.html#586" title="0x0384" data-ref="_M/BGE_MBX_TX_NIC_PROD0_LO">BGE_MBX_TX_NIC_PROD0_LO</a>, <var>0</var>);</td></tr>
<tr><th id="1743">1743</th><td></td></tr>
<tr><th id="1744">1744</th><td>	<i>/* Limit DMA segment size for some chips */</i></td></tr>
<tr><th id="1745">1745</th><td>	<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#380" title="0x57766" data-ref="_M/BGE_ASICREV_BCM57766">BGE_ASICREV_BCM57766</a>) &amp;&amp;</td></tr>
<tr><th id="1746">1746</th><td>	    (<a class="local col1 ref" href="#161ifp" title='ifp' data-ref="161ifp" data-ref-filename="161ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#396" title="if_data.ifi_mtu" data-ref="_M/if_mtu">if_mtu</a> &lt;= <a class="macro" href="../../net/if_ether.h.html#99" title="(1518 - ((6 * 2) + 2) - 4)" data-ref="_M/ETHERMTU">ETHERMTU</a>))</td></tr>
<tr><th id="1747">1747</th><td>		<a class="local col5 ref" href="#165maxsegsz" title='maxsegsz' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</a> = <var>2048</var>;</td></tr>
<tr><th id="1748">1748</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>)</td></tr>
<tr><th id="1749">1749</th><td>		<a class="local col5 ref" href="#165maxsegsz" title='maxsegsz' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</a> = <var>4096</var>;</td></tr>
<tr><th id="1750">1750</th><td>	<b>else</b></td></tr>
<tr><th id="1751">1751</th><td>		<a class="local col5 ref" href="#165maxsegsz" title='maxsegsz' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</a> = <a class="macro" href="../../net/if_ether.h.html#57" title="9018" data-ref="_M/ETHER_MAX_LEN_JUMBO">ETHER_MAX_LEN_JUMBO</a>;</td></tr>
<tr><th id="1752">1752</th><td></td></tr>
<tr><th id="1753">1753</th><td>	<b>if</b> (<a class="macro" href="../../sys/queue.h.html#129" title="((&amp;sc-&gt;txdma_list)-&gt;slh_first)" data-ref="_M/SLIST_FIRST">SLIST_FIRST</a>(&amp;<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>) != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1754">1754</th><td>		<b>goto</b> <a class="lbl" href="#167alloc_done" data-ref="167alloc_done" data-ref-filename="167alloc_done">alloc_done</a>;</td></tr>
<tr><th id="1755">1755</th><td></td></tr>
<tr><th id="1756">1756</th><td>	<b>for</b> (<a class="local col2 ref" href="#162i" title='i' data-ref="162i" data-ref-filename="162i">i</a> = <var>0</var>; <a class="local col2 ref" href="#162i" title='i' data-ref="162i" data-ref-filename="162i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>; <a class="local col2 ref" href="#162i" title='i' data-ref="162i" data-ref-filename="162i">i</a>++) {</td></tr>
<tr><th id="1757">1757</th><td>		<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_create" title='bus_dmamap_create' data-ref="bus_dmamap_create" data-ref-filename="bus_dmamap_create">bus_dmamap_create</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="macro" href="if_bgevar.h.html#200" title="((((65535) + ((1 &lt;&lt; 12) - 1)) &amp; ~((1 &lt;&lt; 12) - 1)))" data-ref="_M/BGE_TXDMA_MAX">BGE_TXDMA_MAX</a>,</td></tr>
<tr><th id="1758">1758</th><td>		    <a class="macro" href="if_bgevar.h.html#202" title="120" data-ref="_M/BGE_NTXSEG">BGE_NTXSEG</a>, <a class="local col5 ref" href="#165maxsegsz" title='maxsegsz' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</a>, <var>0</var>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a> | <a class="macro" href="../../sys/bus_proto.h.html#312" title="0x002" data-ref="_M/BUS_DMA_ALLOCNOW">BUS_DMA_ALLOCNOW</a>,</td></tr>
<tr><th id="1759">1759</th><td>		    &amp;<a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a>))</td></tr>
<tr><th id="1760">1760</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1761">1761</th><td>		<b>if</b> (<a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1762">1762</th><td>			<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"dmamap NULL in bge_init_tx_ring"</q>);</td></tr>
<tr><th id="1763">1763</th><td>		<b>if</b> (<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dma64" title='bge_softc::bge_dma64' data-ref="bge_softc::bge_dma64" data-ref-filename="bge_softc..bge_dma64">bge_dma64</a>) {</td></tr>
<tr><th id="1764">1764</th><td>			<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_create" title='bus_dmamap_create' data-ref="bus_dmamap_create" data-ref-filename="bus_dmamap_create">bus_dmamap_create</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>, <a class="macro" href="if_bgevar.h.html#200" title="((((65535) + ((1 &lt;&lt; 12) - 1)) &amp; ~((1 &lt;&lt; 12) - 1)))" data-ref="_M/BGE_TXDMA_MAX">BGE_TXDMA_MAX</a>,</td></tr>
<tr><th id="1765">1765</th><td>			    <a class="macro" href="if_bgevar.h.html#202" title="120" data-ref="_M/BGE_NTXSEG">BGE_NTXSEG</a>, <a class="local col5 ref" href="#165maxsegsz" title='maxsegsz' data-ref="165maxsegsz" data-ref-filename="165maxsegsz">maxsegsz</a>, <var>0</var>,</td></tr>
<tr><th id="1766">1766</th><td>			    <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a> | <a class="macro" href="../../sys/bus_proto.h.html#312" title="0x002" data-ref="_M/BUS_DMA_ALLOCNOW">BUS_DMA_ALLOCNOW</a>,</td></tr>
<tr><th id="1767">1767</th><td>			    &amp;<a class="local col4 ref" href="#164dmamap32" title='dmamap32' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</a>)) {</td></tr>
<tr><th id="1768">1768</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a>);</td></tr>
<tr><th id="1769">1769</th><td>				<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="1770">1770</th><td>			}</td></tr>
<tr><th id="1771">1771</th><td>			<b>if</b> (<a class="local col4 ref" href="#164dmamap32" title='dmamap32' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="1772">1772</th><td>				<a class="ref fn" href="../../sys/systm.h.html#panic" title='panic' data-ref="panic" data-ref-filename="panic">panic</a>(<q>"dmamap32 NULL in bge_init_tx_ring"</q>);</td></tr>
<tr><th id="1773">1773</th><td>		} <b>else</b></td></tr>
<tr><th id="1774">1774</th><td>			<a class="local col4 ref" href="#164dmamap32" title='dmamap32' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</a> = <a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a>;</td></tr>
<tr><th id="1775">1775</th><td>		<a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a> = <a class="macro" href="../../sys/malloc.h.html#70" title="kern_malloc(sizeof(*dma), 0x0001)" data-ref="_M/malloc">malloc</a>(<b>sizeof</b>(*<a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a>), M_DEVBUF, <a class="macro" href="../../sys/malloc.h.html#43" title="0x0001" data-ref="_M/M_NOWAIT">M_NOWAIT</a>);</td></tr>
<tr><th id="1776">1776</th><td>		<b>if</b> (<a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1777">1777</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="1778">1778</th><td>			    <q>"can't alloc txdmamap_pool_entry\n"</q>);</td></tr>
<tr><th id="1779">1779</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a>);</td></tr>
<tr><th id="1780">1780</th><td>			<b>if</b> (<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dma64" title='bge_softc::bge_dma64' data-ref="bge_softc::bge_dma64" data-ref-filename="bge_softc..bge_dma64">bge_dma64</a>)</td></tr>
<tr><th id="1781">1781</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>, <a class="local col4 ref" href="#164dmamap32" title='dmamap32' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</a>);</td></tr>
<tr><th id="1782">1782</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1783">1783</th><td>		}</td></tr>
<tr><th id="1784">1784</th><td>		<a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a> = <a class="local col3 ref" href="#163dmamap" title='dmamap' data-ref="163dmamap" data-ref-filename="163dmamap">dmamap</a>;</td></tr>
<tr><th id="1785">1785</th><td>		<a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a> = <a class="local col4 ref" href="#164dmamap32" title='dmamap32' data-ref="164dmamap32" data-ref-filename="164dmamap32">dmamap32</a>;</td></tr>
<tr><th id="1786">1786</th><td>		<a class="macro" href="../../sys/queue.h.html#157" title="do { (dma)-&gt;link.sle_next = (&amp;sc-&gt;txdma_list)-&gt;slh_first; (&amp;sc-&gt;txdma_list)-&gt;slh_first = (dma); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>, <a class="local col6 ref" href="#166dma" title='dma' data-ref="166dma" data-ref-filename="166dma">dma</a>, <a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::link" title='txdmamap_pool_entry::link' data-ref="txdmamap_pool_entry::link" data-ref-filename="txdmamap_pool_entry..link">link</a>);</td></tr>
<tr><th id="1787">1787</th><td>	}</td></tr>
<tr><th id="1788">1788</th><td><dfn class="lbl" id="167alloc_done" data-ref="167alloc_done" data-ref-filename="167alloc_done">alloc_done</dfn>:</td></tr>
<tr><th id="1789">1789</th><td>	<a class="local col0 ref" href="#160sc" title='sc' data-ref="160sc" data-ref-filename="160sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2685" title="0x20000000" data-ref="_M/BGEF_TXRING_VALID">BGEF_TXRING_VALID</a>;</td></tr>
<tr><th id="1790">1790</th><td></td></tr>
<tr><th id="1791">1791</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1792">1792</th><td>}</td></tr>
<tr><th id="1793">1793</th><td></td></tr>
<tr><th id="1794">1794</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1795">1795</th><td><dfn class="tu decl def fn" id="bge_setmulti" title='bge_setmulti' data-type='void bge_setmulti(struct bge_softc * sc)' data-ref="bge_setmulti" data-ref-filename="bge_setmulti">bge_setmulti</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="168sc" title='sc' data-type='struct bge_softc *' data-ref="168sc" data-ref-filename="168sc">sc</dfn>)</td></tr>
<tr><th id="1796">1796</th><td>{</td></tr>
<tr><th id="1797">1797</th><td>	<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ethercom" title='ethercom' data-ref="ethercom" data-ref-filename="ethercom">ethercom</a>		*<dfn class="local col9 decl" id="169ec" title='ec' data-type='struct ethercom *' data-ref="169ec" data-ref-filename="169ec">ec</dfn> = &amp;<a class="local col8 ref" href="#168sc" title='sc' data-ref="168sc" data-ref-filename="168sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>;</td></tr>
<tr><th id="1798">1798</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a>		*<dfn class="local col0 decl" id="170ifp" title='ifp' data-type='struct ifnet *' data-ref="170ifp" data-ref-filename="170ifp">ifp</dfn> = &amp;<a class="local col9 ref" href="#169ec" title='ec' data-ref="169ec" data-ref-filename="169ec">ec</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="1799">1799</th><td>	<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ether_multi" title='ether_multi' data-ref="ether_multi" data-ref-filename="ether_multi">ether_multi</a>	*<dfn class="local col1 decl" id="171enm" title='enm' data-type='struct ether_multi *' data-ref="171enm" data-ref-filename="171enm">enm</dfn>;</td></tr>
<tr><th id="1800">1800</th><td>	<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ether_multistep" title='ether_multistep' data-ref="ether_multistep" data-ref-filename="ether_multistep">ether_multistep</a>	<dfn class="local col2 decl" id="172step" title='step' data-type='struct ether_multistep' data-ref="172step" data-ref-filename="172step">step</dfn>;</td></tr>
<tr><th id="1801">1801</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col3 decl" id="173hashes" title='hashes' data-type='uint32_t [4]' data-ref="173hashes" data-ref-filename="173hashes">hashes</dfn>[<var>4</var>] = { <var>0</var>, <var>0</var>, <var>0</var>, <var>0</var> };</td></tr>
<tr><th id="1802">1802</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col4 decl" id="174h" title='h' data-type='uint32_t' data-ref="174h" data-ref-filename="174h">h</dfn>;</td></tr>
<tr><th id="1803">1803</th><td>	<em>int</em>			<dfn class="local col5 decl" id="175i" title='i' data-type='int' data-ref="175i" data-ref-filename="175i">i</dfn>;</td></tr>
<tr><th id="1804">1804</th><td></td></tr>
<tr><th id="1805">1805</th><td>	<b>if</b> (<a class="local col0 ref" href="#170ifp" title='ifp' data-ref="170ifp" data-ref-filename="170ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#425" title="0x0100" data-ref="_M/IFF_PROMISC">IFF_PROMISC</a>)</td></tr>
<tr><th id="1806">1806</th><td>		<b>goto</b> <a class="lbl" href="#176allmulti" data-ref="176allmulti" data-ref-filename="176allmulti">allmulti</a>;</td></tr>
<tr><th id="1807">1807</th><td></td></tr>
<tr><th id="1808">1808</th><td>	<i>/* Now program new ones. */</i></td></tr>
<tr><th id="1809">1809</th><td>	<a class="macro" href="../../net/if_ether.h.html#341" title="mutex_enter((ec)-&gt;ec_lock)" data-ref="_M/ETHER_LOCK">ETHER_LOCK</a>(<a class="local col9 ref" href="#169ec" title='ec' data-ref="169ec" data-ref-filename="169ec">ec</a>);</td></tr>
<tr><th id="1810">1810</th><td>	<a class="macro" href="../../net/if_ether.h.html#335" title="(enm) = ether_first_multi(&amp;(step), (ec))" data-ref="_M/ETHER_FIRST_MULTI">ETHER_FIRST_MULTI</a>(<a class="local col2 ref" href="#172step" title='step' data-ref="172step" data-ref-filename="172step">step</a>, <a class="local col9 ref" href="#169ec" title='ec' data-ref="169ec" data-ref-filename="169ec">ec</a>, <a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a>);</td></tr>
<tr><th id="1811">1811</th><td>	<b>while</b> (<a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="1812">1812</th><td>		<b>if</b> (<a class="macro" href="../../lib/libkern/libkern.h.html#381" title="__builtin_memcmp(enm-&gt;enm_addrlo, enm-&gt;enm_addrhi, 6)" data-ref="_M/memcmp">memcmp</a>(<a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ether_multi::enm_addrlo" title='ether_multi::enm_addrlo' data-ref="ether_multi::enm_addrlo" data-ref-filename="ether_multi..enm_addrlo">enm_addrlo</a>, <a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ether_multi::enm_addrhi" title='ether_multi::enm_addrhi' data-ref="ether_multi::enm_addrhi" data-ref-filename="ether_multi..enm_addrhi">enm_addrhi</a>, <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>)) {</td></tr>
<tr><th id="1813">1813</th><td>			<i>/*</i></td></tr>
<tr><th id="1814">1814</th><td><i>			 * We must listen to a range of multicast addresses.</i></td></tr>
<tr><th id="1815">1815</th><td><i>			 * For now, just accept all multicasts, rather than</i></td></tr>
<tr><th id="1816">1816</th><td><i>			 * trying to set only those filter bits needed to match</i></td></tr>
<tr><th id="1817">1817</th><td><i>			 * the range.  (At this time, the only use of address</i></td></tr>
<tr><th id="1818">1818</th><td><i>			 * ranges is for IP multicast routing, for which the</i></td></tr>
<tr><th id="1819">1819</th><td><i>			 * range is big enough to require all bits set.)</i></td></tr>
<tr><th id="1820">1820</th><td><i>			 */</i></td></tr>
<tr><th id="1821">1821</th><td>			<a class="macro" href="../../net/if_ether.h.html#342" title="mutex_exit((ec)-&gt;ec_lock)" data-ref="_M/ETHER_UNLOCK">ETHER_UNLOCK</a>(<a class="local col9 ref" href="#169ec" title='ec' data-ref="169ec" data-ref-filename="169ec">ec</a>);</td></tr>
<tr><th id="1822">1822</th><td>			<b>goto</b> <a class="lbl" href="#176allmulti" data-ref="176allmulti" data-ref-filename="176allmulti">allmulti</a>;</td></tr>
<tr><th id="1823">1823</th><td>		}</td></tr>
<tr><th id="1824">1824</th><td></td></tr>
<tr><th id="1825">1825</th><td>		<a class="local col4 ref" href="#174h" title='h' data-ref="174h" data-ref-filename="174h">h</a> = <a class="ref fn" href="../../net/if_ether.h.html#ether_crc32_le" title='ether_crc32_le' data-ref="ether_crc32_le" data-ref-filename="ether_crc32_le">ether_crc32_le</a>(<a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ether_multi::enm_addrlo" title='ether_multi::enm_addrlo' data-ref="ether_multi::enm_addrlo" data-ref-filename="ether_multi..enm_addrlo">enm_addrlo</a>, <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>);</td></tr>
<tr><th id="1826">1826</th><td></td></tr>
<tr><th id="1827">1827</th><td>		<i>/* Just want the 7 least-significant bits. */</i></td></tr>
<tr><th id="1828">1828</th><td>		<a class="local col4 ref" href="#174h" title='h' data-ref="174h" data-ref-filename="174h">h</a> &amp;= <var>0x7f</var>;</td></tr>
<tr><th id="1829">1829</th><td></td></tr>
<tr><th id="1830">1830</th><td>		<a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[(<a class="local col4 ref" href="#174h" title='h' data-ref="174h" data-ref-filename="174h">h</a> &amp; <var>0x60</var>) &gt;&gt; <var>5</var>] |= <var>1</var> &lt;&lt; (<a class="local col4 ref" href="#174h" title='h' data-ref="174h" data-ref-filename="174h">h</a> &amp; <var>0x1F</var>);</td></tr>
<tr><th id="1831">1831</th><td>		<a class="macro" href="../../net/if_ether.h.html#321" title="(enm) = ether_next_multi(&amp;(step))" data-ref="_M/ETHER_NEXT_MULTI">ETHER_NEXT_MULTI</a>(<a class="local col2 ref" href="#172step" title='step' data-ref="172step" data-ref-filename="172step">step</a>, <a class="local col1 ref" href="#171enm" title='enm' data-ref="171enm" data-ref-filename="171enm">enm</a>);</td></tr>
<tr><th id="1832">1832</th><td>	}</td></tr>
<tr><th id="1833">1833</th><td>	<a class="macro" href="../../net/if_ether.h.html#342" title="mutex_exit((ec)-&gt;ec_lock)" data-ref="_M/ETHER_UNLOCK">ETHER_UNLOCK</a>(<a class="local col9 ref" href="#169ec" title='ec' data-ref="169ec" data-ref-filename="169ec">ec</a>);</td></tr>
<tr><th id="1834">1834</th><td></td></tr>
<tr><th id="1835">1835</th><td>	<a class="local col0 ref" href="#170ifp" title='ifp' data-ref="170ifp" data-ref-filename="170ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp;= ~<a class="macro" href="../../net/if.h.html#426" title="0x0200" data-ref="_M/IFF_ALLMULTI">IFF_ALLMULTI</a>;</td></tr>
<tr><th id="1836">1836</th><td>	<b>goto</b> <a class="lbl" href="#177setit" data-ref="177setit" data-ref-filename="177setit">setit</a>;</td></tr>
<tr><th id="1837">1837</th><td></td></tr>
<tr><th id="1838">1838</th><td> <dfn class="lbl" id="176allmulti" data-ref="176allmulti" data-ref-filename="176allmulti">allmulti</dfn>:</td></tr>
<tr><th id="1839">1839</th><td>	<a class="local col0 ref" href="#170ifp" title='ifp' data-ref="170ifp" data-ref-filename="170ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> |= <a class="macro" href="../../net/if.h.html#426" title="0x0200" data-ref="_M/IFF_ALLMULTI">IFF_ALLMULTI</a>;</td></tr>
<tr><th id="1840">1840</th><td>	<a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[<var>0</var>] = <a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[<var>1</var>] = <a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[<var>2</var>] = <a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[<var>3</var>] = <var>0xffffffff</var>;</td></tr>
<tr><th id="1841">1841</th><td></td></tr>
<tr><th id="1842">1842</th><td> <dfn class="lbl" id="177setit" data-ref="177setit" data-ref-filename="177setit">setit</dfn>:</td></tr>
<tr><th id="1843">1843</th><td>	<b>for</b> (<a class="local col5 ref" href="#175i" title='i' data-ref="175i" data-ref-filename="175i">i</a> = <var>0</var>; <a class="local col5 ref" href="#175i" title='i' data-ref="175i" data-ref-filename="175i">i</a> &lt; <var>4</var>; <a class="local col5 ref" href="#175i" title='i' data-ref="175i" data-ref-filename="175i">i</a>++)</td></tr>
<tr><th id="1844">1844</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0470 + (i * 4), hashes[i])" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col8 ref" href="#168sc" title='sc' data-ref="168sc" data-ref-filename="168sc">sc</a>, <a class="macro" href="if_bgereg.h.html#653" title="0x0470" data-ref="_M/BGE_MAR0">BGE_MAR0</a> + (<a class="local col5 ref" href="#175i" title='i' data-ref="175i" data-ref-filename="175i">i</a> * <var>4</var>), <a class="local col3 ref" href="#173hashes" title='hashes' data-ref="173hashes" data-ref-filename="173hashes">hashes</a>[<a class="local col5 ref" href="#175i" title='i' data-ref="175i" data-ref-filename="175i">i</a>]);</td></tr>
<tr><th id="1845">1845</th><td>}</td></tr>
<tr><th id="1846">1846</th><td></td></tr>
<tr><th id="1847">1847</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1848">1848</th><td><dfn class="tu decl def fn" id="bge_sig_pre_reset" title='bge_sig_pre_reset' data-type='void bge_sig_pre_reset(struct bge_softc * sc, int type)' data-ref="bge_sig_pre_reset" data-ref-filename="bge_sig_pre_reset">bge_sig_pre_reset</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="178sc" title='sc' data-type='struct bge_softc *' data-ref="178sc" data-ref-filename="178sc">sc</dfn>, <em>int</em> <dfn class="local col9 decl" id="179type" title='type' data-type='int' data-ref="179type" data-ref-filename="179type">type</dfn>)</td></tr>
<tr><th id="1849">1849</th><td>{</td></tr>
<tr><th id="1850">1850</th><td></td></tr>
<tr><th id="1851">1851</th><td>	<i>/*</i></td></tr>
<tr><th id="1852">1852</th><td><i>	 * Some chips don't like this so only do this if ASF is enabled</i></td></tr>
<tr><th id="1853">1853</th><td><i>	 */</i></td></tr>
<tr><th id="1854">1854</th><td>	<b>if</b> (<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a>)</td></tr>
<tr><th id="1855">1855</th><td>		<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>, <a class="macro" href="if_bgereg.h.html#75" title="0x00000B50" data-ref="_M/BGE_SRAM_FW_MB">BGE_SRAM_FW_MB</a>, <a class="macro" href="if_bgereg.h.html#2242" title="0x4B657654" data-ref="_M/BGE_SRAM_FW_MB_MAGIC">BGE_SRAM_FW_MB_MAGIC</a>);</td></tr>
<tr><th id="1856">1856</th><td></td></tr>
<tr><th id="1857">1857</th><td>	<b>if</b> (<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#258" title="2" data-ref="_M/ASF_NEW_HANDSHAKE">ASF_NEW_HANDSHAKE</a>) {</td></tr>
<tr><th id="1858">1858</th><td>		<b>switch</b> (<a class="local col9 ref" href="#179type" title='type' data-ref="179type" data-ref-filename="179type">type</a>) {</td></tr>
<tr><th id="1859">1859</th><td>		<b>case</b> <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>:</td></tr>
<tr><th id="1860">1860</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1861">1861</th><td>			    <a class="macro" href="if_bgereg.h.html#107" title="0x00000001" data-ref="_M/BGE_FW_DRV_STATE_START">BGE_FW_DRV_STATE_START</a>);</td></tr>
<tr><th id="1862">1862</th><td>			<b>break</b>;</td></tr>
<tr><th id="1863">1863</th><td>		<b>case</b> <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>:</td></tr>
<tr><th id="1864">1864</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1865">1865</th><td>			    <a class="macro" href="if_bgereg.h.html#109" title="0x00000002" data-ref="_M/BGE_FW_DRV_STATE_UNLOAD">BGE_FW_DRV_STATE_UNLOAD</a>);</td></tr>
<tr><th id="1866">1866</th><td>			<b>break</b>;</td></tr>
<tr><th id="1867">1867</th><td>		<b>case</b> <a class="macro" href="#256" title="2" data-ref="_M/BGE_RESET_SUSPEND">BGE_RESET_SUSPEND</a>:</td></tr>
<tr><th id="1868">1868</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1869">1869</th><td>			    <a class="macro" href="if_bgereg.h.html#111" title="0x00000004" data-ref="_M/BGE_FW_DRV_STATE_SUSPEND">BGE_FW_DRV_STATE_SUSPEND</a>);</td></tr>
<tr><th id="1870">1870</th><td>			<b>break</b>;</td></tr>
<tr><th id="1871">1871</th><td>		}</td></tr>
<tr><th id="1872">1872</th><td>	}</td></tr>
<tr><th id="1873">1873</th><td></td></tr>
<tr><th id="1874">1874</th><td>	<b>if</b> (<a class="local col9 ref" href="#179type" title='type' data-ref="179type" data-ref-filename="179type">type</a> == <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a> || <a class="local col9 ref" href="#179type" title='type' data-ref="179type" data-ref-filename="179type">type</a> == <a class="macro" href="#256" title="2" data-ref="_M/BGE_RESET_SUSPEND">BGE_RESET_SUSPEND</a>)</td></tr>
<tr><th id="1875">1875</th><td>		<a class="tu ref fn" href="#bge_ape_driver_state_change" title='bge_ape_driver_state_change' data-use='c' data-ref="bge_ape_driver_state_change" data-ref-filename="bge_ape_driver_state_change">bge_ape_driver_state_change</a>(<a class="local col8 ref" href="#178sc" title='sc' data-ref="178sc" data-ref-filename="178sc">sc</a>, <a class="local col9 ref" href="#179type" title='type' data-ref="179type" data-ref-filename="179type">type</a>);</td></tr>
<tr><th id="1876">1876</th><td>}</td></tr>
<tr><th id="1877">1877</th><td></td></tr>
<tr><th id="1878">1878</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1879">1879</th><td><dfn class="tu decl def fn" id="bge_sig_post_reset" title='bge_sig_post_reset' data-type='void bge_sig_post_reset(struct bge_softc * sc, int type)' data-ref="bge_sig_post_reset" data-ref-filename="bge_sig_post_reset">bge_sig_post_reset</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="180sc" title='sc' data-type='struct bge_softc *' data-ref="180sc" data-ref-filename="180sc">sc</dfn>, <em>int</em> <dfn class="local col1 decl" id="181type" title='type' data-type='int' data-ref="181type" data-ref-filename="181type">type</dfn>)</td></tr>
<tr><th id="1880">1880</th><td>{</td></tr>
<tr><th id="1881">1881</th><td></td></tr>
<tr><th id="1882">1882</th><td>	<b>if</b> (<a class="local col0 ref" href="#180sc" title='sc' data-ref="180sc" data-ref-filename="180sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#258" title="2" data-ref="_M/ASF_NEW_HANDSHAKE">ASF_NEW_HANDSHAKE</a>) {</td></tr>
<tr><th id="1883">1883</th><td>		<b>switch</b> (<a class="local col1 ref" href="#181type" title='type' data-ref="181type" data-ref-filename="181type">type</a>) {</td></tr>
<tr><th id="1884">1884</th><td>		<b>case</b> <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>:</td></tr>
<tr><th id="1885">1885</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col0 ref" href="#180sc" title='sc' data-ref="180sc" data-ref-filename="180sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1886">1886</th><td>			    <a class="macro" href="if_bgereg.h.html#108" title="0x80000001" data-ref="_M/BGE_FW_DRV_STATE_START_DONE">BGE_FW_DRV_STATE_START_DONE</a>);</td></tr>
<tr><th id="1887">1887</th><td>			<i>/* START DONE */</i></td></tr>
<tr><th id="1888">1888</th><td>			<b>break</b>;</td></tr>
<tr><th id="1889">1889</th><td>		<b>case</b> <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>:</td></tr>
<tr><th id="1890">1890</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col0 ref" href="#180sc" title='sc' data-ref="180sc" data-ref-filename="180sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1891">1891</th><td>			    <a class="macro" href="if_bgereg.h.html#110" title="0x80000002" data-ref="_M/BGE_FW_DRV_STATE_UNLOAD_DONE">BGE_FW_DRV_STATE_UNLOAD_DONE</a>);</td></tr>
<tr><th id="1892">1892</th><td>			<b>break</b>;</td></tr>
<tr><th id="1893">1893</th><td>		}</td></tr>
<tr><th id="1894">1894</th><td>	}</td></tr>
<tr><th id="1895">1895</th><td></td></tr>
<tr><th id="1896">1896</th><td>	<b>if</b> (<a class="local col1 ref" href="#181type" title='type' data-ref="181type" data-ref-filename="181type">type</a> == <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>)</td></tr>
<tr><th id="1897">1897</th><td>		<a class="tu ref fn" href="#bge_ape_driver_state_change" title='bge_ape_driver_state_change' data-use='c' data-ref="bge_ape_driver_state_change" data-ref-filename="bge_ape_driver_state_change">bge_ape_driver_state_change</a>(<a class="local col0 ref" href="#180sc" title='sc' data-ref="180sc" data-ref-filename="180sc">sc</a>, <a class="local col1 ref" href="#181type" title='type' data-ref="181type" data-ref-filename="181type">type</a>);</td></tr>
<tr><th id="1898">1898</th><td>}</td></tr>
<tr><th id="1899">1899</th><td></td></tr>
<tr><th id="1900">1900</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1901">1901</th><td><dfn class="tu decl def fn" id="bge_sig_legacy" title='bge_sig_legacy' data-type='void bge_sig_legacy(struct bge_softc * sc, int type)' data-ref="bge_sig_legacy" data-ref-filename="bge_sig_legacy">bge_sig_legacy</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col2 decl" id="182sc" title='sc' data-type='struct bge_softc *' data-ref="182sc" data-ref-filename="182sc">sc</dfn>, <em>int</em> <dfn class="local col3 decl" id="183type" title='type' data-type='int' data-ref="183type" data-ref-filename="183type">type</dfn>)</td></tr>
<tr><th id="1902">1902</th><td>{</td></tr>
<tr><th id="1903">1903</th><td></td></tr>
<tr><th id="1904">1904</th><td>	<b>if</b> (<a class="local col2 ref" href="#182sc" title='sc' data-ref="182sc" data-ref-filename="182sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a>) {</td></tr>
<tr><th id="1905">1905</th><td>		<b>switch</b> (<a class="local col3 ref" href="#183type" title='type' data-ref="183type" data-ref-filename="183type">type</a>) {</td></tr>
<tr><th id="1906">1906</th><td>		<b>case</b> <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>:</td></tr>
<tr><th id="1907">1907</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col2 ref" href="#182sc" title='sc' data-ref="182sc" data-ref-filename="182sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1908">1908</th><td>			    <a class="macro" href="if_bgereg.h.html#107" title="0x00000001" data-ref="_M/BGE_FW_DRV_STATE_START">BGE_FW_DRV_STATE_START</a>);</td></tr>
<tr><th id="1909">1909</th><td>			<b>break</b>;</td></tr>
<tr><th id="1910">1910</th><td>		<b>case</b> <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>:</td></tr>
<tr><th id="1911">1911</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col2 ref" href="#182sc" title='sc' data-ref="182sc" data-ref-filename="182sc">sc</a>, <a class="macro" href="if_bgereg.h.html#82" title="0x00000C04" data-ref="_M/BGE_SRAM_FW_DRV_STATE_MB">BGE_SRAM_FW_DRV_STATE_MB</a>,</td></tr>
<tr><th id="1912">1912</th><td>			    <a class="macro" href="if_bgereg.h.html#109" title="0x00000002" data-ref="_M/BGE_FW_DRV_STATE_UNLOAD">BGE_FW_DRV_STATE_UNLOAD</a>);</td></tr>
<tr><th id="1913">1913</th><td>			<b>break</b>;</td></tr>
<tr><th id="1914">1914</th><td>		}</td></tr>
<tr><th id="1915">1915</th><td>	}</td></tr>
<tr><th id="1916">1916</th><td>}</td></tr>
<tr><th id="1917">1917</th><td></td></tr>
<tr><th id="1918">1918</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1919">1919</th><td><dfn class="tu decl def fn" id="bge_wait_for_event_ack" title='bge_wait_for_event_ack' data-type='void bge_wait_for_event_ack(struct bge_softc * sc)' data-ref="bge_wait_for_event_ack" data-ref-filename="bge_wait_for_event_ack">bge_wait_for_event_ack</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col4 decl" id="184sc" title='sc' data-type='struct bge_softc *' data-ref="184sc" data-ref-filename="184sc">sc</dfn>)</td></tr>
<tr><th id="1920">1920</th><td>{</td></tr>
<tr><th id="1921">1921</th><td>	<em>int</em> <dfn class="local col5 decl" id="185i" title='i' data-type='int' data-ref="185i" data-ref-filename="185i">i</dfn>;</td></tr>
<tr><th id="1922">1922</th><td></td></tr>
<tr><th id="1923">1923</th><td>	<i>/* wait up to 2500usec */</i></td></tr>
<tr><th id="1924">1924</th><td>	<b>for</b> (<a class="local col5 ref" href="#185i" title='i' data-ref="185i" data-ref-filename="185i">i</a> = <var>0</var>; <a class="local col5 ref" href="#185i" title='i' data-ref="185i" data-ref-filename="185i">i</a> &lt; <var>250</var>; <a class="local col5 ref" href="#185i" title='i' data-ref="185i" data-ref-filename="185i">i</a>++) {</td></tr>
<tr><th id="1925">1925</th><td>		<b>if</b> (!(<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col4 ref" href="#184sc" title='sc' data-ref="184sc" data-ref-filename="184sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1900" title="0x6810" data-ref="_M/BGE_RX_CPU_EVENT">BGE_RX_CPU_EVENT</a>) &amp;</td></tr>
<tr><th id="1926">1926</th><td>			<a class="macro" href="if_bgereg.h.html#1909" title="0x00004000" data-ref="_M/BGE_RX_CPU_DRV_EVENT">BGE_RX_CPU_DRV_EVENT</a>))</td></tr>
<tr><th id="1927">1927</th><td>			<b>break</b>;</td></tr>
<tr><th id="1928">1928</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="1929">1929</th><td>	}</td></tr>
<tr><th id="1930">1930</th><td>}</td></tr>
<tr><th id="1931">1931</th><td></td></tr>
<tr><th id="1932">1932</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1933">1933</th><td><dfn class="tu decl def fn" id="bge_stop_fw" title='bge_stop_fw' data-type='void bge_stop_fw(struct bge_softc * sc)' data-ref="bge_stop_fw" data-ref-filename="bge_stop_fw">bge_stop_fw</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="186sc" title='sc' data-type='struct bge_softc *' data-ref="186sc" data-ref-filename="186sc">sc</dfn>)</td></tr>
<tr><th id="1934">1934</th><td>{</td></tr>
<tr><th id="1935">1935</th><td></td></tr>
<tr><th id="1936">1936</th><td>	<b>if</b> (<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a>) {</td></tr>
<tr><th id="1937">1937</th><td>		<a class="tu ref fn" href="#bge_wait_for_event_ack" title='bge_wait_for_event_ack' data-use='c' data-ref="bge_wait_for_event_ack" data-ref-filename="bge_wait_for_event_ack">bge_wait_for_event_ack</a>(<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>);</td></tr>
<tr><th id="1938">1938</th><td></td></tr>
<tr><th id="1939">1939</th><td>		<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>, <a class="macro" href="if_bgereg.h.html#79" title="0x00000B78" data-ref="_M/BGE_SRAM_FW_CMD_MB">BGE_SRAM_FW_CMD_MB</a>, <a class="macro" href="if_bgereg.h.html#102" title="0x00000002" data-ref="_M/BGE_FW_CMD_PAUSE">BGE_FW_CMD_PAUSE</a>);</td></tr>
<tr><th id="1940">1940</th><td>		<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810, bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810) | 0x00004000); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1900" title="0x6810" data-ref="_M/BGE_RX_CPU_EVENT">BGE_RX_CPU_EVENT</a>,</td></tr>
<tr><th id="1941">1941</th><td>		    <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1900" title="0x6810" data-ref="_M/BGE_RX_CPU_EVENT">BGE_RX_CPU_EVENT</a>) | <a class="macro" href="if_bgereg.h.html#1909" title="0x00004000" data-ref="_M/BGE_RX_CPU_DRV_EVENT">BGE_RX_CPU_DRV_EVENT</a>);</td></tr>
<tr><th id="1942">1942</th><td></td></tr>
<tr><th id="1943">1943</th><td>		<a class="tu ref fn" href="#bge_wait_for_event_ack" title='bge_wait_for_event_ack' data-use='c' data-ref="bge_wait_for_event_ack" data-ref-filename="bge_wait_for_event_ack">bge_wait_for_event_ack</a>(<a class="local col6 ref" href="#186sc" title='sc' data-ref="186sc" data-ref-filename="186sc">sc</a>);</td></tr>
<tr><th id="1944">1944</th><td>	}</td></tr>
<tr><th id="1945">1945</th><td>}</td></tr>
<tr><th id="1946">1946</th><td></td></tr>
<tr><th id="1947">1947</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1948">1948</th><td><dfn class="tu decl def fn" id="bge_poll_fw" title='bge_poll_fw' data-type='int bge_poll_fw(struct bge_softc * sc)' data-ref="bge_poll_fw" data-ref-filename="bge_poll_fw">bge_poll_fw</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="187sc" title='sc' data-type='struct bge_softc *' data-ref="187sc" data-ref-filename="187sc">sc</dfn>)</td></tr>
<tr><th id="1949">1949</th><td>{</td></tr>
<tr><th id="1950">1950</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="188val" title='val' data-type='uint32_t' data-ref="188val" data-ref-filename="188val">val</dfn>;</td></tr>
<tr><th id="1951">1951</th><td>	<em>int</em> <dfn class="local col9 decl" id="189i" title='i' data-type='int' data-ref="189i" data-ref-filename="189i">i</dfn>;</td></tr>
<tr><th id="1952">1952</th><td></td></tr>
<tr><th id="1953">1953</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="1954">1954</th><td>		<b>for</b> (<a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> = <var>0</var>; <a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>; <a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a>++) {</td></tr>
<tr><th id="1955">1955</th><td>			<a class="local col8 ref" href="#188val" title='val' data-ref="188val" data-ref-filename="188val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5100)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1654" title="0x5100" data-ref="_M/BGE_VCPU_STATUS">BGE_VCPU_STATUS</a>);</td></tr>
<tr><th id="1956">1956</th><td>			<b>if</b> (<a class="local col8 ref" href="#188val" title='val' data-ref="188val" data-ref-filename="188val">val</a> &amp; <a class="macro" href="if_bgereg.h.html#1657" title="0x04000000" data-ref="_M/BGE_VCPU_STATUS_INIT_DONE">BGE_VCPU_STATUS_INIT_DONE</a>)</td></tr>
<tr><th id="1957">1957</th><td>				<b>break</b>;</td></tr>
<tr><th id="1958">1958</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(100)" data-ref="_M/DELAY">DELAY</a>(<var>100</var>);</td></tr>
<tr><th id="1959">1959</th><td>		}</td></tr>
<tr><th id="1960">1960</th><td>		<b>if</b> (<a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> &gt;= <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>) {</td></tr>
<tr><th id="1961">1961</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"reset timed out\n"</q>);</td></tr>
<tr><th id="1962">1962</th><td>			<b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1963">1963</th><td>		}</td></tr>
<tr><th id="1964">1964</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1965">1965</th><td>		<i>/*</i></td></tr>
<tr><th id="1966">1966</th><td><i>		 * Poll the value location we just wrote until</i></td></tr>
<tr><th id="1967">1967</th><td><i>		 * we see the 1's complement of the magic number.</i></td></tr>
<tr><th id="1968">1968</th><td><i>		 * This indicates that the firmware initialization</i></td></tr>
<tr><th id="1969">1969</th><td><i>		 * is complete.</i></td></tr>
<tr><th id="1970">1970</th><td><i>		 * XXX 1000ms for Flash and 10000ms for SEEPROM.</i></td></tr>
<tr><th id="1971">1971</th><td><i>		 */</i></td></tr>
<tr><th id="1972">1972</th><td>		<b>for</b> (<a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> = <var>0</var>; <a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>; <a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a>++) {</td></tr>
<tr><th id="1973">1973</th><td>			<a class="local col8 ref" href="#188val" title='val' data-ref="188val" data-ref-filename="188val">val</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>, <a class="macro" href="if_bgereg.h.html#75" title="0x00000B50" data-ref="_M/BGE_SRAM_FW_MB">BGE_SRAM_FW_MB</a>);</td></tr>
<tr><th id="1974">1974</th><td>			<b>if</b> (<a class="local col8 ref" href="#188val" title='val' data-ref="188val" data-ref-filename="188val">val</a> == ~<a class="macro" href="if_bgereg.h.html#2242" title="0x4B657654" data-ref="_M/BGE_SRAM_FW_MB_MAGIC">BGE_SRAM_FW_MB_MAGIC</a>)</td></tr>
<tr><th id="1975">1975</th><td>				<b>break</b>;</td></tr>
<tr><th id="1976">1976</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="1977">1977</th><td>		}</td></tr>
<tr><th id="1978">1978</th><td></td></tr>
<tr><th id="1979">1979</th><td>		<b>if</b> ((<a class="local col9 ref" href="#189i" title='i' data-ref="189i" data-ref-filename="189i">i</a> &gt;= <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a>)</td></tr>
<tr><th id="1980">1980</th><td>		    &amp;&amp; ((<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>) == <var>0</var>)) {</td></tr>
<tr><th id="1981">1981</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="1982">1982</th><td>			    <q>"firmware handshake timed out, val = %x\n"</q>, <a class="local col8 ref" href="#188val" title='val' data-ref="188val" data-ref-filename="188val">val</a>);</td></tr>
<tr><th id="1983">1983</th><td>			<b>return</b> -<var>1</var>;</td></tr>
<tr><th id="1984">1984</th><td>		}</td></tr>
<tr><th id="1985">1985</th><td>	}</td></tr>
<tr><th id="1986">1986</th><td></td></tr>
<tr><th id="1987">1987</th><td>	<b>if</b> (<a class="local col7 ref" href="#187sc" title='sc' data-ref="187sc" data-ref-filename="187sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#351" title="0x57785000" data-ref="_M/BGE_CHIPID_BCM57765_A0">BGE_CHIPID_BCM57765_A0</a>) {</td></tr>
<tr><th id="1988">1988</th><td>		<i>/* tg3 says we have to wait extra time */</i></td></tr>
<tr><th id="1989">1989</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(10 * 1000)" data-ref="_M/delay">delay</a>(<var>10</var> * <var>1000</var>);</td></tr>
<tr><th id="1990">1990</th><td>	}</td></tr>
<tr><th id="1991">1991</th><td></td></tr>
<tr><th id="1992">1992</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1993">1993</th><td>}</td></tr>
<tr><th id="1994">1994</th><td></td></tr>
<tr><th id="1995">1995</th><td><em>int</em></td></tr>
<tr><th id="1996">1996</th><td><dfn class="tu decl def fn" id="bge_phy_addr" title='bge_phy_addr' data-type='int bge_phy_addr(struct bge_softc * sc)' data-ref="bge_phy_addr" data-ref-filename="bge_phy_addr">bge_phy_addr</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="190sc" title='sc' data-type='struct bge_softc *' data-ref="190sc" data-ref-filename="190sc">sc</dfn>)</td></tr>
<tr><th id="1997">1997</th><td>{</td></tr>
<tr><th id="1998">1998</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col1 decl" id="191pa" title='pa' data-type='struct pci_attach_args *' data-ref="191pa" data-ref-filename="191pa">pa</dfn> = &amp;(<a class="local col0 ref" href="#190sc" title='sc' data-ref="190sc" data-ref-filename="190sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pa" title='bge_softc::bge_pa' data-ref="bge_softc::bge_pa" data-ref-filename="bge_softc..bge_pa">bge_pa</a>);</td></tr>
<tr><th id="1999">1999</th><td>	<em>int</em> <dfn class="local col2 decl" id="192phy_addr" title='phy_addr' data-type='int' data-ref="192phy_addr" data-ref-filename="192phy_addr">phy_addr</dfn> = <var>1</var>;</td></tr>
<tr><th id="2000">2000</th><td></td></tr>
<tr><th id="2001">2001</th><td>	<i>/*</i></td></tr>
<tr><th id="2002">2002</th><td><i>	 * PHY address mapping for various devices.</i></td></tr>
<tr><th id="2003">2003</th><td><i>	 *</i></td></tr>
<tr><th id="2004">2004</th><td><i>	 *	    | F0 Cu | F0 Sr | F1 Cu | F1 Sr |</i></td></tr>
<tr><th id="2005">2005</th><td><i>	 * ---------+-------+-------+-------+-------+</i></td></tr>
<tr><th id="2006">2006</th><td><i>	 * BCM57XX  |	1   |	X   |	X   |	X   |</i></td></tr>
<tr><th id="2007">2007</th><td><i>	 * BCM5704  |	1   |	X   |	1   |	X   |</i></td></tr>
<tr><th id="2008">2008</th><td><i>	 * BCM5717  |	1   |	8   |	2   |	9   |</i></td></tr>
<tr><th id="2009">2009</th><td><i>	 * BCM5719  |	1   |	8   |	2   |	9   |</i></td></tr>
<tr><th id="2010">2010</th><td><i>	 * BCM5720  |	1   |	8   |	2   |	9   |</i></td></tr>
<tr><th id="2011">2011</th><td><i>	 *</i></td></tr>
<tr><th id="2012">2012</th><td><i>	 *	    | F2 Cu | F2 Sr | F3 Cu | F3 Sr |</i></td></tr>
<tr><th id="2013">2013</th><td><i>	 * ---------+-------+-------+-------+-------+</i></td></tr>
<tr><th id="2014">2014</th><td><i>	 * BCM57XX  |	X   |	X   |	X   |	X   |</i></td></tr>
<tr><th id="2015">2015</th><td><i>	 * BCM5704  |	X   |	X   |	X   |	X   |</i></td></tr>
<tr><th id="2016">2016</th><td><i>	 * BCM5717  |	X   |	X   |	X   |	X   |</i></td></tr>
<tr><th id="2017">2017</th><td><i>	 * BCM5719  |	3   |	10  |	4   |	11  |</i></td></tr>
<tr><th id="2018">2018</th><td><i>	 * BCM5720  |	X   |	X   |	X   |	X   |</i></td></tr>
<tr><th id="2019">2019</th><td><i>	 *</i></td></tr>
<tr><th id="2020">2020</th><td><i>	 * Other addresses may respond but they are not</i></td></tr>
<tr><th id="2021">2021</th><td><i>	 * IEEE compliant PHYs and should be ignored.</i></td></tr>
<tr><th id="2022">2022</th><td><i>	 */</i></td></tr>
<tr><th id="2023">2023</th><td>	<b>switch</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#190sc" title='sc' data-ref="190sc" data-ref-filename="190sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>)) {</td></tr>
<tr><th id="2024">2024</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a>:</td></tr>
<tr><th id="2025">2025</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>:</td></tr>
<tr><th id="2026">2026</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>:</td></tr>
<tr><th id="2027">2027</th><td>		<a class="local col2 ref" href="#192phy_addr" title='phy_addr' data-ref="192phy_addr" data-ref-filename="192phy_addr">phy_addr</a> = <a class="local col1 ref" href="#191pa" title='pa' data-ref="191pa" data-ref-filename="191pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_function" title='pci_attach_args::pa_function' data-ref="pci_attach_args::pa_function" data-ref-filename="pci_attach_args..pa_function">pa_function</a>;</td></tr>
<tr><th id="2028">2028</th><td>		<b>if</b> (<a class="local col0 ref" href="#190sc" title='sc' data-ref="190sc" data-ref-filename="190sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#345" title="0x05717000" data-ref="_M/BGE_CHIPID_BCM5717_A0">BGE_CHIPID_BCM5717_A0</a>) {</td></tr>
<tr><th id="2029">2029</th><td>			<a class="local col2 ref" href="#192phy_addr" title='phy_addr' data-ref="192phy_addr" data-ref-filename="192phy_addr">phy_addr</a> += (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B4)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#190sc" title='sc' data-ref="190sc" data-ref-filename="190sc">sc</a>, <a class="macro" href="if_bgereg.h.html#693" title="0x05B4" data-ref="_M/BGE_SGDIG_STS">BGE_SGDIG_STS</a>) &amp;</td></tr>
<tr><th id="2030">2030</th><td>			    <a class="macro" href="if_bgereg.h.html#840" title="0x00000100" data-ref="_M/BGE_SGDIGSTS_IS_SERDES">BGE_SGDIGSTS_IS_SERDES</a>) ? <var>8</var> : <var>1</var>;</td></tr>
<tr><th id="2031">2031</th><td>		} <b>else</b> {</td></tr>
<tr><th id="2032">2032</th><td>			<a class="local col2 ref" href="#192phy_addr" title='phy_addr' data-ref="192phy_addr" data-ref-filename="192phy_addr">phy_addr</a> += (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3664)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#190sc" title='sc' data-ref="190sc" data-ref-filename="190sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1243" title="0x3664" data-ref="_M/BGE_CPMU_PHY_STRAP">BGE_CPMU_PHY_STRAP</a>) &amp;</td></tr>
<tr><th id="2033">2033</th><td>			    <a class="macro" href="if_bgereg.h.html#1282" title="0x00000020" data-ref="_M/BGE_CPMU_PHY_STRAP_IS_SERDES">BGE_CPMU_PHY_STRAP_IS_SERDES</a>) ? <var>8</var> : <var>1</var>;</td></tr>
<tr><th id="2034">2034</th><td>		}</td></tr>
<tr><th id="2035">2035</th><td>	}</td></tr>
<tr><th id="2036">2036</th><td></td></tr>
<tr><th id="2037">2037</th><td>	<b>return</b> <a class="local col2 ref" href="#192phy_addr" title='phy_addr' data-ref="192phy_addr" data-ref-filename="192phy_addr">phy_addr</a>;</td></tr>
<tr><th id="2038">2038</th><td>}</td></tr>
<tr><th id="2039">2039</th><td></td></tr>
<tr><th id="2040">2040</th><td><i  data-doc="bge_chipinit">/*</i></td></tr>
<tr><th id="2041">2041</th><td><i  data-doc="bge_chipinit"> * Do endian, PCI and DMA initialization. Also check the on-board ROM</i></td></tr>
<tr><th id="2042">2042</th><td><i  data-doc="bge_chipinit"> * self-test results.</i></td></tr>
<tr><th id="2043">2043</th><td><i  data-doc="bge_chipinit"> */</i></td></tr>
<tr><th id="2044">2044</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="2045">2045</th><td><dfn class="tu decl def fn" id="bge_chipinit" title='bge_chipinit' data-type='int bge_chipinit(struct bge_softc * sc)' data-ref="bge_chipinit" data-ref-filename="bge_chipinit">bge_chipinit</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="193sc" title='sc' data-type='struct bge_softc *' data-ref="193sc" data-ref-filename="193sc">sc</dfn>)</td></tr>
<tr><th id="2046">2046</th><td>{</td></tr>
<tr><th id="2047">2047</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="194dma_rw_ctl" title='dma_rw_ctl' data-type='uint32_t' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</dfn>, <dfn class="local col5 decl" id="195misc_ctl" title='misc_ctl' data-type='uint32_t' data-ref="195misc_ctl" data-ref-filename="195misc_ctl">misc_ctl</dfn>, <dfn class="local col6 decl" id="196mode_ctl" title='mode_ctl' data-type='uint32_t' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</dfn>, <dfn class="local col7 decl" id="197reg" title='reg' data-type='uint32_t' data-ref="197reg" data-ref-filename="197reg">reg</dfn>;</td></tr>
<tr><th id="2048">2048</th><td>	<em>int</em> <dfn class="local col8 decl" id="198i" title='i' data-type='int' data-ref="198i" data-ref-filename="198i">i</dfn>;</td></tr>
<tr><th id="2049">2049</th><td></td></tr>
<tr><th id="2050">2050</th><td>	<i>/* Set endianness before we access any non-PCI registers. */</i></td></tr>
<tr><th id="2051">2051</th><td>	<a class="local col5 ref" href="#195misc_ctl" title='misc_ctl' data-ref="195misc_ctl" data-ref-filename="195misc_ctl">misc_ctl</a> = <a class="macro" href="if_bgereg.h.html#278" title="((0x00000008)|0x00000001| 0x00000002|0x00000080| 0x00000010)" data-ref="_M/BGE_INIT">BGE_INIT</a>;</td></tr>
<tr><th id="2052">2052</th><td>	<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2682" title="0x00200000" data-ref="_M/BGEF_TAGGED_STATUS">BGEF_TAGGED_STATUS</a>)</td></tr>
<tr><th id="2053">2053</th><td>		<a class="local col5 ref" href="#195misc_ctl" title='misc_ctl' data-ref="195misc_ctl" data-ref-filename="195misc_ctl">misc_ctl</a> |= <a class="macro" href="if_bgereg.h.html#263" title="0x00000200" data-ref="_M/BGE_PCIMISCCTL_TAGGED_STATUS">BGE_PCIMISCCTL_TAGGED_STATUS</a>;</td></tr>
<tr><th id="2054">2054</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>,</td></tr>
<tr><th id="2055">2055</th><td>	    <a class="local col5 ref" href="#195misc_ctl" title='misc_ctl' data-ref="195misc_ctl" data-ref-filename="195misc_ctl">misc_ctl</a>);</td></tr>
<tr><th id="2056">2056</th><td></td></tr>
<tr><th id="2057">2057</th><td>	<i>/*</i></td></tr>
<tr><th id="2058">2058</th><td><i>	 * Clear the MAC statistics block in the NIC's</i></td></tr>
<tr><th id="2059">2059</th><td><i>	 * internal memory.</i></td></tr>
<tr><th id="2060">2060</th><td><i>	 */</i></td></tr>
<tr><th id="2061">2061</th><td>	<b>for</b> (<a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> = <a class="macro" href="if_bgereg.h.html#71" title="0x00000300" data-ref="_M/BGE_STATS_BLOCK">BGE_STATS_BLOCK</a>;</td></tr>
<tr><th id="2062">2062</th><td>	    <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#72" title="0x00000AFF" data-ref="_M/BGE_STATS_BLOCK_END">BGE_STATS_BLOCK_END</a> + <var>1</var>; <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> += <b>sizeof</b>(<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>))</td></tr>
<tr><th id="2063">2063</th><td>		<a class="macro" href="if_bgereg.h.html#2229" title="do { pci_conf_write(sc-&gt;sc_pc, sc-&gt;sc_pcitag, 0x7C, (0xFFFF0000 &amp; i)); bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x00008000 + (i &amp; 0xFFFF), 0); } while(0)" data-ref="_M/BGE_MEMWIN_WRITE">BGE_MEMWIN_WRITE</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a>, <var>0</var>);</td></tr>
<tr><th id="2064">2064</th><td></td></tr>
<tr><th id="2065">2065</th><td>	<b>for</b> (<a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> = <a class="macro" href="if_bgereg.h.html#73" title="0x00000B00" data-ref="_M/BGE_STATUS_BLOCK">BGE_STATUS_BLOCK</a>;</td></tr>
<tr><th id="2066">2066</th><td>	    <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#74" title="0x00000B4F" data-ref="_M/BGE_STATUS_BLOCK_END">BGE_STATUS_BLOCK_END</a> + <var>1</var>; <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a> += <b>sizeof</b>(<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>))</td></tr>
<tr><th id="2067">2067</th><td>		<a class="macro" href="if_bgereg.h.html#2229" title="do { pci_conf_write(sc-&gt;sc_pc, sc-&gt;sc_pcitag, 0x7C, (0xFFFF0000 &amp; i)); bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x00008000 + (i &amp; 0xFFFF), 0); } while(0)" data-ref="_M/BGE_MEMWIN_WRITE">BGE_MEMWIN_WRITE</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col8 ref" href="#198i" title='i' data-ref="198i" data-ref-filename="198i">i</a>, <var>0</var>);</td></tr>
<tr><th id="2068">2068</th><td></td></tr>
<tr><th id="2069">2069</th><td>	<i>/* 5717 workaround from tg3 */</i></td></tr>
<tr><th id="2070">2070</th><td>	<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#345" title="0x05717000" data-ref="_M/BGE_CHIPID_BCM5717_A0">BGE_CHIPID_BCM5717_A0</a>) {</td></tr>
<tr><th id="2071">2071</th><td>		<i>/* Save */</i></td></tr>
<tr><th id="2072">2072</th><td>		<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>);</td></tr>
<tr><th id="2073">2073</th><td></td></tr>
<tr><th id="2074">2074</th><td>		<i>/* Temporary modify MODE_CTL to control TLP */</i></td></tr>
<tr><th id="2075">2075</th><td>		<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> &amp; ~<a class="macro" href="if_bgereg.h.html#2034" title="(0x80000000 | 0x00400000 | 0x20000000)" data-ref="_M/BGE_MODECTL_PCIE_TLPADDRMASK">BGE_MODECTL_PCIE_TLPADDRMASK</a>;</td></tr>
<tr><th id="2076">2076</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, reg | 0x00400000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#2023" title="0x00400000" data-ref="_M/BGE_MODECTL_PCIE_TLPADDR1">BGE_MODECTL_PCIE_TLPADDR1</a>);</td></tr>
<tr><th id="2077">2077</th><td></td></tr>
<tr><th id="2078">2078</th><td>		<i>/* Control TLP */</i></td></tr>
<tr><th id="2079">2079</th><td>		<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x0004)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> +</td></tr>
<tr><th id="2080">2080</th><td>		    <a class="macro" href="if_bgereg.h.html#1969" title="0x0004" data-ref="_M/BGE_TLP_PHYCTL1">BGE_TLP_PHYCTL1</a>);</td></tr>
<tr><th id="2081">2081</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x0004, reg | 0x00001000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> + <a class="macro" href="if_bgereg.h.html#1969" title="0x0004" data-ref="_M/BGE_TLP_PHYCTL1">BGE_TLP_PHYCTL1</a>,</td></tr>
<tr><th id="2082">2082</th><td>		    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#1970" title="0x00001000" data-ref="_M/BGE_TLP_PHYCTL1_EN_L1PLLPD">BGE_TLP_PHYCTL1_EN_L1PLLPD</a>);</td></tr>
<tr><th id="2083">2083</th><td></td></tr>
<tr><th id="2084">2084</th><td>		<i>/* Restore */</i></td></tr>
<tr><th id="2085">2085</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, mode_ctl)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a>);</td></tr>
<tr><th id="2086">2086</th><td>	}</td></tr>
<tr><th id="2087">2087</th><td></td></tr>
<tr><th id="2088">2088</th><td>	<b>if</b> (<a class="macro" href="#415" title="((sc)-&gt;bge_flags &amp; 0x00040000)" data-ref="_M/BGE_IS_57765_FAMILY">BGE_IS_57765_FAMILY</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>)) {</td></tr>
<tr><th id="2089">2089</th><td>		<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#351" title="0x57785000" data-ref="_M/BGE_CHIPID_BCM57765_A0">BGE_CHIPID_BCM57765_A0</a>) {</td></tr>
<tr><th id="2090">2090</th><td>			<i>/* Save */</i></td></tr>
<tr><th id="2091">2091</th><td>			<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>);</td></tr>
<tr><th id="2092">2092</th><td></td></tr>
<tr><th id="2093">2093</th><td>			<i>/* Temporary modify MODE_CTL to control TLP */</i></td></tr>
<tr><th id="2094">2094</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> &amp; ~<a class="macro" href="if_bgereg.h.html#2034" title="(0x80000000 | 0x00400000 | 0x20000000)" data-ref="_M/BGE_MODECTL_PCIE_TLPADDRMASK">BGE_MODECTL_PCIE_TLPADDRMASK</a>;</td></tr>
<tr><th id="2095">2095</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, reg | 0x00400000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>,</td></tr>
<tr><th id="2096">2096</th><td>			    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#2023" title="0x00400000" data-ref="_M/BGE_MODECTL_PCIE_TLPADDR1">BGE_MODECTL_PCIE_TLPADDR1</a>);</td></tr>
<tr><th id="2097">2097</th><td></td></tr>
<tr><th id="2098">2098</th><td>			<i>/* Control TLP */</i></td></tr>
<tr><th id="2099">2099</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x0014)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> +</td></tr>
<tr><th id="2100">2100</th><td>			    <a class="macro" href="if_bgereg.h.html#1971" title="0x0014" data-ref="_M/BGE_TLP_PHYCTL5">BGE_TLP_PHYCTL5</a>);</td></tr>
<tr><th id="2101">2101</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x0014, reg | 0x80000000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> + <a class="macro" href="if_bgereg.h.html#1971" title="0x0014" data-ref="_M/BGE_TLP_PHYCTL5">BGE_TLP_PHYCTL5</a>,</td></tr>
<tr><th id="2102">2102</th><td>			    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#1972" title="0x80000000" data-ref="_M/BGE_TLP_PHYCTL5_DIS_L2CLKREQ">BGE_TLP_PHYCTL5_DIS_L2CLKREQ</a>);</td></tr>
<tr><th id="2103">2103</th><td></td></tr>
<tr><th id="2104">2104</th><td>			<i>/* Restore */</i></td></tr>
<tr><th id="2105">2105</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, mode_ctl)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a>);</td></tr>
<tr><th id="2106">2106</th><td>		}</td></tr>
<tr><th id="2107">2107</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#395" title="0x577850" data-ref="_M/BGE_CHIPREV_57765_AX">BGE_CHIPREV_57765_AX</a>) {</td></tr>
<tr><th id="2108">2108</th><td>			<i>/*</i></td></tr>
<tr><th id="2109">2109</th><td><i>			 * For the 57766 and non Ax versions of 57765, bootcode</i></td></tr>
<tr><th id="2110">2110</th><td><i>			 * needs to setup the PCIE Fast Training Sequence (FTS)</i></td></tr>
<tr><th id="2111">2111</th><td><i>			 * value to prevent transmit hangs.</i></td></tr>
<tr><th id="2112">2112</th><td><i>			 */</i></td></tr>
<tr><th id="2113">2113</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3668)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1244" title="0x3668" data-ref="_M/BGE_CPMU_PADRNG_CTL">BGE_CPMU_PADRNG_CTL</a>);</td></tr>
<tr><th id="2114">2114</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3668, reg | 0x00040000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1244" title="0x3668" data-ref="_M/BGE_CPMU_PADRNG_CTL">BGE_CPMU_PADRNG_CTL</a>,</td></tr>
<tr><th id="2115">2115</th><td>			    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#1285" title="0x00040000" data-ref="_M/BGE_CPMU_PADRNG_CTL_RDIV2">BGE_CPMU_PADRNG_CTL_RDIV2</a>);</td></tr>
<tr><th id="2116">2116</th><td></td></tr>
<tr><th id="2117">2117</th><td>			<i>/* Save */</i></td></tr>
<tr><th id="2118">2118</th><td>			<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>);</td></tr>
<tr><th id="2119">2119</th><td></td></tr>
<tr><th id="2120">2120</th><td>			<i>/* Temporary modify MODE_CTL to control TLP */</i></td></tr>
<tr><th id="2121">2121</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> &amp; ~<a class="macro" href="if_bgereg.h.html#2034" title="(0x80000000 | 0x00400000 | 0x20000000)" data-ref="_M/BGE_MODECTL_PCIE_TLPADDRMASK">BGE_MODECTL_PCIE_TLPADDRMASK</a>;</td></tr>
<tr><th id="2122">2122</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, reg | 0x20000000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>,</td></tr>
<tr><th id="2123">2123</th><td>			    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#2031" title="0x20000000" data-ref="_M/BGE_MODECTL_PCIE_TLPADDR0">BGE_MODECTL_PCIE_TLPADDR0</a>);</td></tr>
<tr><th id="2124">2124</th><td></td></tr>
<tr><th id="2125">2125</th><td>			<i>/* Control TLP */</i></td></tr>
<tr><th id="2126">2126</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x000c)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> +</td></tr>
<tr><th id="2127">2127</th><td>			    <a class="macro" href="if_bgereg.h.html#1966" title="0x000c" data-ref="_M/BGE_TLP_FTSMAX">BGE_TLP_FTSMAX</a>);</td></tr>
<tr><th id="2128">2128</th><td>			<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1967" title="0x000000ff" data-ref="_M/BGE_TLP_FTSMAX_MSK">BGE_TLP_FTSMAX_MSK</a>;</td></tr>
<tr><th id="2129">2129</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00 + 0x000c, reg | 0x0000002c)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a> + <a class="macro" href="if_bgereg.h.html#1966" title="0x000c" data-ref="_M/BGE_TLP_FTSMAX">BGE_TLP_FTSMAX</a>,</td></tr>
<tr><th id="2130">2130</th><td>			    <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> | <a class="macro" href="if_bgereg.h.html#1968" title="0x0000002c" data-ref="_M/BGE_TLP_FTSMAX_VAL">BGE_TLP_FTSMAX_VAL</a>);</td></tr>
<tr><th id="2131">2131</th><td></td></tr>
<tr><th id="2132">2132</th><td>			<i>/* Restore */</i></td></tr>
<tr><th id="2133">2133</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, mode_ctl)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a>);</td></tr>
<tr><th id="2134">2134</th><td>		}</td></tr>
<tr><th id="2135">2135</th><td></td></tr>
<tr><th id="2136">2136</th><td>		<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3604)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1235" title="0x3604" data-ref="_M/BGE_CPMU_LSPD_10MB_CLK">BGE_CPMU_LSPD_10MB_CLK</a>);</td></tr>
<tr><th id="2137">2137</th><td>		<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1253" title="0x001F0000" data-ref="_M/BGE_CPMU_LSPD_10MB_MACCLK_MASK">BGE_CPMU_LSPD_10MB_MACCLK_MASK</a>;</td></tr>
<tr><th id="2138">2138</th><td>		<a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a> |= <a class="macro" href="if_bgereg.h.html#1254" title="0x00130000" data-ref="_M/BGE_CPMU_LSPD_10MB_MACCLK_6_25">BGE_CPMU_LSPD_10MB_MACCLK_6_25</a>;</td></tr>
<tr><th id="2139">2139</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3604, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1235" title="0x3604" data-ref="_M/BGE_CPMU_LSPD_10MB_CLK">BGE_CPMU_LSPD_10MB_CLK</a>, <a class="local col7 ref" href="#197reg" title='reg' data-ref="197reg" data-ref-filename="197reg">reg</a>);</td></tr>
<tr><th id="2140">2140</th><td>	}</td></tr>
<tr><th id="2141">2141</th><td></td></tr>
<tr><th id="2142">2142</th><td>	<i>/* Set up the PCI DMA control register. */</i></td></tr>
<tr><th id="2143">2143</th><td>	<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> = <a class="macro" href="if_bgereg.h.html#2437" title="0x06000000" data-ref="_M/BGE_PCI_READ_CMD">BGE_PCI_READ_CMD</a> | <a class="macro" href="if_bgereg.h.html#2438" title="0x70000000" data-ref="_M/BGE_PCI_WRITE_CMD">BGE_PCI_WRITE_CMD</a>;</td></tr>
<tr><th id="2144">2144</th><td>	<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>) {</td></tr>
<tr><th id="2145">2145</th><td>		<i>/* Read watermark not used, 128 bytes for write. */</i></td></tr>
<tr><th id="2146">2146</th><td>		<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>4</var>, (<q>"(%s: PCI-Express DMA setting)\n"</q>,</td></tr>
<tr><th id="2147">2147</th><td>		    device_xname(sc-&gt;bge_dev)));</td></tr>
<tr><th id="2148">2148</th><td>		<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mps" title='bge_softc::bge_mps' data-ref="bge_softc::bge_mps" data-ref-filename="bge_softc..bge_mps">bge_mps</a> &gt;= <var>256</var>)</td></tr>
<tr><th id="2149">2149</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#413" title="((7) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>7</var>);</td></tr>
<tr><th id="2150">2150</th><td>		<b>else</b></td></tr>
<tr><th id="2151">2151</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#413" title="((3) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>3</var>);</td></tr>
<tr><th id="2152">2152</th><td>	} <b>else</b> <b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>) {</td></tr>
<tr><th id="2153">2153</th><td>		<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>4</var>, (<q>"(:%s: PCI-X DMA setting)\n"</q>,</td></tr>
<tr><th id="2154">2154</th><td>		    device_xname(sc-&gt;bge_dev)));</td></tr>
<tr><th id="2155">2155</th><td>		<i>/* PCI-X bus */</i></td></tr>
<tr><th id="2156">2156</th><td>		<b>if</b> (<a class="macro" href="#412" title="((sc)-&gt;bge_flags &amp; 0x00010000)" data-ref="_M/BGE_IS_5714_FAMILY">BGE_IS_5714_FAMILY</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>)) {</td></tr>
<tr><th id="2157">2157</th><td>			<i>/* 256 bytes for read and write. */</i></td></tr>
<tr><th id="2158">2158</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#412" title="((2) &lt;&lt; 16)" data-ref="_M/BGE_PCIDMARWCTL_RD_WAT_SHIFT">BGE_PCIDMARWCTL_RD_WAT_SHIFT</a>(<var>2</var>) |</td></tr>
<tr><th id="2159">2159</th><td>			    <a class="macro" href="if_bgereg.h.html#413" title="((2) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>2</var>);</td></tr>
<tr><th id="2160">2160</th><td></td></tr>
<tr><th id="2161">2161</th><td>			<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#366" title="0x08" data-ref="_M/BGE_ASICREV_BCM5780">BGE_ASICREV_BCM5780</a>)</td></tr>
<tr><th id="2162">2162</th><td>				<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#403" title="0x00004000" data-ref="_M/BGE_PCIDMARWCTL_ONEDMA_ATONCE_GLOBAL">BGE_PCIDMARWCTL_ONEDMA_ATONCE_GLOBAL</a>;</td></tr>
<tr><th id="2163">2163</th><td>			<b>else</b></td></tr>
<tr><th id="2164">2164</th><td>				<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#404" title="0x00008000" data-ref="_M/BGE_PCIDMARWCTL_ONEDMA_ATONCE_LOCAL">BGE_PCIDMARWCTL_ONEDMA_ATONCE_LOCAL</a>;</td></tr>
<tr><th id="2165">2165</th><td>		} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a>) {</td></tr>
<tr><th id="2166">2166</th><td>			<i>/*</i></td></tr>
<tr><th id="2167">2167</th><td><i>			 * In the BCM5703, the DMA read watermark should</i></td></tr>
<tr><th id="2168">2168</th><td><i>			 * be set to less than or equal to the maximum</i></td></tr>
<tr><th id="2169">2169</th><td><i>			 * memory read byte count of the PCI-X command</i></td></tr>
<tr><th id="2170">2170</th><td><i>			 * register.</i></td></tr>
<tr><th id="2171">2171</th><td><i>			 */</i></td></tr>
<tr><th id="2172">2172</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#412" title="((4) &lt;&lt; 16)" data-ref="_M/BGE_PCIDMARWCTL_RD_WAT_SHIFT">BGE_PCIDMARWCTL_RD_WAT_SHIFT</a>(<var>4</var>) |</td></tr>
<tr><th id="2173">2173</th><td>			    <a class="macro" href="if_bgereg.h.html#413" title="((3) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>3</var>);</td></tr>
<tr><th id="2174">2174</th><td>		} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>) {</td></tr>
<tr><th id="2175">2175</th><td>			<i>/* 1536 bytes for read, 384 bytes for write. */</i></td></tr>
<tr><th id="2176">2176</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#412" title="((7) &lt;&lt; 16)" data-ref="_M/BGE_PCIDMARWCTL_RD_WAT_SHIFT">BGE_PCIDMARWCTL_RD_WAT_SHIFT</a>(<var>7</var>) |</td></tr>
<tr><th id="2177">2177</th><td>			    <a class="macro" href="if_bgereg.h.html#413" title="((3) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>3</var>);</td></tr>
<tr><th id="2178">2178</th><td>		} <b>else</b> {</td></tr>
<tr><th id="2179">2179</th><td>			<i>/* 384 bytes for read and write. */</i></td></tr>
<tr><th id="2180">2180</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#412" title="((3) &lt;&lt; 16)" data-ref="_M/BGE_PCIDMARWCTL_RD_WAT_SHIFT">BGE_PCIDMARWCTL_RD_WAT_SHIFT</a>(<var>3</var>) |</td></tr>
<tr><th id="2181">2181</th><td>			    <a class="macro" href="if_bgereg.h.html#413" title="((3) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>3</var>) |</td></tr>
<tr><th id="2182">2182</th><td>			    (<var>0x0F</var>);</td></tr>
<tr><th id="2183">2183</th><td>		}</td></tr>
<tr><th id="2184">2184</th><td></td></tr>
<tr><th id="2185">2185</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a> ||</td></tr>
<tr><th id="2186">2186</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>) {</td></tr>
<tr><th id="2187">2187</th><td>			<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="199tmp" title='tmp' data-type='uint32_t' data-ref="199tmp" data-ref-filename="199tmp">tmp</dfn>;</td></tr>
<tr><th id="2188">2188</th><td></td></tr>
<tr><th id="2189">2189</th><td>			<i>/* Set ONEDMA_ATONCE for hardware workaround. */</i></td></tr>
<tr><th id="2190">2190</th><td>			<a class="local col9 ref" href="#199tmp" title='tmp' data-ref="199tmp" data-ref-filename="199tmp">tmp</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x74)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#232" title="0x74" data-ref="_M/BGE_PCI_CLKCTL">BGE_PCI_CLKCTL</a>) &amp; <var>0x1f</var>;</td></tr>
<tr><th id="2191">2191</th><td>			<b>if</b> (<a class="local col9 ref" href="#199tmp" title='tmp' data-ref="199tmp" data-ref-filename="199tmp">tmp</a> == <var>6</var> || <a class="local col9 ref" href="#199tmp" title='tmp' data-ref="199tmp" data-ref-filename="199tmp">tmp</a> == <var>7</var>)</td></tr>
<tr><th id="2192">2192</th><td>				<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |=</td></tr>
<tr><th id="2193">2193</th><td>				    <a class="macro" href="if_bgereg.h.html#403" title="0x00004000" data-ref="_M/BGE_PCIDMARWCTL_ONEDMA_ATONCE_GLOBAL">BGE_PCIDMARWCTL_ONEDMA_ATONCE_GLOBAL</a>;</td></tr>
<tr><th id="2194">2194</th><td></td></tr>
<tr><th id="2195">2195</th><td>			<i>/* Set PCI-X DMA write workaround. */</i></td></tr>
<tr><th id="2196">2196</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#408" title="0x00800000" data-ref="_M/BGE_PCIDMARWCTL_ASRT_ALL_BE">BGE_PCIDMARWCTL_ASRT_ALL_BE</a>;</td></tr>
<tr><th id="2197">2197</th><td>		}</td></tr>
<tr><th id="2198">2198</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2199">2199</th><td>		<i>/* Conventional PCI bus: 256 bytes for read and write. */</i></td></tr>
<tr><th id="2200">2200</th><td>		<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>4</var>, (<q>"(%s: PCI 2.2 DMA setting)\n"</q>,</td></tr>
<tr><th id="2201">2201</th><td>		    device_xname(sc-&gt;bge_dev)));</td></tr>
<tr><th id="2202">2202</th><td>		<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#412" title="((7) &lt;&lt; 16)" data-ref="_M/BGE_PCIDMARWCTL_RD_WAT_SHIFT">BGE_PCIDMARWCTL_RD_WAT_SHIFT</a>(<var>7</var>) |</td></tr>
<tr><th id="2203">2203</th><td>		    <a class="macro" href="if_bgereg.h.html#413" title="((7) &lt;&lt; 19)" data-ref="_M/BGE_PCIDMARWCTL_WR_WAT_SHIFT">BGE_PCIDMARWCTL_WR_WAT_SHIFT</a>(<var>7</var>);</td></tr>
<tr><th id="2204">2204</th><td></td></tr>
<tr><th id="2205">2205</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a> &amp;&amp;</td></tr>
<tr><th id="2206">2206</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#362" title="0x04" data-ref="_M/BGE_ASICREV_BCM5750">BGE_ASICREV_BCM5750</a>)</td></tr>
<tr><th id="2207">2207</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <var>0x0F</var>;</td></tr>
<tr><th id="2208">2208</th><td>	}</td></tr>
<tr><th id="2209">2209</th><td></td></tr>
<tr><th id="2210">2210</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> ||</td></tr>
<tr><th id="2211">2211</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a>)</td></tr>
<tr><th id="2212">2212</th><td>		<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#407" title="0x00400000" data-ref="_M/BGE_PCIDMARWCTL_USE_MRM">BGE_PCIDMARWCTL_USE_MRM</a> |</td></tr>
<tr><th id="2213">2213</th><td>		    <a class="macro" href="if_bgereg.h.html#408" title="0x00800000" data-ref="_M/BGE_PCIDMARWCTL_ASRT_ALL_BE">BGE_PCIDMARWCTL_ASRT_ALL_BE</a>;</td></tr>
<tr><th id="2214">2214</th><td></td></tr>
<tr><th id="2215">2215</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a> ||</td></tr>
<tr><th id="2216">2216</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>)</td></tr>
<tr><th id="2217">2217</th><td>		<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#398" title="0x000000FF" data-ref="_M/BGE_PCIDMARWCTL_MINDMA">BGE_PCIDMARWCTL_MINDMA</a>;</td></tr>
<tr><th id="2218">2218</th><td></td></tr>
<tr><th id="2219">2219</th><td>	<b>if</b> (<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>)) {</td></tr>
<tr><th id="2220">2220</th><td>		<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#399" title="0x00000001" data-ref="_M/BGE_PCIDMARWCTL_DIS_CACHE_ALIGNMENT">BGE_PCIDMARWCTL_DIS_CACHE_ALIGNMENT</a>;</td></tr>
<tr><th id="2221">2221</th><td>		<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#351" title="0x57785000" data-ref="_M/BGE_CHIPID_BCM57765_A0">BGE_CHIPID_BCM57765_A0</a>)</td></tr>
<tr><th id="2222">2222</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#418" title="0x00000380" data-ref="_M/BGE_PCIDMARWCTL_CRDRDR_RDMA_MRRS_MSK">BGE_PCIDMARWCTL_CRDRDR_RDMA_MRRS_MSK</a>;</td></tr>
<tr><th id="2223">2223</th><td></td></tr>
<tr><th id="2224">2224</th><td>		<i>/*</i></td></tr>
<tr><th id="2225">2225</th><td><i>		 * Enable HW workaround for controllers that misinterpret</i></td></tr>
<tr><th id="2226">2226</th><td><i>		 * a status tag update and leave interrupts permanently</i></td></tr>
<tr><th id="2227">2227</th><td><i>		 * disabled.</i></td></tr>
<tr><th id="2228">2228</th><td><i>		 */</i></td></tr>
<tr><th id="2229">2229</th><td>		<b>if</b> (!<a class="macro" href="#415" title="((sc)-&gt;bge_flags &amp; 0x00040000)" data-ref="_M/BGE_IS_57765_FAMILY">BGE_IS_57765_FAMILY</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="2230">2230</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> &amp;&amp;</td></tr>
<tr><th id="2231">2231</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>)</td></tr>
<tr><th id="2232">2232</th><td>			<a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a> |= <a class="macro" href="if_bgereg.h.html#417" title="0x00000080" data-ref="_M/BGE_PCIDMARWCTL_TAGGED_STATUS_WA">BGE_PCIDMARWCTL_TAGGED_STATUS_WA</a>;</td></tr>
<tr><th id="2233">2233</th><td>	}</td></tr>
<tr><th id="2234">2234</th><td></td></tr>
<tr><th id="2235">2235</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#230" title="0x6C" data-ref="_M/BGE_PCI_DMA_RW_CTL">BGE_PCI_DMA_RW_CTL</a>,</td></tr>
<tr><th id="2236">2236</th><td>	    <a class="local col4 ref" href="#194dma_rw_ctl" title='dma_rw_ctl' data-ref="194dma_rw_ctl" data-ref-filename="194dma_rw_ctl">dma_rw_ctl</a>);</td></tr>
<tr><th id="2237">2237</th><td></td></tr>
<tr><th id="2238">2238</th><td>	<i>/*</i></td></tr>
<tr><th id="2239">2239</th><td><i>	 * Set up general mode register.</i></td></tr>
<tr><th id="2240">2240</th><td><i>	 */</i></td></tr>
<tr><th id="2241">2241</th><td>	<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> = <a class="macro" href="if_bgereg.h.html#269" title="0x00000004| 0x00000010|0x00000020" data-ref="_M/BGE_DMA_SWAP_OPTIONS">BGE_DMA_SWAP_OPTIONS</a>;</td></tr>
<tr><th id="2242">2242</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a> ||</td></tr>
<tr><th id="2243">2243</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="2244">2244</th><td>		<i>/* Retain Host-2-BMC settings written by APE firmware. */</i></td></tr>
<tr><th id="2245">2245</th><td>		<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> |= <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>) &amp;</td></tr>
<tr><th id="2246">2246</th><td>		    (<a class="macro" href="if_bgereg.h.html#2010" title="0x00000040" data-ref="_M/BGE_MODECTL_BYTESWAP_B2HRX_DATA">BGE_MODECTL_BYTESWAP_B2HRX_DATA</a> |</td></tr>
<tr><th id="2247">2247</th><td>		    <a class="macro" href="if_bgereg.h.html#2011" title="0x00000080" data-ref="_M/BGE_MODECTL_WORDSWAP_B2HRX_DATA">BGE_MODECTL_WORDSWAP_B2HRX_DATA</a> |</td></tr>
<tr><th id="2248">2248</th><td>		    <a class="macro" href="if_bgereg.h.html#2018" title="0x00008000" data-ref="_M/BGE_MODECTL_B2HRX_ENABLE">BGE_MODECTL_B2HRX_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#2021" title="0x00040000" data-ref="_M/BGE_MODECTL_HTX2B_ENABLE">BGE_MODECTL_HTX2B_ENABLE</a>);</td></tr>
<tr><th id="2249">2249</th><td>	}</td></tr>
<tr><th id="2250">2250</th><td>	<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> |= <a class="macro" href="if_bgereg.h.html#2027" title="0x04000000" data-ref="_M/BGE_MODECTL_MAC_ATTN_INTR">BGE_MODECTL_MAC_ATTN_INTR</a> | <a class="macro" href="if_bgereg.h.html#2020" title="0x00020000" data-ref="_M/BGE_MODECTL_HOST_SEND_BDS">BGE_MODECTL_HOST_SEND_BDS</a> |</td></tr>
<tr><th id="2251">2251</th><td>	    <a class="macro" href="if_bgereg.h.html#2022" title="0x00100000" data-ref="_M/BGE_MODECTL_TX_NO_PHDR_CSUM">BGE_MODECTL_TX_NO_PHDR_CSUM</a>;</td></tr>
<tr><th id="2252">2252</th><td></td></tr>
<tr><th id="2253">2253</th><td>	<i>/*</i></td></tr>
<tr><th id="2254">2254</th><td><i>	 * BCM5701 B5 have a bug causing data corruption when using</i></td></tr>
<tr><th id="2255">2255</th><td><i>	 * 64-bit DMA reads, which can be terminated early and then</i></td></tr>
<tr><th id="2256">2256</th><td><i>	 * completed later as 32-bit accesses, in combination with</i></td></tr>
<tr><th id="2257">2257</th><td><i>	 * certain bridges.</i></td></tr>
<tr><th id="2258">2258</th><td><i>	 */</i></td></tr>
<tr><th id="2259">2259</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a> &amp;&amp;</td></tr>
<tr><th id="2260">2260</th><td>	    <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#296" title="0x0105" data-ref="_M/BGE_CHIPID_BCM5701_B5">BGE_CHIPID_BCM5701_B5</a>)</td></tr>
<tr><th id="2261">2261</th><td>		<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> |= <a class="macro" href="if_bgereg.h.html#2017" title="0x00008000" data-ref="_M/BGE_MODECTL_FORCE_PCI32">BGE_MODECTL_FORCE_PCI32</a>;</td></tr>
<tr><th id="2262">2262</th><td></td></tr>
<tr><th id="2263">2263</th><td>	<i>/*</i></td></tr>
<tr><th id="2264">2264</th><td><i>	 * Tell the firmware the driver is running</i></td></tr>
<tr><th id="2265">2265</th><td><i>	 */</i></td></tr>
<tr><th id="2266">2266</th><td>	<b>if</b> (<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#259" title="4" data-ref="_M/ASF_STACKUP">ASF_STACKUP</a>)</td></tr>
<tr><th id="2267">2267</th><td>		<a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a> |= <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>;</td></tr>
<tr><th id="2268">2268</th><td></td></tr>
<tr><th id="2269">2269</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, mode_ctl)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="local col6 ref" href="#196mode_ctl" title='mode_ctl' data-ref="196mode_ctl" data-ref-filename="196mode_ctl">mode_ctl</a>);</td></tr>
<tr><th id="2270">2270</th><td></td></tr>
<tr><th id="2271">2271</th><td>	<i>/*</i></td></tr>
<tr><th id="2272">2272</th><td><i>	 * Disable memory write invalidate.  Apparently it is not supported</i></td></tr>
<tr><th id="2273">2273</th><td><i>	 * properly by these devices.</i></td></tr>
<tr><th id="2274">2274</th><td><i>	 */</i></td></tr>
<tr><th id="2275">2275</th><td>	<a class="macro" href="if_bgevar.h.html#144" title="pci_conf_write(sc-&gt;sc_pc, sc-&gt;sc_pcitag, 0x04, (pci_conf_read(sc-&gt;sc_pc, sc-&gt;sc_pcitag, 0x04) &amp; ~(0x00000010)))" data-ref="_M/PCI_CLRBIT">PCI_CLRBIT</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#73" title="0x04" data-ref="_M/PCI_COMMAND_STATUS_REG">PCI_COMMAND_STATUS_REG</a>,</td></tr>
<tr><th id="2276">2276</th><td>		   <a class="macro" href="pcireg.h.html#87" title="0x00000010" data-ref="_M/PCI_COMMAND_INVALIDATE_ENABLE">PCI_COMMAND_INVALIDATE_ENABLE</a>);</td></tr>
<tr><th id="2277">2277</th><td></td></tr>
<tr><th id="2278">2278</th><td><u>#<span data-ppcond="2278">ifdef</span> <span class="macro" data-ref="_M/__brokenalpha__">__brokenalpha__</span></u></td></tr>
<tr><th id="2279">2279</th><td>	<i>/*</i></td></tr>
<tr><th id="2280">2280</th><td><i>	 * Must insure that we do not cross an 8K (bytes) boundary</i></td></tr>
<tr><th id="2281">2281</th><td><i>	 * for DMA reads.  Our highest limit is 1K bytes.  This is a</i></td></tr>
<tr><th id="2282">2282</th><td><i>	 * restriction on some ALPHA platforms with early revision</i></td></tr>
<tr><th id="2283">2283</th><td><i>	 * 21174 PCI chipsets, such as the AlphaPC 164lx</i></td></tr>
<tr><th id="2284">2284</th><td><i>	 */</i></td></tr>
<tr><th id="2285">2285</th><td>	PCI_SETBIT(sc, BGE_PCI_DMA_RW_CTL, BGE_PCI_READ_BNDRY_1024, <var>4</var>);</td></tr>
<tr><th id="2286">2286</th><td><u>#<span data-ppcond="2278">endif</span></u></td></tr>
<tr><th id="2287">2287</th><td></td></tr>
<tr><th id="2288">2288</th><td>	<i>/* Set the timer prescaler (always 66MHz) */</i></td></tr>
<tr><th id="2289">2289</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804, (0x41 &lt;&lt; 1))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>, <a class="macro" href="if_bgereg.h.html#2048" title="(0x41 &lt;&lt; 1)" data-ref="_M/BGE_32BITTIME_66MHZ">BGE_32BITTIME_66MHZ</a>);</td></tr>
<tr><th id="2290">2290</th><td></td></tr>
<tr><th id="2291">2291</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="2292">2292</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);	<i>/* XXX */</i></td></tr>
<tr><th id="2293">2293</th><td></td></tr>
<tr><th id="2294">2294</th><td>		<i>/* Put PHY into ready state */</i></td></tr>
<tr><th id="2295">2295</th><td>		<a class="macro" href="if_bgevar.h.html#118" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804) &amp; ~(0x00200000))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804); } while(0)" data-ref="_M/BGE_CLRBIT_FLUSH">BGE_CLRBIT_FLUSH</a>(<a class="local col3 ref" href="#193sc" title='sc' data-ref="193sc" data-ref-filename="193sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>, <a class="macro" href="if_bgereg.h.html#2044" title="0x00200000" data-ref="_M/BGE_MISCCFG_EPHY_IDDQ">BGE_MISCCFG_EPHY_IDDQ</a>);</td></tr>
<tr><th id="2296">2296</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="2297">2297</th><td>	}</td></tr>
<tr><th id="2298">2298</th><td></td></tr>
<tr><th id="2299">2299</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2300">2300</th><td>}</td></tr>
<tr><th id="2301">2301</th><td></td></tr>
<tr><th id="2302">2302</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="2303">2303</th><td><dfn class="tu decl def fn" id="bge_blockinit" title='bge_blockinit' data-type='int bge_blockinit(struct bge_softc * sc)' data-ref="bge_blockinit" data-ref-filename="bge_blockinit">bge_blockinit</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="200sc" title='sc' data-type='struct bge_softc *' data-ref="200sc" data-ref-filename="200sc">sc</dfn>)</td></tr>
<tr><th id="2304">2304</th><td>{</td></tr>
<tr><th id="2305">2305</th><td>	<em>volatile</em> <b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rcb" title='bge_rcb' data-ref="bge_rcb" data-ref-filename="bge_rcb">bge_rcb</a>	 *<dfn class="local col1 decl" id="201rcb" title='rcb' data-type='volatile struct bge_rcb *' data-ref="201rcb" data-ref-filename="201rcb">rcb</dfn>;</td></tr>
<tr><th id="2306">2306</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_size_t" title='bus_size_t' data-type='size_t' data-ref="bus_size_t" data-ref-filename="bus_size_t">bus_size_t</a> <dfn class="local col2 decl" id="202rcb_addr" title='rcb_addr' data-type='bus_size_t' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</dfn>;</td></tr>
<tr><th id="2307">2307</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col3 decl" id="203ifp" title='ifp' data-type='struct ifnet *' data-ref="203ifp" data-ref-filename="203ifp">ifp</dfn> = &amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="2308">2308</th><td>	<a class="typedef" href="if_bgereg.h.html#bge_hostaddr" title='bge_hostaddr' data-type='struct bge_hostaddr' data-ref="bge_hostaddr" data-ref-filename="bge_hostaddr">bge_hostaddr</a> <dfn class="local col4 decl" id="204taddr" title='taddr' data-type='bge_hostaddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</dfn>;</td></tr>
<tr><th id="2309">2309</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>	<dfn class="local col5 decl" id="205dmactl" title='dmactl' data-type='uint32_t' data-ref="205dmactl" data-ref-filename="205dmactl">dmactl</dfn>, <dfn class="local col6 decl" id="206rdmareg" title='rdmareg' data-type='uint32_t' data-ref="206rdmareg" data-ref-filename="206rdmareg">rdmareg</dfn>, <dfn class="local col7 decl" id="207mimode" title='mimode' data-type='uint32_t' data-ref="207mimode" data-ref-filename="207mimode">mimode</dfn>, <dfn class="local col8 decl" id="208val" title='val' data-type='uint32_t' data-ref="208val" data-ref-filename="208val">val</dfn>;</td></tr>
<tr><th id="2310">2310</th><td>	<em>int</em>		<dfn class="local col9 decl" id="209i" title='i' data-type='int' data-ref="209i" data-ref-filename="209i">i</dfn>, <dfn class="local col0 decl" id="210limit" title='limit' data-type='int' data-ref="210limit" data-ref-filename="210limit">limit</dfn>;</td></tr>
<tr><th id="2311">2311</th><td></td></tr>
<tr><th id="2312">2312</th><td>	<i>/*</i></td></tr>
<tr><th id="2313">2313</th><td><i>	 * Initialize the memory window pointer register so that</i></td></tr>
<tr><th id="2314">2314</th><td><i>	 * we can access the first 32K of internal NIC RAM. This will</i></td></tr>
<tr><th id="2315">2315</th><td><i>	 * allow us to set up the TX send ring RCBs and the RX return</i></td></tr>
<tr><th id="2316">2316</th><td><i>	 * ring RCBs, plus other things which live in NIC memory.</i></td></tr>
<tr><th id="2317">2317</th><td><i>	 */</i></td></tr>
<tr><th id="2318">2318</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#234" title="0x7C" data-ref="_M/BGE_PCI_MEMWIN_BASEADDR">BGE_PCI_MEMWIN_BASEADDR</a>, <var>0</var>);</td></tr>
<tr><th id="2319">2319</th><td></td></tr>
<tr><th id="2320">2320</th><td>	<b>if</b> (!<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2321">2321</th><td>		<i>/* 57XX step 33 */</i></td></tr>
<tr><th id="2322">2322</th><td>		<i>/* Configure mbuf memory pool */</i></td></tr>
<tr><th id="2323">2323</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4408, 0x00008000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1466" title="0x4408" data-ref="_M/BGE_BMAN_MBUFPOOL_BASEADDR">BGE_BMAN_MBUFPOOL_BASEADDR</a>, <a class="macro" href="if_bgereg.h.html#121" title="0x00008000" data-ref="_M/BGE_BUFFPOOL_1">BGE_BUFFPOOL_1</a>);</td></tr>
<tr><th id="2324">2324</th><td></td></tr>
<tr><th id="2325">2325</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>)</td></tr>
<tr><th id="2326">2326</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x440C, 0x10000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1467" title="0x440C" data-ref="_M/BGE_BMAN_MBUFPOOL_LEN">BGE_BMAN_MBUFPOOL_LEN</a>, <var>0x10000</var>);</td></tr>
<tr><th id="2327">2327</th><td>		<b>else</b></td></tr>
<tr><th id="2328">2328</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x440C, 0x18000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1467" title="0x440C" data-ref="_M/BGE_BMAN_MBUFPOOL_LEN">BGE_BMAN_MBUFPOOL_LEN</a>, <var>0x18000</var>);</td></tr>
<tr><th id="2329">2329</th><td></td></tr>
<tr><th id="2330">2330</th><td>		<i>/* 57XX step 34 */</i></td></tr>
<tr><th id="2331">2331</th><td>		<i>/* Configure DMA resource pool */</i></td></tr>
<tr><th id="2332">2332</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x442C, 0x00002000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1475" title="0x442C" data-ref="_M/BGE_BMAN_DMA_DESCPOOL_BASEADDR">BGE_BMAN_DMA_DESCPOOL_BASEADDR</a>,</td></tr>
<tr><th id="2333">2333</th><td>		    <a class="macro" href="if_bgereg.h.html#92" title="0x00002000" data-ref="_M/BGE_DMA_DESCRIPTORS">BGE_DMA_DESCRIPTORS</a>);</td></tr>
<tr><th id="2334">2334</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4430, 0x2000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1476" title="0x4430" data-ref="_M/BGE_BMAN_DMA_DESCPOOL_LEN">BGE_BMAN_DMA_DESCPOOL_LEN</a>, <var>0x2000</var>);</td></tr>
<tr><th id="2335">2335</th><td>	}</td></tr>
<tr><th id="2336">2336</th><td></td></tr>
<tr><th id="2337">2337</th><td>	<i>/* 5718 step 11, 57XX step 35 */</i></td></tr>
<tr><th id="2338">2338</th><td>	<i>/*</i></td></tr>
<tr><th id="2339">2339</th><td><i>	 * Configure mbuf pool watermarks. New broadcom docs strongly</i></td></tr>
<tr><th id="2340">2340</th><td><i>	 * recommend these.</i></td></tr>
<tr><th id="2341">2341</th><td><i>	 */</i></td></tr>
<tr><th id="2342">2342</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2343">2343</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4410, 0x0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1468" title="0x4410" data-ref="_M/BGE_BMAN_MBUFPOOL_READDMA_LOWAT">BGE_BMAN_MBUFPOOL_READDMA_LOWAT</a>, <var>0x0</var>);</td></tr>
<tr><th id="2344">2344</th><td>		<b>if</b> (<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#396" title="if_data.ifi_mtu" data-ref="_M/if_mtu">if_mtu</a> &gt; <a class="macro" href="../../net/if_ether.h.html#99" title="(1518 - ((6 * 2) + 2) - 4)" data-ref="_M/ETHERMTU">ETHERMTU</a>) {</td></tr>
<tr><th id="2345">2345</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4414, 0x7e)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1469" title="0x4414" data-ref="_M/BGE_BMAN_MBUFPOOL_MACRX_LOWAT">BGE_BMAN_MBUFPOOL_MACRX_LOWAT</a>, <var>0x7e</var>);</td></tr>
<tr><th id="2346">2346</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4418, 0xea)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1470" title="0x4418" data-ref="_M/BGE_BMAN_MBUFPOOL_HIWAT">BGE_BMAN_MBUFPOOL_HIWAT</a>, <var>0xea</var>);</td></tr>
<tr><th id="2347">2347</th><td>		} <b>else</b> {</td></tr>
<tr><th id="2348">2348</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4414, 0x2a)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1469" title="0x4414" data-ref="_M/BGE_BMAN_MBUFPOOL_MACRX_LOWAT">BGE_BMAN_MBUFPOOL_MACRX_LOWAT</a>, <var>0x2a</var>);</td></tr>
<tr><th id="2349">2349</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4418, 0xa0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1470" title="0x4418" data-ref="_M/BGE_BMAN_MBUFPOOL_HIWAT">BGE_BMAN_MBUFPOOL_HIWAT</a>, <var>0xa0</var>);</td></tr>
<tr><th id="2350">2350</th><td>		}</td></tr>
<tr><th id="2351">2351</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2352">2352</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4410, 0x0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1468" title="0x4410" data-ref="_M/BGE_BMAN_MBUFPOOL_READDMA_LOWAT">BGE_BMAN_MBUFPOOL_READDMA_LOWAT</a>, <var>0x0</var>);</td></tr>
<tr><th id="2353">2353</th><td></td></tr>
<tr><th id="2354">2354</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="2355">2355</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4414, 0x04)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1469" title="0x4414" data-ref="_M/BGE_BMAN_MBUFPOOL_MACRX_LOWAT">BGE_BMAN_MBUFPOOL_MACRX_LOWAT</a>, <var>0x04</var>);</td></tr>
<tr><th id="2356">2356</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4418, 0x10)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1470" title="0x4418" data-ref="_M/BGE_BMAN_MBUFPOOL_HIWAT">BGE_BMAN_MBUFPOOL_HIWAT</a>, <var>0x10</var>);</td></tr>
<tr><th id="2357">2357</th><td>		} <b>else</b> {</td></tr>
<tr><th id="2358">2358</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4414, 0x10)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1469" title="0x4414" data-ref="_M/BGE_BMAN_MBUFPOOL_MACRX_LOWAT">BGE_BMAN_MBUFPOOL_MACRX_LOWAT</a>, <var>0x10</var>);</td></tr>
<tr><th id="2359">2359</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4418, 0x60)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1470" title="0x4418" data-ref="_M/BGE_BMAN_MBUFPOOL_HIWAT">BGE_BMAN_MBUFPOOL_HIWAT</a>, <var>0x60</var>);</td></tr>
<tr><th id="2360">2360</th><td>		}</td></tr>
<tr><th id="2361">2361</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2362">2362</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4410, 0x50)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1468" title="0x4410" data-ref="_M/BGE_BMAN_MBUFPOOL_READDMA_LOWAT">BGE_BMAN_MBUFPOOL_READDMA_LOWAT</a>, <var>0x50</var>);</td></tr>
<tr><th id="2363">2363</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4414, 0x20)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1469" title="0x4414" data-ref="_M/BGE_BMAN_MBUFPOOL_MACRX_LOWAT">BGE_BMAN_MBUFPOOL_MACRX_LOWAT</a>, <var>0x20</var>);</td></tr>
<tr><th id="2364">2364</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4418, 0x60)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1470" title="0x4418" data-ref="_M/BGE_BMAN_MBUFPOOL_HIWAT">BGE_BMAN_MBUFPOOL_HIWAT</a>, <var>0x60</var>);</td></tr>
<tr><th id="2365">2365</th><td>	}</td></tr>
<tr><th id="2366">2366</th><td></td></tr>
<tr><th id="2367">2367</th><td>	<i>/* 57XX step 36 */</i></td></tr>
<tr><th id="2368">2368</th><td>	<i>/* Configure DMA resource watermarks */</i></td></tr>
<tr><th id="2369">2369</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4434, 5)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1477" title="0x4434" data-ref="_M/BGE_BMAN_DMA_DESCPOOL_LOWAT">BGE_BMAN_DMA_DESCPOOL_LOWAT</a>, <var>5</var>);</td></tr>
<tr><th id="2370">2370</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4438, 10)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1478" title="0x4438" data-ref="_M/BGE_BMAN_DMA_DESCPOOL_HIWAT">BGE_BMAN_DMA_DESCPOOL_HIWAT</a>, <var>10</var>);</td></tr>
<tr><th id="2371">2371</th><td></td></tr>
<tr><th id="2372">2372</th><td>	<i>/* 5718 step 13, 57XX step 38 */</i></td></tr>
<tr><th id="2373">2373</th><td>	<i>/* Enable buffer manager */</i></td></tr>
<tr><th id="2374">2374</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#1489" title="0x00000002" data-ref="_M/BGE_BMANMODE_ENABLE">BGE_BMANMODE_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#1490" title="0x00000004" data-ref="_M/BGE_BMANMODE_ATTN">BGE_BMANMODE_ATTN</a>;</td></tr>
<tr><th id="2375">2375</th><td>	<i>/*</i></td></tr>
<tr><th id="2376">2376</th><td><i>	 * Change the arbitration algorithm of TXMBUF read request to</i></td></tr>
<tr><th id="2377">2377</th><td><i>	 * round-robin instead of priority based for BCM5719.  When</i></td></tr>
<tr><th id="2378">2378</th><td><i>	 * TXFIFO is almost empty, RDMA will hold its request until</i></td></tr>
<tr><th id="2379">2379</th><td><i>	 * TXFIFO is not almost empty.</i></td></tr>
<tr><th id="2380">2380</th><td><i>	 */</i></td></tr>
<tr><th id="2381">2381</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>)</td></tr>
<tr><th id="2382">2382</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1493" title="0x80000000" data-ref="_M/BGE_BMANMODE_NO_TX_UNDERRUN">BGE_BMANMODE_NO_TX_UNDERRUN</a>;</td></tr>
<tr><th id="2383">2383</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> ||</td></tr>
<tr><th id="2384">2384</th><td>		<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a> ||</td></tr>
<tr><th id="2385">2385</th><td>		<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#348" title="0x05720000" data-ref="_M/BGE_CHIPID_BCM5720_A0">BGE_CHIPID_BCM5720_A0</a>)</td></tr>
<tr><th id="2386">2386</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1492" title="0x00000010" data-ref="_M/BGE_BMANMODE_LOMBUF_ATTN">BGE_BMANMODE_LOMBUF_ATTN</a>;</td></tr>
<tr><th id="2387">2387</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4400, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1464" title="0x4400" data-ref="_M/BGE_BMAN_MODE">BGE_BMAN_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2388">2388</th><td></td></tr>
<tr><th id="2389">2389</th><td>	<i>/* 57XX step 39 */</i></td></tr>
<tr><th id="2390">2390</th><td>	<i>/* Poll for buffer manager start indication */</i></td></tr>
<tr><th id="2391">2391</th><td>	<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2392">2392</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="2393">2393</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4400)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1464" title="0x4400" data-ref="_M/BGE_BMAN_MODE">BGE_BMAN_MODE</a>) &amp; <a class="macro" href="if_bgereg.h.html#1489" title="0x00000002" data-ref="_M/BGE_BMANMODE_ENABLE">BGE_BMANMODE_ENABLE</a>)</td></tr>
<tr><th id="2394">2394</th><td>			<b>break</b>;</td></tr>
<tr><th id="2395">2395</th><td>	}</td></tr>
<tr><th id="2396">2396</th><td></td></tr>
<tr><th id="2397">2397</th><td>	<b>if</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>) {</td></tr>
<tr><th id="2398">2398</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="2399">2399</th><td>		    <q>"buffer manager failed to start\n"</q>);</td></tr>
<tr><th id="2400">2400</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a>;</td></tr>
<tr><th id="2401">2401</th><td>	}</td></tr>
<tr><th id="2402">2402</th><td></td></tr>
<tr><th id="2403">2403</th><td>	<i>/* 57XX step 40 */</i></td></tr>
<tr><th id="2404">2404</th><td>	<i>/* Enable flow-through queues */</i></td></tr>
<tr><th id="2405">2405</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5C00, 0xFFFFFFFF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1840" title="0x5C00" data-ref="_M/BGE_FTQ_RESET">BGE_FTQ_RESET</a>, <var>0xFFFFFFFF</var>);</td></tr>
<tr><th id="2406">2406</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5C00, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1840" title="0x5C00" data-ref="_M/BGE_FTQ_RESET">BGE_FTQ_RESET</a>, <var>0</var>);</td></tr>
<tr><th id="2407">2407</th><td></td></tr>
<tr><th id="2408">2408</th><td>	<i>/* Wait until queue initialization is complete */</i></td></tr>
<tr><th id="2409">2409</th><td>	<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2410">2410</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5C00)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1840" title="0x5C00" data-ref="_M/BGE_FTQ_RESET">BGE_FTQ_RESET</a>) == <var>0</var>)</td></tr>
<tr><th id="2411">2411</th><td>			<b>break</b>;</td></tr>
<tr><th id="2412">2412</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="2413">2413</th><td>	}</td></tr>
<tr><th id="2414">2414</th><td></td></tr>
<tr><th id="2415">2415</th><td>	<b>if</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>) {</td></tr>
<tr><th id="2416">2416</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="2417">2417</th><td>		    <q>"flow-through queue init failed\n"</q>);</td></tr>
<tr><th id="2418">2418</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a>;</td></tr>
<tr><th id="2419">2419</th><td>	}</td></tr>
<tr><th id="2420">2420</th><td></td></tr>
<tr><th id="2421">2421</th><td>	<i>/*</i></td></tr>
<tr><th id="2422">2422</th><td><i>	 * Summary of rings supported by the controller:</i></td></tr>
<tr><th id="2423">2423</th><td><i>	 *</i></td></tr>
<tr><th id="2424">2424</th><td><i>	 * Standard Receive Producer Ring</i></td></tr>
<tr><th id="2425">2425</th><td><i>	 * - This ring is used to feed receive buffers for "standard"</i></td></tr>
<tr><th id="2426">2426</th><td><i>	 *   sized frames (typically 1536 bytes) to the controller.</i></td></tr>
<tr><th id="2427">2427</th><td><i>	 *</i></td></tr>
<tr><th id="2428">2428</th><td><i>	 * Jumbo Receive Producer Ring</i></td></tr>
<tr><th id="2429">2429</th><td><i>	 * - This ring is used to feed receive buffers for jumbo sized</i></td></tr>
<tr><th id="2430">2430</th><td><i>	 *   frames (i.e. anything bigger than the "standard" frames)</i></td></tr>
<tr><th id="2431">2431</th><td><i>	 *   to the controller.</i></td></tr>
<tr><th id="2432">2432</th><td><i>	 *</i></td></tr>
<tr><th id="2433">2433</th><td><i>	 * Mini Receive Producer Ring</i></td></tr>
<tr><th id="2434">2434</th><td><i>	 * - This ring is used to feed receive buffers for "mini"</i></td></tr>
<tr><th id="2435">2435</th><td><i>	 *   sized frames to the controller.</i></td></tr>
<tr><th id="2436">2436</th><td><i>	 * - This feature required external memory for the controller</i></td></tr>
<tr><th id="2437">2437</th><td><i>	 *   but was never used in a production system.  Should always</i></td></tr>
<tr><th id="2438">2438</th><td><i>	 *   be disabled.</i></td></tr>
<tr><th id="2439">2439</th><td><i>	 *</i></td></tr>
<tr><th id="2440">2440</th><td><i>	 * Receive Return Ring</i></td></tr>
<tr><th id="2441">2441</th><td><i>	 * - After the controller has placed an incoming frame into a</i></td></tr>
<tr><th id="2442">2442</th><td><i>	 *   receive buffer that buffer is moved into a receive return</i></td></tr>
<tr><th id="2443">2443</th><td><i>	 *   ring.  The driver is then responsible to passing the</i></td></tr>
<tr><th id="2444">2444</th><td><i>	 *   buffer up to the stack.  Many versions of the controller</i></td></tr>
<tr><th id="2445">2445</th><td><i>	 *   support multiple RR rings.</i></td></tr>
<tr><th id="2446">2446</th><td><i>	 *</i></td></tr>
<tr><th id="2447">2447</th><td><i>	 * Send Ring</i></td></tr>
<tr><th id="2448">2448</th><td><i>	 * - This ring is used for outgoing frames.  Many versions of</i></td></tr>
<tr><th id="2449">2449</th><td><i>	 *   the controller support multiple send rings.</i></td></tr>
<tr><th id="2450">2450</th><td><i>	 */</i></td></tr>
<tr><th id="2451">2451</th><td></td></tr>
<tr><th id="2452">2452</th><td>	<i>/* 5718 step 15, 57XX step 41 */</i></td></tr>
<tr><th id="2453">2453</th><td>	<i>/* Initialize the standard RX ring control block */</i></td></tr>
<tr><th id="2454">2454</th><td>	<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a> = &amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_info" title='bge_ring_data::bge_info' data-ref="bge_ring_data::bge_info" data-ref-filename="bge_ring_data..bge_info">bge_info</a>.<a class="ref field" href="if_bgereg.h.html#bge_gib::bge_std_rx_rcb" title='bge_gib::bge_std_rx_rcb' data-ref="bge_gib::bge_std_rx_rcb" data-ref-filename="bge_gib..bge_std_rx_rcb">bge_std_rx_rcb</a>;</td></tr>
<tr><th id="2455">2455</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (rcb-&gt;bge_hostaddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_std_ring))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (rcb-&gt;bge_hostaddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_std_ring))) &gt;&gt; 32); else (rcb-&gt;bge_hostaddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>, <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_std_ring))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_rx_std_ring));</td></tr>
<tr><th id="2456">2456</th><td>	<i>/* 5718 step 16 */</i></td></tr>
<tr><th id="2457">2457</th><td>	<b>if</b> (<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2458">2458</th><td>		<i>/*</i></td></tr>
<tr><th id="2459">2459</th><td><i>		 * Bits 31-16: Programmable ring size (2048, 1024, 512, .., 32)</i></td></tr>
<tr><th id="2460">2460</th><td><i>		 * Bits 15-2 : Maximum RX frame size</i></td></tr>
<tr><th id="2461">2461</th><td><i>		 * Bit 1     : 1 = Ring Disabled, 0 = Ring Enabled</i></td></tr>
<tr><th id="2462">2462</th><td><i>		 * Bit 0     : Reserved</i></td></tr>
<tr><th id="2463">2463</th><td><i>		 */</i></td></tr>
<tr><th id="2464">2464</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> =</td></tr>
<tr><th id="2465">2465</th><td>		    <a class="macro" href="if_bgereg.h.html#2256" title="((512) &lt;&lt; 16 | (1536 &lt;&lt; 2))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<var>512</var>, <a class="macro" href="if_bgereg.h.html#2633" title="1536" data-ref="_M/BGE_MAX_FRAMELEN">BGE_MAX_FRAMELEN</a> &lt;&lt; <var>2</var>);</td></tr>
<tr><th id="2466">2466</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2467">2467</th><td>		<i>/*</i></td></tr>
<tr><th id="2468">2468</th><td><i>		 * Bits 31-16: Programmable ring size (512, 256, 128, 64, 32)</i></td></tr>
<tr><th id="2469">2469</th><td><i>		 * Bits 15-2 : Reserved (should be 0)</i></td></tr>
<tr><th id="2470">2470</th><td><i>		 * Bit 1     : 1 = Ring Disabled, 0 = Ring Enabled</i></td></tr>
<tr><th id="2471">2471</th><td><i>		 * Bit 0     : Reserved</i></td></tr>
<tr><th id="2472">2472</th><td><i>		 */</i></td></tr>
<tr><th id="2473">2473</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> = <a class="macro" href="if_bgereg.h.html#2256" title="((512) &lt;&lt; 16 | (0))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<var>512</var>, <var>0</var>);</td></tr>
<tr><th id="2474">2474</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2475">2475</th><td>		<i>/*</i></td></tr>
<tr><th id="2476">2476</th><td><i>		 * Ring size is always XXX entries</i></td></tr>
<tr><th id="2477">2477</th><td><i>		 * Bits 31-16: Maximum RX frame size</i></td></tr>
<tr><th id="2478">2478</th><td><i>		 * Bits 15-2 : Reserved (should be 0)</i></td></tr>
<tr><th id="2479">2479</th><td><i>		 * Bit 1     : 1 = Ring Disabled, 0 = Ring Enabled</i></td></tr>
<tr><th id="2480">2480</th><td><i>		 * Bit 0     : Reserved</i></td></tr>
<tr><th id="2481">2481</th><td><i>		 */</i></td></tr>
<tr><th id="2482">2482</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> =</td></tr>
<tr><th id="2483">2483</th><td>		    <a class="macro" href="if_bgereg.h.html#2256" title="((1536) &lt;&lt; 16 | (0))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<a class="macro" href="if_bgereg.h.html#2633" title="1536" data-ref="_M/BGE_MAX_FRAMELEN">BGE_MAX_FRAMELEN</a>, <var>0</var>);</td></tr>
<tr><th id="2484">2484</th><td>	}</td></tr>
<tr><th id="2485">2485</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> ||</td></tr>
<tr><th id="2486">2486</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a> ||</td></tr>
<tr><th id="2487">2487</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>)</td></tr>
<tr><th id="2488">2488</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a> = <a class="macro" href="if_bgereg.h.html#127" title="0x00040000" data-ref="_M/BGE_STD_RX_RINGS_5717">BGE_STD_RX_RINGS_5717</a>;</td></tr>
<tr><th id="2489">2489</th><td>	<b>else</b></td></tr>
<tr><th id="2490">2490</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a> = <a class="macro" href="if_bgereg.h.html#117" title="0x00006000" data-ref="_M/BGE_STD_RX_RINGS">BGE_STD_RX_RINGS</a>;</td></tr>
<tr><th id="2491">2491</th><td>	<i>/* Write the standard receive producer ring control block. */</i></td></tr>
<tr><th id="2492">2492</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2450, rcb-&gt;bge_hostaddr.bge_addr_hi)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1124" title="0x2450" data-ref="_M/BGE_RX_STD_RCB_HADDR_HI">BGE_RX_STD_RCB_HADDR_HI</a>, <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2493">2493</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2454, rcb-&gt;bge_hostaddr.bge_addr_lo)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1125" title="0x2454" data-ref="_M/BGE_RX_STD_RCB_HADDR_LO">BGE_RX_STD_RCB_HADDR_LO</a>, <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2494">2494</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2458, rcb-&gt;bge_maxlen_flags)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1126" title="0x2458" data-ref="_M/BGE_RX_STD_RCB_MAXLEN_FLAGS">BGE_RX_STD_RCB_MAXLEN_FLAGS</a>, <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a>);</td></tr>
<tr><th id="2495">2495</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x245C, rcb-&gt;bge_nicaddr)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1127" title="0x245C" data-ref="_M/BGE_RX_STD_RCB_NICADDR">BGE_RX_STD_RCB_NICADDR</a>, <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a>);</td></tr>
<tr><th id="2496">2496</th><td></td></tr>
<tr><th id="2497">2497</th><td>	<i>/* Reset the standard receive producer ring producer index. */</i></td></tr>
<tr><th id="2498">2498</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#516" title="0x026C" data-ref="_M/BGE_MBX_RX_STD_PROD_LO">BGE_MBX_RX_STD_PROD_LO</a>, <var>0</var>);</td></tr>
<tr><th id="2499">2499</th><td></td></tr>
<tr><th id="2500">2500</th><td>	<i>/* 57XX step 42 */</i></td></tr>
<tr><th id="2501">2501</th><td>	<i>/*</i></td></tr>
<tr><th id="2502">2502</th><td><i>	 * Initialize the jumbo RX ring control block</i></td></tr>
<tr><th id="2503">2503</th><td><i>	 * We set the 'ring disabled' bit in the flags</i></td></tr>
<tr><th id="2504">2504</th><td><i>	 * field until we're actually ready to start</i></td></tr>
<tr><th id="2505">2505</th><td><i>	 * using this ring (i.e. once we set the MTU</i></td></tr>
<tr><th id="2506">2506</th><td><i>	 * high enough to require it).</i></td></tr>
<tr><th id="2507">2507</th><td><i>	 */</i></td></tr>
<tr><th id="2508">2508</th><td>	<b>if</b> (<a class="macro" href="#409" title="((sc)-&gt;bge_flags &amp; 0x00000002)" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2509">2509</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a> = &amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_info" title='bge_ring_data::bge_info' data-ref="bge_ring_data::bge_info" data-ref-filename="bge_ring_data..bge_info">bge_info</a>.<a class="ref field" href="if_bgereg.h.html#bge_gib::bge_jumbo_rx_rcb" title='bge_gib::bge_jumbo_rx_rcb' data-ref="bge_gib::bge_jumbo_rx_rcb" data-ref-filename="bge_gib..bge_jumbo_rx_rcb">bge_jumbo_rx_rcb</a>;</td></tr>
<tr><th id="2510">2510</th><td>		<a class="macro" href="if_bgevar.h.html#74" title="do { (rcb-&gt;bge_hostaddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_jumbo_ring))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (rcb-&gt;bge_hostaddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_jumbo_ring))) &gt;&gt; 32); else (rcb-&gt;bge_hostaddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>,</td></tr>
<tr><th id="2511">2511</th><td>		    <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_jumbo_ring))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_rx_jumbo_ring));</td></tr>
<tr><th id="2512">2512</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> = <a class="macro" href="if_bgereg.h.html#2256" title="((0) &lt;&lt; 16 | (0x0001 | 0x0002))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<var>0</var>,</td></tr>
<tr><th id="2513">2513</th><td>		    <a class="macro" href="if_bgereg.h.html#2258" title="0x0001" data-ref="_M/BGE_RCB_FLAG_USE_EXT_RX_BD">BGE_RCB_FLAG_USE_EXT_RX_BD</a> | <a class="macro" href="if_bgereg.h.html#2259" title="0x0002" data-ref="_M/BGE_RCB_FLAG_RING_DISABLED">BGE_RCB_FLAG_RING_DISABLED</a>);</td></tr>
<tr><th id="2514">2514</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> ||</td></tr>
<tr><th id="2515">2515</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a> ||</td></tr>
<tr><th id="2516">2516</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>)</td></tr>
<tr><th id="2517">2517</th><td>			<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a> = <a class="macro" href="if_bgereg.h.html#128" title="0x00044400" data-ref="_M/BGE_JUMBO_RX_RINGS_5717">BGE_JUMBO_RX_RINGS_5717</a>;</td></tr>
<tr><th id="2518">2518</th><td>		<b>else</b></td></tr>
<tr><th id="2519">2519</th><td>			<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a> = <a class="macro" href="if_bgereg.h.html#119" title="0x00007000" data-ref="_M/BGE_JUMBO_RX_RINGS">BGE_JUMBO_RX_RINGS</a>;</td></tr>
<tr><th id="2520">2520</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2440, rcb-&gt;bge_hostaddr.bge_addr_hi)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1120" title="0x2440" data-ref="_M/BGE_RX_JUMBO_RCB_HADDR_HI">BGE_RX_JUMBO_RCB_HADDR_HI</a>,</td></tr>
<tr><th id="2521">2521</th><td>		    <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2522">2522</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2444, rcb-&gt;bge_hostaddr.bge_addr_lo)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1121" title="0x2444" data-ref="_M/BGE_RX_JUMBO_RCB_HADDR_LO">BGE_RX_JUMBO_RCB_HADDR_LO</a>,</td></tr>
<tr><th id="2523">2523</th><td>		    <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_hostaddr" title='bge_rcb::bge_hostaddr' data-ref="bge_rcb::bge_hostaddr" data-ref-filename="bge_rcb..bge_hostaddr">bge_hostaddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2524">2524</th><td>		<i>/* Program the jumbo receive producer ring RCB parameters. */</i></td></tr>
<tr><th id="2525">2525</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2448, rcb-&gt;bge_maxlen_flags)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1122" title="0x2448" data-ref="_M/BGE_RX_JUMBO_RCB_MAXLEN_FLAGS">BGE_RX_JUMBO_RCB_MAXLEN_FLAGS</a>,</td></tr>
<tr><th id="2526">2526</th><td>		    <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a>);</td></tr>
<tr><th id="2527">2527</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x244C, rcb-&gt;bge_nicaddr)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1123" title="0x244C" data-ref="_M/BGE_RX_JUMBO_RCB_NICADDR">BGE_RX_JUMBO_RCB_NICADDR</a>, <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_nicaddr" title='bge_rcb::bge_nicaddr' data-ref="bge_rcb::bge_nicaddr" data-ref-filename="bge_rcb..bge_nicaddr">bge_nicaddr</a>);</td></tr>
<tr><th id="2528">2528</th><td>		<i>/* Reset the jumbo receive producer ring producer index. */</i></td></tr>
<tr><th id="2529">2529</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#518" title="0x0274" data-ref="_M/BGE_MBX_RX_JUMBO_PROD_LO">BGE_MBX_RX_JUMBO_PROD_LO</a>, <var>0</var>);</td></tr>
<tr><th id="2530">2530</th><td>	}</td></tr>
<tr><th id="2531">2531</th><td></td></tr>
<tr><th id="2532">2532</th><td>	<i>/* 57XX step 43 */</i></td></tr>
<tr><th id="2533">2533</th><td>	<i>/* Disable the mini receive producer ring RCB. */</i></td></tr>
<tr><th id="2534">2534</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2535">2535</th><td>		<i>/* Set up dummy disabled mini ring RCB */</i></td></tr>
<tr><th id="2536">2536</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a> = &amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_info" title='bge_ring_data::bge_info' data-ref="bge_ring_data::bge_info" data-ref-filename="bge_ring_data..bge_info">bge_info</a>.<a class="ref field" href="if_bgereg.h.html#bge_gib::bge_mini_rx_rcb" title='bge_gib::bge_mini_rx_rcb' data-ref="bge_gib::bge_mini_rx_rcb" data-ref-filename="bge_gib..bge_mini_rx_rcb">bge_mini_rx_rcb</a>;</td></tr>
<tr><th id="2537">2537</th><td>		<a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a> =</td></tr>
<tr><th id="2538">2538</th><td>		    <a class="macro" href="if_bgereg.h.html#2256" title="((0) &lt;&lt; 16 | (0x0002))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<var>0</var>, <a class="macro" href="if_bgereg.h.html#2259" title="0x0002" data-ref="_M/BGE_RCB_FLAG_RING_DISABLED">BGE_RCB_FLAG_RING_DISABLED</a>);</td></tr>
<tr><th id="2539">2539</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2468, rcb-&gt;bge_maxlen_flags)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1130" title="0x2468" data-ref="_M/BGE_RX_MINI_RCB_MAXLEN_FLAGS">BGE_RX_MINI_RCB_MAXLEN_FLAGS</a>,</td></tr>
<tr><th id="2540">2540</th><td>		    <a class="local col1 ref" href="#201rcb" title='rcb' data-ref="201rcb" data-ref-filename="201rcb">rcb</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rcb::bge_maxlen_flags" title='bge_rcb::bge_maxlen_flags' data-ref="bge_rcb::bge_maxlen_flags" data-ref-filename="bge_rcb..bge_maxlen_flags">bge_maxlen_flags</a>);</td></tr>
<tr><th id="2541">2541</th><td>		<i>/* Reset the mini receive producer ring producer index. */</i></td></tr>
<tr><th id="2542">2542</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#520" title="0x027C" data-ref="_M/BGE_MBX_RX_MINI_PROD_LO">BGE_MBX_RX_MINI_PROD_LO</a>, <var>0</var>);</td></tr>
<tr><th id="2543">2543</th><td></td></tr>
<tr><th id="2544">2544</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="2545">2545</th><td>		    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_info)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_info),</td></tr>
<tr><th id="2546">2546</th><td>		    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_gib" title='bge_gib' data-ref="bge_gib" data-ref-filename="bge_gib">bge_gib</a>),</td></tr>
<tr><th id="2547">2547</th><td>		    <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a> | <a class="macro" href="../../sys/bus_proto.h.html#328" title="0x04" data-ref="_M/BUS_DMASYNC_PREWRITE">BUS_DMASYNC_PREWRITE</a>);</td></tr>
<tr><th id="2548">2548</th><td>	}</td></tr>
<tr><th id="2549">2549</th><td></td></tr>
<tr><th id="2550">2550</th><td>	<i>/* Choose de-pipeline mode for BCM5906 A0, A1 and A2. */</i></td></tr>
<tr><th id="2551">2551</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="2552">2552</th><td>		<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#340" title="0xc000" data-ref="_M/BGE_CHIPID_BCM5906_A0">BGE_CHIPID_BCM5906_A0</a> ||</td></tr>
<tr><th id="2553">2553</th><td>		    <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#341" title="0xc001" data-ref="_M/BGE_CHIPID_BCM5906_A1">BGE_CHIPID_BCM5906_A1</a> ||</td></tr>
<tr><th id="2554">2554</th><td>		    <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#342" title="0xc002" data-ref="_M/BGE_CHIPID_BCM5906_A2">BGE_CHIPID_BCM5906_A2</a>)</td></tr>
<tr><th id="2555">2555</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C20, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C20) &amp; ~3) | 2)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#877" title="0x0C20" data-ref="_M/BGE_ISO_PKT_TX">BGE_ISO_PKT_TX</a>,</td></tr>
<tr><th id="2556">2556</th><td>			    (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C20)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#877" title="0x0C20" data-ref="_M/BGE_ISO_PKT_TX">BGE_ISO_PKT_TX</a>) &amp; ~<var>3</var>) | <var>2</var>);</td></tr>
<tr><th id="2557">2557</th><td>	}</td></tr>
<tr><th id="2558">2558</th><td>	<i>/* 5718 step 14, 57XX step 44 */</i></td></tr>
<tr><th id="2559">2559</th><td>	<i>/*</i></td></tr>
<tr><th id="2560">2560</th><td><i>	 * The BD ring replenish thresholds control how often the</i></td></tr>
<tr><th id="2561">2561</th><td><i>	 * hardware fetches new BD's from the producer rings in host</i></td></tr>
<tr><th id="2562">2562</th><td><i>	 * memory.  Setting the value too low on a busy system can</i></td></tr>
<tr><th id="2563">2563</th><td><i>	 * starve the hardware and recue the throughpout.</i></td></tr>
<tr><th id="2564">2564</th><td><i>	 *</i></td></tr>
<tr><th id="2565">2565</th><td><i>	 * Set the BD ring replenish thresholds. The recommended</i></td></tr>
<tr><th id="2566">2566</th><td><i>	 * values are 1/8th the number of descriptors allocated to</i></td></tr>
<tr><th id="2567">2567</th><td><i>	 * each ring, but since we try to avoid filling the entire</i></td></tr>
<tr><th id="2568">2568</th><td><i>	 * ring we set these to the minimal value of 8.  This needs to</i></td></tr>
<tr><th id="2569">2569</th><td><i>	 * be done on several of the supported chip revisions anyway,</i></td></tr>
<tr><th id="2570">2570</th><td><i>	 * to work around HW bugs.</i></td></tr>
<tr><th id="2571">2571</th><td><i>	 */</i></td></tr>
<tr><th id="2572">2572</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2C18, 8)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1186" title="0x2C18" data-ref="_M/BGE_RBDI_STD_REPL_THRESH">BGE_RBDI_STD_REPL_THRESH</a>, <var>8</var>);</td></tr>
<tr><th id="2573">2573</th><td>	<b>if</b> (<a class="macro" href="#409" title="((sc)-&gt;bge_flags &amp; 0x00000002)" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2574">2574</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2C1C, 8)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1187" title="0x2C1C" data-ref="_M/BGE_RBDI_JUMBO_REPL_THRESH">BGE_RBDI_JUMBO_REPL_THRESH</a>, <var>8</var>);</td></tr>
<tr><th id="2575">2575</th><td></td></tr>
<tr><th id="2576">2576</th><td>	<i>/* 5718 step 18 */</i></td></tr>
<tr><th id="2577">2577</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2578">2578</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2D00, 4)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1189" title="0x2D00" data-ref="_M/BGE_STD_REPL_LWM">BGE_STD_REPL_LWM</a>, <var>4</var>);</td></tr>
<tr><th id="2579">2579</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2D04, 4)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1190" title="0x2D04" data-ref="_M/BGE_JUMBO_REPL_LWM">BGE_JUMBO_REPL_LWM</a>, <var>4</var>);</td></tr>
<tr><th id="2580">2580</th><td>	}</td></tr>
<tr><th id="2581">2581</th><td></td></tr>
<tr><th id="2582">2582</th><td>	<i>/* 57XX step 45 */</i></td></tr>
<tr><th id="2583">2583</th><td>	<i>/*</i></td></tr>
<tr><th id="2584">2584</th><td><i>	 * Disable all send rings by setting the 'ring disabled' bit</i></td></tr>
<tr><th id="2585">2585</th><td><i>	 * in the flags field of all the TX send ring control blocks,</i></td></tr>
<tr><th id="2586">2586</th><td><i>	 * located in NIC memory.</i></td></tr>
<tr><th id="2587">2587</th><td><i>	 */</i></td></tr>
<tr><th id="2588">2588</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2589">2589</th><td>		<i>/* 5700 to 5704 had 16 send rings. */</i></td></tr>
<tr><th id="2590">2590</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <a class="macro" href="if_bgereg.h.html#621" title="16" data-ref="_M/BGE_TX_RINGS_EXTSSRAM_MAX">BGE_TX_RINGS_EXTSSRAM_MAX</a>;</td></tr>
<tr><th id="2591">2591</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2592">2592</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <a class="macro" href="if_bgereg.h.html#620" title="4" data-ref="_M/BGE_TX_RINGS_5717_MAX">BGE_TX_RINGS_5717_MAX</a>;</td></tr>
<tr><th id="2593">2593</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="#415" title="((sc)-&gt;bge_flags &amp; 0x00040000)" data-ref="_M/BGE_IS_57765_FAMILY">BGE_IS_57765_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>) ||</td></tr>
<tr><th id="2594">2594</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="2595">2595</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <a class="macro" href="if_bgereg.h.html#619" title="2" data-ref="_M/BGE_TX_RINGS_57765_MAX">BGE_TX_RINGS_57765_MAX</a>;</td></tr>
<tr><th id="2596">2596</th><td>	} <b>else</b></td></tr>
<tr><th id="2597">2597</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <var>1</var>;</td></tr>
<tr><th id="2598">2598</th><td>	<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> = <a class="macro" href="if_bgereg.h.html#2112" title="0x00008000" data-ref="_M/BGE_MEMWIN_START">BGE_MEMWIN_START</a> + <a class="macro" href="if_bgereg.h.html#67" title="0x00000100" data-ref="_M/BGE_SEND_RING_RCB">BGE_SEND_RING_RCB</a>;</td></tr>
<tr><th id="2599">2599</th><td>	<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2600">2600</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_maxlen_flags), ((0) &lt;&lt; 16 | (0x0002)))" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_maxlen_flags,</td></tr>
<tr><th id="2601">2601</th><td>		    <a class="macro" href="if_bgereg.h.html#2256" title="((0) &lt;&lt; 16 | (0x0002))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<var>0</var>, <a class="macro" href="if_bgereg.h.html#2259" title="0x0002" data-ref="_M/BGE_RCB_FLAG_RING_DISABLED">BGE_RCB_FLAG_RING_DISABLED</a>));</td></tr>
<tr><th id="2602">2602</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_nicaddr), 0)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_nicaddr, <var>0</var>);</td></tr>
<tr><th id="2603">2603</th><td>		<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> += <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rcb" title='bge_rcb' data-ref="bge_rcb" data-ref-filename="bge_rcb">bge_rcb</a>);</td></tr>
<tr><th id="2604">2604</th><td>	}</td></tr>
<tr><th id="2605">2605</th><td></td></tr>
<tr><th id="2606">2606</th><td>	<i>/* 57XX step 46 and 47 */</i></td></tr>
<tr><th id="2607">2607</th><td>	<i>/* Configure send ring RCB 0 (we use only the first ring) */</i></td></tr>
<tr><th id="2608">2608</th><td>	<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> = <a class="macro" href="if_bgereg.h.html#2112" title="0x00008000" data-ref="_M/BGE_MEMWIN_START">BGE_MEMWIN_START</a> + <a class="macro" href="if_bgereg.h.html#67" title="0x00000100" data-ref="_M/BGE_SEND_RING_RCB">BGE_SEND_RING_RCB</a>;</td></tr>
<tr><th id="2609">2609</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (taddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_tx_ring))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (taddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_tx_ring))) &gt;&gt; 32); else (taddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>, <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_tx_ring))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_tx_ring));</td></tr>
<tr><th id="2610">2610</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_hi), taddr.bge_addr_hi)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_hi, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2611">2611</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_lo), taddr.bge_addr_lo)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_lo, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2612">2612</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> ||</td></tr>
<tr><th id="2613">2613</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a> ||</td></tr>
<tr><th id="2614">2614</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>)</td></tr>
<tr><th id="2615">2615</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_nicaddr), 0x00004000)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_nicaddr, <a class="macro" href="if_bgereg.h.html#94" title="0x00004000" data-ref="_M/BGE_SEND_RING_5717">BGE_SEND_RING_5717</a>);</td></tr>
<tr><th id="2616">2616</th><td>	<b>else</b></td></tr>
<tr><th id="2617">2617</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_nicaddr), 0x00004000 + ((0 * sizeof(struct bge_tx_bd) * 512) / 4))" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_nicaddr,</td></tr>
<tr><th id="2618">2618</th><td>		    <a class="macro" href="if_bgereg.h.html#2289" title="0x00004000 + ((0 * sizeof(struct bge_tx_bd) * 512) / 4)" data-ref="_M/BGE_NIC_TXRING_ADDR">BGE_NIC_TXRING_ADDR</a>(<var>0</var>, <a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>));</td></tr>
<tr><th id="2619">2619</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_maxlen_flags), ((512) &lt;&lt; 16 | (0)))" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_maxlen_flags,</td></tr>
<tr><th id="2620">2620</th><td>	    <a class="macro" href="if_bgereg.h.html#2256" title="((512) &lt;&lt; 16 | (0))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>, <var>0</var>));</td></tr>
<tr><th id="2621">2621</th><td></td></tr>
<tr><th id="2622">2622</th><td>	<i>/* 57XX step 48 */</i></td></tr>
<tr><th id="2623">2623</th><td>	<i>/*</i></td></tr>
<tr><th id="2624">2624</th><td><i>	 * Disable all receive return rings by setting the</i></td></tr>
<tr><th id="2625">2625</th><td><i>	 * 'ring diabled' bit in the flags field of all the receive</i></td></tr>
<tr><th id="2626">2626</th><td><i>	 * return ring control blocks, located in NIC memory.</i></td></tr>
<tr><th id="2627">2627</th><td><i>	 */</i></td></tr>
<tr><th id="2628">2628</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2629">2629</th><td>		<i>/* Should be 17, use 16 until we get an SRAM map. */</i></td></tr>
<tr><th id="2630">2630</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <var>16</var>;</td></tr>
<tr><th id="2631">2631</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2632">2632</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <a class="macro" href="if_bgereg.h.html#622" title="16" data-ref="_M/BGE_RX_RINGS_MAX">BGE_RX_RINGS_MAX</a>;</td></tr>
<tr><th id="2633">2633</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#368" title="0x0a" data-ref="_M/BGE_ASICREV_BCM5755">BGE_ASICREV_BCM5755</a> ||</td></tr>
<tr><th id="2634">2634</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a> ||</td></tr>
<tr><th id="2635">2635</th><td>	    <a class="macro" href="#415" title="((sc)-&gt;bge_flags &amp; 0x00040000)" data-ref="_M/BGE_IS_57765_FAMILY">BGE_IS_57765_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2636">2636</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <var>4</var>;</td></tr>
<tr><th id="2637">2637</th><td>	<b>else</b></td></tr>
<tr><th id="2638">2638</th><td>		<a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a> = <var>1</var>;</td></tr>
<tr><th id="2639">2639</th><td>	<i>/* Disable all receive return rings */</i></td></tr>
<tr><th id="2640">2640</th><td>	<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> = <a class="macro" href="if_bgereg.h.html#2112" title="0x00008000" data-ref="_M/BGE_MEMWIN_START">BGE_MEMWIN_START</a> + <a class="macro" href="if_bgereg.h.html#69" title="0x00000200" data-ref="_M/BGE_RX_RETURN_RING_RCB">BGE_RX_RETURN_RING_RCB</a>;</td></tr>
<tr><th id="2641">2641</th><td>	<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="local col0 ref" href="#210limit" title='limit' data-ref="210limit" data-ref-filename="210limit">limit</a>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2642">2642</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_hi), 0)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_hi, <var>0</var>);</td></tr>
<tr><th id="2643">2643</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_lo), 0)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_lo, <var>0</var>);</td></tr>
<tr><th id="2644">2644</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_maxlen_flags), ((sc-&gt;bge_return_ring_cnt) &lt;&lt; 16 | (0x0002)))" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_maxlen_flags,</td></tr>
<tr><th id="2645">2645</th><td>		    <a class="macro" href="if_bgereg.h.html#2256" title="((sc-&gt;bge_return_ring_cnt) &lt;&lt; 16 | (0x0002))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a>,</td></tr>
<tr><th id="2646">2646</th><td>			<a class="macro" href="if_bgereg.h.html#2259" title="0x0002" data-ref="_M/BGE_RCB_FLAG_RING_DISABLED">BGE_RCB_FLAG_RING_DISABLED</a>));</td></tr>
<tr><th id="2647">2647</th><td>		<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_nicaddr), 0)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_nicaddr, <var>0</var>);</td></tr>
<tr><th id="2648">2648</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#522" title="0x0284" data-ref="_M/BGE_MBX_RX_CONS0_LO">BGE_MBX_RX_CONS0_LO</a> +</td></tr>
<tr><th id="2649">2649</th><td>		    (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> * (<b>sizeof</b>(<a class="typedef" href="../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a>))), <var>0</var>);</td></tr>
<tr><th id="2650">2650</th><td>		<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> += <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rcb" title='bge_rcb' data-ref="bge_rcb" data-ref-filename="bge_rcb">bge_rcb</a>);</td></tr>
<tr><th id="2651">2651</th><td>	}</td></tr>
<tr><th id="2652">2652</th><td></td></tr>
<tr><th id="2653">2653</th><td>	<i>/* 57XX step 49 */</i></td></tr>
<tr><th id="2654">2654</th><td>	<i>/*</i></td></tr>
<tr><th id="2655">2655</th><td><i>	 * Set up receive return ring 0.  Note that the NIC address</i></td></tr>
<tr><th id="2656">2656</th><td><i>	 * for RX return rings is 0x0.  The return rings live entirely</i></td></tr>
<tr><th id="2657">2657</th><td><i>	 * within the host, so the nicaddr field in the RCB isn't used.</i></td></tr>
<tr><th id="2658">2658</th><td><i>	 */</i></td></tr>
<tr><th id="2659">2659</th><td>	<a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a> = <a class="macro" href="if_bgereg.h.html#2112" title="0x00008000" data-ref="_M/BGE_MEMWIN_START">BGE_MEMWIN_START</a> + <a class="macro" href="if_bgereg.h.html#69" title="0x00000200" data-ref="_M/BGE_RX_RETURN_RING_RCB">BGE_RX_RETURN_RING_RCB</a>;</td></tr>
<tr><th id="2660">2660</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (taddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_return_ring))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (taddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_return_ring))) &gt;&gt; 32); else (taddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>, <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_rx_return_ring))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_rx_return_ring));</td></tr>
<tr><th id="2661">2661</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_hi), taddr.bge_addr_hi)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_hi, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2662">2662</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_hostaddr.bge_addr_lo), taddr.bge_addr_lo)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_hostaddr.bge_addr_lo, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2663">2663</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_nicaddr), 0x00000000)" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_nicaddr, <var>0x00000000</var>);</td></tr>
<tr><th id="2664">2664</th><td>	<a class="macro" href="if_bgevar.h.html#83" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rcb_addr + __builtin_offsetof(struct bge_rcb, bge_maxlen_flags), ((sc-&gt;bge_return_ring_cnt) &lt;&lt; 16 | (0)))" data-ref="_M/RCB_WRITE_4">RCB_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col2 ref" href="#202rcb_addr" title='rcb_addr' data-ref="202rcb_addr" data-ref-filename="202rcb_addr">rcb_addr</a>, bge_maxlen_flags,</td></tr>
<tr><th id="2665">2665</th><td>	    <a class="macro" href="if_bgereg.h.html#2256" title="((sc-&gt;bge_return_ring_cnt) &lt;&lt; 16 | (0))" data-ref="_M/BGE_RCB_MAXLEN_FLAGS">BGE_RCB_MAXLEN_FLAGS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a>, <var>0</var>));</td></tr>
<tr><th id="2666">2666</th><td></td></tr>
<tr><th id="2667">2667</th><td>	<i>/* 5718 step 24, 57XX step 53 */</i></td></tr>
<tr><th id="2668">2668</th><td>	<i>/* Set random backoff seed for TX */</i></td></tr>
<tr><th id="2669">2669</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0438, (((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[0] + ((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[1] + ((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[2] + ((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[3] + ((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[4] + ((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))[5]) &amp; 0x3FF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#639" title="0x0438" data-ref="_M/BGE_TX_RANDOM_BACKOFF">BGE_TX_RANDOM_BACKOFF</a>,</td></tr>
<tr><th id="2670">2670</th><td>	    (<a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>0</var>] + <a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>1</var>] +</td></tr>
<tr><th id="2671">2671</th><td>		<a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>2</var>] + <a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>3</var>] +</td></tr>
<tr><th id="2672">2672</th><td>		<a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>4</var>] + <a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>5</var>]) &amp;</td></tr>
<tr><th id="2673">2673</th><td>	    <a class="macro" href="if_bgereg.h.html#767" title="0x3FF" data-ref="_M/BGE_TX_BACKOFF_SEED_MASK">BGE_TX_BACKOFF_SEED_MASK</a>);</td></tr>
<tr><th id="2674">2674</th><td></td></tr>
<tr><th id="2675">2675</th><td>	<i>/* 5718 step 26, 57XX step 55 */</i></td></tr>
<tr><th id="2676">2676</th><td>	<i>/* Set inter-packet gap */</i></td></tr>
<tr><th id="2677">2677</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <var>0x2620</var>;</td></tr>
<tr><th id="2678">2678</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a> ||</td></tr>
<tr><th id="2679">2679</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>)</td></tr>
<tr><th id="2680">2680</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0464)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#650" title="0x0464" data-ref="_M/BGE_TX_LENGTHS">BGE_TX_LENGTHS</a>) &amp;</td></tr>
<tr><th id="2681">2681</th><td>		    (<a class="macro" href="if_bgereg.h.html#794" title="0x00FF0000" data-ref="_M/BGE_TXLEN_JMB_FRM_LEN_MSK">BGE_TXLEN_JMB_FRM_LEN_MSK</a> | <a class="macro" href="if_bgereg.h.html#795" title="0xFF000000" data-ref="_M/BGE_TXLEN_CNT_DN_VAL_MSK">BGE_TXLEN_CNT_DN_VAL_MSK</a>);</td></tr>
<tr><th id="2682">2682</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0464, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#650" title="0x0464" data-ref="_M/BGE_TX_LENGTHS">BGE_TX_LENGTHS</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2683">2683</th><td></td></tr>
<tr><th id="2684">2684</th><td>	<i>/* 5718 step 27, 57XX step 56 */</i></td></tr>
<tr><th id="2685">2685</th><td>	<i>/*</i></td></tr>
<tr><th id="2686">2686</th><td><i>	 * Specify which ring to use for packets that don't match</i></td></tr>
<tr><th id="2687">2687</th><td><i>	 * any RX rules.</i></td></tr>
<tr><th id="2688">2688</th><td><i>	 */</i></td></tr>
<tr><th id="2689">2689</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0500, 0x08)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#689" title="0x0500" data-ref="_M/BGE_RX_RULES_CFG">BGE_RX_RULES_CFG</a>, <var>0x08</var>);</td></tr>
<tr><th id="2690">2690</th><td></td></tr>
<tr><th id="2691">2691</th><td>	<i>/* 5718 step 28, 57XX step 57 */</i></td></tr>
<tr><th id="2692">2692</th><td>	<i>/*</i></td></tr>
<tr><th id="2693">2693</th><td><i>	 * Configure number of RX lists. One interrupt distribution</i></td></tr>
<tr><th id="2694">2694</th><td><i>	 * list, sixteen active lists, one bad frames class.</i></td></tr>
<tr><th id="2695">2695</th><td><i>	 */</i></td></tr>
<tr><th id="2696">2696</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2010, 0x181)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1022" title="0x2010" data-ref="_M/BGE_RXLP_CFG">BGE_RXLP_CFG</a>, <var>0x181</var>);</td></tr>
<tr><th id="2697">2697</th><td></td></tr>
<tr><th id="2698">2698</th><td>	<i>/* 5718 step 29, 57XX step 58 */</i></td></tr>
<tr><th id="2699">2699</th><td>	<i>/* Inialize RX list placement stats mask. */</i></td></tr>
<tr><th id="2700">2700</th><td>	<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2701">2701</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2018)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1024" title="0x2018" data-ref="_M/BGE_RXLP_STATS_ENABLE_MASK">BGE_RXLP_STATS_ENABLE_MASK</a>);</td></tr>
<tr><th id="2702">2702</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1112" title="0x00040000" data-ref="_M/BGE_RXLPSTATCONTROL_DACK_FIX">BGE_RXLPSTATCONTROL_DACK_FIX</a>;</td></tr>
<tr><th id="2703">2703</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2018, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1024" title="0x2018" data-ref="_M/BGE_RXLP_STATS_ENABLE_MASK">BGE_RXLP_STATS_ENABLE_MASK</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2704">2704</th><td>	} <b>else</b></td></tr>
<tr><th id="2705">2705</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2018, 0x007FFFFF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1024" title="0x2018" data-ref="_M/BGE_RXLP_STATS_ENABLE_MASK">BGE_RXLP_STATS_ENABLE_MASK</a>, <var>0x007FFFFF</var>);</td></tr>
<tr><th id="2706">2706</th><td></td></tr>
<tr><th id="2707">2707</th><td>	<i>/* 5718 step 30, 57XX step 59 */</i></td></tr>
<tr><th id="2708">2708</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2014, 0x1)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1023" title="0x2014" data-ref="_M/BGE_RXLP_STATS_CTL">BGE_RXLP_STATS_CTL</a>, <var>0x1</var>);</td></tr>
<tr><th id="2709">2709</th><td></td></tr>
<tr><th id="2710">2710</th><td>	<i>/* 5718 step 33, 57XX step 62 */</i></td></tr>
<tr><th id="2711">2711</th><td>	<i>/* Disable host coalescing until we get it set up */</i></td></tr>
<tr><th id="2712">2712</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C00, 0x00000000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1304" title="0x3C00" data-ref="_M/BGE_HCC_MODE">BGE_HCC_MODE</a>, <var>0x00000000</var>);</td></tr>
<tr><th id="2713">2713</th><td></td></tr>
<tr><th id="2714">2714</th><td>	<i>/* 5718 step 34, 57XX step 63 */</i></td></tr>
<tr><th id="2715">2715</th><td>	<i>/* Poll to make sure it's shut down. */</i></td></tr>
<tr><th id="2716">2716</th><td>	<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2717">2717</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="2718">2718</th><td>		<b>if</b> (!(<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C00)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1304" title="0x3C00" data-ref="_M/BGE_HCC_MODE">BGE_HCC_MODE</a>) &amp; <a class="macro" href="if_bgereg.h.html#1361" title="0x00000002" data-ref="_M/BGE_HCCMODE_ENABLE">BGE_HCCMODE_ENABLE</a>))</td></tr>
<tr><th id="2719">2719</th><td>			<b>break</b>;</td></tr>
<tr><th id="2720">2720</th><td>	}</td></tr>
<tr><th id="2721">2721</th><td></td></tr>
<tr><th id="2722">2722</th><td>	<b>if</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> == <a class="macro" href="if_bgevar.h.html#237" title="100000" data-ref="_M/BGE_TIMEOUT">BGE_TIMEOUT</a> * <var>2</var>) {</td></tr>
<tr><th id="2723">2723</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="2724">2724</th><td>		    <q>"host coalescing engine failed to idle\n"</q>);</td></tr>
<tr><th id="2725">2725</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a>;</td></tr>
<tr><th id="2726">2726</th><td>	}</td></tr>
<tr><th id="2727">2727</th><td></td></tr>
<tr><th id="2728">2728</th><td>	<i>/* 5718 step 35, 36, 37 */</i></td></tr>
<tr><th id="2729">2729</th><td>	<i>/* Set up host coalescing defaults */</i></td></tr>
<tr><th id="2730">2730</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C08, sc-&gt;bge_rx_coal_ticks)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1306" title="0x3C08" data-ref="_M/BGE_HCC_RX_COAL_TICKS">BGE_HCC_RX_COAL_TICKS</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_coal_ticks" title='bge_softc::bge_rx_coal_ticks' data-ref="bge_softc::bge_rx_coal_ticks" data-ref-filename="bge_softc..bge_rx_coal_ticks">bge_rx_coal_ticks</a>);</td></tr>
<tr><th id="2731">2731</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C0C, sc-&gt;bge_tx_coal_ticks)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1307" title="0x3C0C" data-ref="_M/BGE_HCC_TX_COAL_TICKS">BGE_HCC_TX_COAL_TICKS</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_coal_ticks" title='bge_softc::bge_tx_coal_ticks' data-ref="bge_softc::bge_tx_coal_ticks" data-ref-filename="bge_softc..bge_tx_coal_ticks">bge_tx_coal_ticks</a>);</td></tr>
<tr><th id="2732">2732</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C10, sc-&gt;bge_rx_max_coal_bds)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1308" title="0x3C10" data-ref="_M/BGE_HCC_RX_MAX_COAL_BDS">BGE_HCC_RX_MAX_COAL_BDS</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_max_coal_bds" title='bge_softc::bge_rx_max_coal_bds' data-ref="bge_softc::bge_rx_max_coal_bds" data-ref-filename="bge_softc..bge_rx_max_coal_bds">bge_rx_max_coal_bds</a>);</td></tr>
<tr><th id="2733">2733</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C14, sc-&gt;bge_tx_max_coal_bds)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1309" title="0x3C14" data-ref="_M/BGE_HCC_TX_MAX_COAL_BDS">BGE_HCC_TX_MAX_COAL_BDS</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_max_coal_bds" title='bge_softc::bge_tx_max_coal_bds' data-ref="bge_softc::bge_tx_max_coal_bds" data-ref-filename="bge_softc..bge_tx_max_coal_bds">bge_tx_max_coal_bds</a>);</td></tr>
<tr><th id="2734">2734</th><td>	<b>if</b> (!(<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))) {</td></tr>
<tr><th id="2735">2735</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C18, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1310" title="0x3C18" data-ref="_M/BGE_HCC_RX_COAL_TICKS_INT">BGE_HCC_RX_COAL_TICKS_INT</a>, <var>0</var>);</td></tr>
<tr><th id="2736">2736</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C1C, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1311" title="0x3C1C" data-ref="_M/BGE_HCC_TX_COAL_TICKS_INT">BGE_HCC_TX_COAL_TICKS_INT</a>, <var>0</var>);</td></tr>
<tr><th id="2737">2737</th><td>	}</td></tr>
<tr><th id="2738">2738</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C20, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1312" title="0x3C20" data-ref="_M/BGE_HCC_RX_MAX_COAL_BDS_INT">BGE_HCC_RX_MAX_COAL_BDS_INT</a>, <var>0</var>);</td></tr>
<tr><th id="2739">2739</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C24, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1313" title="0x3C24" data-ref="_M/BGE_HCC_TX_MAX_COAL_BDS_INT">BGE_HCC_TX_MAX_COAL_BDS_INT</a>, <var>0</var>);</td></tr>
<tr><th id="2740">2740</th><td></td></tr>
<tr><th id="2741">2741</th><td>	<i>/* Set up address of statistics block */</i></td></tr>
<tr><th id="2742">2742</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2743">2743</th><td>		<a class="macro" href="if_bgevar.h.html#74" title="do { (taddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_info.bge_stats))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (taddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_info.bge_stats))) &gt;&gt; 32); else (taddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>, <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_info.bge_stats))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_info.bge_stats));</td></tr>
<tr><th id="2744">2744</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C28, sc-&gt;bge_stat_ticks)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1314" title="0x3C28" data-ref="_M/BGE_HCC_STATS_TICKS">BGE_HCC_STATS_TICKS</a>, <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_stat_ticks" title='bge_softc::bge_stat_ticks' data-ref="bge_softc::bge_stat_ticks" data-ref-filename="bge_softc..bge_stat_ticks">bge_stat_ticks</a>);</td></tr>
<tr><th id="2745">2745</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C40, 0x00000300)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1319" title="0x3C40" data-ref="_M/BGE_HCC_STATS_BASEADDR">BGE_HCC_STATS_BASEADDR</a>, <a class="macro" href="if_bgereg.h.html#71" title="0x00000300" data-ref="_M/BGE_STATS_BLOCK">BGE_STATS_BLOCK</a>);</td></tr>
<tr><th id="2746">2746</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C30, taddr.bge_addr_hi)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1315" title="0x3C30" data-ref="_M/BGE_HCC_STATS_ADDR_HI">BGE_HCC_STATS_ADDR_HI</a>, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2747">2747</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C34, taddr.bge_addr_lo)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1316" title="0x3C34" data-ref="_M/BGE_HCC_STATS_ADDR_LO">BGE_HCC_STATS_ADDR_LO</a>, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2748">2748</th><td>	}</td></tr>
<tr><th id="2749">2749</th><td></td></tr>
<tr><th id="2750">2750</th><td>	<i>/* 5718 step 38 */</i></td></tr>
<tr><th id="2751">2751</th><td>	<i>/* Set up address of status block */</i></td></tr>
<tr><th id="2752">2752</th><td>	<a class="macro" href="if_bgevar.h.html#74" title="do { (taddr).bge_addr_lo = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_status_block))) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (taddr).bge_addr_hi = ((uint64_t) (((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_status_block))) &gt;&gt; 32); else (taddr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>, <a class="macro" href="if_bgevar.h.html#181" title="((sc)-&gt;bge_ring_map-&gt;dm_segs[0].ds_addr + __builtin_offsetof(struct bge_ring_data, bge_status_block))" data-ref="_M/BGE_RING_DMA_ADDR">BGE_RING_DMA_ADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, bge_status_block));</td></tr>
<tr><th id="2753">2753</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C44, 0x00000B00)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1320" title="0x3C44" data-ref="_M/BGE_HCC_STATUSBLK_BASEADDR">BGE_HCC_STATUSBLK_BASEADDR</a>, <a class="macro" href="if_bgereg.h.html#73" title="0x00000B00" data-ref="_M/BGE_STATUS_BLOCK">BGE_STATUS_BLOCK</a>);</td></tr>
<tr><th id="2754">2754</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C38, taddr.bge_addr_hi)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1317" title="0x3C38" data-ref="_M/BGE_HCC_STATUSBLK_ADDR_HI">BGE_HCC_STATUSBLK_ADDR_HI</a>, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>);</td></tr>
<tr><th id="2755">2755</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C3C, taddr.bge_addr_lo)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1318" title="0x3C3C" data-ref="_M/BGE_HCC_STATUSBLK_ADDR_LO">BGE_HCC_STATUSBLK_ADDR_LO</a>, <a class="local col4 ref" href="#204taddr" title='taddr' data-ref="204taddr" data-ref-filename="204taddr">taddr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_lo" title='(anonymous struct)::bge_addr_lo' data-ref="(anonymous)::bge_addr_lo" data-ref-filename="(anonymous)..bge_addr_lo">bge_addr_lo</a>);</td></tr>
<tr><th id="2756">2756</th><td>	<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_idx" title='bge_status_block::bge_idx' data-ref="bge_status_block::bge_idx" data-ref-filename="bge_status_block..bge_idx">bge_idx</a>[<var>0</var>].<a class="ref field" href="if_bgereg.h.html#bge_sts_idx::bge_rx_prod_idx" title='bge_sts_idx::bge_rx_prod_idx' data-ref="bge_sts_idx::bge_rx_prod_idx" data-ref-filename="bge_sts_idx..bge_rx_prod_idx">bge_rx_prod_idx</a> = <var>0</var>;</td></tr>
<tr><th id="2757">2757</th><td>	<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_idx" title='bge_status_block::bge_idx' data-ref="bge_status_block::bge_idx" data-ref-filename="bge_status_block..bge_idx">bge_idx</a>[<var>0</var>].<a class="ref field" href="if_bgereg.h.html#bge_sts_idx::bge_tx_cons_idx" title='bge_sts_idx::bge_tx_cons_idx' data-ref="bge_sts_idx::bge_tx_cons_idx" data-ref-filename="bge_sts_idx..bge_tx_cons_idx">bge_tx_cons_idx</a> = <var>0</var>;</td></tr>
<tr><th id="2758">2758</th><td></td></tr>
<tr><th id="2759">2759</th><td>	<i>/* Set up status block size. */</i></td></tr>
<tr><th id="2760">2760</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> &amp;&amp;</td></tr>
<tr><th id="2761">2761</th><td>	    <a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#292" title="0x7200" data-ref="_M/BGE_CHIPID_BCM5700_C0">BGE_CHIPID_BCM5700_C0</a>) {</td></tr>
<tr><th id="2762">2762</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#1374" title="0x00000000" data-ref="_M/BGE_STATBLKSZ_FULL">BGE_STATBLKSZ_FULL</a>;</td></tr>
<tr><th id="2763">2763</th><td>		<a class="macro" href="../../sys/systm.h.html#274" title="__builtin_memset((&amp;sc-&gt;bge_rdata-&gt;bge_status_block), 0, (sizeof (struct bge_status_block)))" data-ref="_M/bzero">bzero</a>(&amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>, <a class="macro" href="if_bgevar.h.html#208" title="sizeof (struct bge_status_block)" data-ref="_M/BGE_STATUS_BLK_SZ">BGE_STATUS_BLK_SZ</a>);</td></tr>
<tr><th id="2764">2764</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2765">2765</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#1376" title="0x00000100" data-ref="_M/BGE_STATBLKSZ_32BYTE">BGE_STATBLKSZ_32BYTE</a>;</td></tr>
<tr><th id="2766">2766</th><td>		<a class="macro" href="../../sys/systm.h.html#274" title="__builtin_memset((&amp;sc-&gt;bge_rdata-&gt;bge_status_block), 0, (32))" data-ref="_M/bzero">bzero</a>(&amp;<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>, <var>32</var>);</td></tr>
<tr><th id="2767">2767</th><td>	}</td></tr>
<tr><th id="2768">2768</th><td></td></tr>
<tr><th id="2769">2769</th><td>	<i>/* 5718 step 39, 57XX step 73 */</i></td></tr>
<tr><th id="2770">2770</th><td>	<i>/* Turn on host coalescing state machine */</i></td></tr>
<tr><th id="2771">2771</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C00, val | 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1304" title="0x3C00" data-ref="_M/BGE_HCC_MODE">BGE_HCC_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> | <a class="macro" href="if_bgereg.h.html#1361" title="0x00000002" data-ref="_M/BGE_HCCMODE_ENABLE">BGE_HCCMODE_ENABLE</a>);</td></tr>
<tr><th id="2772">2772</th><td></td></tr>
<tr><th id="2773">2773</th><td>	<i>/* 5718 step 40, 57XX step 74 */</i></td></tr>
<tr><th id="2774">2774</th><td>	<i>/* Turn on RX BD completion state machine and enable attentions */</i></td></tr>
<tr><th id="2775">2775</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3000, 0x00000002 | 0x00000004)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1203" title="0x3000" data-ref="_M/BGE_RBDC_MODE">BGE_RBDC_MODE</a>,</td></tr>
<tr><th id="2776">2776</th><td>	    <a class="macro" href="if_bgereg.h.html#1211" title="0x00000002" data-ref="_M/BGE_RBDCMODE_ENABLE">BGE_RBDCMODE_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#1212" title="0x00000004" data-ref="_M/BGE_RBDCMODE_ATTN">BGE_RBDCMODE_ATTN</a>);</td></tr>
<tr><th id="2777">2777</th><td></td></tr>
<tr><th id="2778">2778</th><td>	<i>/* 5718 step 41, 57XX step 75 */</i></td></tr>
<tr><th id="2779">2779</th><td>	<i>/* Turn on RX list placement state machine */</i></td></tr>
<tr><th id="2780">2780</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2000, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1018" title="0x2000" data-ref="_M/BGE_RXLP_MODE">BGE_RXLP_MODE</a>, <a class="macro" href="if_bgereg.h.html#1101" title="0x00000002" data-ref="_M/BGE_RXLPMODE_ENABLE">BGE_RXLPMODE_ENABLE</a>);</td></tr>
<tr><th id="2781">2781</th><td></td></tr>
<tr><th id="2782">2782</th><td>	<i>/* 57XX step 76 */</i></td></tr>
<tr><th id="2783">2783</th><td>	<i>/* Turn on RX list selector state machine. */</i></td></tr>
<tr><th id="2784">2784</th><td>	<b>if</b> (!(<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)))</td></tr>
<tr><th id="2785">2785</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3400, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1220" title="0x3400" data-ref="_M/BGE_RXLS_MODE">BGE_RXLS_MODE</a>, <a class="macro" href="if_bgereg.h.html#1225" title="0x00000002" data-ref="_M/BGE_RXLSMODE_ENABLE">BGE_RXLSMODE_ENABLE</a>);</td></tr>
<tr><th id="2786">2786</th><td></td></tr>
<tr><th id="2787">2787</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#715" title="0x00200000" data-ref="_M/BGE_MACMODE_TXDMA_ENB">BGE_MACMODE_TXDMA_ENB</a> | <a class="macro" href="if_bgereg.h.html#716" title="0x00400000" data-ref="_M/BGE_MACMODE_RXDMA_ENB">BGE_MACMODE_RXDMA_ENB</a> |</td></tr>
<tr><th id="2788">2788</th><td>	    <a class="macro" href="if_bgereg.h.html#706" title="0x00001000" data-ref="_M/BGE_MACMODE_RX_STATS_CLEAR">BGE_MACMODE_RX_STATS_CLEAR</a> | <a class="macro" href="if_bgereg.h.html#709" title="0x00008000" data-ref="_M/BGE_MACMODE_TX_STATS_CLEAR">BGE_MACMODE_TX_STATS_CLEAR</a> |</td></tr>
<tr><th id="2789">2789</th><td>	    <a class="macro" href="if_bgereg.h.html#705" title="0x00000800" data-ref="_M/BGE_MACMODE_RX_STATS_ENB">BGE_MACMODE_RX_STATS_ENB</a> | <a class="macro" href="if_bgereg.h.html#708" title="0x00004000" data-ref="_M/BGE_MACMODE_TX_STATS_ENB">BGE_MACMODE_TX_STATS_ENB</a> |</td></tr>
<tr><th id="2790">2790</th><td>	    <a class="macro" href="if_bgereg.h.html#717" title="0x00800000" data-ref="_M/BGE_MACMODE_FRMHDR_DMA_ENB">BGE_MACMODE_FRMHDR_DMA_ENB</a>;</td></tr>
<tr><th id="2791">2791</th><td></td></tr>
<tr><th id="2792">2792</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>)</td></tr>
<tr><th id="2793">2793</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#724" title="0x0000000C" data-ref="_M/BGE_PORTMODE_TBI">BGE_PORTMODE_TBI</a>;</td></tr>
<tr><th id="2794">2794</th><td>	<b>else</b> <b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2664" title="0x00000004" data-ref="_M/BGEF_FIBER_MII">BGEF_FIBER_MII</a>)</td></tr>
<tr><th id="2795">2795</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#723" title="0x00000008" data-ref="_M/BGE_PORTMODE_GMII">BGE_PORTMODE_GMII</a>;</td></tr>
<tr><th id="2796">2796</th><td>	<b>else</b></td></tr>
<tr><th id="2797">2797</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#722" title="0x00000004" data-ref="_M/BGE_PORTMODE_MII">BGE_PORTMODE_MII</a>;</td></tr>
<tr><th id="2798">2798</th><td></td></tr>
<tr><th id="2799">2799</th><td>	<i>/* 5718 step 42 and 43, 57XX step 77 and 78 */</i></td></tr>
<tr><th id="2800">2800</th><td>	<i>/* Allow APE to send/receive frames. */</i></td></tr>
<tr><th id="2801">2801</th><td>	<b>if</b> ((<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) != <var>0</var>)</td></tr>
<tr><th id="2802">2802</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#718" title="0x08000000" data-ref="_M/BGE_MACMODE_APE_RX_EN">BGE_MACMODE_APE_RX_EN</a> | <a class="macro" href="if_bgereg.h.html#719" title="0x10000000" data-ref="_M/BGE_MACMODE_APE_TX_EN">BGE_MACMODE_APE_TX_EN</a>;</td></tr>
<tr><th id="2803">2803</th><td></td></tr>
<tr><th id="2804">2804</th><td>	<i>/* Turn on DMA, clear stats */</i></td></tr>
<tr><th id="2805">2805</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2806">2806</th><td>	<i>/* 5718 step 44 */</i></td></tr>
<tr><th id="2807">2807</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="2808">2808</th><td></td></tr>
<tr><th id="2809">2809</th><td>	<i>/* 5718 step 45, 57XX step 79 */</i></td></tr>
<tr><th id="2810">2810</th><td>	<i>/* Set misc. local control, enable interrupts on attentions */</i></td></tr>
<tr><th id="2811">2811</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808) | (0x00000008)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>, <a class="macro" href="if_bgereg.h.html#2054" title="0x00000008" data-ref="_M/BGE_MLC_INTR_ONATTN">BGE_MLC_INTR_ONATTN</a>);</td></tr>
<tr><th id="2812">2812</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2813">2813</th><td>		<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>); <i>/* Flush */</i></td></tr>
<tr><th id="2814">2814</th><td>		<i>/* 5718 step 46 */</i></td></tr>
<tr><th id="2815">2815</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(100)" data-ref="_M/DELAY">DELAY</a>(<var>100</var>);</td></tr>
<tr><th id="2816">2816</th><td>	}</td></tr>
<tr><th id="2817">2817</th><td></td></tr>
<tr><th id="2818">2818</th><td>	<i>/* 57XX step 81 */</i></td></tr>
<tr><th id="2819">2819</th><td>	<i>/* Turn on DMA completion state machine */</i></td></tr>
<tr><th id="2820">2820</th><td>	<b>if</b> (!(<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)))</td></tr>
<tr><th id="2821">2821</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6400, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1887" title="0x6400" data-ref="_M/BGE_DMAC_MODE">BGE_DMAC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1891" title="0x00000002" data-ref="_M/BGE_DMACMODE_ENABLE">BGE_DMACMODE_ENABLE</a>);</td></tr>
<tr><th id="2822">2822</th><td></td></tr>
<tr><th id="2823">2823</th><td>	<i>/* 5718 step 47, 57XX step 82 */</i></td></tr>
<tr><th id="2824">2824</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#1585" title="0x00000002" data-ref="_M/BGE_WDMAMODE_ENABLE">BGE_WDMAMODE_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#1594" title="0x000003FC" data-ref="_M/BGE_WDMAMODE_ALL_ATTNS">BGE_WDMAMODE_ALL_ATTNS</a>;</td></tr>
<tr><th id="2825">2825</th><td></td></tr>
<tr><th id="2826">2826</th><td>	<i>/* 5718 step 48 */</i></td></tr>
<tr><th id="2827">2827</th><td>	<i>/* Enable host coalescing bug fix. */</i></td></tr>
<tr><th id="2828">2828</th><td>	<b>if</b> (<a class="macro" href="#414" title="((sc)-&gt;bge_flags &amp; 0x00004000)" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2829">2829</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1595" title="0x20000000" data-ref="_M/BGE_WDMAMODE_STATUS_TAG_FIX">BGE_WDMAMODE_STATUS_TAG_FIX</a>;</td></tr>
<tr><th id="2830">2830</th><td></td></tr>
<tr><th id="2831">2831</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>)</td></tr>
<tr><th id="2832">2832</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1596" title="0xC0000000" data-ref="_M/BGE_WDMAMODE_BURST_ALL_DATA">BGE_WDMAMODE_BURST_ALL_DATA</a>;</td></tr>
<tr><th id="2833">2833</th><td></td></tr>
<tr><th id="2834">2834</th><td>	<i>/* Turn on write DMA state machine */</i></td></tr>
<tr><th id="2835">2835</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4C00, val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4C00); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1580" title="0x4C00" data-ref="_M/BGE_WDMA_MODE">BGE_WDMA_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2836">2836</th><td>	<i>/* 5718 step 49 */</i></td></tr>
<tr><th id="2837">2837</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="2838">2838</th><td></td></tr>
<tr><th id="2839">2839</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#1511" title="0x00000002" data-ref="_M/BGE_RDMAMODE_ENABLE">BGE_RDMAMODE_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#1520" title="0x000003FC" data-ref="_M/BGE_RDMAMODE_ALL_ATTNS">BGE_RDMAMODE_ALL_ATTNS</a>;</td></tr>
<tr><th id="2840">2840</th><td></td></tr>
<tr><th id="2841">2841</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a>)</td></tr>
<tr><th id="2842">2842</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1527" title="0x01000000" data-ref="_M/BGE_RDMAMODE_MULT_DMA_RD_DIS">BGE_RDMAMODE_MULT_DMA_RD_DIS</a>;</td></tr>
<tr><th id="2843">2843</th><td></td></tr>
<tr><th id="2844">2844</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a> ||</td></tr>
<tr><th id="2845">2845</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a> ||</td></tr>
<tr><th id="2846">2846</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>)</td></tr>
<tr><th id="2847">2847</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1521" title="0x00000800" data-ref="_M/BGE_RDMAMODE_BD_SBD_CRPT_ATTN">BGE_RDMAMODE_BD_SBD_CRPT_ATTN</a> |</td></tr>
<tr><th id="2848">2848</th><td>		    <a class="macro" href="if_bgereg.h.html#1522" title="0x00001000" data-ref="_M/BGE_RDMAMODE_MBUF_RBD_CRPT_ATTN">BGE_RDMAMODE_MBUF_RBD_CRPT_ATTN</a> |</td></tr>
<tr><th id="2849">2849</th><td>		    <a class="macro" href="if_bgereg.h.html#1523" title="0x00002000" data-ref="_M/BGE_RDMAMODE_MBUF_SBD_CRPT_ATTN">BGE_RDMAMODE_MBUF_SBD_CRPT_ATTN</a>;</td></tr>
<tr><th id="2850">2850</th><td></td></tr>
<tr><th id="2851">2851</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>)</td></tr>
<tr><th id="2852">2852</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1525" title="0x00030000" data-ref="_M/BGE_RDMAMODE_FIFO_LONG_BURST">BGE_RDMAMODE_FIFO_LONG_BURST</a>;</td></tr>
<tr><th id="2853">2853</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#380" title="0x57766" data-ref="_M/BGE_ASICREV_BCM57766">BGE_ASICREV_BCM57766</a>) {</td></tr>
<tr><th id="2854">2854</th><td>		<b>if</b> (<a class="local col3 ref" href="#203ifp" title='ifp' data-ref="203ifp" data-ref-filename="203ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#396" title="if_data.ifi_mtu" data-ref="_M/if_mtu">if_mtu</a> &lt;= <a class="macro" href="../../net/if_ether.h.html#99" title="(1518 - ((6 * 2) + 2) - 4)" data-ref="_M/ETHERMTU">ETHERMTU</a>)</td></tr>
<tr><th id="2855">2855</th><td>			<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1526" title="0x00800000" data-ref="_M/BGE_RDMAMODE_JMB_2K_MMRR">BGE_RDMAMODE_JMB_2K_MMRR</a>;</td></tr>
<tr><th id="2856">2856</th><td>	}</td></tr>
<tr><th id="2857">2857</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2670" title="0x00000100" data-ref="_M/BGEF_TSO">BGEF_TSO</a>) {</td></tr>
<tr><th id="2858">2858</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1528" title="0x08000000" data-ref="_M/BGE_RDMAMODE_TSO4_ENABLE">BGE_RDMAMODE_TSO4_ENABLE</a>;</td></tr>
<tr><th id="2859">2859</th><td>		<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2860">2860</th><td>			<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1529" title="0x10000000" data-ref="_M/BGE_RDMAMODE_TSO6_ENABLE">BGE_RDMAMODE_TSO6_ENABLE</a>;</td></tr>
<tr><th id="2861">2861</th><td>	}</td></tr>
<tr><th id="2862">2862</th><td></td></tr>
<tr><th id="2863">2863</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a> ||</td></tr>
<tr><th id="2864">2864</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="2865">2865</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4800)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1502" title="0x4800" data-ref="_M/BGE_RDMA_MODE">BGE_RDMA_MODE</a>) &amp;</td></tr>
<tr><th id="2866">2866</th><td>		    <a class="macro" href="if_bgereg.h.html#1530" title="0x20000000" data-ref="_M/BGE_RDMAMODE_H2BNC_VLAN_DET">BGE_RDMAMODE_H2BNC_VLAN_DET</a>;</td></tr>
<tr><th id="2867">2867</th><td>		<i>/*</i></td></tr>
<tr><th id="2868">2868</th><td><i>		 * Allow multiple outstanding read requests from</i></td></tr>
<tr><th id="2869">2869</th><td><i>		 * non-LSO read DMA engine.</i></td></tr>
<tr><th id="2870">2870</th><td><i>		 */</i></td></tr>
<tr><th id="2871">2871</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1527" title="0x01000000" data-ref="_M/BGE_RDMAMODE_MULT_DMA_RD_DIS">BGE_RDMAMODE_MULT_DMA_RD_DIS</a>;</td></tr>
<tr><th id="2872">2872</th><td>	}</td></tr>
<tr><th id="2873">2873</th><td></td></tr>
<tr><th id="2874">2874</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a> ||</td></tr>
<tr><th id="2875">2875</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a> ||</td></tr>
<tr><th id="2876">2876</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a> ||</td></tr>
<tr><th id="2877">2877</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a> ||</td></tr>
<tr><th id="2878">2878</th><td>	    <a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>)) {</td></tr>
<tr><th id="2879">2879</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>)</td></tr>
<tr><th id="2880">2880</th><td>			<a class="local col6 ref" href="#206rdmareg" title='rdmareg' data-ref="206rdmareg" data-ref-filename="206rdmareg">rdmareg</a> = <a class="macro" href="if_bgereg.h.html#1504" title="0x4890" data-ref="_M/BGE_RDMA_RSRVCTRL_REG2">BGE_RDMA_RSRVCTRL_REG2</a>;</td></tr>
<tr><th id="2881">2881</th><td>		<b>else</b></td></tr>
<tr><th id="2882">2882</th><td>			<a class="local col6 ref" href="#206rdmareg" title='rdmareg' data-ref="206rdmareg" data-ref-filename="206rdmareg">rdmareg</a> = <a class="macro" href="if_bgereg.h.html#1506" title="0x4900" data-ref="_M/BGE_RDMA_RSRVCTRL">BGE_RDMA_RSRVCTRL</a>;</td></tr>
<tr><th id="2883">2883</th><td>		<a class="local col5 ref" href="#205dmactl" title='dmactl' data-ref="205dmactl" data-ref-filename="205dmactl">dmactl</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rdmareg)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col6 ref" href="#206rdmareg" title='rdmareg' data-ref="206rdmareg" data-ref-filename="206rdmareg">rdmareg</a>);</td></tr>
<tr><th id="2884">2884</th><td>		<i>/*</i></td></tr>
<tr><th id="2885">2885</th><td><i>		 * Adjust tx margin to prevent TX data corruption and</i></td></tr>
<tr><th id="2886">2886</th><td><i>		 * fix internal FIFO overflow.</i></td></tr>
<tr><th id="2887">2887</th><td><i>		 */</i></td></tr>
<tr><th id="2888">2888</th><td>		<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a> ||</td></tr>
<tr><th id="2889">2889</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="2890">2890</th><td>			<a class="local col5 ref" href="#205dmactl" title='dmactl' data-ref="205dmactl" data-ref-filename="205dmactl">dmactl</a> &amp;= ~(<a class="macro" href="if_bgereg.h.html#1547" title="0x00000FF0" data-ref="_M/BGE_RDMA_RSRVCTRL_FIFO_LWM_MASK">BGE_RDMA_RSRVCTRL_FIFO_LWM_MASK</a> |</td></tr>
<tr><th id="2891">2891</th><td>			    <a class="macro" href="if_bgereg.h.html#1548" title="0x000FF000" data-ref="_M/BGE_RDMA_RSRVCTRL_FIFO_HWM_MASK">BGE_RDMA_RSRVCTRL_FIFO_HWM_MASK</a> |</td></tr>
<tr><th id="2892">2892</th><td>			    <a class="macro" href="if_bgereg.h.html#1549" title="0xFFE00000" data-ref="_M/BGE_RDMA_RSRVCTRL_TXMRGN_MASK">BGE_RDMA_RSRVCTRL_TXMRGN_MASK</a>);</td></tr>
<tr><th id="2893">2893</th><td>			<a class="local col5 ref" href="#205dmactl" title='dmactl' data-ref="205dmactl" data-ref-filename="205dmactl">dmactl</a> |= <a class="macro" href="if_bgereg.h.html#1544" title="0x00000C00" data-ref="_M/BGE_RDMA_RSRVCTRL_FIFO_LWM_1_5K">BGE_RDMA_RSRVCTRL_FIFO_LWM_1_5K</a> |</td></tr>
<tr><th id="2894">2894</th><td>			    <a class="macro" href="if_bgereg.h.html#1545" title="0x000C0000" data-ref="_M/BGE_RDMA_RSRVCTRL_FIFO_HWM_1_5K">BGE_RDMA_RSRVCTRL_FIFO_HWM_1_5K</a> |</td></tr>
<tr><th id="2895">2895</th><td>			    <a class="macro" href="if_bgereg.h.html#1546" title="0x28000000" data-ref="_M/BGE_RDMA_RSRVCTRL_TXMRGN_320B">BGE_RDMA_RSRVCTRL_TXMRGN_320B</a>;</td></tr>
<tr><th id="2896">2896</th><td>		}</td></tr>
<tr><th id="2897">2897</th><td>		<i>/*</i></td></tr>
<tr><th id="2898">2898</th><td><i>		 * Enable fix for read DMA FIFO overruns.</i></td></tr>
<tr><th id="2899">2899</th><td><i>		 * The fix is to limit the number of RX BDs</i></td></tr>
<tr><th id="2900">2900</th><td><i>		 * the hardware would fetch at a fime.</i></td></tr>
<tr><th id="2901">2901</th><td><i>		 */</i></td></tr>
<tr><th id="2902">2902</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, rdmareg, dmactl | 0x00000004)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="local col6 ref" href="#206rdmareg" title='rdmareg' data-ref="206rdmareg" data-ref-filename="206rdmareg">rdmareg</a>, <a class="local col5 ref" href="#205dmactl" title='dmactl' data-ref="205dmactl" data-ref-filename="205dmactl">dmactl</a> |</td></tr>
<tr><th id="2903">2903</th><td>		    <a class="macro" href="if_bgereg.h.html#1543" title="0x00000004" data-ref="_M/BGE_RDMA_RSRVCTRL_FIFO_OFLW_FIX">BGE_RDMA_RSRVCTRL_FIFO_OFLW_FIX</a>);</td></tr>
<tr><th id="2904">2904</th><td>	}</td></tr>
<tr><th id="2905">2905</th><td></td></tr>
<tr><th id="2906">2906</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>) {</td></tr>
<tr><th id="2907">2907</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910, bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910) | 0x00030000 | 0x000C0000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>,</td></tr>
<tr><th id="2908">2908</th><td>		    <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>) |</td></tr>
<tr><th id="2909">2909</th><td>		    <a class="macro" href="if_bgereg.h.html#1553" title="0x00030000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_4K">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_4K</a> |</td></tr>
<tr><th id="2910">2910</th><td>		    <a class="macro" href="if_bgereg.h.html#1554" title="0x000C0000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K</a>);</td></tr>
<tr><th id="2911">2911</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>) {</td></tr>
<tr><th id="2912">2912</th><td>		<i>/*</i></td></tr>
<tr><th id="2913">2913</th><td><i>		 * Allow 4KB burst length reads for non-LSO frames.</i></td></tr>
<tr><th id="2914">2914</th><td><i>		 * Enable 512B burst length reads for buffer descriptors.</i></td></tr>
<tr><th id="2915">2915</th><td><i>		 */</i></td></tr>
<tr><th id="2916">2916</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910, bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910) | 0x00020000 | 0x000C0000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>,</td></tr>
<tr><th id="2917">2917</th><td>		    <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>) |</td></tr>
<tr><th id="2918">2918</th><td>		    <a class="macro" href="if_bgereg.h.html#1552" title="0x00020000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_512">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_512</a> |</td></tr>
<tr><th id="2919">2919</th><td>		    <a class="macro" href="if_bgereg.h.html#1554" title="0x000C0000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K</a>);</td></tr>
<tr><th id="2920">2920</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="2921">2921</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x48A0, bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x48A0) | 0x00030000 | 0x000C0000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1505" title="0x48A0" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_REG2">BGE_RDMA_LSO_CRPTEN_CTRL_REG2</a>,</td></tr>
<tr><th id="2922">2922</th><td>		    <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x48A0)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1505" title="0x48A0" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_REG2">BGE_RDMA_LSO_CRPTEN_CTRL_REG2</a>) |</td></tr>
<tr><th id="2923">2923</th><td>		    <a class="macro" href="if_bgereg.h.html#1553" title="0x00030000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_4K">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_BD_4K</a> |</td></tr>
<tr><th id="2924">2924</th><td>		    <a class="macro" href="if_bgereg.h.html#1554" title="0x000C0000" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K">BGE_RDMA_LSO_CRPTEN_CTRL_BLEN_LSO_4K</a>);</td></tr>
<tr><th id="2925">2925</th><td>	}</td></tr>
<tr><th id="2926">2926</th><td>	<i>/* Turn on read DMA state machine */</i></td></tr>
<tr><th id="2927">2927</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4800, val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4800); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1502" title="0x4800" data-ref="_M/BGE_RDMA_MODE">BGE_RDMA_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2928">2928</th><td>	<i>/* 5718 step 52 */</i></td></tr>
<tr><th id="2929">2929</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(40)" data-ref="_M/delay">delay</a>(<var>40</var>);</td></tr>
<tr><th id="2930">2930</th><td></td></tr>
<tr><th id="2931">2931</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2684" title="0x00800000" data-ref="_M/BGEF_RDMA_BUG">BGEF_RDMA_BUG</a>) {</td></tr>
<tr><th id="2932">2932</th><td>		<b>for</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> = <var>0</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> &lt; <a class="macro" href="if_bgereg.h.html#1575" title="4" data-ref="_M/BGE_NUM_RDMA_CHANNELS">BGE_NUM_RDMA_CHANNELS</a> / <var>2</var>; <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a>++) {</td></tr>
<tr><th id="2933">2933</th><td>			<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4BE0 + i * 4)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1574" title="0x4BE0" data-ref="_M/BGE_RDMA_LENGTH">BGE_RDMA_LENGTH</a> + <a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> * <var>4</var>);</td></tr>
<tr><th id="2934">2934</th><td>			<b>if</b> ((<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> &amp; <var>0xFFFF</var>) &gt; <a class="macro" href="if_bgereg.h.html#2632" title="1518" data-ref="_M/BGE_FRAMELEN">BGE_FRAMELEN</a>)</td></tr>
<tr><th id="2935">2935</th><td>				<b>break</b>;</td></tr>
<tr><th id="2936">2936</th><td>			<b>if</b> (((<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> &gt;&gt; <var>16</var>) &amp; <var>0xFFFF</var>) &gt; <a class="macro" href="if_bgereg.h.html#2632" title="1518" data-ref="_M/BGE_FRAMELEN">BGE_FRAMELEN</a>)</td></tr>
<tr><th id="2937">2937</th><td>				<b>break</b>;</td></tr>
<tr><th id="2938">2938</th><td>		}</td></tr>
<tr><th id="2939">2939</th><td>		<b>if</b> (<a class="local col9 ref" href="#209i" title='i' data-ref="209i" data-ref-filename="209i">i</a> != <a class="macro" href="if_bgereg.h.html#1575" title="4" data-ref="_M/BGE_NUM_RDMA_CHANNELS">BGE_NUM_RDMA_CHANNELS</a> / <var>2</var>) {</td></tr>
<tr><th id="2940">2940</th><td>			<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>);</td></tr>
<tr><th id="2941">2941</th><td>			<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>)</td></tr>
<tr><th id="2942">2942</th><td>				<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1555" title="0x02000000" data-ref="_M/BGE_RDMA_TX_LENGTH_WA_5719">BGE_RDMA_TX_LENGTH_WA_5719</a>;</td></tr>
<tr><th id="2943">2943</th><td>			<b>else</b></td></tr>
<tr><th id="2944">2944</th><td>				<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#1556" title="0x00200000" data-ref="_M/BGE_RDMA_TX_LENGTH_WA_5720">BGE_RDMA_TX_LENGTH_WA_5720</a>;</td></tr>
<tr><th id="2945">2945</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2946">2946</th><td>		}</td></tr>
<tr><th id="2947">2947</th><td>	}</td></tr>
<tr><th id="2948">2948</th><td></td></tr>
<tr><th id="2949">2949</th><td>	<i>/* 5718 step 56, 57XX step 84 */</i></td></tr>
<tr><th id="2950">2950</th><td>	<i>/* Turn on RX data completion state machine */</i></td></tr>
<tr><th id="2951">2951</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2800, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1170" title="0x2800" data-ref="_M/BGE_RDC_MODE">BGE_RDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1174" title="0x00000002" data-ref="_M/BGE_RDCMODE_ENABLE">BGE_RDCMODE_ENABLE</a>);</td></tr>
<tr><th id="2952">2952</th><td></td></tr>
<tr><th id="2953">2953</th><td>	<i>/* Turn on RX data and RX BD initiator state machine */</i></td></tr>
<tr><th id="2954">2954</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2400, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1118" title="0x2400" data-ref="_M/BGE_RDBDI_MODE">BGE_RDBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#1156" title="0x00000002" data-ref="_M/BGE_RDBDIMODE_ENABLE">BGE_RDBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="2955">2955</th><td></td></tr>
<tr><th id="2956">2956</th><td>	<i>/* 57XX step 85 */</i></td></tr>
<tr><th id="2957">2957</th><td>	<i>/* Turn on Mbuf cluster free state machine */</i></td></tr>
<tr><th id="2958">2958</th><td>	<b>if</b> (!<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>))</td></tr>
<tr><th id="2959">2959</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3800, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1290" title="0x3800" data-ref="_M/BGE_MBCF_MODE">BGE_MBCF_MODE</a>, <a class="macro" href="if_bgereg.h.html#1295" title="0x00000002" data-ref="_M/BGE_MBCFMODE_ENABLE">BGE_MBCFMODE_ENABLE</a>);</td></tr>
<tr><th id="2960">2960</th><td></td></tr>
<tr><th id="2961">2961</th><td>	<i>/* 5718 step 57, 57XX step 86 */</i></td></tr>
<tr><th id="2962">2962</th><td>	<i>/* Turn on send data completion state machine */</i></td></tr>
<tr><th id="2963">2963</th><td>	<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> = <a class="macro" href="if_bgereg.h.html#927" title="0x00000002" data-ref="_M/BGE_SDCMODE_ENABLE">BGE_SDCMODE_ENABLE</a>;</td></tr>
<tr><th id="2964">2964</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>)</td></tr>
<tr><th id="2965">2965</th><td>		<a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a> |= <a class="macro" href="if_bgereg.h.html#929" title="0x00000010" data-ref="_M/BGE_SDCMODE_CDELAY">BGE_SDCMODE_CDELAY</a>;</td></tr>
<tr><th id="2966">2966</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x1000, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#922" title="0x1000" data-ref="_M/BGE_SDC_MODE">BGE_SDC_MODE</a>, <a class="local col8 ref" href="#208val" title='val' data-ref="208val" data-ref-filename="208val">val</a>);</td></tr>
<tr><th id="2967">2967</th><td></td></tr>
<tr><th id="2968">2968</th><td>	<i>/* 5718 step 58 */</i></td></tr>
<tr><th id="2969">2969</th><td>	<i>/* Turn on send BD completion state machine */</i></td></tr>
<tr><th id="2970">2970</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x1C00, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1004" title="0x1C00" data-ref="_M/BGE_SBDC_MODE">BGE_SBDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1009" title="0x00000002" data-ref="_M/BGE_SBDCMODE_ENABLE">BGE_SBDCMODE_ENABLE</a>);</td></tr>
<tr><th id="2971">2971</th><td></td></tr>
<tr><th id="2972">2972</th><td>	<i>/* 57XX step 88 */</i></td></tr>
<tr><th id="2973">2973</th><td>	<i>/* Turn on RX BD initiator state machine */</i></td></tr>
<tr><th id="2974">2974</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2C00, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1180" title="0x2C00" data-ref="_M/BGE_RBDI_MODE">BGE_RBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#1194" title="0x00000002" data-ref="_M/BGE_RBDIMODE_ENABLE">BGE_RBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="2975">2975</th><td></td></tr>
<tr><th id="2976">2976</th><td>	<i>/* 5718 step 60, 57XX step 90 */</i></td></tr>
<tr><th id="2977">2977</th><td>	<i>/* Turn on send data initiator state machine */</i></td></tr>
<tr><th id="2978">2978</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2670" title="0x00000100" data-ref="_M/BGEF_TSO">BGEF_TSO</a>) {</td></tr>
<tr><th id="2979">2979</th><td>		<i>/* XXX: magic value from Linux driver */</i></td></tr>
<tr><th id="2980">2980</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C00, 0x00000002 | 0x00000008)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#872" title="0x0C00" data-ref="_M/BGE_SDI_MODE">BGE_SDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#905" title="0x00000002" data-ref="_M/BGE_SDIMODE_ENABLE">BGE_SDIMODE_ENABLE</a> |</td></tr>
<tr><th id="2981">2981</th><td>		    <a class="macro" href="if_bgereg.h.html#907" title="0x00000008" data-ref="_M/BGE_SDIMODE_HW_LSO_PRE_DMA">BGE_SDIMODE_HW_LSO_PRE_DMA</a>);</td></tr>
<tr><th id="2982">2982</th><td>	} <b>else</b></td></tr>
<tr><th id="2983">2983</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C00, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#872" title="0x0C00" data-ref="_M/BGE_SDI_MODE">BGE_SDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#905" title="0x00000002" data-ref="_M/BGE_SDIMODE_ENABLE">BGE_SDIMODE_ENABLE</a>);</td></tr>
<tr><th id="2984">2984</th><td></td></tr>
<tr><th id="2985">2985</th><td>	<i>/* 5718 step 61, 57XX step 91 */</i></td></tr>
<tr><th id="2986">2986</th><td>	<i>/* Turn on send BD initiator state machine */</i></td></tr>
<tr><th id="2987">2987</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x1800, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#974" title="0x1800" data-ref="_M/BGE_SBDI_MODE">BGE_SBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#995" title="0x00000002" data-ref="_M/BGE_SBDIMODE_ENABLE">BGE_SBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="2988">2988</th><td></td></tr>
<tr><th id="2989">2989</th><td>	<i>/* 5718 step 62, 57XX step 92 */</i></td></tr>
<tr><th id="2990">2990</th><td>	<i>/* Turn on send BD selector state machine */</i></td></tr>
<tr><th id="2991">2991</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x1400, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#937" title="0x1400" data-ref="_M/BGE_SRS_MODE">BGE_SRS_MODE</a>, <a class="macro" href="if_bgereg.h.html#959" title="0x00000002" data-ref="_M/BGE_SRSMODE_ENABLE">BGE_SRSMODE_ENABLE</a>);</td></tr>
<tr><th id="2992">2992</th><td></td></tr>
<tr><th id="2993">2993</th><td>	<i>/* 5718 step 31, 57XX step 60 */</i></td></tr>
<tr><th id="2994">2994</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C0C, 0x007FFFFF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#875" title="0x0C0C" data-ref="_M/BGE_SDI_STATS_ENABLE_MASK">BGE_SDI_STATS_ENABLE_MASK</a>, <var>0x007FFFFF</var>);</td></tr>
<tr><th id="2995">2995</th><td>	<i>/* 5718 step 32, 57XX step 61 */</i></td></tr>
<tr><th id="2996">2996</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0C08, 0x00000001 | 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#874" title="0x0C08" data-ref="_M/BGE_SDI_STATS_CTL">BGE_SDI_STATS_CTL</a>,</td></tr>
<tr><th id="2997">2997</th><td>	    <a class="macro" href="if_bgereg.h.html#913" title="0x00000001" data-ref="_M/BGE_SDISTATSCTL_ENABLE">BGE_SDISTATSCTL_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#914" title="0x00000002" data-ref="_M/BGE_SDISTATSCTL_FASTER">BGE_SDISTATSCTL_FASTER</a>);</td></tr>
<tr><th id="2998">2998</th><td></td></tr>
<tr><th id="2999">2999</th><td>	<i>/* ack/clear link change events */</i></td></tr>
<tr><th id="3000">3000</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404, 0x00000010 | 0x00000008 | 0x00400000 | 0x00001000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>, <a class="macro" href="if_bgereg.h.html#731" title="0x00000010" data-ref="_M/BGE_MACSTAT_SYNC_CHANGED">BGE_MACSTAT_SYNC_CHANGED</a> |</td></tr>
<tr><th id="3001">3001</th><td>	    <a class="macro" href="if_bgereg.h.html#730" title="0x00000008" data-ref="_M/BGE_MACSTAT_CFG_CHANGED">BGE_MACSTAT_CFG_CHANGED</a> | <a class="macro" href="if_bgereg.h.html#734" title="0x00400000" data-ref="_M/BGE_MACSTAT_MI_COMPLETE">BGE_MACSTAT_MI_COMPLETE</a> |</td></tr>
<tr><th id="3002">3002</th><td>	    <a class="macro" href="if_bgereg.h.html#733" title="0x00001000" data-ref="_M/BGE_MACSTAT_LINK_CHANGED">BGE_MACSTAT_LINK_CHANGED</a>);</td></tr>
<tr><th id="3003">3003</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0450, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#645" title="0x0450" data-ref="_M/BGE_MI_STS">BGE_MI_STS</a>, <var>0</var>);</td></tr>
<tr><th id="3004">3004</th><td></td></tr>
<tr><th id="3005">3005</th><td>	<i>/*</i></td></tr>
<tr><th id="3006">3006</th><td><i>	 * Enable attention when the link has changed state for</i></td></tr>
<tr><th id="3007">3007</th><td><i>	 * devices that use auto polling.</i></td></tr>
<tr><th id="3008">3008</th><td><i>	 */</i></td></tr>
<tr><th id="3009">3009</th><td>	<b>if</b> (<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="3010">3010</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0450, 0x00000001)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#645" title="0x0450" data-ref="_M/BGE_MI_STS">BGE_MI_STS</a>, <a class="macro" href="if_bgereg.h.html#856" title="0x00000001" data-ref="_M/BGE_MISTS_LINK">BGE_MISTS_LINK</a>);</td></tr>
<tr><th id="3011">3011</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3012">3012</th><td>		<b>if</b> ((<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2665" title="0x00000008" data-ref="_M/BGEF_CPMU_PRESENT">BGEF_CPMU_PRESENT</a>) != <var>0</var>)</td></tr>
<tr><th id="3013">3013</th><td>			<a class="local col7 ref" href="#207mimode" title='mimode' data-ref="207mimode" data-ref-filename="207mimode">mimode</a> = <a class="macro" href="if_bgereg.h.html#864" title="0x00008000" data-ref="_M/BGE_MIMODE_500KHZ_CONST">BGE_MIMODE_500KHZ_CONST</a>;</td></tr>
<tr><th id="3014">3014</th><td>		<b>else</b></td></tr>
<tr><th id="3015">3015</th><td>			<a class="local col7 ref" href="#207mimode" title='mimode' data-ref="207mimode" data-ref-filename="207mimode">mimode</a> = <a class="macro" href="if_bgereg.h.html#865" title="0x000C0000" data-ref="_M/BGE_MIMODE_BASE">BGE_MIMODE_BASE</a>;</td></tr>
<tr><th id="3016">3016</th><td>		<i>/* 5718 step 68. 5718 step 69 (optionally). */</i></td></tr>
<tr><th id="3017">3017</th><td>		<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>) ||</td></tr>
<tr><th id="3018">3018</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a>) {</td></tr>
<tr><th id="3019">3019</th><td>			<a class="local col7 ref" href="#207mimode" title='mimode' data-ref="207mimode" data-ref-filename="207mimode">mimode</a> |= <a class="macro" href="if_bgereg.h.html#860" title="0x00000010" data-ref="_M/BGE_MIMODE_AUTOPOLL">BGE_MIMODE_AUTOPOLL</a>;</td></tr>
<tr><th id="3020">3020</th><td>			<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000004))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>);</td></tr>
<tr><th id="3021">3021</th><td>		}</td></tr>
<tr><th id="3022">3022</th><td>		<a class="local col7 ref" href="#207mimode" title='mimode' data-ref="207mimode" data-ref-filename="207mimode">mimode</a> |= <a class="macro" href="if_bgereg.h.html#867" title="((sc-&gt;bge_phy_addr) &lt;&lt; 5)" data-ref="_M/BGE_MIMODE_PHYADDR">BGE_MIMODE_PHYADDR</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a>);</td></tr>
<tr><th id="3023">3023</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, mimode)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="local col7 ref" href="#207mimode" title='mimode' data-ref="207mimode" data-ref-filename="207mimode">mimode</a>);</td></tr>
<tr><th id="3024">3024</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a>)</td></tr>
<tr><th id="3025">3025</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0408, 0x00800000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#627" title="0x0408" data-ref="_M/BGE_MAC_EVT_ENB">BGE_MAC_EVT_ENB</a>,</td></tr>
<tr><th id="3026">3026</th><td>			    <a class="macro" href="if_bgereg.h.html#745" title="0x00800000" data-ref="_M/BGE_EVTENB_MI_INTERRUPT">BGE_EVTENB_MI_INTERRUPT</a>);</td></tr>
<tr><th id="3027">3027</th><td>	}</td></tr>
<tr><th id="3028">3028</th><td></td></tr>
<tr><th id="3029">3029</th><td>	<i>/*</i></td></tr>
<tr><th id="3030">3030</th><td><i>	 * Clear any pending link state attention.</i></td></tr>
<tr><th id="3031">3031</th><td><i>	 * Otherwise some link state change events may be lost until attention</i></td></tr>
<tr><th id="3032">3032</th><td><i>	 * is cleared by bge_intr() -&gt; bge_link_upd() sequence.</i></td></tr>
<tr><th id="3033">3033</th><td><i>	 * It's not necessary on newer BCM chips - perhaps enabling link</i></td></tr>
<tr><th id="3034">3034</th><td><i>	 * state change attentions implies clearing pending attention.</i></td></tr>
<tr><th id="3035">3035</th><td><i>	 */</i></td></tr>
<tr><th id="3036">3036</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404, 0x00000010 | 0x00000008 | 0x00400000 | 0x00001000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>, <a class="macro" href="if_bgereg.h.html#731" title="0x00000010" data-ref="_M/BGE_MACSTAT_SYNC_CHANGED">BGE_MACSTAT_SYNC_CHANGED</a> |</td></tr>
<tr><th id="3037">3037</th><td>	    <a class="macro" href="if_bgereg.h.html#730" title="0x00000008" data-ref="_M/BGE_MACSTAT_CFG_CHANGED">BGE_MACSTAT_CFG_CHANGED</a> | <a class="macro" href="if_bgereg.h.html#734" title="0x00400000" data-ref="_M/BGE_MACSTAT_MI_COMPLETE">BGE_MACSTAT_MI_COMPLETE</a> |</td></tr>
<tr><th id="3038">3038</th><td>	    <a class="macro" href="if_bgereg.h.html#733" title="0x00001000" data-ref="_M/BGE_MACSTAT_LINK_CHANGED">BGE_MACSTAT_LINK_CHANGED</a>);</td></tr>
<tr><th id="3039">3039</th><td></td></tr>
<tr><th id="3040">3040</th><td>	<i>/* Enable link state change attentions. */</i></td></tr>
<tr><th id="3041">3041</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0408, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0408) | (0x00001000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col0 ref" href="#200sc" title='sc' data-ref="200sc" data-ref-filename="200sc">sc</a>, <a class="macro" href="if_bgereg.h.html#627" title="0x0408" data-ref="_M/BGE_MAC_EVT_ENB">BGE_MAC_EVT_ENB</a>, <a class="macro" href="if_bgereg.h.html#743" title="0x00001000" data-ref="_M/BGE_EVTENB_LINK_CHANGED">BGE_EVTENB_LINK_CHANGED</a>);</td></tr>
<tr><th id="3042">3042</th><td></td></tr>
<tr><th id="3043">3043</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3044">3044</th><td>}</td></tr>
<tr><th id="3045">3045</th><td></td></tr>
<tr><th id="3046">3046</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="#bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision">bge_revision</a> *</td></tr>
<tr><th id="3047">3047</th><td><dfn class="tu decl def fn" id="bge_lookup_rev" title='bge_lookup_rev' data-type='const struct bge_revision * bge_lookup_rev(uint32_t chipid)' data-ref="bge_lookup_rev" data-ref-filename="bge_lookup_rev">bge_lookup_rev</dfn>(<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="211chipid" title='chipid' data-type='uint32_t' data-ref="211chipid" data-ref-filename="211chipid">chipid</dfn>)</td></tr>
<tr><th id="3048">3048</th><td>{</td></tr>
<tr><th id="3049">3049</th><td>	<em>const</em> <b>struct</b> <a class="type" href="#bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision">bge_revision</a> *<dfn class="local col2 decl" id="212br" title='br' data-type='const struct bge_revision *' data-ref="212br" data-ref-filename="212br">br</dfn>;</td></tr>
<tr><th id="3050">3050</th><td></td></tr>
<tr><th id="3051">3051</th><td>	<b>for</b> (<a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a> = <a class="tu ref" href="#bge_revisions" title='bge_revisions' data-use='r' data-ref="bge_revisions" data-ref-filename="bge_revisions">bge_revisions</a>; <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>-&gt;<a class="tu ref field" href="#bge_revision::br_name" title='bge_revision::br_name' data-use='r' data-ref="bge_revision::br_name" data-ref-filename="bge_revision..br_name">br_name</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>++) {</td></tr>
<tr><th id="3052">3052</th><td>		<b>if</b> (<a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>-&gt;<a class="tu ref field" href="#bge_revision::br_chipid" title='bge_revision::br_chipid' data-use='r' data-ref="bge_revision::br_chipid" data-ref-filename="bge_revision..br_chipid">br_chipid</a> == <a class="local col1 ref" href="#211chipid" title='chipid' data-ref="211chipid" data-ref-filename="211chipid">chipid</a>)</td></tr>
<tr><th id="3053">3053</th><td>			<b>return</b> <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>;</td></tr>
<tr><th id="3054">3054</th><td>	}</td></tr>
<tr><th id="3055">3055</th><td></td></tr>
<tr><th id="3056">3056</th><td>	<b>for</b> (<a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a> = <a class="tu ref" href="#bge_majorrevs" title='bge_majorrevs' data-use='r' data-ref="bge_majorrevs" data-ref-filename="bge_majorrevs">bge_majorrevs</a>; <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>-&gt;<a class="tu ref field" href="#bge_revision::br_name" title='bge_revision::br_name' data-use='r' data-ref="bge_revision::br_name" data-ref-filename="bge_revision..br_name">br_name</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>++) {</td></tr>
<tr><th id="3057">3057</th><td>		<b>if</b> (<a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>-&gt;<a class="tu ref field" href="#bge_revision::br_chipid" title='bge_revision::br_chipid' data-use='r' data-ref="bge_revision::br_chipid" data-ref-filename="bge_revision..br_chipid">br_chipid</a> == <a class="macro" href="if_bgereg.h.html#356" title="((chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col1 ref" href="#211chipid" title='chipid' data-ref="211chipid" data-ref-filename="211chipid">chipid</a>))</td></tr>
<tr><th id="3058">3058</th><td>			<b>return</b> <a class="local col2 ref" href="#212br" title='br' data-ref="212br" data-ref-filename="212br">br</a>;</td></tr>
<tr><th id="3059">3059</th><td>	}</td></tr>
<tr><th id="3060">3060</th><td></td></tr>
<tr><th id="3061">3061</th><td>	<b>return</b> <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3062">3062</th><td>}</td></tr>
<tr><th id="3063">3063</th><td></td></tr>
<tr><th id="3064">3064</th><td><em>static</em> <em>const</em> <b>struct</b> <a class="type" href="#bge_product" title='bge_product' data-ref="bge_product" data-ref-filename="bge_product">bge_product</a> *</td></tr>
<tr><th id="3065">3065</th><td><dfn class="tu decl def fn" id="bge_lookup" title='bge_lookup' data-type='const struct bge_product * bge_lookup(const struct pci_attach_args * pa)' data-ref="bge_lookup" data-ref-filename="bge_lookup">bge_lookup</dfn>(<em>const</em> <b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col3 decl" id="213pa" title='pa' data-type='const struct pci_attach_args *' data-ref="213pa" data-ref-filename="213pa">pa</dfn>)</td></tr>
<tr><th id="3066">3066</th><td>{</td></tr>
<tr><th id="3067">3067</th><td>	<em>const</em> <b>struct</b> <a class="type" href="#bge_product" title='bge_product' data-ref="bge_product" data-ref-filename="bge_product">bge_product</a> *<dfn class="local col4 decl" id="214bp" title='bp' data-type='const struct bge_product *' data-ref="214bp" data-ref-filename="214bp">bp</dfn>;</td></tr>
<tr><th id="3068">3068</th><td></td></tr>
<tr><th id="3069">3069</th><td>	<b>for</b> (<a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a> = <a class="tu ref" href="#bge_products" title='bge_products' data-use='r' data-ref="bge_products" data-ref-filename="bge_products">bge_products</a>; <a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a>-&gt;<a class="tu ref field" href="#bge_product::bp_name" title='bge_product::bp_name' data-use='r' data-ref="bge_product::bp_name" data-ref-filename="bge_product..bp_name">bp_name</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; <a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a>++) {</td></tr>
<tr><th id="3070">3070</th><td>		<b>if</b> (<a class="macro" href="pcireg.h.html#58" title="(((pa-&gt;pa_id) &gt;&gt; 0) &amp; 0xffff)" data-ref="_M/PCI_VENDOR">PCI_VENDOR</a>(<a class="local col3 ref" href="#213pa" title='pa' data-ref="213pa" data-ref-filename="213pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a>-&gt;<a class="tu ref field" href="#bge_product::bp_vendor" title='bge_product::bp_vendor' data-use='r' data-ref="bge_product::bp_vendor" data-ref-filename="bge_product..bp_vendor">bp_vendor</a> &amp;&amp;</td></tr>
<tr><th id="3071">3071</th><td>		    <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col3 ref" href="#213pa" title='pa' data-ref="213pa" data-ref-filename="213pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a>-&gt;<a class="tu ref field" href="#bge_product::bp_product" title='bge_product::bp_product' data-use='r' data-ref="bge_product::bp_product" data-ref-filename="bge_product..bp_product">bp_product</a>)</td></tr>
<tr><th id="3072">3072</th><td>			<b>return</b> <a class="local col4 ref" href="#214bp" title='bp' data-ref="214bp" data-ref-filename="214bp">bp</a>;</td></tr>
<tr><th id="3073">3073</th><td>	}</td></tr>
<tr><th id="3074">3074</th><td></td></tr>
<tr><th id="3075">3075</th><td>	<b>return</b> <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3076">3076</th><td>}</td></tr>
<tr><th id="3077">3077</th><td></td></tr>
<tr><th id="3078">3078</th><td><em>static</em> <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a></td></tr>
<tr><th id="3079">3079</th><td><dfn class="tu decl def fn" id="bge_chipid" title='bge_chipid' data-type='uint32_t bge_chipid(const struct pci_attach_args * pa)' data-ref="bge_chipid" data-ref-filename="bge_chipid">bge_chipid</dfn>(<em>const</em> <b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col5 decl" id="215pa" title='pa' data-type='const struct pci_attach_args *' data-ref="215pa" data-ref-filename="215pa">pa</dfn>)</td></tr>
<tr><th id="3080">3080</th><td>{</td></tr>
<tr><th id="3081">3081</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="216id" title='id' data-type='uint32_t' data-ref="216id" data-ref-filename="216id">id</dfn>;</td></tr>
<tr><th id="3082">3082</th><td></td></tr>
<tr><th id="3083">3083</th><td>	<a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>)</td></tr>
<tr><th id="3084">3084</th><td>		&gt;&gt; <a class="macro" href="if_bgereg.h.html#265" title="16" data-ref="_M/BGE_PCIMISCCTL_ASICREV_SHIFT">BGE_PCIMISCCTL_ASICREV_SHIFT</a>;</td></tr>
<tr><th id="3085">3085</th><td></td></tr>
<tr><th id="3086">3086</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((id) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a>) == <a class="macro" href="if_bgereg.h.html#371" title="0x0f" data-ref="_M/BGE_ASICREV_USE_PRODID_REG">BGE_ASICREV_USE_PRODID_REG</a>) {</td></tr>
<tr><th id="3087">3087</th><td>		<b>switch</b> (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>)) {</td></tr>
<tr><th id="3088">3088</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1915" title="0x1655" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5717">PCI_PRODUCT_BROADCOM_BCM5717</a>:</td></tr>
<tr><th id="3089">3089</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1916" title="0x1656" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5718">PCI_PRODUCT_BROADCOM_BCM5718</a>:</td></tr>
<tr><th id="3090">3090</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1917" title="0x1657" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5719">PCI_PRODUCT_BROADCOM_BCM5719</a>:</td></tr>
<tr><th id="3091">3091</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1924" title="0x165f" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5720">PCI_PRODUCT_BROADCOM_BCM5720</a>:</td></tr>
<tr><th id="3092">3092</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1900" title="0x1643" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5725">PCI_PRODUCT_BROADCOM_BCM5725</a>:</td></tr>
<tr><th id="3093">3093</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#2017" title="0x16f3" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5727">PCI_PRODUCT_BROADCOM_BCM5727</a>:</td></tr>
<tr><th id="3094">3094</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1953" title="0x1687" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5762">PCI_PRODUCT_BROADCOM_BCM5762</a>:</td></tr>
<tr><th id="3095">3095</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1899" title="0x1642" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57764">PCI_PRODUCT_BROADCOM_BCM57764</a>:</td></tr>
<tr><th id="3096">3096</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1950" title="0x1683" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57767">PCI_PRODUCT_BROADCOM_BCM57767</a>:</td></tr>
<tr><th id="3097">3097</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1898" title="0x1641" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57787">PCI_PRODUCT_BROADCOM_BCM57787</a>:</td></tr>
<tr><th id="3098">3098</th><td>			<a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>,</td></tr>
<tr><th id="3099">3099</th><td>			    <a class="macro" href="if_bgereg.h.html#249" title="0xF4" data-ref="_M/BGE_PCI_GEN2_PRODID_ASICREV">BGE_PCI_GEN2_PRODID_ASICREV</a>);</td></tr>
<tr><th id="3100">3100</th><td>			<b>break</b>;</td></tr>
<tr><th id="3101">3101</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1986" title="0x16b0" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57761">PCI_PRODUCT_BROADCOM_BCM57761</a>:</td></tr>
<tr><th id="3102">3102</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1949" title="0x1682" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57762">PCI_PRODUCT_BROADCOM_BCM57762</a>:</td></tr>
<tr><th id="3103">3103</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1990" title="0x16b4" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57765">PCI_PRODUCT_BROADCOM_BCM57765</a>:</td></tr>
<tr><th id="3104">3104</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1952" title="0x1686" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57766">PCI_PRODUCT_BROADCOM_BCM57766</a>:</td></tr>
<tr><th id="3105">3105</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1987" title="0x16b1" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57781">PCI_PRODUCT_BROADCOM_BCM57781</a>:</td></tr>
<tr><th id="3106">3106</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1993" title="0x16b7" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57782">PCI_PRODUCT_BROADCOM_BCM57782</a>:</td></tr>
<tr><th id="3107">3107</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1991" title="0x16b5" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57785">PCI_PRODUCT_BROADCOM_BCM57785</a>:</td></tr>
<tr><th id="3108">3108</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1989" title="0x16b3" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57786">PCI_PRODUCT_BROADCOM_BCM57786</a>:</td></tr>
<tr><th id="3109">3109</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1988" title="0x16b2" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57791">PCI_PRODUCT_BROADCOM_BCM57791</a>:</td></tr>
<tr><th id="3110">3110</th><td>		<b>case</b> <a class="macro" href="pcidevs.h.html#1992" title="0x16b6" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57795">PCI_PRODUCT_BROADCOM_BCM57795</a>:</td></tr>
<tr><th id="3111">3111</th><td>			<a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>,</td></tr>
<tr><th id="3112">3112</th><td>			    <a class="macro" href="if_bgereg.h.html#250" title="0xFC" data-ref="_M/BGE_PCI_GEN15_PRODID_ASICREV">BGE_PCI_GEN15_PRODID_ASICREV</a>);</td></tr>
<tr><th id="3113">3113</th><td>			<b>break</b>;</td></tr>
<tr><th id="3114">3114</th><td>		<b>default</b>:</td></tr>
<tr><th id="3115">3115</th><td>			<a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col5 ref" href="#215pa" title='pa' data-ref="215pa" data-ref-filename="215pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>,</td></tr>
<tr><th id="3116">3116</th><td>			    <a class="macro" href="if_bgereg.h.html#248" title="0xBC" data-ref="_M/BGE_PCI_PRODID_ASICREV">BGE_PCI_PRODID_ASICREV</a>);</td></tr>
<tr><th id="3117">3117</th><td>			<b>break</b>;</td></tr>
<tr><th id="3118">3118</th><td>		}</td></tr>
<tr><th id="3119">3119</th><td>	}</td></tr>
<tr><th id="3120">3120</th><td></td></tr>
<tr><th id="3121">3121</th><td>	<b>return</b> <a class="local col6 ref" href="#216id" title='id' data-ref="216id" data-ref-filename="216id">id</a>;</td></tr>
<tr><th id="3122">3122</th><td>}</td></tr>
<tr><th id="3123">3123</th><td></td></tr>
<tr><th id="3124">3124</th><td><i  data-doc="bge_can_use_msi">/*</i></td></tr>
<tr><th id="3125">3125</th><td><i  data-doc="bge_can_use_msi"> * Return true if MSI can be used with this device.</i></td></tr>
<tr><th id="3126">3126</th><td><i  data-doc="bge_can_use_msi"> */</i></td></tr>
<tr><th id="3127">3127</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="3128">3128</th><td><dfn class="tu decl def fn" id="bge_can_use_msi" title='bge_can_use_msi' data-type='int bge_can_use_msi(struct bge_softc * sc)' data-ref="bge_can_use_msi" data-ref-filename="bge_can_use_msi">bge_can_use_msi</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="217sc" title='sc' data-type='struct bge_softc *' data-ref="217sc" data-ref-filename="217sc">sc</dfn>)</td></tr>
<tr><th id="3129">3129</th><td>{</td></tr>
<tr><th id="3130">3130</th><td>	<em>int</em> <dfn class="local col8 decl" id="218can_use_msi" title='can_use_msi' data-type='int' data-ref="218can_use_msi" data-ref-filename="218can_use_msi">can_use_msi</dfn> = <var>0</var>;</td></tr>
<tr><th id="3131">3131</th><td></td></tr>
<tr><th id="3132">3132</th><td>	<b>switch</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#217sc" title='sc' data-ref="217sc" data-ref-filename="217sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>)) {</td></tr>
<tr><th id="3133">3133</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#363" title="0x05" data-ref="_M/BGE_ASICREV_BCM5714_A0">BGE_ASICREV_BCM5714_A0</a>:</td></tr>
<tr><th id="3134">3134</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#367" title="0x09" data-ref="_M/BGE_ASICREV_BCM5714">BGE_ASICREV_BCM5714</a>:</td></tr>
<tr><th id="3135">3135</th><td>		<i>/*</i></td></tr>
<tr><th id="3136">3136</th><td><i>		 * Apparently, MSI doesn't work when these chips are</i></td></tr>
<tr><th id="3137">3137</th><td><i>		 * configured in single-port mode.</i></td></tr>
<tr><th id="3138">3138</th><td><i>		 */</i></td></tr>
<tr><th id="3139">3139</th><td>		<b>break</b>;</td></tr>
<tr><th id="3140">3140</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#362" title="0x04" data-ref="_M/BGE_ASICREV_BCM5750">BGE_ASICREV_BCM5750</a>:</td></tr>
<tr><th id="3141">3141</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col7 ref" href="#217sc" title='sc' data-ref="217sc" data-ref-filename="217sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#392" title="0x40" data-ref="_M/BGE_CHIPREV_5750_AX">BGE_CHIPREV_5750_AX</a> &amp;&amp;</td></tr>
<tr><th id="3142">3142</th><td>		    <a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col7 ref" href="#217sc" title='sc' data-ref="217sc" data-ref-filename="217sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#393" title="0x41" data-ref="_M/BGE_CHIPREV_5750_BX">BGE_CHIPREV_5750_BX</a>)</td></tr>
<tr><th id="3143">3143</th><td>			<a class="local col8 ref" href="#218can_use_msi" title='can_use_msi' data-ref="218can_use_msi" data-ref-filename="218can_use_msi">can_use_msi</a> = <var>1</var>;</td></tr>
<tr><th id="3144">3144</th><td>		<b>break</b>;</td></tr>
<tr><th id="3145">3145</th><td>	<b>default</b>:</td></tr>
<tr><th id="3146">3146</th><td>		<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col7 ref" href="#217sc" title='sc' data-ref="217sc" data-ref-filename="217sc">sc</a>))</td></tr>
<tr><th id="3147">3147</th><td>			<a class="local col8 ref" href="#218can_use_msi" title='can_use_msi' data-ref="218can_use_msi" data-ref-filename="218can_use_msi">can_use_msi</a> = <var>1</var>;</td></tr>
<tr><th id="3148">3148</th><td>	}</td></tr>
<tr><th id="3149">3149</th><td>	<b>return</b> (<a class="local col8 ref" href="#218can_use_msi" title='can_use_msi' data-ref="218can_use_msi" data-ref-filename="218can_use_msi">can_use_msi</a>);</td></tr>
<tr><th id="3150">3150</th><td>}</td></tr>
<tr><th id="3151">3151</th><td></td></tr>
<tr><th id="3152">3152</th><td><i  data-doc="bge_probe">/*</i></td></tr>
<tr><th id="3153">3153</th><td><i  data-doc="bge_probe"> * Probe for a Broadcom chip. Check the PCI vendor and device IDs</i></td></tr>
<tr><th id="3154">3154</th><td><i  data-doc="bge_probe"> * against our list and return its name if we find a match. Note</i></td></tr>
<tr><th id="3155">3155</th><td><i  data-doc="bge_probe"> * that since the Broadcom controller contains VPD support, we</i></td></tr>
<tr><th id="3156">3156</th><td><i  data-doc="bge_probe"> * can get the device name string from the controller itself instead</i></td></tr>
<tr><th id="3157">3157</th><td><i  data-doc="bge_probe"> * of the compiled-in string. This is a little slow, but it guarantees</i></td></tr>
<tr><th id="3158">3158</th><td><i  data-doc="bge_probe"> * we'll always announce the right product name.</i></td></tr>
<tr><th id="3159">3159</th><td><i  data-doc="bge_probe"> */</i></td></tr>
<tr><th id="3160">3160</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="3161">3161</th><td><dfn class="tu decl def fn" id="bge_probe" title='bge_probe' data-type='int bge_probe(device_t parent, cfdata_t match, void * aux)' data-ref="bge_probe" data-ref-filename="bge_probe">bge_probe</dfn>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col9 decl" id="219parent" title='parent' data-type='device_t' data-ref="219parent" data-ref-filename="219parent">parent</dfn>, <a class="typedef" href="../../sys/device.h.html#cfdata_t" title='cfdata_t' data-type='struct cfdata *' data-ref="cfdata_t" data-ref-filename="cfdata_t">cfdata_t</a> <dfn class="local col0 decl" id="220match" title='match' data-type='cfdata_t' data-ref="220match" data-ref-filename="220match">match</dfn>, <em>void</em> *<dfn class="local col1 decl" id="221aux" title='aux' data-type='void *' data-ref="221aux" data-ref-filename="221aux">aux</dfn>)</td></tr>
<tr><th id="3162">3162</th><td>{</td></tr>
<tr><th id="3163">3163</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *<dfn class="local col2 decl" id="222pa" title='pa' data-type='struct pci_attach_args *' data-ref="222pa" data-ref-filename="222pa">pa</dfn> = (<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a> *)<a class="local col1 ref" href="#221aux" title='aux' data-ref="221aux" data-ref-filename="221aux">aux</a>;</td></tr>
<tr><th id="3164">3164</th><td></td></tr>
<tr><th id="3165">3165</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_lookup" title='bge_lookup' data-use='c' data-ref="bge_lookup" data-ref-filename="bge_lookup">bge_lookup</a>(<a class="local col2 ref" href="#222pa" title='pa' data-ref="222pa" data-ref-filename="222pa">pa</a>) != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="3166">3166</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="3167">3167</th><td></td></tr>
<tr><th id="3168">3168</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3169">3169</th><td>}</td></tr>
<tr><th id="3170">3170</th><td></td></tr>
<tr><th id="3171">3171</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="3172">3172</th><td><dfn class="tu decl def fn" id="bge_attach" title='bge_attach' data-type='void bge_attach(device_t parent, device_t self, void * aux)' data-ref="bge_attach" data-ref-filename="bge_attach">bge_attach</dfn>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col3 decl" id="223parent" title='parent' data-type='device_t' data-ref="223parent" data-ref-filename="223parent">parent</dfn>, <a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col4 decl" id="224self" title='self' data-type='device_t' data-ref="224self" data-ref-filename="224self">self</dfn>, <em>void</em> *<dfn class="local col5 decl" id="225aux" title='aux' data-type='void *' data-ref="225aux" data-ref-filename="225aux">aux</dfn>)</td></tr>
<tr><th id="3173">3173</th><td>{</td></tr>
<tr><th id="3174">3174</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a>	*<dfn class="local col6 decl" id="226sc" title='sc' data-type='struct bge_softc *' data-ref="226sc" data-ref-filename="226sc">sc</dfn> = <a class="ref fn" href="../../sys/device.h.html#device_private" title='device_private' data-ref="device_private" data-ref-filename="device_private">device_private</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>);</td></tr>
<tr><th id="3175">3175</th><td>	<b>struct</b> <a class="type" href="pcivar.h.html#pci_attach_args" title='pci_attach_args' data-ref="pci_attach_args" data-ref-filename="pci_attach_args">pci_attach_args</a>	*<dfn class="local col7 decl" id="227pa" title='pa' data-type='struct pci_attach_args *' data-ref="227pa" data-ref-filename="227pa">pa</dfn> = <a class="local col5 ref" href="#225aux" title='aux' data-ref="225aux" data-ref-filename="225aux">aux</a>;</td></tr>
<tr><th id="3176">3176</th><td>	<a class="typedef" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_t" title='prop_dictionary_t' data-type='struct _prop_dictionary *' data-ref="prop_dictionary_t" data-ref-filename="prop_dictionary_t">prop_dictionary_t</a> <dfn class="local col8 decl" id="228dict" title='dict' data-type='prop_dictionary_t' data-ref="228dict" data-ref-filename="228dict">dict</dfn>;</td></tr>
<tr><th id="3177">3177</th><td>	<em>const</em> <b>struct</b> <a class="type" href="#bge_product" title='bge_product' data-ref="bge_product" data-ref-filename="bge_product">bge_product</a> *<dfn class="local col9 decl" id="229bp" title='bp' data-type='const struct bge_product *' data-ref="229bp" data-ref-filename="229bp">bp</dfn>;</td></tr>
<tr><th id="3178">3178</th><td>	<em>const</em> <b>struct</b> <a class="type" href="#bge_revision" title='bge_revision' data-ref="bge_revision" data-ref-filename="bge_revision">bge_revision</a> *<dfn class="local col0 decl" id="230br" title='br' data-type='const struct bge_revision *' data-ref="230br" data-ref-filename="230br">br</dfn>;</td></tr>
<tr><th id="3179">3179</th><td>	<a class="typedef" href="../../arch/x86/include/pci_machdep_common.h.html#pci_chipset_tag_t" title='pci_chipset_tag_t' data-type='struct pci_chipset_tag *' data-ref="pci_chipset_tag_t" data-ref-filename="pci_chipset_tag_t">pci_chipset_tag_t</a>	<dfn class="local col1 decl" id="231pc" title='pc' data-type='pci_chipset_tag_t' data-ref="231pc" data-ref-filename="231pc">pc</dfn>;</td></tr>
<tr><th id="3180">3180</th><td>	<em>const</em> <em>char</em>		*<dfn class="local col2 decl" id="232intrstr" title='intrstr' data-type='const char *' data-ref="232intrstr" data-ref-filename="232intrstr">intrstr</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3181">3181</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col3 decl" id="233hwcfg" title='hwcfg' data-type='uint32_t' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</dfn>, <dfn class="local col4 decl" id="234hwcfg2" title='hwcfg2' data-type='uint32_t' data-ref="234hwcfg2" data-ref-filename="234hwcfg2">hwcfg2</dfn>, <dfn class="local col5 decl" id="235hwcfg3" title='hwcfg3' data-type='uint32_t' data-ref="235hwcfg3" data-ref-filename="235hwcfg3">hwcfg3</dfn>, <dfn class="local col6 decl" id="236hwcfg4" title='hwcfg4' data-type='uint32_t' data-ref="236hwcfg4" data-ref-filename="236hwcfg4">hwcfg4</dfn>, <dfn class="local col7 decl" id="237hwcfg5" title='hwcfg5' data-type='uint32_t' data-ref="237hwcfg5" data-ref-filename="237hwcfg5">hwcfg5</dfn>;</td></tr>
<tr><th id="3182">3182</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col8 decl" id="238command" title='command' data-type='uint32_t' data-ref="238command" data-ref-filename="238command">command</dfn>;</td></tr>
<tr><th id="3183">3183</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a>		*<dfn class="local col9 decl" id="239ifp" title='ifp' data-type='struct ifnet *' data-ref="239ifp" data-ref-filename="239ifp">ifp</dfn>;</td></tr>
<tr><th id="3184">3184</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> * <em>const</em> <dfn class="local col0 decl" id="240mii" title='mii' data-type='struct mii_data *const' data-ref="240mii" data-ref-filename="240mii">mii</dfn> = &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="3185">3185</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col1 decl" id="241misccfg" title='misccfg' data-type='uint32_t' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</dfn>, <dfn class="local col2 decl" id="242mimode" title='mimode' data-type='uint32_t' data-ref="242mimode" data-ref-filename="242mimode">mimode</dfn>;</td></tr>
<tr><th id="3186">3186</th><td>	<em>void</em> *			<dfn class="local col3 decl" id="243kva" title='kva' data-type='void *' data-ref="243kva" data-ref-filename="243kva">kva</dfn>;</td></tr>
<tr><th id="3187">3187</th><td>	<a class="typedef" href="../../sys/types.h.html#u_char" title='u_char' data-type='unsigned char' data-ref="u_char" data-ref-filename="u_char">u_char</a>			<dfn class="local col4 decl" id="244eaddr" title='eaddr' data-type='u_char [6]' data-ref="244eaddr" data-ref-filename="244eaddr">eaddr</dfn>[<a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>];</td></tr>
<tr><th id="3188">3188</th><td>	<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a>		<dfn class="local col5 decl" id="245memtype" title='memtype' data-type='pcireg_t' data-ref="245memtype" data-ref-filename="245memtype">memtype</dfn>, <dfn class="local col6 decl" id="246subid" title='subid' data-type='pcireg_t' data-ref="246subid" data-ref-filename="246subid">subid</dfn>, <dfn class="local col7 decl" id="247reg" title='reg' data-type='pcireg_t' data-ref="247reg" data-ref-filename="247reg">reg</dfn>;</td></tr>
<tr><th id="3189">3189</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a>		<dfn class="local col8 decl" id="248memaddr" title='memaddr' data-type='bus_addr_t' data-ref="248memaddr" data-ref-filename="248memaddr">memaddr</dfn>;</td></tr>
<tr><th id="3190">3190</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col9 decl" id="249pm_ctl" title='pm_ctl' data-type='uint32_t' data-ref="249pm_ctl" data-ref-filename="249pm_ctl">pm_ctl</dfn>;</td></tr>
<tr><th id="3191">3191</th><td>	<a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a>			<dfn class="local col0 decl" id="250no_seeprom" title='no_seeprom' data-type='_Bool' data-ref="250no_seeprom" data-ref-filename="250no_seeprom">no_seeprom</dfn>;</td></tr>
<tr><th id="3192">3192</th><td>	<em>int</em>			<dfn class="local col1 decl" id="251capmask" title='capmask' data-type='int' data-ref="251capmask" data-ref-filename="251capmask">capmask</dfn>;</td></tr>
<tr><th id="3193">3193</th><td>	<em>int</em>			<dfn class="local col2 decl" id="252mii_flags" title='mii_flags' data-type='int' data-ref="252mii_flags" data-ref-filename="252mii_flags">mii_flags</dfn>;</td></tr>
<tr><th id="3194">3194</th><td>	<em>int</em>			<dfn class="local col3 decl" id="253map_flags" title='map_flags' data-type='int' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</dfn>;</td></tr>
<tr><th id="3195">3195</th><td>	<em>char</em> <dfn class="local col4 decl" id="254intrbuf" title='intrbuf' data-type='char [64]' data-ref="254intrbuf" data-ref-filename="254intrbuf">intrbuf</dfn>[<a class="macro" href="pcivar.h.html#423" title="64" data-ref="_M/PCI_INTRSTR_LEN">PCI_INTRSTR_LEN</a>];</td></tr>
<tr><th id="3196">3196</th><td></td></tr>
<tr><th id="3197">3197</th><td>	<a class="local col9 ref" href="#229bp" title='bp' data-ref="229bp" data-ref-filename="229bp">bp</a> = <a class="tu ref fn" href="#bge_lookup" title='bge_lookup' data-use='c' data-ref="bge_lookup" data-ref-filename="bge_lookup">bge_lookup</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>);</td></tr>
<tr><th id="3198">3198</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((bp != ((void *)0))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;bp != NULL&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 3198))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col9 ref" href="#229bp" title='bp' data-ref="229bp" data-ref-filename="229bp">bp</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3199">3199</th><td></td></tr>
<tr><th id="3200">3200</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>;</td></tr>
<tr><th id="3201">3201</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>;</td></tr>
<tr><th id="3202">3202</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a> = <a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>;</td></tr>
<tr><th id="3203">3203</th><td></td></tr>
<tr><th id="3204">3204</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pa" title='bge_softc::bge_pa' data-ref="bge_softc::bge_pa" data-ref-filename="bge_softc..bge_pa">bge_pa</a> = *<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>;</td></tr>
<tr><th id="3205">3205</th><td>	<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a> = <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>;</td></tr>
<tr><th id="3206">3206</th><td>	<a class="local col6 ref" href="#246subid" title='subid' data-ref="246subid" data-ref-filename="246subid">subid</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#519" title="0x2c" data-ref="_M/PCI_SUBSYS_ID_REG">PCI_SUBSYS_ID_REG</a>);</td></tr>
<tr><th id="3207">3207</th><td></td></tr>
<tr><th id="3208">3208</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_naive" title='aprint_naive' data-ref="aprint_naive" data-ref-filename="aprint_naive">aprint_naive</a>(<q>": Ethernet controller\n"</q>);</td></tr>
<tr><th id="3209">3209</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_normal" title='aprint_normal' data-ref="aprint_normal" data-ref-filename="aprint_normal">aprint_normal</a>(<q>": %s Ethernet\n"</q>, <a class="local col9 ref" href="#229bp" title='bp' data-ref="229bp" data-ref-filename="229bp">bp</a>-&gt;<a class="tu ref field" href="#bge_product::bp_name" title='bge_product::bp_name' data-use='r' data-ref="bge_product::bp_name" data-ref-filename="bge_product..bp_name">bp_name</a>);</td></tr>
<tr><th id="3210">3210</th><td></td></tr>
<tr><th id="3211">3211</th><td>	<i>/*</i></td></tr>
<tr><th id="3212">3212</th><td><i>	 * Map control/status registers.</i></td></tr>
<tr><th id="3213">3213</th><td><i>	 */</i></td></tr>
<tr><th id="3214">3214</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"Map control/status regs\n"</q>));</td></tr>
<tr><th id="3215">3215</th><td>	<a class="local col8 ref" href="#238command" title='command' data-ref="238command" data-ref-filename="238command">command</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#73" title="0x04" data-ref="_M/PCI_COMMAND_STATUS_REG">PCI_COMMAND_STATUS_REG</a>);</td></tr>
<tr><th id="3216">3216</th><td>	<a class="local col8 ref" href="#238command" title='command' data-ref="238command" data-ref-filename="238command">command</a> |= <a class="macro" href="pcireg.h.html#84" title="0x00000002" data-ref="_M/PCI_COMMAND_MEM_ENABLE">PCI_COMMAND_MEM_ENABLE</a> | <a class="macro" href="pcireg.h.html#85" title="0x00000004" data-ref="_M/PCI_COMMAND_MASTER_ENABLE">PCI_COMMAND_MASTER_ENABLE</a>;</td></tr>
<tr><th id="3217">3217</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#73" title="0x04" data-ref="_M/PCI_COMMAND_STATUS_REG">PCI_COMMAND_STATUS_REG</a>, <a class="local col8 ref" href="#238command" title='command' data-ref="238command" data-ref-filename="238command">command</a>);</td></tr>
<tr><th id="3218">3218</th><td>	<a class="local col8 ref" href="#238command" title='command' data-ref="238command" data-ref-filename="238command">command</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#73" title="0x04" data-ref="_M/PCI_COMMAND_STATUS_REG">PCI_COMMAND_STATUS_REG</a>);</td></tr>
<tr><th id="3219">3219</th><td></td></tr>
<tr><th id="3220">3220</th><td>	<b>if</b> (!(<a class="local col8 ref" href="#238command" title='command' data-ref="238command" data-ref-filename="238command">command</a> &amp; <a class="macro" href="pcireg.h.html#84" title="0x00000002" data-ref="_M/PCI_COMMAND_MEM_ENABLE">PCI_COMMAND_MEM_ENABLE</a>)) {</td></tr>
<tr><th id="3221">3221</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3222">3222</th><td>		    <q>"failed to enable memory mapping!\n"</q>);</td></tr>
<tr><th id="3223">3223</th><td>		<b>return</b>;</td></tr>
<tr><th id="3224">3224</th><td>	}</td></tr>
<tr><th id="3225">3225</th><td></td></tr>
<tr><th id="3226">3226</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"pci_mem_find\n"</q>));</td></tr>
<tr><th id="3227">3227</th><td>	<a class="local col5 ref" href="#245memtype" title='memtype' data-ref="245memtype" data-ref-filename="245memtype">memtype</a> = <a class="ref fn" href="pcivar.h.html#pci_mapreg_type" title='pci_mapreg_type' data-ref="pci_mapreg_type" data-ref-filename="pci_mapreg_type">pci_mapreg_type</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#174" title="0x10" data-ref="_M/BGE_PCI_BAR0">BGE_PCI_BAR0</a>);</td></tr>
<tr><th id="3228">3228</th><td>	<b>switch</b> (<a class="local col5 ref" href="#245memtype" title='memtype' data-ref="245memtype" data-ref-filename="245memtype">memtype</a>) {</td></tr>
<tr><th id="3229">3229</th><td>	<b>case</b> <a class="macro" href="pcireg.h.html#453" title="0x00000000" data-ref="_M/PCI_MAPREG_TYPE_MEM">PCI_MAPREG_TYPE_MEM</a> | <a class="macro" href="pcireg.h.html#462" title="0x00000000" data-ref="_M/PCI_MAPREG_MEM_TYPE_32BIT">PCI_MAPREG_MEM_TYPE_32BIT</a>:</td></tr>
<tr><th id="3230">3230</th><td>	<b>case</b> <a class="macro" href="pcireg.h.html#453" title="0x00000000" data-ref="_M/PCI_MAPREG_TYPE_MEM">PCI_MAPREG_TYPE_MEM</a> | <a class="macro" href="pcireg.h.html#464" title="0x00000004" data-ref="_M/PCI_MAPREG_MEM_TYPE_64BIT">PCI_MAPREG_MEM_TYPE_64BIT</a>:</td></tr>
<tr><th id="3231">3231</th><td><u>#<span data-ppcond="3231">if</span> 0</u></td></tr>
<tr><th id="3232">3232</th><td>		<b>if</b> (pci_mapreg_map(pa, BGE_PCI_BAR0,</td></tr>
<tr><th id="3233">3233</th><td>		    memtype, <var>0</var>, &amp;sc-&gt;bge_btag, &amp;sc-&gt;bge_bhandle,</td></tr>
<tr><th id="3234">3234</th><td>		    &amp;memaddr, &amp;sc-&gt;bge_bsize) == <var>0</var>)</td></tr>
<tr><th id="3235">3235</th><td>			<b>break</b>;</td></tr>
<tr><th id="3236">3236</th><td><u>#<span data-ppcond="3231">else</span></u></td></tr>
<tr><th id="3237">3237</th><td>		<i>/*</i></td></tr>
<tr><th id="3238">3238</th><td><i>		 * Workaround for PCI prefetchable bit. Some BCM5717-5720 based</i></td></tr>
<tr><th id="3239">3239</th><td><i>		 * system get NMI on boot (PR#48451). This problem might not be</i></td></tr>
<tr><th id="3240">3240</th><td><i>		 * the driver's bug but our PCI common part's bug. Until we</i></td></tr>
<tr><th id="3241">3241</th><td><i>		 * find a real reason, we ignore the prefetchable bit.</i></td></tr>
<tr><th id="3242">3242</th><td><i>		 */</i></td></tr>
<tr><th id="3243">3243</th><td>		<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_mapreg_info" title='pci_mapreg_info' data-ref="pci_mapreg_info" data-ref-filename="pci_mapreg_info">pci_mapreg_info</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#174" title="0x10" data-ref="_M/BGE_PCI_BAR0">BGE_PCI_BAR0</a>,</td></tr>
<tr><th id="3244">3244</th><td>		    <a class="local col5 ref" href="#245memtype" title='memtype' data-ref="245memtype" data-ref-filename="245memtype">memtype</a>, &amp;<a class="local col8 ref" href="#248memaddr" title='memaddr' data-ref="248memaddr" data-ref-filename="248memaddr">memaddr</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bsize" title='bge_softc::bge_bsize' data-ref="bge_softc::bge_bsize" data-ref-filename="bge_softc..bge_bsize">bge_bsize</a>, &amp;<a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a>) == <var>0</var>) {</td></tr>
<tr><th id="3245">3245</th><td>			<a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a> &amp;= ~<a class="macro" href="../../sys/bus_proto.h.html#80" title="0x04" data-ref="_M/BUS_SPACE_MAP_PREFETCHABLE">BUS_SPACE_MAP_PREFETCHABLE</a>;</td></tr>
<tr><th id="3246">3246</th><td>			<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_space_map" title='bus_space_map' data-ref="bus_space_map" data-ref-filename="bus_space_map">bus_space_map</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_memt" title='pci_attach_args::pa_memt' data-ref="pci_attach_args::pa_memt" data-ref-filename="pci_attach_args..pa_memt">pa_memt</a>, <a class="local col8 ref" href="#248memaddr" title='memaddr' data-ref="248memaddr" data-ref-filename="248memaddr">memaddr</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bsize" title='bge_softc::bge_bsize' data-ref="bge_softc::bge_bsize" data-ref-filename="bge_softc..bge_bsize">bge_bsize</a>,</td></tr>
<tr><th id="3247">3247</th><td>			    <a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bhandle" title='bge_softc::bge_bhandle' data-ref="bge_softc::bge_bhandle" data-ref-filename="bge_softc..bge_bhandle">bge_bhandle</a>) == <var>0</var>) {</td></tr>
<tr><th id="3248">3248</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_btag" title='bge_softc::bge_btag' data-ref="bge_softc::bge_btag" data-ref-filename="bge_softc..bge_btag">bge_btag</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_memt" title='pci_attach_args::pa_memt' data-ref="pci_attach_args::pa_memt" data-ref-filename="pci_attach_args..pa_memt">pa_memt</a>;</td></tr>
<tr><th id="3249">3249</th><td>				<b>break</b>;</td></tr>
<tr><th id="3250">3250</th><td>			}</td></tr>
<tr><th id="3251">3251</th><td>		}</td></tr>
<tr><th id="3252">3252</th><td><u>#<span data-ppcond="3231">endif</span></u></td></tr>
<tr><th id="3253">3253</th><td>		<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="3254">3254</th><td>	<b>default</b>:</td></tr>
<tr><th id="3255">3255</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't find mem space\n"</q>);</td></tr>
<tr><th id="3256">3256</th><td>		<b>return</b>;</td></tr>
<tr><th id="3257">3257</th><td>	}</td></tr>
<tr><th id="3258">3258</th><td></td></tr>
<tr><th id="3259">3259</th><td>	<i>/* Save various chip information. */</i></td></tr>
<tr><th id="3260">3260</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> = <a class="tu ref fn" href="#bge_chipid" title='bge_chipid' data-use='c' data-ref="bge_chipid" data-ref-filename="bge_chipid">bge_chipid</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>);</td></tr>
<tr><th id="3261">3261</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a> = <a class="tu ref fn" href="#bge_phy_addr" title='bge_phy_addr' data-use='c' data-ref="bge_phy_addr" data-ref-filename="bge_phy_addr">bge_phy_addr</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3262">3262</th><td></td></tr>
<tr><th id="3263">3263</th><td>	<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_get_capability" title='pci_get_capability' data-ref="pci_get_capability" data-ref-filename="pci_get_capability">pci_get_capability</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="pcireg.h.html#555" title="0x10" data-ref="_M/PCI_CAP_PCIEXPRESS">PCI_CAP_PCIEXPRESS</a>,</td></tr>
<tr><th id="3264">3264</th><td>	    &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) != <var>0</var>) {</td></tr>
<tr><th id="3265">3265</th><td>		<i>/* PCIe */</i></td></tr>
<tr><th id="3266">3266</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>;</td></tr>
<tr><th id="3267">3267</th><td>		<i>/* Extract supported maximum payload size. */</i></td></tr>
<tr><th id="3268">3268</th><td>		<a class="local col7 ref" href="#247reg" title='reg' data-ref="247reg" data-ref-filename="247reg">reg</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="3269">3269</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a> + <a class="macro" href="pcireg.h.html#969" title="0x04" data-ref="_M/PCIE_DCAP">PCIE_DCAP</a>);</td></tr>
<tr><th id="3270">3270</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mps" title='bge_softc::bge_mps' data-ref="bge_softc::bge_mps" data-ref-filename="bge_softc..bge_mps">bge_mps</a> = <var>128</var> &lt;&lt; (<a class="local col7 ref" href="#247reg" title='reg' data-ref="247reg" data-ref-filename="247reg">reg</a> &amp; <a class="macro" href="pcireg.h.html#970" title="(((((uintmax_t)((( ((2))&gt;((0)))?((2)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((2))&gt;((0)))?((2)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((2))&lt;=((0)))?((2)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((2))&lt;=((0)))?((2)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/PCIE_DCAP_MAX_PAYLOAD">PCIE_DCAP_MAX_PAYLOAD</a>);</td></tr>
<tr><th id="3271">3271</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a> ||</td></tr>
<tr><th id="3272">3272</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>)</td></tr>
<tr><th id="3273">3273</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_expmrq" title='bge_softc::bge_expmrq' data-ref="bge_softc::bge_expmrq" data-ref-filename="bge_softc..bge_expmrq">bge_expmrq</a> = <var>2048</var>;</td></tr>
<tr><th id="3274">3274</th><td>		<b>else</b></td></tr>
<tr><th id="3275">3275</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_expmrq" title='bge_softc::bge_expmrq' data-ref="bge_softc::bge_expmrq" data-ref-filename="bge_softc..bge_expmrq">bge_expmrq</a> = <var>4096</var>;</td></tr>
<tr><th id="3276">3276</th><td>		<a class="tu ref fn" href="#bge_set_max_readrq" title='bge_set_max_readrq' data-use='c' data-ref="bge_set_max_readrq" data-ref-filename="bge_set_max_readrq">bge_set_max_readrq</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3277">3277</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>) {</td></tr>
<tr><th id="3278">3278</th><td>		<i>/* PCIe without PCIe cap */</i></td></tr>
<tr><th id="3279">3279</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>;</td></tr>
<tr><th id="3280">3280</th><td>	} <b>else</b> <b>if</b> ((<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#231" title="0x70" data-ref="_M/BGE_PCI_PCISTATE">BGE_PCI_PCISTATE</a>) &amp;</td></tr>
<tr><th id="3281">3281</th><td>		<a class="macro" href="if_bgereg.h.html#445" title="0x00000004" data-ref="_M/BGE_PCISTATE_PCI_BUSMODE">BGE_PCISTATE_PCI_BUSMODE</a>) == <var>0</var>) {</td></tr>
<tr><th id="3282">3282</th><td>		<i>/* PCI-X */</i></td></tr>
<tr><th id="3283">3283</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>;</td></tr>
<tr><th id="3284">3284</th><td>		<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_get_capability" title='pci_get_capability' data-ref="pci_get_capability" data-ref-filename="pci_get_capability">pci_get_capability</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="pcireg.h.html#546" title="0x07" data-ref="_M/PCI_CAP_PCIX">PCI_CAP_PCIX</a>,</td></tr>
<tr><th id="3285">3285</th><td>			&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pcixcap" title='bge_softc::bge_pcixcap' data-ref="bge_softc::bge_pcixcap" data-ref-filename="bge_softc..bge_pcixcap">bge_pcixcap</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) == <var>0</var>)</td></tr>
<tr><th id="3286">3286</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3287">3287</th><td>			    <q>"unable to find PCIX capability\n"</q>);</td></tr>
<tr><th id="3288">3288</th><td>	}</td></tr>
<tr><th id="3289">3289</th><td></td></tr>
<tr><th id="3290">3290</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#386" title="0x71" data-ref="_M/BGE_CHIPREV_5700_BX">BGE_CHIPREV_5700_BX</a>) {</td></tr>
<tr><th id="3291">3291</th><td>		<i>/*</i></td></tr>
<tr><th id="3292">3292</th><td><i>		 * Kludge for 5700 Bx bug: a hardware bug (PCIX byte enable?)</i></td></tr>
<tr><th id="3293">3293</th><td><i>		 * can clobber the chip's PCI config-space power control</i></td></tr>
<tr><th id="3294">3294</th><td><i>		 * registers, leaving the card in D3 powersave state. We do</i></td></tr>
<tr><th id="3295">3295</th><td><i>		 * not have memory-mapped registers in this state, so force</i></td></tr>
<tr><th id="3296">3296</th><td><i>		 * device into D0 state before starting initialization.</i></td></tr>
<tr><th id="3297">3297</th><td><i>		 */</i></td></tr>
<tr><th id="3298">3298</th><td>		<a class="local col9 ref" href="#249pm_ctl" title='pm_ctl' data-ref="249pm_ctl" data-ref-filename="249pm_ctl">pm_ctl</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#192" title="0x4C" data-ref="_M/BGE_PCI_PWRMGMT_CMD">BGE_PCI_PWRMGMT_CMD</a>);</td></tr>
<tr><th id="3299">3299</th><td>		<a class="local col9 ref" href="#249pm_ctl" title='pm_ctl' data-ref="249pm_ctl" data-ref-filename="249pm_ctl">pm_ctl</a> &amp;= ~(<a class="macro" href="pcivar.h.html#346" title="0" data-ref="_M/PCI_PWR_D0">PCI_PWR_D0</a> | <a class="macro" href="pcivar.h.html#347" title="1" data-ref="_M/PCI_PWR_D1">PCI_PWR_D1</a> | <a class="macro" href="pcivar.h.html#348" title="2" data-ref="_M/PCI_PWR_D2">PCI_PWR_D2</a> | <a class="macro" href="pcivar.h.html#349" title="3" data-ref="_M/PCI_PWR_D3">PCI_PWR_D3</a>);</td></tr>
<tr><th id="3300">3300</th><td>		<a class="local col9 ref" href="#249pm_ctl" title='pm_ctl' data-ref="249pm_ctl" data-ref-filename="249pm_ctl">pm_ctl</a> |= (<var>1</var> &lt;&lt; <var>8</var>) | <a class="macro" href="pcivar.h.html#346" title="0" data-ref="_M/PCI_PWR_D0">PCI_PWR_D0</a> ; <i>/* D0 state */</i></td></tr>
<tr><th id="3301">3301</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#192" title="0x4C" data-ref="_M/BGE_PCI_PWRMGMT_CMD">BGE_PCI_PWRMGMT_CMD</a>, <a class="local col9 ref" href="#249pm_ctl" title='pm_ctl' data-ref="249pm_ctl" data-ref-filename="249pm_ctl">pm_ctl</a>);</td></tr>
<tr><th id="3302">3302</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(1000)" data-ref="_M/DELAY">DELAY</a>(<var>1000</var>);	<i>/* 27 usec is allegedly sufficent */</i></td></tr>
<tr><th id="3303">3303</th><td>	}</td></tr>
<tr><th id="3304">3304</th><td></td></tr>
<tr><th id="3305">3305</th><td>	<i>/* Save chipset family. */</i></td></tr>
<tr><th id="3306">3306</th><td>	<b>switch</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>)) {</td></tr>
<tr><th id="3307">3307</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a>:</td></tr>
<tr><th id="3308">3308</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>:</td></tr>
<tr><th id="3309">3309</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>:</td></tr>
<tr><th id="3310">3310</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2678" title="0x00020000" data-ref="_M/BGEF_5717_PLUS">BGEF_5717_PLUS</a>;</td></tr>
<tr><th id="3311">3311</th><td>		<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="3312">3312</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>:</td></tr>
<tr><th id="3313">3313</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#379" title="0x57785" data-ref="_M/BGE_ASICREV_BCM57765">BGE_ASICREV_BCM57765</a>:</td></tr>
<tr><th id="3314">3314</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#380" title="0x57766" data-ref="_M/BGE_ASICREV_BCM57766">BGE_ASICREV_BCM57766</a>:</td></tr>
<tr><th id="3315">3315</th><td>		<b>if</b> (!<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3316">3316</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2679" title="0x00040000" data-ref="_M/BGEF_57765_FAMILY">BGEF_57765_FAMILY</a>;</td></tr>
<tr><th id="3317">3317</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2680" title="0x00080000" data-ref="_M/BGEF_57765_PLUS">BGEF_57765_PLUS</a> | <a class="macro" href="if_bgereg.h.html#2675" title="0x00004000" data-ref="_M/BGEF_5755_PLUS">BGEF_5755_PLUS</a> |</td></tr>
<tr><th id="3318">3318</th><td>		    <a class="macro" href="if_bgereg.h.html#2674" title="0x00002000" data-ref="_M/BGEF_575X_PLUS">BGEF_575X_PLUS</a> | <a class="macro" href="if_bgereg.h.html#2673" title="0x00001000" data-ref="_M/BGEF_5705_PLUS">BGEF_5705_PLUS</a> | <a class="macro" href="if_bgereg.h.html#2663" title="0x00000002" data-ref="_M/BGEF_JUMBO_CAPABLE">BGEF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3319">3319</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a> ||</td></tr>
<tr><th id="3320">3320</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>) {</td></tr>
<tr><th id="3321">3321</th><td>			<i>/*</i></td></tr>
<tr><th id="3322">3322</th><td><i>			 * Enable work around for DMA engine miscalculation</i></td></tr>
<tr><th id="3323">3323</th><td><i>			 * of TXMBUF available space.</i></td></tr>
<tr><th id="3324">3324</th><td><i>			 */</i></td></tr>
<tr><th id="3325">3325</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2684" title="0x00800000" data-ref="_M/BGEF_RDMA_BUG">BGEF_RDMA_BUG</a>;</td></tr>
<tr><th id="3326">3326</th><td></td></tr>
<tr><th id="3327">3327</th><td>			<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>) &amp;&amp;</td></tr>
<tr><th id="3328">3328</th><td>			    (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a>)) {</td></tr>
<tr><th id="3329">3329</th><td>				<i>/* Jumbo frame on BCM5719 A0 does not work. */</i></td></tr>
<tr><th id="3330">3330</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2663" title="0x00000002" data-ref="_M/BGEF_JUMBO_CAPABLE">BGEF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3331">3331</th><td>			}</td></tr>
<tr><th id="3332">3332</th><td>		}</td></tr>
<tr><th id="3333">3333</th><td>		<b>break</b>;</td></tr>
<tr><th id="3334">3334</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#368" title="0x0a" data-ref="_M/BGE_ASICREV_BCM5755">BGE_ASICREV_BCM5755</a>:</td></tr>
<tr><th id="3335">3335</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>:</td></tr>
<tr><th id="3336">3336</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a>:</td></tr>
<tr><th id="3337">3337</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>:</td></tr>
<tr><th id="3338">3338</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#369" title="0x0b" data-ref="_M/BGE_ASICREV_BCM5787">BGE_ASICREV_BCM5787</a>:</td></tr>
<tr><th id="3339">3339</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>:</td></tr>
<tr><th id="3340">3340</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2675" title="0x00004000" data-ref="_M/BGEF_5755_PLUS">BGEF_5755_PLUS</a> | <a class="macro" href="if_bgereg.h.html#2674" title="0x00002000" data-ref="_M/BGEF_575X_PLUS">BGEF_575X_PLUS</a> | <a class="macro" href="if_bgereg.h.html#2673" title="0x00001000" data-ref="_M/BGEF_5705_PLUS">BGEF_5705_PLUS</a>;</td></tr>
<tr><th id="3341">3341</th><td>		<b>break</b>;</td></tr>
<tr><th id="3342">3342</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a>:</td></tr>
<tr><th id="3343">3343</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a>:</td></tr>
<tr><th id="3344">3344</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a>:</td></tr>
<tr><th id="3345">3345</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>:</td></tr>
<tr><th id="3346">3346</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2672" title="0x00000800" data-ref="_M/BGEF_5700_FAMILY">BGEF_5700_FAMILY</a> | <a class="macro" href="if_bgereg.h.html#2663" title="0x00000002" data-ref="_M/BGEF_JUMBO_CAPABLE">BGEF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3347">3347</th><td>		<b>break</b>;</td></tr>
<tr><th id="3348">3348</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#363" title="0x05" data-ref="_M/BGE_ASICREV_BCM5714_A0">BGE_ASICREV_BCM5714_A0</a>:</td></tr>
<tr><th id="3349">3349</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#366" title="0x08" data-ref="_M/BGE_ASICREV_BCM5780">BGE_ASICREV_BCM5780</a>:</td></tr>
<tr><th id="3350">3350</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#367" title="0x09" data-ref="_M/BGE_ASICREV_BCM5714">BGE_ASICREV_BCM5714</a>:</td></tr>
<tr><th id="3351">3351</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2677" title="0x00010000" data-ref="_M/BGEF_5714_FAMILY">BGEF_5714_FAMILY</a> | <a class="macro" href="if_bgereg.h.html#2663" title="0x00000002" data-ref="_M/BGEF_JUMBO_CAPABLE">BGEF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3352">3352</th><td>		<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="3353">3353</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#362" title="0x04" data-ref="_M/BGE_ASICREV_BCM5750">BGE_ASICREV_BCM5750</a>:</td></tr>
<tr><th id="3354">3354</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#364" title="0x06" data-ref="_M/BGE_ASICREV_BCM5752">BGE_ASICREV_BCM5752</a>:</td></tr>
<tr><th id="3355">3355</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>:</td></tr>
<tr><th id="3356">3356</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2674" title="0x00002000" data-ref="_M/BGEF_575X_PLUS">BGEF_575X_PLUS</a>;</td></tr>
<tr><th id="3357">3357</th><td>		<i>/* FALLTHROUGH */</i></td></tr>
<tr><th id="3358">3358</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a>:</td></tr>
<tr><th id="3359">3359</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2673" title="0x00001000" data-ref="_M/BGEF_5705_PLUS">BGEF_5705_PLUS</a>;</td></tr>
<tr><th id="3360">3360</th><td>		<b>break</b>;</td></tr>
<tr><th id="3361">3361</th><td>	}</td></tr>
<tr><th id="3362">3362</th><td></td></tr>
<tr><th id="3363">3363</th><td>	<i>/* Identify chips with APE processor. */</i></td></tr>
<tr><th id="3364">3364</th><td>	<b>switch</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>)) {</td></tr>
<tr><th id="3365">3365</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a>:</td></tr>
<tr><th id="3366">3366</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>:</td></tr>
<tr><th id="3367">3367</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>:</td></tr>
<tr><th id="3368">3368</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a>:</td></tr>
<tr><th id="3369">3369</th><td>	<b>case</b> <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>:</td></tr>
<tr><th id="3370">3370</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2666" title="0x00000010" data-ref="_M/BGEF_APE">BGEF_APE</a>;</td></tr>
<tr><th id="3371">3371</th><td>		<b>break</b>;</td></tr>
<tr><th id="3372">3372</th><td>	}</td></tr>
<tr><th id="3373">3373</th><td></td></tr>
<tr><th id="3374">3374</th><td>	<i>/*</i></td></tr>
<tr><th id="3375">3375</th><td><i>	 * The 40bit DMA bug applies to the 5714/5715 controllers and is</i></td></tr>
<tr><th id="3376">3376</th><td><i>	 * not actually a MAC controller bug but an issue with the embedded</i></td></tr>
<tr><th id="3377">3377</th><td><i>	 * PCIe to PCI-X bridge in the device. Use 40bit DMA workaround.</i></td></tr>
<tr><th id="3378">3378</th><td><i>	 */</i></td></tr>
<tr><th id="3379">3379</th><td>	<b>if</b> (<a class="macro" href="#412" title="((sc)-&gt;bge_flags &amp; 0x00010000)" data-ref="_M/BGE_IS_5714_FAMILY">BGE_IS_5714_FAMILY</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>) &amp;&amp; ((<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>) != <var>0</var>))</td></tr>
<tr><th id="3380">3380</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2681" title="0x00100000" data-ref="_M/BGEF_40BIT_BUG">BGEF_40BIT_BUG</a>;</td></tr>
<tr><th id="3381">3381</th><td></td></tr>
<tr><th id="3382">3382</th><td>	<i>/* Chips with APE need BAR2 access for APE registers/memory. */</i></td></tr>
<tr><th id="3383">3383</th><td>	<b>if</b> ((<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2666" title="0x00000010" data-ref="_M/BGEF_APE">BGEF_APE</a>) != <var>0</var>) {</td></tr>
<tr><th id="3384">3384</th><td>		<a class="local col5 ref" href="#245memtype" title='memtype' data-ref="245memtype" data-ref-filename="245memtype">memtype</a> = <a class="ref fn" href="pcivar.h.html#pci_mapreg_type" title='pci_mapreg_type' data-ref="pci_mapreg_type" data-ref-filename="pci_mapreg_type">pci_mapreg_type</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#176" title="0x18" data-ref="_M/BGE_PCI_BAR2">BGE_PCI_BAR2</a>);</td></tr>
<tr><th id="3385">3385</th><td><u>#<span data-ppcond="3385">if</span> 0</u></td></tr>
<tr><th id="3386">3386</th><td>		<b>if</b> (pci_mapreg_map(pa, BGE_PCI_BAR2, memtype, <var>0</var>,</td></tr>
<tr><th id="3387">3387</th><td>			&amp;sc-&gt;bge_apetag, &amp;sc-&gt;bge_apehandle, NULL,</td></tr>
<tr><th id="3388">3388</th><td>			&amp;sc-&gt;bge_apesize)) {</td></tr>
<tr><th id="3389">3389</th><td>			aprint_error_dev(sc-&gt;bge_dev,</td></tr>
<tr><th id="3390">3390</th><td>			    <q>"couldn't map BAR2 memory\n"</q>);</td></tr>
<tr><th id="3391">3391</th><td>			<b>return</b>;</td></tr>
<tr><th id="3392">3392</th><td>		}</td></tr>
<tr><th id="3393">3393</th><td><u>#<span data-ppcond="3385">else</span></u></td></tr>
<tr><th id="3394">3394</th><td>		<i>/*</i></td></tr>
<tr><th id="3395">3395</th><td><i>		 * Workaround for PCI prefetchable bit. Some BCM5717-5720 based</i></td></tr>
<tr><th id="3396">3396</th><td><i>		 * system get NMI on boot (PR#48451). This problem might not be</i></td></tr>
<tr><th id="3397">3397</th><td><i>		 * the driver's bug but our PCI common part's bug. Until we</i></td></tr>
<tr><th id="3398">3398</th><td><i>		 * find a real reason, we ignore the prefetchable bit.</i></td></tr>
<tr><th id="3399">3399</th><td><i>		 */</i></td></tr>
<tr><th id="3400">3400</th><td>		<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_mapreg_info" title='pci_mapreg_info' data-ref="pci_mapreg_info" data-ref-filename="pci_mapreg_info">pci_mapreg_info</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#176" title="0x18" data-ref="_M/BGE_PCI_BAR2">BGE_PCI_BAR2</a>,</td></tr>
<tr><th id="3401">3401</th><td>		    <a class="local col5 ref" href="#245memtype" title='memtype' data-ref="245memtype" data-ref-filename="245memtype">memtype</a>, &amp;<a class="local col8 ref" href="#248memaddr" title='memaddr' data-ref="248memaddr" data-ref-filename="248memaddr">memaddr</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apesize" title='bge_softc::bge_apesize' data-ref="bge_softc::bge_apesize" data-ref-filename="bge_softc..bge_apesize">bge_apesize</a>, &amp;<a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a>) != <var>0</var>) {</td></tr>
<tr><th id="3402">3402</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3403">3403</th><td>			    <q>"couldn't map BAR2 memory\n"</q>);</td></tr>
<tr><th id="3404">3404</th><td>			<b>return</b>;</td></tr>
<tr><th id="3405">3405</th><td>		}</td></tr>
<tr><th id="3406">3406</th><td></td></tr>
<tr><th id="3407">3407</th><td>		<a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a> &amp;= ~<a class="macro" href="../../sys/bus_proto.h.html#80" title="0x04" data-ref="_M/BUS_SPACE_MAP_PREFETCHABLE">BUS_SPACE_MAP_PREFETCHABLE</a>;</td></tr>
<tr><th id="3408">3408</th><td>		<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_space_map" title='bus_space_map' data-ref="bus_space_map" data-ref-filename="bus_space_map">bus_space_map</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_memt" title='pci_attach_args::pa_memt' data-ref="pci_attach_args::pa_memt" data-ref-filename="pci_attach_args..pa_memt">pa_memt</a>, <a class="local col8 ref" href="#248memaddr" title='memaddr' data-ref="248memaddr" data-ref-filename="248memaddr">memaddr</a>,</td></tr>
<tr><th id="3409">3409</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apesize" title='bge_softc::bge_apesize' data-ref="bge_softc::bge_apesize" data-ref-filename="bge_softc..bge_apesize">bge_apesize</a>, <a class="local col3 ref" href="#253map_flags" title='map_flags' data-ref="253map_flags" data-ref-filename="253map_flags">map_flags</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apehandle" title='bge_softc::bge_apehandle' data-ref="bge_softc::bge_apehandle" data-ref-filename="bge_softc..bge_apehandle">bge_apehandle</a>) != <var>0</var>) {</td></tr>
<tr><th id="3410">3410</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3411">3411</th><td>			    <q>"couldn't map BAR2 memory\n"</q>);</td></tr>
<tr><th id="3412">3412</th><td>			<b>return</b>;</td></tr>
<tr><th id="3413">3413</th><td>		}</td></tr>
<tr><th id="3414">3414</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apetag" title='bge_softc::bge_apetag' data-ref="bge_softc::bge_apetag" data-ref-filename="bge_softc..bge_apetag">bge_apetag</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_memt" title='pci_attach_args::pa_memt' data-ref="pci_attach_args::pa_memt" data-ref-filename="pci_attach_args..pa_memt">pa_memt</a>;</td></tr>
<tr><th id="3415">3415</th><td><u>#<span data-ppcond="3385">endif</span></u></td></tr>
<tr><th id="3416">3416</th><td></td></tr>
<tr><th id="3417">3417</th><td>		<i>/* Enable APE register/memory access by host driver. */</i></td></tr>
<tr><th id="3418">3418</th><td>		<a class="local col7 ref" href="#247reg" title='reg' data-ref="247reg" data-ref-filename="247reg">reg</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#231" title="0x70" data-ref="_M/BGE_PCI_PCISTATE">BGE_PCI_PCISTATE</a>);</td></tr>
<tr><th id="3419">3419</th><td>		<a class="local col7 ref" href="#247reg" title='reg' data-ref="247reg" data-ref-filename="247reg">reg</a> |= <a class="macro" href="if_bgereg.h.html#453" title="0x00010000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_CTLSPC_WR">BGE_PCISTATE_ALLOW_APE_CTLSPC_WR</a> |</td></tr>
<tr><th id="3420">3420</th><td>		    <a class="macro" href="if_bgereg.h.html#454" title="0x00020000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_SHMEM_WR">BGE_PCISTATE_ALLOW_APE_SHMEM_WR</a> |</td></tr>
<tr><th id="3421">3421</th><td>		    <a class="macro" href="if_bgereg.h.html#455" title="0x00040000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_PSPACE_WR">BGE_PCISTATE_ALLOW_APE_PSPACE_WR</a>;</td></tr>
<tr><th id="3422">3422</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_pc" title='pci_attach_args::pa_pc' data-ref="pci_attach_args::pa_pc" data-ref-filename="pci_attach_args..pa_pc">pa_pc</a>, <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_tag" title='pci_attach_args::pa_tag' data-ref="pci_attach_args::pa_tag" data-ref-filename="pci_attach_args..pa_tag">pa_tag</a>, <a class="macro" href="if_bgereg.h.html#231" title="0x70" data-ref="_M/BGE_PCI_PCISTATE">BGE_PCI_PCISTATE</a>, <a class="local col7 ref" href="#247reg" title='reg' data-ref="247reg" data-ref-filename="247reg">reg</a>);</td></tr>
<tr><th id="3423">3423</th><td></td></tr>
<tr><th id="3424">3424</th><td>		<a class="tu ref fn" href="#bge_ape_lock_init" title='bge_ape_lock_init' data-use='c' data-ref="bge_ape_lock_init" data-ref-filename="bge_ape_lock_init">bge_ape_lock_init</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3425">3425</th><td>		<a class="tu ref fn" href="#bge_ape_read_fw_ver" title='bge_ape_read_fw_ver' data-use='c' data-ref="bge_ape_read_fw_ver" data-ref-filename="bge_ape_read_fw_ver">bge_ape_read_fw_ver</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3426">3426</th><td>	}</td></tr>
<tr><th id="3427">3427</th><td></td></tr>
<tr><th id="3428">3428</th><td>	<i>/* Identify the chips that use an CPMU. */</i></td></tr>
<tr><th id="3429">3429</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>) ||</td></tr>
<tr><th id="3430">3430</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a> ||</td></tr>
<tr><th id="3431">3431</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a> ||</td></tr>
<tr><th id="3432">3432</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a> ||</td></tr>
<tr><th id="3433">3433</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>)</td></tr>
<tr><th id="3434">3434</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2665" title="0x00000008" data-ref="_M/BGEF_CPMU_PRESENT">BGEF_CPMU_PRESENT</a>;</td></tr>
<tr><th id="3435">3435</th><td></td></tr>
<tr><th id="3436">3436</th><td>	<i>/* Set MI_MODE */</i></td></tr>
<tr><th id="3437">3437</th><td>	<a class="local col2 ref" href="#242mimode" title='mimode' data-ref="242mimode" data-ref-filename="242mimode">mimode</a> = <a class="macro" href="if_bgereg.h.html#867" title="((sc-&gt;bge_phy_addr) &lt;&lt; 5)" data-ref="_M/BGE_MIMODE_PHYADDR">BGE_MIMODE_PHYADDR</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a>);</td></tr>
<tr><th id="3438">3438</th><td>	<b>if</b> ((<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2665" title="0x00000008" data-ref="_M/BGEF_CPMU_PRESENT">BGEF_CPMU_PRESENT</a>) != <var>0</var>)</td></tr>
<tr><th id="3439">3439</th><td>		<a class="local col2 ref" href="#242mimode" title='mimode' data-ref="242mimode" data-ref-filename="242mimode">mimode</a> |= <a class="macro" href="if_bgereg.h.html#864" title="0x00008000" data-ref="_M/BGE_MIMODE_500KHZ_CONST">BGE_MIMODE_500KHZ_CONST</a>;</td></tr>
<tr><th id="3440">3440</th><td>	<b>else</b></td></tr>
<tr><th id="3441">3441</th><td>		<a class="local col2 ref" href="#242mimode" title='mimode' data-ref="242mimode" data-ref-filename="242mimode">mimode</a> |= <a class="macro" href="if_bgereg.h.html#865" title="0x000C0000" data-ref="_M/BGE_MIMODE_BASE">BGE_MIMODE_BASE</a>;</td></tr>
<tr><th id="3442">3442</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0454, mimode)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#646" title="0x0454" data-ref="_M/BGE_MI_MODE">BGE_MI_MODE</a>, <a class="local col2 ref" href="#242mimode" title='mimode' data-ref="242mimode" data-ref-filename="242mimode">mimode</a>);</td></tr>
<tr><th id="3443">3443</th><td></td></tr>
<tr><th id="3444">3444</th><td>	<i>/*</i></td></tr>
<tr><th id="3445">3445</th><td><i>	 * When using the BCM5701 in PCI-X mode, data corruption has</i></td></tr>
<tr><th id="3446">3446</th><td><i>	 * been observed in the first few bytes of some received packets.</i></td></tr>
<tr><th id="3447">3447</th><td><i>	 * Aligning the packet buffer in memory eliminates the corruption.</i></td></tr>
<tr><th id="3448">3448</th><td><i>	 * Unfortunately, this misaligns the packet payloads.  On platforms</i></td></tr>
<tr><th id="3449">3449</th><td><i>	 * which do not support unaligned accesses, we will realign the</i></td></tr>
<tr><th id="3450">3450</th><td><i>	 * payloads by copying the received packets.</i></td></tr>
<tr><th id="3451">3451</th><td><i>	 */</i></td></tr>
<tr><th id="3452">3452</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a> &amp;&amp;</td></tr>
<tr><th id="3453">3453</th><td>	    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>)</td></tr>
<tr><th id="3454">3454</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2683" title="0x00400000" data-ref="_M/BGEF_RX_ALIGNBUG">BGEF_RX_ALIGNBUG</a>;</td></tr>
<tr><th id="3455">3455</th><td></td></tr>
<tr><th id="3456">3456</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3457">3457</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2663" title="0x00000002" data-ref="_M/BGEF_JUMBO_CAPABLE">BGEF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3458">3458</th><td></td></tr>
<tr><th id="3459">3459</th><td>	<a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>);</td></tr>
<tr><th id="3460">3460</th><td>	<a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> &amp;= <a class="macro" href="if_bgereg.h.html#2043" title="0x0001e000" data-ref="_M/BGE_MISCCFG_BOARD_ID_MASK">BGE_MISCCFG_BOARD_ID_MASK</a>;</td></tr>
<tr><th id="3461">3461</th><td></td></tr>
<tr><th id="3462">3462</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a> &amp;&amp;</td></tr>
<tr><th id="3463">3463</th><td>	    (<a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> == <a class="macro" href="if_bgereg.h.html#2041" title="0x00010000" data-ref="_M/BGE_MISCCFG_BOARD_ID_5788">BGE_MISCCFG_BOARD_ID_5788</a> ||</td></tr>
<tr><th id="3464">3464</th><td>	     <a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> == <a class="macro" href="if_bgereg.h.html#2042" title="0x00018000" data-ref="_M/BGE_MISCCFG_BOARD_ID_5788M">BGE_MISCCFG_BOARD_ID_5788M</a>))</td></tr>
<tr><th id="3465">3465</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2676" title="0x00008000" data-ref="_M/BGEF_IS_5788">BGEF_IS_5788</a>;</td></tr>
<tr><th id="3466">3466</th><td></td></tr>
<tr><th id="3467">3467</th><td>	<i>/*</i></td></tr>
<tr><th id="3468">3468</th><td><i>	 * Some controllers seem to require a special firmware to use</i></td></tr>
<tr><th id="3469">3469</th><td><i>	 * TSO. But the firmware is not available to FreeBSD and Linux</i></td></tr>
<tr><th id="3470">3470</th><td><i>	 * claims that the TSO performed by the firmware is slower than</i></td></tr>
<tr><th id="3471">3471</th><td><i>	 * hardware based TSO. Moreover the firmware based TSO has one</i></td></tr>
<tr><th id="3472">3472</th><td><i>	 * known bug which can't handle TSO if ethernet header + IP/TCP</i></td></tr>
<tr><th id="3473">3473</th><td><i>	 * header is greater than 80 bytes. The workaround for the TSO</i></td></tr>
<tr><th id="3474">3474</th><td><i>	 * bug exist but it seems it's too expensive than not using</i></td></tr>
<tr><th id="3475">3475</th><td><i>	 * TSO at all. Some hardwares also have the TSO bug so limit</i></td></tr>
<tr><th id="3476">3476</th><td><i>	 * the TSO to the controllers that are not affected TSO issues</i></td></tr>
<tr><th id="3477">3477</th><td><i>	 * (e.g. 5755 or higher).</i></td></tr>
<tr><th id="3478">3478</th><td><i>	 */</i></td></tr>
<tr><th id="3479">3479</th><td>	<b>if</b> (<a class="macro" href="#414" title="((sc)-&gt;bge_flags &amp; 0x00004000)" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3480">3480</th><td>		<i>/*</i></td></tr>
<tr><th id="3481">3481</th><td><i>		 * BCM5754 and BCM5787 shares the same ASIC id so</i></td></tr>
<tr><th id="3482">3482</th><td><i>		 * explicit device id check is required.</i></td></tr>
<tr><th id="3483">3483</th><td><i>		 */</i></td></tr>
<tr><th id="3484">3484</th><td>		<b>if</b> ((<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) != <a class="macro" href="pcidevs.h.html#1941" title="0x167a" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5754">PCI_PRODUCT_BROADCOM_BCM5754</a>) &amp;&amp;</td></tr>
<tr><th id="3485">3485</th><td>		    (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) != <a class="macro" href="pcidevs.h.html#1934" title="0x1672" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5754M">PCI_PRODUCT_BROADCOM_BCM5754M</a>))</td></tr>
<tr><th id="3486">3486</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2670" title="0x00000100" data-ref="_M/BGEF_TSO">BGEF_TSO</a>;</td></tr>
<tr><th id="3487">3487</th><td>		<i>/* TSO on BCM5719 A0 does not work. */</i></td></tr>
<tr><th id="3488">3488</th><td>		<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>) &amp;&amp;</td></tr>
<tr><th id="3489">3489</th><td>		    (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a>))</td></tr>
<tr><th id="3490">3490</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2670" title="0x00000100" data-ref="_M/BGEF_TSO">BGEF_TSO</a>;</td></tr>
<tr><th id="3491">3491</th><td>	}</td></tr>
<tr><th id="3492">3492</th><td></td></tr>
<tr><th id="3493">3493</th><td>	<a class="local col1 ref" href="#251capmask" title='capmask' data-ref="251capmask" data-ref-filename="251capmask">capmask</a> = <var>0xffffffff</var>; <i>/* XXX BMSR_DEFCAPMASK */</i></td></tr>
<tr><th id="3494">3494</th><td>	<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a> &amp;&amp;</td></tr>
<tr><th id="3495">3495</th><td>	     (<a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> == <var>0x4000</var> || <a class="local col1 ref" href="#241misccfg" title='misccfg' data-ref="241misccfg" data-ref-filename="241misccfg">misccfg</a> == <var>0x8000</var>)) ||</td></tr>
<tr><th id="3496">3496</th><td>	    (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a> &amp;&amp;</td></tr>
<tr><th id="3497">3497</th><td>	     <a class="macro" href="pcireg.h.html#58" title="(((pa-&gt;pa_id) &gt;&gt; 0) &amp; 0xffff)" data-ref="_M/PCI_VENDOR">PCI_VENDOR</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#590" title="0x14e4" data-ref="_M/PCI_VENDOR_BROADCOM">PCI_VENDOR_BROADCOM</a> &amp;&amp;</td></tr>
<tr><th id="3498">3498</th><td>	     (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#2023" title="0x170d" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5901">PCI_PRODUCT_BROADCOM_BCM5901</a> ||</td></tr>
<tr><th id="3499">3499</th><td>	      <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#2024" title="0x170e" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5901A2">PCI_PRODUCT_BROADCOM_BCM5901A2</a> ||</td></tr>
<tr><th id="3500">3500</th><td>	      <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1933" title="0x166e" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5705F">PCI_PRODUCT_BROADCOM_BCM5705F</a>)) ||</td></tr>
<tr><th id="3501">3501</th><td>	    (<a class="macro" href="pcireg.h.html#58" title="(((pa-&gt;pa_id) &gt;&gt; 0) &amp; 0xffff)" data-ref="_M/PCI_VENDOR">PCI_VENDOR</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#590" title="0x14e4" data-ref="_M/PCI_VENDOR_BROADCOM">PCI_VENDOR_BROADCOM</a> &amp;&amp;</td></tr>
<tr><th id="3502">3502</th><td>	     (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1945" title="0x167e" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5751F">PCI_PRODUCT_BROADCOM_BCM5751F</a> ||</td></tr>
<tr><th id="3503">3503</th><td>	      <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#2020" title="0x16fe" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5753F">PCI_PRODUCT_BROADCOM_BCM5753F</a> ||</td></tr>
<tr><th id="3504">3504</th><td>	      <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1946" title="0x167f" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5787F">PCI_PRODUCT_BROADCOM_BCM5787F</a>)) ||</td></tr>
<tr><th id="3505">3505</th><td>	    <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1963" title="0x1694" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57790">PCI_PRODUCT_BROADCOM_BCM57790</a> ||</td></tr>
<tr><th id="3506">3506</th><td>	    <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1988" title="0x16b2" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57791">PCI_PRODUCT_BROADCOM_BCM57791</a> ||</td></tr>
<tr><th id="3507">3507</th><td>	    <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1992" title="0x16b6" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM57795">PCI_PRODUCT_BROADCOM_BCM57795</a> ||</td></tr>
<tr><th id="3508">3508</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="3509">3509</th><td>		<i>/* These chips are 10/100 only. */</i></td></tr>
<tr><th id="3510">3510</th><td>		<a class="local col1 ref" href="#251capmask" title='capmask' data-ref="251capmask" data-ref-filename="251capmask">capmask</a> &amp;= ~<a class="macro" href="../mii/mii.h.html#77" title="0x0100" data-ref="_M/BMSR_EXTSTAT">BMSR_EXTSTAT</a>;</td></tr>
<tr><th id="3511">3511</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2697" title="0x00000080" data-ref="_M/BGEPHYF_NO_WIRESPEED">BGEPHYF_NO_WIRESPEED</a>;</td></tr>
<tr><th id="3512">3512</th><td>	}</td></tr>
<tr><th id="3513">3513</th><td></td></tr>
<tr><th id="3514">3514</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> ||</td></tr>
<tr><th id="3515">3515</th><td>	    (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#361" title="0x03" data-ref="_M/BGE_ASICREV_BCM5705">BGE_ASICREV_BCM5705</a> &amp;&amp;</td></tr>
<tr><th id="3516">3516</th><td>	     (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#307" title="0x3000" data-ref="_M/BGE_CHIPID_BCM5705_A0">BGE_CHIPID_BCM5705_A0</a> &amp;&amp;</td></tr>
<tr><th id="3517">3517</th><td>		 <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#308" title="0x3001" data-ref="_M/BGE_CHIPID_BCM5705_A1">BGE_CHIPID_BCM5705_A1</a>)))</td></tr>
<tr><th id="3518">3518</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2697" title="0x00000080" data-ref="_M/BGEPHYF_NO_WIRESPEED">BGEPHYF_NO_WIRESPEED</a>;</td></tr>
<tr><th id="3519">3519</th><td></td></tr>
<tr><th id="3520">3520</th><td>	<i>/* Set various PHY bug flags. */</i></td></tr>
<tr><th id="3521">3521</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#293" title="0x0000" data-ref="_M/BGE_CHIPID_BCM5701_A0">BGE_CHIPID_BCM5701_A0</a> ||</td></tr>
<tr><th id="3522">3522</th><td>	    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#294" title="0x0100" data-ref="_M/BGE_CHIPID_BCM5701_B0">BGE_CHIPID_BCM5701_B0</a>)</td></tr>
<tr><th id="3523">3523</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2691" title="0x00000002" data-ref="_M/BGEPHYF_CRC_BUG">BGEPHYF_CRC_BUG</a>;</td></tr>
<tr><th id="3524">3524</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#389" title="0x10" data-ref="_M/BGE_CHIPREV_5703_AX">BGE_CHIPREV_5703_AX</a> ||</td></tr>
<tr><th id="3525">3525</th><td>	    <a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#390" title="0x20" data-ref="_M/BGE_CHIPREV_5704_AX">BGE_CHIPREV_5704_AX</a>)</td></tr>
<tr><th id="3526">3526</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2692" title="0x00000004" data-ref="_M/BGEPHYF_ADC_BUG">BGEPHYF_ADC_BUG</a>;</td></tr>
<tr><th id="3527">3527</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#302" title="0x2000" data-ref="_M/BGE_CHIPID_BCM5704_A0">BGE_CHIPID_BCM5704_A0</a>)</td></tr>
<tr><th id="3528">3528</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2693" title="0x00000008" data-ref="_M/BGEPHYF_5704_A0_BUG">BGEPHYF_5704_A0_BUG</a>;</td></tr>
<tr><th id="3529">3529</th><td>	<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> ||</td></tr>
<tr><th id="3530">3530</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a>) &amp;&amp;</td></tr>
<tr><th id="3531">3531</th><td>	    <a class="macro" href="pcireg.h.html#58" title="(((subid) &gt;&gt; 0) &amp; 0xffff)" data-ref="_M/PCI_VENDOR">PCI_VENDOR</a>(<a class="local col6 ref" href="#246subid" title='subid' data-ref="246subid" data-ref-filename="246subid">subid</a>) == <a class="macro" href="pcidevs.h.html#103" title="0x1028" data-ref="_M/PCI_VENDOR_DELL">PCI_VENDOR_DELL</a>)</td></tr>
<tr><th id="3532">3532</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2690" title="0x00000001" data-ref="_M/BGEPHYF_NO_3LED">BGEPHYF_NO_3LED</a>;</td></tr>
<tr><th id="3533">3533</th><td>	<b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="3534">3534</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a> &amp;&amp;</td></tr>
<tr><th id="3535">3535</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a> &amp;&amp;</td></tr>
<tr><th id="3536">3536</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a> &amp;&amp;</td></tr>
<tr><th id="3537">3537</th><td>	    !<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3538">3538</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#368" title="0x0a" data-ref="_M/BGE_ASICREV_BCM5755">BGE_ASICREV_BCM5755</a> ||</td></tr>
<tr><th id="3539">3539</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#372" title="0x5761" data-ref="_M/BGE_ASICREV_BCM5761">BGE_ASICREV_BCM5761</a> ||</td></tr>
<tr><th id="3540">3540</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a> ||</td></tr>
<tr><th id="3541">3541</th><td>		    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#369" title="0x0b" data-ref="_M/BGE_ASICREV_BCM5787">BGE_ASICREV_BCM5787</a>) {</td></tr>
<tr><th id="3542">3542</th><td>			<b>if</b> (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) != <a class="macro" href="pcidevs.h.html#1919" title="0x165a" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5722">PCI_PRODUCT_BROADCOM_BCM5722</a> &amp;&amp;</td></tr>
<tr><th id="3543">3543</th><td>			    <a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) != <a class="macro" href="pcidevs.h.html#1936" title="0x1674" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5756">PCI_PRODUCT_BROADCOM_BCM5756</a>)</td></tr>
<tr><th id="3544">3544</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2694" title="0x00000010" data-ref="_M/BGEPHYF_JITTER_BUG">BGEPHYF_JITTER_BUG</a>;</td></tr>
<tr><th id="3545">3545</th><td>			<b>if</b> (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="pcidevs.h.html#1935" title="0x1673" data-ref="_M/PCI_PRODUCT_BROADCOM_BCM5755M">PCI_PRODUCT_BROADCOM_BCM5755M</a>)</td></tr>
<tr><th id="3546">3546</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2696" title="0x00000040" data-ref="_M/BGEPHYF_ADJUST_TRIM">BGEPHYF_ADJUST_TRIM</a>;</td></tr>
<tr><th id="3547">3547</th><td>		} <b>else</b></td></tr>
<tr><th id="3548">3548</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2695" title="0x00000020" data-ref="_M/BGEPHYF_BER_BUG">BGEPHYF_BER_BUG</a>;</td></tr>
<tr><th id="3549">3549</th><td>	}</td></tr>
<tr><th id="3550">3550</th><td></td></tr>
<tr><th id="3551">3551</th><td>	<i>/*</i></td></tr>
<tr><th id="3552">3552</th><td><i>	 * SEEPROM check.</i></td></tr>
<tr><th id="3553">3553</th><td><i>	 * First check if firmware knows we do not have SEEPROM.</i></td></tr>
<tr><th id="3554">3554</th><td><i>	 */</i></td></tr>
<tr><th id="3555">3555</th><td>	<b>if</b> (<a class="ref fn" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_get_bool" title='prop_dictionary_get_bool' data-ref="prop_dictionary_get_bool" data-ref-filename="prop_dictionary_get_bool">prop_dictionary_get_bool</a>(<a class="ref fn" href="../../sys/device.h.html#device_properties" title='device_properties' data-ref="device_properties" data-ref-filename="device_properties">device_properties</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>),</td></tr>
<tr><th id="3556">3556</th><td>	     <q>"without-seeprom"</q>, &amp;<a class="local col0 ref" href="#250no_seeprom" title='no_seeprom' data-ref="250no_seeprom" data-ref-filename="250no_seeprom">no_seeprom</a>) &amp;&amp; <a class="local col0 ref" href="#250no_seeprom" title='no_seeprom' data-ref="250no_seeprom" data-ref-filename="250no_seeprom">no_seeprom</a>)</td></tr>
<tr><th id="3557">3557</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>;</td></tr>
<tr><th id="3558">3558</th><td></td></tr>
<tr><th id="3559">3559</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="3560">3560</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>;</td></tr>
<tr><th id="3561">3561</th><td></td></tr>
<tr><th id="3562">3562</th><td>	<i>/* Now check the 'ROM failed' bit on the RX CPU */</i></td></tr>
<tr><th id="3563">3563</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5000)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1612" title="0x5000" data-ref="_M/BGE_RXCPU_MODE">BGE_RXCPU_MODE</a>) &amp; <a class="macro" href="if_bgereg.h.html#1623" title="0x00000040" data-ref="_M/BGE_RXCPUMODE_ROMFAIL">BGE_RXCPUMODE_ROMFAIL</a>)</td></tr>
<tr><th id="3564">3564</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>;</td></tr>
<tr><th id="3565">3565</th><td></td></tr>
<tr><th id="3566">3566</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> = <var>0</var>;</td></tr>
<tr><th id="3567">3567</th><td>	<i>/* No ASF if APE present. */</i></td></tr>
<tr><th id="3568">3568</th><td>	<b>if</b> ((<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2666" title="0x00000010" data-ref="_M/BGEF_APE">BGEF_APE</a>) == <var>0</var>) {</td></tr>
<tr><th id="3569">3569</th><td>		<b>if</b> (<a class="tu ref" href="#bge_allow_asf" title='bge_allow_asf' data-use='r' data-ref="bge_allow_asf" data-ref-filename="bge_allow_asf">bge_allow_asf</a> &amp;&amp; (<a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#76" title="0x00000B54" data-ref="_M/BGE_SRAM_DATA_SIG">BGE_SRAM_DATA_SIG</a>) ==</td></tr>
<tr><th id="3570">3570</th><td>			<a class="macro" href="if_bgereg.h.html#99" title="0x4B657654" data-ref="_M/BGE_SRAM_DATA_SIG_MAGIC">BGE_SRAM_DATA_SIG_MAGIC</a>)) {</td></tr>
<tr><th id="3571">3571</th><td>			<b>if</b> (<a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#77" title="0x00000B58" data-ref="_M/BGE_SRAM_DATA_CFG">BGE_SRAM_DATA_CFG</a>) &amp;</td></tr>
<tr><th id="3572">3572</th><td>			    <a class="macro" href="if_bgereg.h.html#2423" title="0x00000080" data-ref="_M/BGE_HWCFG_ASF">BGE_HWCFG_ASF</a>) {</td></tr>
<tr><th id="3573">3573</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> |= <a class="macro" href="if_bgevar.h.html#257" title="1" data-ref="_M/ASF_ENABLE">ASF_ENABLE</a>;</td></tr>
<tr><th id="3574">3574</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> |= <a class="macro" href="if_bgevar.h.html#259" title="4" data-ref="_M/ASF_STACKUP">ASF_STACKUP</a>;</td></tr>
<tr><th id="3575">3575</th><td>				<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3576">3576</th><td>					<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> |= <a class="macro" href="if_bgevar.h.html#258" title="2" data-ref="_M/ASF_NEW_HANDSHAKE">ASF_NEW_HANDSHAKE</a>;</td></tr>
<tr><th id="3577">3577</th><td>			}</td></tr>
<tr><th id="3578">3578</th><td>		}</td></tr>
<tr><th id="3579">3579</th><td>	}</td></tr>
<tr><th id="3580">3580</th><td></td></tr>
<tr><th id="3581">3581</th><td>	<em>int</em> <dfn class="local col5 decl" id="255counts" title='counts' data-type='int [3]' data-ref="255counts" data-ref-filename="255counts">counts</dfn>[<a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_SIZE" title='PCI_INTR_TYPE_SIZE' data-ref="PCI_INTR_TYPE_SIZE" data-ref-filename="PCI_INTR_TYPE_SIZE">PCI_INTR_TYPE_SIZE</a>] = {</td></tr>
<tr><th id="3582">3582</th><td>		[<a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_INTX" title='PCI_INTR_TYPE_INTX' data-ref="PCI_INTR_TYPE_INTX" data-ref-filename="PCI_INTR_TYPE_INTX">PCI_INTR_TYPE_INTX</a>] = <var>1</var>,</td></tr>
<tr><th id="3583">3583</th><td>		[<a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_MSI" title='PCI_INTR_TYPE_MSI' data-ref="PCI_INTR_TYPE_MSI" data-ref-filename="PCI_INTR_TYPE_MSI">PCI_INTR_TYPE_MSI</a>] = <var>1</var>,</td></tr>
<tr><th id="3584">3584</th><td>		[<a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_MSIX" title='PCI_INTR_TYPE_MSIX' data-ref="PCI_INTR_TYPE_MSIX" data-ref-filename="PCI_INTR_TYPE_MSIX">PCI_INTR_TYPE_MSIX</a>] = <var>1</var>,</td></tr>
<tr><th id="3585">3585</th><td>	};</td></tr>
<tr><th id="3586">3586</th><td>	<em>int</em> <dfn class="local col6 decl" id="256max_type" title='max_type' data-type='int' data-ref="256max_type" data-ref-filename="256max_type">max_type</dfn> = <a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_MSIX" title='PCI_INTR_TYPE_MSIX' data-ref="PCI_INTR_TYPE_MSIX" data-ref-filename="PCI_INTR_TYPE_MSIX">PCI_INTR_TYPE_MSIX</a>;</td></tr>
<tr><th id="3587">3587</th><td></td></tr>
<tr><th id="3588">3588</th><td>	<b>if</b> (!<a class="tu ref fn" href="#bge_can_use_msi" title='bge_can_use_msi' data-use='c' data-ref="bge_can_use_msi" data-ref-filename="bge_can_use_msi">bge_can_use_msi</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3589">3589</th><td>		<i>/* MSI broken, allow only INTx */</i></td></tr>
<tr><th id="3590">3590</th><td>		<a class="local col6 ref" href="#256max_type" title='max_type' data-ref="256max_type" data-ref-filename="256max_type">max_type</a> = <a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_INTX" title='PCI_INTR_TYPE_INTX' data-ref="PCI_INTR_TYPE_INTX" data-ref-filename="PCI_INTR_TYPE_INTX">PCI_INTR_TYPE_INTX</a>;</td></tr>
<tr><th id="3591">3591</th><td>	}</td></tr>
<tr><th id="3592">3592</th><td></td></tr>
<tr><th id="3593">3593</th><td>	<b>if</b> (<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_alloc" title='pci_intr_alloc' data-ref="pci_intr_alloc" data-ref-filename="pci_intr_alloc">pci_intr_alloc</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>, <a class="local col5 ref" href="#255counts" title='counts' data-ref="255counts" data-ref-filename="255counts">counts</a>, <a class="local col6 ref" href="#256max_type" title='max_type' data-ref="256max_type" data-ref-filename="256max_type">max_type</a>) != <var>0</var>) {</td></tr>
<tr><th id="3594">3594</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"couldn't alloc interrupt\n"</q>);</td></tr>
<tr><th id="3595">3595</th><td>		<b>return</b>;</td></tr>
<tr><th id="3596">3596</th><td>	}</td></tr>
<tr><th id="3597">3597</th><td></td></tr>
<tr><th id="3598">3598</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"pci_intr_string\n"</q>));</td></tr>
<tr><th id="3599">3599</th><td>	<a class="local col2 ref" href="#232intrstr" title='intrstr' data-ref="232intrstr" data-ref-filename="232intrstr">intrstr</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_string" title='pci_intr_string' data-ref="pci_intr_string" data-ref-filename="pci_intr_string">pci_intr_string</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>[<var>0</var>], <a class="local col4 ref" href="#254intrbuf" title='intrbuf' data-ref="254intrbuf" data-ref-filename="254intrbuf">intrbuf</a>,</td></tr>
<tr><th id="3600">3600</th><td>	    <b>sizeof</b>(<a class="local col4 ref" href="#254intrbuf" title='intrbuf' data-ref="254intrbuf" data-ref-filename="254intrbuf">intrbuf</a>));</td></tr>
<tr><th id="3601">3601</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"pci_intr_establish\n"</q>));</td></tr>
<tr><th id="3602">3602</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_intrhand" title='bge_softc::bge_intrhand' data-ref="bge_softc::bge_intrhand" data-ref-filename="bge_softc..bge_intrhand">bge_intrhand</a> = <a class="ref fn" href="pcivar.h.html#pci_intr_establish_xname" title='pci_intr_establish_xname' data-ref="pci_intr_establish_xname" data-ref-filename="pci_intr_establish_xname">pci_intr_establish_xname</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>[<var>0</var>],</td></tr>
<tr><th id="3603">3603</th><td>	    <a class="macro" href="../../sys/intr.h.html#85" title="0x6" data-ref="_M/IPL_NET">IPL_NET</a>, <a class="tu ref fn" href="#bge_intr" title='bge_intr' data-use='r' data-ref="bge_intr" data-ref-filename="bge_intr">bge_intr</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>));</td></tr>
<tr><th id="3604">3604</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_intrhand" title='bge_softc::bge_intrhand' data-ref="bge_softc::bge_intrhand" data-ref-filename="bge_softc..bge_intrhand">bge_intrhand</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="3605">3605</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_release" title='pci_intr_release' data-ref="pci_intr_release" data-ref-filename="pci_intr_release">pci_intr_release</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>, <var>1</var>);</td></tr>
<tr><th id="3606">3606</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3607">3607</th><td></td></tr>
<tr><th id="3608">3608</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>, <q>"couldn't establish interrupt"</q>);</td></tr>
<tr><th id="3609">3609</th><td>		<b>if</b> (<a class="local col2 ref" href="#232intrstr" title='intrstr' data-ref="232intrstr" data-ref-filename="232intrstr">intrstr</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="3610">3610</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error" title='aprint_error' data-ref="aprint_error" data-ref-filename="aprint_error">aprint_error</a>(<q>" at %s"</q>, <a class="local col2 ref" href="#232intrstr" title='intrstr' data-ref="232intrstr" data-ref-filename="232intrstr">intrstr</a>);</td></tr>
<tr><th id="3611">3611</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error" title='aprint_error' data-ref="aprint_error" data-ref-filename="aprint_error">aprint_error</a>(<q>"\n"</q>);</td></tr>
<tr><th id="3612">3612</th><td>		<b>return</b>;</td></tr>
<tr><th id="3613">3613</th><td>	}</td></tr>
<tr><th id="3614">3614</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_normal_dev" title='aprint_normal_dev' data-ref="aprint_normal_dev" data-ref-filename="aprint_normal_dev">aprint_normal_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"interrupting at %s\n"</q>, <a class="local col2 ref" href="#232intrstr" title='intrstr' data-ref="232intrstr" data-ref-filename="232intrstr">intrstr</a>);</td></tr>
<tr><th id="3615">3615</th><td></td></tr>
<tr><th id="3616">3616</th><td>	<b>switch</b> (<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_type" title='pci_intr_type' data-ref="pci_intr_type" data-ref-filename="pci_intr_type">pci_intr_type</a>(<a class="local col1 ref" href="#231pc" title='pc' data-ref="231pc" data-ref-filename="231pc">pc</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>[<var>0</var>])) {</td></tr>
<tr><th id="3617">3617</th><td>	<b>case</b> <a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_MSIX" title='PCI_INTR_TYPE_MSIX' data-ref="PCI_INTR_TYPE_MSIX" data-ref-filename="PCI_INTR_TYPE_MSIX">PCI_INTR_TYPE_MSIX</a>:</td></tr>
<tr><th id="3618">3618</th><td>	<b>case</b> <a class="enum" href="../../arch/x86/include/pci_machdep_common.h.html#PCI_INTR_TYPE_MSI" title='PCI_INTR_TYPE_MSI' data-ref="PCI_INTR_TYPE_MSI" data-ref-filename="PCI_INTR_TYPE_MSI">PCI_INTR_TYPE_MSI</a>:</td></tr>
<tr><th id="3619">3619</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((bge_can_use_msi(sc))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;bge_can_use_msi(sc)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 3619))" data-ref="_M/KASSERT">KASSERT</a>(<a class="tu ref fn" href="#bge_can_use_msi" title='bge_can_use_msi' data-use='c' data-ref="bge_can_use_msi" data-ref-filename="bge_can_use_msi">bge_can_use_msi</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>));</td></tr>
<tr><th id="3620">3620</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2667" title="0x00000020" data-ref="_M/BGEF_MSI">BGEF_MSI</a>;</td></tr>
<tr><th id="3621">3621</th><td>		<b>break</b>;</td></tr>
<tr><th id="3622">3622</th><td>	<b>default</b>:</td></tr>
<tr><th id="3623">3623</th><td>		<i>/* nothing to do */</i></td></tr>
<tr><th id="3624">3624</th><td>		<b>break</b>;</td></tr>
<tr><th id="3625">3625</th><td>	}</td></tr>
<tr><th id="3626">3626</th><td></td></tr>
<tr><th id="3627">3627</th><td>	<i>/*</i></td></tr>
<tr><th id="3628">3628</th><td><i>	 * All controllers except BCM5700 supports tagged status but</i></td></tr>
<tr><th id="3629">3629</th><td><i>	 * we use tagged status only for MSI case on BCM5717. Otherwise</i></td></tr>
<tr><th id="3630">3630</th><td><i>	 * MSI on BCM5717 does not work.</i></td></tr>
<tr><th id="3631">3631</th><td><i>	 */</i></td></tr>
<tr><th id="3632">3632</th><td>	<b>if</b> (<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>) &amp;&amp; <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2667" title="0x00000020" data-ref="_M/BGEF_MSI">BGEF_MSI</a>)</td></tr>
<tr><th id="3633">3633</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2682" title="0x00200000" data-ref="_M/BGEF_TAGGED_STATUS">BGEF_TAGGED_STATUS</a>;</td></tr>
<tr><th id="3634">3634</th><td></td></tr>
<tr><th id="3635">3635</th><td>	<i>/*</i></td></tr>
<tr><th id="3636">3636</th><td><i>	 * Reset NVRAM before bge_reset(). It's required to acquire NVRAM</i></td></tr>
<tr><th id="3637">3637</th><td><i>	 * lock in bge_reset().</i></td></tr>
<tr><th id="3638">3638</th><td><i>	 */</i></td></tr>
<tr><th id="3639">3639</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6838, 0x20000000 | ((0x60 &amp; 0x1FF) &lt;&lt; 16))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1902" title="0x6838" data-ref="_M/BGE_EE_ADDR">BGE_EE_ADDR</a>,</td></tr>
<tr><th id="3640">3640</th><td>	    <a class="macro" href="if_bgereg.h.html#2084" title="0x20000000" data-ref="_M/BGE_EEADDR_RESET">BGE_EEADDR_RESET</a> | <a class="macro" href="if_bgereg.h.html#2089" title="((0x60 &amp; 0x1FF) &lt;&lt; 16)" data-ref="_M/BGE_EEHALFCLK">BGE_EEHALFCLK</a>(<a class="macro" href="if_bgereg.h.html#2090" title="0x60" data-ref="_M/BGE_HALFCLK_384SCL">BGE_HALFCLK_384SCL</a>));</td></tr>
<tr><th id="3641">3641</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(1000)" data-ref="_M/delay">delay</a>(<var>1000</var>);</td></tr>
<tr><th id="3642">3642</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808) | (0x01000000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>, <a class="macro" href="if_bgereg.h.html#2069" title="0x01000000" data-ref="_M/BGE_MLC_AUTO_EEPROM">BGE_MLC_AUTO_EEPROM</a>);</td></tr>
<tr><th id="3643">3643</th><td></td></tr>
<tr><th id="3644">3644</th><td>	<a class="tu ref fn" href="#bge_stop_fw" title='bge_stop_fw' data-use='c' data-ref="bge_stop_fw" data-ref-filename="bge_stop_fw">bge_stop_fw</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3645">3645</th><td>	<a class="tu ref fn" href="#bge_sig_pre_reset" title='bge_sig_pre_reset' data-use='c' data-ref="bge_sig_pre_reset" data-ref-filename="bge_sig_pre_reset">bge_sig_pre_reset</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="3646">3646</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_reset" title='bge_reset' data-use='c' data-ref="bge_reset" data-ref-filename="bge_reset">bge_reset</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3647">3647</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"chip reset failed\n"</q>);</td></tr>
<tr><th id="3648">3648</th><td></td></tr>
<tr><th id="3649">3649</th><td>	<i>/*</i></td></tr>
<tr><th id="3650">3650</th><td><i>	 * Read the hardware config word in the first 32k of NIC internal</i></td></tr>
<tr><th id="3651">3651</th><td><i>	 * memory, or fall back to the config word in the EEPROM.</i></td></tr>
<tr><th id="3652">3652</th><td><i>	 * Note: on some BCM5700 cards, this value appears to be unset.</i></td></tr>
<tr><th id="3653">3653</th><td><i>	 */</i></td></tr>
<tr><th id="3654">3654</th><td>	<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a> = <a class="local col4 ref" href="#234hwcfg2" title='hwcfg2' data-ref="234hwcfg2" data-ref-filename="234hwcfg2">hwcfg2</a> = <a class="local col5 ref" href="#235hwcfg3" title='hwcfg3' data-ref="235hwcfg3" data-ref-filename="235hwcfg3">hwcfg3</a> = <a class="local col6 ref" href="#236hwcfg4" title='hwcfg4' data-ref="236hwcfg4" data-ref-filename="236hwcfg4">hwcfg4</a> = <a class="local col7 ref" href="#237hwcfg5" title='hwcfg5' data-ref="237hwcfg5" data-ref-filename="237hwcfg5">hwcfg5</a> = <var>0</var>;</td></tr>
<tr><th id="3655">3655</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#76" title="0x00000B54" data-ref="_M/BGE_SRAM_DATA_SIG">BGE_SRAM_DATA_SIG</a>) ==</td></tr>
<tr><th id="3656">3656</th><td>	    <a class="macro" href="if_bgereg.h.html#99" title="0x4B657654" data-ref="_M/BGE_SRAM_DATA_SIG_MAGIC">BGE_SRAM_DATA_SIG_MAGIC</a>) {</td></tr>
<tr><th id="3657">3657</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="257tmp" title='tmp' data-type='uint32_t' data-ref="257tmp" data-ref-filename="257tmp">tmp</dfn>;</td></tr>
<tr><th id="3658">3658</th><td></td></tr>
<tr><th id="3659">3659</th><td>		<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#77" title="0x00000B58" data-ref="_M/BGE_SRAM_DATA_CFG">BGE_SRAM_DATA_CFG</a>);</td></tr>
<tr><th id="3660">3660</th><td>		<a class="local col7 ref" href="#257tmp" title='tmp' data-ref="257tmp" data-ref-filename="257tmp">tmp</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#78" title="0x00000B5C" data-ref="_M/BGE_SRAM_DATA_VER">BGE_SRAM_DATA_VER</a>) &gt;&gt;</td></tr>
<tr><th id="3661">3661</th><td>		    <a class="macro" href="if_bgereg.h.html#114" title="16" data-ref="_M/BGE_SRAM_DATA_VER_SHIFT">BGE_SRAM_DATA_VER_SHIFT</a>;</td></tr>
<tr><th id="3662">3662</th><td>		<b>if</b> ((<var>0</var> &lt; <a class="local col7 ref" href="#257tmp" title='tmp' data-ref="257tmp" data-ref-filename="257tmp">tmp</a>) &amp;&amp; (<a class="local col7 ref" href="#257tmp" title='tmp' data-ref="257tmp" data-ref-filename="257tmp">tmp</a> &lt; <var>0x100</var>))</td></tr>
<tr><th id="3663">3663</th><td>			<a class="local col4 ref" href="#234hwcfg2" title='hwcfg2' data-ref="234hwcfg2" data-ref-filename="234hwcfg2">hwcfg2</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#85" title="0x00000D38" data-ref="_M/BGE_SRAM_DATA_CFG_2">BGE_SRAM_DATA_CFG_2</a>);</td></tr>
<tr><th id="3664">3664</th><td>		<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>)</td></tr>
<tr><th id="3665">3665</th><td>			<a class="local col5 ref" href="#235hwcfg3" title='hwcfg3' data-ref="235hwcfg3" data-ref-filename="235hwcfg3">hwcfg3</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#86" title="0x00000D3C" data-ref="_M/BGE_SRAM_DATA_CFG_3">BGE_SRAM_DATA_CFG_3</a>);</td></tr>
<tr><th id="3666">3666</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>)</td></tr>
<tr><th id="3667">3667</th><td>			<a class="local col6 ref" href="#236hwcfg4" title='hwcfg4' data-ref="236hwcfg4" data-ref-filename="236hwcfg4">hwcfg4</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#87" title="0x00000D60" data-ref="_M/BGE_SRAM_DATA_CFG_4">BGE_SRAM_DATA_CFG_4</a>);</td></tr>
<tr><th id="3668">3668</th><td>		<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3669">3669</th><td>			<a class="local col7 ref" href="#237hwcfg5" title='hwcfg5' data-ref="237hwcfg5" data-ref-filename="237hwcfg5">hwcfg5</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#88" title="0x00000E0C" data-ref="_M/BGE_SRAM_DATA_CFG_5">BGE_SRAM_DATA_CFG_5</a>);</td></tr>
<tr><th id="3670">3670</th><td>	} <b>else</b> <b>if</b> (!(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>)) {</td></tr>
<tr><th id="3671">3671</th><td>		<a class="tu ref fn" href="#bge_read_eeprom" title='bge_read_eeprom' data-use='c' data-ref="bge_read_eeprom" data-ref-filename="bge_read_eeprom">bge_read_eeprom</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, (<em>void</em> *)&amp;<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a>,</td></tr>
<tr><th id="3672">3672</th><td>		    <a class="macro" href="if_bgereg.h.html#2418" title="0xC8" data-ref="_M/BGE_EE_HWCFG_OFFSET">BGE_EE_HWCFG_OFFSET</a>, <b>sizeof</b>(<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a>));</td></tr>
<tr><th id="3673">3673</th><td>		<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a> = <a class="macro" href="../../sys/endian.h.html#175" title="((uint32_t)(__builtin_constant_p((((uint32_t)((hwcfg))))) ? (((uint32_t)(((((((uint32_t)((hwcfg)))) &amp; 0xff000000) &gt;&gt; 24) | (((((uint32_t)((hwcfg)))) &amp; 0x00ff0000) &gt;&gt; 8) | (((((uint32_t)((hwcfg)))) &amp; 0x0000ff00) &lt;&lt; 8) | (((((uint32_t)((hwcfg)))) &amp; 0x000000ff) &lt;&lt; 24))))) : __byte_swap_u32_variable(((uint32_t)((hwcfg))))))" data-ref="_M/be32toh">be32toh</a>(<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a>);</td></tr>
<tr><th id="3674">3674</th><td>	}</td></tr>
<tr><th id="3675">3675</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_normal_dev" title='aprint_normal_dev' data-ref="aprint_normal_dev" data-ref-filename="aprint_normal_dev">aprint_normal_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3676">3676</th><td>	    <q>"HW config %08x, %08x, %08x, %08x %08x\n"</q>,</td></tr>
<tr><th id="3677">3677</th><td>	    <a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a>, <a class="local col4 ref" href="#234hwcfg2" title='hwcfg2' data-ref="234hwcfg2" data-ref-filename="234hwcfg2">hwcfg2</a>, <a class="local col5 ref" href="#235hwcfg3" title='hwcfg3' data-ref="235hwcfg3" data-ref-filename="235hwcfg3">hwcfg3</a>, <a class="local col6 ref" href="#236hwcfg4" title='hwcfg4' data-ref="236hwcfg4" data-ref-filename="236hwcfg4">hwcfg4</a>, <a class="local col7 ref" href="#237hwcfg5" title='hwcfg5' data-ref="237hwcfg5" data-ref-filename="237hwcfg5">hwcfg5</a>);</td></tr>
<tr><th id="3678">3678</th><td></td></tr>
<tr><th id="3679">3679</th><td>	<a class="tu ref fn" href="#bge_sig_legacy" title='bge_sig_legacy' data-use='c' data-ref="bge_sig_legacy" data-ref-filename="bge_sig_legacy">bge_sig_legacy</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="3680">3680</th><td>	<a class="tu ref fn" href="#bge_sig_post_reset" title='bge_sig_post_reset' data-use='c' data-ref="bge_sig_post_reset" data-ref-filename="bge_sig_post_reset">bge_sig_post_reset</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="3681">3681</th><td></td></tr>
<tr><th id="3682">3682</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_chipinit" title='bge_chipinit' data-use='c' data-ref="bge_chipinit" data-ref-filename="bge_chipinit">bge_chipinit</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3683">3683</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"chip initialization failed\n"</q>);</td></tr>
<tr><th id="3684">3684</th><td>		<a class="tu ref fn" href="#bge_release_resources" title='bge_release_resources' data-use='c' data-ref="bge_release_resources" data-ref-filename="bge_release_resources">bge_release_resources</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3685">3685</th><td>		<b>return</b>;</td></tr>
<tr><th id="3686">3686</th><td>	}</td></tr>
<tr><th id="3687">3687</th><td></td></tr>
<tr><th id="3688">3688</th><td>	<i>/*</i></td></tr>
<tr><th id="3689">3689</th><td><i>	 * Get station address from the EEPROM.</i></td></tr>
<tr><th id="3690">3690</th><td><i>	 */</i></td></tr>
<tr><th id="3691">3691</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_get_eaddr" title='bge_get_eaddr' data-use='c' data-ref="bge_get_eaddr" data-ref-filename="bge_get_eaddr">bge_get_eaddr</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="local col4 ref" href="#244eaddr" title='eaddr' data-ref="244eaddr" data-ref-filename="244eaddr">eaddr</a>)) {</td></tr>
<tr><th id="3692">3692</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3693">3693</th><td>		    <q>"failed to read station address\n"</q>);</td></tr>
<tr><th id="3694">3694</th><td>		<a class="tu ref fn" href="#bge_release_resources" title='bge_release_resources' data-use='c' data-ref="bge_release_resources" data-ref-filename="bge_release_resources">bge_release_resources</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3695">3695</th><td>		<b>return</b>;</td></tr>
<tr><th id="3696">3696</th><td>	}</td></tr>
<tr><th id="3697">3697</th><td></td></tr>
<tr><th id="3698">3698</th><td>	<a class="local col0 ref" href="#230br" title='br' data-ref="230br" data-ref-filename="230br">br</a> = <a class="tu ref fn" href="#bge_lookup_rev" title='bge_lookup_rev' data-use='c' data-ref="bge_lookup_rev" data-ref-filename="bge_lookup_rev">bge_lookup_rev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>);</td></tr>
<tr><th id="3699">3699</th><td></td></tr>
<tr><th id="3700">3700</th><td>	<b>if</b> (<a class="local col0 ref" href="#230br" title='br' data-ref="230br" data-ref-filename="230br">br</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="3701">3701</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_normal_dev" title='aprint_normal_dev' data-ref="aprint_normal_dev" data-ref-filename="aprint_normal_dev">aprint_normal_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"unknown ASIC (0x%x)"</q>,</td></tr>
<tr><th id="3702">3702</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>);</td></tr>
<tr><th id="3703">3703</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3704">3704</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_normal_dev" title='aprint_normal_dev' data-ref="aprint_normal_dev" data-ref-filename="aprint_normal_dev">aprint_normal_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"ASIC %s (0x%x)"</q>,</td></tr>
<tr><th id="3705">3705</th><td>		    <a class="local col0 ref" href="#230br" title='br' data-ref="230br" data-ref-filename="230br">br</a>-&gt;<a class="tu ref field" href="#bge_revision::br_name" title='bge_revision::br_name' data-use='r' data-ref="bge_revision::br_name" data-ref-filename="bge_revision..br_name">br_name</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>);</td></tr>
<tr><th id="3706">3706</th><td>	}</td></tr>
<tr><th id="3707">3707</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_normal" title='aprint_normal' data-ref="aprint_normal" data-ref-filename="aprint_normal">aprint_normal</a>(<q>", Ethernet address %s\n"</q>, <a class="ref fn" href="../../net/if_ether.h.html#ether_sprintf" title='ether_sprintf' data-ref="ether_sprintf" data-ref-filename="ether_sprintf">ether_sprintf</a>(<a class="local col4 ref" href="#244eaddr" title='eaddr' data-ref="244eaddr" data-ref-filename="244eaddr">eaddr</a>));</td></tr>
<tr><th id="3708">3708</th><td></td></tr>
<tr><th id="3709">3709</th><td>	<i>/* Allocate the general information block and ring buffers. */</i></td></tr>
<tr><th id="3710">3710</th><td>	<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_dma64_available" title='pci_dma64_available' data-ref="pci_dma64_available" data-ref-filename="pci_dma64_available">pci_dma64_available</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>)) {</td></tr>
<tr><th id="3711">3711</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_dmat64" title='pci_attach_args::pa_dmat64' data-ref="pci_attach_args::pa_dmat64" data-ref-filename="pci_attach_args..pa_dmat64">pa_dmat64</a>;</td></tr>
<tr><th id="3712">3712</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_dmat" title='pci_attach_args::pa_dmat' data-ref="pci_attach_args::pa_dmat" data-ref-filename="pci_attach_args..pa_dmat">pa_dmat</a>;</td></tr>
<tr><th id="3713">3713</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dma64" title='bge_softc::bge_dma64' data-ref="bge_softc::bge_dma64" data-ref-filename="bge_softc..bge_dma64">bge_dma64</a> = <a class="macro" href="../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="3714">3714</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3715">3715</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_dmat" title='pci_attach_args::pa_dmat' data-ref="pci_attach_args::pa_dmat" data-ref-filename="pci_attach_args..pa_dmat">pa_dmat</a>;</td></tr>
<tr><th id="3716">3716</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a> = <a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_dmat" title='pci_attach_args::pa_dmat' data-ref="pci_attach_args::pa_dmat" data-ref-filename="pci_attach_args..pa_dmat">pa_dmat</a>;</td></tr>
<tr><th id="3717">3717</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dma64" title='bge_softc::bge_dma64' data-ref="bge_softc::bge_dma64" data-ref-filename="bge_softc..bge_dma64">bge_dma64</a> = <a class="macro" href="../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="3718">3718</th><td>	}</td></tr>
<tr><th id="3719">3719</th><td></td></tr>
<tr><th id="3720">3720</th><td>	<i>/* 40bit DMA workaround */</i></td></tr>
<tr><th id="3721">3721</th><td>	<b>if</b> (<b>sizeof</b>(<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a>) &gt; <var>4</var>) {</td></tr>
<tr><th id="3722">3722</th><td>		<b>if</b> ((<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2681" title="0x00100000" data-ref="_M/BGEF_40BIT_BUG">BGEF_40BIT_BUG</a>) != <var>0</var>) {</td></tr>
<tr><th id="3723">3723</th><td>			<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dma_tag_t" title='bus_dma_tag_t' data-type='struct x86_bus_dma_tag *' data-ref="bus_dma_tag_t" data-ref-filename="bus_dma_tag_t">bus_dma_tag_t</a> <dfn class="local col8 decl" id="258olddmatag" title='olddmatag' data-type='bus_dma_tag_t' data-ref="258olddmatag" data-ref-filename="258olddmatag">olddmatag</dfn> = <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>; <i>/* save */</i></td></tr>
<tr><th id="3724">3724</th><td></td></tr>
<tr><th id="3725">3725</th><td>			<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmatag_subregion" title='bus_dmatag_subregion' data-ref="bus_dmatag_subregion" data-ref-filename="bus_dmatag_subregion">bus_dmatag_subregion</a>(<a class="local col8 ref" href="#258olddmatag" title='olddmatag' data-ref="258olddmatag" data-ref-filename="258olddmatag">olddmatag</a>, <var>0</var>,</td></tr>
<tr><th id="3726">3726</th><td>				(<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a>)(<var>1ULL</var> &lt;&lt; <var>40</var>), &amp;(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>),</td></tr>
<tr><th id="3727">3727</th><td>				<a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>) != <var>0</var>) {</td></tr>
<tr><th id="3728">3728</th><td>				<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>,</td></tr>
<tr><th id="3729">3729</th><td>				    <q>"WARNING: failed to restrict dma range,"</q></td></tr>
<tr><th id="3730">3730</th><td>				    <q>" falling back to parent bus dma range\n"</q>);</td></tr>
<tr><th id="3731">3731</th><td>				<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a> = <a class="local col8 ref" href="#258olddmatag" title='olddmatag' data-ref="258olddmatag" data-ref-filename="258olddmatag">olddmatag</a>;</td></tr>
<tr><th id="3732">3732</th><td>			}</td></tr>
<tr><th id="3733">3733</th><td>		}</td></tr>
<tr><th id="3734">3734</th><td>	}</td></tr>
<tr><th id="3735">3735</th><td>	<a class="macro" href="../../sys/queue.h.html#148" title="do { (&amp;sc-&gt;txdma_list)-&gt;slh_first = ((void *)0); } while ( 0)" data-ref="_M/SLIST_INIT">SLIST_INIT</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>);</td></tr>
<tr><th id="3736">3736</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"bus_dmamem_alloc\n"</q>));</td></tr>
<tr><th id="3737">3737</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_alloc" title='bus_dmamem_alloc' data-ref="bus_dmamem_alloc" data-ref-filename="bus_dmamem_alloc">bus_dmamem_alloc</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>),</td></tr>
<tr><th id="3738">3738</th><td>			     <a class="macro" href="../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <var>0</var>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>, <var>1</var>,</td></tr>
<tr><th id="3739">3739</th><td>		&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="3740">3740</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't alloc rx buffers\n"</q>);</td></tr>
<tr><th id="3741">3741</th><td>		<b>return</b>;</td></tr>
<tr><th id="3742">3742</th><td>	}</td></tr>
<tr><th id="3743">3743</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"bus_dmamem_map\n"</q>));</td></tr>
<tr><th id="3744">3744</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_map" title='bus_dmamem_map' data-ref="bus_dmamem_map" data-ref-filename="bus_dmamem_map">bus_dmamem_map</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>,</td></tr>
<tr><th id="3745">3745</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>), &amp;<a class="local col3 ref" href="#243kva" title='kva' data-ref="243kva" data-ref-filename="243kva">kva</a>,</td></tr>
<tr><th id="3746">3746</th><td>			   <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="3747">3747</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3748">3748</th><td>		    <q>"can't map DMA buffers (%zu bytes)\n"</q>,</td></tr>
<tr><th id="3749">3749</th><td>		    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>));</td></tr>
<tr><th id="3750">3750</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_free" title='bus_dmamem_free' data-ref="bus_dmamem_free" data-ref-filename="bus_dmamem_free">bus_dmamem_free</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>,</td></tr>
<tr><th id="3751">3751</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>);</td></tr>
<tr><th id="3752">3752</th><td>		<b>return</b>;</td></tr>
<tr><th id="3753">3753</th><td>	}</td></tr>
<tr><th id="3754">3754</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"bus_dmamem_create\n"</q>));</td></tr>
<tr><th id="3755">3755</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_create" title='bus_dmamap_create' data-ref="bus_dmamap_create" data-ref-filename="bus_dmamap_create">bus_dmamap_create</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>), <var>1</var>,</td></tr>
<tr><th id="3756">3756</th><td>	    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>), <var>0</var>,</td></tr>
<tr><th id="3757">3757</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>)) {</td></tr>
<tr><th id="3758">3758</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"can't create DMA map\n"</q>);</td></tr>
<tr><th id="3759">3759</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_unmap" title='bus_dmamem_unmap' data-ref="bus_dmamem_unmap" data-ref-filename="bus_dmamem_unmap">bus_dmamem_unmap</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#243kva" title='kva' data-ref="243kva" data-ref-filename="243kva">kva</a>,</td></tr>
<tr><th id="3760">3760</th><td>				 <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>));</td></tr>
<tr><th id="3761">3761</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_free" title='bus_dmamem_free' data-ref="bus_dmamem_free" data-ref-filename="bus_dmamem_free">bus_dmamem_free</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>,</td></tr>
<tr><th id="3762">3762</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>);</td></tr>
<tr><th id="3763">3763</th><td>		<b>return</b>;</td></tr>
<tr><th id="3764">3764</th><td>	}</td></tr>
<tr><th id="3765">3765</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"bus_dmamem_load\n"</q>));</td></tr>
<tr><th id="3766">3766</th><td>	<b>if</b> (<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_load" title='bus_dmamap_load' data-ref="bus_dmamap_load" data-ref-filename="bus_dmamap_load">bus_dmamap_load</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>, <a class="local col3 ref" href="#243kva" title='kva' data-ref="243kva" data-ref-filename="243kva">kva</a>,</td></tr>
<tr><th id="3767">3767</th><td>			    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>), <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="3768">3768</th><td>			    <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>)) {</td></tr>
<tr><th id="3769">3769</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>);</td></tr>
<tr><th id="3770">3770</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_unmap" title='bus_dmamem_unmap' data-ref="bus_dmamem_unmap" data-ref-filename="bus_dmamem_unmap">bus_dmamem_unmap</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col3 ref" href="#243kva" title='kva' data-ref="243kva" data-ref-filename="243kva">kva</a>,</td></tr>
<tr><th id="3771">3771</th><td>				 <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>));</td></tr>
<tr><th id="3772">3772</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_free" title='bus_dmamem_free' data-ref="bus_dmamem_free" data-ref-filename="bus_dmamem_free">bus_dmamem_free</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>,</td></tr>
<tr><th id="3773">3773</th><td>		    <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>);</td></tr>
<tr><th id="3774">3774</th><td>		<b>return</b>;</td></tr>
<tr><th id="3775">3775</th><td>	}</td></tr>
<tr><th id="3776">3776</th><td></td></tr>
<tr><th id="3777">3777</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"bzero\n"</q>));</td></tr>
<tr><th id="3778">3778</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a> = (<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a> *)<a class="local col3 ref" href="#243kva" title='kva' data-ref="243kva" data-ref-filename="243kva">kva</a>;</td></tr>
<tr><th id="3779">3779</th><td></td></tr>
<tr><th id="3780">3780</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#382" title="__builtin_memset(sc-&gt;bge_rdata, 0, sizeof(struct bge_ring_data))" data-ref="_M/memset">memset</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>, <var>0</var>, <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>));</td></tr>
<tr><th id="3781">3781</th><td></td></tr>
<tr><th id="3782">3782</th><td>	<i>/* Try to allocate memory for jumbo buffers. */</i></td></tr>
<tr><th id="3783">3783</th><td>	<b>if</b> (<a class="macro" href="#409" title="((sc)-&gt;bge_flags &amp; 0x00000002)" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3784">3784</th><td>		<b>if</b> (<a class="tu ref fn" href="#bge_alloc_jumbo_mem" title='bge_alloc_jumbo_mem' data-use='c' data-ref="bge_alloc_jumbo_mem" data-ref-filename="bge_alloc_jumbo_mem">bge_alloc_jumbo_mem</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3785">3785</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3786">3786</th><td>			    <q>"jumbo buffer allocation failed\n"</q>);</td></tr>
<tr><th id="3787">3787</th><td>		} <b>else</b></td></tr>
<tr><th id="3788">3788</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_capabilities" title='ethercom::ec_capabilities' data-ref="ethercom::ec_capabilities" data-ref-filename="ethercom..ec_capabilities">ec_capabilities</a> |= <a class="macro" href="../../net/if_ether.h.html#212" title="0x00000004" data-ref="_M/ETHERCAP_JUMBO_MTU">ETHERCAP_JUMBO_MTU</a>;</td></tr>
<tr><th id="3789">3789</th><td>	}</td></tr>
<tr><th id="3790">3790</th><td></td></tr>
<tr><th id="3791">3791</th><td>	<i>/* Set default tuneable values. */</i></td></tr>
<tr><th id="3792">3792</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_stat_ticks" title='bge_softc::bge_stat_ticks' data-ref="bge_softc::bge_stat_ticks" data-ref-filename="bge_softc..bge_stat_ticks">bge_stat_ticks</a> = <a class="macro" href="if_bgereg.h.html#2440" title="1000000" data-ref="_M/BGE_TICKS_PER_SEC">BGE_TICKS_PER_SEC</a>;</td></tr>
<tr><th id="3793">3793</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_coal_ticks" title='bge_softc::bge_rx_coal_ticks' data-ref="bge_softc::bge_rx_coal_ticks" data-ref-filename="bge_softc..bge_rx_coal_ticks">bge_rx_coal_ticks</a> = <var>150</var>;</td></tr>
<tr><th id="3794">3794</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_max_coal_bds" title='bge_softc::bge_rx_max_coal_bds' data-ref="bge_softc::bge_rx_max_coal_bds" data-ref-filename="bge_softc..bge_rx_max_coal_bds">bge_rx_max_coal_bds</a> = <var>64</var>;</td></tr>
<tr><th id="3795">3795</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_coal_ticks" title='bge_softc::bge_tx_coal_ticks' data-ref="bge_softc::bge_tx_coal_ticks" data-ref-filename="bge_softc..bge_tx_coal_ticks">bge_tx_coal_ticks</a> = <var>300</var>;</td></tr>
<tr><th id="3796">3796</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_max_coal_bds" title='bge_softc::bge_tx_max_coal_bds' data-ref="bge_softc::bge_tx_max_coal_bds" data-ref-filename="bge_softc..bge_tx_max_coal_bds">bge_tx_max_coal_bds</a> = <var>400</var>;</td></tr>
<tr><th id="3797">3797</th><td>	<b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3798">3798</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_coal_ticks" title='bge_softc::bge_tx_coal_ticks' data-ref="bge_softc::bge_tx_coal_ticks" data-ref-filename="bge_softc..bge_tx_coal_ticks">bge_tx_coal_ticks</a> = (<var>12</var> * <var>5</var>);</td></tr>
<tr><th id="3799">3799</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_max_coal_bds" title='bge_softc::bge_tx_max_coal_bds' data-ref="bge_softc::bge_tx_max_coal_bds" data-ref-filename="bge_softc..bge_tx_max_coal_bds">bge_tx_max_coal_bds</a> = (<var>12</var> * <var>5</var>);</td></tr>
<tr><th id="3800">3800</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_verbose_dev" title='aprint_verbose_dev' data-ref="aprint_verbose_dev" data-ref-filename="aprint_verbose_dev">aprint_verbose_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="3801">3801</th><td>			    <q>"setting short Tx thresholds\n"</q>);</td></tr>
<tr><th id="3802">3802</th><td>	}</td></tr>
<tr><th id="3803">3803</th><td></td></tr>
<tr><th id="3804">3804</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3805">3805</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a> = <a class="macro" href="if_bgereg.h.html#2450" title="1024" data-ref="_M/BGE_RETURN_RING_CNT">BGE_RETURN_RING_CNT</a>;</td></tr>
<tr><th id="3806">3806</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3807">3807</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a> = <a class="macro" href="if_bgereg.h.html#2451" title="512" data-ref="_M/BGE_RETURN_RING_CNT_5705">BGE_RETURN_RING_CNT_5705</a>;</td></tr>
<tr><th id="3808">3808</th><td>	<b>else</b></td></tr>
<tr><th id="3809">3809</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a> = <a class="macro" href="if_bgereg.h.html#2450" title="1024" data-ref="_M/BGE_RETURN_RING_CNT">BGE_RETURN_RING_CNT</a>;</td></tr>
<tr><th id="3810">3810</th><td></td></tr>
<tr><th id="3811">3811</th><td>	<i>/* Set up ifnet structure */</i></td></tr>
<tr><th id="3812">3812</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a> = &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="3813">3813</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a> = <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>;</td></tr>
<tr><th id="3814">3814</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> = <a class="macro" href="../../net/if.h.html#418" title="0x0002" data-ref="_M/IFF_BROADCAST">IFF_BROADCAST</a> | <a class="macro" href="../../net/if.h.html#428" title="0x0800" data-ref="_M/IFF_SIMPLEX">IFF_SIMPLEX</a> | <a class="macro" href="../../net/if.h.html#432" title="0x8000" data-ref="_M/IFF_MULTICAST">IFF_MULTICAST</a>;</td></tr>
<tr><th id="3815">3815</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_ioctl" title='ifnet::if_ioctl' data-ref="ifnet::if_ioctl" data-ref-filename="ifnet..if_ioctl">if_ioctl</a> = <a class="tu ref fn" href="#bge_ioctl" title='bge_ioctl' data-use='r' data-ref="bge_ioctl" data-ref-filename="bge_ioctl">bge_ioctl</a>;</td></tr>
<tr><th id="3816">3816</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_stop" title='ifnet::if_stop' data-ref="ifnet::if_stop" data-ref-filename="ifnet..if_stop">if_stop</a> = <a class="tu ref fn" href="#bge_stop" title='bge_stop' data-use='r' data-ref="bge_stop" data-ref-filename="bge_stop">bge_stop</a>;</td></tr>
<tr><th id="3817">3817</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_start" title='ifnet::if_start' data-ref="ifnet::if_start" data-ref-filename="ifnet..if_start">if_start</a> = <a class="tu ref fn" href="#bge_start" title='bge_start' data-use='r' data-ref="bge_start" data-ref-filename="bge_start">bge_start</a>;</td></tr>
<tr><th id="3818">3818</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_init" title='ifnet::if_init' data-ref="ifnet::if_init" data-ref-filename="ifnet..if_init">if_init</a> = <a class="tu ref fn" href="#bge_init" title='bge_init' data-use='r' data-ref="bge_init" data-ref-filename="bge_init">bge_init</a>;</td></tr>
<tr><th id="3819">3819</th><td>	<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#298" title="if_slowtimo" data-ref="_M/if_watchdog">if_watchdog</a> = <a class="tu ref fn" href="#bge_watchdog" title='bge_watchdog' data-use='r' data-ref="bge_watchdog" data-ref-filename="bge_watchdog">bge_watchdog</a>;</td></tr>
<tr><th id="3820">3820</th><td>	<a class="macro" href="../../net/if.h.html#1069" title="((&amp;ifp-&gt;if_snd)-&gt;ifq_maxlen = (uimax(512 - 1, 256)))" data-ref="_M/IFQ_SET_MAXLEN">IFQ_SET_MAXLEN</a>(&amp;<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_snd" title='ifnet::if_snd' data-ref="ifnet::if_snd" data-ref-filename="ifnet..if_snd">if_snd</a>, <a class="ref fn" href="../../lib/libkern/libkern.h.html#uimax" title='uimax' data-ref="uimax" data-ref-filename="uimax">uimax</a>(<a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a> - <var>1</var>, <a class="macro" href="../../net/if.h.html#700" title="256" data-ref="_M/IFQ_MAXLEN">IFQ_MAXLEN</a>));</td></tr>
<tr><th id="3821">3821</th><td>	<a class="macro" href="../../net/if.h.html#1053" title="" data-ref="_M/IFQ_SET_READY">IFQ_SET_READY</a>(&amp;ifp-&gt;if_snd);</td></tr>
<tr><th id="3822">3822</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"strcpy if_xname\n"</q>));</td></tr>
<tr><th id="3823">3823</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#400" title="__builtin_strcpy(ifp-&gt;if_xname, device_xname(sc-&gt;bge_dev))" data-ref="_M/strcpy">strcpy</a>(<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_xname" title='ifnet::if_xname' data-ref="ifnet::if_xname" data-ref-filename="ifnet..if_xname">if_xname</a>, <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>));</td></tr>
<tr><th id="3824">3824</th><td></td></tr>
<tr><th id="3825">3825</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#287" title="0x7100" data-ref="_M/BGE_CHIPID_BCM5700_B0">BGE_CHIPID_BCM5700_B0</a>)</td></tr>
<tr><th id="3826">3826</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>.<a class="ref field" href="../../net/if.h.html#ifnet::if_capabilities" title='ifnet::if_capabilities' data-ref="ifnet::if_capabilities" data-ref-filename="ifnet..if_capabilities">if_capabilities</a> |=</td></tr>
<tr><th id="3827">3827</th><td>		    <a class="macro" href="../../net/if.h.html#602" title="0x00200" data-ref="_M/IFCAP_CSUM_IPv4_Tx">IFCAP_CSUM_IPv4_Tx</a> | <a class="macro" href="../../net/if.h.html#601" title="0x00100" data-ref="_M/IFCAP_CSUM_IPv4_Rx">IFCAP_CSUM_IPv4_Rx</a>;</td></tr>
<tr><th id="3828">3828</th><td><u>#<span data-ppcond="3828">if</span> 1	/* XXX TCP/UDP checksum offload breaks with pf(4) */</u></td></tr>
<tr><th id="3829">3829</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>.<a class="ref field" href="../../net/if.h.html#ifnet::if_capabilities" title='ifnet::if_capabilities' data-ref="ifnet::if_capabilities" data-ref-filename="ifnet..if_capabilities">if_capabilities</a> |=</td></tr>
<tr><th id="3830">3830</th><td>		    <a class="macro" href="../../net/if.h.html#604" title="0x00800" data-ref="_M/IFCAP_CSUM_TCPv4_Tx">IFCAP_CSUM_TCPv4_Tx</a> | <a class="macro" href="../../net/if.h.html#603" title="0x00400" data-ref="_M/IFCAP_CSUM_TCPv4_Rx">IFCAP_CSUM_TCPv4_Rx</a> |</td></tr>
<tr><th id="3831">3831</th><td>		    <a class="macro" href="../../net/if.h.html#606" title="0x02000" data-ref="_M/IFCAP_CSUM_UDPv4_Tx">IFCAP_CSUM_UDPv4_Tx</a> | <a class="macro" href="../../net/if.h.html#605" title="0x01000" data-ref="_M/IFCAP_CSUM_UDPv4_Rx">IFCAP_CSUM_UDPv4_Rx</a>;</td></tr>
<tr><th id="3832">3832</th><td><u>#<span data-ppcond="3828">endif</span></u></td></tr>
<tr><th id="3833">3833</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_capabilities" title='ethercom::ec_capabilities' data-ref="ethercom::ec_capabilities" data-ref-filename="ethercom..ec_capabilities">ec_capabilities</a> |=</td></tr>
<tr><th id="3834">3834</th><td>	    <a class="macro" href="../../net/if_ether.h.html#211" title="0x00000002" data-ref="_M/ETHERCAP_VLAN_HWTAGGING">ETHERCAP_VLAN_HWTAGGING</a> | <a class="macro" href="../../net/if_ether.h.html#210" title="0x00000001" data-ref="_M/ETHERCAP_VLAN_MTU">ETHERCAP_VLAN_MTU</a>;</td></tr>
<tr><th id="3835">3835</th><td>	<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_capenable" title='ethercom::ec_capenable' data-ref="ethercom::ec_capenable" data-ref-filename="ethercom..ec_capenable">ec_capenable</a> |= <a class="macro" href="../../net/if_ether.h.html#211" title="0x00000002" data-ref="_M/ETHERCAP_VLAN_HWTAGGING">ETHERCAP_VLAN_HWTAGGING</a>;</td></tr>
<tr><th id="3836">3836</th><td></td></tr>
<tr><th id="3837">3837</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2670" title="0x00000100" data-ref="_M/BGEF_TSO">BGEF_TSO</a>)</td></tr>
<tr><th id="3838">3838</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>.<a class="ref field" href="../../net/if.h.html#ifnet::if_capabilities" title='ifnet::if_capabilities' data-ref="ifnet::if_capabilities" data-ref-filename="ifnet..if_capabilities">if_capabilities</a> |= <a class="macro" href="../../net/if.h.html#600" title="0x00080" data-ref="_M/IFCAP_TSOv4">IFCAP_TSOv4</a>;</td></tr>
<tr><th id="3839">3839</th><td></td></tr>
<tr><th id="3840">3840</th><td>	<i>/*</i></td></tr>
<tr><th id="3841">3841</th><td><i>	 * Do MII setup.</i></td></tr>
<tr><th id="3842">3842</th><td><i>	 */</i></td></tr>
<tr><th id="3843">3843</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"mii setup\n"</q>));</td></tr>
<tr><th id="3844">3844</th><td>	<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_ifp" title='mii_data::mii_ifp' data-ref="mii_data::mii_ifp" data-ref-filename="mii_data..mii_ifp">mii_ifp</a> = <a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>;</td></tr>
<tr><th id="3845">3845</th><td>	<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_readreg" title='mii_data::mii_readreg' data-ref="mii_data::mii_readreg" data-ref-filename="mii_data..mii_readreg">mii_readreg</a> = <a class="tu ref fn" href="#bge_miibus_readreg" title='bge_miibus_readreg' data-use='r' data-ref="bge_miibus_readreg" data-ref-filename="bge_miibus_readreg">bge_miibus_readreg</a>;</td></tr>
<tr><th id="3846">3846</th><td>	<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_writereg" title='mii_data::mii_writereg' data-ref="mii_data::mii_writereg" data-ref-filename="mii_data..mii_writereg">mii_writereg</a> = <a class="tu ref fn" href="#bge_miibus_writereg" title='bge_miibus_writereg' data-use='r' data-ref="bge_miibus_writereg" data-ref-filename="bge_miibus_writereg">bge_miibus_writereg</a>;</td></tr>
<tr><th id="3847">3847</th><td>	<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_statchg" title='mii_data::mii_statchg' data-ref="mii_data::mii_statchg" data-ref-filename="mii_data..mii_statchg">mii_statchg</a> = <a class="tu ref fn" href="#bge_miibus_statchg" title='bge_miibus_statchg' data-use='r' data-ref="bge_miibus_statchg" data-ref-filename="bge_miibus_statchg">bge_miibus_statchg</a>;</td></tr>
<tr><th id="3848">3848</th><td></td></tr>
<tr><th id="3849">3849</th><td>	<i>/*</i></td></tr>
<tr><th id="3850">3850</th><td><i>	 * Figure out what sort of media we have by checking the hardware</i></td></tr>
<tr><th id="3851">3851</th><td><i>	 * config word.  Note: on some BCM5700 cards, this value appears to be</i></td></tr>
<tr><th id="3852">3852</th><td><i>	 * unset. If that's the case, we have to rely on identifying the NIC</i></td></tr>
<tr><th id="3853">3853</th><td><i>	 * by its PCI subsystem ID, as we do below for the SysKonnect SK-9D41.</i></td></tr>
<tr><th id="3854">3854</th><td><i>	 * The SysKonnect SK-9D41 is a 1000baseSX card.</i></td></tr>
<tr><th id="3855">3855</th><td><i>	 */</i></td></tr>
<tr><th id="3856">3856</th><td>	<b>if</b> (<a class="macro" href="pcireg.h.html#63" title="(((pa-&gt;pa_id) &gt;&gt; 16) &amp; 0xffff)" data-ref="_M/PCI_PRODUCT">PCI_PRODUCT</a>(<a class="local col7 ref" href="#227pa" title='pa' data-ref="227pa" data-ref-filename="227pa">pa</a>-&gt;<a class="ref field" href="pcivar.h.html#pci_attach_args::pa_id" title='pci_attach_args::pa_id' data-ref="pci_attach_args::pa_id" data-ref-filename="pci_attach_args..pa_id">pa_id</a>) == <a class="macro" href="if_bgereg.h.html#2405" title="0x4441" data-ref="_M/SK_SUBSYSID_9D41">SK_SUBSYSID_9D41</a> ||</td></tr>
<tr><th id="3857">3857</th><td>	    (<a class="local col3 ref" href="#233hwcfg" title='hwcfg' data-ref="233hwcfg" data-ref-filename="233hwcfg">hwcfg</a> &amp; <a class="macro" href="if_bgereg.h.html#2422" title="0x00000030" data-ref="_M/BGE_HWCFG_MEDIA">BGE_HWCFG_MEDIA</a>) == <a class="macro" href="if_bgereg.h.html#2435" title="0x00000020" data-ref="_M/BGE_MEDIA_FIBER">BGE_MEDIA_FIBER</a>) {</td></tr>
<tr><th id="3858">3858</th><td>		<b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>)) {</td></tr>
<tr><th id="3859">3859</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2664" title="0x00000004" data-ref="_M/BGEF_FIBER_MII">BGEF_FIBER_MII</a>;</td></tr>
<tr><th id="3860">3860</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2697" title="0x00000080" data-ref="_M/BGEPHYF_NO_WIRESPEED">BGEPHYF_NO_WIRESPEED</a>;</td></tr>
<tr><th id="3861">3861</th><td>		} <b>else</b></td></tr>
<tr><th id="3862">3862</th><td>			<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>;</td></tr>
<tr><th id="3863">3863</th><td>	}</td></tr>
<tr><th id="3864">3864</th><td></td></tr>
<tr><th id="3865">3865</th><td>	<i>/* Set bge_phy_flags before prop_dictionary_set_uint32() */</i></td></tr>
<tr><th id="3866">3866</th><td>	<b>if</b> (<a class="macro" href="#409" title="((sc)-&gt;bge_flags &amp; 0x00000002)" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>))</td></tr>
<tr><th id="3867">3867</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a> |= <a class="macro" href="if_bgereg.h.html#2698" title="0x00010000" data-ref="_M/BGEPHYF_JUMBO_CAPABLE">BGEPHYF_JUMBO_CAPABLE</a>;</td></tr>
<tr><th id="3868">3868</th><td></td></tr>
<tr><th id="3869">3869</th><td>	<i>/* set phyflags and chipid before mii_attach() */</i></td></tr>
<tr><th id="3870">3870</th><td>	<a class="local col8 ref" href="#228dict" title='dict' data-ref="228dict" data-ref-filename="228dict">dict</a> = <a class="ref fn" href="../../sys/device.h.html#device_properties" title='device_properties' data-ref="device_properties" data-ref-filename="device_properties">device_properties</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>);</td></tr>
<tr><th id="3871">3871</th><td>	<a class="ref fn" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_set_uint32" title='prop_dictionary_set_uint32' data-ref="prop_dictionary_set_uint32" data-ref-filename="prop_dictionary_set_uint32">prop_dictionary_set_uint32</a>(<a class="local col8 ref" href="#228dict" title='dict' data-ref="228dict" data-ref-filename="228dict">dict</a>, <q>"phyflags"</q>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_flags" title='bge_softc::bge_phy_flags' data-ref="bge_softc::bge_phy_flags" data-ref-filename="bge_softc..bge_phy_flags">bge_phy_flags</a>);</td></tr>
<tr><th id="3872">3872</th><td>	<a class="ref fn" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_set_uint32" title='prop_dictionary_set_uint32' data-ref="prop_dictionary_set_uint32" data-ref-filename="prop_dictionary_set_uint32">prop_dictionary_set_uint32</a>(<a class="local col8 ref" href="#228dict" title='dict' data-ref="228dict" data-ref-filename="228dict">dict</a>, <q>"chipid"</q>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>);</td></tr>
<tr><th id="3873">3873</th><td></td></tr>
<tr><th id="3874">3874</th><td>	<i>/* Initialize ifmedia structures. */</i></td></tr>
<tr><th id="3875">3875</th><td>	<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="3876">3876</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_ifmedia" title='ethercom::ec_ifmedia' data-ref="ethercom::ec_ifmedia" data-ref-filename="ethercom..ec_ifmedia">ec_ifmedia</a> = &amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>;</td></tr>
<tr><th id="3877">3877</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_init" title='ifmedia_init' data-ref="ifmedia_init" data-ref-filename="ifmedia_init">ifmedia_init</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>, <a class="macro" href="../../net/if_media.h.html#129" title="0xf0000000" data-ref="_M/IFM_IMASK">IFM_IMASK</a>, <a class="tu ref fn" href="#bge_ifmedia_upd" title='bge_ifmedia_upd' data-use='r' data-ref="bge_ifmedia_upd" data-ref-filename="bge_ifmedia_upd">bge_ifmedia_upd</a>,</td></tr>
<tr><th id="3878">3878</th><td>		    <a class="tu ref fn" href="#bge_ifmedia_sts" title='bge_ifmedia_sts' data-use='r' data-ref="bge_ifmedia_sts" data-ref-filename="bge_ifmedia_sts">bge_ifmedia_sts</a>);</td></tr>
<tr><th id="3879">3879</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_add" title='ifmedia_add' data-ref="ifmedia_add" data-ref-filename="ifmedia_add">ifmedia_add</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> |<a class="macro" href="../../net/if_media.h.html#226" title="11" data-ref="_M/IFM_1000_SX">IFM_1000_SX</a>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3880">3880</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_add" title='ifmedia_add' data-ref="ifmedia_add" data-ref-filename="ifmedia_add">ifmedia_add</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#226" title="11" data-ref="_M/IFM_1000_SX">IFM_1000_SX</a> |<a class="macro" href="../../net/if_media.h.html#193" title="0x00100000" data-ref="_M/IFM_FDX">IFM_FDX</a>,</td></tr>
<tr><th id="3881">3881</th><td>			    <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3882">3882</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_add" title='ifmedia_add' data-ref="ifmedia_add" data-ref-filename="ifmedia_add">ifmedia_add</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3883">3883</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_set" title='ifmedia_set' data-ref="ifmedia_set" data-ref-filename="ifmedia_set">ifmedia_set</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a>);</td></tr>
<tr><th id="3884">3884</th><td>		<i>/* Pretend the user requested this setting */</i></td></tr>
<tr><th id="3885">3885</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>.<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_media" title='ifmedia::ifm_media' data-ref="ifmedia::ifm_media" data-ref-filename="ifmedia..ifm_media">ifm_media</a> = <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>.<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_cur" title='ifmedia::ifm_cur' data-ref="ifmedia::ifm_cur" data-ref-filename="ifmedia..ifm_cur">ifm_cur</a>-&gt;<a class="ref field" href="../../net/if_media.h.html#ifmedia_entry::ifm_media" title='ifmedia_entry::ifm_media' data-ref="ifmedia_entry::ifm_media" data-ref-filename="ifmedia_entry..ifm_media">ifm_media</a>;</td></tr>
<tr><th id="3886">3886</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3887">3887</th><td>		<i>/*</i></td></tr>
<tr><th id="3888">3888</th><td><i>		 * Do transceiver setup and tell the firmware the</i></td></tr>
<tr><th id="3889">3889</th><td><i>		 * driver is down so we can try to get access the</i></td></tr>
<tr><th id="3890">3890</th><td><i>		 * probe if ASF is running.  Retry a couple of times</i></td></tr>
<tr><th id="3891">3891</th><td><i>		 * if we get a conflict with the ASF firmware accessing</i></td></tr>
<tr><th id="3892">3892</th><td><i>		 * the PHY.</i></td></tr>
<tr><th id="3893">3893</th><td><i>		 */</i></td></tr>
<tr><th id="3894">3894</th><td>		<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800) &amp; ~(0x00010000)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>);</td></tr>
<tr><th id="3895">3895</th><td>		<a class="tu ref fn" href="#bge_asf_driver_up" title='bge_asf_driver_up' data-use='c' data-ref="bge_asf_driver_up" data-ref-filename="bge_asf_driver_up">bge_asf_driver_up</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3896">3896</th><td></td></tr>
<tr><th id="3897">3897</th><td>		<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_mii" title='ethercom::ec_mii' data-ref="ethercom::ec_mii" data-ref-filename="ethercom..ec_mii">ec_mii</a> = <a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>;</td></tr>
<tr><th id="3898">3898</th><td>		<a class="ref fn" href="../../net/if_media.h.html#ifmedia_init" title='ifmedia_init' data-ref="ifmedia_init" data-ref-filename="ifmedia_init">ifmedia_init</a>(&amp;<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>, <var>0</var>, <a class="tu ref fn" href="#bge_ifmedia_upd" title='bge_ifmedia_upd' data-use='r' data-ref="bge_ifmedia_upd" data-ref-filename="bge_ifmedia_upd">bge_ifmedia_upd</a>,</td></tr>
<tr><th id="3899">3899</th><td>			     <a class="tu ref fn" href="#bge_ifmedia_sts" title='bge_ifmedia_sts' data-use='r' data-ref="bge_ifmedia_sts" data-ref-filename="bge_ifmedia_sts">bge_ifmedia_sts</a>);</td></tr>
<tr><th id="3900">3900</th><td>		<a class="local col2 ref" href="#252mii_flags" title='mii_flags' data-ref="252mii_flags" data-ref-filename="252mii_flags">mii_flags</a> = <a class="macro" href="../mii/miivar.h.html#151" title="0x0100" data-ref="_M/MIIF_DOPAUSE">MIIF_DOPAUSE</a>;</td></tr>
<tr><th id="3901">3901</th><td>		<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2664" title="0x00000004" data-ref="_M/BGEF_FIBER_MII">BGEF_FIBER_MII</a>)</td></tr>
<tr><th id="3902">3902</th><td>			<a class="local col2 ref" href="#252mii_flags" title='mii_flags' data-ref="252mii_flags" data-ref-filename="252mii_flags">mii_flags</a> |= <a class="macro" href="../mii/miivar.h.html#148" title="0x0020" data-ref="_M/MIIF_HAVEFIBER">MIIF_HAVEFIBER</a>;</td></tr>
<tr><th id="3903">3903</th><td>		<a class="ref fn" href="../mii/miivar.h.html#mii_attach" title='mii_attach' data-ref="mii_attach" data-ref-filename="mii_attach">mii_attach</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>, <a class="local col1 ref" href="#251capmask" title='capmask' data-ref="251capmask" data-ref-filename="251capmask">capmask</a>, <a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a>,</td></tr>
<tr><th id="3904">3904</th><td>		    <a class="macro" href="../mii/miivar.h.html#162" title="-1" data-ref="_M/MII_OFFSET_ANY">MII_OFFSET_ANY</a>, <a class="local col2 ref" href="#252mii_flags" title='mii_flags' data-ref="252mii_flags" data-ref-filename="252mii_flags">mii_flags</a>);</td></tr>
<tr><th id="3905">3905</th><td></td></tr>
<tr><th id="3906">3906</th><td>		<b>if</b> (<a class="macro" href="../../sys/queue.h.html#207" title="((&amp;mii-&gt;mii_phys)-&gt;lh_first == ((void *)0))" data-ref="_M/LIST_EMPTY">LIST_EMPTY</a>(&amp;<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_phys" title='mii_data::mii_phys' data-ref="mii_data::mii_phys" data-ref-filename="mii_data..mii_phys">mii_phys</a>)) {</td></tr>
<tr><th id="3907">3907</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"no PHY found!\n"</q>);</td></tr>
<tr><th id="3908">3908</th><td>			<a class="ref fn" href="../../net/if_media.h.html#ifmedia_add" title='ifmedia_add' data-ref="ifmedia_add" data-ref-filename="ifmedia_add">ifmedia_add</a>(&amp;<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#187" title="1" data-ref="_M/IFM_MANUAL">IFM_MANUAL</a>,</td></tr>
<tr><th id="3909">3909</th><td>			    <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3910">3910</th><td>			<a class="ref fn" href="../../net/if_media.h.html#ifmedia_set" title='ifmedia_set' data-ref="ifmedia_set" data-ref-filename="ifmedia_set">ifmedia_set</a>(&amp;<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#187" title="1" data-ref="_M/IFM_MANUAL">IFM_MANUAL</a>);</td></tr>
<tr><th id="3911">3911</th><td>		} <b>else</b></td></tr>
<tr><th id="3912">3912</th><td>			<a class="ref fn" href="../../net/if_media.h.html#ifmedia_set" title='ifmedia_set' data-ref="ifmedia_set" data-ref-filename="ifmedia_set">ifmedia_set</a>(&amp;<a class="local col0 ref" href="#240mii" title='mii' data-ref="240mii" data-ref-filename="240mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>, <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a> | <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a>);</td></tr>
<tr><th id="3913">3913</th><td></td></tr>
<tr><th id="3914">3914</th><td>		<i>/*</i></td></tr>
<tr><th id="3915">3915</th><td><i>		 * Now tell the firmware we are going up after probing the PHY</i></td></tr>
<tr><th id="3916">3916</th><td><i>		 */</i></td></tr>
<tr><th id="3917">3917</th><td>		<b>if</b> (<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#259" title="4" data-ref="_M/ASF_STACKUP">ASF_STACKUP</a>)</td></tr>
<tr><th id="3918">3918</th><td>			<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800) | (0x00010000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>);</td></tr>
<tr><th id="3919">3919</th><td>	}</td></tr>
<tr><th id="3920">3920</th><td></td></tr>
<tr><th id="3921">3921</th><td>	<i>/*</i></td></tr>
<tr><th id="3922">3922</th><td><i>	 * Call MI attach routine.</i></td></tr>
<tr><th id="3923">3923</th><td><i>	 */</i></td></tr>
<tr><th id="3924">3924</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"if_attach\n"</q>));</td></tr>
<tr><th id="3925">3925</th><td>	<a class="ref fn" href="../../net/if.h.html#if_attach" title='if_attach' data-ref="if_attach" data-ref-filename="if_attach">if_attach</a>(<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>);</td></tr>
<tr><th id="3926">3926</th><td>	<a class="ref fn" href="../../net/if.h.html#if_deferred_start_init" title='if_deferred_start_init' data-ref="if_deferred_start_init" data-ref-filename="if_deferred_start_init">if_deferred_start_init</a>(<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3927">3927</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"ether_ifattach\n"</q>));</td></tr>
<tr><th id="3928">3928</th><td>	<a class="ref fn" href="../../net/if_ether.h.html#ether_ifattach" title='ether_ifattach' data-ref="ether_ifattach" data-ref-filename="ether_ifattach">ether_ifattach</a>(<a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>, <a class="local col4 ref" href="#244eaddr" title='eaddr' data-ref="244eaddr" data-ref-filename="244eaddr">eaddr</a>);</td></tr>
<tr><th id="3929">3929</th><td>	<a class="ref fn" href="../../net/if_ether.h.html#ether_set_ifflags_cb" title='ether_set_ifflags_cb' data-ref="ether_set_ifflags_cb" data-ref-filename="ether_set_ifflags_cb">ether_set_ifflags_cb</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>, <a class="tu ref fn" href="#bge_ifflags_cb" title='bge_ifflags_cb' data-use='r' data-ref="bge_ifflags_cb" data-ref-filename="bge_ifflags_cb">bge_ifflags_cb</a>);</td></tr>
<tr><th id="3930">3930</th><td>	<a class="ref fn" href="../../sys/rndsource.h.html#rnd_attach_source" title='rnd_attach_source' data-ref="rnd_attach_source" data-ref-filename="rnd_attach_source">rnd_attach_source</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::rnd_source" title='bge_softc::rnd_source' data-ref="bge_softc::rnd_source" data-ref-filename="bge_softc..rnd_source">rnd_source</a>, <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>),</td></tr>
<tr><th id="3931">3931</th><td>		<a class="macro" href="../../sys/rndio.h.html#99" title="2" data-ref="_M/RND_TYPE_NET">RND_TYPE_NET</a>, <a class="macro" href="../../sys/rndio.h.html#94" title="(0x00002000|0x00001000| 0x00004000)" data-ref="_M/RND_FLAG_DEFAULT">RND_FLAG_DEFAULT</a>);</td></tr>
<tr><th id="3932">3932</th><td><u>#<span data-ppcond="3932">ifdef</span> <span class="macro" data-ref="_M/BGE_EVENT_COUNTERS">BGE_EVENT_COUNTERS</span></u></td></tr>
<tr><th id="3933">3933</th><td>	<i>/*</i></td></tr>
<tr><th id="3934">3934</th><td><i>	 * Attach event counters.</i></td></tr>
<tr><th id="3935">3935</th><td><i>	 */</i></td></tr>
<tr><th id="3936">3936</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_intr, EVCNT_TYPE_INTR,</td></tr>
<tr><th id="3937">3937</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"intr"</q>);</td></tr>
<tr><th id="3938">3938</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_intr_spurious, EVCNT_TYPE_INTR,</td></tr>
<tr><th id="3939">3939</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"intr_spurious"</q>);</td></tr>
<tr><th id="3940">3940</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_intr_spurious2, EVCNT_TYPE_INTR,</td></tr>
<tr><th id="3941">3941</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"intr_spurious2"</q>);</td></tr>
<tr><th id="3942">3942</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_tx_xoff, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3943">3943</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"tx_xoff"</q>);</td></tr>
<tr><th id="3944">3944</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_tx_xon, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3945">3945</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"tx_xon"</q>);</td></tr>
<tr><th id="3946">3946</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_rx_xoff, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3947">3947</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"rx_xoff"</q>);</td></tr>
<tr><th id="3948">3948</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_rx_xon, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3949">3949</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"rx_xon"</q>);</td></tr>
<tr><th id="3950">3950</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_rx_macctl, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3951">3951</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"rx_macctl"</q>);</td></tr>
<tr><th id="3952">3952</th><td>	evcnt_attach_dynamic(&amp;sc-&gt;bge_ev_xoffentered, EVCNT_TYPE_MISC,</td></tr>
<tr><th id="3953">3953</th><td>	    NULL, device_xname(sc-&gt;bge_dev), <q>"xoffentered"</q>);</td></tr>
<tr><th id="3954">3954</th><td><u>#<span data-ppcond="3932">endif</span> /* BGE_EVENT_COUNTERS */</u></td></tr>
<tr><th id="3955">3955</th><td>	<a class="macro" href="#283" title="" data-ref="_M/DPRINTFN">DPRINTFN</a>(<var>5</var>, (<q>"callout_init\n"</q>));</td></tr>
<tr><th id="3956">3956</th><td>	<a class="ref fn" href="../../sys/callout.h.html#callout_init" title='callout_init' data-ref="callout_init" data-ref-filename="callout_init">callout_init</a>(&amp;<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_timeout" title='bge_softc::bge_timeout' data-ref="bge_softc::bge_timeout" data-ref-filename="bge_softc..bge_timeout">bge_timeout</a>, <var>0</var>);</td></tr>
<tr><th id="3957">3957</th><td></td></tr>
<tr><th id="3958">3958</th><td>	<b>if</b> (<a class="macro" href="../../sys/pmf.h.html#98" title="pmf_device_register1((self), (((void *)0)), (((void *)0)), ((void *)0))" data-ref="_M/pmf_device_register">pmf_device_register</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>))</td></tr>
<tr><th id="3959">3959</th><td>		<a class="ref fn" href="../../sys/pmf.h.html#pmf_class_network_register" title='pmf_class_network_register' data-ref="pmf_class_network_register" data-ref-filename="pmf_class_network_register">pmf_class_network_register</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>, <a class="local col9 ref" href="#239ifp" title='ifp' data-ref="239ifp" data-ref-filename="239ifp">ifp</a>);</td></tr>
<tr><th id="3960">3960</th><td>	<b>else</b></td></tr>
<tr><th id="3961">3961</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col4 ref" href="#224self" title='self' data-ref="224self" data-ref-filename="224self">self</a>, <q>"couldn't establish power handler\n"</q>);</td></tr>
<tr><th id="3962">3962</th><td></td></tr>
<tr><th id="3963">3963</th><td>	<a class="tu ref fn" href="#bge_sysctl_init" title='bge_sysctl_init' data-use='c' data-ref="bge_sysctl_init" data-ref-filename="bge_sysctl_init">bge_sysctl_init</a>(<a class="local col6 ref" href="#226sc" title='sc' data-ref="226sc" data-ref-filename="226sc">sc</a>);</td></tr>
<tr><th id="3964">3964</th><td></td></tr>
<tr><th id="3965">3965</th><td><u>#<span data-ppcond="3965">ifdef</span> <span class="macro" data-ref="_M/BGE_DEBUG">BGE_DEBUG</span></u></td></tr>
<tr><th id="3966">3966</th><td>	bge_debug_info(sc);</td></tr>
<tr><th id="3967">3967</th><td><u>#<span data-ppcond="3965">endif</span></u></td></tr>
<tr><th id="3968">3968</th><td>}</td></tr>
<tr><th id="3969">3969</th><td></td></tr>
<tr><th id="3970">3970</th><td><i  data-doc="bge_detach">/*</i></td></tr>
<tr><th id="3971">3971</th><td><i  data-doc="bge_detach"> * Stop all chip I/O so that the kernel's probe routines don't</i></td></tr>
<tr><th id="3972">3972</th><td><i  data-doc="bge_detach"> * get confused by errant DMAs when rebooting.</i></td></tr>
<tr><th id="3973">3973</th><td><i  data-doc="bge_detach"> */</i></td></tr>
<tr><th id="3974">3974</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="3975">3975</th><td><dfn class="tu decl def fn" id="bge_detach" title='bge_detach' data-type='int bge_detach(device_t self, int flags)' data-ref="bge_detach" data-ref-filename="bge_detach">bge_detach</dfn>(<a class="typedef" href="../../sys/device_if.h.html#device_t" title='device_t' data-type='struct device *' data-ref="device_t" data-ref-filename="device_t">device_t</a> <dfn class="local col9 decl" id="259self" title='self' data-type='device_t' data-ref="259self" data-ref-filename="259self">self</dfn>, <em>int</em> <dfn class="local col0 decl" id="260flags" title='flags' data-type='int' data-ref="260flags" data-ref-filename="260flags">flags</dfn> <a class="macro" href="../../sys/cdefs.h.html#263" title="__attribute__((__unused__))" data-ref="_M/__unused">__unused</a>)</td></tr>
<tr><th id="3976">3976</th><td>{</td></tr>
<tr><th id="3977">3977</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="261sc" title='sc' data-type='struct bge_softc *' data-ref="261sc" data-ref-filename="261sc">sc</dfn> = <a class="ref fn" href="../../sys/device.h.html#device_private" title='device_private' data-ref="device_private" data-ref-filename="device_private">device_private</a>(<a class="local col9 ref" href="#259self" title='self' data-ref="259self" data-ref-filename="259self">self</a>);</td></tr>
<tr><th id="3978">3978</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col2 decl" id="262ifp" title='ifp' data-type='struct ifnet *' data-ref="262ifp" data-ref-filename="262ifp">ifp</dfn> = &amp;<a class="local col1 ref" href="#261sc" title='sc' data-ref="261sc" data-ref-filename="261sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="3979">3979</th><td>	<em>int</em> <dfn class="local col3 decl" id="263s" title='s' data-type='int' data-ref="263s" data-ref-filename="263s">s</dfn>;</td></tr>
<tr><th id="3980">3980</th><td></td></tr>
<tr><th id="3981">3981</th><td>	<a class="local col3 ref" href="#263s" title='s' data-ref="263s" data-ref-filename="263s">s</a> = <a class="macro" href="../../sys/intr.h.html#92" title="splvm()" data-ref="_M/splnet">splnet</a>();</td></tr>
<tr><th id="3982">3982</th><td>	<i>/* Stop the interface. Callouts are stopped in it. */</i></td></tr>
<tr><th id="3983">3983</th><td>	<a class="tu ref fn" href="#bge_stop" title='bge_stop' data-use='c' data-ref="bge_stop" data-ref-filename="bge_stop">bge_stop</a>(<a class="local col2 ref" href="#262ifp" title='ifp' data-ref="262ifp" data-ref-filename="262ifp">ifp</a>, <var>1</var>);</td></tr>
<tr><th id="3984">3984</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col3 ref" href="#263s" title='s' data-ref="263s" data-ref-filename="263s">s</a>);</td></tr>
<tr><th id="3985">3985</th><td></td></tr>
<tr><th id="3986">3986</th><td>	<a class="ref fn" href="../mii/miivar.h.html#mii_detach" title='mii_detach' data-ref="mii_detach" data-ref-filename="mii_detach">mii_detach</a>(&amp;<a class="local col1 ref" href="#261sc" title='sc' data-ref="261sc" data-ref-filename="261sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>, <a class="macro" href="../mii/miivar.h.html#163" title="-1" data-ref="_M/MII_PHY_ANY">MII_PHY_ANY</a>, <a class="macro" href="../mii/miivar.h.html#162" title="-1" data-ref="_M/MII_OFFSET_ANY">MII_OFFSET_ANY</a>);</td></tr>
<tr><th id="3987">3987</th><td></td></tr>
<tr><th id="3988">3988</th><td>	<i>/* Delete all remaining media. */</i></td></tr>
<tr><th id="3989">3989</th><td>	<a class="ref fn" href="../../net/if_media.h.html#ifmedia_delete_instance" title='ifmedia_delete_instance' data-ref="ifmedia_delete_instance" data-ref-filename="ifmedia_delete_instance">ifmedia_delete_instance</a>(&amp;<a class="local col1 ref" href="#261sc" title='sc' data-ref="261sc" data-ref-filename="261sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>.<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>, <a class="macro" href="../../net/if_media.h.html#151" title="((u_int) -1)" data-ref="_M/IFM_INST_ANY">IFM_INST_ANY</a>);</td></tr>
<tr><th id="3990">3990</th><td></td></tr>
<tr><th id="3991">3991</th><td>	<a class="ref fn" href="../../net/if_ether.h.html#ether_ifdetach" title='ether_ifdetach' data-ref="ether_ifdetach" data-ref-filename="ether_ifdetach">ether_ifdetach</a>(<a class="local col2 ref" href="#262ifp" title='ifp' data-ref="262ifp" data-ref-filename="262ifp">ifp</a>);</td></tr>
<tr><th id="3992">3992</th><td>	<a class="ref fn" href="../../net/if.h.html#if_detach" title='if_detach' data-ref="if_detach" data-ref-filename="if_detach">if_detach</a>(<a class="local col2 ref" href="#262ifp" title='ifp' data-ref="262ifp" data-ref-filename="262ifp">ifp</a>);</td></tr>
<tr><th id="3993">3993</th><td></td></tr>
<tr><th id="3994">3994</th><td>	<a class="tu ref fn" href="#bge_release_resources" title='bge_release_resources' data-use='c' data-ref="bge_release_resources" data-ref-filename="bge_release_resources">bge_release_resources</a>(<a class="local col1 ref" href="#261sc" title='sc' data-ref="261sc" data-ref-filename="261sc">sc</a>);</td></tr>
<tr><th id="3995">3995</th><td></td></tr>
<tr><th id="3996">3996</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3997">3997</th><td>}</td></tr>
<tr><th id="3998">3998</th><td></td></tr>
<tr><th id="3999">3999</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4000">4000</th><td><dfn class="tu decl def fn" id="bge_release_resources" title='bge_release_resources' data-type='void bge_release_resources(struct bge_softc * sc)' data-ref="bge_release_resources" data-ref-filename="bge_release_resources">bge_release_resources</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col4 decl" id="264sc" title='sc' data-type='struct bge_softc *' data-ref="264sc" data-ref-filename="264sc">sc</dfn>)</td></tr>
<tr><th id="4001">4001</th><td>{</td></tr>
<tr><th id="4002">4002</th><td></td></tr>
<tr><th id="4003">4003</th><td>	<i>/* Detach sysctl */</i></td></tr>
<tr><th id="4004">4004</th><td>	<b>if</b> (<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_log" title='bge_softc::bge_log' data-ref="bge_softc::bge_log" data-ref-filename="bge_softc..bge_log">bge_log</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="4005">4005</th><td>		<a class="ref fn" href="../../sys/sysctl.h.html#sysctl_teardown" title='sysctl_teardown' data-ref="sysctl_teardown" data-ref-filename="sysctl_teardown">sysctl_teardown</a>(&amp;<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_log" title='bge_softc::bge_log' data-ref="bge_softc::bge_log" data-ref-filename="bge_softc..bge_log">bge_log</a>);</td></tr>
<tr><th id="4006">4006</th><td></td></tr>
<tr><th id="4007">4007</th><td><u>#<span data-ppcond="4007">ifdef</span> <span class="macro" data-ref="_M/BGE_EVENT_COUNTERS">BGE_EVENT_COUNTERS</span></u></td></tr>
<tr><th id="4008">4008</th><td>	<i>/* Detach event counters. */</i></td></tr>
<tr><th id="4009">4009</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_intr);</td></tr>
<tr><th id="4010">4010</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_intr_spurious);</td></tr>
<tr><th id="4011">4011</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_intr_spurious2);</td></tr>
<tr><th id="4012">4012</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_tx_xoff);</td></tr>
<tr><th id="4013">4013</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_tx_xon);</td></tr>
<tr><th id="4014">4014</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_rx_xoff);</td></tr>
<tr><th id="4015">4015</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_rx_xon);</td></tr>
<tr><th id="4016">4016</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_rx_macctl);</td></tr>
<tr><th id="4017">4017</th><td>	evcnt_detach(&amp;sc-&gt;bge_ev_xoffentered);</td></tr>
<tr><th id="4018">4018</th><td><u>#<span data-ppcond="4007">endif</span> /* BGE_EVENT_COUNTERS */</u></td></tr>
<tr><th id="4019">4019</th><td></td></tr>
<tr><th id="4020">4020</th><td>	<i>/* Disestablish the interrupt handler */</i></td></tr>
<tr><th id="4021">4021</th><td>	<b>if</b> (<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_intrhand" title='bge_softc::bge_intrhand' data-ref="bge_softc::bge_intrhand" data-ref-filename="bge_softc..bge_intrhand">bge_intrhand</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="4022">4022</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_disestablish" title='pci_intr_disestablish' data-ref="pci_intr_disestablish" data-ref-filename="pci_intr_disestablish">pci_intr_disestablish</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_intrhand" title='bge_softc::bge_intrhand' data-ref="bge_softc::bge_intrhand" data-ref-filename="bge_softc..bge_intrhand">bge_intrhand</a>);</td></tr>
<tr><th id="4023">4023</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_intr_release" title='pci_intr_release' data-ref="pci_intr_release" data-ref-filename="pci_intr_release">pci_intr_release</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pihp" title='bge_softc::bge_pihp' data-ref="bge_softc::bge_pihp" data-ref-filename="bge_softc..bge_pihp">bge_pihp</a>, <var>1</var>);</td></tr>
<tr><th id="4024">4024</th><td>		<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_intrhand" title='bge_softc::bge_intrhand' data-ref="bge_softc::bge_intrhand" data-ref-filename="bge_softc..bge_intrhand">bge_intrhand</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4025">4025</th><td>	}</td></tr>
<tr><th id="4026">4026</th><td></td></tr>
<tr><th id="4027">4027</th><td>	<b>if</b> (<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="4028">4028</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>);</td></tr>
<tr><th id="4029">4029</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_destroy" title='bus_dmamap_destroy' data-ref="bus_dmamap_destroy" data-ref-filename="bus_dmamap_destroy">bus_dmamap_destroy</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>);</td></tr>
<tr><th id="4030">4030</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_unmap" title='bus_dmamem_unmap' data-ref="bus_dmamem_unmap" data-ref-filename="bus_dmamem_unmap">bus_dmamem_unmap</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, (<em>void</em> *)<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>,</td></tr>
<tr><th id="4031">4031</th><td>		    <b>sizeof</b>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>));</td></tr>
<tr><th id="4032">4032</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamem_free" title='bus_dmamem_free' data-ref="bus_dmamem_free" data-ref-filename="bus_dmamem_free">bus_dmamem_free</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, &amp;<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_seg" title='bge_softc::bge_ring_seg' data-ref="bge_softc::bge_ring_seg" data-ref-filename="bge_softc..bge_ring_seg">bge_ring_seg</a>,</td></tr>
<tr><th id="4033">4033</th><td>		    <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_rseg" title='bge_softc::bge_ring_rseg' data-ref="bge_softc::bge_ring_rseg" data-ref-filename="bge_softc..bge_ring_rseg">bge_ring_rseg</a>);</td></tr>
<tr><th id="4034">4034</th><td>	}</td></tr>
<tr><th id="4035">4035</th><td></td></tr>
<tr><th id="4036">4036</th><td>	<i>/* Unmap the device registers */</i></td></tr>
<tr><th id="4037">4037</th><td>	<b>if</b> (<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bsize" title='bge_softc::bge_bsize' data-ref="bge_softc::bge_bsize" data-ref-filename="bge_softc..bge_bsize">bge_bsize</a> != <var>0</var>) {</td></tr>
<tr><th id="4038">4038</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_space_unmap" title='bus_space_unmap' data-ref="bus_space_unmap" data-ref-filename="bus_space_unmap">bus_space_unmap</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_btag" title='bge_softc::bge_btag' data-ref="bge_softc::bge_btag" data-ref-filename="bge_softc..bge_btag">bge_btag</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bhandle" title='bge_softc::bge_bhandle' data-ref="bge_softc::bge_bhandle" data-ref-filename="bge_softc..bge_bhandle">bge_bhandle</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bsize" title='bge_softc::bge_bsize' data-ref="bge_softc::bge_bsize" data-ref-filename="bge_softc..bge_bsize">bge_bsize</a>);</td></tr>
<tr><th id="4039">4039</th><td>		<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_bsize" title='bge_softc::bge_bsize' data-ref="bge_softc::bge_bsize" data-ref-filename="bge_softc..bge_bsize">bge_bsize</a> = <var>0</var>;</td></tr>
<tr><th id="4040">4040</th><td>	}</td></tr>
<tr><th id="4041">4041</th><td></td></tr>
<tr><th id="4042">4042</th><td>	<i>/* Unmap the APE registers */</i></td></tr>
<tr><th id="4043">4043</th><td>	<b>if</b> (<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apesize" title='bge_softc::bge_apesize' data-ref="bge_softc::bge_apesize" data-ref-filename="bge_softc..bge_apesize">bge_apesize</a> != <var>0</var>) {</td></tr>
<tr><th id="4044">4044</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_space_unmap" title='bus_space_unmap' data-ref="bus_space_unmap" data-ref-filename="bus_space_unmap">bus_space_unmap</a>(<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apetag" title='bge_softc::bge_apetag' data-ref="bge_softc::bge_apetag" data-ref-filename="bge_softc..bge_apetag">bge_apetag</a>, <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apehandle" title='bge_softc::bge_apehandle' data-ref="bge_softc::bge_apehandle" data-ref-filename="bge_softc..bge_apehandle">bge_apehandle</a>,</td></tr>
<tr><th id="4045">4045</th><td>		    <a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apesize" title='bge_softc::bge_apesize' data-ref="bge_softc::bge_apesize" data-ref-filename="bge_softc..bge_apesize">bge_apesize</a>);</td></tr>
<tr><th id="4046">4046</th><td>		<a class="local col4 ref" href="#264sc" title='sc' data-ref="264sc" data-ref-filename="264sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_apesize" title='bge_softc::bge_apesize' data-ref="bge_softc::bge_apesize" data-ref-filename="bge_softc..bge_apesize">bge_apesize</a> = <var>0</var>;</td></tr>
<tr><th id="4047">4047</th><td>	}</td></tr>
<tr><th id="4048">4048</th><td>}</td></tr>
<tr><th id="4049">4049</th><td></td></tr>
<tr><th id="4050">4050</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="4051">4051</th><td><dfn class="tu decl def fn" id="bge_reset" title='bge_reset' data-type='int bge_reset(struct bge_softc * sc)' data-ref="bge_reset" data-ref-filename="bge_reset">bge_reset</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="265sc" title='sc' data-type='struct bge_softc *' data-ref="265sc" data-ref-filename="265sc">sc</dfn>)</td></tr>
<tr><th id="4052">4052</th><td>{</td></tr>
<tr><th id="4053">4053</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="266cachesize" title='cachesize' data-type='uint32_t' data-ref="266cachesize" data-ref-filename="266cachesize">cachesize</dfn>, <dfn class="local col7 decl" id="267command" title='command' data-type='uint32_t' data-ref="267command" data-ref-filename="267command">command</dfn>;</td></tr>
<tr><th id="4054">4054</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="268reset" title='reset' data-type='uint32_t' data-ref="268reset" data-ref-filename="268reset">reset</dfn>, <dfn class="local col9 decl" id="269mac_mode" title='mac_mode' data-type='uint32_t' data-ref="269mac_mode" data-ref-filename="269mac_mode">mac_mode</dfn>, <dfn class="local col0 decl" id="270mac_mode_mask" title='mac_mode_mask' data-type='uint32_t' data-ref="270mac_mode_mask" data-ref-filename="270mac_mode_mask">mac_mode_mask</dfn>;</td></tr>
<tr><th id="4055">4055</th><td>	<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a> <dfn class="local col1 decl" id="271devctl" title='devctl' data-type='pcireg_t' data-ref="271devctl" data-ref-filename="271devctl">devctl</dfn>, <dfn class="local col2 decl" id="272reg" title='reg' data-type='pcireg_t' data-ref="272reg" data-ref-filename="272reg">reg</dfn>;</td></tr>
<tr><th id="4056">4056</th><td>	<em>int</em> <dfn class="local col3 decl" id="273i" title='i' data-type='int' data-ref="273i" data-ref-filename="273i">i</dfn>, <dfn class="local col4 decl" id="274val" title='val' data-type='int' data-ref="274val" data-ref-filename="274val">val</dfn>;</td></tr>
<tr><th id="4057">4057</th><td>	<em>void</em> (*<dfn class="local col5 decl" id="275write_op" title='write_op' data-type='void (*)(struct bge_softc *, int, int)' data-ref="275write_op" data-ref-filename="275write_op">write_op</dfn>)(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *, <em>int</em>, <em>int</em>);</td></tr>
<tr><th id="4058">4058</th><td></td></tr>
<tr><th id="4059">4059</th><td>	<i>/* Make mask for BGE_MAC_MODE register. */</i></td></tr>
<tr><th id="4060">4060</th><td>	<a class="local col0 ref" href="#270mac_mode_mask" title='mac_mode_mask' data-ref="270mac_mode_mask" data-ref-filename="270mac_mode_mask">mac_mode_mask</a> = <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a> | <a class="macro" href="if_bgereg.h.html#699" title="0x0000000C" data-ref="_M/BGE_MACMODE_PORTMODE">BGE_MACMODE_PORTMODE</a>;</td></tr>
<tr><th id="4061">4061</th><td>	<b>if</b> ((<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) != <var>0</var>)</td></tr>
<tr><th id="4062">4062</th><td>		<a class="local col0 ref" href="#270mac_mode_mask" title='mac_mode_mask' data-ref="270mac_mode_mask" data-ref-filename="270mac_mode_mask">mac_mode_mask</a> |= <a class="macro" href="if_bgereg.h.html#718" title="0x08000000" data-ref="_M/BGE_MACMODE_APE_RX_EN">BGE_MACMODE_APE_RX_EN</a> | <a class="macro" href="if_bgereg.h.html#719" title="0x10000000" data-ref="_M/BGE_MACMODE_APE_TX_EN">BGE_MACMODE_APE_TX_EN</a>;</td></tr>
<tr><th id="4063">4063</th><td>	<i>/* Keep mac_mode_mask's bits of BGE_MAC_MODE register into mac_mode */</i></td></tr>
<tr><th id="4064">4064</th><td>	<a class="local col9 ref" href="#269mac_mode" title='mac_mode' data-ref="269mac_mode" data-ref-filename="269mac_mode">mac_mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>) &amp; <a class="local col0 ref" href="#270mac_mode_mask" title='mac_mode_mask' data-ref="270mac_mode_mask" data-ref-filename="270mac_mode_mask">mac_mode_mask</a>;</td></tr>
<tr><th id="4065">4065</th><td></td></tr>
<tr><th id="4066">4066</th><td>	<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>) &amp;&amp; !<a class="macro" href="#412" title="((sc)-&gt;bge_flags &amp; 0x00010000)" data-ref="_M/BGE_IS_5714_FAMILY">BGE_IS_5714_FAMILY</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="4067">4067</th><td>	    (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)) {</td></tr>
<tr><th id="4068">4068</th><td>		<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>)</td></tr>
<tr><th id="4069">4069</th><td>			<a class="local col5 ref" href="#275write_op" title='write_op' data-ref="275write_op" data-ref-filename="275write_op">write_op</a> = <a class="tu ref fn" href="#bge_writemem_direct" title='bge_writemem_direct' data-use='r' data-ref="bge_writemem_direct" data-ref-filename="bge_writemem_direct">bge_writemem_direct</a>;</td></tr>
<tr><th id="4070">4070</th><td>		<b>else</b></td></tr>
<tr><th id="4071">4071</th><td>			<a class="local col5 ref" href="#275write_op" title='write_op' data-ref="275write_op" data-ref-filename="275write_op">write_op</a> = <a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='r' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>;</td></tr>
<tr><th id="4072">4072</th><td>	} <b>else</b></td></tr>
<tr><th id="4073">4073</th><td>		<a class="local col5 ref" href="#275write_op" title='write_op' data-ref="275write_op" data-ref-filename="275write_op">write_op</a> = <a class="tu ref fn" href="#bge_writereg_ind" title='bge_writereg_ind' data-use='r' data-ref="bge_writereg_ind" data-ref-filename="bge_writereg_ind">bge_writereg_ind</a>;</td></tr>
<tr><th id="4074">4074</th><td></td></tr>
<tr><th id="4075">4075</th><td>	<i>/* 57XX step 4 */</i></td></tr>
<tr><th id="4076">4076</th><td>	<i>/* Acquire the NVM lock */</i></td></tr>
<tr><th id="4077">4077</th><td>	<b>if</b> ((<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>) == <var>0</var> &amp;&amp;</td></tr>
<tr><th id="4078">4078</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> &amp;&amp;</td></tr>
<tr><th id="4079">4079</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#358" title="0x00" data-ref="_M/BGE_ASICREV_BCM5701">BGE_ASICREV_BCM5701</a>) {</td></tr>
<tr><th id="4080">4080</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1922" title="0x7020" data-ref="_M/BGE_NVRAM_SWARB">BGE_NVRAM_SWARB</a>, <a class="macro" href="if_bgereg.h.html#1942" title="0x00000002" data-ref="_M/BGE_NVRAMSWARB_SET1">BGE_NVRAMSWARB_SET1</a>);</td></tr>
<tr><th id="4081">4081</th><td>		<b>for</b> (<a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> = <var>0</var>; <a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> &lt; <var>8000</var>; <a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a>++) {</td></tr>
<tr><th id="4082">4082</th><td>			<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7020)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1922" title="0x7020" data-ref="_M/BGE_NVRAM_SWARB">BGE_NVRAM_SWARB</a>) &amp;</td></tr>
<tr><th id="4083">4083</th><td>			    <a class="macro" href="if_bgereg.h.html#1950" title="0x00000200" data-ref="_M/BGE_NVRAMSWARB_GNT1">BGE_NVRAMSWARB_GNT1</a>)</td></tr>
<tr><th id="4084">4084</th><td>				<b>break</b>;</td></tr>
<tr><th id="4085">4085</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(20)" data-ref="_M/DELAY">DELAY</a>(<var>20</var>);</td></tr>
<tr><th id="4086">4086</th><td>		}</td></tr>
<tr><th id="4087">4087</th><td>		<b>if</b> (<a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> == <var>8000</var>) {</td></tr>
<tr><th id="4088">4088</th><td>			<a class="ref fn" href="../../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"%s: NVRAM lock timedout!\n"</q>,</td></tr>
<tr><th id="4089">4089</th><td>			    <a class="ref fn" href="../../sys/device.h.html#device_xname" title='device_xname' data-ref="device_xname" data-ref-filename="device_xname">device_xname</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>));</td></tr>
<tr><th id="4090">4090</th><td>		}</td></tr>
<tr><th id="4091">4091</th><td>	}</td></tr>
<tr><th id="4092">4092</th><td></td></tr>
<tr><th id="4093">4093</th><td>	<i>/* Take APE lock when performing reset. */</i></td></tr>
<tr><th id="4094">4094</th><td>	<a class="tu ref fn" href="#bge_ape_lock" title='bge_ape_lock' data-use='c' data-ref="bge_ape_lock" data-ref-filename="bge_ape_lock">bge_ape_lock</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2215" title="1" data-ref="_M/BGE_APE_LOCK_GRC">BGE_APE_LOCK_GRC</a>);</td></tr>
<tr><th id="4095">4095</th><td></td></tr>
<tr><th id="4096">4096</th><td>	<i>/* 57XX step 3 */</i></td></tr>
<tr><th id="4097">4097</th><td>	<i>/* Save some important PCI state. */</i></td></tr>
<tr><th id="4098">4098</th><td>	<a class="local col6 ref" href="#266cachesize" title='cachesize' data-ref="266cachesize" data-ref-filename="266cachesize">cachesize</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#170" title="0x0C" data-ref="_M/BGE_PCI_CACHESZ">BGE_PCI_CACHESZ</a>);</td></tr>
<tr><th id="4099">4099</th><td>	<i>/* 5718 reset step 3 */</i></td></tr>
<tr><th id="4100">4100</th><td>	<a class="local col7 ref" href="#267command" title='command' data-ref="267command" data-ref-filename="267command">command</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#166" title="0x04" data-ref="_M/BGE_PCI_CMD">BGE_PCI_CMD</a>);</td></tr>
<tr><th id="4101">4101</th><td></td></tr>
<tr><th id="4102">4102</th><td>	<i>/* 5718 reset step 5, 57XX step 5b-5d */</i></td></tr>
<tr><th id="4103">4103</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>,</td></tr>
<tr><th id="4104">4104</th><td>	    <a class="macro" href="if_bgereg.h.html#262" title="0x00000080" data-ref="_M/BGE_PCIMISCCTL_INDIRECT_ACCESS">BGE_PCIMISCCTL_INDIRECT_ACCESS</a> | <a class="macro" href="if_bgereg.h.html#256" title="0x00000002" data-ref="_M/BGE_PCIMISCCTL_MASK_PCI_INTR">BGE_PCIMISCCTL_MASK_PCI_INTR</a> |</td></tr>
<tr><th id="4105">4105</th><td>	    <a class="macro" href="if_bgereg.h.html#267" title="(0x00000008)" data-ref="_M/BGE_HIF_SWAP_OPTIONS">BGE_HIF_SWAP_OPTIONS</a> | <a class="macro" href="if_bgereg.h.html#259" title="0x00000010" data-ref="_M/BGE_PCIMISCCTL_PCISTATE_RW">BGE_PCIMISCCTL_PCISTATE_RW</a>);</td></tr>
<tr><th id="4106">4106</th><td></td></tr>
<tr><th id="4107">4107</th><td>	<i>/* XXX ???: Disable fastboot on controllers that support it. */</i></td></tr>
<tr><th id="4108">4108</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#364" title="0x06" data-ref="_M/BGE_ASICREV_BCM5752">BGE_ASICREV_BCM5752</a> ||</td></tr>
<tr><th id="4109">4109</th><td>	    <a class="macro" href="#414" title="((sc)-&gt;bge_flags &amp; 0x00004000)" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>))</td></tr>
<tr><th id="4110">4110</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6894, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1907" title="0x6894" data-ref="_M/BGE_FASTBOOT_PC">BGE_FASTBOOT_PC</a>, <var>0</var>);</td></tr>
<tr><th id="4111">4111</th><td></td></tr>
<tr><th id="4112">4112</th><td>	<i>/* 5718 reset step 2, 57XX step 6 */</i></td></tr>
<tr><th id="4113">4113</th><td>	<i>/*</i></td></tr>
<tr><th id="4114">4114</th><td><i>	 * Write the magic number to SRAM at offset 0xB50.</i></td></tr>
<tr><th id="4115">4115</th><td><i>	 * When firmware finishes its initialization it will</i></td></tr>
<tr><th id="4116">4116</th><td><i>	 * write ~BGE_MAGIC_NUMBER to the same location.</i></td></tr>
<tr><th id="4117">4117</th><td><i>	 */</i></td></tr>
<tr><th id="4118">4118</th><td>	<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#75" title="0x00000B50" data-ref="_M/BGE_SRAM_FW_MB">BGE_SRAM_FW_MB</a>, <a class="macro" href="if_bgereg.h.html#2242" title="0x4B657654" data-ref="_M/BGE_SRAM_FW_MB_MAGIC">BGE_SRAM_FW_MB_MAGIC</a>);</td></tr>
<tr><th id="4119">4119</th><td></td></tr>
<tr><th id="4120">4120</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>) {</td></tr>
<tr><th id="4121">4121</th><td>		<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d54)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1979" title="0x7d54" data-ref="_M/BGE_PCIE_LINKCTL">BGE_PCIE_LINKCTL</a>);</td></tr>
<tr><th id="4122">4122</th><td>		<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = (<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> &amp; ~<a class="macro" href="if_bgereg.h.html#1988" title="0x00000008" data-ref="_M/BGE_PCIE_LINKCTL_L1_PLL_PDEN">BGE_PCIE_LINKCTL_L1_PLL_PDEN</a>)</td></tr>
<tr><th id="4123">4123</th><td>		    | <a class="macro" href="if_bgereg.h.html#1989" title="0x00000080" data-ref="_M/BGE_PCIE_LINKCTL_L1_PLL_PDDIS">BGE_PCIE_LINKCTL_L1_PLL_PDDIS</a>;</td></tr>
<tr><th id="4124">4124</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d54, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1979" title="0x7d54" data-ref="_M/BGE_PCIE_LINKCTL">BGE_PCIE_LINKCTL</a>, <a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a>);</td></tr>
<tr><th id="4125">4125</th><td>	}</td></tr>
<tr><th id="4126">4126</th><td></td></tr>
<tr><th id="4127">4127</th><td>	<i>/* 5718 reset step 6, 57XX step 7 */</i></td></tr>
<tr><th id="4128">4128</th><td>	<a class="local col8 ref" href="#268reset" title='reset' data-ref="268reset" data-ref-filename="268reset">reset</a> = <a class="macro" href="if_bgereg.h.html#2039" title="0x00000001" data-ref="_M/BGE_MISCCFG_RESET_CORE_CLOCKS">BGE_MISCCFG_RESET_CORE_CLOCKS</a> | <a class="macro" href="if_bgereg.h.html#2048" title="(0x41 &lt;&lt; 1)" data-ref="_M/BGE_32BITTIME_66MHZ">BGE_32BITTIME_66MHZ</a>;</td></tr>
<tr><th id="4129">4129</th><td>	<i>/*</i></td></tr>
<tr><th id="4130">4130</th><td><i>	 * XXX: from FreeBSD/Linux; no documentation</i></td></tr>
<tr><th id="4131">4131</th><td><i>	 */</i></td></tr>
<tr><th id="4132">4132</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>) {</td></tr>
<tr><th id="4133">4133</th><td>		<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>) &amp;&amp;</td></tr>
<tr><th id="4134">4134</th><td>		    !<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="4135">4135</th><td>		    (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7e2c)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2000" title="0x7e2c" data-ref="_M/BGE_PHY_TEST_CTRL_REG">BGE_PHY_TEST_CTRL_REG</a>) ==</td></tr>
<tr><th id="4136">4136</th><td>			(<a class="macro" href="if_bgereg.h.html#2002" title="0x0040" data-ref="_M/BGE_PHY_PCIE_LTASS_MODE">BGE_PHY_PCIE_LTASS_MODE</a> | <a class="macro" href="if_bgereg.h.html#2001" title="0x0020" data-ref="_M/BGE_PHY_PCIE_SCRAM_MODE">BGE_PHY_PCIE_SCRAM_MODE</a>))) {</td></tr>
<tr><th id="4137">4137</th><td>			<i>/* PCI Express 1.0 system */</i></td></tr>
<tr><th id="4138">4138</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7e2c, 0x0020)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2000" title="0x7e2c" data-ref="_M/BGE_PHY_TEST_CTRL_REG">BGE_PHY_TEST_CTRL_REG</a>,</td></tr>
<tr><th id="4139">4139</th><td>			    <a class="macro" href="if_bgereg.h.html#2001" title="0x0020" data-ref="_M/BGE_PHY_PCIE_SCRAM_MODE">BGE_PHY_PCIE_SCRAM_MODE</a>);</td></tr>
<tr><th id="4140">4140</th><td>		}</td></tr>
<tr><th id="4141">4141</th><td>		<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#311" title="0x4000" data-ref="_M/BGE_CHIPID_BCM5750_A0">BGE_CHIPID_BCM5750_A0</a>) {</td></tr>
<tr><th id="4142">4142</th><td>			<i>/*</i></td></tr>
<tr><th id="4143">4143</th><td><i>			 * Prevent PCI Express link training</i></td></tr>
<tr><th id="4144">4144</th><td><i>			 * during global reset.</i></td></tr>
<tr><th id="4145">4145</th><td><i>			 */</i></td></tr>
<tr><th id="4146">4146</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804, 1 &lt;&lt; 29)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>, <var>1</var> &lt;&lt; <var>29</var>);</td></tr>
<tr><th id="4147">4147</th><td>			<a class="local col8 ref" href="#268reset" title='reset' data-ref="268reset" data-ref-filename="268reset">reset</a> |= (<var>1</var> &lt;&lt; <var>29</var>);</td></tr>
<tr><th id="4148">4148</th><td>		}</td></tr>
<tr><th id="4149">4149</th><td>	}</td></tr>
<tr><th id="4150">4150</th><td></td></tr>
<tr><th id="4151">4151</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>) {</td></tr>
<tr><th id="4152">4152</th><td>		<a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5100)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1654" title="0x5100" data-ref="_M/BGE_VCPU_STATUS">BGE_VCPU_STATUS</a>);</td></tr>
<tr><th id="4153">4153</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5100, i | 0x08000000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1654" title="0x5100" data-ref="_M/BGE_VCPU_STATUS">BGE_VCPU_STATUS</a>,</td></tr>
<tr><th id="4154">4154</th><td>		    <a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> | <a class="macro" href="if_bgereg.h.html#1658" title="0x08000000" data-ref="_M/BGE_VCPU_STATUS_DRV_RESET">BGE_VCPU_STATUS_DRV_RESET</a>);</td></tr>
<tr><th id="4155">4155</th><td>		<a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6890)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1655" title="0x6890" data-ref="_M/BGE_VCPU_EXT_CTRL">BGE_VCPU_EXT_CTRL</a>);</td></tr>
<tr><th id="4156">4156</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6890, i &amp; ~0x00400000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1655" title="0x6890" data-ref="_M/BGE_VCPU_EXT_CTRL">BGE_VCPU_EXT_CTRL</a>,</td></tr>
<tr><th id="4157">4157</th><td>		    <a class="local col3 ref" href="#273i" title='i' data-ref="273i" data-ref-filename="273i">i</a> &amp; ~<a class="macro" href="if_bgereg.h.html#1660" title="0x00400000" data-ref="_M/BGE_VCPU_EXT_CTRL_HALT_CPU">BGE_VCPU_EXT_CTRL_HALT_CPU</a>);</td></tr>
<tr><th id="4158">4158</th><td>	}</td></tr>
<tr><th id="4159">4159</th><td></td></tr>
<tr><th id="4160">4160</th><td>	<i>/*</i></td></tr>
<tr><th id="4161">4161</th><td><i>	 * Set GPHY Power Down Override to leave GPHY</i></td></tr>
<tr><th id="4162">4162</th><td><i>	 * powered up in D0 uninitialized.</i></td></tr>
<tr><th id="4163">4163</th><td><i>	 */</i></td></tr>
<tr><th id="4164">4164</th><td>	<b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="4165">4165</th><td>	    (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2665" title="0x00000008" data-ref="_M/BGEF_CPMU_PRESENT">BGEF_CPMU_PRESENT</a>) == <var>0</var>)</td></tr>
<tr><th id="4166">4166</th><td>		<a class="local col8 ref" href="#268reset" title='reset' data-ref="268reset" data-ref-filename="268reset">reset</a> |= <a class="macro" href="if_bgereg.h.html#2045" title="0x04000000" data-ref="_M/BGE_MISCCFG_GPHY_PD_OVERRIDE">BGE_MISCCFG_GPHY_PD_OVERRIDE</a>;</td></tr>
<tr><th id="4167">4167</th><td></td></tr>
<tr><th id="4168">4168</th><td>	<i>/* Issue global reset */</i></td></tr>
<tr><th id="4169">4169</th><td>	<a class="local col5 ref" href="#275write_op" title='write_op' data-ref="275write_op" data-ref-filename="275write_op">write_op</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>, <a class="local col8 ref" href="#268reset" title='reset' data-ref="268reset" data-ref-filename="268reset">reset</a>);</td></tr>
<tr><th id="4170">4170</th><td></td></tr>
<tr><th id="4171">4171</th><td>	<i>/* 5718 reset step 7, 57XX step 8 */</i></td></tr>
<tr><th id="4172">4172</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>)</td></tr>
<tr><th id="4173">4173</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(100*1000)" data-ref="_M/delay">delay</a>(<var>100</var>*<var>1000</var>); <i>/* too big */</i></td></tr>
<tr><th id="4174">4174</th><td>	<b>else</b></td></tr>
<tr><th id="4175">4175</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(1000)" data-ref="_M/delay">delay</a>(<var>1000</var>);</td></tr>
<tr><th id="4176">4176</th><td></td></tr>
<tr><th id="4177">4177</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a>) {</td></tr>
<tr><th id="4178">4178</th><td>		<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#311" title="0x4000" data-ref="_M/BGE_CHIPID_BCM5750_A0">BGE_CHIPID_BCM5750_A0</a>) {</td></tr>
<tr><th id="4179">4179</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(500000)" data-ref="_M/DELAY">DELAY</a>(<var>500000</var>);</td></tr>
<tr><th id="4180">4180</th><td>			<i>/* XXX: Magic Numbers */</i></td></tr>
<tr><th id="4181">4181</th><td>			<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="4182">4182</th><td>			    <a class="macro" href="if_bgereg.h.html#252" title="0xC4" data-ref="_M/BGE_PCI_UNKNOWN0">BGE_PCI_UNKNOWN0</a>);</td></tr>
<tr><th id="4183">4183</th><td>			<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="4184">4184</th><td>			    <a class="macro" href="if_bgereg.h.html#252" title="0xC4" data-ref="_M/BGE_PCI_UNKNOWN0">BGE_PCI_UNKNOWN0</a>,</td></tr>
<tr><th id="4185">4185</th><td>			    <a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> | (<var>1</var> &lt;&lt; <var>15</var>));</td></tr>
<tr><th id="4186">4186</th><td>		}</td></tr>
<tr><th id="4187">4187</th><td>		<a class="local col1 ref" href="#271devctl" title='devctl' data-ref="271devctl" data-ref-filename="271devctl">devctl</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="4188">4188</th><td>		    <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a> + <a class="macro" href="pcireg.h.html#982" title="0x08" data-ref="_M/PCIE_DCSR">PCIE_DCSR</a>);</td></tr>
<tr><th id="4189">4189</th><td>		<i>/* Clear enable no snoop and disable relaxed ordering. */</i></td></tr>
<tr><th id="4190">4190</th><td>		<a class="local col1 ref" href="#271devctl" title='devctl' data-ref="271devctl" data-ref-filename="271devctl">devctl</a> &amp;= ~(<a class="macro" href="pcireg.h.html#987" title="(((uintmax_t)(4) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((4) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_ENA_RELAX_ORD">PCIE_DCSR_ENA_RELAX_ORD</a> |</td></tr>
<tr><th id="4191">4191</th><td>		    <a class="macro" href="pcireg.h.html#992" title="(((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_ENA_NO_SNOOP">PCIE_DCSR_ENA_NO_SNOOP</a>);</td></tr>
<tr><th id="4192">4192</th><td></td></tr>
<tr><th id="4193">4193</th><td>		<i>/* Set PCIE max payload size to 128 for older PCIe devices */</i></td></tr>
<tr><th id="4194">4194</th><td>		<b>if</b> ((<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2665" title="0x00000008" data-ref="_M/BGEF_CPMU_PRESENT">BGEF_CPMU_PRESENT</a>) == <var>0</var>)</td></tr>
<tr><th id="4195">4195</th><td>			<a class="local col1 ref" href="#271devctl" title='devctl' data-ref="271devctl" data-ref-filename="271devctl">devctl</a> &amp;= ~(<var>0x00e0</var>);</td></tr>
<tr><th id="4196">4196</th><td>		<i>/* Clear device status register. Write 1b to clear */</i></td></tr>
<tr><th id="4197">4197</th><td>		<a class="local col1 ref" href="#271devctl" title='devctl' data-ref="271devctl" data-ref-filename="271devctl">devctl</a> |= <a class="macro" href="pcireg.h.html#999" title="(((uintmax_t)(3 + 16) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((3 + 16) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_URD">PCIE_DCSR_URD</a> | <a class="macro" href="pcireg.h.html#998" title="(((uintmax_t)(2 + 16) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2 + 16) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_FED">PCIE_DCSR_FED</a></td></tr>
<tr><th id="4198">4198</th><td>		    | <a class="macro" href="pcireg.h.html#997" title="(((uintmax_t)(1 + 16) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((1 + 16) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_NFED">PCIE_DCSR_NFED</a> | <a class="macro" href="pcireg.h.html#996" title="(((uintmax_t)(0 + 16) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((0 + 16) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/PCIE_DCSR_CED">PCIE_DCSR_CED</a>;</td></tr>
<tr><th id="4199">4199</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="4200">4200</th><td>		    <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pciecap" title='bge_softc::bge_pciecap' data-ref="bge_softc::bge_pciecap" data-ref-filename="bge_softc..bge_pciecap">bge_pciecap</a> + <a class="macro" href="pcireg.h.html#982" title="0x08" data-ref="_M/PCIE_DCSR">PCIE_DCSR</a>, <a class="local col1 ref" href="#271devctl" title='devctl' data-ref="271devctl" data-ref-filename="271devctl">devctl</a>);</td></tr>
<tr><th id="4201">4201</th><td>		<a class="tu ref fn" href="#bge_set_max_readrq" title='bge_set_max_readrq' data-use='c' data-ref="bge_set_max_readrq" data-ref-filename="bge_set_max_readrq">bge_set_max_readrq</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>);</td></tr>
<tr><th id="4202">4202</th><td>	}</td></tr>
<tr><th id="4203">4203</th><td></td></tr>
<tr><th id="4204">4204</th><td>	<i>/* From Linux: dummy read to flush PCI posted writes */</i></td></tr>
<tr><th id="4205">4205</th><td>	<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#166" title="0x04" data-ref="_M/BGE_PCI_CMD">BGE_PCI_CMD</a>);</td></tr>
<tr><th id="4206">4206</th><td></td></tr>
<tr><th id="4207">4207</th><td>	<i>/*</i></td></tr>
<tr><th id="4208">4208</th><td><i>	 * Reset some of the PCI state that got zapped by reset</i></td></tr>
<tr><th id="4209">4209</th><td><i>	 * To modify the PCISTATE register, BGE_PCIMISCCTL_PCISTATE_RW must be</i></td></tr>
<tr><th id="4210">4210</th><td><i>	 * set, too.</i></td></tr>
<tr><th id="4211">4211</th><td><i>	 */</i></td></tr>
<tr><th id="4212">4212</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>,</td></tr>
<tr><th id="4213">4213</th><td>	    <a class="macro" href="if_bgereg.h.html#262" title="0x00000080" data-ref="_M/BGE_PCIMISCCTL_INDIRECT_ACCESS">BGE_PCIMISCCTL_INDIRECT_ACCESS</a> | <a class="macro" href="if_bgereg.h.html#256" title="0x00000002" data-ref="_M/BGE_PCIMISCCTL_MASK_PCI_INTR">BGE_PCIMISCCTL_MASK_PCI_INTR</a> |</td></tr>
<tr><th id="4214">4214</th><td>	    <a class="macro" href="if_bgereg.h.html#267" title="(0x00000008)" data-ref="_M/BGE_HIF_SWAP_OPTIONS">BGE_HIF_SWAP_OPTIONS</a> | <a class="macro" href="if_bgereg.h.html#259" title="0x00000010" data-ref="_M/BGE_PCIMISCCTL_PCISTATE_RW">BGE_PCIMISCCTL_PCISTATE_RW</a>);</td></tr>
<tr><th id="4215">4215</th><td>	<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = <a class="macro" href="if_bgereg.h.html#448" title="0x00000020" data-ref="_M/BGE_PCISTATE_ROM_ENABLE">BGE_PCISTATE_ROM_ENABLE</a> | <a class="macro" href="if_bgereg.h.html#449" title="0x00000040" data-ref="_M/BGE_PCISTATE_ROM_RETRY_ENABLE">BGE_PCISTATE_ROM_RETRY_ENABLE</a>;</td></tr>
<tr><th id="4216">4216</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#302" title="0x2000" data-ref="_M/BGE_CHIPID_BCM5704_A0">BGE_CHIPID_BCM5704_A0</a> &amp;&amp;</td></tr>
<tr><th id="4217">4217</th><td>	    (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>) != <var>0</var>)</td></tr>
<tr><th id="4218">4218</th><td>		<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> |= <a class="macro" href="if_bgereg.h.html#452" title="0x00002000" data-ref="_M/BGE_PCISTATE_RETRY_SAME_DMA">BGE_PCISTATE_RETRY_SAME_DMA</a>;</td></tr>
<tr><th id="4219">4219</th><td>	<b>if</b> ((<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mfw_flags" title='bge_softc::bge_mfw_flags' data-ref="bge_softc::bge_mfw_flags" data-ref-filename="bge_softc..bge_mfw_flags">bge_mfw_flags</a> &amp; <a class="macro" href="if_bgevar.h.html#291" title="0x00000002" data-ref="_M/BGE_MFW_ON_APE">BGE_MFW_ON_APE</a>) != <var>0</var>)</td></tr>
<tr><th id="4220">4220</th><td>		<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> |= <a class="macro" href="if_bgereg.h.html#453" title="0x00010000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_CTLSPC_WR">BGE_PCISTATE_ALLOW_APE_CTLSPC_WR</a> |</td></tr>
<tr><th id="4221">4221</th><td>		    <a class="macro" href="if_bgereg.h.html#454" title="0x00020000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_SHMEM_WR">BGE_PCISTATE_ALLOW_APE_SHMEM_WR</a> |</td></tr>
<tr><th id="4222">4222</th><td>		    <a class="macro" href="if_bgereg.h.html#455" title="0x00040000" data-ref="_M/BGE_PCISTATE_ALLOW_APE_PSPACE_WR">BGE_PCISTATE_ALLOW_APE_PSPACE_WR</a>;</td></tr>
<tr><th id="4223">4223</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#231" title="0x70" data-ref="_M/BGE_PCI_PCISTATE">BGE_PCI_PCISTATE</a>, <a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a>);</td></tr>
<tr><th id="4224">4224</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#170" title="0x0C" data-ref="_M/BGE_PCI_CACHESZ">BGE_PCI_CACHESZ</a>, <a class="local col6 ref" href="#266cachesize" title='cachesize' data-ref="266cachesize" data-ref-filename="266cachesize">cachesize</a>);</td></tr>
<tr><th id="4225">4225</th><td>	<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#166" title="0x04" data-ref="_M/BGE_PCI_CMD">BGE_PCI_CMD</a>, <a class="local col7 ref" href="#267command" title='command' data-ref="267command" data-ref-filename="267command">command</a>);</td></tr>
<tr><th id="4226">4226</th><td></td></tr>
<tr><th id="4227">4227</th><td>	<i>/* 57xx step 11: disable PCI-X Relaxed Ordering. */</i></td></tr>
<tr><th id="4228">4228</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2668" title="0x00000040" data-ref="_M/BGEF_PCIX">BGEF_PCIX</a>) {</td></tr>
<tr><th id="4229">4229</th><td>		<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pcixcap" title='bge_softc::bge_pcixcap' data-ref="bge_softc::bge_pcixcap" data-ref-filename="bge_softc..bge_pcixcap">bge_pcixcap</a></td></tr>
<tr><th id="4230">4230</th><td>		    + <a class="macro" href="pcireg.h.html#724" title="0x00" data-ref="_M/PCIX_CMD">PCIX_CMD</a>);</td></tr>
<tr><th id="4231">4231</th><td>		<i>/* Set max memory read byte count to 2K */</i></td></tr>
<tr><th id="4232">4232</th><td>		<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#359" title="0x01" data-ref="_M/BGE_ASICREV_BCM5703">BGE_ASICREV_BCM5703</a>) {</td></tr>
<tr><th id="4233">4233</th><td>			<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> &amp;= ~<a class="macro" href="pcireg.h.html#727" title="0x000c0000" data-ref="_M/PCIX_CMD_BYTECNT_MASK">PCIX_CMD_BYTECNT_MASK</a>;</td></tr>
<tr><th id="4234">4234</th><td>			<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> |= <a class="macro" href="pcireg.h.html#733" title="0x00080000" data-ref="_M/PCIX_CMD_BCNT_2048">PCIX_CMD_BCNT_2048</a>;</td></tr>
<tr><th id="4235">4235</th><td>		} <b>else</b> <b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>){</td></tr>
<tr><th id="4236">4236</th><td>			<i>/*</i></td></tr>
<tr><th id="4237">4237</th><td><i>			 * For 5704, set max outstanding split transaction</i></td></tr>
<tr><th id="4238">4238</th><td><i>			 * field to 0 (0 means it supports 1 request)</i></td></tr>
<tr><th id="4239">4239</th><td><i>			 */</i></td></tr>
<tr><th id="4240">4240</th><td>			<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> &amp;= ~(<a class="macro" href="pcireg.h.html#735" title="0x00700000" data-ref="_M/PCIX_CMD_SPLTRANS_MASK">PCIX_CMD_SPLTRANS_MASK</a></td></tr>
<tr><th id="4241">4241</th><td>			    | <a class="macro" href="pcireg.h.html#727" title="0x000c0000" data-ref="_M/PCIX_CMD_BYTECNT_MASK">PCIX_CMD_BYTECNT_MASK</a>);</td></tr>
<tr><th id="4242">4242</th><td>			<a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> |= <a class="macro" href="pcireg.h.html#733" title="0x00080000" data-ref="_M/PCIX_CMD_BCNT_2048">PCIX_CMD_BCNT_2048</a>;</td></tr>
<tr><th id="4243">4243</th><td>		}</td></tr>
<tr><th id="4244">4244</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pcixcap" title='bge_softc::bge_pcixcap' data-ref="bge_softc::bge_pcixcap" data-ref-filename="bge_softc..bge_pcixcap">bge_pcixcap</a></td></tr>
<tr><th id="4245">4245</th><td>		    + <a class="macro" href="pcireg.h.html#724" title="0x00" data-ref="_M/PCIX_CMD">PCIX_CMD</a>, <a class="local col2 ref" href="#272reg" title='reg' data-ref="272reg" data-ref-filename="272reg">reg</a> &amp; ~<a class="macro" href="pcireg.h.html#726" title="0x00020000" data-ref="_M/PCIX_CMD_RELAXED_ORDER">PCIX_CMD_RELAXED_ORDER</a>);</td></tr>
<tr><th id="4246">4246</th><td>	}</td></tr>
<tr><th id="4247">4247</th><td></td></tr>
<tr><th id="4248">4248</th><td>	<i>/* 5718 reset step 10, 57XX step 12 */</i></td></tr>
<tr><th id="4249">4249</th><td>	<i>/* Enable memory arbiter. */</i></td></tr>
<tr><th id="4250">4250</th><td>	<b>if</b> (<a class="macro" href="#412" title="((sc)-&gt;bge_flags &amp; 0x00010000)" data-ref="_M/BGE_IS_5714_FAMILY">BGE_IS_5714_FAMILY</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>)) {</td></tr>
<tr><th id="4251">4251</th><td>		<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4000)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1402" title="0x4000" data-ref="_M/BGE_MARB_MODE">BGE_MARB_MODE</a>);</td></tr>
<tr><th id="4252">4252</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4000, 0x00000002 | val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1402" title="0x4000" data-ref="_M/BGE_MARB_MODE">BGE_MARB_MODE</a>, <a class="macro" href="if_bgereg.h.html#1409" title="0x00000002" data-ref="_M/BGE_MARBMODE_ENABLE">BGE_MARBMODE_ENABLE</a> | <a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a>);</td></tr>
<tr><th id="4253">4253</th><td>	} <b>else</b></td></tr>
<tr><th id="4254">4254</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4000, 0x00000002)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1402" title="0x4000" data-ref="_M/BGE_MARB_MODE">BGE_MARB_MODE</a>, <a class="macro" href="if_bgereg.h.html#1409" title="0x00000002" data-ref="_M/BGE_MARBMODE_ENABLE">BGE_MARBMODE_ENABLE</a>);</td></tr>
<tr><th id="4255">4255</th><td></td></tr>
<tr><th id="4256">4256</th><td>	<i>/* XXX 5721, 5751 and 5752 */</i></td></tr>
<tr><th id="4257">4257</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#362" title="0x04" data-ref="_M/BGE_ASICREV_BCM5750">BGE_ASICREV_BCM5750</a>) {</td></tr>
<tr><th id="4258">4258</th><td>		<i>/* Step 19: */</i></td></tr>
<tr><th id="4259">4259</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00) | (1 &lt;&lt; 29 | 1 &lt;&lt; 25)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a>, <var>1</var> &lt;&lt; <var>29</var> | <var>1</var> &lt;&lt; <var>25</var>);</td></tr>
<tr><th id="4260">4260</th><td>		<i>/* Step 20: */</i></td></tr>
<tr><th id="4261">4261</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00) | (0x02000000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a>, <a class="macro" href="if_bgereg.h.html#1973" title="0x02000000" data-ref="_M/BGE_TLP_DATA_FIFO_PROTECT">BGE_TLP_DATA_FIFO_PROTECT</a>);</td></tr>
<tr><th id="4262">4262</th><td>	}</td></tr>
<tr><th id="4263">4263</th><td></td></tr>
<tr><th id="4264">4264</th><td>	<i>/* 5718 reset step 12, 57XX step 15 and 16 */</i></td></tr>
<tr><th id="4265">4265</th><td>	<i>/* Fix up byte swapping */</i></td></tr>
<tr><th id="4266">4266</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, 0x00000004| 0x00000010|0x00000020)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#269" title="0x00000004| 0x00000010|0x00000020" data-ref="_M/BGE_DMA_SWAP_OPTIONS">BGE_DMA_SWAP_OPTIONS</a>);</td></tr>
<tr><th id="4267">4267</th><td></td></tr>
<tr><th id="4268">4268</th><td>	<i>/* 5718 reset step 13, 57XX step 17 */</i></td></tr>
<tr><th id="4269">4269</th><td>	<i>/* Poll until the firmware initialization is complete */</i></td></tr>
<tr><th id="4270">4270</th><td>	<a class="tu ref fn" href="#bge_poll_fw" title='bge_poll_fw' data-use='c' data-ref="bge_poll_fw" data-ref-filename="bge_poll_fw">bge_poll_fw</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>);</td></tr>
<tr><th id="4271">4271</th><td></td></tr>
<tr><th id="4272">4272</th><td>	<i>/* 57XX step 21 */</i></td></tr>
<tr><th id="4273">4273</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#391" title="0x21" data-ref="_M/BGE_CHIPREV_5704_BX">BGE_CHIPREV_5704_BX</a>) {</td></tr>
<tr><th id="4274">4274</th><td>		<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a> <dfn class="local col6 decl" id="276msidata" title='msidata' data-type='pcireg_t' data-ref="276msidata" data-ref-filename="276msidata">msidata</dfn>;</td></tr>
<tr><th id="4275">4275</th><td></td></tr>
<tr><th id="4276">4276</th><td>		<a class="local col6 ref" href="#276msidata" title='msidata' data-ref="276msidata" data-ref-filename="276msidata">msidata</a> = <a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_read" title='pci_conf_read' data-ref="pci_conf_read" data-ref-filename="pci_conf_read">pci_conf_read</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="4277">4277</th><td>		    <a class="macro" href="if_bgereg.h.html#204" title="0x64" data-ref="_M/BGE_PCI_MSI_DATA">BGE_PCI_MSI_DATA</a>);</td></tr>
<tr><th id="4278">4278</th><td>		<a class="local col6 ref" href="#276msidata" title='msidata' data-ref="276msidata" data-ref-filename="276msidata">msidata</a> |= ((<var>1</var> &lt;&lt; <var>13</var> | <var>1</var> &lt;&lt; <var>12</var> | <var>1</var> &lt;&lt; <var>10</var>) &lt;&lt; <var>16</var>);</td></tr>
<tr><th id="4279">4279</th><td>		<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>, <a class="macro" href="if_bgereg.h.html#204" title="0x64" data-ref="_M/BGE_PCI_MSI_DATA">BGE_PCI_MSI_DATA</a>,</td></tr>
<tr><th id="4280">4280</th><td>		    <a class="local col6 ref" href="#276msidata" title='msidata' data-ref="276msidata" data-ref-filename="276msidata">msidata</a>);</td></tr>
<tr><th id="4281">4281</th><td>	}</td></tr>
<tr><th id="4282">4282</th><td></td></tr>
<tr><th id="4283">4283</th><td>	<i>/* 57XX step 18 */</i></td></tr>
<tr><th id="4284">4284</th><td>	<i>/* Write mac mode. */</i></td></tr>
<tr><th id="4285">4285</th><td>	<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>);</td></tr>
<tr><th id="4286">4286</th><td>	<i>/* Restore mac_mode_mask's bits using mac_mode */</i></td></tr>
<tr><th id="4287">4287</th><td>	<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> = (<a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a> &amp; ~<a class="local col0 ref" href="#270mac_mode_mask" title='mac_mode_mask' data-ref="270mac_mode_mask" data-ref-filename="270mac_mode_mask">mac_mode_mask</a>) | <a class="local col9 ref" href="#269mac_mode" title='mac_mode' data-ref="269mac_mode" data-ref-filename="269mac_mode">mac_mode</a>;</td></tr>
<tr><th id="4288">4288</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, val); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>, <a class="local col4 ref" href="#274val" title='val' data-ref="274val" data-ref-filename="274val">val</a>);</td></tr>
<tr><th id="4289">4289</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="4290">4290</th><td></td></tr>
<tr><th id="4291">4291</th><td>	<a class="tu ref fn" href="#bge_ape_unlock" title='bge_ape_unlock' data-use='c' data-ref="bge_ape_unlock" data-ref-filename="bge_ape_unlock">bge_ape_unlock</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#2215" title="1" data-ref="_M/BGE_APE_LOCK_GRC">BGE_APE_LOCK_GRC</a>);</td></tr>
<tr><th id="4292">4292</th><td></td></tr>
<tr><th id="4293">4293</th><td>	<i>/*</i></td></tr>
<tr><th id="4294">4294</th><td><i>	 * The 5704 in TBI mode apparently needs some special</i></td></tr>
<tr><th id="4295">4295</th><td><i>	 * adjustment to insure the SERDES drive level is set</i></td></tr>
<tr><th id="4296">4296</th><td><i>	 * to 1.2V.</i></td></tr>
<tr><th id="4297">4297</th><td><i>	 */</i></td></tr>
<tr><th id="4298">4298</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a> &amp;&amp;</td></tr>
<tr><th id="4299">4299</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>) {</td></tr>
<tr><th id="4300">4300</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="277serdescfg" title='serdescfg' data-type='uint32_t' data-ref="277serdescfg" data-ref-filename="277serdescfg">serdescfg</dfn>;</td></tr>
<tr><th id="4301">4301</th><td></td></tr>
<tr><th id="4302">4302</th><td>		<a class="local col7 ref" href="#277serdescfg" title='serdescfg' data-ref="277serdescfg" data-ref-filename="277serdescfg">serdescfg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0590)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#691" title="0x0590" data-ref="_M/BGE_SERDES_CFG">BGE_SERDES_CFG</a>);</td></tr>
<tr><th id="4303">4303</th><td>		<a class="local col7 ref" href="#277serdescfg" title='serdescfg' data-ref="277serdescfg" data-ref-filename="277serdescfg">serdescfg</a> = (<a class="local col7 ref" href="#277serdescfg" title='serdescfg' data-ref="277serdescfg" data-ref-filename="277serdescfg">serdescfg</a> &amp; ~<var>0xFFF</var>) | <var>0x880</var>;</td></tr>
<tr><th id="4304">4304</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0590, serdescfg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#691" title="0x0590" data-ref="_M/BGE_SERDES_CFG">BGE_SERDES_CFG</a>, <a class="local col7 ref" href="#277serdescfg" title='serdescfg' data-ref="277serdescfg" data-ref-filename="277serdescfg">serdescfg</a>);</td></tr>
<tr><th id="4305">4305</th><td>	}</td></tr>
<tr><th id="4306">4306</th><td></td></tr>
<tr><th id="4307">4307</th><td>	<b>if</b> (<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2669" title="0x00000080" data-ref="_M/BGEF_PCIE">BGEF_PCIE</a> &amp;&amp;</td></tr>
<tr><th id="4308">4308</th><td>	    !<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>) &amp;&amp;</td></tr>
<tr><th id="4309">4309</th><td>	    <a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#311" title="0x4000" data-ref="_M/BGE_CHIPID_BCM5750_A0">BGE_CHIPID_BCM5750_A0</a> &amp;&amp;</td></tr>
<tr><th id="4310">4310</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#375" title="0x5785" data-ref="_M/BGE_ASICREV_BCM5785">BGE_ASICREV_BCM5785</a>) {</td></tr>
<tr><th id="4311">4311</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="278v" title='v' data-type='uint32_t' data-ref="278v" data-ref-filename="278v">v</dfn>;</td></tr>
<tr><th id="4312">4312</th><td></td></tr>
<tr><th id="4313">4313</th><td>		<i>/* Enable PCI Express bug fix */</i></td></tr>
<tr><th id="4314">4314</th><td>		<a class="local col8 ref" href="#278v" title='v' data-ref="278v" data-ref-filename="278v">v</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a>);</td></tr>
<tr><th id="4315">4315</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7c00, v | 0x02000000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1965" title="0x7c00" data-ref="_M/BGE_TLP_CONTROL_REG">BGE_TLP_CONTROL_REG</a>,</td></tr>
<tr><th id="4316">4316</th><td>		    <a class="local col8 ref" href="#278v" title='v' data-ref="278v" data-ref-filename="278v">v</a> | <a class="macro" href="if_bgereg.h.html#1973" title="0x02000000" data-ref="_M/BGE_TLP_DATA_FIFO_PROTECT">BGE_TLP_DATA_FIFO_PROTECT</a>);</td></tr>
<tr><th id="4317">4317</th><td>	}</td></tr>
<tr><th id="4318">4318</th><td></td></tr>
<tr><th id="4319">4319</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a>)</td></tr>
<tr><th id="4320">4320</th><td>		<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3624, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3624) &amp; ~(0x80000000)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col5 ref" href="#265sc" title='sc' data-ref="265sc" data-ref-filename="265sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1239" title="0x3624" data-ref="_M/BGE_CPMU_CLCK_ORIDE">BGE_CPMU_CLCK_ORIDE</a>,</td></tr>
<tr><th id="4321">4321</th><td>		    <a class="macro" href="if_bgereg.h.html#1269" title="0x80000000" data-ref="_M/CPMU_CLCK_ORIDE_MAC_ORIDE_EN">CPMU_CLCK_ORIDE_MAC_ORIDE_EN</a>);</td></tr>
<tr><th id="4322">4322</th><td></td></tr>
<tr><th id="4323">4323</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="4324">4324</th><td>}</td></tr>
<tr><th id="4325">4325</th><td></td></tr>
<tr><th id="4326">4326</th><td><i  data-doc="bge_rxeof">/*</i></td></tr>
<tr><th id="4327">4327</th><td><i  data-doc="bge_rxeof"> * Frame reception handling. This is called if there's a frame</i></td></tr>
<tr><th id="4328">4328</th><td><i  data-doc="bge_rxeof"> * on the receive return list.</i></td></tr>
<tr><th id="4329">4329</th><td><i  data-doc="bge_rxeof"> *</i></td></tr>
<tr><th id="4330">4330</th><td><i  data-doc="bge_rxeof"> * Note: we have to be able to handle two possibilities here:</i></td></tr>
<tr><th id="4331">4331</th><td><i  data-doc="bge_rxeof"> * 1) the frame is from the jumbo receive ring</i></td></tr>
<tr><th id="4332">4332</th><td><i  data-doc="bge_rxeof"> * 2) the frame is from the standard receive ring</i></td></tr>
<tr><th id="4333">4333</th><td><i  data-doc="bge_rxeof"> */</i></td></tr>
<tr><th id="4334">4334</th><td></td></tr>
<tr><th id="4335">4335</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4336">4336</th><td><dfn class="tu decl def fn" id="bge_rxeof" title='bge_rxeof' data-type='void bge_rxeof(struct bge_softc * sc)' data-ref="bge_rxeof" data-ref-filename="bge_rxeof">bge_rxeof</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col9 decl" id="279sc" title='sc' data-type='struct bge_softc *' data-ref="279sc" data-ref-filename="279sc">sc</dfn>)</td></tr>
<tr><th id="4337">4337</th><td>{</td></tr>
<tr><th id="4338">4338</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col0 decl" id="280ifp" title='ifp' data-type='struct ifnet *' data-ref="280ifp" data-ref-filename="280ifp">ifp</dfn>;</td></tr>
<tr><th id="4339">4339</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> <dfn class="local col1 decl" id="281rx_prod" title='rx_prod' data-type='uint16_t' data-ref="281rx_prod" data-ref-filename="281rx_prod">rx_prod</dfn>, <dfn class="local col2 decl" id="282rx_cons" title='rx_cons' data-type='uint16_t' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</dfn>;</td></tr>
<tr><th id="4340">4340</th><td>	<em>int</em> <dfn class="local col3 decl" id="283stdcnt" title='stdcnt' data-type='int' data-ref="283stdcnt" data-ref-filename="283stdcnt">stdcnt</dfn> = <var>0</var>, <dfn class="local col4 decl" id="284jumbocnt" title='jumbocnt' data-type='int' data-ref="284jumbocnt" data-ref-filename="284jumbocnt">jumbocnt</dfn> = <var>0</var>;</td></tr>
<tr><th id="4341">4341</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dmamap_t" title='bus_dmamap_t' data-type='struct x86_bus_dmamap *' data-ref="bus_dmamap_t" data-ref-filename="bus_dmamap_t">bus_dmamap_t</a> <dfn class="local col5 decl" id="285dmamap" title='dmamap' data-type='bus_dmamap_t' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</dfn>;</td></tr>
<tr><th id="4342">4342</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a> <dfn class="local col6 decl" id="286offset" title='offset' data-type='bus_addr_t' data-ref="286offset" data-ref-filename="286offset">offset</dfn>, <dfn class="local col7 decl" id="287toff" title='toff' data-type='bus_addr_t' data-ref="287toff" data-ref-filename="287toff">toff</dfn>;</td></tr>
<tr><th id="4343">4343</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_size_t" title='bus_size_t' data-type='size_t' data-ref="bus_size_t" data-ref-filename="bus_size_t">bus_size_t</a> <dfn class="local col8 decl" id="288tlen" title='tlen' data-type='bus_size_t' data-ref="288tlen" data-ref-filename="288tlen">tlen</dfn>;</td></tr>
<tr><th id="4344">4344</th><td>	<em>int</em> <dfn class="local col9 decl" id="289tosync" title='tosync' data-type='int' data-ref="289tosync" data-ref-filename="289tosync">tosync</dfn>;</td></tr>
<tr><th id="4345">4345</th><td></td></tr>
<tr><th id="4346">4346</th><td>	<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a> = <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_saved_considx" title='bge_softc::bge_rx_saved_considx' data-ref="bge_softc::bge_rx_saved_considx" data-ref-filename="bge_softc..bge_rx_saved_considx">bge_rx_saved_considx</a>;</td></tr>
<tr><th id="4347">4347</th><td>	<a class="local col1 ref" href="#281rx_prod" title='rx_prod' data-ref="281rx_prod" data-ref-filename="281rx_prod">rx_prod</a> = <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_idx" title='bge_status_block::bge_idx' data-ref="bge_status_block::bge_idx" data-ref-filename="bge_status_block..bge_idx">bge_idx</a>[<var>0</var>].<a class="ref field" href="if_bgereg.h.html#bge_sts_idx::bge_rx_prod_idx" title='bge_sts_idx::bge_rx_prod_idx' data-ref="bge_sts_idx::bge_rx_prod_idx" data-ref-filename="bge_sts_idx..bge_rx_prod_idx">bge_rx_prod_idx</a>;</td></tr>
<tr><th id="4348">4348</th><td></td></tr>
<tr><th id="4349">4349</th><td>	<i>/* Nothing to do */</i></td></tr>
<tr><th id="4350">4350</th><td>	<b>if</b> (<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a> == <a class="local col1 ref" href="#281rx_prod" title='rx_prod' data-ref="281rx_prod" data-ref-filename="281rx_prod">rx_prod</a>)</td></tr>
<tr><th id="4351">4351</th><td>		<b>return</b>;</td></tr>
<tr><th id="4352">4352</th><td></td></tr>
<tr><th id="4353">4353</th><td>	<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a> = &amp;<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="4354">4354</th><td></td></tr>
<tr><th id="4355">4355</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4356">4356</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_status_block)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_status_block),</td></tr>
<tr><th id="4357">4357</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_status_block" title='bge_status_block' data-ref="bge_status_block" data-ref-filename="bge_status_block">bge_status_block</a>),</td></tr>
<tr><th id="4358">4358</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4359">4359</th><td></td></tr>
<tr><th id="4360">4360</th><td>	<a class="local col6 ref" href="#286offset" title='offset' data-ref="286offset" data-ref-filename="286offset">offset</a> = <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_rx_return_ring)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_rx_return_ring);</td></tr>
<tr><th id="4361">4361</th><td>	<a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a> = <a class="local col1 ref" href="#281rx_prod" title='rx_prod' data-ref="281rx_prod" data-ref-filename="281rx_prod">rx_prod</a> - <a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a>;</td></tr>
<tr><th id="4362">4362</th><td></td></tr>
<tr><th id="4363">4363</th><td>	<b>if</b> (<a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a> != <var>0</var>)</td></tr>
<tr><th id="4364">4364</th><td>		<a class="ref fn" href="../../sys/rndsource.h.html#rnd_add_uint32" title='rnd_add_uint32' data-ref="rnd_add_uint32" data-ref-filename="rnd_add_uint32">rnd_add_uint32</a>(&amp;<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::rnd_source" title='bge_softc::rnd_source' data-ref="bge_softc::rnd_source" data-ref-filename="bge_softc..rnd_source">rnd_source</a>, <a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a>);</td></tr>
<tr><th id="4365">4365</th><td></td></tr>
<tr><th id="4366">4366</th><td>	<a class="local col7 ref" href="#287toff" title='toff' data-ref="287toff" data-ref-filename="287toff">toff</a> = <a class="local col6 ref" href="#286offset" title='offset' data-ref="286offset" data-ref-filename="286offset">offset</a> + (<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>));</td></tr>
<tr><th id="4367">4367</th><td></td></tr>
<tr><th id="4368">4368</th><td>	<b>if</b> (<a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="4369">4369</th><td>		<a class="local col8 ref" href="#288tlen" title='tlen' data-ref="288tlen" data-ref-filename="288tlen">tlen</a> = (<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a> - <a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a>) *</td></tr>
<tr><th id="4370">4370</th><td>		    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>);</td></tr>
<tr><th id="4371">4371</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4372">4372</th><td>		    <a class="local col7 ref" href="#287toff" title='toff' data-ref="287toff" data-ref-filename="287toff">toff</a>, <a class="local col8 ref" href="#288tlen" title='tlen' data-ref="288tlen" data-ref-filename="288tlen">tlen</a>, <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4373">4373</th><td>		<a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a> = -<a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a>;</td></tr>
<tr><th id="4374">4374</th><td>	}</td></tr>
<tr><th id="4375">4375</th><td></td></tr>
<tr><th id="4376">4376</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4377">4377</th><td>	    <a class="local col6 ref" href="#286offset" title='offset' data-ref="286offset" data-ref-filename="286offset">offset</a>, <a class="local col9 ref" href="#289tosync" title='tosync' data-ref="289tosync" data-ref-filename="289tosync">tosync</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>),</td></tr>
<tr><th id="4378">4378</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4379">4379</th><td></td></tr>
<tr><th id="4380">4380</th><td>	<b>while</b> (<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a> != <a class="local col1 ref" href="#281rx_prod" title='rx_prod' data-ref="281rx_prod" data-ref-filename="281rx_prod">rx_prod</a>) {</td></tr>
<tr><th id="4381">4381</th><td>		<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a>	*<dfn class="local col0 decl" id="290cur_rx" title='cur_rx' data-type='struct bge_rx_bd *' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</dfn>;</td></tr>
<tr><th id="4382">4382</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col1 decl" id="291rxidx" title='rxidx' data-type='uint32_t' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</dfn>;</td></tr>
<tr><th id="4383">4383</th><td>		<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a>		*<dfn class="local col2 decl" id="292m" title='m' data-type='struct mbuf *' data-ref="292m" data-ref-filename="292m">m</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4384">4384</th><td></td></tr>
<tr><th id="4385">4385</th><td>		<a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a> = &amp;<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_rx_return_ring" title='bge_ring_data::bge_rx_return_ring' data-ref="bge_ring_data::bge_rx_return_ring" data-ref-filename="bge_ring_data..bge_rx_return_ring">bge_rx_return_ring</a>[<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a>];</td></tr>
<tr><th id="4386">4386</th><td></td></tr>
<tr><th id="4387">4387</th><td>		<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a> = <a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_idx" title='bge_rx_bd::bge_idx' data-ref="bge_rx_bd::bge_idx" data-ref-filename="bge_rx_bd..bge_idx">bge_idx</a>;</td></tr>
<tr><th id="4388">4388</th><td>		<a class="macro" href="if_bgevar.h.html#90" title="(rx_cons) = (rx_cons + 1) % sc-&gt;bge_return_ring_cnt" data-ref="_M/BGE_INC">BGE_INC</a>(<a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_return_ring_cnt" title='bge_softc::bge_return_ring_cnt' data-ref="bge_softc::bge_return_ring_cnt" data-ref-filename="bge_softc..bge_return_ring_cnt">bge_return_ring_cnt</a>);</td></tr>
<tr><th id="4389">4389</th><td></td></tr>
<tr><th id="4390">4390</th><td>		<b>if</b> (<a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2319" title="0x0020" data-ref="_M/BGE_RXBDFLAG_JUMBO_RING">BGE_RXBDFLAG_JUMBO_RING</a>) {</td></tr>
<tr><th id="4391">4391</th><td>			<a class="macro" href="if_bgevar.h.html#90" title="(sc-&gt;bge_jumbo) = (sc-&gt;bge_jumbo + 1) % 256" data-ref="_M/BGE_INC">BGE_INC</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>, <a class="macro" href="if_bgereg.h.html#2448" title="256" data-ref="_M/BGE_JUMBO_RX_RING_CNT">BGE_JUMBO_RX_RING_CNT</a>);</td></tr>
<tr><th id="4392">4392</th><td>			<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a> = <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>];</td></tr>
<tr><th id="4393">4393</th><td>			<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_chain" title='bge_chain_data::bge_rx_jumbo_chain' data-ref="bge_chain_data::bge_rx_jumbo_chain" data-ref-filename="bge_chain_data..bge_rx_jumbo_chain">bge_rx_jumbo_chain</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4394">4394</th><td>			<a class="local col4 ref" href="#284jumbocnt" title='jumbocnt' data-ref="284jumbocnt" data-ref-filename="284jumbocnt">jumbocnt</a>++;</td></tr>
<tr><th id="4395">4395</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>,</td></tr>
<tr><th id="4396">4396</th><td>			    <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_jumbo_map" title='bge_chain_data::bge_rx_jumbo_map' data-ref="bge_chain_data::bge_rx_jumbo_map" data-ref-filename="bge_chain_data..bge_rx_jumbo_map">bge_rx_jumbo_map</a>,</td></tr>
<tr><th id="4397">4397</th><td>			    <a class="macro" href="../../sys/mbuf.h.html#147" title="((char *)((m)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <em>char</em> *) - (<em>char</em> *)<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_jumbo_buf" title='bge_chain_data::bge_jumbo_buf' data-ref="bge_chain_data::bge_jumbo_buf" data-ref-filename="bge_chain_data..bge_jumbo_buf">bge_jumbo_buf</a>,</td></tr>
<tr><th id="4398">4398</th><td>			    <a class="macro" href="if_bgevar.h.html#158" title="((9018 + 2) + (sizeof(uint64_t) - ((9018 + 2) % sizeof(uint64_t))))" data-ref="_M/BGE_JLEN">BGE_JLEN</a>, <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4399">4399</th><td>			<b>if</b> (<a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2321" title="0x0400" data-ref="_M/BGE_RXBDFLAG_ERROR">BGE_RXBDFLAG_ERROR</a>) {</td></tr>
<tr><th id="4400">4400</th><td>				<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a>++;</td></tr>
<tr><th id="4401">4401</th><td>				<a class="tu ref fn" href="#bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-use='c' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>);</td></tr>
<tr><th id="4402">4402</th><td>				<b>continue</b>;</td></tr>
<tr><th id="4403">4403</th><td>			}</td></tr>
<tr><th id="4404">4404</th><td>			<b>if</b> (<a class="tu ref fn" href="#bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-use='c' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>,</td></tr>
<tr><th id="4405">4405</th><td>					     <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)== <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>) {</td></tr>
<tr><th id="4406">4406</th><td>				<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a>++;</td></tr>
<tr><th id="4407">4407</th><td>				<a class="tu ref fn" href="#bge_newbuf_jumbo" title='bge_newbuf_jumbo' data-use='c' data-ref="bge_newbuf_jumbo" data-ref-filename="bge_newbuf_jumbo">bge_newbuf_jumbo</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>);</td></tr>
<tr><th id="4408">4408</th><td>				<b>continue</b>;</td></tr>
<tr><th id="4409">4409</th><td>			}</td></tr>
<tr><th id="4410">4410</th><td>		} <b>else</b> {</td></tr>
<tr><th id="4411">4411</th><td>			<a class="macro" href="if_bgevar.h.html#90" title="(sc-&gt;bge_std) = (sc-&gt;bge_std + 1) % 512" data-ref="_M/BGE_INC">BGE_INC</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>, <a class="macro" href="if_bgereg.h.html#2447" title="512" data-ref="_M/BGE_STD_RX_RING_CNT">BGE_STD_RX_RING_CNT</a>);</td></tr>
<tr><th id="4412">4412</th><td>			<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a> = <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>];</td></tr>
<tr><th id="4413">4413</th><td></td></tr>
<tr><th id="4414">4414</th><td>			<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_chain" title='bge_chain_data::bge_rx_std_chain' data-ref="bge_chain_data::bge_rx_std_chain" data-ref-filename="bge_chain_data..bge_rx_std_chain">bge_rx_std_chain</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4415">4415</th><td>			<a class="local col3 ref" href="#283stdcnt" title='stdcnt' data-ref="283stdcnt" data-ref-filename="283stdcnt">stdcnt</a>++;</td></tr>
<tr><th id="4416">4416</th><td>			<a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a> = <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>];</td></tr>
<tr><th id="4417">4417</th><td>			<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_rx_std_map" title='bge_chain_data::bge_rx_std_map' data-ref="bge_chain_data::bge_rx_std_map" data-ref-filename="bge_chain_data..bge_rx_std_map">bge_rx_std_map</a>[<a class="local col1 ref" href="#291rxidx" title='rxidx' data-ref="291rxidx" data-ref-filename="291rxidx">rxidx</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4418">4418</th><td>			<b>if</b> (<a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="4419">4419</th><td>				<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a>++;</td></tr>
<tr><th id="4420">4420</th><td>				<a class="tu ref fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-use='c' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>);</td></tr>
<tr><th id="4421">4421</th><td>				<b>continue</b>;</td></tr>
<tr><th id="4422">4422</th><td>			}</td></tr>
<tr><th id="4423">4423</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>, <var>0</var>,</td></tr>
<tr><th id="4424">4424</th><td>			    <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_mapsize" title='x86_bus_dmamap::dm_mapsize' data-ref="x86_bus_dmamap::dm_mapsize" data-ref-filename="x86_bus_dmamap..dm_mapsize">dm_mapsize</a>, <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4425">4425</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>);</td></tr>
<tr><th id="4426">4426</th><td>			<b>if</b> (<a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2321" title="0x0400" data-ref="_M/BGE_RXBDFLAG_ERROR">BGE_RXBDFLAG_ERROR</a>) {</td></tr>
<tr><th id="4427">4427</th><td>				<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a>++;</td></tr>
<tr><th id="4428">4428</th><td>				<a class="tu ref fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-use='c' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>);</td></tr>
<tr><th id="4429">4429</th><td>				<b>continue</b>;</td></tr>
<tr><th id="4430">4430</th><td>			}</td></tr>
<tr><th id="4431">4431</th><td>			<b>if</b> (<a class="tu ref fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-use='c' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>,</td></tr>
<tr><th id="4432">4432</th><td>			    <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>) == <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>) {</td></tr>
<tr><th id="4433">4433</th><td>				<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a>++;</td></tr>
<tr><th id="4434">4434</th><td>				<a class="tu ref fn" href="#bge_newbuf_std" title='bge_newbuf_std' data-use='c' data-ref="bge_newbuf_std" data-ref-filename="bge_newbuf_std">bge_newbuf_std</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <a class="local col5 ref" href="#285dmamap" title='dmamap' data-ref="285dmamap" data-ref-filename="285dmamap">dmamap</a>);</td></tr>
<tr><th id="4435">4435</th><td>				<b>continue</b>;</td></tr>
<tr><th id="4436">4436</th><td>			}</td></tr>
<tr><th id="4437">4437</th><td>		}</td></tr>
<tr><th id="4438">4438</th><td></td></tr>
<tr><th id="4439">4439</th><td><u>#<span data-ppcond="4439">ifndef</span> <a class="macro" href="../../arch/amd64/include/types.h.html#78" data-ref="_M/__NO_STRICT_ALIGNMENT">__NO_STRICT_ALIGNMENT</a></u></td></tr>
<tr><th id="4440">4440</th><td>		<i>/*</i></td></tr>
<tr><th id="4441">4441</th><td><i>		 * XXX: if the 5701 PCIX-Rx-DMA workaround is in effect,</i></td></tr>
<tr><th id="4442">4442</th><td><i>		 * the Rx buffer has the layer-2 header unaligned.</i></td></tr>
<tr><th id="4443">4443</th><td><i>		 * If our CPU requires alignment, re-align by copying.</i></td></tr>
<tr><th id="4444">4444</th><td><i>		 */</i></td></tr>
<tr><th id="4445">4445</th><td>		<b>if</b> (sc-&gt;bge_flags &amp; BGEF_RX_ALIGNBUG) {</td></tr>
<tr><th id="4446">4446</th><td>			memmove(mtod(m, <em>char</em> *) + ETHER_ALIGN, m-&gt;m_data,</td></tr>
<tr><th id="4447">4447</th><td>				cur_rx-&gt;bge_len);</td></tr>
<tr><th id="4448">4448</th><td>			m-&gt;m_data += ETHER_ALIGN;</td></tr>
<tr><th id="4449">4449</th><td>		}</td></tr>
<tr><th id="4450">4450</th><td><u>#<span data-ppcond="4439">endif</span></u></td></tr>
<tr><th id="4451">4451</th><td></td></tr>
<tr><th id="4452">4452</th><td>		<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> = <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_len" title='bge_rx_bd::bge_len' data-ref="bge_rx_bd::bge_len" data-ref-filename="bge_rx_bd..bge_len">bge_len</a> - <a class="macro" href="../../net/if_ether.h.html#53" title="4" data-ref="_M/ETHER_CRC_LEN">ETHER_CRC_LEN</a>;</td></tr>
<tr><th id="4453">4453</th><td>		<a class="ref fn" href="../../sys/mbuf.h.html#m_set_rcvif" title='m_set_rcvif' data-ref="m_set_rcvif" data-ref-filename="m_set_rcvif">m_set_rcvif</a>(<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>);</td></tr>
<tr><th id="4454">4454</th><td></td></tr>
<tr><th id="4455">4455</th><td>		<a class="tu ref fn" href="#bge_rxcsum" title='bge_rxcsum' data-use='c' data-ref="bge_rxcsum" data-ref-filename="bge_rxcsum">bge_rxcsum</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>);</td></tr>
<tr><th id="4456">4456</th><td></td></tr>
<tr><th id="4457">4457</th><td>		<i>/*</i></td></tr>
<tr><th id="4458">4458</th><td><i>		 * If we received a packet with a vlan tag, pass it</i></td></tr>
<tr><th id="4459">4459</th><td><i>		 * to vlan_input() instead of ether_input().</i></td></tr>
<tr><th id="4460">4460</th><td><i>		 */</i></td></tr>
<tr><th id="4461">4461</th><td>		<b>if</b> (<a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2320" title="0x0040" data-ref="_M/BGE_RXBDFLAG_VLAN_TAG">BGE_RXBDFLAG_VLAN_TAG</a>)</td></tr>
<tr><th id="4462">4462</th><td>			<a class="ref fn" href="../../net/if_ether.h.html#vlan_set_tag" title='vlan_set_tag' data-ref="vlan_set_tag" data-ref-filename="vlan_set_tag">vlan_set_tag</a>(<a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>, <a class="local col0 ref" href="#290cur_rx" title='cur_rx' data-ref="290cur_rx" data-ref-filename="290cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_vlan_tag" title='bge_rx_bd::bge_vlan_tag' data-ref="bge_rx_bd::bge_vlan_tag" data-ref-filename="bge_rx_bd..bge_vlan_tag">bge_vlan_tag</a>);</td></tr>
<tr><th id="4463">4463</th><td></td></tr>
<tr><th id="4464">4464</th><td>		<a class="ref fn" href="../../net/if.h.html#if_percpuq_enqueue" title='if_percpuq_enqueue' data-ref="if_percpuq_enqueue" data-ref-filename="if_percpuq_enqueue">if_percpuq_enqueue</a>(<a class="local col0 ref" href="#280ifp" title='ifp' data-ref="280ifp" data-ref-filename="280ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_percpuq" title='ifnet::if_percpuq' data-ref="ifnet::if_percpuq" data-ref-filename="ifnet..if_percpuq">if_percpuq</a>, <a class="local col2 ref" href="#292m" title='m' data-ref="292m" data-ref-filename="292m">m</a>);</td></tr>
<tr><th id="4465">4465</th><td>	}</td></tr>
<tr><th id="4466">4466</th><td></td></tr>
<tr><th id="4467">4467</th><td>	<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_saved_considx" title='bge_softc::bge_rx_saved_considx' data-ref="bge_softc::bge_rx_saved_considx" data-ref-filename="bge_softc..bge_rx_saved_considx">bge_rx_saved_considx</a> = <a class="local col2 ref" href="#282rx_cons" title='rx_cons' data-ref="282rx_cons" data-ref-filename="282rx_cons">rx_cons</a>;</td></tr>
<tr><th id="4468">4468</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="macro" href="if_bgereg.h.html#522" title="0x0284" data-ref="_M/BGE_MBX_RX_CONS0_LO">BGE_MBX_RX_CONS0_LO</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_saved_considx" title='bge_softc::bge_rx_saved_considx' data-ref="bge_softc::bge_rx_saved_considx" data-ref-filename="bge_softc..bge_rx_saved_considx">bge_rx_saved_considx</a>);</td></tr>
<tr><th id="4469">4469</th><td>	<b>if</b> (<a class="local col3 ref" href="#283stdcnt" title='stdcnt' data-ref="283stdcnt" data-ref-filename="283stdcnt">stdcnt</a>)</td></tr>
<tr><th id="4470">4470</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="macro" href="if_bgereg.h.html#516" title="0x026C" data-ref="_M/BGE_MBX_RX_STD_PROD_LO">BGE_MBX_RX_STD_PROD_LO</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_std" title='bge_softc::bge_std' data-ref="bge_softc::bge_std" data-ref-filename="bge_softc..bge_std">bge_std</a>);</td></tr>
<tr><th id="4471">4471</th><td>	<b>if</b> (<a class="local col4 ref" href="#284jumbocnt" title='jumbocnt' data-ref="284jumbocnt" data-ref-filename="284jumbocnt">jumbocnt</a>)</td></tr>
<tr><th id="4472">4472</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>, <a class="macro" href="if_bgereg.h.html#518" title="0x0274" data-ref="_M/BGE_MBX_RX_JUMBO_PROD_LO">BGE_MBX_RX_JUMBO_PROD_LO</a>, <a class="local col9 ref" href="#279sc" title='sc' data-ref="279sc" data-ref-filename="279sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_jumbo" title='bge_softc::bge_jumbo' data-ref="bge_softc::bge_jumbo" data-ref-filename="bge_softc..bge_jumbo">bge_jumbo</a>);</td></tr>
<tr><th id="4473">4473</th><td>}</td></tr>
<tr><th id="4474">4474</th><td></td></tr>
<tr><th id="4475">4475</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4476">4476</th><td><dfn class="tu decl def fn" id="bge_rxcsum" title='bge_rxcsum' data-type='void bge_rxcsum(struct bge_softc * sc, struct bge_rx_bd * cur_rx, struct mbuf * m)' data-ref="bge_rxcsum" data-ref-filename="bge_rxcsum">bge_rxcsum</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="293sc" title='sc' data-type='struct bge_softc *' data-ref="293sc" data-ref-filename="293sc">sc</dfn>, <b>struct</b> <a class="type" href="if_bgereg.h.html#bge_rx_bd" title='bge_rx_bd' data-ref="bge_rx_bd" data-ref-filename="bge_rx_bd">bge_rx_bd</a> *<dfn class="local col4 decl" id="294cur_rx" title='cur_rx' data-type='struct bge_rx_bd *' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</dfn>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col5 decl" id="295m" title='m' data-type='struct mbuf *' data-ref="295m" data-ref-filename="295m">m</dfn>)</td></tr>
<tr><th id="4477">4477</th><td>{</td></tr>
<tr><th id="4478">4478</th><td></td></tr>
<tr><th id="4479">4479</th><td>	<b>if</b> (<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col3 ref" href="#293sc" title='sc' data-ref="293sc" data-ref-filename="293sc">sc</a>)) {</td></tr>
<tr><th id="4480">4480</th><td>		<b>if</b> ((<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2326" title="0x8000" data-ref="_M/BGE_RXBDFLAG_IPV6">BGE_RXBDFLAG_IPV6</a>) == <var>0</var>) {</td></tr>
<tr><th id="4481">4481</th><td>			<b>if</b> ((<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2323" title="0x1000" data-ref="_M/BGE_RXBDFLAG_IP_CSUM">BGE_RXBDFLAG_IP_CSUM</a>) != <var>0</var>)</td></tr>
<tr><th id="4482">4482</th><td>				<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> = <a class="macro" href="../../sys/mbuf.h.html#215" title="0x00000040" data-ref="_M/M_CSUM_IPv4">M_CSUM_IPv4</a>;</td></tr>
<tr><th id="4483">4483</th><td>			<b>if</b> ((<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_error_flag" title='bge_rx_bd::bge_error_flag' data-ref="bge_rx_bd::bge_error_flag" data-ref-filename="bge_rx_bd..bge_error_flag">bge_error_flag</a> &amp;</td></tr>
<tr><th id="4484">4484</th><td>				<a class="macro" href="if_bgereg.h.html#2336" title="0x1000" data-ref="_M/BGE_RXERRFLAG_IP_CSUM_NOK">BGE_RXERRFLAG_IP_CSUM_NOK</a>) != <var>0</var>)</td></tr>
<tr><th id="4485">4485</th><td>				<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> |= <a class="macro" href="../../sys/mbuf.h.html#216" title="0x00000080" data-ref="_M/M_CSUM_IPv4_BAD">M_CSUM_IPv4_BAD</a>;</td></tr>
<tr><th id="4486">4486</th><td>			<b>if</b> (<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2324" title="0x2000" data-ref="_M/BGE_RXBDFLAG_TCP_UDP_CSUM">BGE_RXBDFLAG_TCP_UDP_CSUM</a>) {</td></tr>
<tr><th id="4487">4487</th><td>				<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_data" title='pkthdr::csum_data' data-ref="pkthdr::csum_data" data-ref-filename="pkthdr..csum_data">csum_data</a> =</td></tr>
<tr><th id="4488">4488</th><td>				    <a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_tcp_udp_csum" title='bge_rx_bd::bge_tcp_udp_csum' data-ref="bge_rx_bd::bge_tcp_udp_csum" data-ref-filename="bge_rx_bd..bge_tcp_udp_csum">bge_tcp_udp_csum</a>;</td></tr>
<tr><th id="4489">4489</th><td>				<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> |=</td></tr>
<tr><th id="4490">4490</th><td>				    (<a class="macro" href="../../sys/mbuf.h.html#209" title="0x00000001" data-ref="_M/M_CSUM_TCPv4">M_CSUM_TCPv4</a> | <a class="macro" href="../../sys/mbuf.h.html#210" title="0x00000002" data-ref="_M/M_CSUM_UDPv4">M_CSUM_UDPv4</a> |<a class="macro" href="../../sys/mbuf.h.html#212" title="0x00000008" data-ref="_M/M_CSUM_DATA">M_CSUM_DATA</a>);</td></tr>
<tr><th id="4491">4491</th><td>			}</td></tr>
<tr><th id="4492">4492</th><td>		}</td></tr>
<tr><th id="4493">4493</th><td>	} <b>else</b> {</td></tr>
<tr><th id="4494">4494</th><td>		<b>if</b> ((<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2323" title="0x1000" data-ref="_M/BGE_RXBDFLAG_IP_CSUM">BGE_RXBDFLAG_IP_CSUM</a>) != <var>0</var>)</td></tr>
<tr><th id="4495">4495</th><td>			<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> = <a class="macro" href="../../sys/mbuf.h.html#215" title="0x00000040" data-ref="_M/M_CSUM_IPv4">M_CSUM_IPv4</a>;</td></tr>
<tr><th id="4496">4496</th><td>		<b>if</b> ((<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_ip_csum" title='bge_rx_bd::bge_ip_csum' data-ref="bge_rx_bd::bge_ip_csum" data-ref-filename="bge_rx_bd..bge_ip_csum">bge_ip_csum</a> ^ <var>0xffff</var>) != <var>0</var>)</td></tr>
<tr><th id="4497">4497</th><td>			<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> |= <a class="macro" href="../../sys/mbuf.h.html#216" title="0x00000080" data-ref="_M/M_CSUM_IPv4_BAD">M_CSUM_IPv4_BAD</a>;</td></tr>
<tr><th id="4498">4498</th><td>		<i>/*</i></td></tr>
<tr><th id="4499">4499</th><td><i>		 * Rx transport checksum-offload may also</i></td></tr>
<tr><th id="4500">4500</th><td><i>		 * have bugs with packets which, when transmitted,</i></td></tr>
<tr><th id="4501">4501</th><td><i>		 * were `runts' requiring padding.</i></td></tr>
<tr><th id="4502">4502</th><td><i>		 */</i></td></tr>
<tr><th id="4503">4503</th><td>		<b>if</b> (<a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_flags" title='bge_rx_bd::bge_flags' data-ref="bge_rx_bd::bge_flags" data-ref-filename="bge_rx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2324" title="0x2000" data-ref="_M/BGE_RXBDFLAG_TCP_UDP_CSUM">BGE_RXBDFLAG_TCP_UDP_CSUM</a> &amp;&amp;</td></tr>
<tr><th id="4504">4504</th><td>		    (<i>/* (sc-&gt;_bge_quirks &amp; BGE_QUIRK_SHORT_CKSUM_BUG) == 0 ||*/</i></td></tr>
<tr><th id="4505">4505</th><td>			    <a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> &gt;= <a class="macro" href="#129" title="(64 - 4)" data-ref="_M/ETHER_MIN_NOPAD">ETHER_MIN_NOPAD</a>)) {</td></tr>
<tr><th id="4506">4506</th><td>			<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_data" title='pkthdr::csum_data' data-ref="pkthdr::csum_data" data-ref-filename="pkthdr..csum_data">csum_data</a> =</td></tr>
<tr><th id="4507">4507</th><td>			    <a class="local col4 ref" href="#294cur_rx" title='cur_rx' data-ref="294cur_rx" data-ref-filename="294cur_rx">cur_rx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_rx_bd::bge_tcp_udp_csum" title='bge_rx_bd::bge_tcp_udp_csum' data-ref="bge_rx_bd::bge_tcp_udp_csum" data-ref-filename="bge_rx_bd..bge_tcp_udp_csum">bge_tcp_udp_csum</a>;</td></tr>
<tr><th id="4508">4508</th><td>			<a class="local col5 ref" href="#295m" title='m' data-ref="295m" data-ref-filename="295m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> |=</td></tr>
<tr><th id="4509">4509</th><td>			    (<a class="macro" href="../../sys/mbuf.h.html#209" title="0x00000001" data-ref="_M/M_CSUM_TCPv4">M_CSUM_TCPv4</a> | <a class="macro" href="../../sys/mbuf.h.html#210" title="0x00000002" data-ref="_M/M_CSUM_UDPv4">M_CSUM_UDPv4</a> | <a class="macro" href="../../sys/mbuf.h.html#212" title="0x00000008" data-ref="_M/M_CSUM_DATA">M_CSUM_DATA</a>);</td></tr>
<tr><th id="4510">4510</th><td>		}</td></tr>
<tr><th id="4511">4511</th><td>	}</td></tr>
<tr><th id="4512">4512</th><td>}</td></tr>
<tr><th id="4513">4513</th><td></td></tr>
<tr><th id="4514">4514</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4515">4515</th><td><dfn class="tu decl def fn" id="bge_txeof" title='bge_txeof' data-type='void bge_txeof(struct bge_softc * sc)' data-ref="bge_txeof" data-ref-filename="bge_txeof">bge_txeof</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="296sc" title='sc' data-type='struct bge_softc *' data-ref="296sc" data-ref-filename="296sc">sc</dfn>)</td></tr>
<tr><th id="4516">4516</th><td>{</td></tr>
<tr><th id="4517">4517</th><td>	<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a> *<dfn class="local col7 decl" id="297cur_tx" title='cur_tx' data-type='struct bge_tx_bd *' data-ref="297cur_tx" data-ref-filename="297cur_tx">cur_tx</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4518">4518</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col8 decl" id="298ifp" title='ifp' data-type='struct ifnet *' data-ref="298ifp" data-ref-filename="298ifp">ifp</dfn>;</td></tr>
<tr><th id="4519">4519</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#txdmamap_pool_entry" title='txdmamap_pool_entry' data-ref="txdmamap_pool_entry" data-ref-filename="txdmamap_pool_entry">txdmamap_pool_entry</a> *<dfn class="local col9 decl" id="299dma" title='dma' data-type='struct txdmamap_pool_entry *' data-ref="299dma" data-ref-filename="299dma">dma</dfn>;</td></tr>
<tr><th id="4520">4520</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a> <dfn class="local col0 decl" id="300offset" title='offset' data-type='bus_addr_t' data-ref="300offset" data-ref-filename="300offset">offset</dfn>, <dfn class="local col1 decl" id="301toff" title='toff' data-type='bus_addr_t' data-ref="301toff" data-ref-filename="301toff">toff</dfn>;</td></tr>
<tr><th id="4521">4521</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_size_t" title='bus_size_t' data-type='size_t' data-ref="bus_size_t" data-ref-filename="bus_size_t">bus_size_t</a> <dfn class="local col2 decl" id="302tlen" title='tlen' data-type='bus_size_t' data-ref="302tlen" data-ref-filename="302tlen">tlen</dfn>;</td></tr>
<tr><th id="4522">4522</th><td>	<em>int</em> <dfn class="local col3 decl" id="303tosync" title='tosync' data-type='int' data-ref="303tosync" data-ref-filename="303tosync">tosync</dfn>;</td></tr>
<tr><th id="4523">4523</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col4 decl" id="304m" title='m' data-type='struct mbuf *' data-ref="304m" data-ref-filename="304m">m</dfn>;</td></tr>
<tr><th id="4524">4524</th><td></td></tr>
<tr><th id="4525">4525</th><td>	<a class="local col8 ref" href="#298ifp" title='ifp' data-ref="298ifp" data-ref-filename="298ifp">ifp</a> = &amp;<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="4526">4526</th><td></td></tr>
<tr><th id="4527">4527</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4528">4528</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_status_block)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_status_block),</td></tr>
<tr><th id="4529">4529</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_status_block" title='bge_status_block' data-ref="bge_status_block" data-ref-filename="bge_status_block">bge_status_block</a>),</td></tr>
<tr><th id="4530">4530</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a>);</td></tr>
<tr><th id="4531">4531</th><td></td></tr>
<tr><th id="4532">4532</th><td>	<a class="local col0 ref" href="#300offset" title='offset' data-ref="300offset" data-ref-filename="300offset">offset</a> = <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_tx_ring)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_tx_ring);</td></tr>
<tr><th id="4533">4533</th><td>	<a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a> = <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_idx" title='bge_status_block::bge_idx' data-ref="bge_status_block::bge_idx" data-ref-filename="bge_status_block..bge_idx">bge_idx</a>[<var>0</var>].<a class="ref field" href="if_bgereg.h.html#bge_sts_idx::bge_tx_cons_idx" title='bge_sts_idx::bge_tx_cons_idx' data-ref="bge_sts_idx::bge_tx_cons_idx" data-ref-filename="bge_sts_idx..bge_tx_cons_idx">bge_tx_cons_idx</a> -</td></tr>
<tr><th id="4534">4534</th><td>	    <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a>;</td></tr>
<tr><th id="4535">4535</th><td></td></tr>
<tr><th id="4536">4536</th><td>	<b>if</b> (<a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a> != <var>0</var>)</td></tr>
<tr><th id="4537">4537</th><td>		<a class="ref fn" href="../../sys/rndsource.h.html#rnd_add_uint32" title='rnd_add_uint32' data-ref="rnd_add_uint32" data-ref-filename="rnd_add_uint32">rnd_add_uint32</a>(&amp;<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::rnd_source" title='bge_softc::rnd_source' data-ref="bge_softc::rnd_source" data-ref-filename="bge_softc..rnd_source">rnd_source</a>, <a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a>);</td></tr>
<tr><th id="4538">4538</th><td></td></tr>
<tr><th id="4539">4539</th><td>	<a class="local col1 ref" href="#301toff" title='toff' data-ref="301toff" data-ref-filename="301toff">toff</a> = <a class="local col0 ref" href="#300offset" title='offset' data-ref="300offset" data-ref-filename="300offset">offset</a> + (<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a>));</td></tr>
<tr><th id="4540">4540</th><td></td></tr>
<tr><th id="4541">4541</th><td>	<b>if</b> (<a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a> &lt; <var>0</var>) {</td></tr>
<tr><th id="4542">4542</th><td>		<a class="local col2 ref" href="#302tlen" title='tlen' data-ref="302tlen" data-ref-filename="302tlen">tlen</a> = (<a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a> - <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a>) *</td></tr>
<tr><th id="4543">4543</th><td>		    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a>);</td></tr>
<tr><th id="4544">4544</th><td>		<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4545">4545</th><td>		    <a class="local col1 ref" href="#301toff" title='toff' data-ref="301toff" data-ref-filename="301toff">toff</a>, <a class="local col2 ref" href="#302tlen" title='tlen' data-ref="302tlen" data-ref-filename="302tlen">tlen</a>, <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a> | <a class="macro" href="../../sys/bus_proto.h.html#329" title="0x08" data-ref="_M/BUS_DMASYNC_POSTWRITE">BUS_DMASYNC_POSTWRITE</a>);</td></tr>
<tr><th id="4546">4546</th><td>		<a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a> = -<a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a>;</td></tr>
<tr><th id="4547">4547</th><td>	}</td></tr>
<tr><th id="4548">4548</th><td></td></tr>
<tr><th id="4549">4549</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4550">4550</th><td>	    <a class="local col0 ref" href="#300offset" title='offset' data-ref="300offset" data-ref-filename="300offset">offset</a>, <a class="local col3 ref" href="#303tosync" title='tosync' data-ref="303tosync" data-ref-filename="303tosync">tosync</a> * <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a>),</td></tr>
<tr><th id="4551">4551</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a> | <a class="macro" href="../../sys/bus_proto.h.html#329" title="0x08" data-ref="_M/BUS_DMASYNC_POSTWRITE">BUS_DMASYNC_POSTWRITE</a>);</td></tr>
<tr><th id="4552">4552</th><td></td></tr>
<tr><th id="4553">4553</th><td>	<i>/*</i></td></tr>
<tr><th id="4554">4554</th><td><i>	 * Go through our tx ring and free mbufs for those</i></td></tr>
<tr><th id="4555">4555</th><td><i>	 * frames that have been sent.</i></td></tr>
<tr><th id="4556">4556</th><td><i>	 */</i></td></tr>
<tr><th id="4557">4557</th><td>	<b>while</b> (<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a> !=</td></tr>
<tr><th id="4558">4558</th><td>	    <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_idx" title='bge_status_block::bge_idx' data-ref="bge_status_block::bge_idx" data-ref-filename="bge_status_block..bge_idx">bge_idx</a>[<var>0</var>].<a class="ref field" href="if_bgereg.h.html#bge_sts_idx::bge_tx_cons_idx" title='bge_sts_idx::bge_tx_cons_idx' data-ref="bge_sts_idx::bge_tx_cons_idx" data-ref-filename="bge_sts_idx..bge_tx_cons_idx">bge_tx_cons_idx</a>) {</td></tr>
<tr><th id="4559">4559</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col5 decl" id="305idx" title='idx' data-type='uint32_t' data-ref="305idx" data-ref-filename="305idx">idx</dfn> = <var>0</var>;</td></tr>
<tr><th id="4560">4560</th><td></td></tr>
<tr><th id="4561">4561</th><td>		<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a> = <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a>;</td></tr>
<tr><th id="4562">4562</th><td>		<a class="local col7 ref" href="#297cur_tx" title='cur_tx' data-ref="297cur_tx" data-ref-filename="297cur_tx">cur_tx</a> = &amp;<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_tx_ring" title='bge_ring_data::bge_tx_ring' data-ref="bge_ring_data::bge_tx_ring" data-ref-filename="bge_ring_data..bge_tx_ring">bge_tx_ring</a>[<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a>];</td></tr>
<tr><th id="4563">4563</th><td>		<b>if</b> (<a class="local col7 ref" href="#297cur_tx" title='cur_tx' data-ref="297cur_tx" data-ref-filename="297cur_tx">cur_tx</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2278" title="0x0004" data-ref="_M/BGE_TXBDFLAG_END">BGE_TXBDFLAG_END</a>)</td></tr>
<tr><th id="4564">4564</th><td>			<a class="local col8 ref" href="#298ifp" title='ifp' data-ref="298ifp" data-ref-filename="298ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#405" title="if_data.ifi_opackets" data-ref="_M/if_opackets">if_opackets</a>++;</td></tr>
<tr><th id="4565">4565</th><td>		<a class="local col4 ref" href="#304m" title='m' data-ref="304m" data-ref-filename="304m">m</a> = <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a>];</td></tr>
<tr><th id="4566">4566</th><td>		<b>if</b> (<a class="local col4 ref" href="#304m" title='m' data-ref="304m" data-ref-filename="304m">m</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="4567">4567</th><td>			<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4568">4568</th><td>			<a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a> = <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma" title='bge_softc::txdma' data-ref="bge_softc::txdma" data-ref-filename="bge_softc..txdma">txdma</a>[<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a>];</td></tr>
<tr><th id="4569">4569</th><td>			<b>if</b> (<a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::is_dma32" title='txdmamap_pool_entry::is_dma32' data-ref="txdmamap_pool_entry::is_dma32" data-ref-filename="txdmamap_pool_entry..is_dma32">is_dma32</a>) {</td></tr>
<tr><th id="4570">4570</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a>,</td></tr>
<tr><th id="4571">4571</th><td>				    <var>0</var>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_mapsize" title='x86_bus_dmamap::dm_mapsize' data-ref="x86_bus_dmamap::dm_mapsize" data-ref-filename="x86_bus_dmamap..dm_mapsize">dm_mapsize</a>,</td></tr>
<tr><th id="4572">4572</th><td>				    <a class="macro" href="../../sys/bus_proto.h.html#329" title="0x08" data-ref="_M/BUS_DMASYNC_POSTWRITE">BUS_DMASYNC_POSTWRITE</a>);</td></tr>
<tr><th id="4573">4573</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(</td></tr>
<tr><th id="4574">4574</th><td>				    <a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a>);</td></tr>
<tr><th id="4575">4575</th><td>			} <b>else</b> {</td></tr>
<tr><th id="4576">4576</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a>,</td></tr>
<tr><th id="4577">4577</th><td>				    <var>0</var>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_mapsize" title='x86_bus_dmamap::dm_mapsize' data-ref="x86_bus_dmamap::dm_mapsize" data-ref-filename="x86_bus_dmamap..dm_mapsize">dm_mapsize</a>,</td></tr>
<tr><th id="4578">4578</th><td>				    <a class="macro" href="../../sys/bus_proto.h.html#329" title="0x08" data-ref="_M/BUS_DMASYNC_POSTWRITE">BUS_DMASYNC_POSTWRITE</a>);</td></tr>
<tr><th id="4579">4579</th><td>				<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a>);</td></tr>
<tr><th id="4580">4580</th><td>			}</td></tr>
<tr><th id="4581">4581</th><td>			<a class="macro" href="../../sys/queue.h.html#157" title="do { (dma)-&gt;link.sle_next = (&amp;sc-&gt;txdma_list)-&gt;slh_first; (&amp;sc-&gt;txdma_list)-&gt;slh_first = (dma); } while ( 0)" data-ref="_M/SLIST_INSERT_HEAD">SLIST_INSERT_HEAD</a>(&amp;<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>, <a class="local col9 ref" href="#299dma" title='dma' data-ref="299dma" data-ref-filename="299dma">dma</a>, <a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::link" title='txdmamap_pool_entry::link' data-ref="txdmamap_pool_entry::link" data-ref-filename="txdmamap_pool_entry..link">link</a>);</td></tr>
<tr><th id="4582">4582</th><td>			<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma" title='bge_softc::txdma' data-ref="bge_softc::txdma" data-ref-filename="bge_softc..txdma">txdma</a>[<a class="local col5 ref" href="#305idx" title='idx' data-ref="305idx" data-ref-filename="305idx">idx</a>] = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4583">4583</th><td></td></tr>
<tr><th id="4584">4584</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col4 ref" href="#304m" title='m' data-ref="304m" data-ref-filename="304m">m</a>);</td></tr>
<tr><th id="4585">4585</th><td>		}</td></tr>
<tr><th id="4586">4586</th><td>		<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_txcnt" title='bge_softc::bge_txcnt' data-ref="bge_softc::bge_txcnt" data-ref-filename="bge_softc..bge_txcnt">bge_txcnt</a>--;</td></tr>
<tr><th id="4587">4587</th><td>		<a class="macro" href="if_bgevar.h.html#90" title="(sc-&gt;bge_tx_saved_considx) = (sc-&gt;bge_tx_saved_considx + 1) % 512" data-ref="_M/BGE_INC">BGE_INC</a>(<a class="local col6 ref" href="#296sc" title='sc' data-ref="296sc" data-ref-filename="296sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a>, <a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>);</td></tr>
<tr><th id="4588">4588</th><td>		<a class="local col8 ref" href="#298ifp" title='ifp' data-ref="298ifp" data-ref-filename="298ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_timer" title='ifnet::if_timer' data-ref="ifnet::if_timer" data-ref-filename="ifnet..if_timer">if_timer</a> = <var>0</var>;</td></tr>
<tr><th id="4589">4589</th><td>	}</td></tr>
<tr><th id="4590">4590</th><td></td></tr>
<tr><th id="4591">4591</th><td>	<b>if</b> (<a class="local col7 ref" href="#297cur_tx" title='cur_tx' data-ref="297cur_tx" data-ref-filename="297cur_tx">cur_tx</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="4592">4592</th><td>		<a class="local col8 ref" href="#298ifp" title='ifp' data-ref="298ifp" data-ref-filename="298ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp;= ~<a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>;</td></tr>
<tr><th id="4593">4593</th><td>}</td></tr>
<tr><th id="4594">4594</th><td></td></tr>
<tr><th id="4595">4595</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="4596">4596</th><td><dfn class="tu decl def fn" id="bge_intr" title='bge_intr' data-type='int bge_intr(void * xsc)' data-ref="bge_intr" data-ref-filename="bge_intr">bge_intr</dfn>(<em>void</em> *<dfn class="local col6 decl" id="306xsc" title='xsc' data-type='void *' data-ref="306xsc" data-ref-filename="306xsc">xsc</dfn>)</td></tr>
<tr><th id="4597">4597</th><td>{</td></tr>
<tr><th id="4598">4598</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="307sc" title='sc' data-type='struct bge_softc *' data-ref="307sc" data-ref-filename="307sc">sc</dfn>;</td></tr>
<tr><th id="4599">4599</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col8 decl" id="308ifp" title='ifp' data-type='struct ifnet *' data-ref="308ifp" data-ref-filename="308ifp">ifp</dfn>;</td></tr>
<tr><th id="4600">4600</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="309pcistate" title='pcistate' data-type='uint32_t' data-ref="309pcistate" data-ref-filename="309pcistate">pcistate</dfn>, <dfn class="local col0 decl" id="310statusword" title='statusword' data-type='uint32_t' data-ref="310statusword" data-ref-filename="310statusword">statusword</dfn>, <dfn class="local col1 decl" id="311statustag" title='statustag' data-type='uint32_t' data-ref="311statustag" data-ref-filename="311statustag">statustag</dfn>;</td></tr>
<tr><th id="4601">4601</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="312intrmask" title='intrmask' data-type='uint32_t' data-ref="312intrmask" data-ref-filename="312intrmask">intrmask</dfn> = <a class="macro" href="if_bgereg.h.html#444" title="0x00000002" data-ref="_M/BGE_PCISTATE_INTR_NOT_ACTIVE">BGE_PCISTATE_INTR_NOT_ACTIVE</a>;</td></tr>
<tr><th id="4602">4602</th><td></td></tr>
<tr><th id="4603">4603</th><td>	<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a> = <a class="local col6 ref" href="#306xsc" title='xsc' data-ref="306xsc" data-ref-filename="306xsc">xsc</a>;</td></tr>
<tr><th id="4604">4604</th><td>	<a class="local col8 ref" href="#308ifp" title='ifp' data-ref="308ifp" data-ref-filename="308ifp">ifp</a> = &amp;<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="4605">4605</th><td></td></tr>
<tr><th id="4606">4606</th><td>	<i>/* 5717 and newer chips have no BGE_PCISTATE_INTR_NOT_ACTIVE bit */</i></td></tr>
<tr><th id="4607">4607</th><td>	<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>))</td></tr>
<tr><th id="4608">4608</th><td>		<a class="local col2 ref" href="#312intrmask" title='intrmask' data-ref="312intrmask" data-ref-filename="312intrmask">intrmask</a> = <var>0</var>;</td></tr>
<tr><th id="4609">4609</th><td></td></tr>
<tr><th id="4610">4610</th><td>	<i>/* It is possible for the interrupt to arrive before</i></td></tr>
<tr><th id="4611">4611</th><td><i>	 * the status block is updated prior to the interrupt.</i></td></tr>
<tr><th id="4612">4612</th><td><i>	 * Reading the PCI State register will confirm whether the</i></td></tr>
<tr><th id="4613">4613</th><td><i>	 * interrupt is ours and will flush the status block.</i></td></tr>
<tr><th id="4614">4614</th><td><i>	 */</i></td></tr>
<tr><th id="4615">4615</th><td>	<a class="local col9 ref" href="#309pcistate" title='pcistate' data-ref="309pcistate" data-ref-filename="309pcistate">pcistate</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x70)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#231" title="0x70" data-ref="_M/BGE_PCI_PCISTATE">BGE_PCI_PCISTATE</a>);</td></tr>
<tr><th id="4616">4616</th><td></td></tr>
<tr><th id="4617">4617</th><td>	<i>/* read status word from status block */</i></td></tr>
<tr><th id="4618">4618</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4619">4619</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_status_block)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_status_block),</td></tr>
<tr><th id="4620">4620</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_status_block" title='bge_status_block' data-ref="bge_status_block" data-ref-filename="bge_status_block">bge_status_block</a>),</td></tr>
<tr><th id="4621">4621</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#327" title="0x02" data-ref="_M/BUS_DMASYNC_POSTREAD">BUS_DMASYNC_POSTREAD</a> | <a class="macro" href="../../sys/bus_proto.h.html#329" title="0x08" data-ref="_M/BUS_DMASYNC_POSTWRITE">BUS_DMASYNC_POSTWRITE</a>);</td></tr>
<tr><th id="4622">4622</th><td>	<a class="local col0 ref" href="#310statusword" title='statusword' data-ref="310statusword" data-ref-filename="310statusword">statusword</a> = <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_status" title='bge_status_block::bge_status' data-ref="bge_status_block::bge_status" data-ref-filename="bge_status_block..bge_status">bge_status</a>;</td></tr>
<tr><th id="4623">4623</th><td>	<a class="local col1 ref" href="#311statustag" title='statustag' data-ref="311statustag" data-ref-filename="311statustag">statustag</a> = <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_status_tag" title='bge_status_block::bge_status_tag' data-ref="bge_status_block::bge_status_tag" data-ref-filename="bge_status_block..bge_status_tag">bge_status_tag</a> &lt;&lt; <var>24</var>;</td></tr>
<tr><th id="4624">4624</th><td></td></tr>
<tr><th id="4625">4625</th><td>	<b>if</b> (<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2682" title="0x00200000" data-ref="_M/BGEF_TAGGED_STATUS">BGEF_TAGGED_STATUS</a>) {</td></tr>
<tr><th id="4626">4626</th><td>		<b>if</b> (<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_lasttag" title='bge_softc::bge_lasttag' data-ref="bge_softc::bge_lasttag" data-ref-filename="bge_softc..bge_lasttag">bge_lasttag</a> == <a class="local col1 ref" href="#311statustag" title='statustag' data-ref="311statustag" data-ref-filename="311statustag">statustag</a> &amp;&amp;</td></tr>
<tr><th id="4627">4627</th><td>		    (~<a class="local col9 ref" href="#309pcistate" title='pcistate' data-ref="309pcistate" data-ref-filename="309pcistate">pcistate</a> &amp; <a class="local col2 ref" href="#312intrmask" title='intrmask' data-ref="312intrmask" data-ref-filename="312intrmask">intrmask</a>)) {</td></tr>
<tr><th id="4628">4628</th><td>			<a class="macro" href="#292" title="" data-ref="_M/BGE_EVCNT_INCR">BGE_EVCNT_INCR</a>(sc-&gt;bge_ev_intr_spurious);</td></tr>
<tr><th id="4629">4629</th><td>			<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="4630">4630</th><td>		}</td></tr>
<tr><th id="4631">4631</th><td>		<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_lasttag" title='bge_softc::bge_lasttag' data-ref="bge_softc::bge_lasttag" data-ref-filename="bge_softc..bge_lasttag">bge_lasttag</a> = <a class="local col1 ref" href="#311statustag" title='statustag' data-ref="311statustag" data-ref-filename="311statustag">statustag</a>;</td></tr>
<tr><th id="4632">4632</th><td>	} <b>else</b> {</td></tr>
<tr><th id="4633">4633</th><td>		<b>if</b> (!(<a class="local col0 ref" href="#310statusword" title='statusword' data-ref="310statusword" data-ref-filename="310statusword">statusword</a> &amp; <a class="macro" href="if_bgereg.h.html#2368" title="0x00000001" data-ref="_M/BGE_STATFLAG_UPDATED">BGE_STATFLAG_UPDATED</a>) &amp;&amp;</td></tr>
<tr><th id="4634">4634</th><td>		    !(~<a class="local col9 ref" href="#309pcistate" title='pcistate' data-ref="309pcistate" data-ref-filename="309pcistate">pcistate</a> &amp; <a class="local col2 ref" href="#312intrmask" title='intrmask' data-ref="312intrmask" data-ref-filename="312intrmask">intrmask</a>)) {</td></tr>
<tr><th id="4635">4635</th><td>			<a class="macro" href="#292" title="" data-ref="_M/BGE_EVCNT_INCR">BGE_EVCNT_INCR</a>(sc-&gt;bge_ev_intr_spurious2);</td></tr>
<tr><th id="4636">4636</th><td>			<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="4637">4637</th><td>		}</td></tr>
<tr><th id="4638">4638</th><td>		<a class="local col1 ref" href="#311statustag" title='statustag' data-ref="311statustag" data-ref-filename="311statustag">statustag</a> = <var>0</var>;</td></tr>
<tr><th id="4639">4639</th><td>	}</td></tr>
<tr><th id="4640">4640</th><td>	<i>/* Ack interrupt and stop others from occurring. */</i></td></tr>
<tr><th id="4641">4641</th><td>	<a class="tu ref fn" href="#bge_writembx_flush" title='bge_writembx_flush' data-use='c' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#490" title="0x0204" data-ref="_M/BGE_MBX_IRQ0_LO">BGE_MBX_IRQ0_LO</a>, <var>1</var>);</td></tr>
<tr><th id="4642">4642</th><td>	<a class="macro" href="#292" title="" data-ref="_M/BGE_EVCNT_INCR">BGE_EVCNT_INCR</a>(sc-&gt;bge_ev_intr);</td></tr>
<tr><th id="4643">4643</th><td></td></tr>
<tr><th id="4644">4644</th><td>	<i>/* clear status word */</i></td></tr>
<tr><th id="4645">4645</th><td>	<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_status_block" title='bge_ring_data::bge_status_block' data-ref="bge_ring_data::bge_status_block" data-ref-filename="bge_ring_data..bge_status_block">bge_status_block</a>.<a class="ref field" href="if_bgereg.h.html#bge_status_block::bge_status" title='bge_status_block::bge_status' data-ref="bge_status_block::bge_status" data-ref-filename="bge_status_block..bge_status">bge_status</a> = <var>0</var>;</td></tr>
<tr><th id="4646">4646</th><td></td></tr>
<tr><th id="4647">4647</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>, <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ring_map" title='bge_softc::bge_ring_map' data-ref="bge_softc::bge_ring_map" data-ref-filename="bge_softc..bge_ring_map">bge_ring_map</a>,</td></tr>
<tr><th id="4648">4648</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_ring_data, bge_status_block)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_ring_data" title='bge_ring_data' data-ref="bge_ring_data" data-ref-filename="bge_ring_data">bge_ring_data</a>, bge_status_block),</td></tr>
<tr><th id="4649">4649</th><td>	    <b>sizeof</b> (<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_status_block" title='bge_status_block' data-ref="bge_status_block" data-ref-filename="bge_status_block">bge_status_block</a>),</td></tr>
<tr><th id="4650">4650</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#326" title="0x01" data-ref="_M/BUS_DMASYNC_PREREAD">BUS_DMASYNC_PREREAD</a> | <a class="macro" href="../../sys/bus_proto.h.html#328" title="0x04" data-ref="_M/BUS_DMASYNC_PREWRITE">BUS_DMASYNC_PREWRITE</a>);</td></tr>
<tr><th id="4651">4651</th><td></td></tr>
<tr><th id="4652">4652</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> ||</td></tr>
<tr><th id="4653">4653</th><td>	    <a class="local col0 ref" href="#310statusword" title='statusword' data-ref="310statusword" data-ref-filename="310statusword">statusword</a> &amp; <a class="macro" href="if_bgereg.h.html#2369" title="0x00000002" data-ref="_M/BGE_STATFLAG_LINKSTATE_CHANGED">BGE_STATFLAG_LINKSTATE_CHANGED</a> ||</td></tr>
<tr><th id="4654">4654</th><td>	    <a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000002))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgevar.h.html#319" title="0x00000002" data-ref="_M/BGE_STS_LINK_EVT">BGE_STS_LINK_EVT</a>))</td></tr>
<tr><th id="4655">4655</th><td>		<a class="tu ref fn" href="#bge_link_upd" title='bge_link_upd' data-use='c' data-ref="bge_link_upd" data-ref-filename="bge_link_upd">bge_link_upd</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>);</td></tr>
<tr><th id="4656">4656</th><td></td></tr>
<tr><th id="4657">4657</th><td>	<b>if</b> (<a class="local col8 ref" href="#308ifp" title='ifp' data-ref="308ifp" data-ref-filename="308ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>) {</td></tr>
<tr><th id="4658">4658</th><td>		<i>/* Check RX return ring producer/consumer */</i></td></tr>
<tr><th id="4659">4659</th><td>		<a class="tu ref fn" href="#bge_rxeof" title='bge_rxeof' data-use='c' data-ref="bge_rxeof" data-ref-filename="bge_rxeof">bge_rxeof</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>);</td></tr>
<tr><th id="4660">4660</th><td></td></tr>
<tr><th id="4661">4661</th><td>		<i>/* Check TX ring producer/consumer */</i></td></tr>
<tr><th id="4662">4662</th><td>		<a class="tu ref fn" href="#bge_txeof" title='bge_txeof' data-use='c' data-ref="bge_txeof" data-ref-filename="bge_txeof">bge_txeof</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>);</td></tr>
<tr><th id="4663">4663</th><td>	}</td></tr>
<tr><th id="4664">4664</th><td></td></tr>
<tr><th id="4665">4665</th><td>	<b>if</b> (<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pending_rxintr_change" title='bge_softc::bge_pending_rxintr_change' data-ref="bge_softc::bge_pending_rxintr_change" data-ref-filename="bge_softc..bge_pending_rxintr_change">bge_pending_rxintr_change</a>) {</td></tr>
<tr><th id="4666">4666</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="313rx_ticks" title='rx_ticks' data-type='uint32_t' data-ref="313rx_ticks" data-ref-filename="313rx_ticks">rx_ticks</dfn> = <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_coal_ticks" title='bge_softc::bge_rx_coal_ticks' data-ref="bge_softc::bge_rx_coal_ticks" data-ref-filename="bge_softc..bge_rx_coal_ticks">bge_rx_coal_ticks</a>;</td></tr>
<tr><th id="4667">4667</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="314rx_bds" title='rx_bds' data-type='uint32_t' data-ref="314rx_bds" data-ref-filename="314rx_bds">rx_bds</dfn> = <a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_max_coal_bds" title='bge_softc::bge_rx_max_coal_bds' data-ref="bge_softc::bge_rx_max_coal_bds" data-ref-filename="bge_softc..bge_rx_max_coal_bds">bge_rx_max_coal_bds</a>;</td></tr>
<tr><th id="4668">4668</th><td></td></tr>
<tr><th id="4669">4669</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C08, rx_ticks)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1306" title="0x3C08" data-ref="_M/BGE_HCC_RX_COAL_TICKS">BGE_HCC_RX_COAL_TICKS</a>, <a class="local col3 ref" href="#313rx_ticks" title='rx_ticks' data-ref="313rx_ticks" data-ref-filename="313rx_ticks">rx_ticks</a>);</td></tr>
<tr><th id="4670">4670</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="4671">4671</th><td>		(<em>void</em>)<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C08)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1306" title="0x3C08" data-ref="_M/BGE_HCC_RX_COAL_TICKS">BGE_HCC_RX_COAL_TICKS</a>);</td></tr>
<tr><th id="4672">4672</th><td></td></tr>
<tr><th id="4673">4673</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C10, rx_bds)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1308" title="0x3C10" data-ref="_M/BGE_HCC_RX_MAX_COAL_BDS">BGE_HCC_RX_MAX_COAL_BDS</a>, <a class="local col4 ref" href="#314rx_bds" title='rx_bds' data-ref="314rx_bds" data-ref-filename="314rx_bds">rx_bds</a>);</td></tr>
<tr><th id="4674">4674</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="4675">4675</th><td>		(<em>void</em>)<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C10)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1308" title="0x3C10" data-ref="_M/BGE_HCC_RX_MAX_COAL_BDS">BGE_HCC_RX_MAX_COAL_BDS</a>);</td></tr>
<tr><th id="4676">4676</th><td></td></tr>
<tr><th id="4677">4677</th><td>		<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_pending_rxintr_change" title='bge_softc::bge_pending_rxintr_change' data-ref="bge_softc::bge_pending_rxintr_change" data-ref-filename="bge_softc..bge_pending_rxintr_change">bge_pending_rxintr_change</a> = <var>0</var>;</td></tr>
<tr><th id="4678">4678</th><td>	}</td></tr>
<tr><th id="4679">4679</th><td>	<a class="tu ref fn" href="#bge_handle_events" title='bge_handle_events' data-use='c' data-ref="bge_handle_events" data-ref-filename="bge_handle_events">bge_handle_events</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>);</td></tr>
<tr><th id="4680">4680</th><td></td></tr>
<tr><th id="4681">4681</th><td>	<i>/* Re-enable interrupts. */</i></td></tr>
<tr><th id="4682">4682</th><td>	<a class="tu ref fn" href="#bge_writembx_flush" title='bge_writembx_flush' data-use='c' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</a>(<a class="local col7 ref" href="#307sc" title='sc' data-ref="307sc" data-ref-filename="307sc">sc</a>, <a class="macro" href="if_bgereg.h.html#490" title="0x0204" data-ref="_M/BGE_MBX_IRQ0_LO">BGE_MBX_IRQ0_LO</a>, <a class="local col1 ref" href="#311statustag" title='statustag' data-ref="311statustag" data-ref-filename="311statustag">statustag</a>);</td></tr>
<tr><th id="4683">4683</th><td></td></tr>
<tr><th id="4684">4684</th><td>	<b>if</b> (<a class="local col8 ref" href="#308ifp" title='ifp' data-ref="308ifp" data-ref-filename="308ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>)</td></tr>
<tr><th id="4685">4685</th><td>		<a class="ref fn" href="../../net/if.h.html#if_schedule_deferred_start" title='if_schedule_deferred_start' data-ref="if_schedule_deferred_start" data-ref-filename="if_schedule_deferred_start">if_schedule_deferred_start</a>(<a class="local col8 ref" href="#308ifp" title='ifp' data-ref="308ifp" data-ref-filename="308ifp">ifp</a>);</td></tr>
<tr><th id="4686">4686</th><td></td></tr>
<tr><th id="4687">4687</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="4688">4688</th><td>}</td></tr>
<tr><th id="4689">4689</th><td></td></tr>
<tr><th id="4690">4690</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4691">4691</th><td><dfn class="tu decl def fn" id="bge_asf_driver_up" title='bge_asf_driver_up' data-type='void bge_asf_driver_up(struct bge_softc * sc)' data-ref="bge_asf_driver_up" data-ref-filename="bge_asf_driver_up">bge_asf_driver_up</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="315sc" title='sc' data-type='struct bge_softc *' data-ref="315sc" data-ref-filename="315sc">sc</dfn>)</td></tr>
<tr><th id="4692">4692</th><td>{</td></tr>
<tr><th id="4693">4693</th><td>	<b>if</b> (<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#259" title="4" data-ref="_M/ASF_STACKUP">ASF_STACKUP</a>) {</td></tr>
<tr><th id="4694">4694</th><td>		<i>/* Send ASF heartbeat aprox. every 2s */</i></td></tr>
<tr><th id="4695">4695</th><td>		<b>if</b> (<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_count" title='bge_softc::bge_asf_count' data-ref="bge_softc::bge_asf_count" data-ref-filename="bge_softc..bge_asf_count">bge_asf_count</a>)</td></tr>
<tr><th id="4696">4696</th><td>			<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_count" title='bge_softc::bge_asf_count' data-ref="bge_softc::bge_asf_count" data-ref-filename="bge_softc..bge_asf_count">bge_asf_count</a> --;</td></tr>
<tr><th id="4697">4697</th><td>		<b>else</b> {</td></tr>
<tr><th id="4698">4698</th><td>			<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_count" title='bge_softc::bge_asf_count' data-ref="bge_softc::bge_asf_count" data-ref-filename="bge_softc..bge_asf_count">bge_asf_count</a> = <var>2</var>;</td></tr>
<tr><th id="4699">4699</th><td></td></tr>
<tr><th id="4700">4700</th><td>			<a class="tu ref fn" href="#bge_wait_for_event_ack" title='bge_wait_for_event_ack' data-use='c' data-ref="bge_wait_for_event_ack" data-ref-filename="bge_wait_for_event_ack">bge_wait_for_event_ack</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>);</td></tr>
<tr><th id="4701">4701</th><td></td></tr>
<tr><th id="4702">4702</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>, <a class="macro" href="if_bgereg.h.html#79" title="0x00000B78" data-ref="_M/BGE_SRAM_FW_CMD_MB">BGE_SRAM_FW_CMD_MB</a>,</td></tr>
<tr><th id="4703">4703</th><td>			    <a class="macro" href="if_bgereg.h.html#103" title="0x0000000e" data-ref="_M/BGE_FW_CMD_DRV_ALIVE3">BGE_FW_CMD_DRV_ALIVE3</a>);</td></tr>
<tr><th id="4704">4704</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>, <a class="macro" href="if_bgereg.h.html#80" title="0x00000B7C" data-ref="_M/BGE_SRAM_FW_CMD_LEN_MB">BGE_SRAM_FW_CMD_LEN_MB</a>, <var>4</var>);</td></tr>
<tr><th id="4705">4705</th><td>			<a class="tu ref fn" href="#bge_writemem_ind" title='bge_writemem_ind' data-use='c' data-ref="bge_writemem_ind" data-ref-filename="bge_writemem_ind">bge_writemem_ind</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>, <a class="macro" href="if_bgereg.h.html#81" title="0x00000B80" data-ref="_M/BGE_SRAM_FW_CMD_DATA_MB">BGE_SRAM_FW_CMD_DATA_MB</a>,</td></tr>
<tr><th id="4706">4706</th><td>			    <a class="macro" href="if_bgereg.h.html#105" title="3" data-ref="_M/BGE_FW_HB_TIMEOUT_SEC">BGE_FW_HB_TIMEOUT_SEC</a>);</td></tr>
<tr><th id="4707">4707</th><td>			<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810, bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810) | 0x00004000); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1900" title="0x6810" data-ref="_M/BGE_RX_CPU_EVENT">BGE_RX_CPU_EVENT</a>,</td></tr>
<tr><th id="4708">4708</th><td>			    <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6810)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col5 ref" href="#315sc" title='sc' data-ref="315sc" data-ref-filename="315sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1900" title="0x6810" data-ref="_M/BGE_RX_CPU_EVENT">BGE_RX_CPU_EVENT</a>) |</td></tr>
<tr><th id="4709">4709</th><td>			    <a class="macro" href="if_bgereg.h.html#1909" title="0x00004000" data-ref="_M/BGE_RX_CPU_DRV_EVENT">BGE_RX_CPU_DRV_EVENT</a>);</td></tr>
<tr><th id="4710">4710</th><td>		}</td></tr>
<tr><th id="4711">4711</th><td>	}</td></tr>
<tr><th id="4712">4712</th><td>}</td></tr>
<tr><th id="4713">4713</th><td></td></tr>
<tr><th id="4714">4714</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4715">4715</th><td><dfn class="tu decl def fn" id="bge_tick" title='bge_tick' data-type='void bge_tick(void * xsc)' data-ref="bge_tick" data-ref-filename="bge_tick">bge_tick</dfn>(<em>void</em> *<dfn class="local col6 decl" id="316xsc" title='xsc' data-type='void *' data-ref="316xsc" data-ref-filename="316xsc">xsc</dfn>)</td></tr>
<tr><th id="4716">4716</th><td>{</td></tr>
<tr><th id="4717">4717</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="317sc" title='sc' data-type='struct bge_softc *' data-ref="317sc" data-ref-filename="317sc">sc</dfn> = <a class="local col6 ref" href="#316xsc" title='xsc' data-ref="316xsc" data-ref-filename="316xsc">xsc</a>;</td></tr>
<tr><th id="4718">4718</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col8 decl" id="318mii" title='mii' data-type='struct mii_data *' data-ref="318mii" data-ref-filename="318mii">mii</dfn> = &amp;<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="4719">4719</th><td>	<em>int</em> <dfn class="local col9 decl" id="319s" title='s' data-type='int' data-ref="319s" data-ref-filename="319s">s</dfn>;</td></tr>
<tr><th id="4720">4720</th><td></td></tr>
<tr><th id="4721">4721</th><td>	<a class="local col9 ref" href="#319s" title='s' data-ref="319s" data-ref-filename="319s">s</a> = <a class="macro" href="../../sys/intr.h.html#92" title="splvm()" data-ref="_M/splnet">splnet</a>();</td></tr>
<tr><th id="4722">4722</th><td></td></tr>
<tr><th id="4723">4723</th><td>	<b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>))</td></tr>
<tr><th id="4724">4724</th><td>		<a class="tu ref fn" href="#bge_stats_update_regs" title='bge_stats_update_regs' data-use='c' data-ref="bge_stats_update_regs" data-ref-filename="bge_stats_update_regs">bge_stats_update_regs</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>);</td></tr>
<tr><th id="4725">4725</th><td>	<b>else</b></td></tr>
<tr><th id="4726">4726</th><td>		<a class="tu ref fn" href="#bge_stats_update" title='bge_stats_update' data-use='c' data-ref="bge_stats_update" data-ref-filename="bge_stats_update">bge_stats_update</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>);</td></tr>
<tr><th id="4727">4727</th><td></td></tr>
<tr><th id="4728">4728</th><td>	<b>if</b> (<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="4729">4729</th><td>		<i>/*</i></td></tr>
<tr><th id="4730">4730</th><td><i>		 * Since in TBI mode auto-polling can't be used we should poll</i></td></tr>
<tr><th id="4731">4731</th><td><i>		 * link status manually. Here we register pending link event</i></td></tr>
<tr><th id="4732">4732</th><td><i>		 * and trigger interrupt.</i></td></tr>
<tr><th id="4733">4733</th><td><i>		 */</i></td></tr>
<tr><th id="4734">4734</th><td>		<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000002))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>, <a class="macro" href="if_bgevar.h.html#319" title="0x00000002" data-ref="_M/BGE_STS_LINK_EVT">BGE_STS_LINK_EVT</a>);</td></tr>
<tr><th id="4735">4735</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808) | (0x00000004)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>, <a class="macro" href="if_bgereg.h.html#2053" title="0x00000004" data-ref="_M/BGE_MLC_INTR_SET">BGE_MLC_INTR_SET</a>);</td></tr>
<tr><th id="4736">4736</th><td>	} <b>else</b> {</td></tr>
<tr><th id="4737">4737</th><td>		<i>/*</i></td></tr>
<tr><th id="4738">4738</th><td><i>		 * Do not touch PHY if we have link up. This could break</i></td></tr>
<tr><th id="4739">4739</th><td><i>		 * IPMI/ASF mode or produce extra input errors.</i></td></tr>
<tr><th id="4740">4740</th><td><i>		 * (extra input errors was reported for bcm5701 &amp; bcm5704).</i></td></tr>
<tr><th id="4741">4741</th><td><i>		 */</i></td></tr>
<tr><th id="4742">4742</th><td>		<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>))</td></tr>
<tr><th id="4743">4743</th><td>			<a class="ref fn" href="../mii/miivar.h.html#mii_tick" title='mii_tick' data-ref="mii_tick" data-ref-filename="mii_tick">mii_tick</a>(<a class="local col8 ref" href="#318mii" title='mii' data-ref="318mii" data-ref-filename="318mii">mii</a>);</td></tr>
<tr><th id="4744">4744</th><td>	}</td></tr>
<tr><th id="4745">4745</th><td></td></tr>
<tr><th id="4746">4746</th><td>	<a class="tu ref fn" href="#bge_asf_driver_up" title='bge_asf_driver_up' data-use='c' data-ref="bge_asf_driver_up" data-ref-filename="bge_asf_driver_up">bge_asf_driver_up</a>(<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>);</td></tr>
<tr><th id="4747">4747</th><td></td></tr>
<tr><th id="4748">4748</th><td>	<b>if</b> (!<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_detaching" title='bge_softc::bge_detaching' data-ref="bge_softc::bge_detaching" data-ref-filename="bge_softc..bge_detaching">bge_detaching</a>)</td></tr>
<tr><th id="4749">4749</th><td>		<a class="ref fn" href="../../sys/callout.h.html#callout_reset" title='callout_reset' data-ref="callout_reset" data-ref-filename="callout_reset">callout_reset</a>(&amp;<a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_timeout" title='bge_softc::bge_timeout' data-ref="bge_softc::bge_timeout" data-ref-filename="bge_softc..bge_timeout">bge_timeout</a>, <a class="ref" href="../../sys/kernel.h.html#hz" title='hz' data-ref="hz" data-ref-filename="hz">hz</a>, <a class="tu ref fn" href="#bge_tick" title='bge_tick' data-use='r' data-ref="bge_tick" data-ref-filename="bge_tick">bge_tick</a>, <a class="local col7 ref" href="#317sc" title='sc' data-ref="317sc" data-ref-filename="317sc">sc</a>);</td></tr>
<tr><th id="4750">4750</th><td></td></tr>
<tr><th id="4751">4751</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col9 ref" href="#319s" title='s' data-ref="319s" data-ref-filename="319s">s</a>);</td></tr>
<tr><th id="4752">4752</th><td>}</td></tr>
<tr><th id="4753">4753</th><td></td></tr>
<tr><th id="4754">4754</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4755">4755</th><td><dfn class="tu decl def fn" id="bge_stats_update_regs" title='bge_stats_update_regs' data-type='void bge_stats_update_regs(struct bge_softc * sc)' data-ref="bge_stats_update_regs" data-ref-filename="bge_stats_update_regs">bge_stats_update_regs</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="320sc" title='sc' data-type='struct bge_softc *' data-ref="320sc" data-ref-filename="320sc">sc</dfn>)</td></tr>
<tr><th id="4756">4756</th><td>{</td></tr>
<tr><th id="4757">4757</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col1 decl" id="321ifp" title='ifp' data-type='struct ifnet *' data-ref="321ifp" data-ref-filename="321ifp">ifp</dfn> = &amp;<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="4758">4758</th><td></td></tr>
<tr><th id="4759">4759</th><td>	<a class="local col1 ref" href="#321ifp" title='ifp' data-ref="321ifp" data-ref-filename="321ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#407" title="if_data.ifi_collisions" data-ref="_M/if_collisions">if_collisions</a> += <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0800 + __builtin_offsetof(struct bge_mac_stats_regs, etherStatsCollisions))" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#694" title="0x0800" data-ref="_M/BGE_MAC_STATS">BGE_MAC_STATS</a> +</td></tr>
<tr><th id="4760">4760</th><td>	    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_mac_stats_regs, etherStatsCollisions)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_mac_stats_regs" title='bge_mac_stats_regs' data-ref="bge_mac_stats_regs" data-ref-filename="bge_mac_stats_regs">bge_mac_stats_regs</a>, etherStatsCollisions));</td></tr>
<tr><th id="4761">4761</th><td></td></tr>
<tr><th id="4762">4762</th><td>	<i>/*</i></td></tr>
<tr><th id="4763">4763</th><td><i>	 * On BCM5717, BCM5718, BCM5719 A0 and BCM5720 A0,</i></td></tr>
<tr><th id="4764">4764</th><td><i>	 * RXLP_LOCSTAT_IFIN_DROPS includes unwanted multicast frames</i></td></tr>
<tr><th id="4765">4765</th><td><i>	 * (silicon bug). There's no reliable workaround so just</i></td></tr>
<tr><th id="4766">4766</th><td><i>	 * ignore the counter</i></td></tr>
<tr><th id="4767">4767</th><td><i>	 */</i></td></tr>
<tr><th id="4768">4768</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#376" title="0x5717" data-ref="_M/BGE_ASICREV_BCM5717">BGE_ASICREV_BCM5717</a> &amp;&amp;</td></tr>
<tr><th id="4769">4769</th><td>	    <a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#347" title="0x05719000" data-ref="_M/BGE_CHIPID_BCM5719_A0">BGE_CHIPID_BCM5719_A0</a> &amp;&amp;</td></tr>
<tr><th id="4770">4770</th><td>	    <a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> != <a class="macro" href="if_bgereg.h.html#348" title="0x05720000" data-ref="_M/BGE_CHIPID_BCM5720_A0">BGE_CHIPID_BCM5720_A0</a>) {</td></tr>
<tr><th id="4771">4771</th><td>		<a class="local col1 ref" href="#321ifp" title='ifp' data-ref="321ifp" data-ref-filename="321ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a> += <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2250)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1094" title="0x2250" data-ref="_M/BGE_RXLP_LOCSTAT_IFIN_DROPS">BGE_RXLP_LOCSTAT_IFIN_DROPS</a>);</td></tr>
<tr><th id="4772">4772</th><td>	}</td></tr>
<tr><th id="4773">4773</th><td>	<a class="local col1 ref" href="#321ifp" title='ifp' data-ref="321ifp" data-ref-filename="321ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a> += <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x2254)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1095" title="0x2254" data-ref="_M/BGE_RXLP_LOCSTAT_IFIN_ERRORS">BGE_RXLP_LOCSTAT_IFIN_ERRORS</a>);</td></tr>
<tr><th id="4774">4774</th><td>	<a class="local col1 ref" href="#321ifp" title='ifp' data-ref="321ifp" data-ref-filename="321ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#404" title="if_data.ifi_ierrors" data-ref="_M/if_ierrors">if_ierrors</a> += <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x224C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1093" title="0x224C" data-ref="_M/BGE_RXLP_LOCSTAT_OUT_OF_BDS">BGE_RXLP_LOCSTAT_OUT_OF_BDS</a>);</td></tr>
<tr><th id="4775">4775</th><td></td></tr>
<tr><th id="4776">4776</th><td>	<b>if</b> (<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2684" title="0x00800000" data-ref="_M/BGEF_RDMA_BUG">BGEF_RDMA_BUG</a>) {</td></tr>
<tr><th id="4777">4777</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="322val" title='val' data-type='uint32_t' data-ref="322val" data-ref-filename="322val">val</dfn>, <dfn class="local col3 decl" id="323ucast" title='ucast' data-type='uint32_t' data-ref="323ucast" data-ref-filename="323ucast">ucast</dfn>, <dfn class="local col4 decl" id="324mcast" title='mcast' data-type='uint32_t' data-ref="324mcast" data-ref-filename="324mcast">mcast</dfn>, <dfn class="local col5 decl" id="325bcast" title='bcast' data-type='uint32_t' data-ref="325bcast" data-ref-filename="325bcast">bcast</dfn>;</td></tr>
<tr><th id="4778">4778</th><td></td></tr>
<tr><th id="4779">4779</th><td>		<a class="local col3 ref" href="#323ucast" title='ucast' data-ref="323ucast" data-ref-filename="323ucast">ucast</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0800 + __builtin_offsetof(struct bge_mac_stats_regs, ifHCOutUcastPkts))" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#694" title="0x0800" data-ref="_M/BGE_MAC_STATS">BGE_MAC_STATS</a> +</td></tr>
<tr><th id="4780">4780</th><td>		    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_mac_stats_regs, ifHCOutUcastPkts)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_mac_stats_regs" title='bge_mac_stats_regs' data-ref="bge_mac_stats_regs" data-ref-filename="bge_mac_stats_regs">bge_mac_stats_regs</a>, ifHCOutUcastPkts));</td></tr>
<tr><th id="4781">4781</th><td>		<a class="local col4 ref" href="#324mcast" title='mcast' data-ref="324mcast" data-ref-filename="324mcast">mcast</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0800 + __builtin_offsetof(struct bge_mac_stats_regs, ifHCOutMulticastPkts))" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#694" title="0x0800" data-ref="_M/BGE_MAC_STATS">BGE_MAC_STATS</a> +</td></tr>
<tr><th id="4782">4782</th><td>		    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_mac_stats_regs, ifHCOutMulticastPkts)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_mac_stats_regs" title='bge_mac_stats_regs' data-ref="bge_mac_stats_regs" data-ref-filename="bge_mac_stats_regs">bge_mac_stats_regs</a>, ifHCOutMulticastPkts));</td></tr>
<tr><th id="4783">4783</th><td>		<a class="local col5 ref" href="#325bcast" title='bcast' data-ref="325bcast" data-ref-filename="325bcast">bcast</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0800 + __builtin_offsetof(struct bge_mac_stats_regs, ifHCOutBroadcastPkts))" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#694" title="0x0800" data-ref="_M/BGE_MAC_STATS">BGE_MAC_STATS</a> +</td></tr>
<tr><th id="4784">4784</th><td>		    <a class="macro" href="../../lib/libkern/libkern.h.html#310" title="__builtin_offsetof(struct bge_mac_stats_regs, ifHCOutBroadcastPkts)" data-ref="_M/offsetof">offsetof</a>(<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_mac_stats_regs" title='bge_mac_stats_regs' data-ref="bge_mac_stats_regs" data-ref-filename="bge_mac_stats_regs">bge_mac_stats_regs</a>, ifHCOutBroadcastPkts));</td></tr>
<tr><th id="4785">4785</th><td></td></tr>
<tr><th id="4786">4786</th><td>		<i>/*</i></td></tr>
<tr><th id="4787">4787</th><td><i>		 * If controller transmitted more than BGE_NUM_RDMA_CHANNELS</i></td></tr>
<tr><th id="4788">4788</th><td><i>		 * frames, it's safe to disable workaround for DMA engine's</i></td></tr>
<tr><th id="4789">4789</th><td><i>		 * miscalculation of TXMBUF space.</i></td></tr>
<tr><th id="4790">4790</th><td><i>		 */</i></td></tr>
<tr><th id="4791">4791</th><td>		<b>if</b> (<a class="local col3 ref" href="#323ucast" title='ucast' data-ref="323ucast" data-ref-filename="323ucast">ucast</a> + <a class="local col4 ref" href="#324mcast" title='mcast' data-ref="324mcast" data-ref-filename="324mcast">mcast</a> + <a class="local col5 ref" href="#325bcast" title='bcast' data-ref="325bcast" data-ref-filename="325bcast">bcast</a> &gt; <a class="macro" href="if_bgereg.h.html#1575" title="4" data-ref="_M/BGE_NUM_RDMA_CHANNELS">BGE_NUM_RDMA_CHANNELS</a>) {</td></tr>
<tr><th id="4792">4792</th><td>			<a class="local col2 ref" href="#322val" title='val' data-ref="322val" data-ref-filename="322val">val</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>);</td></tr>
<tr><th id="4793">4793</th><td>			<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#377" title="0x5719" data-ref="_M/BGE_ASICREV_BCM5719">BGE_ASICREV_BCM5719</a>)</td></tr>
<tr><th id="4794">4794</th><td>				<a class="local col2 ref" href="#322val" title='val' data-ref="322val" data-ref-filename="322val">val</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1555" title="0x02000000" data-ref="_M/BGE_RDMA_TX_LENGTH_WA_5719">BGE_RDMA_TX_LENGTH_WA_5719</a>;</td></tr>
<tr><th id="4795">4795</th><td>			<b>else</b></td></tr>
<tr><th id="4796">4796</th><td>				<a class="local col2 ref" href="#322val" title='val' data-ref="322val" data-ref-filename="322val">val</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1556" title="0x00200000" data-ref="_M/BGE_RDMA_TX_LENGTH_WA_5720">BGE_RDMA_TX_LENGTH_WA_5720</a>;</td></tr>
<tr><th id="4797">4797</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x4910, val)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1507" title="0x4910" data-ref="_M/BGE_RDMA_LSO_CRPTEN_CTRL">BGE_RDMA_LSO_CRPTEN_CTRL</a>, <a class="local col2 ref" href="#322val" title='val' data-ref="322val" data-ref-filename="322val">val</a>);</td></tr>
<tr><th id="4798">4798</th><td>			<a class="local col0 ref" href="#320sc" title='sc' data-ref="320sc" data-ref-filename="320sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#2684" title="0x00800000" data-ref="_M/BGEF_RDMA_BUG">BGEF_RDMA_BUG</a>;</td></tr>
<tr><th id="4799">4799</th><td>		}</td></tr>
<tr><th id="4800">4800</th><td>	}</td></tr>
<tr><th id="4801">4801</th><td>}</td></tr>
<tr><th id="4802">4802</th><td></td></tr>
<tr><th id="4803">4803</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="4804">4804</th><td><dfn class="tu decl def fn" id="bge_stats_update" title='bge_stats_update' data-type='void bge_stats_update(struct bge_softc * sc)' data-ref="bge_stats_update" data-ref-filename="bge_stats_update">bge_stats_update</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="326sc" title='sc' data-type='struct bge_softc *' data-ref="326sc" data-ref-filename="326sc">sc</dfn>)</td></tr>
<tr><th id="4805">4805</th><td>{</td></tr>
<tr><th id="4806">4806</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col7 decl" id="327ifp" title='ifp' data-type='struct ifnet *' data-ref="327ifp" data-ref-filename="327ifp">ifp</dfn> = &amp;<a class="local col6 ref" href="#326sc" title='sc' data-ref="326sc" data-ref-filename="326sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="4807">4807</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_size_t" title='bus_size_t' data-type='size_t' data-ref="bus_size_t" data-ref-filename="bus_size_t">bus_size_t</a> <dfn class="local col8 decl" id="328stats" title='stats' data-type='bus_size_t' data-ref="328stats" data-ref-filename="328stats">stats</dfn> = <a class="macro" href="if_bgereg.h.html#2112" title="0x00008000" data-ref="_M/BGE_MEMWIN_START">BGE_MEMWIN_START</a> + <a class="macro" href="if_bgereg.h.html#71" title="0x00000300" data-ref="_M/BGE_STATS_BLOCK">BGE_STATS_BLOCK</a>;</td></tr>
<tr><th id="4808">4808</th><td></td></tr>
<tr><th id="4809">4809</th><td><u>#define <dfn class="macro" id="_M/READ_STAT" data-ref="_M/READ_STAT">READ_STAT</dfn>(sc, stats, stat) \</u></td></tr>
<tr><th id="4810">4810</th><td><u>	  CSR_READ_4(sc, stats + offsetof(struct <a class="type" href="if_bgereg.h.html#bge_stats" title='bge_stats' data-ref="bge_stats" data-ref-filename="bge_stats">bge_stats</a>, stat))</u></td></tr>
<tr><th id="4811">4811</th><td></td></tr>
<tr><th id="4812">4812</th><td>	<a class="local col7 ref" href="#327ifp" title='ifp' data-ref="327ifp" data-ref-filename="327ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#407" title="if_data.ifi_collisions" data-ref="_M/if_collisions">if_collisions</a> +=</td></tr>
<tr><th id="4813">4813</th><td>	  (<a class="macro" href="#4809" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, stats + __builtin_offsetof(struct bge_stats, dot3StatsSingleCollisionFrames.bge_addr_lo))" data-ref="_M/READ_STAT">READ_STAT</a>(<a class="local col6 ref" href="#326sc" title='sc' data-ref="326sc" data-ref-filename="326sc">sc</a>, <a class="local col8 ref" href="#328stats" title='stats' data-ref="328stats" data-ref-filename="328stats">stats</a>, dot3StatsSingleCollisionFrames.bge_addr_lo) +</td></tr>
<tr><th id="4814">4814</th><td>	   <a class="macro" href="#4809" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, stats + __builtin_offsetof(struct bge_stats, dot3StatsMultipleCollisionFrames.bge_addr_lo))" data-ref="_M/READ_STAT">READ_STAT</a>(<a class="local col6 ref" href="#326sc" title='sc' data-ref="326sc" data-ref-filename="326sc">sc</a>, <a class="local col8 ref" href="#328stats" title='stats' data-ref="328stats" data-ref-filename="328stats">stats</a>, dot3StatsMultipleCollisionFrames.bge_addr_lo) +</td></tr>
<tr><th id="4815">4815</th><td>	   <a class="macro" href="#4809" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, stats + __builtin_offsetof(struct bge_stats, dot3StatsExcessiveCollisions.bge_addr_lo))" data-ref="_M/READ_STAT">READ_STAT</a>(<a class="local col6 ref" href="#326sc" title='sc' data-ref="326sc" data-ref-filename="326sc">sc</a>, <a class="local col8 ref" href="#328stats" title='stats' data-ref="328stats" data-ref-filename="328stats">stats</a>, dot3StatsExcessiveCollisions.bge_addr_lo) +</td></tr>
<tr><th id="4816">4816</th><td>	   <a class="macro" href="#4809" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, stats + __builtin_offsetof(struct bge_stats, dot3StatsLateCollisions.bge_addr_lo))" data-ref="_M/READ_STAT">READ_STAT</a>(<a class="local col6 ref" href="#326sc" title='sc' data-ref="326sc" data-ref-filename="326sc">sc</a>, <a class="local col8 ref" href="#328stats" title='stats' data-ref="328stats" data-ref-filename="328stats">stats</a>, dot3StatsLateCollisions.bge_addr_lo)) -</td></tr>
<tr><th id="4817">4817</th><td>	  <a class="local col7 ref" href="#327ifp" title='ifp' data-ref="327ifp" data-ref-filename="327ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#407" title="if_data.ifi_collisions" data-ref="_M/if_collisions">if_collisions</a>;</td></tr>
<tr><th id="4818">4818</th><td></td></tr>
<tr><th id="4819">4819</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_tx_xoff,</td></tr>
<tr><th id="4820">4820</th><td>		      READ_STAT(sc, stats, outXoffSent.bge_addr_lo));</td></tr>
<tr><th id="4821">4821</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_tx_xon,</td></tr>
<tr><th id="4822">4822</th><td>		      READ_STAT(sc, stats, outXonSent.bge_addr_lo));</td></tr>
<tr><th id="4823">4823</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_rx_xoff,</td></tr>
<tr><th id="4824">4824</th><td>		      READ_STAT(sc, stats,</td></tr>
<tr><th id="4825">4825</th><td>				xoffPauseFramesReceived.bge_addr_lo));</td></tr>
<tr><th id="4826">4826</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_rx_xon,</td></tr>
<tr><th id="4827">4827</th><td>		      READ_STAT(sc, stats, xonPauseFramesReceived.bge_addr_lo));</td></tr>
<tr><th id="4828">4828</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_rx_macctl,</td></tr>
<tr><th id="4829">4829</th><td>		      READ_STAT(sc, stats,</td></tr>
<tr><th id="4830">4830</th><td>				macControlFramesReceived.bge_addr_lo));</td></tr>
<tr><th id="4831">4831</th><td>	<a class="macro" href="#294" title="" data-ref="_M/BGE_EVCNT_UPD">BGE_EVCNT_UPD</a>(sc-&gt;bge_ev_xoffentered,</td></tr>
<tr><th id="4832">4832</th><td>		      READ_STAT(sc, stats, xoffStateEntered.bge_addr_lo));</td></tr>
<tr><th id="4833">4833</th><td></td></tr>
<tr><th id="4834">4834</th><td><u>#undef <a class="macro" href="#4809" data-ref="_M/READ_STAT">READ_STAT</a></u></td></tr>
<tr><th id="4835">4835</th><td></td></tr>
<tr><th id="4836">4836</th><td><u>#<span data-ppcond="4836">ifdef</span> <span class="macro" data-ref="_M/notdef">notdef</span></u></td></tr>
<tr><th id="4837">4837</th><td>	ifp-&gt;if_collisions +=</td></tr>
<tr><th id="4838">4838</th><td>	   (sc-&gt;bge_rdata-&gt;bge_info.bge_stats.dot3StatsSingleCollisionFrames +</td></tr>
<tr><th id="4839">4839</th><td>	   sc-&gt;bge_rdata-&gt;bge_info.bge_stats.dot3StatsMultipleCollisionFrames +</td></tr>
<tr><th id="4840">4840</th><td>	   sc-&gt;bge_rdata-&gt;bge_info.bge_stats.dot3StatsExcessiveCollisions +</td></tr>
<tr><th id="4841">4841</th><td>	   sc-&gt;bge_rdata-&gt;bge_info.bge_stats.dot3StatsLateCollisions) -</td></tr>
<tr><th id="4842">4842</th><td>	   ifp-&gt;if_collisions;</td></tr>
<tr><th id="4843">4843</th><td><u>#<span data-ppcond="4836">endif</span></u></td></tr>
<tr><th id="4844">4844</th><td>}</td></tr>
<tr><th id="4845">4845</th><td></td></tr>
<tr><th id="4846">4846</th><td><i  data-doc="bge_cksum_pad">/*</i></td></tr>
<tr><th id="4847">4847</th><td><i  data-doc="bge_cksum_pad"> * Pad outbound frame to ETHER_MIN_NOPAD for an unusual reason.</i></td></tr>
<tr><th id="4848">4848</th><td><i  data-doc="bge_cksum_pad"> * The bge hardware will pad out Tx runts to ETHER_MIN_NOPAD,</i></td></tr>
<tr><th id="4849">4849</th><td><i  data-doc="bge_cksum_pad"> * but when such padded frames employ the  bge IP/TCP checksum offload,</i></td></tr>
<tr><th id="4850">4850</th><td><i  data-doc="bge_cksum_pad"> * the hardware checksum assist gives incorrect results (possibly</i></td></tr>
<tr><th id="4851">4851</th><td><i  data-doc="bge_cksum_pad"> * from incorporating its own padding into the UDP/TCP checksum; who knows).</i></td></tr>
<tr><th id="4852">4852</th><td><i  data-doc="bge_cksum_pad"> * If we pad such runts with zeros, the onboard checksum comes out correct.</i></td></tr>
<tr><th id="4853">4853</th><td><i  data-doc="bge_cksum_pad"> */</i></td></tr>
<tr><th id="4854">4854</th><td><em>static</em> <b>inline</b> <em>int</em></td></tr>
<tr><th id="4855">4855</th><td><dfn class="tu decl def fn" id="bge_cksum_pad" title='bge_cksum_pad' data-type='int bge_cksum_pad(struct mbuf * pkt)' data-ref="bge_cksum_pad" data-ref-filename="bge_cksum_pad">bge_cksum_pad</dfn>(<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col9 decl" id="329pkt" title='pkt' data-type='struct mbuf *' data-ref="329pkt" data-ref-filename="329pkt">pkt</dfn>)</td></tr>
<tr><th id="4856">4856</th><td>{</td></tr>
<tr><th id="4857">4857</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col0 decl" id="330last" title='last' data-type='struct mbuf *' data-ref="330last" data-ref-filename="330last">last</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4858">4858</th><td>	<em>int</em> <dfn class="local col1 decl" id="331padlen" title='padlen' data-type='int' data-ref="331padlen" data-ref-filename="331padlen">padlen</dfn>;</td></tr>
<tr><th id="4859">4859</th><td></td></tr>
<tr><th id="4860">4860</th><td>	<a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a> = <a class="macro" href="#129" title="(64 - 4)" data-ref="_M/ETHER_MIN_NOPAD">ETHER_MIN_NOPAD</a> - <a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a>;</td></tr>
<tr><th id="4861">4861</th><td></td></tr>
<tr><th id="4862">4862</th><td>	<i>/* if there's only the packet-header and we can pad there, use it. */</i></td></tr>
<tr><th id="4863">4863</th><td>	<b>if</b> (<a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> == <a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> &amp;&amp;</td></tr>
<tr><th id="4864">4864</th><td>	    <a class="macro" href="../../sys/mbuf.h.html#555" title="(((((pkt))-&gt;m_hdr.mh_flags &amp; 0x00000001) != 0 &amp;&amp; ((((pkt))-&gt;m_hdr.mh_flags &amp; (0x04000000|0x08000000)) != 0x08000000 || ((pkt))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_refcnt &gt; 1)) ? 0 : (((pkt))-&gt;m_hdr.mh_flags &amp; 0x00000001 ? ((pkt))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_buf + ((pkt))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_size - (((pkt))-&gt;m_hdr.mh_data + ((pkt))-&gt;m_hdr.mh_len) : &amp;((pkt))-&gt;M_dat.M_databuf[(512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf))] - (((pkt))-&gt;m_hdr.mh_data + ((pkt))-&gt;m_hdr.mh_len)))" data-ref="_M/M_TRAILINGSPACE">M_TRAILINGSPACE</a>(<a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>) &gt;= <a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a>) {</td></tr>
<tr><th id="4865">4865</th><td>		<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a> = <a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>;</td></tr>
<tr><th id="4866">4866</th><td>	} <b>else</b> {</td></tr>
<tr><th id="4867">4867</th><td>		<i>/*</i></td></tr>
<tr><th id="4868">4868</th><td><i>		 * Walk packet chain to find last mbuf. We will either</i></td></tr>
<tr><th id="4869">4869</th><td><i>		 * pad there, or append a new mbuf and pad it</i></td></tr>
<tr><th id="4870">4870</th><td><i>		 * (thus perhaps avoiding the bcm5700 dma-min bug).</i></td></tr>
<tr><th id="4871">4871</th><td><i>		 */</i></td></tr>
<tr><th id="4872">4872</th><td>		<b>for</b> (<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a> = <a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>; <a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; <a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a> = <a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>) {</td></tr>
<tr><th id="4873">4873</th><td>		       <b>continue</b>; <i>/* do nothing */</i></td></tr>
<tr><th id="4874">4874</th><td>		}</td></tr>
<tr><th id="4875">4875</th><td></td></tr>
<tr><th id="4876">4876</th><td>		<i>/* `last' now points to last in chain. */</i></td></tr>
<tr><th id="4877">4877</th><td>		<b>if</b> (<a class="macro" href="../../sys/mbuf.h.html#555" title="(((((last))-&gt;m_hdr.mh_flags &amp; 0x00000001) != 0 &amp;&amp; ((((last))-&gt;m_hdr.mh_flags &amp; (0x04000000|0x08000000)) != 0x08000000 || ((last))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_refcnt &gt; 1)) ? 0 : (((last))-&gt;m_hdr.mh_flags &amp; 0x00000001 ? ((last))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_buf + ((last))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_size - (((last))-&gt;m_hdr.mh_data + ((last))-&gt;m_hdr.mh_len) : &amp;((last))-&gt;M_dat.M_databuf[(512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf))] - (((last))-&gt;m_hdr.mh_data + ((last))-&gt;m_hdr.mh_len)))" data-ref="_M/M_TRAILINGSPACE">M_TRAILINGSPACE</a>(<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>) &lt; <a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a>) {</td></tr>
<tr><th id="4878">4878</th><td>			<i>/* Allocate new empty mbuf, pad it. Compact later. */</i></td></tr>
<tr><th id="4879">4879</th><td>			<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col2 decl" id="332n" title='n' data-type='struct mbuf *' data-ref="332n" data-ref-filename="332n">n</dfn>;</td></tr>
<tr><th id="4880">4880</th><td>			<a class="macro" href="../../sys/mbuf.h.html#449" title="n = m_get((0x0001), (1))" data-ref="_M/MGET">MGET</a>(<a class="local col2 ref" href="#332n" title='n' data-ref="332n" data-ref-filename="332n">n</a>, <a class="macro" href="../../sys/mbuf.h.html#410" title="0x0001" data-ref="_M/M_DONTWAIT">M_DONTWAIT</a>, <a class="macro" href="../../sys/mbuf.h.html#386" title="1" data-ref="_M/MT_DATA">MT_DATA</a>);</td></tr>
<tr><th id="4881">4881</th><td>			<b>if</b> (<a class="local col2 ref" href="#332n" title='n' data-ref="332n" data-ref-filename="332n">n</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="4882">4882</th><td>				<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="4883">4883</th><td>			<a class="local col2 ref" href="#332n" title='n' data-ref="332n" data-ref-filename="332n">n</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <var>0</var>;</td></tr>
<tr><th id="4884">4884</th><td>			<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> = <a class="local col2 ref" href="#332n" title='n' data-ref="332n" data-ref-filename="332n">n</a>;</td></tr>
<tr><th id="4885">4885</th><td>			<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a> = <a class="local col2 ref" href="#332n" title='n' data-ref="332n" data-ref-filename="332n">n</a>;</td></tr>
<tr><th id="4886">4886</th><td>		}</td></tr>
<tr><th id="4887">4887</th><td>	}</td></tr>
<tr><th id="4888">4888</th><td></td></tr>
<tr><th id="4889">4889</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#290" title="((void)0)" data-ref="_M/KDASSERT">KDASSERT</a>(!M_READONLY(last));</td></tr>
<tr><th id="4890">4890</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#290" title="((void)0)" data-ref="_M/KDASSERT">KDASSERT</a>(M_TRAILINGSPACE(last) &gt;= padlen);</td></tr>
<tr><th id="4891">4891</th><td></td></tr>
<tr><th id="4892">4892</th><td>	<i>/* Now zero the pad area, to avoid the bge cksum-assist bug */</i></td></tr>
<tr><th id="4893">4893</th><td>	<a class="macro" href="../../lib/libkern/libkern.h.html#382" title="__builtin_memset(((char *)((last)-&gt;m_hdr.mh_data)) + last-&gt;m_hdr.mh_len, 0, padlen)" data-ref="_M/memset">memset</a>(<a class="macro" href="../../sys/mbuf.h.html#147" title="((char *)((last)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>, <em>char</em> *) + <a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>, <var>0</var>, <a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a>);</td></tr>
<tr><th id="4894">4894</th><td>	<a class="local col0 ref" href="#330last" title='last' data-ref="330last" data-ref-filename="330last">last</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> += <a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a>;</td></tr>
<tr><th id="4895">4895</th><td>	<a class="local col9 ref" href="#329pkt" title='pkt' data-ref="329pkt" data-ref-filename="329pkt">pkt</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> += <a class="local col1 ref" href="#331padlen" title='padlen' data-ref="331padlen" data-ref-filename="331padlen">padlen</a>;</td></tr>
<tr><th id="4896">4896</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="4897">4897</th><td>}</td></tr>
<tr><th id="4898">4898</th><td></td></tr>
<tr><th id="4899">4899</th><td><i  data-doc="bge_compact_dma_runt">/*</i></td></tr>
<tr><th id="4900">4900</th><td><i  data-doc="bge_compact_dma_runt"> * Compact outbound packets to avoid bug with DMA segments less than 8 bytes.</i></td></tr>
<tr><th id="4901">4901</th><td><i  data-doc="bge_compact_dma_runt"> */</i></td></tr>
<tr><th id="4902">4902</th><td><em>static</em> <b>inline</b> <em>int</em></td></tr>
<tr><th id="4903">4903</th><td><dfn class="tu decl def fn" id="bge_compact_dma_runt" title='bge_compact_dma_runt' data-type='int bge_compact_dma_runt(struct mbuf * pkt)' data-ref="bge_compact_dma_runt" data-ref-filename="bge_compact_dma_runt">bge_compact_dma_runt</dfn>(<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col3 decl" id="333pkt" title='pkt' data-type='struct mbuf *' data-ref="333pkt" data-ref-filename="333pkt">pkt</dfn>)</td></tr>
<tr><th id="4904">4904</th><td>{</td></tr>
<tr><th id="4905">4905</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a>	*<dfn class="local col4 decl" id="334m" title='m' data-type='struct mbuf *' data-ref="334m" data-ref-filename="334m">m</dfn>, *<dfn class="local col5 decl" id="335prev" title='prev' data-type='struct mbuf *' data-ref="335prev" data-ref-filename="335prev">prev</dfn>;</td></tr>
<tr><th id="4906">4906</th><td>	<em>int</em>		<dfn class="local col6 decl" id="336totlen" title='totlen' data-type='int' data-ref="336totlen" data-ref-filename="336totlen">totlen</dfn>;</td></tr>
<tr><th id="4907">4907</th><td></td></tr>
<tr><th id="4908">4908</th><td>	<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4909">4909</th><td>	<a class="local col6 ref" href="#336totlen" title='totlen' data-ref="336totlen" data-ref-filename="336totlen">totlen</a> = <var>0</var>;</td></tr>
<tr><th id="4910">4910</th><td></td></tr>
<tr><th id="4911">4911</th><td>	<b>for</b> (<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a> = <a class="local col3 ref" href="#333pkt" title='pkt' data-ref="333pkt" data-ref-filename="333pkt">pkt</a>; <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a> = <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>, <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a> = <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>) {</td></tr>
<tr><th id="4912">4912</th><td>		<em>int</em> <dfn class="local col7 decl" id="337mlen" title='mlen' data-type='int' data-ref="337mlen" data-ref-filename="337mlen">mlen</dfn> = <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>;</td></tr>
<tr><th id="4913">4913</th><td>		<em>int</em> <dfn class="local col8 decl" id="338shortfall" title='shortfall' data-type='int' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</dfn> = <var>8</var> - <a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a> ;</td></tr>
<tr><th id="4914">4914</th><td></td></tr>
<tr><th id="4915">4915</th><td>		<a class="local col6 ref" href="#336totlen" title='totlen' data-ref="336totlen" data-ref-filename="336totlen">totlen</a> += <a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a>;</td></tr>
<tr><th id="4916">4916</th><td>		<b>if</b> (<a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a> == <var>0</var>)</td></tr>
<tr><th id="4917">4917</th><td>			<b>continue</b>;</td></tr>
<tr><th id="4918">4918</th><td>		<b>if</b> (<a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a> &gt;= <var>8</var>)</td></tr>
<tr><th id="4919">4919</th><td>			<b>continue</b>;</td></tr>
<tr><th id="4920">4920</th><td></td></tr>
<tr><th id="4921">4921</th><td>		<i>/* If we get here, mbuf data is too small for DMA engine.</i></td></tr>
<tr><th id="4922">4922</th><td><i>		 * Try to fix by shuffling data to prev or next in chain.</i></td></tr>
<tr><th id="4923">4923</th><td><i>		 * If that fails, do a compacting deep-copy of the whole chain.</i></td></tr>
<tr><th id="4924">4924</th><td><i>		 */</i></td></tr>
<tr><th id="4925">4925</th><td></td></tr>
<tr><th id="4926">4926</th><td>		<i>/* Internal frag. If fits in prev, copy it there. */</i></td></tr>
<tr><th id="4927">4927</th><td>		<b>if</b> (<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a> &amp;&amp; <a class="macro" href="../../sys/mbuf.h.html#555" title="(((((prev))-&gt;m_hdr.mh_flags &amp; 0x00000001) != 0 &amp;&amp; ((((prev))-&gt;m_hdr.mh_flags &amp; (0x04000000|0x08000000)) != 0x08000000 || ((prev))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_refcnt &gt; 1)) ? 0 : (((prev))-&gt;m_hdr.mh_flags &amp; 0x00000001 ? ((prev))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_buf + ((prev))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_size - (((prev))-&gt;m_hdr.mh_data + ((prev))-&gt;m_hdr.mh_len) : &amp;((prev))-&gt;M_dat.M_databuf[(512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf))] - (((prev))-&gt;m_hdr.mh_data + ((prev))-&gt;m_hdr.mh_len)))" data-ref="_M/M_TRAILINGSPACE">M_TRAILINGSPACE</a>(<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>) &gt;= <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>) {</td></tr>
<tr><th id="4928">4928</th><td>			<a class="macro" href="../../lib/libkern/libkern.h.html#380" title="__builtin_memcpy(prev-&gt;m_hdr.mh_data + prev-&gt;m_hdr.mh_len, m-&gt;m_hdr.mh_data, mlen)" data-ref="_M/memcpy">memcpy</a>(<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> + <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>, <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a>, <a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a>);</td></tr>
<tr><th id="4929">4929</th><td>			<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> += <a class="local col7 ref" href="#337mlen" title='mlen' data-ref="337mlen" data-ref-filename="337mlen">mlen</a>;</td></tr>
<tr><th id="4930">4930</th><td>			<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <var>0</var>;</td></tr>
<tr><th id="4931">4931</th><td>			<i>/* XXX stitch chain */</i></td></tr>
<tr><th id="4932">4932</th><td>			<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> = <a class="ref fn" href="../../sys/mbuf.h.html#m_free" title='m_free' data-ref="m_free" data-ref-filename="m_free">m_free</a>(<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>);</td></tr>
<tr><th id="4933">4933</th><td>			<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a> = <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>;</td></tr>
<tr><th id="4934">4934</th><td>			<b>continue</b>;</td></tr>
<tr><th id="4935">4935</th><td>		} <b>else</b> <b>if</b> (<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> &amp;&amp;</td></tr>
<tr><th id="4936">4936</th><td>			     <a class="macro" href="../../sys/mbuf.h.html#555" title="(((((m))-&gt;m_hdr.mh_flags &amp; 0x00000001) != 0 &amp;&amp; ((((m))-&gt;m_hdr.mh_flags &amp; (0x04000000|0x08000000)) != 0x08000000 || ((m))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_refcnt &gt; 1)) ? 0 : (((m))-&gt;m_hdr.mh_flags &amp; 0x00000001 ? ((m))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_buf + ((m))-&gt;M_dat.MH.MH_dat.MH_ext.ext_ref-&gt;M_dat.MH.MH_dat.MH_ext.ext_storage.ext_size - (((m))-&gt;m_hdr.mh_data + ((m))-&gt;m_hdr.mh_len) : &amp;((m))-&gt;M_dat.M_databuf[(512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf))] - (((m))-&gt;m_hdr.mh_data + ((m))-&gt;m_hdr.mh_len)))" data-ref="_M/M_TRAILINGSPACE">M_TRAILINGSPACE</a>(<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>) &gt;= <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a> &amp;&amp;</td></tr>
<tr><th id="4937">4937</th><td>			     <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> &gt;= (<var>8</var> + <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>)) {</td></tr>
<tr><th id="4938">4938</th><td>		    <i>/* m is writable and have enough data in next, pull up. */</i></td></tr>
<tr><th id="4939">4939</th><td></td></tr>
<tr><th id="4940">4940</th><td>			<a class="macro" href="../../lib/libkern/libkern.h.html#380" title="__builtin_memcpy(m-&gt;m_hdr.mh_data + m-&gt;m_hdr.mh_len, m-&gt;m_hdr.mh_next-&gt;m_hdr.mh_data, shortfall)" data-ref="_M/memcpy">memcpy</a>(<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> + <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>, <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a>,</td></tr>
<tr><th id="4941">4941</th><td>			    <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>);</td></tr>
<tr><th id="4942">4942</th><td>			<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> += <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>;</td></tr>
<tr><th id="4943">4943</th><td>			<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> -= <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>;</td></tr>
<tr><th id="4944">4944</th><td>			<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> += <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>;</td></tr>
<tr><th id="4945">4945</th><td>		} <b>else</b> <b>if</b> (<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> || <var>1</var>) {</td></tr>
<tr><th id="4946">4946</th><td>			<i>/* Got a runt at the very end of the packet.</i></td></tr>
<tr><th id="4947">4947</th><td><i>			 * borrow data from the tail of the preceding mbuf and</i></td></tr>
<tr><th id="4948">4948</th><td><i>			 * update its length in-place. (The original data is</i></td></tr>
<tr><th id="4949">4949</th><td><i>			 * still valid, so we can do this even if prev is not</i></td></tr>
<tr><th id="4950">4950</th><td><i>			 * writable.)</i></td></tr>
<tr><th id="4951">4951</th><td><i>			 */</i></td></tr>
<tr><th id="4952">4952</th><td></td></tr>
<tr><th id="4953">4953</th><td>			<i>/*</i></td></tr>
<tr><th id="4954">4954</th><td><i>			 * If we'd make prev a runt, just move all of its data.</i></td></tr>
<tr><th id="4955">4955</th><td><i>			 */</i></td></tr>
<tr><th id="4956">4956</th><td>			<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((prev != ((void *)0))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;prev != NULL&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 4956))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> <i>/*, ("runt but null PREV")*/</i>);</td></tr>
<tr><th id="4957">4957</th><td>			<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((prev-&gt;m_hdr.mh_len &gt;= 8)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;prev-&gt;m_len &gt;= 8&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 4957))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> &gt;= <var>8</var> <i>/*, ("runt prev")*/</i>);</td></tr>
<tr><th id="4958">4958</th><td></td></tr>
<tr><th id="4959">4959</th><td>			<b>if</b> ((<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> - <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>) &lt; <var>8</var>)</td></tr>
<tr><th id="4960">4960</th><td>				<a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a> = <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>;</td></tr>
<tr><th id="4961">4961</th><td></td></tr>
<tr><th id="4962">4962</th><td><u>#<span data-ppcond="4962">ifdef</span> <span class="macro" data-ref="_M/notyet">notyet</span>	/* just do the safe slow thing for now */</u></td></tr>
<tr><th id="4963">4963</th><td>			<b>if</b> (!M_READONLY(m)) {</td></tr>
<tr><th id="4964">4964</th><td>				<b>if</b> (M_LEADINGSPACE(m) &lt; shorfall) {</td></tr>
<tr><th id="4965">4965</th><td>					<em>void</em> *m_dat;</td></tr>
<tr><th id="4966">4966</th><td>					m_dat = (m-&gt;m_flags &amp; M_PKTHDR) ?</td></tr>
<tr><th id="4967">4967</th><td>					    m-&gt;m_pktdat : m-&gt;dat;</td></tr>
<tr><th id="4968">4968</th><td>					memmove(m_dat, mtod(m, <em>void</em>*),</td></tr>
<tr><th id="4969">4969</th><td>					    m-&gt;m_len);</td></tr>
<tr><th id="4970">4970</th><td>					m-&gt;m_data = m_dat;</td></tr>
<tr><th id="4971">4971</th><td>				}</td></tr>
<tr><th id="4972">4972</th><td>			} <b>else</b></td></tr>
<tr><th id="4973">4973</th><td><u>#<span data-ppcond="4962">endif</span>	/* just do the safe slow thing */</u></td></tr>
<tr><th id="4974">4974</th><td>			{</td></tr>
<tr><th id="4975">4975</th><td>				<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> * <dfn class="local col9 decl" id="339n" title='n' data-type='struct mbuf *' data-ref="339n" data-ref-filename="339n">n</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="4976">4976</th><td>				<em>int</em> <dfn class="local col0 decl" id="340newprevlen" title='newprevlen' data-type='int' data-ref="340newprevlen" data-ref-filename="340newprevlen">newprevlen</dfn> = <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> - <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>;</td></tr>
<tr><th id="4977">4977</th><td></td></tr>
<tr><th id="4978">4978</th><td>				<a class="macro" href="../../sys/mbuf.h.html#449" title="n = m_get((0x0001), (1))" data-ref="_M/MGET">MGET</a>(<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>, <a class="macro" href="../../sys/malloc.h.html#43" title="0x0001" data-ref="_M/M_NOWAIT">M_NOWAIT</a>, <a class="macro" href="../../sys/mbuf.h.html#386" title="1" data-ref="_M/MT_DATA">MT_DATA</a>);</td></tr>
<tr><th id="4979">4979</th><td>				<b>if</b> (<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="4980">4980</th><td>				   <b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="4981">4981</th><td>				<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((m-&gt;m_hdr.mh_len + shortfall &lt; (512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf)))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;m-&gt;m_len + shortfall &lt; MLEN&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 4983))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> + <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a> &lt; <a class="macro" href="../../sys/mbuf.h.html#322" title="(512 - __builtin_offsetof(struct _mbuf_dummy, M_dat.M_databuf))" data-ref="_M/MLEN">MLEN</a></td></tr>
<tr><th id="4982">4982</th><td>					<i>/*,</i></td></tr>
<tr><th id="4983">4983</th><td><i>					  ("runt %d +prev %d too big\n", m-&gt;m_len, shortfall)*/</i>);</td></tr>
<tr><th id="4984">4984</th><td></td></tr>
<tr><th id="4985">4985</th><td>				<i>/* first copy the data we're stealing from prev */</i></td></tr>
<tr><th id="4986">4986</th><td>				<a class="macro" href="../../lib/libkern/libkern.h.html#380" title="__builtin_memcpy(n-&gt;m_hdr.mh_data, prev-&gt;m_hdr.mh_data + newprevlen, shortfall)" data-ref="_M/memcpy">memcpy</a>(<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a>, <a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> + <a class="local col0 ref" href="#340newprevlen" title='newprevlen' data-ref="340newprevlen" data-ref-filename="340newprevlen">newprevlen</a>,</td></tr>
<tr><th id="4987">4987</th><td>				    <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>);</td></tr>
<tr><th id="4988">4988</th><td></td></tr>
<tr><th id="4989">4989</th><td>				<i>/* update prev-&gt;m_len accordingly */</i></td></tr>
<tr><th id="4990">4990</th><td>				<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> -= <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>;</td></tr>
<tr><th id="4991">4991</th><td></td></tr>
<tr><th id="4992">4992</th><td>				<i>/* copy data from runt m */</i></td></tr>
<tr><th id="4993">4993</th><td>				<a class="macro" href="../../lib/libkern/libkern.h.html#380" title="__builtin_memcpy(n-&gt;m_hdr.mh_data + shortfall, m-&gt;m_hdr.mh_data, m-&gt;m_hdr.mh_len)" data-ref="_M/memcpy">memcpy</a>(<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a> + <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a>, <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#302" title="m_hdr.mh_data" data-ref="_M/m_data">m_data</a>,</td></tr>
<tr><th id="4994">4994</th><td>				    <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>);</td></tr>
<tr><th id="4995">4995</th><td></td></tr>
<tr><th id="4996">4996</th><td>				<i>/* n holds what we stole from prev, plus m */</i></td></tr>
<tr><th id="4997">4997</th><td>				<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> = <a class="local col8 ref" href="#338shortfall" title='shortfall' data-ref="338shortfall" data-ref-filename="338shortfall">shortfall</a> + <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>;</td></tr>
<tr><th id="4998">4998</th><td></td></tr>
<tr><th id="4999">4999</th><td>				<i>/* stitch n into chain and free m */</i></td></tr>
<tr><th id="5000">5000</th><td>				<a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> = <a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a>;</td></tr>
<tr><th id="5001">5001</th><td>				<a class="local col5 ref" href="#335prev" title='prev' data-ref="335prev" data-ref-filename="335prev">prev</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> = <a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>;</td></tr>
<tr><th id="5002">5002</th><td>				<i>/* KASSERT(m-&gt;m_next == NULL); */</i></td></tr>
<tr><th id="5003">5003</th><td>				<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#300" title="m_hdr.mh_next" data-ref="_M/m_next">m_next</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="5004">5004</th><td>				<a class="ref fn" href="../../sys/mbuf.h.html#m_free" title='m_free' data-ref="m_free" data-ref-filename="m_free">m_free</a>(<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a>);</td></tr>
<tr><th id="5005">5005</th><td>				<a class="local col4 ref" href="#334m" title='m' data-ref="334m" data-ref-filename="334m">m</a> = <a class="local col9 ref" href="#339n" title='n' data-ref="339n" data-ref-filename="339n">n</a>;	<i>/* for continuing loop */</i></td></tr>
<tr><th id="5006">5006</th><td>			}</td></tr>
<tr><th id="5007">5007</th><td>		}</td></tr>
<tr><th id="5008">5008</th><td>	}</td></tr>
<tr><th id="5009">5009</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5010">5010</th><td>}</td></tr>
<tr><th id="5011">5011</th><td></td></tr>
<tr><th id="5012">5012</th><td><i  data-doc="bge_encap">/*</i></td></tr>
<tr><th id="5013">5013</th><td><i  data-doc="bge_encap"> * Encapsulate an mbuf chain in the tx ring by coupling the mbuf data</i></td></tr>
<tr><th id="5014">5014</th><td><i  data-doc="bge_encap"> * pointers to descriptors.</i></td></tr>
<tr><th id="5015">5015</th><td><i  data-doc="bge_encap"> */</i></td></tr>
<tr><th id="5016">5016</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="5017">5017</th><td><dfn class="tu decl def fn" id="bge_encap" title='bge_encap' data-type='int bge_encap(struct bge_softc * sc, struct mbuf * m_head, uint32_t * txidx)' data-ref="bge_encap" data-ref-filename="bge_encap">bge_encap</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="341sc" title='sc' data-type='struct bge_softc *' data-ref="341sc" data-ref-filename="341sc">sc</dfn>, <b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col2 decl" id="342m_head" title='m_head' data-type='struct mbuf *' data-ref="342m_head" data-ref-filename="342m_head">m_head</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> *<dfn class="local col3 decl" id="343txidx" title='txidx' data-type='uint32_t *' data-ref="343txidx" data-ref-filename="343txidx">txidx</dfn>)</td></tr>
<tr><th id="5018">5018</th><td>{</td></tr>
<tr><th id="5019">5019</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col4 decl" id="344ifp" title='ifp' data-type='struct ifnet *' data-ref="344ifp" data-ref-filename="344ifp">ifp</dfn> = &amp;<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="5020">5020</th><td>	<b>struct</b> <a class="type" href="if_bgereg.h.html#bge_tx_bd" title='bge_tx_bd' data-ref="bge_tx_bd" data-ref-filename="bge_tx_bd">bge_tx_bd</a>	*<dfn class="local col5 decl" id="345f" title='f' data-type='struct bge_tx_bd *' data-ref="345f" data-ref-filename="345f">f</dfn>, *<dfn class="local col6 decl" id="346prev_f" title='prev_f' data-type='struct bge_tx_bd *' data-ref="346prev_f" data-ref-filename="346prev_f">prev_f</dfn>;</td></tr>
<tr><th id="5021">5021</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col7 decl" id="347frag" title='frag' data-type='uint32_t' data-ref="347frag" data-ref-filename="347frag">frag</dfn>, <dfn class="local col8 decl" id="348cur" title='cur' data-type='uint32_t' data-ref="348cur" data-ref-filename="348cur">cur</dfn>;</td></tr>
<tr><th id="5022">5022</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a>		<dfn class="local col9 decl" id="349csum_flags" title='csum_flags' data-type='uint16_t' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</dfn> = <var>0</var>;</td></tr>
<tr><th id="5023">5023</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a>		<dfn class="local col0 decl" id="350txbd_tso_flags" title='txbd_tso_flags' data-type='uint16_t' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</dfn> = <var>0</var>;</td></tr>
<tr><th id="5024">5024</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#txdmamap_pool_entry" title='txdmamap_pool_entry' data-ref="txdmamap_pool_entry" data-ref-filename="txdmamap_pool_entry">txdmamap_pool_entry</a> *<dfn class="local col1 decl" id="351dma" title='dma' data-type='struct txdmamap_pool_entry *' data-ref="351dma" data-ref-filename="351dma">dma</dfn>;</td></tr>
<tr><th id="5025">5025</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dmamap_t" title='bus_dmamap_t' data-type='struct x86_bus_dmamap *' data-ref="bus_dmamap_t" data-ref-filename="bus_dmamap_t">bus_dmamap_t</a> <dfn class="local col2 decl" id="352dmamap" title='dmamap' data-type='bus_dmamap_t' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</dfn>;</td></tr>
<tr><th id="5026">5026</th><td>	<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_dma_tag_t" title='bus_dma_tag_t' data-type='struct x86_bus_dma_tag *' data-ref="bus_dma_tag_t" data-ref-filename="bus_dma_tag_t">bus_dma_tag_t</a> <dfn class="local col3 decl" id="353dmatag" title='dmatag' data-type='bus_dma_tag_t' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</dfn>;</td></tr>
<tr><th id="5027">5027</th><td>	<em>int</em>			<dfn class="local col4 decl" id="354i" title='i' data-type='int' data-ref="354i" data-ref-filename="354i">i</dfn> = <var>0</var>;</td></tr>
<tr><th id="5028">5028</th><td>	<em>int</em>			<dfn class="local col5 decl" id="355use_tso" title='use_tso' data-type='int' data-ref="355use_tso" data-ref-filename="355use_tso">use_tso</dfn>, <dfn class="local col6 decl" id="356maxsegsize" title='maxsegsize' data-type='int' data-ref="356maxsegsize" data-ref-filename="356maxsegsize">maxsegsize</dfn>, <dfn class="local col7 decl" id="357error" title='error' data-type='int' data-ref="357error" data-ref-filename="357error">error</dfn>;</td></tr>
<tr><th id="5029">5029</th><td>	<a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a>			<dfn class="local col8 decl" id="358have_vtag" title='have_vtag' data-type='_Bool' data-ref="358have_vtag" data-ref-filename="358have_vtag">have_vtag</dfn>;</td></tr>
<tr><th id="5030">5030</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a>		<dfn class="local col9 decl" id="359vtag" title='vtag' data-type='uint16_t' data-ref="359vtag" data-ref-filename="359vtag">vtag</dfn>;</td></tr>
<tr><th id="5031">5031</th><td>	<a class="macro" href="../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a>			<dfn class="local col0 decl" id="360remap" title='remap' data-type='_Bool' data-ref="360remap" data-ref-filename="360remap">remap</dfn>;</td></tr>
<tr><th id="5032">5032</th><td></td></tr>
<tr><th id="5033">5033</th><td>	<b>if</b> (<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a>) {</td></tr>
<tr><th id="5034">5034</th><td>		<b>if</b> (<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> &amp; <a class="macro" href="../../sys/mbuf.h.html#215" title="0x00000040" data-ref="_M/M_CSUM_IPv4">M_CSUM_IPv4</a>)</td></tr>
<tr><th id="5035">5035</th><td>			<a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> |= <a class="macro" href="if_bgereg.h.html#2277" title="0x0002" data-ref="_M/BGE_TXBDFLAG_IP_CSUM">BGE_TXBDFLAG_IP_CSUM</a>;</td></tr>
<tr><th id="5036">5036</th><td>		<b>if</b> (<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> &amp; (<a class="macro" href="../../sys/mbuf.h.html#209" title="0x00000001" data-ref="_M/M_CSUM_TCPv4">M_CSUM_TCPv4</a> |<a class="macro" href="../../sys/mbuf.h.html#210" title="0x00000002" data-ref="_M/M_CSUM_UDPv4">M_CSUM_UDPv4</a>))</td></tr>
<tr><th id="5037">5037</th><td>			<a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> |= <a class="macro" href="if_bgereg.h.html#2276" title="0x0001" data-ref="_M/BGE_TXBDFLAG_TCP_UDP_CSUM">BGE_TXBDFLAG_TCP_UDP_CSUM</a>;</td></tr>
<tr><th id="5038">5038</th><td>	}</td></tr>
<tr><th id="5039">5039</th><td></td></tr>
<tr><th id="5040">5040</th><td>	<i>/*</i></td></tr>
<tr><th id="5041">5041</th><td><i>	 * If we were asked to do an outboard checksum, and the NIC</i></td></tr>
<tr><th id="5042">5042</th><td><i>	 * has the bug where it sometimes adds in the Ethernet padding,</i></td></tr>
<tr><th id="5043">5043</th><td><i>	 * explicitly pad with zeros so the cksum will be correct either way.</i></td></tr>
<tr><th id="5044">5044</th><td><i>	 * (For now, do this for all chip versions, until newer</i></td></tr>
<tr><th id="5045">5045</th><td><i>	 * are confirmed to not require the workaround.)</i></td></tr>
<tr><th id="5046">5046</th><td><i>	 */</i></td></tr>
<tr><th id="5047">5047</th><td>	<b>if</b> ((<a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2276" title="0x0001" data-ref="_M/BGE_TXBDFLAG_TCP_UDP_CSUM">BGE_TXBDFLAG_TCP_UDP_CSUM</a>) == <var>0</var> ||</td></tr>
<tr><th id="5048">5048</th><td><u>#<span data-ppcond="5048">ifdef</span> <span class="macro" data-ref="_M/notyet">notyet</span></u></td></tr>
<tr><th id="5049">5049</th><td>	    (sc-&gt;bge_quirks &amp; BGE_QUIRK_SHORT_CKSUM_BUG) == <var>0</var> ||</td></tr>
<tr><th id="5050">5050</th><td><u>#<span data-ppcond="5048">endif</span></u></td></tr>
<tr><th id="5051">5051</th><td>	    <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> &gt;= <a class="macro" href="#129" title="(64 - 4)" data-ref="_M/ETHER_MIN_NOPAD">ETHER_MIN_NOPAD</a>)</td></tr>
<tr><th id="5052">5052</th><td>		<b>goto</b> <a class="lbl" href="#361check_dma_bug" data-ref="361check_dma_bug" data-ref-filename="361check_dma_bug">check_dma_bug</a>;</td></tr>
<tr><th id="5053">5053</th><td></td></tr>
<tr><th id="5054">5054</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_cksum_pad" title='bge_cksum_pad' data-use='c' data-ref="bge_cksum_pad" data-ref-filename="bge_cksum_pad">bge_cksum_pad</a>(<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>) != <var>0</var>)</td></tr>
<tr><th id="5055">5055</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5056">5056</th><td></td></tr>
<tr><th id="5057">5057</th><td><dfn class="lbl" id="361check_dma_bug" data-ref="361check_dma_bug" data-ref-filename="361check_dma_bug">check_dma_bug</dfn>:</td></tr>
<tr><th id="5058">5058</th><td>	<b>if</b> (!(<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#386" title="0x71" data-ref="_M/BGE_CHIPREV_5700_BX">BGE_CHIPREV_5700_BX</a>))</td></tr>
<tr><th id="5059">5059</th><td>		<b>goto</b> <a class="lbl" href="#362doit" data-ref="362doit" data-ref-filename="362doit">doit</a>;</td></tr>
<tr><th id="5060">5060</th><td></td></tr>
<tr><th id="5061">5061</th><td>	<i>/*</i></td></tr>
<tr><th id="5062">5062</th><td><i>	 * bcm5700 Revision B silicon cannot handle DMA descriptors with</i></td></tr>
<tr><th id="5063">5063</th><td><i>	 * less than eight bytes.  If we encounter a teeny mbuf</i></td></tr>
<tr><th id="5064">5064</th><td><i>	 * at the end of a chain, we can pad.  Otherwise, copy.</i></td></tr>
<tr><th id="5065">5065</th><td><i>	 */</i></td></tr>
<tr><th id="5066">5066</th><td>	<b>if</b> (<a class="tu ref fn" href="#bge_compact_dma_runt" title='bge_compact_dma_runt' data-use='c' data-ref="bge_compact_dma_runt" data-ref-filename="bge_compact_dma_runt">bge_compact_dma_runt</a>(<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>) != <var>0</var>)</td></tr>
<tr><th id="5067">5067</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5068">5068</th><td></td></tr>
<tr><th id="5069">5069</th><td><dfn class="lbl" id="362doit" data-ref="362doit" data-ref-filename="362doit">doit</dfn>:</td></tr>
<tr><th id="5070">5070</th><td>	<a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a> = <a class="macro" href="../../sys/queue.h.html#129" title="((&amp;sc-&gt;txdma_list)-&gt;slh_first)" data-ref="_M/SLIST_FIRST">SLIST_FIRST</a>(&amp;<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>);</td></tr>
<tr><th id="5071">5071</th><td>	<b>if</b> (<a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="5072">5072</th><td>		<a class="local col4 ref" href="#344ifp" title='ifp' data-ref="344ifp" data-ref-filename="344ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> |= <a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>;</td></tr>
<tr><th id="5073">5073</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5074">5074</th><td>	}</td></tr>
<tr><th id="5075">5075</th><td>	<a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a> = <a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap" title='txdmamap_pool_entry::dmamap' data-ref="txdmamap_pool_entry::dmamap" data-ref-filename="txdmamap_pool_entry..dmamap">dmamap</a>;</td></tr>
<tr><th id="5076">5076</th><td>	<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a> = <a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag" title='bge_softc::bge_dmatag' data-ref="bge_softc::bge_dmatag" data-ref-filename="bge_softc..bge_dmatag">bge_dmatag</a>;</td></tr>
<tr><th id="5077">5077</th><td>	<a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::is_dma32" title='txdmamap_pool_entry::is_dma32' data-ref="txdmamap_pool_entry::is_dma32" data-ref-filename="txdmamap_pool_entry..is_dma32">is_dma32</a> = <a class="macro" href="../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="5078">5078</th><td></td></tr>
<tr><th id="5079">5079</th><td>	<i>/*</i></td></tr>
<tr><th id="5080">5080</th><td><i>	 * Set up any necessary TSO state before we start packing...</i></td></tr>
<tr><th id="5081">5081</th><td><i>	 */</i></td></tr>
<tr><th id="5082">5082</th><td>	<a class="local col5 ref" href="#355use_tso" title='use_tso' data-ref="355use_tso" data-ref-filename="355use_tso">use_tso</a> = (<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> &amp; <a class="macro" href="../../sys/mbuf.h.html#217" title="0x00000100" data-ref="_M/M_CSUM_TSOv4">M_CSUM_TSOv4</a>) != <var>0</var>;</td></tr>
<tr><th id="5083">5083</th><td>	<b>if</b> (!<a class="local col5 ref" href="#355use_tso" title='use_tso' data-ref="355use_tso" data-ref-filename="355use_tso">use_tso</a>) {</td></tr>
<tr><th id="5084">5084</th><td>		<a class="local col6 ref" href="#356maxsegsize" title='maxsegsize' data-ref="356maxsegsize" data-ref-filename="356maxsegsize">maxsegsize</a> = <var>0</var>;</td></tr>
<tr><th id="5085">5085</th><td>	} <b>else</b> {	<i>/* TSO setup */</i></td></tr>
<tr><th id="5086">5086</th><td>		<em>unsigned</em>  <dfn class="local col3 decl" id="363mss" title='mss' data-type='unsigned int' data-ref="363mss" data-ref-filename="363mss">mss</dfn>;</td></tr>
<tr><th id="5087">5087</th><td>		<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ether_header" title='ether_header' data-ref="ether_header" data-ref-filename="ether_header">ether_header</a> *<dfn class="local col4 decl" id="364eh" title='eh' data-type='struct ether_header *' data-ref="364eh" data-ref-filename="364eh">eh</dfn>;</td></tr>
<tr><th id="5088">5088</th><td>		<em>unsigned</em> <dfn class="local col5 decl" id="365ip_tcp_hlen" title='ip_tcp_hlen' data-type='unsigned int' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</dfn>, <dfn class="local col6 decl" id="366iptcp_opt_words" title='iptcp_opt_words' data-type='unsigned int' data-ref="366iptcp_opt_words" data-ref-filename="366iptcp_opt_words">iptcp_opt_words</dfn>, <dfn class="local col7 decl" id="367tcp_seg_flags" title='tcp_seg_flags' data-type='unsigned int' data-ref="367tcp_seg_flags" data-ref-filename="367tcp_seg_flags">tcp_seg_flags</dfn>, <dfn class="local col8 decl" id="368offset" title='offset' data-type='unsigned int' data-ref="368offset" data-ref-filename="368offset">offset</dfn>;</td></tr>
<tr><th id="5089">5089</th><td>		<em>unsigned</em> <dfn class="local col9 decl" id="369bge_hlen" title='bge_hlen' data-type='unsigned int' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</dfn>;</td></tr>
<tr><th id="5090">5090</th><td>		<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> * <dfn class="local col0 decl" id="370m0" title='m0' data-type='struct mbuf *' data-ref="370m0" data-ref-filename="370m0">m0</dfn> = <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>;</td></tr>
<tr><th id="5091">5091</th><td>		<b>struct</b> <a class="type" href="../../netinet/ip.h.html#ip" title='ip' data-ref="ip" data-ref-filename="ip">ip</a> *<dfn class="local col1 decl" id="371ip" title='ip' data-type='struct ip *' data-ref="371ip" data-ref-filename="371ip">ip</dfn>;</td></tr>
<tr><th id="5092">5092</th><td>		<b>struct</b> <a class="type" href="../../netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a> *<dfn class="local col2 decl" id="372th" title='th' data-type='struct tcphdr *' data-ref="372th" data-ref-filename="372th">th</dfn>;</td></tr>
<tr><th id="5093">5093</th><td>		<em>int</em> <dfn class="local col3 decl" id="373iphl" title='iphl' data-type='int' data-ref="373iphl" data-ref-filename="373iphl">iphl</dfn>, <dfn class="local col4 decl" id="374hlen" title='hlen' data-type='int' data-ref="374hlen" data-ref-filename="374hlen">hlen</dfn>;</td></tr>
<tr><th id="5094">5094</th><td></td></tr>
<tr><th id="5095">5095</th><td>		<i>/*</i></td></tr>
<tr><th id="5096">5096</th><td><i>		 * XXX It would be nice if the mbuf pkthdr had offset</i></td></tr>
<tr><th id="5097">5097</th><td><i>		 * fields for the protocol headers.</i></td></tr>
<tr><th id="5098">5098</th><td><i>		 */</i></td></tr>
<tr><th id="5099">5099</th><td></td></tr>
<tr><th id="5100">5100</th><td>		<a class="local col4 ref" href="#364eh" title='eh' data-ref="364eh" data-ref-filename="364eh">eh</a> = <a class="macro" href="../../sys/mbuf.h.html#147" title="((struct ether_header *)((m0)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>, <b>struct</b> <a class="type" href="../../net/if_ether.h.html#ether_header" title='ether_header' data-ref="ether_header" data-ref-filename="ether_header">ether_header</a> *);</td></tr>
<tr><th id="5101">5101</th><td>		<b>switch</b> (<a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((eh-&gt;ether_type))))) ? (((uint16_t)(((((((uint16_t)((eh-&gt;ether_type)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((eh-&gt;ether_type)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((eh-&gt;ether_type))))))" data-ref="_M/htons">htons</a>(<a class="local col4 ref" href="#364eh" title='eh' data-ref="364eh" data-ref-filename="364eh">eh</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ether_header::ether_type" title='ether_header::ether_type' data-ref="ether_header::ether_type" data-ref-filename="ether_header..ether_type">ether_type</a>)) {</td></tr>
<tr><th id="5102">5102</th><td>		<b>case</b> <a class="macro" href="../../net/ethertypes.h.html#67" title="0x0800" data-ref="_M/ETHERTYPE_IP">ETHERTYPE_IP</a>:</td></tr>
<tr><th id="5103">5103</th><td>			<a class="local col8 ref" href="#368offset" title='offset' data-ref="368offset" data-ref-filename="368offset">offset</a> = <a class="macro" href="../../net/if_ether.h.html#54" title="((6 * 2) + 2)" data-ref="_M/ETHER_HDR_LEN">ETHER_HDR_LEN</a>;</td></tr>
<tr><th id="5104">5104</th><td>			<b>break</b>;</td></tr>
<tr><th id="5105">5105</th><td></td></tr>
<tr><th id="5106">5106</th><td>		<b>case</b> <a class="macro" href="../../net/ethertypes.h.html#221" title="0x8100" data-ref="_M/ETHERTYPE_VLAN">ETHERTYPE_VLAN</a>:</td></tr>
<tr><th id="5107">5107</th><td>			<a class="local col8 ref" href="#368offset" title='offset' data-ref="368offset" data-ref-filename="368offset">offset</a> = <a class="macro" href="../../net/if_ether.h.html#54" title="((6 * 2) + 2)" data-ref="_M/ETHER_HDR_LEN">ETHER_HDR_LEN</a> + <a class="macro" href="../../net/if_ether.h.html#62" title="4" data-ref="_M/ETHER_VLAN_ENCAP_LEN">ETHER_VLAN_ENCAP_LEN</a>;</td></tr>
<tr><th id="5108">5108</th><td>			<b>break</b>;</td></tr>
<tr><th id="5109">5109</th><td></td></tr>
<tr><th id="5110">5110</th><td>		<b>default</b>:</td></tr>
<tr><th id="5111">5111</th><td>			<i>/*</i></td></tr>
<tr><th id="5112">5112</th><td><i>			 * Don't support this protocol or encapsulation.</i></td></tr>
<tr><th id="5113">5113</th><td><i>			 */</i></td></tr>
<tr><th id="5114">5114</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5115">5115</th><td>		}</td></tr>
<tr><th id="5116">5116</th><td></td></tr>
<tr><th id="5117">5117</th><td>		<i>/*</i></td></tr>
<tr><th id="5118">5118</th><td><i>		 * TCP/IP headers are in the first mbuf; we can do</i></td></tr>
<tr><th id="5119">5119</th><td><i>		 * this the easy way.</i></td></tr>
<tr><th id="5120">5120</th><td><i>		 */</i></td></tr>
<tr><th id="5121">5121</th><td>		<a class="local col3 ref" href="#373iphl" title='iphl' data-ref="373iphl" data-ref-filename="373iphl">iphl</a> = <a class="macro" href="../../sys/mbuf.h.html#238" title="((m0-&gt;M_dat.MH.MH_pkthdr.csum_data) &gt;&gt; 16)" data-ref="_M/M_CSUM_DATA_IPv4_IPHL">M_CSUM_DATA_IPv4_IPHL</a>(<a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::csum_data" title='pkthdr::csum_data' data-ref="pkthdr::csum_data" data-ref-filename="pkthdr..csum_data">csum_data</a>);</td></tr>
<tr><th id="5122">5122</th><td>		<a class="local col4 ref" href="#374hlen" title='hlen' data-ref="374hlen" data-ref-filename="374hlen">hlen</a> = <a class="local col3 ref" href="#373iphl" title='iphl' data-ref="373iphl" data-ref-filename="373iphl">iphl</a> + <a class="local col8 ref" href="#368offset" title='offset' data-ref="368offset" data-ref-filename="368offset">offset</a>;</td></tr>
<tr><th id="5123">5123</th><td>		<b>if</b> (<a class="macro" href="../../sys/cdefs.h.html#488" title="__builtin_expect((m0-&gt;m_hdr.mh_len &lt; (hlen + sizeof(struct tcphdr))) != 0, 0)" data-ref="_M/__predict_false">__predict_false</a>(<a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a> &lt;</td></tr>
<tr><th id="5124">5124</th><td>				    (<a class="local col4 ref" href="#374hlen" title='hlen' data-ref="374hlen" data-ref-filename="374hlen">hlen</a> + <b>sizeof</b>(<b>struct</b> <a class="type" href="../../netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a>)))) {</td></tr>
<tr><th id="5125">5125</th><td></td></tr>
<tr><th id="5126">5126</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="5127">5127</th><td>			    <q>"TSO: hard case m0-&gt;m_len == %d &lt; ip/tcp hlen %zd,"</q></td></tr>
<tr><th id="5128">5128</th><td>			    <q>"not handled yet\n"</q>,</td></tr>
<tr><th id="5129">5129</th><td>			     <a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#301" title="m_hdr.mh_len" data-ref="_M/m_len">m_len</a>, <a class="local col4 ref" href="#374hlen" title='hlen' data-ref="374hlen" data-ref-filename="374hlen">hlen</a>+ <b>sizeof</b>(<b>struct</b> <a class="type" href="../../netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a>));</td></tr>
<tr><th id="5130">5130</th><td><u>#<span data-ppcond="5130">ifdef</span> <span class="macro" data-ref="_M/NOTYET">NOTYET</span></u></td></tr>
<tr><th id="5131">5131</th><td>			<i>/*</i></td></tr>
<tr><th id="5132">5132</th><td><i>			 * XXX jonathan@NetBSD.org: untested.</i></td></tr>
<tr><th id="5133">5133</th><td><i>			 * how to force this branch to be taken?</i></td></tr>
<tr><th id="5134">5134</th><td><i>			 */</i></td></tr>
<tr><th id="5135">5135</th><td>			BGE_EVCNT_INCR(sc-&gt;bge_ev_txtsopain);</td></tr>
<tr><th id="5136">5136</th><td></td></tr>
<tr><th id="5137">5137</th><td>			m_copydata(m0, offset, <b>sizeof</b>(ip), &amp;ip);</td></tr>
<tr><th id="5138">5138</th><td>			m_copydata(m0, hlen, <b>sizeof</b>(th), &amp;th);</td></tr>
<tr><th id="5139">5139</th><td></td></tr>
<tr><th id="5140">5140</th><td>			ip.ip_len = <var>0</var>;</td></tr>
<tr><th id="5141">5141</th><td></td></tr>
<tr><th id="5142">5142</th><td>			m_copyback(m0, hlen + offsetof(<b>struct</b> ip, ip_len),</td></tr>
<tr><th id="5143">5143</th><td>			    <b>sizeof</b>(ip.ip_len), &amp;ip.ip_len);</td></tr>
<tr><th id="5144">5144</th><td></td></tr>
<tr><th id="5145">5145</th><td>			th.th_sum = in_cksum_phdr(ip.ip_src.s_addr,</td></tr>
<tr><th id="5146">5146</th><td>			    ip.ip_dst.s_addr, htons(IPPROTO_TCP));</td></tr>
<tr><th id="5147">5147</th><td></td></tr>
<tr><th id="5148">5148</th><td>			m_copyback(m0, hlen + offsetof(<b>struct</b> tcphdr, th_sum),</td></tr>
<tr><th id="5149">5149</th><td>			    <b>sizeof</b>(th.th_sum), &amp;th.th_sum);</td></tr>
<tr><th id="5150">5150</th><td></td></tr>
<tr><th id="5151">5151</th><td>			hlen += th.th_off &lt;&lt; <var>2</var>;</td></tr>
<tr><th id="5152">5152</th><td>			iptcp_opt_words	= hlen;</td></tr>
<tr><th id="5153">5153</th><td><u>#<span data-ppcond="5130">else</span></u></td></tr>
<tr><th id="5154">5154</th><td>			<i>/*</i></td></tr>
<tr><th id="5155">5155</th><td><i>			 * if_wm "hard" case not yet supported, can we not</i></td></tr>
<tr><th id="5156">5156</th><td><i>			 * mandate it out of existence?</i></td></tr>
<tr><th id="5157">5157</th><td><i>			 */</i></td></tr>
<tr><th id="5158">5158</th><td>			(<em>void</em>) <a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a>; (<em>void</em>)<a class="local col2 ref" href="#372th" title='th' data-ref="372th" data-ref-filename="372th">th</a>; (<em>void</em>) <a class="local col5 ref" href="#365ip_tcp_hlen" title='ip_tcp_hlen' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</a>;</td></tr>
<tr><th id="5159">5159</th><td></td></tr>
<tr><th id="5160">5160</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5161">5161</th><td><u>#<span data-ppcond="5130">endif</span></u></td></tr>
<tr><th id="5162">5162</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5163">5163</th><td>			<a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a> = (<b>struct</b> <a class="type" href="../../netinet/ip.h.html#ip" title='ip' data-ref="ip" data-ref-filename="ip">ip</a> *) (<a class="macro" href="../../sys/mbuf.h.html#147" title="((char *)((m0)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>, <em>char</em> *) + <a class="local col8 ref" href="#368offset" title='offset' data-ref="368offset" data-ref-filename="368offset">offset</a>);</td></tr>
<tr><th id="5164">5164</th><td>			<a class="local col2 ref" href="#372th" title='th' data-ref="372th" data-ref-filename="372th">th</a> = (<b>struct</b> <a class="type" href="../../netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a> *) (<a class="macro" href="../../sys/mbuf.h.html#147" title="((char *)((m0)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#370m0" title='m0' data-ref="370m0" data-ref-filename="370m0">m0</a>, <em>char</em> *) + <a class="local col4 ref" href="#374hlen" title='hlen' data-ref="374hlen" data-ref-filename="374hlen">hlen</a>);</td></tr>
<tr><th id="5165">5165</th><td>			<a class="local col5 ref" href="#365ip_tcp_hlen" title='ip_tcp_hlen' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</a> = <a class="local col3 ref" href="#373iphl" title='iphl' data-ref="373iphl" data-ref-filename="373iphl">iphl</a> +  (<a class="local col2 ref" href="#372th" title='th' data-ref="372th" data-ref-filename="372th">th</a>-&gt;<a class="ref field" href="../../netinet/tcp.h.html#tcphdr::th_off" title='tcphdr::th_off' data-ref="tcphdr::th_off" data-ref-filename="tcphdr..th_off">th_off</a> &lt;&lt; <var>2</var>);</td></tr>
<tr><th id="5166">5166</th><td></td></tr>
<tr><th id="5167">5167</th><td>			<i>/* Total IP/TCP options, in 32-bit words */</i></td></tr>
<tr><th id="5168">5168</th><td>			<a class="local col6 ref" href="#366iptcp_opt_words" title='iptcp_opt_words' data-ref="366iptcp_opt_words" data-ref-filename="366iptcp_opt_words">iptcp_opt_words</a> = (<a class="local col5 ref" href="#365ip_tcp_hlen" title='ip_tcp_hlen' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</a></td></tr>
<tr><th id="5169">5169</th><td>					   - <b>sizeof</b>(<b>struct</b> <a class="type" href="../../netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a>)</td></tr>
<tr><th id="5170">5170</th><td>					   - <b>sizeof</b>(<b>struct</b> <a class="type" href="../../netinet/ip.h.html#ip" title='ip' data-ref="ip" data-ref-filename="ip">ip</a>)) &gt;&gt; <var>2</var>;</td></tr>
<tr><th id="5171">5171</th><td>		}</td></tr>
<tr><th id="5172">5172</th><td>		<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>)) {</td></tr>
<tr><th id="5173">5173</th><td>			<a class="local col2 ref" href="#372th" title='th' data-ref="372th" data-ref-filename="372th">th</a>-&gt;<a class="ref field" href="../../netinet/tcp.h.html#tcphdr::th_sum" title='tcphdr::th_sum' data-ref="tcphdr::th_sum" data-ref-filename="tcphdr..th_sum">th_sum</a> = <var>0</var>;</td></tr>
<tr><th id="5174">5174</th><td>			<a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> = <var>0</var>;</td></tr>
<tr><th id="5175">5175</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5176">5176</th><td>			<i>/*</i></td></tr>
<tr><th id="5177">5177</th><td><i>			 * XXX jonathan@NetBSD.org: 5705 untested.</i></td></tr>
<tr><th id="5178">5178</th><td><i>			 * Requires TSO firmware patch for 5701/5703/5704.</i></td></tr>
<tr><th id="5179">5179</th><td><i>			 */</i></td></tr>
<tr><th id="5180">5180</th><td>			<a class="local col2 ref" href="#372th" title='th' data-ref="372th" data-ref-filename="372th">th</a>-&gt;<a class="ref field" href="../../netinet/tcp.h.html#tcphdr::th_sum" title='tcphdr::th_sum' data-ref="tcphdr::th_sum" data-ref-filename="tcphdr..th_sum">th_sum</a> = <a class="ref fn" href="../../netinet/in.h.html#in_cksum_phdr" title='in_cksum_phdr' data-ref="in_cksum_phdr" data-ref-filename="in_cksum_phdr">in_cksum_phdr</a>(<a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a>-&gt;<a class="ref field" href="../../netinet/ip.h.html#ip::ip_src" title='ip::ip_src' data-ref="ip::ip_src" data-ref-filename="ip..ip_src">ip_src</a>.<a class="ref field" href="../../netinet/in.h.html#in_addr::s_addr" title='in_addr::s_addr' data-ref="in_addr::s_addr" data-ref-filename="in_addr..s_addr">s_addr</a>,</td></tr>
<tr><th id="5181">5181</th><td>			    <a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a>-&gt;<a class="ref field" href="../../netinet/ip.h.html#ip::ip_dst" title='ip::ip_dst' data-ref="ip::ip_dst" data-ref-filename="ip..ip_dst">ip_dst</a>.<a class="ref field" href="../../netinet/in.h.html#in_addr::s_addr" title='in_addr::s_addr' data-ref="in_addr::s_addr" data-ref-filename="in_addr..s_addr">s_addr</a>, <a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((6))))) ? (((uint16_t)(((((((uint16_t)((6)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((6)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((6))))))" data-ref="_M/htons">htons</a>(<a class="macro" href="../../netinet/in.h.html#82" title="6" data-ref="_M/IPPROTO_TCP">IPPROTO_TCP</a>));</td></tr>
<tr><th id="5182">5182</th><td>		}</td></tr>
<tr><th id="5183">5183</th><td></td></tr>
<tr><th id="5184">5184</th><td>		<a class="local col3 ref" href="#363mss" title='mss' data-ref="363mss" data-ref-filename="363mss">mss</a> = <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>-&gt;<a class="macro" href="../../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../../sys/mbuf.h.html#pkthdr::segsz" title='pkthdr::segsz' data-ref="pkthdr::segsz" data-ref-filename="pkthdr..segsz">segsz</a>;</td></tr>
<tr><th id="5185">5185</th><td>		<a class="local col0 ref" href="#350txbd_tso_flags" title='txbd_tso_flags' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</a> |=</td></tr>
<tr><th id="5186">5186</th><td>		    <a class="macro" href="if_bgereg.h.html#2283" title="0x0100" data-ref="_M/BGE_TXBDFLAG_CPU_PRE_DMA">BGE_TXBDFLAG_CPU_PRE_DMA</a> |</td></tr>
<tr><th id="5187">5187</th><td>		    <a class="macro" href="if_bgereg.h.html#2284" title="0x0200" data-ref="_M/BGE_TXBDFLAG_CPU_POST_DMA">BGE_TXBDFLAG_CPU_POST_DMA</a>;</td></tr>
<tr><th id="5188">5188</th><td></td></tr>
<tr><th id="5189">5189</th><td>		<i>/*</i></td></tr>
<tr><th id="5190">5190</th><td><i>		 * Our NIC TSO-assist assumes TSO has standard, optionless</i></td></tr>
<tr><th id="5191">5191</th><td><i>		 * IPv4 and TCP headers, which total 40 bytes. By default,</i></td></tr>
<tr><th id="5192">5192</th><td><i>		 * the NIC copies 40 bytes of IP/TCP header from the</i></td></tr>
<tr><th id="5193">5193</th><td><i>		 * supplied header into the IP/TCP header portion of</i></td></tr>
<tr><th id="5194">5194</th><td><i>		 * each post-TSO-segment. If the supplied packet has IP or</i></td></tr>
<tr><th id="5195">5195</th><td><i>		 * TCP options, we need to tell the NIC to copy those extra</i></td></tr>
<tr><th id="5196">5196</th><td><i>		 * bytes into each  post-TSO header, in addition to the normal</i></td></tr>
<tr><th id="5197">5197</th><td><i>		 * 40-byte IP/TCP header (and to leave space accordingly).</i></td></tr>
<tr><th id="5198">5198</th><td><i>		 * Unfortunately, the driver encoding of option length</i></td></tr>
<tr><th id="5199">5199</th><td><i>		 * varies across different ASIC families.</i></td></tr>
<tr><th id="5200">5200</th><td><i>		 */</i></td></tr>
<tr><th id="5201">5201</th><td>		<a class="local col7 ref" href="#367tcp_seg_flags" title='tcp_seg_flags' data-ref="367tcp_seg_flags" data-ref-filename="367tcp_seg_flags">tcp_seg_flags</a> = <var>0</var>;</td></tr>
<tr><th id="5202">5202</th><td>		<a class="local col9 ref" href="#369bge_hlen" title='bge_hlen' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</a> = <a class="local col5 ref" href="#365ip_tcp_hlen" title='ip_tcp_hlen' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</a> &gt;&gt; <var>2</var>;</td></tr>
<tr><th id="5203">5203</th><td>		<b>if</b> (<a class="macro" href="#417" title="((sc)-&gt;bge_flags &amp; 0x00020000)" data-ref="_M/BGE_IS_5717_PLUS">BGE_IS_5717_PLUS</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>)) {</td></tr>
<tr><th id="5204">5204</th><td>			<a class="local col7 ref" href="#367tcp_seg_flags" title='tcp_seg_flags' data-ref="367tcp_seg_flags" data-ref-filename="367tcp_seg_flags">tcp_seg_flags</a> = (<a class="local col9 ref" href="#369bge_hlen" title='bge_hlen' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</a> &amp; <var>0x3</var>) &lt;&lt; <var>14</var>;</td></tr>
<tr><th id="5205">5205</th><td>			<a class="local col0 ref" href="#350txbd_tso_flags" title='txbd_tso_flags' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</a> |=</td></tr>
<tr><th id="5206">5206</th><td>			    ((<a class="local col9 ref" href="#369bge_hlen" title='bge_hlen' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</a> &amp; <var>0xF8</var>) &lt;&lt; <var>7</var>) | ((<a class="local col9 ref" href="#369bge_hlen" title='bge_hlen' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</a> &amp; <var>0x4</var>) &lt;&lt; <var>2</var>);</td></tr>
<tr><th id="5207">5207</th><td>		} <b>else</b> <b>if</b> (<a class="macro" href="#411" title="((sc)-&gt;bge_flags &amp; 0x00001000)" data-ref="_M/BGE_IS_5705_PLUS">BGE_IS_5705_PLUS</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>)) {</td></tr>
<tr><th id="5208">5208</th><td>			<a class="local col7 ref" href="#367tcp_seg_flags" title='tcp_seg_flags' data-ref="367tcp_seg_flags" data-ref-filename="367tcp_seg_flags">tcp_seg_flags</a> = <a class="local col9 ref" href="#369bge_hlen" title='bge_hlen' data-ref="369bge_hlen" data-ref-filename="369bge_hlen">bge_hlen</a> &lt;&lt; <var>11</var>;</td></tr>
<tr><th id="5209">5209</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5210">5210</th><td>			<i>/* XXX iptcp_opt_words or bge_hlen ? */</i></td></tr>
<tr><th id="5211">5211</th><td>			<a class="local col0 ref" href="#350txbd_tso_flags" title='txbd_tso_flags' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</a> |= <a class="local col6 ref" href="#366iptcp_opt_words" title='iptcp_opt_words' data-ref="366iptcp_opt_words" data-ref-filename="366iptcp_opt_words">iptcp_opt_words</a> &lt;&lt; <var>12</var>;</td></tr>
<tr><th id="5212">5212</th><td>		}</td></tr>
<tr><th id="5213">5213</th><td>		<a class="local col6 ref" href="#356maxsegsize" title='maxsegsize' data-ref="356maxsegsize" data-ref-filename="356maxsegsize">maxsegsize</a> = <a class="local col3 ref" href="#363mss" title='mss' data-ref="363mss" data-ref-filename="363mss">mss</a> | <a class="local col7 ref" href="#367tcp_seg_flags" title='tcp_seg_flags' data-ref="367tcp_seg_flags" data-ref-filename="367tcp_seg_flags">tcp_seg_flags</a>;</td></tr>
<tr><th id="5214">5214</th><td>		<a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a>-&gt;<a class="ref field" href="../../netinet/ip.h.html#ip::ip_len" title='ip::ip_len' data-ref="ip::ip_len" data-ref-filename="ip..ip_len">ip_len</a> = <a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((mss + ip_tcp_hlen))))) ? (((uint16_t)(((((((uint16_t)((mss + ip_tcp_hlen)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((mss + ip_tcp_hlen)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((mss + ip_tcp_hlen))))))" data-ref="_M/htons">htons</a>(<a class="local col3 ref" href="#363mss" title='mss' data-ref="363mss" data-ref-filename="363mss">mss</a> + <a class="local col5 ref" href="#365ip_tcp_hlen" title='ip_tcp_hlen' data-ref="365ip_tcp_hlen" data-ref-filename="365ip_tcp_hlen">ip_tcp_hlen</a>);</td></tr>
<tr><th id="5215">5215</th><td>		<a class="local col1 ref" href="#371ip" title='ip' data-ref="371ip" data-ref-filename="371ip">ip</a>-&gt;<a class="ref field" href="../../netinet/ip.h.html#ip::ip_sum" title='ip::ip_sum' data-ref="ip::ip_sum" data-ref-filename="ip..ip_sum">ip_sum</a> = <var>0</var>;</td></tr>
<tr><th id="5216">5216</th><td></td></tr>
<tr><th id="5217">5217</th><td>	}	<i>/* TSO setup */</i></td></tr>
<tr><th id="5218">5218</th><td></td></tr>
<tr><th id="5219">5219</th><td>	<a class="local col8 ref" href="#358have_vtag" title='have_vtag' data-ref="358have_vtag" data-ref-filename="358have_vtag">have_vtag</a> = <a class="ref fn" href="../../net/if_ether.h.html#vlan_has_tag" title='vlan_has_tag' data-ref="vlan_has_tag" data-ref-filename="vlan_has_tag">vlan_has_tag</a>(<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>);</td></tr>
<tr><th id="5220">5220</th><td>	<b>if</b> (<a class="local col8 ref" href="#358have_vtag" title='have_vtag' data-ref="358have_vtag" data-ref-filename="358have_vtag">have_vtag</a>)</td></tr>
<tr><th id="5221">5221</th><td>		<a class="local col9 ref" href="#359vtag" title='vtag' data-ref="359vtag" data-ref-filename="359vtag">vtag</a> = <a class="ref fn" href="../../net/if_ether.h.html#vlan_get_tag" title='vlan_get_tag' data-ref="vlan_get_tag" data-ref-filename="vlan_get_tag">vlan_get_tag</a>(<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>);</td></tr>
<tr><th id="5222">5222</th><td></td></tr>
<tr><th id="5223">5223</th><td>	<i>/*</i></td></tr>
<tr><th id="5224">5224</th><td><i>	 * Start packing the mbufs in this chain into</i></td></tr>
<tr><th id="5225">5225</th><td><i>	 * the fragment pointers. Stop when we run out</i></td></tr>
<tr><th id="5226">5226</th><td><i>	 * of fragments or hit the end of the mbuf chain.</i></td></tr>
<tr><th id="5227">5227</th><td><i>	 */</i></td></tr>
<tr><th id="5228">5228</th><td>	<a class="local col0 ref" href="#360remap" title='remap' data-ref="360remap" data-ref-filename="360remap">remap</a> = <a class="macro" href="../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="5229">5229</th><td><dfn class="lbl" id="375load_again" data-ref="375load_again" data-ref-filename="375load_again">load_again</dfn>:</td></tr>
<tr><th id="5230">5230</th><td>	<a class="local col7 ref" href="#357error" title='error' data-ref="357error" data-ref-filename="357error">error</a> = <a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_load_mbuf" title='bus_dmamap_load_mbuf' data-ref="bus_dmamap_load_mbuf" data-ref-filename="bus_dmamap_load_mbuf">bus_dmamap_load_mbuf</a>(<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>, <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>, <a class="macro" href="../../sys/bus_proto.h.html#311" title="0x001" data-ref="_M/BUS_DMA_NOWAIT">BUS_DMA_NOWAIT</a>);</td></tr>
<tr><th id="5231">5231</th><td>	<b>if</b> (<a class="macro" href="../../sys/cdefs.h.html#488" title="__builtin_expect((error) != 0, 0)" data-ref="_M/__predict_false">__predict_false</a>(<a class="local col7 ref" href="#357error" title='error' data-ref="357error" data-ref-filename="357error">error</a>)) {</td></tr>
<tr><th id="5232">5232</th><td>		<b>if</b> (<a class="local col7 ref" href="#357error" title='error' data-ref="357error" data-ref-filename="357error">error</a> == <a class="macro" href="../../sys/errno.h.html#69" title="27" data-ref="_M/EFBIG">EFBIG</a> &amp;&amp; <a class="local col0 ref" href="#360remap" title='remap' data-ref="360remap" data-ref-filename="360remap">remap</a>) {</td></tr>
<tr><th id="5233">5233</th><td>			<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col6 decl" id="376m" title='m' data-type='struct mbuf *' data-ref="376m" data-ref-filename="376m">m</dfn>;</td></tr>
<tr><th id="5234">5234</th><td>			<a class="local col0 ref" href="#360remap" title='remap' data-ref="360remap" data-ref-filename="360remap">remap</a> = <a class="macro" href="../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="5235">5235</th><td>			<a class="local col6 ref" href="#376m" title='m' data-ref="376m" data-ref-filename="376m">m</a> = <a class="ref fn" href="../../sys/mbuf.h.html#m_defrag" title='m_defrag' data-ref="m_defrag" data-ref-filename="m_defrag">m_defrag</a>(<a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>, <a class="macro" href="../../sys/malloc.h.html#43" title="0x0001" data-ref="_M/M_NOWAIT">M_NOWAIT</a>);</td></tr>
<tr><th id="5236">5236</th><td>			<b>if</b> (<a class="local col6 ref" href="#376m" title='m' data-ref="376m" data-ref-filename="376m">m</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="5237">5237</th><td>				<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((m == m_head)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;m == m_head&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 5237))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col6 ref" href="#376m" title='m' data-ref="376m" data-ref-filename="376m">m</a> == <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>);</td></tr>
<tr><th id="5238">5238</th><td>				<b>goto</b> <a class="lbl" href="#375load_again" data-ref="375load_again" data-ref-filename="375load_again">load_again</a>;</td></tr>
<tr><th id="5239">5239</th><td>			}</td></tr>
<tr><th id="5240">5240</th><td>		}</td></tr>
<tr><th id="5241">5241</th><td>		<b>return</b> <a class="local col7 ref" href="#357error" title='error' data-ref="357error" data-ref-filename="357error">error</a>;</td></tr>
<tr><th id="5242">5242</th><td>	}</td></tr>
<tr><th id="5243">5243</th><td>	<i>/*</i></td></tr>
<tr><th id="5244">5244</th><td><i>	 * Sanity check: avoid coming within 16 descriptors</i></td></tr>
<tr><th id="5245">5245</th><td><i>	 * of the end of the ring.</i></td></tr>
<tr><th id="5246">5246</th><td><i>	 */</i></td></tr>
<tr><th id="5247">5247</th><td>	<b>if</b> (<a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_nsegs" title='x86_bus_dmamap::dm_nsegs' data-ref="x86_bus_dmamap::dm_nsegs" data-ref-filename="x86_bus_dmamap..dm_nsegs">dm_nsegs</a> &gt; (<a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a> - <a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_txcnt" title='bge_softc::bge_txcnt' data-ref="bge_softc::bge_txcnt" data-ref-filename="bge_softc..bge_txcnt">bge_txcnt</a> - <var>16</var>)) {</td></tr>
<tr><th id="5248">5248</th><td>		<a class="macro" href="#284" title="" data-ref="_M/BGE_TSO_PRINTF">BGE_TSO_PRINTF</a>((<q>"%s: "</q></td></tr>
<tr><th id="5249">5249</th><td>		    <q>" dmamap_load_mbuf too close to ring wrap\n"</q>,</td></tr>
<tr><th id="5250">5250</th><td>		    device_xname(sc-&gt;bge_dev)));</td></tr>
<tr><th id="5251">5251</th><td>		<b>goto</b> <a class="lbl" href="#377fail_unload" data-ref="377fail_unload" data-ref-filename="377fail_unload">fail_unload</a>;</td></tr>
<tr><th id="5252">5252</th><td>	}</td></tr>
<tr><th id="5253">5253</th><td></td></tr>
<tr><th id="5254">5254</th><td>	<i>/* Iterate over dmap-map fragments. */</i></td></tr>
<tr><th id="5255">5255</th><td>	<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a> = <a class="local col6 ref" href="#346prev_f" title='prev_f' data-ref="346prev_f" data-ref-filename="346prev_f">prev_f</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="5256">5256</th><td>	<a class="local col8 ref" href="#348cur" title='cur' data-ref="348cur" data-ref-filename="348cur">cur</a> = <a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a> = *<a class="local col3 ref" href="#343txidx" title='txidx' data-ref="343txidx" data-ref-filename="343txidx">txidx</a>;</td></tr>
<tr><th id="5257">5257</th><td></td></tr>
<tr><th id="5258">5258</th><td>	<b>for</b> (<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a> = <var>0</var>; <a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a> &lt; <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_nsegs" title='x86_bus_dmamap::dm_nsegs' data-ref="x86_bus_dmamap::dm_nsegs" data-ref-filename="x86_bus_dmamap..dm_nsegs">dm_nsegs</a>; <a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a>++) {</td></tr>
<tr><th id="5259">5259</th><td>		<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a> = &amp;<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_tx_ring" title='bge_ring_data::bge_tx_ring' data-ref="bge_ring_data::bge_tx_ring" data-ref-filename="bge_ring_data..bge_tx_ring">bge_tx_ring</a>[<a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a>];</td></tr>
<tr><th id="5260">5260</th><td>		<b>if</b> (<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a>] != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="5261">5261</th><td>			<b>break</b>;</td></tr>
<tr><th id="5262">5262</th><td></td></tr>
<tr><th id="5263">5263</th><td>		<a class="macro" href="if_bgevar.h.html#74" title="do { (f-&gt;bge_addr).bge_addr_lo = ((uint64_t) (dmamap-&gt;dm_segs[i].ds_addr) &amp; 0xffffffff); if (sizeof (bus_addr_t) == 8) (f-&gt;bge_addr).bge_addr_hi = ((uint64_t) (dmamap-&gt;dm_segs[i].ds_addr) &gt;&gt; 32); else (f-&gt;bge_addr).bge_addr_hi = 0; } while(0)" data-ref="_M/BGE_HOSTADDR">BGE_HOSTADDR</a>(<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_addr" title='bge_tx_bd::bge_addr' data-ref="bge_tx_bd::bge_addr" data-ref-filename="bge_tx_bd..bge_addr">bge_addr</a>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_segs" title='x86_bus_dmamap::dm_segs' data-ref="x86_bus_dmamap::dm_segs" data-ref-filename="x86_bus_dmamap..dm_segs">dm_segs</a>[<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a>].<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dma_segment::ds_addr" title='x86_bus_dma_segment::ds_addr' data-ref="x86_bus_dma_segment::ds_addr" data-ref-filename="x86_bus_dma_segment..ds_addr">ds_addr</a>);</td></tr>
<tr><th id="5264">5264</th><td>		<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_len" title='bge_tx_bd::bge_len' data-ref="bge_tx_bd::bge_len" data-ref-filename="bge_tx_bd..bge_len">bge_len</a> = <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_segs" title='x86_bus_dmamap::dm_segs' data-ref="x86_bus_dmamap::dm_segs" data-ref-filename="x86_bus_dmamap..dm_segs">dm_segs</a>[<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a>].<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dma_segment::ds_len" title='x86_bus_dma_segment::ds_len' data-ref="x86_bus_dma_segment::ds_len" data-ref-filename="x86_bus_dma_segment..ds_len">ds_len</a>;</td></tr>
<tr><th id="5265">5265</th><td>		<b>if</b> (<b>sizeof</b>(<a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a>) &gt; <var>4</var> &amp;&amp; <a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::is_dma32" title='txdmamap_pool_entry::is_dma32' data-ref="txdmamap_pool_entry::is_dma32" data-ref-filename="txdmamap_pool_entry..is_dma32">is_dma32</a> == <a class="macro" href="../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a> &amp;&amp; <a class="local col5 ref" href="#355use_tso" title='use_tso' data-ref="355use_tso" data-ref-filename="355use_tso">use_tso</a> &amp;&amp; (</td></tr>
<tr><th id="5266">5266</th><td>		    (<a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_segs" title='x86_bus_dmamap::dm_segs' data-ref="x86_bus_dmamap::dm_segs" data-ref-filename="x86_bus_dmamap..dm_segs">dm_segs</a>[<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a>].<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dma_segment::ds_addr" title='x86_bus_dma_segment::ds_addr' data-ref="x86_bus_dma_segment::ds_addr" data-ref-filename="x86_bus_dma_segment..ds_addr">ds_addr</a> &amp; <var>0xffffffff00000000</var>) !=</td></tr>
<tr><th id="5267">5267</th><td>		    ((<a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_segs" title='x86_bus_dmamap::dm_segs' data-ref="x86_bus_dmamap::dm_segs" data-ref-filename="x86_bus_dmamap..dm_segs">dm_segs</a>[<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a>].<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dma_segment::ds_addr" title='x86_bus_dma_segment::ds_addr' data-ref="x86_bus_dma_segment::ds_addr" data-ref-filename="x86_bus_dma_segment..ds_addr">ds_addr</a> + <a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_len" title='bge_tx_bd::bge_len' data-ref="bge_tx_bd::bge_len" data-ref-filename="bge_tx_bd..bge_len">bge_len</a>) &amp; <var>0xffffffff00000000</var>) ||</td></tr>
<tr><th id="5268">5268</th><td>		    (<a class="local col6 ref" href="#346prev_f" title='prev_f' data-ref="346prev_f" data-ref-filename="346prev_f">prev_f</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> &amp;&amp;</td></tr>
<tr><th id="5269">5269</th><td>		     <a class="local col6 ref" href="#346prev_f" title='prev_f' data-ref="346prev_f" data-ref-filename="346prev_f">prev_f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_addr" title='bge_tx_bd::bge_addr' data-ref="bge_tx_bd::bge_addr" data-ref-filename="bge_tx_bd..bge_addr">bge_addr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a> != <a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_addr" title='bge_tx_bd::bge_addr' data-ref="bge_tx_bd::bge_addr" data-ref-filename="bge_tx_bd..bge_addr">bge_addr</a>.<a class="ref field" href="if_bgereg.h.html#(anonymous)::bge_addr_hi" title='(anonymous struct)::bge_addr_hi' data-ref="(anonymous)::bge_addr_hi" data-ref-filename="(anonymous)..bge_addr_hi">bge_addr_hi</a>))</td></tr>
<tr><th id="5270">5270</th><td>		   ) {</td></tr>
<tr><th id="5271">5271</th><td>			<i>/*</i></td></tr>
<tr><th id="5272">5272</th><td><i>			 * watchdog timeout issue was observed with TSO,</i></td></tr>
<tr><th id="5273">5273</th><td><i>			 * limiting DMA address space to 32bits seems to</i></td></tr>
<tr><th id="5274">5274</th><td><i>			 * address the issue.</i></td></tr>
<tr><th id="5275">5275</th><td><i>			 */</i></td></tr>
<tr><th id="5276">5276</th><td>			<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>);</td></tr>
<tr><th id="5277">5277</th><td>			<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a> = <a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dmatag32" title='bge_softc::bge_dmatag32' data-ref="bge_softc::bge_dmatag32" data-ref-filename="bge_softc..bge_dmatag32">bge_dmatag32</a>;</td></tr>
<tr><th id="5278">5278</th><td>			<a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a> = <a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::dmamap32" title='txdmamap_pool_entry::dmamap32' data-ref="txdmamap_pool_entry::dmamap32" data-ref-filename="txdmamap_pool_entry..dmamap32">dmamap32</a>;</td></tr>
<tr><th id="5279">5279</th><td>			<a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>-&gt;<a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::is_dma32" title='txdmamap_pool_entry::is_dma32' data-ref="txdmamap_pool_entry::is_dma32" data-ref-filename="txdmamap_pool_entry..is_dma32">is_dma32</a> = <a class="macro" href="../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="5280">5280</th><td>			<a class="local col0 ref" href="#360remap" title='remap' data-ref="360remap" data-ref-filename="360remap">remap</a> = <a class="macro" href="../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="5281">5281</th><td>			<b>goto</b> <a class="lbl" href="#375load_again" data-ref="375load_again" data-ref-filename="375load_again">load_again</a>;</td></tr>
<tr><th id="5282">5282</th><td>		}</td></tr>
<tr><th id="5283">5283</th><td></td></tr>
<tr><th id="5284">5284</th><td>		<i>/*</i></td></tr>
<tr><th id="5285">5285</th><td><i>		 * For 5751 and follow-ons, for TSO we must turn</i></td></tr>
<tr><th id="5286">5286</th><td><i>		 * off checksum-assist flag in the tx-descr, and</i></td></tr>
<tr><th id="5287">5287</th><td><i>		 * supply the ASIC-revision-specific encoding</i></td></tr>
<tr><th id="5288">5288</th><td><i>		 * of TSO flags and segsize.</i></td></tr>
<tr><th id="5289">5289</th><td><i>		 */</i></td></tr>
<tr><th id="5290">5290</th><td>		<b>if</b> (<a class="local col5 ref" href="#355use_tso" title='use_tso' data-ref="355use_tso" data-ref-filename="355use_tso">use_tso</a>) {</td></tr>
<tr><th id="5291">5291</th><td>			<b>if</b> (<a class="macro" href="#413" title="((sc)-&gt;bge_flags &amp; 0x00002000)" data-ref="_M/BGE_IS_575X_PLUS">BGE_IS_575X_PLUS</a>(<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>) || <a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a> == <var>0</var>) {</td></tr>
<tr><th id="5292">5292</th><td>				<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_rsvd" title='bge_tx_bd::bge_rsvd' data-ref="bge_tx_bd::bge_rsvd" data-ref-filename="bge_tx_bd..bge_rsvd">bge_rsvd</a> = <a class="local col6 ref" href="#356maxsegsize" title='maxsegsize' data-ref="356maxsegsize" data-ref-filename="356maxsegsize">maxsegsize</a>;</td></tr>
<tr><th id="5293">5293</th><td>				<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> = <a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> | <a class="local col0 ref" href="#350txbd_tso_flags" title='txbd_tso_flags' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</a>;</td></tr>
<tr><th id="5294">5294</th><td>			} <b>else</b> {</td></tr>
<tr><th id="5295">5295</th><td>				<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_rsvd" title='bge_tx_bd::bge_rsvd' data-ref="bge_tx_bd::bge_rsvd" data-ref-filename="bge_tx_bd..bge_rsvd">bge_rsvd</a> = <var>0</var>;</td></tr>
<tr><th id="5296">5296</th><td>				<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> =</td></tr>
<tr><th id="5297">5297</th><td>				  (<a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a> | <a class="local col0 ref" href="#350txbd_tso_flags" title='txbd_tso_flags' data-ref="350txbd_tso_flags" data-ref-filename="350txbd_tso_flags">txbd_tso_flags</a>) &amp; <var>0x0fff</var>;</td></tr>
<tr><th id="5298">5298</th><td>			}</td></tr>
<tr><th id="5299">5299</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5300">5300</th><td>			<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_rsvd" title='bge_tx_bd::bge_rsvd' data-ref="bge_tx_bd::bge_rsvd" data-ref-filename="bge_tx_bd..bge_rsvd">bge_rsvd</a> = <var>0</var>;</td></tr>
<tr><th id="5301">5301</th><td>			<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> = <a class="local col9 ref" href="#349csum_flags" title='csum_flags' data-ref="349csum_flags" data-ref-filename="349csum_flags">csum_flags</a>;</td></tr>
<tr><th id="5302">5302</th><td>		}</td></tr>
<tr><th id="5303">5303</th><td></td></tr>
<tr><th id="5304">5304</th><td>		<b>if</b> (<a class="local col8 ref" href="#358have_vtag" title='have_vtag' data-ref="358have_vtag" data-ref-filename="358have_vtag">have_vtag</a>) {</td></tr>
<tr><th id="5305">5305</th><td>			<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2281" title="0x0040" data-ref="_M/BGE_TXBDFLAG_VLAN_TAG">BGE_TXBDFLAG_VLAN_TAG</a>;</td></tr>
<tr><th id="5306">5306</th><td>			<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_vlan_tag" title='bge_tx_bd::bge_vlan_tag' data-ref="bge_tx_bd::bge_vlan_tag" data-ref-filename="bge_tx_bd..bge_vlan_tag">bge_vlan_tag</a> = <a class="local col9 ref" href="#359vtag" title='vtag' data-ref="359vtag" data-ref-filename="359vtag">vtag</a>;</td></tr>
<tr><th id="5307">5307</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5308">5308</th><td>			<a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>-&gt;<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_vlan_tag" title='bge_tx_bd::bge_vlan_tag' data-ref="bge_tx_bd::bge_vlan_tag" data-ref-filename="bge_tx_bd..bge_vlan_tag">bge_vlan_tag</a> = <var>0</var>;</td></tr>
<tr><th id="5309">5309</th><td>		}</td></tr>
<tr><th id="5310">5310</th><td>		<a class="local col6 ref" href="#346prev_f" title='prev_f' data-ref="346prev_f" data-ref-filename="346prev_f">prev_f</a> = <a class="local col5 ref" href="#345f" title='f' data-ref="345f" data-ref-filename="345f">f</a>;</td></tr>
<tr><th id="5311">5311</th><td>		<a class="local col8 ref" href="#348cur" title='cur' data-ref="348cur" data-ref-filename="348cur">cur</a> = <a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a>;</td></tr>
<tr><th id="5312">5312</th><td>		<a class="macro" href="if_bgevar.h.html#90" title="(frag) = (frag + 1) % 512" data-ref="_M/BGE_INC">BGE_INC</a>(<a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a>, <a class="macro" href="if_bgereg.h.html#2465" title="512" data-ref="_M/BGE_TX_RING_CNT">BGE_TX_RING_CNT</a>);</td></tr>
<tr><th id="5313">5313</th><td>	}</td></tr>
<tr><th id="5314">5314</th><td></td></tr>
<tr><th id="5315">5315</th><td>	<b>if</b> (<a class="local col4 ref" href="#354i" title='i' data-ref="354i" data-ref-filename="354i">i</a> &lt; <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_nsegs" title='x86_bus_dmamap::dm_nsegs' data-ref="x86_bus_dmamap::dm_nsegs" data-ref-filename="x86_bus_dmamap..dm_nsegs">dm_nsegs</a>) {</td></tr>
<tr><th id="5316">5316</th><td>		<a class="macro" href="#284" title="" data-ref="_M/BGE_TSO_PRINTF">BGE_TSO_PRINTF</a>((<q>"%s: reached %d &lt; dm_nsegs %d\n"</q>,</td></tr>
<tr><th id="5317">5317</th><td>		    device_xname(sc-&gt;bge_dev), i, dmamap-&gt;dm_nsegs));</td></tr>
<tr><th id="5318">5318</th><td>		<b>goto</b> <a class="lbl" href="#377fail_unload" data-ref="377fail_unload" data-ref-filename="377fail_unload">fail_unload</a>;</td></tr>
<tr><th id="5319">5319</th><td>	}</td></tr>
<tr><th id="5320">5320</th><td></td></tr>
<tr><th id="5321">5321</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_sync" title='bus_dmamap_sync' data-ref="bus_dmamap_sync" data-ref-filename="bus_dmamap_sync">bus_dmamap_sync</a>(<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>, <var>0</var>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_mapsize" title='x86_bus_dmamap::dm_mapsize' data-ref="x86_bus_dmamap::dm_mapsize" data-ref-filename="x86_bus_dmamap..dm_mapsize">dm_mapsize</a>,</td></tr>
<tr><th id="5322">5322</th><td>	    <a class="macro" href="../../sys/bus_proto.h.html#328" title="0x04" data-ref="_M/BUS_DMASYNC_PREWRITE">BUS_DMASYNC_PREWRITE</a>);</td></tr>
<tr><th id="5323">5323</th><td></td></tr>
<tr><th id="5324">5324</th><td>	<b>if</b> (<a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a> == <a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a>) {</td></tr>
<tr><th id="5325">5325</th><td>		<a class="macro" href="#284" title="" data-ref="_M/BGE_TSO_PRINTF">BGE_TSO_PRINTF</a>((<q>"%s: frag %d = wrapped id %d?\n"</q>,</td></tr>
<tr><th id="5326">5326</th><td>		    device_xname(sc-&gt;bge_dev), frag, sc-&gt;bge_tx_saved_considx));</td></tr>
<tr><th id="5327">5327</th><td></td></tr>
<tr><th id="5328">5328</th><td>		<b>goto</b> <a class="lbl" href="#377fail_unload" data-ref="377fail_unload" data-ref-filename="377fail_unload">fail_unload</a>;</td></tr>
<tr><th id="5329">5329</th><td>	}</td></tr>
<tr><th id="5330">5330</th><td></td></tr>
<tr><th id="5331">5331</th><td>	<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rdata" title='bge_softc::bge_rdata' data-ref="bge_softc::bge_rdata" data-ref-filename="bge_softc..bge_rdata">bge_rdata</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_ring_data::bge_tx_ring" title='bge_ring_data::bge_tx_ring' data-ref="bge_ring_data::bge_tx_ring" data-ref-filename="bge_ring_data..bge_tx_ring">bge_tx_ring</a>[<a class="local col8 ref" href="#348cur" title='cur' data-ref="348cur" data-ref-filename="348cur">cur</a>].<a class="ref field" href="if_bgereg.h.html#bge_tx_bd::bge_flags" title='bge_tx_bd::bge_flags' data-ref="bge_tx_bd::bge_flags" data-ref-filename="bge_tx_bd..bge_flags">bge_flags</a> |= <a class="macro" href="if_bgereg.h.html#2278" title="0x0004" data-ref="_M/BGE_TXBDFLAG_END">BGE_TXBDFLAG_END</a>;</td></tr>
<tr><th id="5332">5332</th><td>	<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col8 ref" href="#348cur" title='cur' data-ref="348cur" data-ref-filename="348cur">cur</a>] = <a class="local col2 ref" href="#342m_head" title='m_head' data-ref="342m_head" data-ref-filename="342m_head">m_head</a>;</td></tr>
<tr><th id="5333">5333</th><td>	<a class="macro" href="../../sys/queue.h.html#167" title="do { (&amp;sc-&gt;txdma_list)-&gt;slh_first = (&amp;sc-&gt;txdma_list)-&gt;slh_first-&gt;link.sle_next; } while ( 0)" data-ref="_M/SLIST_REMOVE_HEAD">SLIST_REMOVE_HEAD</a>(&amp;<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma_list" title='bge_softc::txdma_list' data-ref="bge_softc::txdma_list" data-ref-filename="bge_softc..txdma_list">txdma_list</a>, <a class="ref field" href="if_bgevar.h.html#txdmamap_pool_entry::link" title='txdmamap_pool_entry::link' data-ref="txdmamap_pool_entry::link" data-ref-filename="txdmamap_pool_entry..link">link</a>);</td></tr>
<tr><th id="5334">5334</th><td>	<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::txdma" title='bge_softc::txdma' data-ref="bge_softc::txdma" data-ref-filename="bge_softc..txdma">txdma</a>[<a class="local col8 ref" href="#348cur" title='cur' data-ref="348cur" data-ref-filename="348cur">cur</a>] = <a class="local col1 ref" href="#351dma" title='dma' data-ref="351dma" data-ref-filename="351dma">dma</a>;</td></tr>
<tr><th id="5335">5335</th><td>	<a class="local col1 ref" href="#341sc" title='sc' data-ref="341sc" data-ref-filename="341sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_txcnt" title='bge_softc::bge_txcnt' data-ref="bge_softc::bge_txcnt" data-ref-filename="bge_softc..bge_txcnt">bge_txcnt</a> += <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>-&gt;<a class="ref field" href="../../arch/x86/include/bus_defs.h.html#x86_bus_dmamap::dm_nsegs" title='x86_bus_dmamap::dm_nsegs' data-ref="x86_bus_dmamap::dm_nsegs" data-ref-filename="x86_bus_dmamap..dm_nsegs">dm_nsegs</a>;</td></tr>
<tr><th id="5336">5336</th><td></td></tr>
<tr><th id="5337">5337</th><td>	*<a class="local col3 ref" href="#343txidx" title='txidx' data-ref="343txidx" data-ref-filename="343txidx">txidx</a> = <a class="local col7 ref" href="#347frag" title='frag' data-ref="347frag" data-ref-filename="347frag">frag</a>;</td></tr>
<tr><th id="5338">5338</th><td></td></tr>
<tr><th id="5339">5339</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5340">5340</th><td></td></tr>
<tr><th id="5341">5341</th><td><dfn class="lbl" id="377fail_unload" data-ref="377fail_unload" data-ref-filename="377fail_unload">fail_unload</dfn>:</td></tr>
<tr><th id="5342">5342</th><td>	<a class="ref fn" href="../../sys/bus_proto.h.html#bus_dmamap_unload" title='bus_dmamap_unload' data-ref="bus_dmamap_unload" data-ref-filename="bus_dmamap_unload">bus_dmamap_unload</a>(<a class="local col3 ref" href="#353dmatag" title='dmatag' data-ref="353dmatag" data-ref-filename="353dmatag">dmatag</a>, <a class="local col2 ref" href="#352dmamap" title='dmamap' data-ref="352dmamap" data-ref-filename="352dmamap">dmamap</a>);</td></tr>
<tr><th id="5343">5343</th><td>	<a class="local col4 ref" href="#344ifp" title='ifp' data-ref="344ifp" data-ref-filename="344ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> |= <a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>;</td></tr>
<tr><th id="5344">5344</th><td></td></tr>
<tr><th id="5345">5345</th><td>	<b>return</b> <a class="macro" href="../../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>;</td></tr>
<tr><th id="5346">5346</th><td>}</td></tr>
<tr><th id="5347">5347</th><td></td></tr>
<tr><th id="5348">5348</th><td><i  data-doc="bge_start">/*</i></td></tr>
<tr><th id="5349">5349</th><td><i  data-doc="bge_start"> * Main transmit routine. To avoid having to do mbuf copies, we put pointers</i></td></tr>
<tr><th id="5350">5350</th><td><i  data-doc="bge_start"> * to the mbuf data regions directly in the transmit descriptors.</i></td></tr>
<tr><th id="5351">5351</th><td><i  data-doc="bge_start"> */</i></td></tr>
<tr><th id="5352">5352</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="5353">5353</th><td><dfn class="tu decl def fn" id="bge_start" title='bge_start' data-type='void bge_start(struct ifnet * ifp)' data-ref="bge_start" data-ref-filename="bge_start">bge_start</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col8 decl" id="378ifp" title='ifp' data-type='struct ifnet *' data-ref="378ifp" data-ref-filename="378ifp">ifp</dfn>)</td></tr>
<tr><th id="5354">5354</th><td>{</td></tr>
<tr><th id="5355">5355</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col9 decl" id="379sc" title='sc' data-type='struct bge_softc *' data-ref="379sc" data-ref-filename="379sc">sc</dfn>;</td></tr>
<tr><th id="5356">5356</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col0 decl" id="380m_head" title='m_head' data-type='struct mbuf *' data-ref="380m_head" data-ref-filename="380m_head">m_head</dfn> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="5357">5357</th><td>	<b>struct</b> <a class="type" href="../../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col1 decl" id="381m" title='m' data-type='struct mbuf *' data-ref="381m" data-ref-filename="381m">m</dfn>;</td></tr>
<tr><th id="5358">5358</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="382prodidx" title='prodidx' data-type='uint32_t' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</dfn>;</td></tr>
<tr><th id="5359">5359</th><td>	<em>int</em> <dfn class="local col3 decl" id="383pkts" title='pkts' data-type='int' data-ref="383pkts" data-ref-filename="383pkts">pkts</dfn> = <var>0</var>;</td></tr>
<tr><th id="5360">5360</th><td>	<em>int</em> <dfn class="local col4 decl" id="384error" title='error' data-type='int' data-ref="384error" data-ref-filename="384error">error</dfn>;</td></tr>
<tr><th id="5361">5361</th><td></td></tr>
<tr><th id="5362">5362</th><td>	<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a> = <a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5363">5363</th><td></td></tr>
<tr><th id="5364">5364</th><td>	<b>if</b> ((<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; (<a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a> | <a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>)) != <a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>)</td></tr>
<tr><th id="5365">5365</th><td>		<b>return</b>;</td></tr>
<tr><th id="5366">5366</th><td></td></tr>
<tr><th id="5367">5367</th><td>	<a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a> = <a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_prodidx" title='bge_softc::bge_tx_prodidx' data-ref="bge_softc::bge_tx_prodidx" data-ref-filename="bge_softc..bge_tx_prodidx">bge_tx_prodidx</a>;</td></tr>
<tr><th id="5368">5368</th><td></td></tr>
<tr><th id="5369">5369</th><td>	<b>while</b> (<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_cdata" title='bge_softc::bge_cdata' data-ref="bge_softc::bge_cdata" data-ref-filename="bge_softc..bge_cdata">bge_cdata</a>.<a class="ref field" href="if_bgevar.h.html#bge_chain_data::bge_tx_chain" title='bge_chain_data::bge_tx_chain' data-ref="bge_chain_data::bge_tx_chain" data-ref-filename="bge_chain_data..bge_tx_chain">bge_tx_chain</a>[<a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a>] == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="5370">5370</th><td>		<a class="macro" href="../../net/if.h.html#1039" title="do { mutex_enter((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); (((m_head)) = ((&amp;ifp-&gt;if_snd))-&gt;ifq_head); mutex_exit((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); } while ( 0)" data-ref="_M/IFQ_POLL">IFQ_POLL</a>(&amp;<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_snd" title='ifnet::if_snd' data-ref="ifnet::if_snd" data-ref-filename="ifnet..if_snd">if_snd</a>, <a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>);</td></tr>
<tr><th id="5371">5371</th><td>		<b>if</b> (<a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="5372">5372</th><td>			<b>break</b>;</td></tr>
<tr><th id="5373">5373</th><td></td></tr>
<tr><th id="5374">5374</th><td><u>#<span data-ppcond="5374">if</span> 0</u></td></tr>
<tr><th id="5375">5375</th><td>		<i>/*</i></td></tr>
<tr><th id="5376">5376</th><td><i>		 * XXX</i></td></tr>
<tr><th id="5377">5377</th><td><i>		 * safety overkill.  If this is a fragmented packet chain</i></td></tr>
<tr><th id="5378">5378</th><td><i>		 * with delayed TCP/UDP checksums, then only encapsulate</i></td></tr>
<tr><th id="5379">5379</th><td><i>		 * it if we have enough descriptors to handle the entire</i></td></tr>
<tr><th id="5380">5380</th><td><i>		 * chain at once.</i></td></tr>
<tr><th id="5381">5381</th><td><i>		 * (paranoia -- may not actually be needed)</i></td></tr>
<tr><th id="5382">5382</th><td><i>		 */</i></td></tr>
<tr><th id="5383">5383</th><td>		<b>if</b> (m_head-&gt;m_flags &amp; M_FIRSTFRAG &amp;&amp;</td></tr>
<tr><th id="5384">5384</th><td>		    m_head-&gt;m_pkthdr.csum_flags &amp; (CSUM_DELAY_DATA)) {</td></tr>
<tr><th id="5385">5385</th><td>			<b>if</b> ((BGE_TX_RING_CNT - sc-&gt;bge_txcnt) &lt;</td></tr>
<tr><th id="5386">5386</th><td>			    M_CSUM_DATA_IPv4_OFFSET(m_head-&gt;m_pkthdr.csum_data) + <var>16</var>) {</td></tr>
<tr><th id="5387">5387</th><td>				ifp-&gt;if_flags |= IFF_OACTIVE;</td></tr>
<tr><th id="5388">5388</th><td>				<b>break</b>;</td></tr>
<tr><th id="5389">5389</th><td>			}</td></tr>
<tr><th id="5390">5390</th><td>		}</td></tr>
<tr><th id="5391">5391</th><td><u>#<span data-ppcond="5374">endif</span></u></td></tr>
<tr><th id="5392">5392</th><td></td></tr>
<tr><th id="5393">5393</th><td>		<i>/*</i></td></tr>
<tr><th id="5394">5394</th><td><i>		 * Pack the data into the transmit ring. If we</i></td></tr>
<tr><th id="5395">5395</th><td><i>		 * don't have room, set the OACTIVE flag and wait</i></td></tr>
<tr><th id="5396">5396</th><td><i>		 * for the NIC to drain the ring.</i></td></tr>
<tr><th id="5397">5397</th><td><i>		 */</i></td></tr>
<tr><th id="5398">5398</th><td>		<a class="local col4 ref" href="#384error" title='error' data-ref="384error" data-ref-filename="384error">error</a> = <a class="tu ref fn" href="#bge_encap" title='bge_encap' data-use='c' data-ref="bge_encap" data-ref-filename="bge_encap">bge_encap</a>(<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>, <a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>, &amp;<a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a>);</td></tr>
<tr><th id="5399">5399</th><td>		<b>if</b> (<a class="macro" href="../../sys/cdefs.h.html#488" title="__builtin_expect((error) != 0, 0)" data-ref="_M/__predict_false">__predict_false</a>(<a class="local col4 ref" href="#384error" title='error' data-ref="384error" data-ref-filename="384error">error</a>)) {</td></tr>
<tr><th id="5400">5400</th><td>			<b>if</b> (<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>) {</td></tr>
<tr><th id="5401">5401</th><td>				<i>/* just wait for the transmit ring to drain */</i></td></tr>
<tr><th id="5402">5402</th><td>				<b>break</b>;</td></tr>
<tr><th id="5403">5403</th><td>			}</td></tr>
<tr><th id="5404">5404</th><td>			<a class="macro" href="../../net/if.h.html#1032" title="do { mutex_enter((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); do { ((m)) = ((&amp;ifp-&gt;if_snd))-&gt;ifq_head; if ((m)) { if ((((&amp;ifp-&gt;if_snd))-&gt;ifq_head = ((m))-&gt;m_hdr.mh_nextpkt) == 0) ((&amp;ifp-&gt;if_snd))-&gt;ifq_tail = 0; ((m))-&gt;m_hdr.mh_nextpkt = 0; ((&amp;ifp-&gt;if_snd))-&gt;ifq_len--; } } while ( 0); mutex_exit((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); } while ( 0)" data-ref="_M/IFQ_DEQUEUE">IFQ_DEQUEUE</a>(&amp;<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_snd" title='ifnet::if_snd' data-ref="ifnet::if_snd" data-ref-filename="ifnet..if_snd">if_snd</a>, <a class="local col1 ref" href="#381m" title='m' data-ref="381m" data-ref-filename="381m">m</a>);</td></tr>
<tr><th id="5405">5405</th><td>			<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((m == m_head)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;m == m_head&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 5405))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col1 ref" href="#381m" title='m' data-ref="381m" data-ref-filename="381m">m</a> == <a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>);</td></tr>
<tr><th id="5406">5406</th><td>			<a class="ref fn" href="../../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>);</td></tr>
<tr><th id="5407">5407</th><td>			<b>continue</b>;</td></tr>
<tr><th id="5408">5408</th><td>		}</td></tr>
<tr><th id="5409">5409</th><td></td></tr>
<tr><th id="5410">5410</th><td>		<i>/* now we are committed to transmit the packet */</i></td></tr>
<tr><th id="5411">5411</th><td>		<a class="macro" href="../../net/if.h.html#1032" title="do { mutex_enter((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); do { ((m)) = ((&amp;ifp-&gt;if_snd))-&gt;ifq_head; if ((m)) { if ((((&amp;ifp-&gt;if_snd))-&gt;ifq_head = ((m))-&gt;m_hdr.mh_nextpkt) == 0) ((&amp;ifp-&gt;if_snd))-&gt;ifq_tail = 0; ((m))-&gt;m_hdr.mh_nextpkt = 0; ((&amp;ifp-&gt;if_snd))-&gt;ifq_len--; } } while ( 0); mutex_exit((&amp;ifp-&gt;if_snd)-&gt;ifq_lock); } while ( 0)" data-ref="_M/IFQ_DEQUEUE">IFQ_DEQUEUE</a>(&amp;<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_snd" title='ifnet::if_snd' data-ref="ifnet::if_snd" data-ref-filename="ifnet..if_snd">if_snd</a>, <a class="local col1 ref" href="#381m" title='m' data-ref="381m" data-ref-filename="381m">m</a>);</td></tr>
<tr><th id="5412">5412</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((m == m_head)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;m == m_head&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 5412))" data-ref="_M/KASSERT">KASSERT</a>(<a class="local col1 ref" href="#381m" title='m' data-ref="381m" data-ref-filename="381m">m</a> == <a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>);</td></tr>
<tr><th id="5413">5413</th><td>		<a class="local col3 ref" href="#383pkts" title='pkts' data-ref="383pkts" data-ref-filename="383pkts">pkts</a>++;</td></tr>
<tr><th id="5414">5414</th><td></td></tr>
<tr><th id="5415">5415</th><td>		<i>/*</i></td></tr>
<tr><th id="5416">5416</th><td><i>		 * If there's a BPF listener, bounce a copy of this frame</i></td></tr>
<tr><th id="5417">5417</th><td><i>		 * to him.</i></td></tr>
<tr><th id="5418">5418</th><td><i>		 */</i></td></tr>
<tr><th id="5419">5419</th><td>		<a class="ref fn" href="../../net/bpf.h.html#bpf_mtap" title='bpf_mtap' data-ref="bpf_mtap" data-ref-filename="bpf_mtap">bpf_mtap</a>(<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>, <a class="local col0 ref" href="#380m_head" title='m_head' data-ref="380m_head" data-ref-filename="380m_head">m_head</a>, <a class="macro" href="../../net/bpf.h.html#165" title="2" data-ref="_M/BPF_D_OUT">BPF_D_OUT</a>);</td></tr>
<tr><th id="5420">5420</th><td>	}</td></tr>
<tr><th id="5421">5421</th><td>	<b>if</b> (<a class="local col3 ref" href="#383pkts" title='pkts' data-ref="383pkts" data-ref-filename="383pkts">pkts</a> == <var>0</var>)</td></tr>
<tr><th id="5422">5422</th><td>		<b>return</b>;</td></tr>
<tr><th id="5423">5423</th><td></td></tr>
<tr><th id="5424">5424</th><td>	<i>/* Transmit */</i></td></tr>
<tr><th id="5425">5425</th><td>	<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>, <a class="macro" href="if_bgereg.h.html#554" title="0x0304" data-ref="_M/BGE_MBX_TX_HOST_PROD0_LO">BGE_MBX_TX_HOST_PROD0_LO</a>, <a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a>);</td></tr>
<tr><th id="5426">5426</th><td>	<i>/* 5700 b2 errata */</i></td></tr>
<tr><th id="5427">5427</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#386" title="0x71" data-ref="_M/BGE_CHIPREV_5700_BX">BGE_CHIPREV_5700_BX</a>)</td></tr>
<tr><th id="5428">5428</th><td>		<a class="tu ref fn" href="#bge_writembx" title='bge_writembx' data-use='c' data-ref="bge_writembx" data-ref-filename="bge_writembx">bge_writembx</a>(<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>, <a class="macro" href="if_bgereg.h.html#554" title="0x0304" data-ref="_M/BGE_MBX_TX_HOST_PROD0_LO">BGE_MBX_TX_HOST_PROD0_LO</a>, <a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a>);</td></tr>
<tr><th id="5429">5429</th><td></td></tr>
<tr><th id="5430">5430</th><td>	<a class="local col9 ref" href="#379sc" title='sc' data-ref="379sc" data-ref-filename="379sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_prodidx" title='bge_softc::bge_tx_prodidx' data-ref="bge_softc::bge_tx_prodidx" data-ref-filename="bge_softc..bge_tx_prodidx">bge_tx_prodidx</a> = <a class="local col2 ref" href="#382prodidx" title='prodidx' data-ref="382prodidx" data-ref-filename="382prodidx">prodidx</a>;</td></tr>
<tr><th id="5431">5431</th><td></td></tr>
<tr><th id="5432">5432</th><td>	<i>/*</i></td></tr>
<tr><th id="5433">5433</th><td><i>	 * Set a timeout in case the chip goes out to lunch.</i></td></tr>
<tr><th id="5434">5434</th><td><i>	 */</i></td></tr>
<tr><th id="5435">5435</th><td>	<a class="local col8 ref" href="#378ifp" title='ifp' data-ref="378ifp" data-ref-filename="378ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_timer" title='ifnet::if_timer' data-ref="ifnet::if_timer" data-ref-filename="ifnet..if_timer">if_timer</a> = <var>5</var>;</td></tr>
<tr><th id="5436">5436</th><td>}</td></tr>
<tr><th id="5437">5437</th><td></td></tr>
<tr><th id="5438">5438</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="5439">5439</th><td><dfn class="tu decl def fn" id="bge_init" title='bge_init' data-type='int bge_init(struct ifnet * ifp)' data-ref="bge_init" data-ref-filename="bge_init">bge_init</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col5 decl" id="385ifp" title='ifp' data-type='struct ifnet *' data-ref="385ifp" data-ref-filename="385ifp">ifp</dfn>)</td></tr>
<tr><th id="5440">5440</th><td>{</td></tr>
<tr><th id="5441">5441</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="386sc" title='sc' data-type='struct bge_softc *' data-ref="386sc" data-ref-filename="386sc">sc</dfn> = <a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5442">5442</th><td>	<em>const</em> <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> *<dfn class="local col7 decl" id="387m" title='m' data-type='const uint16_t *' data-ref="387m" data-ref-filename="387m">m</dfn>;</td></tr>
<tr><th id="5443">5443</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="388mode" title='mode' data-type='uint32_t' data-ref="388mode" data-ref-filename="388mode">mode</dfn>, <dfn class="local col9 decl" id="389reg" title='reg' data-type='uint32_t' data-ref="389reg" data-ref-filename="389reg">reg</dfn>;</td></tr>
<tr><th id="5444">5444</th><td>	<em>int</em> <dfn class="local col0 decl" id="390s" title='s' data-type='int' data-ref="390s" data-ref-filename="390s">s</dfn>, <dfn class="local col1 decl" id="391error" title='error' data-type='int' data-ref="391error" data-ref-filename="391error">error</dfn> = <var>0</var>;</td></tr>
<tr><th id="5445">5445</th><td></td></tr>
<tr><th id="5446">5446</th><td>	<a class="local col0 ref" href="#390s" title='s' data-ref="390s" data-ref-filename="390s">s</a> = <a class="macro" href="../../sys/intr.h.html#92" title="splvm()" data-ref="_M/splnet">splnet</a>();</td></tr>
<tr><th id="5447">5447</th><td></td></tr>
<tr><th id="5448">5448</th><td>	<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a> = &amp;<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="5449">5449</th><td></td></tr>
<tr><th id="5450">5450</th><td>	<i>/* Cancel pending I/O and flush buffers. */</i></td></tr>
<tr><th id="5451">5451</th><td>	<a class="tu ref fn" href="#bge_stop" title='bge_stop' data-use='c' data-ref="bge_stop" data-ref-filename="bge_stop">bge_stop</a>(<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>, <var>0</var>);</td></tr>
<tr><th id="5452">5452</th><td></td></tr>
<tr><th id="5453">5453</th><td>	<a class="tu ref fn" href="#bge_stop_fw" title='bge_stop_fw' data-use='c' data-ref="bge_stop_fw" data-ref-filename="bge_stop_fw">bge_stop_fw</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5454">5454</th><td>	<a class="tu ref fn" href="#bge_sig_pre_reset" title='bge_sig_pre_reset' data-use='c' data-ref="bge_sig_pre_reset" data-ref-filename="bge_sig_pre_reset">bge_sig_pre_reset</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="5455">5455</th><td>	<a class="tu ref fn" href="#bge_reset" title='bge_reset' data-use='c' data-ref="bge_reset" data-ref-filename="bge_reset">bge_reset</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5456">5456</th><td>	<a class="tu ref fn" href="#bge_sig_legacy" title='bge_sig_legacy' data-use='c' data-ref="bge_sig_legacy" data-ref-filename="bge_sig_legacy">bge_sig_legacy</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="5457">5457</th><td></td></tr>
<tr><th id="5458">5458</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#394" title="0x57840" data-ref="_M/BGE_CHIPREV_5784_AX">BGE_CHIPREV_5784_AX</a>) {</td></tr>
<tr><th id="5459">5459</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3600)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1234" title="0x3600" data-ref="_M/BGE_CPMU_CTRL">BGE_CPMU_CTRL</a>);</td></tr>
<tr><th id="5460">5460</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp;= ~(<a class="macro" href="if_bgereg.h.html#1248" title="0x00000400" data-ref="_M/BGE_CPMU_CTRL_LINK_AWARE_MODE">BGE_CPMU_CTRL_LINK_AWARE_MODE</a> |</td></tr>
<tr><th id="5461">5461</th><td>		    <a class="macro" href="if_bgereg.h.html#1247" title="0x00000200" data-ref="_M/BGE_CPMU_CTRL_LINK_IDLE_MODE">BGE_CPMU_CTRL_LINK_IDLE_MODE</a>);</td></tr>
<tr><th id="5462">5462</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3600, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1234" title="0x3600" data-ref="_M/BGE_CPMU_CTRL">BGE_CPMU_CTRL</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5463">5463</th><td></td></tr>
<tr><th id="5464">5464</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3604)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1235" title="0x3604" data-ref="_M/BGE_CPMU_LSPD_10MB_CLK">BGE_CPMU_LSPD_10MB_CLK</a>);</td></tr>
<tr><th id="5465">5465</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1235" title="0x3604" data-ref="_M/BGE_CPMU_LSPD_10MB_CLK">BGE_CPMU_LSPD_10MB_CLK</a>;</td></tr>
<tr><th id="5466">5466</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> |= <a class="macro" href="if_bgereg.h.html#1254" title="0x00130000" data-ref="_M/BGE_CPMU_LSPD_10MB_MACCLK_6_25">BGE_CPMU_LSPD_10MB_MACCLK_6_25</a>;</td></tr>
<tr><th id="5467">5467</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3604, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1235" title="0x3604" data-ref="_M/BGE_CPMU_LSPD_10MB_CLK">BGE_CPMU_LSPD_10MB_CLK</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5468">5468</th><td></td></tr>
<tr><th id="5469">5469</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3610)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1237" title="0x3610" data-ref="_M/BGE_CPMU_LNK_AWARE_PWRMD">BGE_CPMU_LNK_AWARE_PWRMD</a>);</td></tr>
<tr><th id="5470">5470</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1262" title="0x001F0000" data-ref="_M/BGE_CPMU_LNK_AWARE_MACCLK_MASK">BGE_CPMU_LNK_AWARE_MACCLK_MASK</a>;</td></tr>
<tr><th id="5471">5471</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> |= <a class="macro" href="if_bgereg.h.html#1263" title="0x00130000" data-ref="_M/BGE_CPMU_LNK_AWARE_MACCLK_6_25">BGE_CPMU_LNK_AWARE_MACCLK_6_25</a>;</td></tr>
<tr><th id="5472">5472</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3610, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1237" title="0x3610" data-ref="_M/BGE_CPMU_LNK_AWARE_PWRMD">BGE_CPMU_LNK_AWARE_PWRMD</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5473">5473</th><td></td></tr>
<tr><th id="5474">5474</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x361C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1238" title="0x361C" data-ref="_M/BGE_CPMU_HST_ACC">BGE_CPMU_HST_ACC</a>);</td></tr>
<tr><th id="5475">5475</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1265" title="0x001F0000" data-ref="_M/BGE_CPMU_HST_ACC_MACCLK_MASK">BGE_CPMU_HST_ACC_MACCLK_MASK</a>;</td></tr>
<tr><th id="5476">5476</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> |= <a class="macro" href="if_bgereg.h.html#1266" title="0x00130000" data-ref="_M/BGE_CPMU_HST_ACC_MACCLK_6_25">BGE_CPMU_HST_ACC_MACCLK_6_25</a>;</td></tr>
<tr><th id="5477">5477</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x361C, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1238" title="0x361C" data-ref="_M/BGE_CPMU_HST_ACC">BGE_CPMU_HST_ACC</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5478">5478</th><td>	}</td></tr>
<tr><th id="5479">5479</th><td></td></tr>
<tr><th id="5480">5480</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#381" title="0x57780" data-ref="_M/BGE_ASICREV_BCM57780">BGE_ASICREV_BCM57780</a>) {</td></tr>
<tr><th id="5481">5481</th><td>		<a class="typedef" href="pci_verbose.h.html#pcireg_t" title='pcireg_t' data-type='uint32_t' data-ref="pcireg_t" data-ref-filename="pcireg_t">pcireg_t</a> <dfn class="local col2 decl" id="392aercap" title='aercap' data-type='pcireg_t' data-ref="392aercap" data-ref-filename="392aercap">aercap</dfn>;</td></tr>
<tr><th id="5482">5482</th><td></td></tr>
<tr><th id="5483">5483</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d28)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1978" title="0x7d28" data-ref="_M/BGE_PCIE_PWRMNG_THRESH">BGE_PCIE_PWRMNG_THRESH</a>);</td></tr>
<tr><th id="5484">5484</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = (<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp; ~<a class="macro" href="if_bgereg.h.html#1983" title="0x0000ff00" data-ref="_M/BGE_PCIE_PWRMNG_L1THRESH_MASK">BGE_PCIE_PWRMNG_L1THRESH_MASK</a>)</td></tr>
<tr><th id="5485">5485</th><td>		    | <a class="macro" href="if_bgereg.h.html#1984" title="0x0000ff00" data-ref="_M/BGE_PCIE_PWRMNG_L1THRESH_4MS">BGE_PCIE_PWRMNG_L1THRESH_4MS</a></td></tr>
<tr><th id="5486">5486</th><td>		    | <a class="macro" href="if_bgereg.h.html#1985" title="0x01000000" data-ref="_M/BGE_PCIE_PWRMNG_EXTASPMTMR_EN">BGE_PCIE_PWRMNG_EXTASPMTMR_EN</a>;</td></tr>
<tr><th id="5487">5487</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d28, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1978" title="0x7d28" data-ref="_M/BGE_PCIE_PWRMNG_THRESH">BGE_PCIE_PWRMNG_THRESH</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5488">5488</th><td></td></tr>
<tr><th id="5489">5489</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7e70)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1980" title="0x7e70" data-ref="_M/BGE_PCIE_EIDLE_DELAY">BGE_PCIE_EIDLE_DELAY</a>);</td></tr>
<tr><th id="5490">5490</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = (<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp; ~<a class="macro" href="if_bgereg.h.html#1992" title="0x0000001f" data-ref="_M/BGE_PCIE_EIDLE_DELAY_MASK">BGE_PCIE_EIDLE_DELAY_MASK</a>)</td></tr>
<tr><th id="5491">5491</th><td>		    | <a class="macro" href="if_bgereg.h.html#1993" title="0x0000000c" data-ref="_M/BGE_PCIE_EIDLE_DELAY_13CLK">BGE_PCIE_EIDLE_DELAY_13CLK</a>;</td></tr>
<tr><th id="5492">5492</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7e70, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1980" title="0x7e70" data-ref="_M/BGE_PCIE_EIDLE_DELAY">BGE_PCIE_EIDLE_DELAY</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5493">5493</th><td></td></tr>
<tr><th id="5494">5494</th><td>		<i>/* Clear correctable error */</i></td></tr>
<tr><th id="5495">5495</th><td>		<b>if</b> (<a class="ref fn" href="pcivar.h.html#pci_get_ext_capability" title='pci_get_ext_capability' data-ref="pci_get_ext_capability" data-ref-filename="pci_get_ext_capability">pci_get_ext_capability</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="5496">5496</th><td>		    <a class="macro" href="pcireg.h.html#1492" title="0x0001" data-ref="_M/PCI_EXTCAP_AER">PCI_EXTCAP_AER</a>, &amp;<a class="local col2 ref" href="#392aercap" title='aercap' data-ref="392aercap" data-ref-filename="392aercap">aercap</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) != <var>0</var>)</td></tr>
<tr><th id="5497">5497</th><td>			<a class="ref fn" href="../../arch/x86/include/pci_machdep_common.h.html#pci_conf_write" title='pci_conf_write' data-ref="pci_conf_write" data-ref-filename="pci_conf_write">pci_conf_write</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pc" title='bge_softc::sc_pc' data-ref="bge_softc::sc_pc" data-ref-filename="bge_softc..sc_pc">sc_pc</a>, <a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::sc_pcitag" title='bge_softc::sc_pcitag' data-ref="bge_softc::sc_pcitag" data-ref-filename="bge_softc..sc_pcitag">sc_pcitag</a>,</td></tr>
<tr><th id="5498">5498</th><td>			    <a class="local col2 ref" href="#392aercap" title='aercap' data-ref="392aercap" data-ref-filename="392aercap">aercap</a> + <a class="macro" href="pcireg.h.html#1558" title="0x10" data-ref="_M/PCI_AER_COR_STATUS">PCI_AER_COR_STATUS</a>, <var>0xffffffff</var>);</td></tr>
<tr><th id="5499">5499</th><td></td></tr>
<tr><th id="5500">5500</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d54)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1979" title="0x7d54" data-ref="_M/BGE_PCIE_LINKCTL">BGE_PCIE_LINKCTL</a>);</td></tr>
<tr><th id="5501">5501</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = (<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> &amp; ~<a class="macro" href="if_bgereg.h.html#1988" title="0x00000008" data-ref="_M/BGE_PCIE_LINKCTL_L1_PLL_PDEN">BGE_PCIE_LINKCTL_L1_PLL_PDEN</a>)</td></tr>
<tr><th id="5502">5502</th><td>		    | <a class="macro" href="if_bgereg.h.html#1989" title="0x00000080" data-ref="_M/BGE_PCIE_LINKCTL_L1_PLL_PDDIS">BGE_PCIE_LINKCTL_L1_PLL_PDDIS</a>;</td></tr>
<tr><th id="5503">5503</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x7d54, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1979" title="0x7d54" data-ref="_M/BGE_PCIE_LINKCTL">BGE_PCIE_LINKCTL</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5504">5504</th><td>	}</td></tr>
<tr><th id="5505">5505</th><td></td></tr>
<tr><th id="5506">5506</th><td>	<a class="tu ref fn" href="#bge_sig_post_reset" title='bge_sig_post_reset' data-use='c' data-ref="bge_sig_post_reset" data-ref-filename="bge_sig_post_reset">bge_sig_post_reset</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="#255" title="1" data-ref="_M/BGE_RESET_START">BGE_RESET_START</a>);</td></tr>
<tr><th id="5507">5507</th><td></td></tr>
<tr><th id="5508">5508</th><td>	<a class="tu ref fn" href="#bge_chipinit" title='bge_chipinit' data-use='c' data-ref="bge_chipinit" data-ref-filename="bge_chipinit">bge_chipinit</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5509">5509</th><td></td></tr>
<tr><th id="5510">5510</th><td>	<i>/*</i></td></tr>
<tr><th id="5511">5511</th><td><i>	 * Init the various state machines, ring</i></td></tr>
<tr><th id="5512">5512</th><td><i>	 * control blocks and firmware.</i></td></tr>
<tr><th id="5513">5513</th><td><i>	 */</i></td></tr>
<tr><th id="5514">5514</th><td>	<a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a> = <a class="tu ref fn" href="#bge_blockinit" title='bge_blockinit' data-use='c' data-ref="bge_blockinit" data-ref-filename="bge_blockinit">bge_blockinit</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5515">5515</th><td>	<b>if</b> (<a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a> != <var>0</var>) {</td></tr>
<tr><th id="5516">5516</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"initialization error %d\n"</q>,</td></tr>
<tr><th id="5517">5517</th><td>		    <a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a>);</td></tr>
<tr><th id="5518">5518</th><td>		<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col0 ref" href="#390s" title='s' data-ref="390s" data-ref-filename="390s">s</a>);</td></tr>
<tr><th id="5519">5519</th><td>		<b>return</b> <a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a>;</td></tr>
<tr><th id="5520">5520</th><td>	}</td></tr>
<tr><th id="5521">5521</th><td></td></tr>
<tr><th id="5522">5522</th><td>	<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a> = &amp;<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="5523">5523</th><td></td></tr>
<tr><th id="5524">5524</th><td>	<i>/* 5718 step 25, 57XX step 54 */</i></td></tr>
<tr><th id="5525">5525</th><td>	<i>/* Specify MTU. */</i></td></tr>
<tr><th id="5526">5526</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x043C, ifp-&gt;if_data.ifi_mtu + ((6 * 2) + 2) + 4 + 4)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#640" title="0x043C" data-ref="_M/BGE_RX_MTU">BGE_RX_MTU</a>, <a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#396" title="if_data.ifi_mtu" data-ref="_M/if_mtu">if_mtu</a> +</td></tr>
<tr><th id="5527">5527</th><td>	    <a class="macro" href="../../net/if_ether.h.html#54" title="((6 * 2) + 2)" data-ref="_M/ETHER_HDR_LEN">ETHER_HDR_LEN</a> + <a class="macro" href="../../net/if_ether.h.html#53" title="4" data-ref="_M/ETHER_CRC_LEN">ETHER_CRC_LEN</a> + <a class="macro" href="../../net/if_ether.h.html#62" title="4" data-ref="_M/ETHER_VLAN_ENCAP_LEN">ETHER_VLAN_ENCAP_LEN</a>);</td></tr>
<tr><th id="5528">5528</th><td></td></tr>
<tr><th id="5529">5529</th><td>	<i>/* 5718 step 23 */</i></td></tr>
<tr><th id="5530">5530</th><td>	<i>/* Load our MAC address. */</i></td></tr>
<tr><th id="5531">5531</th><td>	<a class="local col7 ref" href="#387m" title='m' data-ref="387m" data-ref-filename="387m">m</a> = (<em>const</em> <a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> *)&amp;(<a class="macro" href="../../net/if_dl.h.html#98" title="((const char *)((ifp-&gt;if_sadl)-&gt;sdl_addr.dl_data + (ifp-&gt;if_sadl)-&gt;sdl_addr.dl_nlen))" data-ref="_M/CLLADDR">CLLADDR</a>(<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_sadl" title='ifnet::if_sadl' data-ref="ifnet::if_sadl" data-ref-filename="ifnet..if_sadl">if_sadl</a>)[<var>0</var>]);</td></tr>
<tr><th id="5532">5532</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0410, ((uint16_t)(__builtin_constant_p((((uint16_t)((m[0]))))) ? (((uint16_t)(((((((uint16_t)((m[0])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[0])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[0])))))))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#629" title="0x0410" data-ref="_M/BGE_MAC_ADDR1_LO">BGE_MAC_ADDR1_LO</a>, <a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((m[0]))))) ? (((uint16_t)(((((((uint16_t)((m[0])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[0])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[0]))))))" data-ref="_M/htons">htons</a>(<a class="local col7 ref" href="#387m" title='m' data-ref="387m" data-ref-filename="387m">m</a>[<var>0</var>]));</td></tr>
<tr><th id="5533">5533</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0414, (((uint16_t)(__builtin_constant_p((((uint16_t)((m[1]))))) ? (((uint16_t)(((((((uint16_t)((m[1])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[1])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[1])))))) &lt;&lt; 16) | ((uint16_t)(__builtin_constant_p((((uint16_t)((m[2]))))) ? (((uint16_t)(((((((uint16_t)((m[2])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[2])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[2])))))))" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#630" title="0x0414" data-ref="_M/BGE_MAC_ADDR1_HI">BGE_MAC_ADDR1_HI</a>, (<a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((m[1]))))) ? (((uint16_t)(((((((uint16_t)((m[1])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[1])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[1]))))))" data-ref="_M/htons">htons</a>(<a class="local col7 ref" href="#387m" title='m' data-ref="387m" data-ref-filename="387m">m</a>[<var>1</var>]) &lt;&lt; <var>16</var>) | <a class="macro" href="../../sys/endian.h.html#128" title="((uint16_t)(__builtin_constant_p((((uint16_t)((m[2]))))) ? (((uint16_t)(((((((uint16_t)((m[2])))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((m[2])))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((m[2]))))))" data-ref="_M/htons">htons</a>(<a class="local col7 ref" href="#387m" title='m' data-ref="387m" data-ref-filename="387m">m</a>[<var>2</var>]));</td></tr>
<tr><th id="5534">5534</th><td></td></tr>
<tr><th id="5535">5535</th><td>	<i>/* Enable or disable promiscuous mode as needed. */</i></td></tr>
<tr><th id="5536">5536</th><td>	<b>if</b> (<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#425" title="0x0100" data-ref="_M/IFF_PROMISC">IFF_PROMISC</a>)</td></tr>
<tr><th id="5537">5537</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468) | (0x00000100)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="macro" href="if_bgereg.h.html#804" title="0x00000100" data-ref="_M/BGE_RXMODE_RX_PROMISC">BGE_RXMODE_RX_PROMISC</a>);</td></tr>
<tr><th id="5538">5538</th><td>	<b>else</b></td></tr>
<tr><th id="5539">5539</th><td>		<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468) &amp; ~(0x00000100)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="macro" href="if_bgereg.h.html#804" title="0x00000100" data-ref="_M/BGE_RXMODE_RX_PROMISC">BGE_RXMODE_RX_PROMISC</a>);</td></tr>
<tr><th id="5540">5540</th><td></td></tr>
<tr><th id="5541">5541</th><td>	<i>/* Program multicast filter. */</i></td></tr>
<tr><th id="5542">5542</th><td>	<a class="tu ref fn" href="#bge_setmulti" title='bge_setmulti' data-use='c' data-ref="bge_setmulti" data-ref-filename="bge_setmulti">bge_setmulti</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5543">5543</th><td></td></tr>
<tr><th id="5544">5544</th><td>	<i>/* Init RX ring. */</i></td></tr>
<tr><th id="5545">5545</th><td>	<a class="tu ref fn" href="#bge_init_rx_ring_std" title='bge_init_rx_ring_std' data-use='c' data-ref="bge_init_rx_ring_std" data-ref-filename="bge_init_rx_ring_std">bge_init_rx_ring_std</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5546">5546</th><td></td></tr>
<tr><th id="5547">5547</th><td>	<i>/*</i></td></tr>
<tr><th id="5548">5548</th><td><i>	 * Workaround for a bug in 5705 ASIC rev A0. Poll the NIC's</i></td></tr>
<tr><th id="5549">5549</th><td><i>	 * memory to insure that the chip has in fact read the first</i></td></tr>
<tr><th id="5550">5550</th><td><i>	 * entry of the ring.</i></td></tr>
<tr><th id="5551">5551</th><td><i>	 */</i></td></tr>
<tr><th id="5552">5552</th><td>	<b>if</b> (<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a> == <a class="macro" href="if_bgereg.h.html#307" title="0x3000" data-ref="_M/BGE_CHIPID_BCM5705_A0">BGE_CHIPID_BCM5705_A0</a>) {</td></tr>
<tr><th id="5553">5553</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>		<dfn class="local col3 decl" id="393v" title='v' data-type='uint32_t' data-ref="393v" data-ref-filename="393v">v</dfn>, <dfn class="local col4 decl" id="394i" title='i' data-type='uint32_t' data-ref="394i" data-ref-filename="394i">i</dfn>;</td></tr>
<tr><th id="5554">5554</th><td>		<b>for</b> (<a class="local col4 ref" href="#394i" title='i' data-ref="394i" data-ref-filename="394i">i</a> = <var>0</var>; <a class="local col4 ref" href="#394i" title='i' data-ref="394i" data-ref-filename="394i">i</a> &lt; <var>10</var>; <a class="local col4 ref" href="#394i" title='i' data-ref="394i" data-ref-filename="394i">i</a>++) {</td></tr>
<tr><th id="5555">5555</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(20)" data-ref="_M/DELAY">DELAY</a>(<var>20</var>);</td></tr>
<tr><th id="5556">5556</th><td>			<a class="local col3 ref" href="#393v" title='v' data-ref="393v" data-ref-filename="393v">v</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#117" title="0x00006000" data-ref="_M/BGE_STD_RX_RINGS">BGE_STD_RX_RINGS</a> + <var>8</var>);</td></tr>
<tr><th id="5557">5557</th><td>			<b>if</b> (<a class="local col3 ref" href="#393v" title='v' data-ref="393v" data-ref-filename="393v">v</a> == (<a class="macro" href="../../arch/amd64/include/param.h.html#92" title="(1 &lt;&lt; 11)" data-ref="_M/MCLBYTES">MCLBYTES</a> - <a class="macro" href="../../net/if_ether.h.html#74" title="2" data-ref="_M/ETHER_ALIGN">ETHER_ALIGN</a>))</td></tr>
<tr><th id="5558">5558</th><td>				<b>break</b>;</td></tr>
<tr><th id="5559">5559</th><td>		}</td></tr>
<tr><th id="5560">5560</th><td>		<b>if</b> (<a class="local col4 ref" href="#394i" title='i' data-ref="394i" data-ref-filename="394i">i</a> == <var>10</var>)</td></tr>
<tr><th id="5561">5561</th><td>			<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="5562">5562</th><td>			    <q>"5705 A0 chip failed to load RX ring\n"</q>);</td></tr>
<tr><th id="5563">5563</th><td>	}</td></tr>
<tr><th id="5564">5564</th><td></td></tr>
<tr><th id="5565">5565</th><td>	<i>/* Init jumbo RX ring. */</i></td></tr>
<tr><th id="5566">5566</th><td>	<b>if</b> (<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#396" title="if_data.ifi_mtu" data-ref="_M/if_mtu">if_mtu</a> &gt; (<a class="macro" href="../../net/if_ether.h.html#99" title="(1518 - ((6 * 2) + 2) - 4)" data-ref="_M/ETHERMTU">ETHERMTU</a> + <a class="macro" href="../../net/if_ether.h.html#54" title="((6 * 2) + 2)" data-ref="_M/ETHER_HDR_LEN">ETHER_HDR_LEN</a> + <a class="macro" href="../../net/if_ether.h.html#53" title="4" data-ref="_M/ETHER_CRC_LEN">ETHER_CRC_LEN</a>))</td></tr>
<tr><th id="5567">5567</th><td>		<a class="tu ref fn" href="#bge_init_rx_ring_jumbo" title='bge_init_rx_ring_jumbo' data-use='c' data-ref="bge_init_rx_ring_jumbo" data-ref-filename="bge_init_rx_ring_jumbo">bge_init_rx_ring_jumbo</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5568">5568</th><td></td></tr>
<tr><th id="5569">5569</th><td>	<i>/* Init our RX return ring index */</i></td></tr>
<tr><th id="5570">5570</th><td>	<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_rx_saved_considx" title='bge_softc::bge_rx_saved_considx' data-ref="bge_softc::bge_rx_saved_considx" data-ref-filename="bge_softc..bge_rx_saved_considx">bge_rx_saved_considx</a> = <var>0</var>;</td></tr>
<tr><th id="5571">5571</th><td></td></tr>
<tr><th id="5572">5572</th><td>	<i>/* Init TX ring. */</i></td></tr>
<tr><th id="5573">5573</th><td>	<a class="tu ref fn" href="#bge_init_tx_ring" title='bge_init_tx_ring' data-use='c' data-ref="bge_init_tx_ring" data-ref-filename="bge_init_tx_ring">bge_init_tx_ring</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5574">5574</th><td></td></tr>
<tr><th id="5575">5575</th><td>	<i>/* 5718 step 63, 57XX step 94 */</i></td></tr>
<tr><th id="5576">5576</th><td>	<i>/* Enable TX MAC state machine lockup fix. */</i></td></tr>
<tr><th id="5577">5577</th><td>	<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>);</td></tr>
<tr><th id="5578">5578</th><td>	<b>if</b> (<a class="macro" href="#414" title="((sc)-&gt;bge_flags &amp; 0x00004000)" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>) ||</td></tr>
<tr><th id="5579">5579</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="5580">5580</th><td>		<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> |= <a class="macro" href="if_bgereg.h.html#778" title="0x00000100" data-ref="_M/BGE_TXMODE_MBUF_LOCKUP_FIX">BGE_TXMODE_MBUF_LOCKUP_FIX</a>;</td></tr>
<tr><th id="5581">5581</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#378" title="0x5720" data-ref="_M/BGE_ASICREV_BCM5720">BGE_ASICREV_BCM5720</a> ||</td></tr>
<tr><th id="5582">5582</th><td>	    <a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>) {</td></tr>
<tr><th id="5583">5583</th><td>		<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> &amp;= ~(<a class="macro" href="if_bgereg.h.html#779" title="0x00400000" data-ref="_M/BGE_TXMODE_JMB_FRM_LEN">BGE_TXMODE_JMB_FRM_LEN</a> | <a class="macro" href="if_bgereg.h.html#780" title="0x00800000" data-ref="_M/BGE_TXMODE_CNT_DN_MODE">BGE_TXMODE_CNT_DN_MODE</a>);</td></tr>
<tr><th id="5584">5584</th><td>		<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> |= <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>) &amp;</td></tr>
<tr><th id="5585">5585</th><td>		    (<a class="macro" href="if_bgereg.h.html#779" title="0x00400000" data-ref="_M/BGE_TXMODE_JMB_FRM_LEN">BGE_TXMODE_JMB_FRM_LEN</a> | <a class="macro" href="if_bgereg.h.html#780" title="0x00800000" data-ref="_M/BGE_TXMODE_CNT_DN_MODE">BGE_TXMODE_CNT_DN_MODE</a>);</td></tr>
<tr><th id="5586">5586</th><td>	}</td></tr>
<tr><th id="5587">5587</th><td></td></tr>
<tr><th id="5588">5588</th><td>	<i>/* Turn on transmitter */</i></td></tr>
<tr><th id="5589">5589</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C, mode | 0x00000002); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x045C); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>, <a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> | <a class="macro" href="if_bgereg.h.html#774" title="0x00000002" data-ref="_M/BGE_TXMODE_ENABLE">BGE_TXMODE_ENABLE</a>);</td></tr>
<tr><th id="5590">5590</th><td>	<i>/* 5718 step 64 */</i></td></tr>
<tr><th id="5591">5591</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(100)" data-ref="_M/DELAY">DELAY</a>(<var>100</var>);</td></tr>
<tr><th id="5592">5592</th><td></td></tr>
<tr><th id="5593">5593</th><td>	<i>/* 5718 step 65, 57XX step 95 */</i></td></tr>
<tr><th id="5594">5594</th><td>	<i>/* Turn on receiver */</i></td></tr>
<tr><th id="5595">5595</th><td>	<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>);</td></tr>
<tr><th id="5596">5596</th><td>	<b>if</b> (<a class="macro" href="#414" title="((sc)-&gt;bge_flags &amp; 0x00004000)" data-ref="_M/BGE_IS_5755_PLUS">BGE_IS_5755_PLUS</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>))</td></tr>
<tr><th id="5597">5597</th><td>		<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> |= <a class="macro" href="if_bgereg.h.html#807" title="0x01000000" data-ref="_M/BGE_RXMODE_IPV6_ENABLE">BGE_RXMODE_IPV6_ENABLE</a>;</td></tr>
<tr><th id="5598">5598</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#373" title="0x5762" data-ref="_M/BGE_ASICREV_BCM5762">BGE_ASICREV_BCM5762</a>)</td></tr>
<tr><th id="5599">5599</th><td>		<a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> |= <a class="macro" href="if_bgereg.h.html#808" title="0x02000000" data-ref="_M/BGE_RXMODE_IPV4_FRAG_FIX">BGE_RXMODE_IPV4_FRAG_FIX</a>;</td></tr>
<tr><th id="5600">5600</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, mode | 0x00000002); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="local col8 ref" href="#388mode" title='mode' data-ref="388mode" data-ref-filename="388mode">mode</a> | <a class="macro" href="if_bgereg.h.html#799" title="0x00000002" data-ref="_M/BGE_RXMODE_ENABLE">BGE_RXMODE_ENABLE</a>);</td></tr>
<tr><th id="5601">5601</th><td>	<i>/* 5718 step 66 */</i></td></tr>
<tr><th id="5602">5602</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(10)" data-ref="_M/DELAY">DELAY</a>(<var>10</var>);</td></tr>
<tr><th id="5603">5603</th><td></td></tr>
<tr><th id="5604">5604</th><td>	<i>/* 5718 step 12, 57XX step 37 */</i></td></tr>
<tr><th id="5605">5605</th><td>	<i>/*</i></td></tr>
<tr><th id="5606">5606</th><td><i>	 * XXX Doucments of 5718 series and 577xx say the recommended value</i></td></tr>
<tr><th id="5607">5607</th><td><i>	 * is 1, but tg3 set 1 only on 57765 series.</i></td></tr>
<tr><th id="5608">5608</th><td><i>	 */</i></td></tr>
<tr><th id="5609">5609</th><td>	<b>if</b> (<a class="macro" href="#416" title="((sc)-&gt;bge_flags &amp; 0x00080000)" data-ref="_M/BGE_IS_57765_PLUS">BGE_IS_57765_PLUS</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>))</td></tr>
<tr><th id="5610">5610</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <var>1</var>;</td></tr>
<tr><th id="5611">5611</th><td>	<b>else</b></td></tr>
<tr><th id="5612">5612</th><td>		<a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a> = <var>2</var>;</td></tr>
<tr><th id="5613">5613</th><td>	<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0504, reg); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0504); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#690" title="0x0504" data-ref="_M/BGE_MAX_RX_FRAME_LOWAT">BGE_MAX_RX_FRAME_LOWAT</a>, <a class="local col9 ref" href="#389reg" title='reg' data-ref="389reg" data-ref-filename="389reg">reg</a>);</td></tr>
<tr><th id="5614">5614</th><td></td></tr>
<tr><th id="5615">5615</th><td>	<i>/* Tell firmware we're alive. */</i></td></tr>
<tr><th id="5616">5616</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800) | (0x00010000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>);</td></tr>
<tr><th id="5617">5617</th><td></td></tr>
<tr><th id="5618">5618</th><td>	<i>/* Enable host interrupts. */</i></td></tr>
<tr><th id="5619">5619</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68) | (0x00000001)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>, <a class="macro" href="if_bgereg.h.html#255" title="0x00000001" data-ref="_M/BGE_PCIMISCCTL_CLEAR_INTA">BGE_PCIMISCCTL_CLEAR_INTA</a>);</td></tr>
<tr><th id="5620">5620</th><td>	<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68) &amp; ~(0x00000002)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>, <a class="macro" href="if_bgereg.h.html#256" title="0x00000002" data-ref="_M/BGE_PCIMISCCTL_MASK_PCI_INTR">BGE_PCIMISCCTL_MASK_PCI_INTR</a>);</td></tr>
<tr><th id="5621">5621</th><td>	<a class="tu ref fn" href="#bge_writembx_flush" title='bge_writembx_flush' data-use='c' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</a>(<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>, <a class="macro" href="if_bgereg.h.html#490" title="0x0204" data-ref="_M/BGE_MBX_IRQ0_LO">BGE_MBX_IRQ0_LO</a>, <var>0</var>);</td></tr>
<tr><th id="5622">5622</th><td></td></tr>
<tr><th id="5623">5623</th><td>	<b>if</b> ((<a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a> = <a class="tu ref fn" href="#bge_ifmedia_upd" title='bge_ifmedia_upd' data-use='c' data-ref="bge_ifmedia_upd" data-ref-filename="bge_ifmedia_upd">bge_ifmedia_upd</a>(<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>)) != <var>0</var>)</td></tr>
<tr><th id="5624">5624</th><td>		<b>goto</b> <a class="lbl" href="#395out" data-ref="395out" data-ref-filename="395out">out</a>;</td></tr>
<tr><th id="5625">5625</th><td></td></tr>
<tr><th id="5626">5626</th><td>	<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> |= <a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>;</td></tr>
<tr><th id="5627">5627</th><td>	<a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp;= ~<a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>;</td></tr>
<tr><th id="5628">5628</th><td></td></tr>
<tr><th id="5629">5629</th><td>	<a class="ref fn" href="../../sys/callout.h.html#callout_reset" title='callout_reset' data-ref="callout_reset" data-ref-filename="callout_reset">callout_reset</a>(&amp;<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_timeout" title='bge_softc::bge_timeout' data-ref="bge_softc::bge_timeout" data-ref-filename="bge_softc..bge_timeout">bge_timeout</a>, <a class="ref" href="../../sys/kernel.h.html#hz" title='hz' data-ref="hz" data-ref-filename="hz">hz</a>, <a class="tu ref fn" href="#bge_tick" title='bge_tick' data-use='r' data-ref="bge_tick" data-ref-filename="bge_tick">bge_tick</a>, <a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>);</td></tr>
<tr><th id="5630">5630</th><td></td></tr>
<tr><th id="5631">5631</th><td><dfn class="lbl" id="395out" data-ref="395out" data-ref-filename="395out">out</dfn>:</td></tr>
<tr><th id="5632">5632</th><td>	<a class="local col6 ref" href="#386sc" title='sc' data-ref="386sc" data-ref-filename="386sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_if_flags" title='bge_softc::bge_if_flags' data-ref="bge_softc::bge_if_flags" data-ref-filename="bge_softc..bge_if_flags">bge_if_flags</a> = <a class="local col5 ref" href="#385ifp" title='ifp' data-ref="385ifp" data-ref-filename="385ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a>;</td></tr>
<tr><th id="5633">5633</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col0 ref" href="#390s" title='s' data-ref="390s" data-ref-filename="390s">s</a>);</td></tr>
<tr><th id="5634">5634</th><td></td></tr>
<tr><th id="5635">5635</th><td>	<b>return</b> <a class="local col1 ref" href="#391error" title='error' data-ref="391error" data-ref-filename="391error">error</a>;</td></tr>
<tr><th id="5636">5636</th><td>}</td></tr>
<tr><th id="5637">5637</th><td></td></tr>
<tr><th id="5638">5638</th><td><i  data-doc="bge_ifmedia_upd">/*</i></td></tr>
<tr><th id="5639">5639</th><td><i  data-doc="bge_ifmedia_upd"> * Set media options.</i></td></tr>
<tr><th id="5640">5640</th><td><i  data-doc="bge_ifmedia_upd"> */</i></td></tr>
<tr><th id="5641">5641</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="5642">5642</th><td><dfn class="tu decl def fn" id="bge_ifmedia_upd" title='bge_ifmedia_upd' data-type='int bge_ifmedia_upd(struct ifnet * ifp)' data-ref="bge_ifmedia_upd" data-ref-filename="bge_ifmedia_upd">bge_ifmedia_upd</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col6 decl" id="396ifp" title='ifp' data-type='struct ifnet *' data-ref="396ifp" data-ref-filename="396ifp">ifp</dfn>)</td></tr>
<tr><th id="5643">5643</th><td>{</td></tr>
<tr><th id="5644">5644</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col7 decl" id="397sc" title='sc' data-type='struct bge_softc *' data-ref="397sc" data-ref-filename="397sc">sc</dfn> = <a class="local col6 ref" href="#396ifp" title='ifp' data-ref="396ifp" data-ref-filename="396ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5645">5645</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col8 decl" id="398mii" title='mii' data-type='struct mii_data *' data-ref="398mii" data-ref-filename="398mii">mii</dfn> = &amp;<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="5646">5646</th><td>	<b>struct</b> <a class="type" href="../../net/if_media.h.html#ifmedia" title='ifmedia' data-ref="ifmedia" data-ref-filename="ifmedia">ifmedia</a> *<dfn class="local col9 decl" id="399ifm" title='ifm' data-type='struct ifmedia *' data-ref="399ifm" data-ref-filename="399ifm">ifm</dfn> = &amp;<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>;</td></tr>
<tr><th id="5647">5647</th><td>	<em>int</em> <dfn class="local col0 decl" id="400rc" title='rc' data-type='int' data-ref="400rc" data-ref-filename="400rc">rc</dfn>;</td></tr>
<tr><th id="5648">5648</th><td></td></tr>
<tr><th id="5649">5649</th><td>	<i>/* If this is a 1000baseX NIC, enable the TBI port. */</i></td></tr>
<tr><th id="5650">5650</th><td>	<b>if</b> (<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="5651">5651</th><td>		<b>if</b> (<a class="macro" href="../../net/if_media.h.html#139" title="((ifm-&gt;ifm_media) &amp; 0x000000e0)" data-ref="_M/IFM_TYPE">IFM_TYPE</a>(<a class="local col9 ref" href="#399ifm" title='ifm' data-ref="399ifm" data-ref-filename="399ifm">ifm</a>-&gt;<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_media" title='ifmedia::ifm_media' data-ref="ifmedia::ifm_media" data-ref-filename="ifmedia..ifm_media">ifm_media</a>) != <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a>)</td></tr>
<tr><th id="5652">5652</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="5653">5653</th><td>		<b>switch</b> (<a class="macro" href="../../net/if_media.h.html#140" title="(((ifm-&gt;ifm_media) &amp; 0x000000e0) == 0x00000020 ? ((ifm-&gt;ifm_media) &amp; (0x0000001f | 0x0000e000)) : ((ifm-&gt;ifm_media) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col9 ref" href="#399ifm" title='ifm' data-ref="399ifm" data-ref-filename="399ifm">ifm</a>-&gt;<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_media" title='ifmedia::ifm_media' data-ref="ifmedia::ifm_media" data-ref-filename="ifmedia..ifm_media">ifm_media</a>)) {</td></tr>
<tr><th id="5654">5654</th><td>		<b>case</b> <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a>:</td></tr>
<tr><th id="5655">5655</th><td>			<i>/*</i></td></tr>
<tr><th id="5656">5656</th><td><i>			 * The BCM5704 ASIC appears to have a special</i></td></tr>
<tr><th id="5657">5657</th><td><i>			 * mechanism for programming the autoneg</i></td></tr>
<tr><th id="5658">5658</th><td><i>			 * advertisement registers in TBI mode.</i></td></tr>
<tr><th id="5659">5659</th><td><i>			 */</i></td></tr>
<tr><th id="5660">5660</th><td>			<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>) {</td></tr>
<tr><th id="5661">5661</th><td>				<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="401sgdig" title='sgdig' data-type='uint32_t' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</dfn>;</td></tr>
<tr><th id="5662">5662</th><td>				<a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B4)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#693" title="0x05B4" data-ref="_M/BGE_SGDIG_STS">BGE_SGDIG_STS</a>);</td></tr>
<tr><th id="5663">5663</th><td>				<b>if</b> (<a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a> &amp; <a class="macro" href="if_bgereg.h.html#839" title="0x00000002" data-ref="_M/BGE_SGDIGSTS_DONE">BGE_SGDIGSTS_DONE</a>) {</td></tr>
<tr><th id="5664">5664</th><td>					<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0444, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#642" title="0x0444" data-ref="_M/BGE_TX_TBI_AUTONEG">BGE_TX_TBI_AUTONEG</a>, <var>0</var>);</td></tr>
<tr><th id="5665">5665</th><td>					<a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B0)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#692" title="0x05B0" data-ref="_M/BGE_SGDIG_CFG">BGE_SGDIG_CFG</a>);</td></tr>
<tr><th id="5666">5666</th><td>					<a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a> |= <a class="macro" href="if_bgereg.h.html#836" title="0x80000000" data-ref="_M/BGE_SGDIGCFG_AUTO">BGE_SGDIGCFG_AUTO</a> |</td></tr>
<tr><th id="5667">5667</th><td>					    <a class="macro" href="if_bgereg.h.html#833" title="0x00000800" data-ref="_M/BGE_SGDIGCFG_PAUSE_CAP">BGE_SGDIGCFG_PAUSE_CAP</a> |</td></tr>
<tr><th id="5668">5668</th><td>					    <a class="macro" href="if_bgereg.h.html#834" title="0x00001000" data-ref="_M/BGE_SGDIGCFG_ASYM_PAUSE">BGE_SGDIGCFG_ASYM_PAUSE</a>;</td></tr>
<tr><th id="5669">5669</th><td>					<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B0, sgdig | 0x40000000); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B0); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#692" title="0x05B0" data-ref="_M/BGE_SGDIG_CFG">BGE_SGDIG_CFG</a>,</td></tr>
<tr><th id="5670">5670</th><td>					    <a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a> | <a class="macro" href="if_bgereg.h.html#835" title="0x40000000" data-ref="_M/BGE_SGDIGCFG_SEND">BGE_SGDIGCFG_SEND</a>);</td></tr>
<tr><th id="5671">5671</th><td>					<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(5)" data-ref="_M/DELAY">DELAY</a>(<var>5</var>);</td></tr>
<tr><th id="5672">5672</th><td>					<a class="macro" href="if_bgevar.h.html#103" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B0, sgdig); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x05B0); } while(0)" data-ref="_M/CSR_WRITE_4_FLUSH">CSR_WRITE_4_FLUSH</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#692" title="0x05B0" data-ref="_M/BGE_SGDIG_CFG">BGE_SGDIG_CFG</a>,</td></tr>
<tr><th id="5673">5673</th><td>					    <a class="local col1 ref" href="#401sgdig" title='sgdig' data-ref="401sgdig" data-ref-filename="401sgdig">sgdig</a>);</td></tr>
<tr><th id="5674">5674</th><td>				}</td></tr>
<tr><th id="5675">5675</th><td>			}</td></tr>
<tr><th id="5676">5676</th><td>			<b>break</b>;</td></tr>
<tr><th id="5677">5677</th><td>		<b>case</b> <a class="macro" href="../../net/if_media.h.html#226" title="11" data-ref="_M/IFM_1000_SX">IFM_1000_SX</a>:</td></tr>
<tr><th id="5678">5678</th><td>			<b>if</b> ((<a class="local col9 ref" href="#399ifm" title='ifm' data-ref="399ifm" data-ref-filename="399ifm">ifm</a>-&gt;<a class="ref field" href="../../net/if_media.h.html#ifmedia::ifm_media" title='ifmedia::ifm_media' data-ref="ifmedia::ifm_media" data-ref-filename="ifmedia..ifm_media">ifm_media</a> &amp; <a class="macro" href="../../net/if_media.h.html#193" title="0x00100000" data-ref="_M/IFM_FDX">IFM_FDX</a>) != <var>0</var>) {</td></tr>
<tr><th id="5679">5679</th><td>				<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400) &amp; ~(0x00000002)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>,</td></tr>
<tr><th id="5680">5680</th><td>				    <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a>);</td></tr>
<tr><th id="5681">5681</th><td>			} <b>else</b> {</td></tr>
<tr><th id="5682">5682</th><td>				<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400) | (0x00000002)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>,</td></tr>
<tr><th id="5683">5683</th><td>				    <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a>);</td></tr>
<tr><th id="5684">5684</th><td>			}</td></tr>
<tr><th id="5685">5685</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="5686">5686</th><td>			<b>break</b>;</td></tr>
<tr><th id="5687">5687</th><td>		<b>default</b>:</td></tr>
<tr><th id="5688">5688</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="5689">5689</th><td>		}</td></tr>
<tr><th id="5690">5690</th><td>		<i>/* XXX 802.3x flow control for 1000BASE-SX */</i></td></tr>
<tr><th id="5691">5691</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5692">5692</th><td>	}</td></tr>
<tr><th id="5693">5693</th><td></td></tr>
<tr><th id="5694">5694</th><td>	<b>if</b> ((<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#374" title="0x5784" data-ref="_M/BGE_ASICREV_BCM5784">BGE_ASICREV_BCM5784</a>) &amp;&amp;</td></tr>
<tr><th id="5695">5695</th><td>	    (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) != <a class="macro" href="if_bgereg.h.html#394" title="0x57840" data-ref="_M/BGE_CHIPREV_5784_AX">BGE_CHIPREV_5784_AX</a>)) {</td></tr>
<tr><th id="5696">5696</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="402reg" title='reg' data-type='uint32_t' data-ref="402reg" data-ref-filename="402reg">reg</dfn>;</td></tr>
<tr><th id="5697">5697</th><td></td></tr>
<tr><th id="5698">5698</th><td>		<a class="local col2 ref" href="#402reg" title='reg' data-ref="402reg" data-ref-filename="402reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3600)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1234" title="0x3600" data-ref="_M/BGE_CPMU_CTRL">BGE_CPMU_CTRL</a>);</td></tr>
<tr><th id="5699">5699</th><td>		<b>if</b> ((<a class="local col2 ref" href="#402reg" title='reg' data-ref="402reg" data-ref-filename="402reg">reg</a> &amp; <a class="macro" href="if_bgereg.h.html#1250" title="0x00010000" data-ref="_M/BGE_CPMU_CTRL_GPHY_10MB_RXONLY">BGE_CPMU_CTRL_GPHY_10MB_RXONLY</a>) != <var>0</var>) {</td></tr>
<tr><th id="5700">5700</th><td>			<a class="local col2 ref" href="#402reg" title='reg' data-ref="402reg" data-ref-filename="402reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1250" title="0x00010000" data-ref="_M/BGE_CPMU_CTRL_GPHY_10MB_RXONLY">BGE_CPMU_CTRL_GPHY_10MB_RXONLY</a>;</td></tr>
<tr><th id="5701">5701</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3600, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1234" title="0x3600" data-ref="_M/BGE_CPMU_CTRL">BGE_CPMU_CTRL</a>, <a class="local col2 ref" href="#402reg" title='reg' data-ref="402reg" data-ref-filename="402reg">reg</a>);</td></tr>
<tr><th id="5702">5702</th><td>		}</td></tr>
<tr><th id="5703">5703</th><td>	}</td></tr>
<tr><th id="5704">5704</th><td></td></tr>
<tr><th id="5705">5705</th><td>	<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000002))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgevar.h.html#319" title="0x00000002" data-ref="_M/BGE_STS_LINK_EVT">BGE_STS_LINK_EVT</a>);</td></tr>
<tr><th id="5706">5706</th><td>	<b>if</b> ((<a class="local col0 ref" href="#400rc" title='rc' data-ref="400rc" data-ref-filename="400rc">rc</a> = <a class="ref fn" href="../mii/miivar.h.html#mii_mediachg" title='mii_mediachg' data-ref="mii_mediachg" data-ref-filename="mii_mediachg">mii_mediachg</a>(<a class="local col8 ref" href="#398mii" title='mii' data-ref="398mii" data-ref-filename="398mii">mii</a>)) == <a class="macro" href="../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a>)</td></tr>
<tr><th id="5707">5707</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5708">5708</th><td></td></tr>
<tr><th id="5709">5709</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#394" title="0x57840" data-ref="_M/BGE_CHIPREV_5784_AX">BGE_CHIPREV_5784_AX</a>) {</td></tr>
<tr><th id="5710">5710</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="403reg" title='reg' data-type='uint32_t' data-ref="403reg" data-ref-filename="403reg">reg</dfn>;</td></tr>
<tr><th id="5711">5711</th><td></td></tr>
<tr><th id="5712">5712</th><td>		<a class="local col3 ref" href="#403reg" title='reg' data-ref="403reg" data-ref-filename="403reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x360C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1236" title="0x360C" data-ref="_M/BGE_CPMU_LSPD_1000MB_CLK">BGE_CPMU_LSPD_1000MB_CLK</a>);</td></tr>
<tr><th id="5713">5713</th><td>		<b>if</b> ((<a class="local col3 ref" href="#403reg" title='reg' data-ref="403reg" data-ref-filename="403reg">reg</a> &amp; <a class="macro" href="if_bgereg.h.html#1259" title="0x001F0000" data-ref="_M/BGE_CPMU_LSPD_1000MB_MACCLK_MASK">BGE_CPMU_LSPD_1000MB_MACCLK_MASK</a>)</td></tr>
<tr><th id="5714">5714</th><td>		    == (<a class="macro" href="if_bgereg.h.html#1258" title="0x00110000" data-ref="_M/BGE_CPMU_LSPD_1000MB_MACCLK_12_5">BGE_CPMU_LSPD_1000MB_MACCLK_12_5</a>)) {</td></tr>
<tr><th id="5715">5715</th><td>			<a class="local col3 ref" href="#403reg" title='reg' data-ref="403reg" data-ref-filename="403reg">reg</a> &amp;= ~<a class="macro" href="if_bgereg.h.html#1259" title="0x001F0000" data-ref="_M/BGE_CPMU_LSPD_1000MB_MACCLK_MASK">BGE_CPMU_LSPD_1000MB_MACCLK_MASK</a>;</td></tr>
<tr><th id="5716">5716</th><td>			<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(40)" data-ref="_M/delay">delay</a>(<var>40</var>);</td></tr>
<tr><th id="5717">5717</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x360C, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1236" title="0x360C" data-ref="_M/BGE_CPMU_LSPD_1000MB_CLK">BGE_CPMU_LSPD_1000MB_CLK</a>, <a class="local col3 ref" href="#403reg" title='reg' data-ref="403reg" data-ref-filename="403reg">reg</a>);</td></tr>
<tr><th id="5718">5718</th><td>		}</td></tr>
<tr><th id="5719">5719</th><td>	}</td></tr>
<tr><th id="5720">5720</th><td></td></tr>
<tr><th id="5721">5721</th><td>	<i>/*</i></td></tr>
<tr><th id="5722">5722</th><td><i>	 * Force an interrupt so that we will call bge_link_upd</i></td></tr>
<tr><th id="5723">5723</th><td><i>	 * if needed and clear any pending link state attention.</i></td></tr>
<tr><th id="5724">5724</th><td><i>	 * Without this we are not getting any further interrupts</i></td></tr>
<tr><th id="5725">5725</th><td><i>	 * for link state changes and thus will not UP the link and</i></td></tr>
<tr><th id="5726">5726</th><td><i>	 * not be able to send in bge_start. The only way to get</i></td></tr>
<tr><th id="5727">5727</th><td><i>	 * things working was to receive a packet and get a RX intr.</i></td></tr>
<tr><th id="5728">5728</th><td><i>	 */</i></td></tr>
<tr><th id="5729">5729</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a> ||</td></tr>
<tr><th id="5730">5730</th><td>	    <a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2676" title="0x00008000" data-ref="_M/BGEF_IS_5788">BGEF_IS_5788</a>)</td></tr>
<tr><th id="5731">5731</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6808) | (0x00000004)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1899" title="0x6808" data-ref="_M/BGE_MISC_LOCAL_CTL">BGE_MISC_LOCAL_CTL</a>, <a class="macro" href="if_bgereg.h.html#2053" title="0x00000004" data-ref="_M/BGE_MLC_INTR_SET">BGE_MLC_INTR_SET</a>);</td></tr>
<tr><th id="5732">5732</th><td>	<b>else</b></td></tr>
<tr><th id="5733">5733</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C00, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3C00) | (0x00000008)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col7 ref" href="#397sc" title='sc' data-ref="397sc" data-ref-filename="397sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1304" title="0x3C00" data-ref="_M/BGE_HCC_MODE">BGE_HCC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1363" title="0x00000008" data-ref="_M/BGE_HCCMODE_COAL_NOW">BGE_HCCMODE_COAL_NOW</a>);</td></tr>
<tr><th id="5734">5734</th><td></td></tr>
<tr><th id="5735">5735</th><td>	<b>return</b> <a class="local col0 ref" href="#400rc" title='rc' data-ref="400rc" data-ref-filename="400rc">rc</a>;</td></tr>
<tr><th id="5736">5736</th><td>}</td></tr>
<tr><th id="5737">5737</th><td></td></tr>
<tr><th id="5738">5738</th><td><i  data-doc="bge_ifmedia_sts">/*</i></td></tr>
<tr><th id="5739">5739</th><td><i  data-doc="bge_ifmedia_sts"> * Report current media status.</i></td></tr>
<tr><th id="5740">5740</th><td><i  data-doc="bge_ifmedia_sts"> */</i></td></tr>
<tr><th id="5741">5741</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="5742">5742</th><td><dfn class="tu decl def fn" id="bge_ifmedia_sts" title='bge_ifmedia_sts' data-type='void bge_ifmedia_sts(struct ifnet * ifp, struct ifmediareq * ifmr)' data-ref="bge_ifmedia_sts" data-ref-filename="bge_ifmedia_sts">bge_ifmedia_sts</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col4 decl" id="404ifp" title='ifp' data-type='struct ifnet *' data-ref="404ifp" data-ref-filename="404ifp">ifp</dfn>, <b>struct</b> <a class="type" href="../../net/if.h.html#ifmediareq" title='ifmediareq' data-ref="ifmediareq" data-ref-filename="ifmediareq">ifmediareq</a> *<dfn class="local col5 decl" id="405ifmr" title='ifmr' data-type='struct ifmediareq *' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</dfn>)</td></tr>
<tr><th id="5743">5743</th><td>{</td></tr>
<tr><th id="5744">5744</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col6 decl" id="406sc" title='sc' data-type='struct bge_softc *' data-ref="406sc" data-ref-filename="406sc">sc</dfn> = <a class="local col4 ref" href="#404ifp" title='ifp' data-ref="404ifp" data-ref-filename="404ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5745">5745</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col7 decl" id="407mii" title='mii' data-type='struct mii_data *' data-ref="407mii" data-ref-filename="407mii">mii</dfn> = &amp;<a class="local col6 ref" href="#406sc" title='sc' data-ref="406sc" data-ref-filename="406sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="5746">5746</th><td></td></tr>
<tr><th id="5747">5747</th><td>	<b>if</b> (<a class="local col6 ref" href="#406sc" title='sc' data-ref="406sc" data-ref-filename="406sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="5748">5748</th><td>		<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_status" title='ifmediareq::ifm_status' data-ref="ifmediareq::ifm_status" data-ref-filename="ifmediareq..ifm_status">ifm_status</a> = <a class="macro" href="../../net/if_media.h.html#89" title="0x00000001" data-ref="_M/IFM_AVALID">IFM_AVALID</a>;</td></tr>
<tr><th id="5749">5749</th><td>		<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_active" title='ifmediareq::ifm_active' data-ref="ifmediareq::ifm_active" data-ref-filename="ifmediareq..ifm_active">ifm_active</a> = <a class="macro" href="../../net/if_media.h.html#174" title="0x00000020" data-ref="_M/IFM_ETHER">IFM_ETHER</a>;</td></tr>
<tr><th id="5750">5750</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#406sc" title='sc' data-ref="406sc" data-ref-filename="406sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>) &amp;</td></tr>
<tr><th id="5751">5751</th><td>		    <a class="macro" href="if_bgereg.h.html#727" title="0x00000001" data-ref="_M/BGE_MACSTAT_TBI_PCS_SYNCHED">BGE_MACSTAT_TBI_PCS_SYNCHED</a>)</td></tr>
<tr><th id="5752">5752</th><td>			<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_status" title='ifmediareq::ifm_status' data-ref="ifmediareq::ifm_status" data-ref-filename="ifmediareq..ifm_status">ifm_status</a> |= <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a>;</td></tr>
<tr><th id="5753">5753</th><td>		<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_active" title='ifmediareq::ifm_active' data-ref="ifmediareq::ifm_active" data-ref-filename="ifmediareq..ifm_active">ifm_active</a> |= <a class="macro" href="../../net/if_media.h.html#226" title="11" data-ref="_M/IFM_1000_SX">IFM_1000_SX</a>;</td></tr>
<tr><th id="5754">5754</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col6 ref" href="#406sc" title='sc' data-ref="406sc" data-ref-filename="406sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>) &amp; <a class="macro" href="if_bgereg.h.html#698" title="0x00000002" data-ref="_M/BGE_MACMODE_HALF_DUPLEX">BGE_MACMODE_HALF_DUPLEX</a>)</td></tr>
<tr><th id="5755">5755</th><td>			<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_active" title='ifmediareq::ifm_active' data-ref="ifmediareq::ifm_active" data-ref-filename="ifmediareq..ifm_active">ifm_active</a> |= <a class="macro" href="../../net/if_media.h.html#194" title="0x00200000" data-ref="_M/IFM_HDX">IFM_HDX</a>;</td></tr>
<tr><th id="5756">5756</th><td>		<b>else</b></td></tr>
<tr><th id="5757">5757</th><td>			<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_active" title='ifmediareq::ifm_active' data-ref="ifmediareq::ifm_active" data-ref-filename="ifmediareq..ifm_active">ifm_active</a> |= <a class="macro" href="../../net/if_media.h.html#193" title="0x00100000" data-ref="_M/IFM_FDX">IFM_FDX</a>;</td></tr>
<tr><th id="5758">5758</th><td>		<b>return</b>;</td></tr>
<tr><th id="5759">5759</th><td>	}</td></tr>
<tr><th id="5760">5760</th><td></td></tr>
<tr><th id="5761">5761</th><td>	<a class="ref fn" href="../mii/miivar.h.html#mii_pollstat" title='mii_pollstat' data-ref="mii_pollstat" data-ref-filename="mii_pollstat">mii_pollstat</a>(<a class="local col7 ref" href="#407mii" title='mii' data-ref="407mii" data-ref-filename="407mii">mii</a>);</td></tr>
<tr><th id="5762">5762</th><td>	<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_status" title='ifmediareq::ifm_status' data-ref="ifmediareq::ifm_status" data-ref-filename="ifmediareq..ifm_status">ifm_status</a> = <a class="local col7 ref" href="#407mii" title='mii' data-ref="407mii" data-ref-filename="407mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a>;</td></tr>
<tr><th id="5763">5763</th><td>	<a class="local col5 ref" href="#405ifmr" title='ifmr' data-ref="405ifmr" data-ref-filename="405ifmr">ifmr</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifmediareq::ifm_active" title='ifmediareq::ifm_active' data-ref="ifmediareq::ifm_active" data-ref-filename="ifmediareq..ifm_active">ifm_active</a> = (<a class="local col7 ref" href="#407mii" title='mii' data-ref="407mii" data-ref-filename="407mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a> &amp; ~<a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>) |</td></tr>
<tr><th id="5764">5764</th><td>	    <a class="local col6 ref" href="#406sc" title='sc' data-ref="406sc" data-ref-filename="406sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a>;</td></tr>
<tr><th id="5765">5765</th><td>}</td></tr>
<tr><th id="5766">5766</th><td></td></tr>
<tr><th id="5767">5767</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="5768">5768</th><td><dfn class="tu decl def fn" id="bge_ifflags_cb" title='bge_ifflags_cb' data-type='int bge_ifflags_cb(struct ethercom * ec)' data-ref="bge_ifflags_cb" data-ref-filename="bge_ifflags_cb">bge_ifflags_cb</dfn>(<b>struct</b> <a class="type" href="../../net/if_ether.h.html#ethercom" title='ethercom' data-ref="ethercom" data-ref-filename="ethercom">ethercom</a> *<dfn class="local col8 decl" id="408ec" title='ec' data-type='struct ethercom *' data-ref="408ec" data-ref-filename="408ec">ec</dfn>)</td></tr>
<tr><th id="5769">5769</th><td>{</td></tr>
<tr><th id="5770">5770</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col9 decl" id="409ifp" title='ifp' data-type='struct ifnet *' data-ref="409ifp" data-ref-filename="409ifp">ifp</dfn> = &amp;<a class="local col8 ref" href="#408ec" title='ec' data-ref="408ec" data-ref-filename="408ec">ec</a>-&gt;<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="5771">5771</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="410sc" title='sc' data-type='struct bge_softc *' data-ref="410sc" data-ref-filename="410sc">sc</dfn> = <a class="local col9 ref" href="#409ifp" title='ifp' data-ref="409ifp" data-ref-filename="409ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5772">5772</th><td>	<em>int</em> <dfn class="local col1 decl" id="411change" title='change' data-type='int' data-ref="411change" data-ref-filename="411change">change</dfn> = <a class="local col9 ref" href="#409ifp" title='ifp' data-ref="409ifp" data-ref-filename="409ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> ^ <a class="local col0 ref" href="#410sc" title='sc' data-ref="410sc" data-ref-filename="410sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_if_flags" title='bge_softc::bge_if_flags' data-ref="bge_softc::bge_if_flags" data-ref-filename="bge_softc..bge_if_flags">bge_if_flags</a>;</td></tr>
<tr><th id="5773">5773</th><td></td></tr>
<tr><th id="5774">5774</th><td>	<b>if</b> ((<a class="local col1 ref" href="#411change" title='change' data-ref="411change" data-ref-filename="411change">change</a> &amp; ~(<a class="macro" href="../../net/if.h.html#587" title="(0x0002|0x0010|0x0040|0x0400| 0x0800|0x8000|0x0200|0x0100)" data-ref="_M/IFF_CANTCHANGE">IFF_CANTCHANGE</a> | <a class="macro" href="../../net/if.h.html#419" title="0x0004" data-ref="_M/IFF_DEBUG">IFF_DEBUG</a>)) != <var>0</var>)</td></tr>
<tr><th id="5775">5775</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#103" title="52" data-ref="_M/ENETRESET">ENETRESET</a>;</td></tr>
<tr><th id="5776">5776</th><td>	<b>else</b> <b>if</b> ((<a class="local col1 ref" href="#411change" title='change' data-ref="411change" data-ref-filename="411change">change</a> &amp; (<a class="macro" href="../../net/if.h.html#425" title="0x0100" data-ref="_M/IFF_PROMISC">IFF_PROMISC</a> | <a class="macro" href="../../net/if.h.html#426" title="0x0200" data-ref="_M/IFF_ALLMULTI">IFF_ALLMULTI</a>)) == <var>0</var>)</td></tr>
<tr><th id="5777">5777</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5778">5778</th><td></td></tr>
<tr><th id="5779">5779</th><td>	<b>if</b> ((<a class="local col9 ref" href="#409ifp" title='ifp' data-ref="409ifp" data-ref-filename="409ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#425" title="0x0100" data-ref="_M/IFF_PROMISC">IFF_PROMISC</a>) == <var>0</var>)</td></tr>
<tr><th id="5780">5780</th><td>		<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468) &amp; ~(0x00000100)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col0 ref" href="#410sc" title='sc' data-ref="410sc" data-ref-filename="410sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="macro" href="if_bgereg.h.html#804" title="0x00000100" data-ref="_M/BGE_RXMODE_RX_PROMISC">BGE_RXMODE_RX_PROMISC</a>);</td></tr>
<tr><th id="5781">5781</th><td>	<b>else</b></td></tr>
<tr><th id="5782">5782</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468) | (0x00000100)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col0 ref" href="#410sc" title='sc' data-ref="410sc" data-ref-filename="410sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="macro" href="if_bgereg.h.html#804" title="0x00000100" data-ref="_M/BGE_RXMODE_RX_PROMISC">BGE_RXMODE_RX_PROMISC</a>);</td></tr>
<tr><th id="5783">5783</th><td></td></tr>
<tr><th id="5784">5784</th><td>	<a class="tu ref fn" href="#bge_setmulti" title='bge_setmulti' data-use='c' data-ref="bge_setmulti" data-ref-filename="bge_setmulti">bge_setmulti</a>(<a class="local col0 ref" href="#410sc" title='sc' data-ref="410sc" data-ref-filename="410sc">sc</a>);</td></tr>
<tr><th id="5785">5785</th><td></td></tr>
<tr><th id="5786">5786</th><td>	<a class="local col0 ref" href="#410sc" title='sc' data-ref="410sc" data-ref-filename="410sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_if_flags" title='bge_softc::bge_if_flags' data-ref="bge_softc::bge_if_flags" data-ref-filename="bge_softc..bge_if_flags">bge_if_flags</a> = <a class="local col9 ref" href="#409ifp" title='ifp' data-ref="409ifp" data-ref-filename="409ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a>;</td></tr>
<tr><th id="5787">5787</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="5788">5788</th><td>}</td></tr>
<tr><th id="5789">5789</th><td></td></tr>
<tr><th id="5790">5790</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="5791">5791</th><td><dfn class="tu decl def fn" id="bge_ioctl" title='bge_ioctl' data-type='int bge_ioctl(struct ifnet * ifp, u_long command, void * data)' data-ref="bge_ioctl" data-ref-filename="bge_ioctl">bge_ioctl</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col2 decl" id="412ifp" title='ifp' data-type='struct ifnet *' data-ref="412ifp" data-ref-filename="412ifp">ifp</dfn>, <a class="typedef" href="../../sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a> <dfn class="local col3 decl" id="413command" title='command' data-type='u_long' data-ref="413command" data-ref-filename="413command">command</dfn>, <em>void</em> *<dfn class="local col4 decl" id="414data" title='data' data-type='void *' data-ref="414data" data-ref-filename="414data">data</dfn>)</td></tr>
<tr><th id="5792">5792</th><td>{</td></tr>
<tr><th id="5793">5793</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="415sc" title='sc' data-type='struct bge_softc *' data-ref="415sc" data-ref-filename="415sc">sc</dfn> = <a class="local col2 ref" href="#412ifp" title='ifp' data-ref="412ifp" data-ref-filename="412ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5794">5794</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifreq" title='ifreq' data-ref="ifreq" data-ref-filename="ifreq">ifreq</a> *<dfn class="local col6 decl" id="416ifr" title='ifr' data-type='struct ifreq *' data-ref="416ifr" data-ref-filename="416ifr">ifr</dfn> = (<b>struct</b> <a class="type" href="../../net/if.h.html#ifreq" title='ifreq' data-ref="ifreq" data-ref-filename="ifreq">ifreq</a> *) <a class="local col4 ref" href="#414data" title='data' data-ref="414data" data-ref-filename="414data">data</a>;</td></tr>
<tr><th id="5795">5795</th><td>	<em>int</em> <dfn class="local col7 decl" id="417s" title='s' data-type='int' data-ref="417s" data-ref-filename="417s">s</dfn>, <dfn class="local col8 decl" id="418error" title='error' data-type='int' data-ref="418error" data-ref-filename="418error">error</dfn> = <var>0</var>;</td></tr>
<tr><th id="5796">5796</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col9 decl" id="419mii" title='mii' data-type='struct mii_data *' data-ref="419mii" data-ref-filename="419mii">mii</dfn>;</td></tr>
<tr><th id="5797">5797</th><td></td></tr>
<tr><th id="5798">5798</th><td>	<a class="local col7 ref" href="#417s" title='s' data-ref="417s" data-ref-filename="417s">s</a> = <a class="macro" href="../../sys/intr.h.html#92" title="splvm()" data-ref="_M/splnet">splnet</a>();</td></tr>
<tr><th id="5799">5799</th><td></td></tr>
<tr><th id="5800">5800</th><td>	<b>switch</b> (<a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a>) {</td></tr>
<tr><th id="5801">5801</th><td>	<b>case</b> <a class="macro" href="../../sys/sockio.h.html#93" title="((((unsigned long)0x80000000|(unsigned long)0x40000000)) | (((sizeof(struct ifreq)) &amp; 0x1fff) &lt;&lt; 16) | (((&apos;i&apos;)) &lt;&lt; 8) | ((55)))" data-ref="_M/SIOCSIFMEDIA">SIOCSIFMEDIA</a>:</td></tr>
<tr><th id="5802">5802</th><td>		<i>/* XXX Flow control is not supported for 1000BASE-SX */</i></td></tr>
<tr><th id="5803">5803</th><td>		<b>if</b> (<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="5804">5804</th><td>			<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> &amp;= ~<a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>;</td></tr>
<tr><th id="5805">5805</th><td>			<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a> = <var>0</var>;</td></tr>
<tr><th id="5806">5806</th><td>		}</td></tr>
<tr><th id="5807">5807</th><td></td></tr>
<tr><th id="5808">5808</th><td>		<i>/* Flow control requires full-duplex mode. */</i></td></tr>
<tr><th id="5809">5809</th><td>		<b>if</b> (<a class="macro" href="../../net/if_media.h.html#140" title="(((ifr-&gt;ifr_ifru.ifru_metric) &amp; 0x000000e0) == 0x00000020 ? ((ifr-&gt;ifr_ifru.ifru_metric) &amp; (0x0000001f | 0x0000e000)) : ((ifr-&gt;ifr_ifru.ifru_metric) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a>) == <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a> ||</td></tr>
<tr><th id="5810">5810</th><td>		    (<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> &amp; <a class="macro" href="../../net/if_media.h.html#193" title="0x00100000" data-ref="_M/IFM_FDX">IFM_FDX</a>) == <var>0</var>) {</td></tr>
<tr><th id="5811">5811</th><td>			<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> &amp;= ~<a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>;</td></tr>
<tr><th id="5812">5812</th><td>		}</td></tr>
<tr><th id="5813">5813</th><td>		<b>if</b> (<a class="macro" href="../../net/if_media.h.html#140" title="(((ifr-&gt;ifr_ifru.ifru_metric) &amp; 0x000000e0) == 0x00000020 ? ((ifr-&gt;ifr_ifru.ifru_metric) &amp; (0x0000001f | 0x0000e000)) : ((ifr-&gt;ifr_ifru.ifru_metric) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a>) != <a class="macro" href="../../net/if_media.h.html#186" title="0" data-ref="_M/IFM_AUTO">IFM_AUTO</a>) {</td></tr>
<tr><th id="5814">5814</th><td>			<b>if</b> ((<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> &amp; <a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>) == <a class="macro" href="../../net/if_media.h.html#195" title="0x00400000" data-ref="_M/IFM_FLOW">IFM_FLOW</a>) {</td></tr>
<tr><th id="5815">5815</th><td>				<i>/* We can do both TXPAUSE and RXPAUSE. */</i></td></tr>
<tr><th id="5816">5816</th><td>				<a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> |=</td></tr>
<tr><th id="5817">5817</th><td>				    <a class="macro" href="../../net/if_media.h.html#323" title="0x00000400" data-ref="_M/IFM_ETH_TXPAUSE">IFM_ETH_TXPAUSE</a> | <a class="macro" href="../../net/if_media.h.html#322" title="0x00000200" data-ref="_M/IFM_ETH_RXPAUSE">IFM_ETH_RXPAUSE</a>;</td></tr>
<tr><th id="5818">5818</th><td>			}</td></tr>
<tr><th id="5819">5819</th><td>			<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flowflags" title='bge_softc::bge_flowflags' data-ref="bge_softc::bge_flowflags" data-ref-filename="bge_softc..bge_flowflags">bge_flowflags</a> = <a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>-&gt;<a class="macro" href="../../net/if.h.html#836" title="ifr_ifru.ifru_metric" data-ref="_M/ifr_media">ifr_media</a> &amp; <a class="macro" href="../../net/if_media.h.html#328" title="(0x00400000 | 0x00000200 | 0x00000400)" data-ref="_M/IFM_ETH_FMASK">IFM_ETH_FMASK</a>;</td></tr>
<tr><th id="5820">5820</th><td>		}</td></tr>
<tr><th id="5821">5821</th><td></td></tr>
<tr><th id="5822">5822</th><td>		<b>if</b> (<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="5823">5823</th><td>			<a class="local col8 ref" href="#418error" title='error' data-ref="418error" data-ref-filename="418error">error</a> = <a class="ref fn" href="../../net/if_media.h.html#ifmedia_ioctl" title='ifmedia_ioctl' data-ref="ifmedia_ioctl" data-ref-filename="ifmedia_ioctl">ifmedia_ioctl</a>(<a class="local col2 ref" href="#412ifp" title='ifp' data-ref="412ifp" data-ref-filename="412ifp">ifp</a>, <a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>, &amp;<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_ifmedia" title='bge_softc::bge_ifmedia' data-ref="bge_softc::bge_ifmedia" data-ref-filename="bge_softc..bge_ifmedia">bge_ifmedia</a>,</td></tr>
<tr><th id="5824">5824</th><td>			    <a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a>);</td></tr>
<tr><th id="5825">5825</th><td>		} <b>else</b> {</td></tr>
<tr><th id="5826">5826</th><td>			<a class="local col9 ref" href="#419mii" title='mii' data-ref="419mii" data-ref-filename="419mii">mii</a> = &amp;<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="5827">5827</th><td>			<a class="local col8 ref" href="#418error" title='error' data-ref="418error" data-ref-filename="418error">error</a> = <a class="ref fn" href="../../net/if_media.h.html#ifmedia_ioctl" title='ifmedia_ioctl' data-ref="ifmedia_ioctl" data-ref-filename="ifmedia_ioctl">ifmedia_ioctl</a>(<a class="local col2 ref" href="#412ifp" title='ifp' data-ref="412ifp" data-ref-filename="412ifp">ifp</a>, <a class="local col6 ref" href="#416ifr" title='ifr' data-ref="416ifr" data-ref-filename="416ifr">ifr</a>, &amp;<a class="local col9 ref" href="#419mii" title='mii' data-ref="419mii" data-ref-filename="419mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media" title='mii_data::mii_media' data-ref="mii_data::mii_media" data-ref-filename="mii_data..mii_media">mii_media</a>,</td></tr>
<tr><th id="5828">5828</th><td>			    <a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a>);</td></tr>
<tr><th id="5829">5829</th><td>		}</td></tr>
<tr><th id="5830">5830</th><td>		<b>break</b>;</td></tr>
<tr><th id="5831">5831</th><td>	<b>default</b>:</td></tr>
<tr><th id="5832">5832</th><td>		<b>if</b> ((<a class="local col8 ref" href="#418error" title='error' data-ref="418error" data-ref-filename="418error">error</a> = <a class="ref fn" href="../../net/if_ether.h.html#ether_ioctl" title='ether_ioctl' data-ref="ether_ioctl" data-ref-filename="ether_ioctl">ether_ioctl</a>(<a class="local col2 ref" href="#412ifp" title='ifp' data-ref="412ifp" data-ref-filename="412ifp">ifp</a>, <a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a>, <a class="local col4 ref" href="#414data" title='data' data-ref="414data" data-ref-filename="414data">data</a>)) != <a class="macro" href="../../sys/errno.h.html#103" title="52" data-ref="_M/ENETRESET">ENETRESET</a>)</td></tr>
<tr><th id="5833">5833</th><td>			<b>break</b>;</td></tr>
<tr><th id="5834">5834</th><td></td></tr>
<tr><th id="5835">5835</th><td>		<a class="local col8 ref" href="#418error" title='error' data-ref="418error" data-ref-filename="418error">error</a> = <var>0</var>;</td></tr>
<tr><th id="5836">5836</th><td></td></tr>
<tr><th id="5837">5837</th><td>		<b>if</b> (<a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a> != <a class="macro" href="../../sys/sockio.h.html#87" title="(((unsigned long)0x80000000) | (((sizeof(struct ifreq)) &amp; 0x1fff) &lt;&lt; 16) | (((&apos;i&apos;)) &lt;&lt; 8) | ((49)))" data-ref="_M/SIOCADDMULTI">SIOCADDMULTI</a> &amp;&amp; <a class="local col3 ref" href="#413command" title='command' data-ref="413command" data-ref-filename="413command">command</a> != <a class="macro" href="../../sys/sockio.h.html#88" title="(((unsigned long)0x80000000) | (((sizeof(struct ifreq)) &amp; 0x1fff) &lt;&lt; 16) | (((&apos;i&apos;)) &lt;&lt; 8) | ((50)))" data-ref="_M/SIOCDELMULTI">SIOCDELMULTI</a>)</td></tr>
<tr><th id="5838">5838</th><td>			;</td></tr>
<tr><th id="5839">5839</th><td>		<b>else</b> <b>if</b> (<a class="local col2 ref" href="#412ifp" title='ifp' data-ref="412ifp" data-ref-filename="412ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>)</td></tr>
<tr><th id="5840">5840</th><td>			<a class="tu ref fn" href="#bge_setmulti" title='bge_setmulti' data-use='c' data-ref="bge_setmulti" data-ref-filename="bge_setmulti">bge_setmulti</a>(<a class="local col5 ref" href="#415sc" title='sc' data-ref="415sc" data-ref-filename="415sc">sc</a>);</td></tr>
<tr><th id="5841">5841</th><td>		<b>break</b>;</td></tr>
<tr><th id="5842">5842</th><td>	}</td></tr>
<tr><th id="5843">5843</th><td></td></tr>
<tr><th id="5844">5844</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col7 ref" href="#417s" title='s' data-ref="417s" data-ref-filename="417s">s</a>);</td></tr>
<tr><th id="5845">5845</th><td></td></tr>
<tr><th id="5846">5846</th><td>	<b>return</b> <a class="local col8 ref" href="#418error" title='error' data-ref="418error" data-ref-filename="418error">error</a>;</td></tr>
<tr><th id="5847">5847</th><td>}</td></tr>
<tr><th id="5848">5848</th><td></td></tr>
<tr><th id="5849">5849</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="5850">5850</th><td><dfn class="tu decl def fn" id="bge_watchdog" title='bge_watchdog' data-type='void bge_watchdog(struct ifnet * ifp)' data-ref="bge_watchdog" data-ref-filename="bge_watchdog">bge_watchdog</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col0 decl" id="420ifp" title='ifp' data-type='struct ifnet *' data-ref="420ifp" data-ref-filename="420ifp">ifp</dfn>)</td></tr>
<tr><th id="5851">5851</th><td>{</td></tr>
<tr><th id="5852">5852</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col1 decl" id="421sc" title='sc' data-type='struct bge_softc *' data-ref="421sc" data-ref-filename="421sc">sc</dfn>;</td></tr>
<tr><th id="5853">5853</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="422status" title='status' data-type='uint32_t' data-ref="422status" data-ref-filename="422status">status</dfn>;</td></tr>
<tr><th id="5854">5854</th><td></td></tr>
<tr><th id="5855">5855</th><td>	<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a> = <a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5856">5856</th><td></td></tr>
<tr><th id="5857">5857</th><td>	<i>/* If pause frames are active then don't reset the hardware. */</i></td></tr>
<tr><th id="5858">5858</th><td>	<b>if</b> ((<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0468)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>) &amp; <a class="macro" href="if_bgereg.h.html#800" title="0x00000004" data-ref="_M/BGE_RXMODE_FLOWCTL_ENABLE">BGE_RXMODE_FLOWCTL_ENABLE</a>) != <var>0</var>) {</td></tr>
<tr><th id="5859">5859</th><td>		<a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x046C)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a>, <a class="macro" href="if_bgereg.h.html#652" title="0x046C" data-ref="_M/BGE_RX_STS">BGE_RX_STS</a>);</td></tr>
<tr><th id="5860">5860</th><td>		<b>if</b> ((<a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a> &amp; <a class="macro" href="if_bgereg.h.html#811" title="0x00000001" data-ref="_M/BGE_RXSTAT_REMOTE_XOFFED">BGE_RXSTAT_REMOTE_XOFFED</a>) != <var>0</var>) {</td></tr>
<tr><th id="5861">5861</th><td>			<i>/*</i></td></tr>
<tr><th id="5862">5862</th><td><i>			 * If link partner has us in XOFF state then wait for</i></td></tr>
<tr><th id="5863">5863</th><td><i>			 * the condition to clear.</i></td></tr>
<tr><th id="5864">5864</th><td><i>			 */</i></td></tr>
<tr><th id="5865">5865</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x046C, status)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a>, <a class="macro" href="if_bgereg.h.html#652" title="0x046C" data-ref="_M/BGE_RX_STS">BGE_RX_STS</a>, <a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a>);</td></tr>
<tr><th id="5866">5866</th><td>			<a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_timer" title='ifnet::if_timer' data-ref="ifnet::if_timer" data-ref-filename="ifnet..if_timer">if_timer</a> = <var>5</var>;</td></tr>
<tr><th id="5867">5867</th><td>			<b>return</b>;</td></tr>
<tr><th id="5868">5868</th><td>		} <b>else</b> <b>if</b> ((<a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a> &amp; <a class="macro" href="if_bgereg.h.html#812" title="0x00000002" data-ref="_M/BGE_RXSTAT_RCVD_XOFF">BGE_RXSTAT_RCVD_XOFF</a>) != <var>0</var> &amp;&amp;</td></tr>
<tr><th id="5869">5869</th><td>		    (<a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a> &amp; <a class="macro" href="if_bgereg.h.html#813" title="0x00000004" data-ref="_M/BGE_RXSTAT_RCVD_XON">BGE_RXSTAT_RCVD_XON</a>) != <var>0</var>) {</td></tr>
<tr><th id="5870">5870</th><td>			<i>/*</i></td></tr>
<tr><th id="5871">5871</th><td><i>			 * If link partner has us in XOFF state then wait for</i></td></tr>
<tr><th id="5872">5872</th><td><i>			 * the condition to clear.</i></td></tr>
<tr><th id="5873">5873</th><td><i>			 */</i></td></tr>
<tr><th id="5874">5874</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x046C, status)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a>, <a class="macro" href="if_bgereg.h.html#652" title="0x046C" data-ref="_M/BGE_RX_STS">BGE_RX_STS</a>, <a class="local col2 ref" href="#422status" title='status' data-ref="422status" data-ref-filename="422status">status</a>);</td></tr>
<tr><th id="5875">5875</th><td>			<a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_timer" title='ifnet::if_timer' data-ref="ifnet::if_timer" data-ref-filename="ifnet..if_timer">if_timer</a> = <var>5</var>;</td></tr>
<tr><th id="5876">5876</th><td>			<b>return</b>;</td></tr>
<tr><th id="5877">5877</th><td>		}</td></tr>
<tr><th id="5878">5878</th><td>		<i>/*</i></td></tr>
<tr><th id="5879">5879</th><td><i>		 * Any other condition is unexpected and the controller</i></td></tr>
<tr><th id="5880">5880</th><td><i>		 * should be reset.</i></td></tr>
<tr><th id="5881">5881</th><td><i>		 */</i></td></tr>
<tr><th id="5882">5882</th><td>	}</td></tr>
<tr><th id="5883">5883</th><td></td></tr>
<tr><th id="5884">5884</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col1 ref" href="#421sc" title='sc' data-ref="421sc" data-ref-filename="421sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <q>"watchdog timeout -- resetting\n"</q>);</td></tr>
<tr><th id="5885">5885</th><td></td></tr>
<tr><th id="5886">5886</th><td>	<a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp;= ~<a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a>;</td></tr>
<tr><th id="5887">5887</th><td>	<a class="tu ref fn" href="#bge_init" title='bge_init' data-use='c' data-ref="bge_init" data-ref-filename="bge_init">bge_init</a>(<a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>);</td></tr>
<tr><th id="5888">5888</th><td></td></tr>
<tr><th id="5889">5889</th><td>	<a class="local col0 ref" href="#420ifp" title='ifp' data-ref="420ifp" data-ref-filename="420ifp">ifp</a>-&gt;<a class="macro" href="../../net/if.h.html#406" title="if_data.ifi_oerrors" data-ref="_M/if_oerrors">if_oerrors</a>++;</td></tr>
<tr><th id="5890">5890</th><td>}</td></tr>
<tr><th id="5891">5891</th><td></td></tr>
<tr><th id="5892">5892</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="5893">5893</th><td><dfn class="tu decl def fn" id="bge_stop_block" title='bge_stop_block' data-type='void bge_stop_block(struct bge_softc * sc, bus_addr_t reg, uint32_t bit)' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="423sc" title='sc' data-type='struct bge_softc *' data-ref="423sc" data-ref-filename="423sc">sc</dfn>, <a class="typedef" href="../../arch/x86/include/bus_defs.h.html#bus_addr_t" title='bus_addr_t' data-type='paddr_t' data-ref="bus_addr_t" data-ref-filename="bus_addr_t">bus_addr_t</a> <dfn class="local col4 decl" id="424reg" title='reg' data-type='bus_addr_t' data-ref="424reg" data-ref-filename="424reg">reg</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="425bit" title='bit' data-type='uint32_t' data-ref="425bit" data-ref-filename="425bit">bit</dfn>)</td></tr>
<tr><th id="5894">5894</th><td>{</td></tr>
<tr><th id="5895">5895</th><td>	<em>int</em> <dfn class="local col6 decl" id="426i" title='i' data-type='int' data-ref="426i" data-ref-filename="426i">i</dfn>;</td></tr>
<tr><th id="5896">5896</th><td></td></tr>
<tr><th id="5897">5897</th><td>	<a class="macro" href="if_bgevar.h.html#118" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, reg, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, reg) &amp; ~(bit))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, reg); } while(0)" data-ref="_M/BGE_CLRBIT_FLUSH">BGE_CLRBIT_FLUSH</a>(<a class="local col3 ref" href="#423sc" title='sc' data-ref="423sc" data-ref-filename="423sc">sc</a>, <a class="local col4 ref" href="#424reg" title='reg' data-ref="424reg" data-ref-filename="424reg">reg</a>, <a class="local col5 ref" href="#425bit" title='bit' data-ref="425bit" data-ref-filename="425bit">bit</a>);</td></tr>
<tr><th id="5898">5898</th><td></td></tr>
<tr><th id="5899">5899</th><td>	<b>for</b> (<a class="local col6 ref" href="#426i" title='i' data-ref="426i" data-ref-filename="426i">i</a> = <var>0</var>; <a class="local col6 ref" href="#426i" title='i' data-ref="426i" data-ref-filename="426i">i</a> &lt; <var>1000</var>; <a class="local col6 ref" href="#426i" title='i' data-ref="426i" data-ref-filename="426i">i</a>++) {</td></tr>
<tr><th id="5900">5900</th><td>		<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(100)" data-ref="_M/delay">delay</a>(<var>100</var>);</td></tr>
<tr><th id="5901">5901</th><td>		<b>if</b> ((<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, reg)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col3 ref" href="#423sc" title='sc' data-ref="423sc" data-ref-filename="423sc">sc</a>, <a class="local col4 ref" href="#424reg" title='reg' data-ref="424reg" data-ref-filename="424reg">reg</a>) &amp; <a class="local col5 ref" href="#425bit" title='bit' data-ref="425bit" data-ref-filename="425bit">bit</a>) == <var>0</var>)</td></tr>
<tr><th id="5902">5902</th><td>			<b>return</b>;</td></tr>
<tr><th id="5903">5903</th><td>	}</td></tr>
<tr><th id="5904">5904</th><td></td></tr>
<tr><th id="5905">5905</th><td>	<i>/*</i></td></tr>
<tr><th id="5906">5906</th><td><i>	 * Doesn't print only when the register is BGE_SRS_MODE. It occurs</i></td></tr>
<tr><th id="5907">5907</th><td><i>	 * on some environment (and once after boot?)</i></td></tr>
<tr><th id="5908">5908</th><td><i>	 */</i></td></tr>
<tr><th id="5909">5909</th><td>	<b>if</b> (<a class="local col4 ref" href="#424reg" title='reg' data-ref="424reg" data-ref-filename="424reg">reg</a> != <a class="macro" href="if_bgereg.h.html#937" title="0x1400" data-ref="_M/BGE_SRS_MODE">BGE_SRS_MODE</a>)</td></tr>
<tr><th id="5910">5910</th><td>		<a class="ref fn" href="../../sys/systm.h.html#aprint_error_dev" title='aprint_error_dev' data-ref="aprint_error_dev" data-ref-filename="aprint_error_dev">aprint_error_dev</a>(<a class="local col3 ref" href="#423sc" title='sc' data-ref="423sc" data-ref-filename="423sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>,</td></tr>
<tr><th id="5911">5911</th><td>		    <q>"block failed to stop: reg 0x%lx, bit 0x%08x\n"</q>,</td></tr>
<tr><th id="5912">5912</th><td>		    (<a class="typedef" href="../../sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a>)<a class="local col4 ref" href="#424reg" title='reg' data-ref="424reg" data-ref-filename="424reg">reg</a>, <a class="local col5 ref" href="#425bit" title='bit' data-ref="425bit" data-ref-filename="425bit">bit</a>);</td></tr>
<tr><th id="5913">5913</th><td>}</td></tr>
<tr><th id="5914">5914</th><td></td></tr>
<tr><th id="5915">5915</th><td><i  data-doc="bge_stop">/*</i></td></tr>
<tr><th id="5916">5916</th><td><i  data-doc="bge_stop"> * Stop the adapter and free any mbufs allocated to the</i></td></tr>
<tr><th id="5917">5917</th><td><i  data-doc="bge_stop"> * RX and TX lists.</i></td></tr>
<tr><th id="5918">5918</th><td><i  data-doc="bge_stop"> */</i></td></tr>
<tr><th id="5919">5919</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="5920">5920</th><td><dfn class="tu decl def fn" id="bge_stop" title='bge_stop' data-type='void bge_stop(struct ifnet * ifp, int disable)' data-ref="bge_stop" data-ref-filename="bge_stop">bge_stop</dfn>(<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col7 decl" id="427ifp" title='ifp' data-type='struct ifnet *' data-ref="427ifp" data-ref-filename="427ifp">ifp</dfn>, <em>int</em> <dfn class="local col8 decl" id="428disable" title='disable' data-type='int' data-ref="428disable" data-ref-filename="428disable">disable</dfn>)</td></tr>
<tr><th id="5921">5921</th><td>{</td></tr>
<tr><th id="5922">5922</th><td>	<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col9 decl" id="429sc" title='sc' data-type='struct bge_softc *' data-ref="429sc" data-ref-filename="429sc">sc</dfn> = <a class="local col7 ref" href="#427ifp" title='ifp' data-ref="427ifp" data-ref-filename="427ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_softc" title='ifnet::if_softc' data-ref="ifnet::if_softc" data-ref-filename="ifnet..if_softc">if_softc</a>;</td></tr>
<tr><th id="5923">5923</th><td></td></tr>
<tr><th id="5924">5924</th><td>	<b>if</b> (<a class="local col8 ref" href="#428disable" title='disable' data-ref="428disable" data-ref-filename="428disable">disable</a>) {</td></tr>
<tr><th id="5925">5925</th><td>		<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_detaching" title='bge_softc::bge_detaching' data-ref="bge_softc::bge_detaching" data-ref-filename="bge_softc..bge_detaching">bge_detaching</a> = <var>1</var>;</td></tr>
<tr><th id="5926">5926</th><td>		<a class="ref fn" href="../../sys/callout.h.html#callout_halt" title='callout_halt' data-ref="callout_halt" data-ref-filename="callout_halt">callout_halt</a>(&amp;<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_timeout" title='bge_softc::bge_timeout' data-ref="bge_softc::bge_timeout" data-ref-filename="bge_softc..bge_timeout">bge_timeout</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="5927">5927</th><td>	} <b>else</b></td></tr>
<tr><th id="5928">5928</th><td>		<a class="ref fn" href="../../sys/callout.h.html#callout_stop" title='callout_stop' data-ref="callout_stop" data-ref-filename="callout_stop">callout_stop</a>(&amp;<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_timeout" title='bge_softc::bge_timeout' data-ref="bge_softc::bge_timeout" data-ref-filename="bge_softc..bge_timeout">bge_timeout</a>);</td></tr>
<tr><th id="5929">5929</th><td></td></tr>
<tr><th id="5930">5930</th><td>	<i>/* Disable host interrupts. */</i></td></tr>
<tr><th id="5931">5931</th><td>	<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x68) | (0x00000002)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#229" title="0x68" data-ref="_M/BGE_PCI_MISC_CTL">BGE_PCI_MISC_CTL</a>, <a class="macro" href="if_bgereg.h.html#256" title="0x00000002" data-ref="_M/BGE_PCIMISCCTL_MASK_PCI_INTR">BGE_PCIMISCCTL_MASK_PCI_INTR</a>);</td></tr>
<tr><th id="5932">5932</th><td>	<a class="tu ref fn" href="#bge_writembx_flush" title='bge_writembx_flush' data-use='c' data-ref="bge_writembx_flush" data-ref-filename="bge_writembx_flush">bge_writembx_flush</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#490" title="0x0204" data-ref="_M/BGE_MBX_IRQ0_LO">BGE_MBX_IRQ0_LO</a>, <var>1</var>);</td></tr>
<tr><th id="5933">5933</th><td></td></tr>
<tr><th id="5934">5934</th><td>	<i>/*</i></td></tr>
<tr><th id="5935">5935</th><td><i>	 * Tell firmware we're shutting down.</i></td></tr>
<tr><th id="5936">5936</th><td><i>	 */</i></td></tr>
<tr><th id="5937">5937</th><td>	<a class="tu ref fn" href="#bge_stop_fw" title='bge_stop_fw' data-use='c' data-ref="bge_stop_fw" data-ref-filename="bge_stop_fw">bge_stop_fw</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>);</td></tr>
<tr><th id="5938">5938</th><td>	<a class="tu ref fn" href="#bge_sig_pre_reset" title='bge_sig_pre_reset' data-use='c' data-ref="bge_sig_pre_reset" data-ref-filename="bge_sig_pre_reset">bge_sig_pre_reset</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>);</td></tr>
<tr><th id="5939">5939</th><td></td></tr>
<tr><th id="5940">5940</th><td>	<i>/*</i></td></tr>
<tr><th id="5941">5941</th><td><i>	 * Disable all of the receiver blocks.</i></td></tr>
<tr><th id="5942">5942</th><td><i>	 */</i></td></tr>
<tr><th id="5943">5943</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#651" title="0x0468" data-ref="_M/BGE_RX_MODE">BGE_RX_MODE</a>, <a class="macro" href="if_bgereg.h.html#799" title="0x00000002" data-ref="_M/BGE_RXMODE_ENABLE">BGE_RXMODE_ENABLE</a>);</td></tr>
<tr><th id="5944">5944</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1180" title="0x2C00" data-ref="_M/BGE_RBDI_MODE">BGE_RBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#1194" title="0x00000002" data-ref="_M/BGE_RBDIMODE_ENABLE">BGE_RBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="5945">5945</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1018" title="0x2000" data-ref="_M/BGE_RXLP_MODE">BGE_RXLP_MODE</a>, <a class="macro" href="if_bgereg.h.html#1101" title="0x00000002" data-ref="_M/BGE_RXLPMODE_ENABLE">BGE_RXLPMODE_ENABLE</a>);</td></tr>
<tr><th id="5946">5946</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>))</td></tr>
<tr><th id="5947">5947</th><td>		<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1220" title="0x3400" data-ref="_M/BGE_RXLS_MODE">BGE_RXLS_MODE</a>, <a class="macro" href="if_bgereg.h.html#1225" title="0x00000002" data-ref="_M/BGE_RXLSMODE_ENABLE">BGE_RXLSMODE_ENABLE</a>);</td></tr>
<tr><th id="5948">5948</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1118" title="0x2400" data-ref="_M/BGE_RDBDI_MODE">BGE_RDBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#1194" title="0x00000002" data-ref="_M/BGE_RBDIMODE_ENABLE">BGE_RBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="5949">5949</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1170" title="0x2800" data-ref="_M/BGE_RDC_MODE">BGE_RDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1174" title="0x00000002" data-ref="_M/BGE_RDCMODE_ENABLE">BGE_RDCMODE_ENABLE</a>);</td></tr>
<tr><th id="5950">5950</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1203" title="0x3000" data-ref="_M/BGE_RBDC_MODE">BGE_RBDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1211" title="0x00000002" data-ref="_M/BGE_RBDCMODE_ENABLE">BGE_RBDCMODE_ENABLE</a>);</td></tr>
<tr><th id="5951">5951</th><td></td></tr>
<tr><th id="5952">5952</th><td>	<i>/*</i></td></tr>
<tr><th id="5953">5953</th><td><i>	 * Disable all of the transmit blocks.</i></td></tr>
<tr><th id="5954">5954</th><td><i>	 */</i></td></tr>
<tr><th id="5955">5955</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#937" title="0x1400" data-ref="_M/BGE_SRS_MODE">BGE_SRS_MODE</a>, <a class="macro" href="if_bgereg.h.html#959" title="0x00000002" data-ref="_M/BGE_SRSMODE_ENABLE">BGE_SRSMODE_ENABLE</a>);</td></tr>
<tr><th id="5956">5956</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#974" title="0x1800" data-ref="_M/BGE_SBDI_MODE">BGE_SBDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#995" title="0x00000002" data-ref="_M/BGE_SBDIMODE_ENABLE">BGE_SBDIMODE_ENABLE</a>);</td></tr>
<tr><th id="5957">5957</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#872" title="0x0C00" data-ref="_M/BGE_SDI_MODE">BGE_SDI_MODE</a>, <a class="macro" href="if_bgereg.h.html#905" title="0x00000002" data-ref="_M/BGE_SDIMODE_ENABLE">BGE_SDIMODE_ENABLE</a>);</td></tr>
<tr><th id="5958">5958</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1502" title="0x4800" data-ref="_M/BGE_RDMA_MODE">BGE_RDMA_MODE</a>, <a class="macro" href="if_bgereg.h.html#1511" title="0x00000002" data-ref="_M/BGE_RDMAMODE_ENABLE">BGE_RDMAMODE_ENABLE</a>);</td></tr>
<tr><th id="5959">5959</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#922" title="0x1000" data-ref="_M/BGE_SDC_MODE">BGE_SDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#927" title="0x00000002" data-ref="_M/BGE_SDCMODE_ENABLE">BGE_SDCMODE_ENABLE</a>);</td></tr>
<tr><th id="5960">5960</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>))</td></tr>
<tr><th id="5961">5961</th><td>		<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1887" title="0x6400" data-ref="_M/BGE_DMAC_MODE">BGE_DMAC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1891" title="0x00000002" data-ref="_M/BGE_DMACMODE_ENABLE">BGE_DMACMODE_ENABLE</a>);</td></tr>
<tr><th id="5962">5962</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1004" title="0x1C00" data-ref="_M/BGE_SBDC_MODE">BGE_SBDC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1009" title="0x00000002" data-ref="_M/BGE_SBDCMODE_ENABLE">BGE_SBDCMODE_ENABLE</a>);</td></tr>
<tr><th id="5963">5963</th><td></td></tr>
<tr><th id="5964">5964</th><td>	<a class="macro" href="if_bgevar.h.html#118" title="do { bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400) &amp; ~(0x00200000))); bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400); } while(0)" data-ref="_M/BGE_CLRBIT_FLUSH">BGE_CLRBIT_FLUSH</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>, <a class="macro" href="if_bgereg.h.html#715" title="0x00200000" data-ref="_M/BGE_MACMODE_TXDMA_ENB">BGE_MACMODE_TXDMA_ENB</a>);</td></tr>
<tr><th id="5965">5965</th><td>	<a class="macro" href="../../arch/x86/include/cpu.h.html#429" title="(*delay_func)(40)" data-ref="_M/delay">delay</a>(<var>40</var>);</td></tr>
<tr><th id="5966">5966</th><td></td></tr>
<tr><th id="5967">5967</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#648" title="0x045C" data-ref="_M/BGE_TX_MODE">BGE_TX_MODE</a>, <a class="macro" href="if_bgereg.h.html#774" title="0x00000002" data-ref="_M/BGE_TXMODE_ENABLE">BGE_TXMODE_ENABLE</a>);</td></tr>
<tr><th id="5968">5968</th><td></td></tr>
<tr><th id="5969">5969</th><td>	<i>/*</i></td></tr>
<tr><th id="5970">5970</th><td><i>	 * Shut down all of the memory managers and related</i></td></tr>
<tr><th id="5971">5971</th><td><i>	 * state machines.</i></td></tr>
<tr><th id="5972">5972</th><td><i>	 */</i></td></tr>
<tr><th id="5973">5973</th><td>	<i>/* 5718 step 5a,5b */</i></td></tr>
<tr><th id="5974">5974</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1304" title="0x3C00" data-ref="_M/BGE_HCC_MODE">BGE_HCC_MODE</a>, <a class="macro" href="if_bgereg.h.html#1361" title="0x00000002" data-ref="_M/BGE_HCCMODE_ENABLE">BGE_HCCMODE_ENABLE</a>);</td></tr>
<tr><th id="5975">5975</th><td>	<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1580" title="0x4C00" data-ref="_M/BGE_WDMA_MODE">BGE_WDMA_MODE</a>, <a class="macro" href="if_bgereg.h.html#1585" title="0x00000002" data-ref="_M/BGE_WDMAMODE_ENABLE">BGE_WDMAMODE_ENABLE</a>);</td></tr>
<tr><th id="5976">5976</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>))</td></tr>
<tr><th id="5977">5977</th><td>		<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1290" title="0x3800" data-ref="_M/BGE_MBCF_MODE">BGE_MBCF_MODE</a>, <a class="macro" href="if_bgereg.h.html#1295" title="0x00000002" data-ref="_M/BGE_MBCFMODE_ENABLE">BGE_MBCFMODE_ENABLE</a>);</td></tr>
<tr><th id="5978">5978</th><td></td></tr>
<tr><th id="5979">5979</th><td>	<i>/* 5718 step 5c,5d */</i></td></tr>
<tr><th id="5980">5980</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5C00, 0xFFFFFFFF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1840" title="0x5C00" data-ref="_M/BGE_FTQ_RESET">BGE_FTQ_RESET</a>, <var>0xFFFFFFFF</var>);</td></tr>
<tr><th id="5981">5981</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x5C00, 0)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1840" title="0x5C00" data-ref="_M/BGE_FTQ_RESET">BGE_FTQ_RESET</a>, <var>0</var>);</td></tr>
<tr><th id="5982">5982</th><td></td></tr>
<tr><th id="5983">5983</th><td>	<b>if</b> (<a class="macro" href="#410" title="((sc)-&gt;bge_flags &amp; 0x00000800)" data-ref="_M/BGE_IS_5700_FAMILY">BGE_IS_5700_FAMILY</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>)) {</td></tr>
<tr><th id="5984">5984</th><td>		<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1464" title="0x4400" data-ref="_M/BGE_BMAN_MODE">BGE_BMAN_MODE</a>, <a class="macro" href="if_bgereg.h.html#1489" title="0x00000002" data-ref="_M/BGE_BMANMODE_ENABLE">BGE_BMANMODE_ENABLE</a>);</td></tr>
<tr><th id="5985">5985</th><td>		<a class="tu ref fn" href="#bge_stop_block" title='bge_stop_block' data-use='c' data-ref="bge_stop_block" data-ref-filename="bge_stop_block">bge_stop_block</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1402" title="0x4000" data-ref="_M/BGE_MARB_MODE">BGE_MARB_MODE</a>, <a class="macro" href="if_bgereg.h.html#1409" title="0x00000002" data-ref="_M/BGE_MARBMODE_ENABLE">BGE_MARBMODE_ENABLE</a>);</td></tr>
<tr><th id="5986">5986</th><td>	}</td></tr>
<tr><th id="5987">5987</th><td></td></tr>
<tr><th id="5988">5988</th><td>	<a class="tu ref fn" href="#bge_reset" title='bge_reset' data-use='c' data-ref="bge_reset" data-ref-filename="bge_reset">bge_reset</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>);</td></tr>
<tr><th id="5989">5989</th><td>	<a class="tu ref fn" href="#bge_sig_legacy" title='bge_sig_legacy' data-use='c' data-ref="bge_sig_legacy" data-ref-filename="bge_sig_legacy">bge_sig_legacy</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>);</td></tr>
<tr><th id="5990">5990</th><td>	<a class="tu ref fn" href="#bge_sig_post_reset" title='bge_sig_post_reset' data-use='c' data-ref="bge_sig_post_reset" data-ref-filename="bge_sig_post_reset">bge_sig_post_reset</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="#254" title="0" data-ref="_M/BGE_RESET_SHUTDOWN">BGE_RESET_SHUTDOWN</a>);</td></tr>
<tr><th id="5991">5991</th><td></td></tr>
<tr><th id="5992">5992</th><td>	<i>/*</i></td></tr>
<tr><th id="5993">5993</th><td><i>	 * Keep the ASF firmware running if up.</i></td></tr>
<tr><th id="5994">5994</th><td><i>	 */</i></td></tr>
<tr><th id="5995">5995</th><td>	<b>if</b> (<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_asf_mode" title='bge_softc::bge_asf_mode' data-ref="bge_softc::bge_asf_mode" data-ref-filename="bge_softc..bge_asf_mode">bge_asf_mode</a> &amp; <a class="macro" href="if_bgevar.h.html#259" title="4" data-ref="_M/ASF_STACKUP">ASF_STACKUP</a>)</td></tr>
<tr><th id="5996">5996</th><td>		<a class="macro" href="if_bgevar.h.html#109" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800) | (0x00010000)))" data-ref="_M/BGE_SETBIT">BGE_SETBIT</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>);</td></tr>
<tr><th id="5997">5997</th><td>	<b>else</b></td></tr>
<tr><th id="5998">5998</th><td>		<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6800) &amp; ~(0x00010000)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1897" title="0x6800" data-ref="_M/BGE_MODE_CTL">BGE_MODE_CTL</a>, <a class="macro" href="if_bgereg.h.html#2019" title="0x00010000" data-ref="_M/BGE_MODECTL_STACKUP">BGE_MODECTL_STACKUP</a>);</td></tr>
<tr><th id="5999">5999</th><td></td></tr>
<tr><th id="6000">6000</th><td>	<i>/* Free the RX lists. */</i></td></tr>
<tr><th id="6001">6001</th><td>	<a class="tu ref fn" href="#bge_free_rx_ring_std" title='bge_free_rx_ring_std' data-use='c' data-ref="bge_free_rx_ring_std" data-ref-filename="bge_free_rx_ring_std">bge_free_rx_ring_std</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="local col8 ref" href="#428disable" title='disable' data-ref="428disable" data-ref-filename="428disable">disable</a>);</td></tr>
<tr><th id="6002">6002</th><td></td></tr>
<tr><th id="6003">6003</th><td>	<i>/* Free jumbo RX list. */</i></td></tr>
<tr><th id="6004">6004</th><td>	<b>if</b> (<a class="macro" href="#409" title="((sc)-&gt;bge_flags &amp; 0x00000002)" data-ref="_M/BGE_IS_JUMBO_CAPABLE">BGE_IS_JUMBO_CAPABLE</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>))</td></tr>
<tr><th id="6005">6005</th><td>		<a class="tu ref fn" href="#bge_free_rx_ring_jumbo" title='bge_free_rx_ring_jumbo' data-use='c' data-ref="bge_free_rx_ring_jumbo" data-ref-filename="bge_free_rx_ring_jumbo">bge_free_rx_ring_jumbo</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>);</td></tr>
<tr><th id="6006">6006</th><td></td></tr>
<tr><th id="6007">6007</th><td>	<i>/* Free TX buffers. */</i></td></tr>
<tr><th id="6008">6008</th><td>	<a class="tu ref fn" href="#bge_free_tx_ring" title='bge_free_tx_ring' data-use='c' data-ref="bge_free_tx_ring" data-ref-filename="bge_free_tx_ring">bge_free_tx_ring</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="local col8 ref" href="#428disable" title='disable' data-ref="428disable" data-ref-filename="428disable">disable</a>);</td></tr>
<tr><th id="6009">6009</th><td></td></tr>
<tr><th id="6010">6010</th><td>	<i>/*</i></td></tr>
<tr><th id="6011">6011</th><td><i>	 * Isolate/power down the PHY.</i></td></tr>
<tr><th id="6012">6012</th><td><i>	 */</i></td></tr>
<tr><th id="6013">6013</th><td>	<b>if</b> (!(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>))</td></tr>
<tr><th id="6014">6014</th><td>		<a class="ref fn" href="../mii/miivar.h.html#mii_down" title='mii_down' data-ref="mii_down" data-ref-filename="mii_down">mii_down</a>(&amp;<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>);</td></tr>
<tr><th id="6015">6015</th><td></td></tr>
<tr><th id="6016">6016</th><td>	<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_tx_saved_considx" title='bge_softc::bge_tx_saved_considx' data-ref="bge_softc::bge_tx_saved_considx" data-ref-filename="bge_softc..bge_tx_saved_considx">bge_tx_saved_considx</a> = <a class="macro" href="if_bgevar.h.html#238" title="0xFFFF" data-ref="_M/BGE_TXCONS_UNSET">BGE_TXCONS_UNSET</a>;</td></tr>
<tr><th id="6017">6017</th><td></td></tr>
<tr><th id="6018">6018</th><td>	<i>/* Clear MAC's link state (PHY may still have link UP). */</i></td></tr>
<tr><th id="6019">6019</th><td>	<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000001))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col9 ref" href="#429sc" title='sc' data-ref="429sc" data-ref-filename="429sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6020">6020</th><td></td></tr>
<tr><th id="6021">6021</th><td>	<a class="local col7 ref" href="#427ifp" title='ifp' data-ref="427ifp" data-ref-filename="427ifp">ifp</a>-&gt;<a class="ref field" href="../../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp;= ~(<a class="macro" href="../../net/if.h.html#423" title="0x0040" data-ref="_M/IFF_RUNNING">IFF_RUNNING</a> | <a class="macro" href="../../net/if.h.html#427" title="0x0400" data-ref="_M/IFF_OACTIVE">IFF_OACTIVE</a>);</td></tr>
<tr><th id="6022">6022</th><td>}</td></tr>
<tr><th id="6023">6023</th><td></td></tr>
<tr><th id="6024">6024</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="6025">6025</th><td><dfn class="tu decl def fn" id="bge_link_upd" title='bge_link_upd' data-type='void bge_link_upd(struct bge_softc * sc)' data-ref="bge_link_upd" data-ref-filename="bge_link_upd">bge_link_upd</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="430sc" title='sc' data-type='struct bge_softc *' data-ref="430sc" data-ref-filename="430sc">sc</dfn>)</td></tr>
<tr><th id="6026">6026</th><td>{</td></tr>
<tr><th id="6027">6027</th><td>	<b>struct</b> <a class="type" href="../../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col1 decl" id="431ifp" title='ifp' data-type='struct ifnet *' data-ref="431ifp" data-ref-filename="431ifp">ifp</dfn> = &amp;<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::ethercom" title='bge_softc::ethercom' data-ref="bge_softc::ethercom" data-ref-filename="bge_softc..ethercom">ethercom</a>.<a class="ref field" href="../../net/if_ether.h.html#ethercom::ec_if" title='ethercom::ec_if' data-ref="ethercom::ec_if" data-ref-filename="ethercom..ec_if">ec_if</a>;</td></tr>
<tr><th id="6028">6028</th><td>	<b>struct</b> <a class="type" href="../mii/miivar.h.html#mii_data" title='mii_data' data-ref="mii_data" data-ref-filename="mii_data">mii_data</a> *<dfn class="local col2 decl" id="432mii" title='mii' data-type='struct mii_data *' data-ref="432mii" data-ref-filename="432mii">mii</dfn> = &amp;<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_mii" title='bge_softc::bge_mii' data-ref="bge_softc::bge_mii" data-ref-filename="bge_softc..bge_mii">bge_mii</a>;</td></tr>
<tr><th id="6029">6029</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="433status" title='status' data-type='uint32_t' data-ref="433status" data-ref-filename="433status">status</dfn>;</td></tr>
<tr><th id="6030">6030</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint16_t" title='uint16_t' data-type='__uint16_t' data-ref="uint16_t" data-ref-filename="uint16_t">uint16_t</a> <dfn class="local col4 decl" id="434phyval" title='phyval' data-type='uint16_t' data-ref="434phyval" data-ref-filename="434phyval">phyval</dfn>;</td></tr>
<tr><th id="6031">6031</th><td>	<em>int</em> <dfn class="local col5 decl" id="435link" title='link' data-type='int' data-ref="435link" data-ref-filename="435link">link</dfn>;</td></tr>
<tr><th id="6032">6032</th><td></td></tr>
<tr><th id="6033">6033</th><td>	<i>/* Clear 'pending link event' flag */</i></td></tr>
<tr><th id="6034">6034</th><td>	<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000002))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#319" title="0x00000002" data-ref="_M/BGE_STS_LINK_EVT">BGE_STS_LINK_EVT</a>);</td></tr>
<tr><th id="6035">6035</th><td></td></tr>
<tr><th id="6036">6036</th><td>	<i>/*</i></td></tr>
<tr><th id="6037">6037</th><td><i>	 * Process link state changes.</i></td></tr>
<tr><th id="6038">6038</th><td><i>	 * Grrr. The link status word in the status block does</i></td></tr>
<tr><th id="6039">6039</th><td><i>	 * not work correctly on the BCM5700 rev AX and BX chips,</i></td></tr>
<tr><th id="6040">6040</th><td><i>	 * according to all available information. Hence, we have</i></td></tr>
<tr><th id="6041">6041</th><td><i>	 * to enable MII interrupts in order to properly obtain</i></td></tr>
<tr><th id="6042">6042</th><td><i>	 * async link changes. Unfortunately, this also means that</i></td></tr>
<tr><th id="6043">6043</th><td><i>	 * we have to read the MAC status register to detect link</i></td></tr>
<tr><th id="6044">6044</th><td><i>	 * changes, thereby adding an additional register access to</i></td></tr>
<tr><th id="6045">6045</th><td><i>	 * the interrupt handler.</i></td></tr>
<tr><th id="6046">6046</th><td><i>	 */</i></td></tr>
<tr><th id="6047">6047</th><td></td></tr>
<tr><th id="6048">6048</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#357" title="0x07" data-ref="_M/BGE_ASICREV_BCM5700">BGE_ASICREV_BCM5700</a>) {</td></tr>
<tr><th id="6049">6049</th><td>		<a class="local col3 ref" href="#433status" title='status' data-ref="433status" data-ref-filename="433status">status</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>);</td></tr>
<tr><th id="6050">6050</th><td>		<b>if</b> (<a class="local col3 ref" href="#433status" title='status' data-ref="433status" data-ref-filename="433status">status</a> &amp; <a class="macro" href="if_bgereg.h.html#735" title="0x00800000" data-ref="_M/BGE_MACSTAT_MI_INTERRUPT">BGE_MACSTAT_MI_INTERRUPT</a>) {</td></tr>
<tr><th id="6051">6051</th><td>			<a class="ref fn" href="../mii/miivar.h.html#mii_pollstat" title='mii_pollstat' data-ref="mii_pollstat" data-ref-filename="mii_pollstat">mii_pollstat</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>);</td></tr>
<tr><th id="6052">6052</th><td></td></tr>
<tr><th id="6053">6053</th><td>			<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="6054">6054</th><td>			    <a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a> &amp;&amp;</td></tr>
<tr><th id="6055">6055</th><td>			    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) != <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>)</td></tr>
<tr><th id="6056">6056</th><td>				<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000001))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6057">6057</th><td>			<b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="6058">6058</th><td>			    (!(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a>) ||</td></tr>
<tr><th id="6059">6059</th><td>			    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) == <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>))</td></tr>
<tr><th id="6060">6060</th><td>				<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000001))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6061">6061</th><td></td></tr>
<tr><th id="6062">6062</th><td>			<i>/* Clear the interrupt */</i></td></tr>
<tr><th id="6063">6063</th><td>			<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0408, 0x00800000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#627" title="0x0408" data-ref="_M/BGE_MAC_EVT_ENB">BGE_MAC_EVT_ENB</a>,</td></tr>
<tr><th id="6064">6064</th><td>			    <a class="macro" href="if_bgereg.h.html#745" title="0x00800000" data-ref="_M/BGE_EVTENB_MI_INTERRUPT">BGE_EVTENB_MI_INTERRUPT</a>);</td></tr>
<tr><th id="6065">6065</th><td>			<a class="tu ref fn" href="#bge_miibus_readreg" title='bge_miibus_readreg' data-use='c' data-ref="bge_miibus_readreg" data-ref-filename="bge_miibus_readreg">bge_miibus_readreg</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a>,</td></tr>
<tr><th id="6066">6066</th><td>			    <a class="macro" href="../mii/brgphyreg.h.html#157" title="0x1A" data-ref="_M/BRGPHY_MII_ISR">BRGPHY_MII_ISR</a>, &amp;<a class="local col4 ref" href="#434phyval" title='phyval' data-ref="434phyval" data-ref-filename="434phyval">phyval</a>);</td></tr>
<tr><th id="6067">6067</th><td>			<a class="tu ref fn" href="#bge_miibus_writereg" title='bge_miibus_writereg' data-use='c' data-ref="bge_miibus_writereg" data-ref-filename="bge_miibus_writereg">bge_miibus_writereg</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>, <a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_phy_addr" title='bge_softc::bge_phy_addr' data-ref="bge_softc::bge_phy_addr" data-ref-filename="bge_softc..bge_phy_addr">bge_phy_addr</a>,</td></tr>
<tr><th id="6068">6068</th><td>			    <a class="macro" href="../mii/brgphyreg.h.html#174" title="0x1B" data-ref="_M/BRGPHY_MII_IMR">BRGPHY_MII_IMR</a>, <a class="macro" href="../mii/brgphyreg.h.html#325" title="~(0x0002 | 0x0004 | 0x0008)" data-ref="_M/BRGPHY_INTRS">BRGPHY_INTRS</a>);</td></tr>
<tr><th id="6069">6069</th><td>		}</td></tr>
<tr><th id="6070">6070</th><td>		<b>return</b>;</td></tr>
<tr><th id="6071">6071</th><td>	}</td></tr>
<tr><th id="6072">6072</th><td></td></tr>
<tr><th id="6073">6073</th><td>	<b>if</b> (<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2662" title="0x00000001" data-ref="_M/BGEF_FIBER_TBI">BGEF_FIBER_TBI</a>) {</td></tr>
<tr><th id="6074">6074</th><td>		<a class="local col3 ref" href="#433status" title='status' data-ref="433status" data-ref-filename="433status">status</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>);</td></tr>
<tr><th id="6075">6075</th><td>		<b>if</b> (<a class="local col3 ref" href="#433status" title='status' data-ref="433status" data-ref-filename="433status">status</a> &amp; <a class="macro" href="if_bgereg.h.html#727" title="0x00000001" data-ref="_M/BGE_MACSTAT_TBI_PCS_SYNCHED">BGE_MACSTAT_TBI_PCS_SYNCHED</a>) {</td></tr>
<tr><th id="6076">6076</th><td>			<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>)) {</td></tr>
<tr><th id="6077">6077</th><td>				<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000001))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6078">6078</th><td>				<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>)</td></tr>
<tr><th id="6079">6079</th><td>				    == <a class="macro" href="if_bgereg.h.html#360" title="0x02" data-ref="_M/BGE_ASICREV_BCM5704">BGE_ASICREV_BCM5704</a>) {</td></tr>
<tr><th id="6080">6080</th><td>					<a class="macro" href="if_bgevar.h.html#116" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400, (bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0400) &amp; ~(0x00020000)))" data-ref="_M/BGE_CLRBIT">BGE_CLRBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#625" title="0x0400" data-ref="_M/BGE_MAC_MODE">BGE_MAC_MODE</a>,</td></tr>
<tr><th id="6081">6081</th><td>					    <a class="macro" href="if_bgereg.h.html#711" title="0x00020000" data-ref="_M/BGE_MACMODE_TBI_SEND_CFGS">BGE_MACMODE_TBI_SEND_CFGS</a>);</td></tr>
<tr><th id="6082">6082</th><td>					<a class="macro" href="../../arch/x86/include/cpu.h.html#428" title="(*delay_func)(40)" data-ref="_M/DELAY">DELAY</a>(<var>40</var>);</td></tr>
<tr><th id="6083">6083</th><td>				}</td></tr>
<tr><th id="6084">6084</th><td>				<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404, 0xFFFFFFFF)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>, <var>0xFFFFFFFF</var>);</td></tr>
<tr><th id="6085">6085</th><td>				<a class="ref fn" href="../../net/if.h.html#if_link_state_change" title='if_link_state_change' data-ref="if_link_state_change" data-ref-filename="if_link_state_change">if_link_state_change</a>(<a class="local col1 ref" href="#431ifp" title='ifp' data-ref="431ifp" data-ref-filename="431ifp">ifp</a>, <a class="macro" href="../../net/if.h.html#206" title="2" data-ref="_M/LINK_STATE_UP">LINK_STATE_UP</a>);</td></tr>
<tr><th id="6086">6086</th><td>			}</td></tr>
<tr><th id="6087">6087</th><td>		} <b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>)) {</td></tr>
<tr><th id="6088">6088</th><td>			<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000001))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6089">6089</th><td>			<a class="ref fn" href="../../net/if.h.html#if_link_state_change" title='if_link_state_change' data-ref="if_link_state_change" data-ref-filename="if_link_state_change">if_link_state_change</a>(<a class="local col1 ref" href="#431ifp" title='ifp' data-ref="431ifp" data-ref-filename="431ifp">ifp</a>, <a class="macro" href="../../net/if.h.html#205" title="1" data-ref="_M/LINK_STATE_DOWN">LINK_STATE_DOWN</a>);</td></tr>
<tr><th id="6090">6090</th><td>		}</td></tr>
<tr><th id="6091">6091</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000004))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#320" title="0x00000004" data-ref="_M/BGE_STS_AUTOPOLL">BGE_STS_AUTOPOLL</a>)) {</td></tr>
<tr><th id="6092">6092</th><td>		<i>/*</i></td></tr>
<tr><th id="6093">6093</th><td><i>		 * Some broken BCM chips have BGE_STATFLAG_LINKSTATE_CHANGED</i></td></tr>
<tr><th id="6094">6094</th><td><i>		 * bit in status word always set. Workaround this bug by</i></td></tr>
<tr><th id="6095">6095</th><td><i>		 * reading PHY link status directly.</i></td></tr>
<tr><th id="6096">6096</th><td><i>		 */</i></td></tr>
<tr><th id="6097">6097</th><td>		<a class="local col5 ref" href="#435link" title='link' data-ref="435link" data-ref-filename="435link">link</a> = (<a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0450)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#645" title="0x0450" data-ref="_M/BGE_MI_STS">BGE_MI_STS</a>) &amp; <a class="macro" href="if_bgereg.h.html#856" title="0x00000001" data-ref="_M/BGE_MISTS_LINK">BGE_MISTS_LINK</a>)?</td></tr>
<tr><th id="6098">6098</th><td>		    <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a> : <var>0</var>;</td></tr>
<tr><th id="6099">6099</th><td></td></tr>
<tr><th id="6100">6100</th><td>		<b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) != <a class="local col5 ref" href="#435link" title='link' data-ref="435link" data-ref-filename="435link">link</a>) {</td></tr>
<tr><th id="6101">6101</th><td>			<a class="ref fn" href="../mii/miivar.h.html#mii_pollstat" title='mii_pollstat' data-ref="mii_pollstat" data-ref-filename="mii_pollstat">mii_pollstat</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>);</td></tr>
<tr><th id="6102">6102</th><td></td></tr>
<tr><th id="6103">6103</th><td>			<b>if</b> (!<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="6104">6104</th><td>			    <a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a> &amp;&amp;</td></tr>
<tr><th id="6105">6105</th><td>			    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) != <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>)</td></tr>
<tr><th id="6106">6106</th><td>				<a class="macro" href="if_bgevar.h.html#322" title="((sc)-&gt;bge_sts |= (0x00000001))" data-ref="_M/BGE_STS_SETBIT">BGE_STS_SETBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6107">6107</th><td>			<b>else</b> <b>if</b> (<a class="macro" href="if_bgevar.h.html#321" title="((sc)-&gt;bge_sts &amp; (0x00000001))" data-ref="_M/BGE_STS_BIT">BGE_STS_BIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>) &amp;&amp;</td></tr>
<tr><th id="6108">6108</th><td>			    (!(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_status" title='mii_data::mii_media_status' data-ref="mii_data::mii_media_status" data-ref-filename="mii_data..mii_media_status">mii_media_status</a> &amp; <a class="macro" href="../../net/if_media.h.html#90" title="0x00000002" data-ref="_M/IFM_ACTIVE">IFM_ACTIVE</a>) ||</td></tr>
<tr><th id="6109">6109</th><td>			    <a class="macro" href="../../net/if_media.h.html#140" title="(((mii-&gt;mii_media_active) &amp; 0x000000e0) == 0x00000020 ? ((mii-&gt;mii_media_active) &amp; (0x0000001f | 0x0000e000)) : ((mii-&gt;mii_media_active) &amp; 0x0000001f))" data-ref="_M/IFM_SUBTYPE">IFM_SUBTYPE</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>-&gt;<a class="ref field" href="../mii/miivar.h.html#mii_data::mii_media_active" title='mii_data::mii_media_active' data-ref="mii_data::mii_media_active" data-ref-filename="mii_data..mii_media_active">mii_media_active</a>) == <a class="macro" href="../../net/if_media.h.html#188" title="2" data-ref="_M/IFM_NONE">IFM_NONE</a>))</td></tr>
<tr><th id="6110">6110</th><td>				<a class="macro" href="if_bgevar.h.html#323" title="((sc)-&gt;bge_sts &amp;= ~(0x00000001))" data-ref="_M/BGE_STS_CLRBIT">BGE_STS_CLRBIT</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgevar.h.html#318" title="0x00000001" data-ref="_M/BGE_STS_LINK">BGE_STS_LINK</a>);</td></tr>
<tr><th id="6111">6111</th><td>		}</td></tr>
<tr><th id="6112">6112</th><td>	} <b>else</b> {</td></tr>
<tr><th id="6113">6113</th><td>		<i>/*</i></td></tr>
<tr><th id="6114">6114</th><td><i>		 * For controllers that call mii_tick, we have to poll</i></td></tr>
<tr><th id="6115">6115</th><td><i>		 * link status.</i></td></tr>
<tr><th id="6116">6116</th><td><i>		 */</i></td></tr>
<tr><th id="6117">6117</th><td>		<a class="ref fn" href="../mii/miivar.h.html#mii_pollstat" title='mii_pollstat' data-ref="mii_pollstat" data-ref-filename="mii_pollstat">mii_pollstat</a>(<a class="local col2 ref" href="#432mii" title='mii' data-ref="432mii" data-ref-filename="432mii">mii</a>);</td></tr>
<tr><th id="6118">6118</th><td>	}</td></tr>
<tr><th id="6119">6119</th><td></td></tr>
<tr><th id="6120">6120</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#384" title="((sc-&gt;bge_chipid) &gt;&gt; 8)" data-ref="_M/BGE_CHIPREV">BGE_CHIPREV</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#394" title="0x57840" data-ref="_M/BGE_CHIPREV_5784_AX">BGE_CHIPREV_5784_AX</a>) {</td></tr>
<tr><th id="6121">6121</th><td>		<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="436reg" title='reg' data-type='uint32_t' data-ref="436reg" data-ref-filename="436reg">reg</dfn>, <dfn class="local col7 decl" id="437scale" title='scale' data-type='uint32_t' data-ref="437scale" data-ref-filename="437scale">scale</dfn>;</td></tr>
<tr><th id="6122">6122</th><td></td></tr>
<tr><th id="6123">6123</th><td>		<a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x3630)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1240" title="0x3630" data-ref="_M/BGE_CPMU_CLCK_STAT">BGE_CPMU_CLCK_STAT</a>) &amp;</td></tr>
<tr><th id="6124">6124</th><td>		    <a class="macro" href="if_bgereg.h.html#1272" title="0x001F0000" data-ref="_M/BGE_CPMU_CLCK_STAT_MAC_CLCK_MASK">BGE_CPMU_CLCK_STAT_MAC_CLCK_MASK</a>;</td></tr>
<tr><th id="6125">6125</th><td>		<b>if</b> (<a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a> == <a class="macro" href="if_bgereg.h.html#1273" title="0x00000000" data-ref="_M/BGE_CPMU_CLCK_STAT_MAC_CLCK_62_5">BGE_CPMU_CLCK_STAT_MAC_CLCK_62_5</a>)</td></tr>
<tr><th id="6126">6126</th><td>			<a class="local col7 ref" href="#437scale" title='scale' data-ref="437scale" data-ref-filename="437scale">scale</a> = <var>65</var>;</td></tr>
<tr><th id="6127">6127</th><td>		<b>else</b> <b>if</b> (<a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a> == <a class="macro" href="if_bgereg.h.html#1275" title="0x00130000" data-ref="_M/BGE_CPMU_CLCK_STAT_MAC_CLCK_6_25">BGE_CPMU_CLCK_STAT_MAC_CLCK_6_25</a>)</td></tr>
<tr><th id="6128">6128</th><td>			<a class="local col7 ref" href="#437scale" title='scale' data-ref="437scale" data-ref-filename="437scale">scale</a> = <var>6</var>;</td></tr>
<tr><th id="6129">6129</th><td>		<b>else</b></td></tr>
<tr><th id="6130">6130</th><td>			<a class="local col7 ref" href="#437scale" title='scale' data-ref="437scale" data-ref-filename="437scale">scale</a> = <var>12</var>;</td></tr>
<tr><th id="6131">6131</th><td></td></tr>
<tr><th id="6132">6132</th><td>		<a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a> = <a class="macro" href="if_bgevar.h.html#100" title="bus_space_read_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804)" data-ref="_M/CSR_READ_4">CSR_READ_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>) &amp;</td></tr>
<tr><th id="6133">6133</th><td>		    ~<a class="macro" href="if_bgereg.h.html#2040" title="0x000000FE" data-ref="_M/BGE_MISCCFG_TIMER_PRESCALER">BGE_MISCCFG_TIMER_PRESCALER</a>;</td></tr>
<tr><th id="6134">6134</th><td>		<a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a> |= <a class="local col7 ref" href="#437scale" title='scale' data-ref="437scale" data-ref-filename="437scale">scale</a> &lt;&lt; <var>1</var>;</td></tr>
<tr><th id="6135">6135</th><td>		<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x6804, reg)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#1898" title="0x6804" data-ref="_M/BGE_MISC_CFG">BGE_MISC_CFG</a>, <a class="local col6 ref" href="#436reg" title='reg' data-ref="436reg" data-ref-filename="436reg">reg</a>);</td></tr>
<tr><th id="6136">6136</th><td>	}</td></tr>
<tr><th id="6137">6137</th><td>	<i>/* Clear the attention */</i></td></tr>
<tr><th id="6138">6138</th><td>	<a class="macro" href="if_bgevar.h.html#97" title="bus_space_write_4(sc-&gt;bge_btag, sc-&gt;bge_bhandle, 0x0404, 0x00000010 | 0x00000008 | 0x00400000 | 0x00001000)" data-ref="_M/CSR_WRITE_4">CSR_WRITE_4</a>(<a class="local col0 ref" href="#430sc" title='sc' data-ref="430sc" data-ref-filename="430sc">sc</a>, <a class="macro" href="if_bgereg.h.html#626" title="0x0404" data-ref="_M/BGE_MAC_STS">BGE_MAC_STS</a>, <a class="macro" href="if_bgereg.h.html#731" title="0x00000010" data-ref="_M/BGE_MACSTAT_SYNC_CHANGED">BGE_MACSTAT_SYNC_CHANGED</a> |</td></tr>
<tr><th id="6139">6139</th><td>	    <a class="macro" href="if_bgereg.h.html#730" title="0x00000008" data-ref="_M/BGE_MACSTAT_CFG_CHANGED">BGE_MACSTAT_CFG_CHANGED</a> | <a class="macro" href="if_bgereg.h.html#734" title="0x00400000" data-ref="_M/BGE_MACSTAT_MI_COMPLETE">BGE_MACSTAT_MI_COMPLETE</a> |</td></tr>
<tr><th id="6140">6140</th><td>	    <a class="macro" href="if_bgereg.h.html#733" title="0x00001000" data-ref="_M/BGE_MACSTAT_LINK_CHANGED">BGE_MACSTAT_LINK_CHANGED</a>);</td></tr>
<tr><th id="6141">6141</th><td>}</td></tr>
<tr><th id="6142">6142</th><td></td></tr>
<tr><th id="6143">6143</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6144">6144</th><td><dfn class="tu decl def fn" id="bge_sysctl_verify" title='bge_sysctl_verify' data-type='int bge_sysctl_verify(const int * name, u_int namelen, void * oldp, size_t * oldlenp, const void * newp, size_t newlen, const int * oname, struct lwp * l, const struct sysctlnode * rnode)' data-ref="bge_sysctl_verify" data-ref-filename="bge_sysctl_verify">bge_sysctl_verify</dfn>(<a class="macro" href="../../sys/sysctl.h.html#957" title="const int *name, u_int namelen, void *oldp, size_t *oldlenp, const void *newp, size_t newlen, const int *oname, struct lwp *l, const struct sysctlnode *rnode" data-ref="_M/SYSCTLFN_ARGS">SYSCTLFN_ARGS</a>)</td></tr>
<tr><th id="6145">6145</th><td>{</td></tr>
<tr><th id="6146">6146</th><td>	<em>int</em> <dfn class="local col8 decl" id="438error" title='error' data-type='int' data-ref="438error" data-ref-filename="438error">error</dfn>, <dfn class="local col9 decl" id="439t" title='t' data-type='int' data-ref="439t" data-ref-filename="439t">t</dfn>;</td></tr>
<tr><th id="6147">6147</th><td>	<b>struct</b> <a class="type" href="../../sys/sysctl.h.html#sysctlnode" title='sysctlnode' data-ref="sysctlnode" data-ref-filename="sysctlnode">sysctlnode</a> <dfn class="local col0 decl" id="440node" title='node' data-type='struct sysctlnode' data-ref="440node" data-ref-filename="440node">node</dfn>;</td></tr>
<tr><th id="6148">6148</th><td></td></tr>
<tr><th id="6149">6149</th><td>	<a class="local col0 ref" href="#440node" title='node' data-ref="440node" data-ref-filename="440node">node</a> = *<a class="local col1 ref" href="#6144" title='rnode' data-ref="441rnode" data-ref-filename="441rnode">rnode</a>;</td></tr>
<tr><th id="6150">6150</th><td>	<a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a> = *(<em>int</em>*)<a class="local col1 ref" href="#6144" title='rnode' data-ref="441rnode" data-ref-filename="441rnode">rnode</a>-&gt;<a class="macro" href="../../sys/sysctl.h.html#1255" title="sysctl_un.scu_data._sud_data.__sysc_ustr.__sysc_sdatum" data-ref="_M/sysctl_data">sysctl_data</a>;</td></tr>
<tr><th id="6151">6151</th><td>	<a class="local col0 ref" href="#440node" title='node' data-ref="440node" data-ref-filename="440node">node</a>.<a class="macro" href="../../sys/sysctl.h.html#1255" title="sysctl_un.scu_data._sud_data.__sysc_ustr.__sysc_sdatum" data-ref="_M/sysctl_data">sysctl_data</a> = &amp;<a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a>;</td></tr>
<tr><th id="6152">6152</th><td>	<a class="local col8 ref" href="#438error" title='error' data-ref="438error" data-ref-filename="438error">error</a> = <a class="ref fn" href="../../sys/sysctl.h.html#sysctl_lookup" title='sysctl_lookup' data-ref="sysctl_lookup" data-ref-filename="sysctl_lookup">sysctl_lookup</a>(<a class="macro" href="../../sys/sysctl.h.html#962" title="name, namelen, oldp, oldlenp, newp, newlen, oname, l, &amp;node" data-ref="_M/SYSCTLFN_CALL">SYSCTLFN_CALL</a>(&amp;<a class="local col0 ref" href="#440node" title='node' data-ref="440node" data-ref-filename="440node">node</a>));</td></tr>
<tr><th id="6153">6153</th><td>	<b>if</b> (<a class="local col8 ref" href="#438error" title='error' data-ref="438error" data-ref-filename="438error">error</a> || <a class="local col2 ref" href="#6144" title='newp' data-ref="442newp" data-ref-filename="442newp">newp</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="6154">6154</th><td>		<b>return</b> <a class="local col8 ref" href="#438error" title='error' data-ref="438error" data-ref-filename="438error">error</a>;</td></tr>
<tr><th id="6155">6155</th><td></td></tr>
<tr><th id="6156">6156</th><td><u>#<span data-ppcond="6156">if</span> 0</u></td></tr>
<tr><th id="6157">6157</th><td>	DPRINTF2((<q>"%s: t = %d, nodenum = %d, rnodenum = %d\n"</q>, <b>__func__</b>, t,</td></tr>
<tr><th id="6158">6158</th><td>	    node.sysctl_num, rnode-&gt;sysctl_num));</td></tr>
<tr><th id="6159">6159</th><td><u>#<span data-ppcond="6156">endif</span></u></td></tr>
<tr><th id="6160">6160</th><td></td></tr>
<tr><th id="6161">6161</th><td>	<b>if</b> (<a class="local col0 ref" href="#440node" title='node' data-ref="440node" data-ref-filename="440node">node</a>.<a class="ref field" href="../../sys/sysctl.h.html#sysctlnode::sysctl_num" title='sysctlnode::sysctl_num' data-ref="sysctlnode::sysctl_num" data-ref-filename="sysctlnode..sysctl_num">sysctl_num</a> == <a class="tu ref" href="#bge_rxthresh_nodenum" title='bge_rxthresh_nodenum' data-use='r' data-ref="bge_rxthresh_nodenum" data-ref-filename="bge_rxthresh_nodenum">bge_rxthresh_nodenum</a>) {</td></tr>
<tr><th id="6162">6162</th><td>		<b>if</b> (<a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a> &lt; <var>0</var> || <a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a> &gt;= <a class="macro" href="#172" title="(sizeof(bge_rx_threshes) / sizeof(bge_rx_threshes[0]))" data-ref="_M/NBGE_RX_THRESH">NBGE_RX_THRESH</a>)</td></tr>
<tr><th id="6163">6163</th><td>			<b>return</b> <a class="macro" href="../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="6164">6164</th><td>		<a class="tu ref fn" href="#bge_update_all_threshes" title='bge_update_all_threshes' data-use='c' data-ref="bge_update_all_threshes" data-ref-filename="bge_update_all_threshes">bge_update_all_threshes</a>(<a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a>);</td></tr>
<tr><th id="6165">6165</th><td>	} <b>else</b></td></tr>
<tr><th id="6166">6166</th><td>		<b>return</b> <a class="macro" href="../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="6167">6167</th><td></td></tr>
<tr><th id="6168">6168</th><td>	*(<em>int</em>*)<a class="local col1 ref" href="#6144" title='rnode' data-ref="441rnode" data-ref-filename="441rnode">rnode</a>-&gt;<a class="macro" href="../../sys/sysctl.h.html#1255" title="sysctl_un.scu_data._sud_data.__sysc_ustr.__sysc_sdatum" data-ref="_M/sysctl_data">sysctl_data</a> = <a class="local col9 ref" href="#439t" title='t' data-ref="439t" data-ref-filename="439t">t</a>;</td></tr>
<tr><th id="6169">6169</th><td></td></tr>
<tr><th id="6170">6170</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="6171">6171</th><td>}</td></tr>
<tr><th id="6172">6172</th><td></td></tr>
<tr><th id="6173">6173</th><td><i  data-doc="bge_sysctl_init">/*</i></td></tr>
<tr><th id="6174">6174</th><td><i  data-doc="bge_sysctl_init"> * Set up sysctl(3) MIB, hw.bge.*.</i></td></tr>
<tr><th id="6175">6175</th><td><i  data-doc="bge_sysctl_init"> */</i></td></tr>
<tr><th id="6176">6176</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="6177">6177</th><td><dfn class="tu decl def fn" id="bge_sysctl_init" title='bge_sysctl_init' data-type='void bge_sysctl_init(struct bge_softc * sc)' data-ref="bge_sysctl_init" data-ref-filename="bge_sysctl_init">bge_sysctl_init</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col3 decl" id="443sc" title='sc' data-type='struct bge_softc *' data-ref="443sc" data-ref-filename="443sc">sc</dfn>)</td></tr>
<tr><th id="6178">6178</th><td>{</td></tr>
<tr><th id="6179">6179</th><td>	<em>int</em> <dfn class="local col4 decl" id="444rc" title='rc' data-type='int' data-ref="444rc" data-ref-filename="444rc">rc</dfn>, <dfn class="local col5 decl" id="445bge_root_num" title='bge_root_num' data-type='int' data-ref="445bge_root_num" data-ref-filename="445bge_root_num">bge_root_num</dfn>;</td></tr>
<tr><th id="6180">6180</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../sys/sysctl.h.html#sysctlnode" title='sysctlnode' data-ref="sysctlnode" data-ref-filename="sysctlnode">sysctlnode</a> *<dfn class="local col6 decl" id="446node" title='node' data-type='const struct sysctlnode *' data-ref="446node" data-ref-filename="446node">node</dfn>;</td></tr>
<tr><th id="6181">6181</th><td></td></tr>
<tr><th id="6182">6182</th><td>	<b>if</b> ((<a class="local col4 ref" href="#444rc" title='rc' data-ref="444rc" data-ref-filename="444rc">rc</a> = <a class="macro" href="../../sys/sysctl.h.html#1113" title="sysctl_createv(&amp;sc-&gt;bge_log, 0, ((void *)0), &amp;node, 0, 1, &quot;bge&quot;, &quot;BGE interface controls&quot;, ((void *)0), 0, __sysctl_verify_CTLTYPE_NODE_arg(((void *)0)), 0, 6, (-3), (-1))" data-ref="_M/sysctl_createv">sysctl_createv</a>(&amp;<a class="local col3 ref" href="#443sc" title='sc' data-ref="443sc" data-ref-filename="443sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_log" title='bge_softc::bge_log' data-ref="bge_softc::bge_log" data-ref-filename="bge_softc..bge_log">bge_log</a>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, &amp;<a class="local col6 ref" href="#446node" title='node' data-ref="446node" data-ref-filename="446node">node</a>,</td></tr>
<tr><th id="6183">6183</th><td>	    <var>0</var>, <a class="macro" href="../../sys/sysctl.h.html#92" title="1" data-ref="_M/CTLTYPE_NODE">CTLTYPE_NODE</a>, <q>"bge"</q>,</td></tr>
<tr><th id="6184">6184</th><td>	    <a class="macro" href="../../sys/sysctl.h.html#1126" title="&quot;BGE interface controls&quot;" data-ref="_M/SYSCTL_DESCR">SYSCTL_DESCR</a>(<q>"BGE interface controls"</q>),</td></tr>
<tr><th id="6185">6185</th><td>	    <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <var>0</var>, <a class="macro" href="../../sys/sysctl.h.html#175" title="6" data-ref="_M/CTL_HW">CTL_HW</a>, <a class="macro" href="../../sys/sysctl.h.html#160" title="(-3)" data-ref="_M/CTL_CREATE">CTL_CREATE</a>, <a class="macro" href="../../sys/sysctl.h.html#158" title="(-1)" data-ref="_M/CTL_EOL">CTL_EOL</a>)) != <var>0</var>) {</td></tr>
<tr><th id="6186">6186</th><td>		<b>goto</b> <a class="lbl" href="#447out" data-ref="447out" data-ref-filename="447out">out</a>;</td></tr>
<tr><th id="6187">6187</th><td>	}</td></tr>
<tr><th id="6188">6188</th><td></td></tr>
<tr><th id="6189">6189</th><td>	<a class="local col5 ref" href="#445bge_root_num" title='bge_root_num' data-ref="445bge_root_num" data-ref-filename="445bge_root_num">bge_root_num</a> = <a class="local col6 ref" href="#446node" title='node' data-ref="446node" data-ref-filename="446node">node</a>-&gt;<a class="ref field" href="../../sys/sysctl.h.html#sysctlnode::sysctl_num" title='sysctlnode::sysctl_num' data-ref="sysctlnode::sysctl_num" data-ref-filename="sysctlnode..sysctl_num">sysctl_num</a>;</td></tr>
<tr><th id="6190">6190</th><td></td></tr>
<tr><th id="6191">6191</th><td>	<i>/* BGE Rx interrupt mitigation level */</i></td></tr>
<tr><th id="6192">6192</th><td>	<b>if</b> ((<a class="local col4 ref" href="#444rc" title='rc' data-ref="444rc" data-ref-filename="444rc">rc</a> = <a class="macro" href="../../sys/sysctl.h.html#1113" title="sysctl_createv(&amp;sc-&gt;bge_log, 0, ((void *)0), &amp;node, 0x00000070, 2, &quot;rx_lvl&quot;, &quot;BGE receive interrupt mitigation level&quot;, bge_sysctl_verify, 0, __sysctl_verify_CTLTYPE_INT_arg(&amp;bge_rx_thresh_lvl), 0, 6, bge_root_num, (-3), (-1))" data-ref="_M/sysctl_createv">sysctl_createv</a>(&amp;<a class="local col3 ref" href="#443sc" title='sc' data-ref="443sc" data-ref-filename="443sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_log" title='bge_softc::bge_log' data-ref="bge_softc::bge_log" data-ref-filename="bge_softc..bge_log">bge_log</a>, <var>0</var>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, &amp;<a class="local col6 ref" href="#446node" title='node' data-ref="446node" data-ref-filename="446node">node</a>,</td></tr>
<tr><th id="6193">6193</th><td>	    <a class="macro" href="../../sys/sysctl.h.html#112" title="0x00000070" data-ref="_M/CTLFLAG_READWRITE">CTLFLAG_READWRITE</a>,</td></tr>
<tr><th id="6194">6194</th><td>	    <a class="macro" href="../../sys/sysctl.h.html#93" title="2" data-ref="_M/CTLTYPE_INT">CTLTYPE_INT</a>, <q>"rx_lvl"</q>,</td></tr>
<tr><th id="6195">6195</th><td>	    <a class="macro" href="../../sys/sysctl.h.html#1126" title="&quot;BGE receive interrupt mitigation level&quot;" data-ref="_M/SYSCTL_DESCR">SYSCTL_DESCR</a>(<q>"BGE receive interrupt mitigation level"</q>),</td></tr>
<tr><th id="6196">6196</th><td>	    <a class="tu ref fn" href="#bge_sysctl_verify" title='bge_sysctl_verify' data-use='r' data-ref="bge_sysctl_verify" data-ref-filename="bge_sysctl_verify">bge_sysctl_verify</a>, <var>0</var>,</td></tr>
<tr><th id="6197">6197</th><td>	    &amp;<a class="tu ref" href="#bge_rx_thresh_lvl" title='bge_rx_thresh_lvl' data-use='a' data-ref="bge_rx_thresh_lvl" data-ref-filename="bge_rx_thresh_lvl">bge_rx_thresh_lvl</a>,</td></tr>
<tr><th id="6198">6198</th><td>	    <var>0</var>, <a class="macro" href="../../sys/sysctl.h.html#175" title="6" data-ref="_M/CTL_HW">CTL_HW</a>, <a class="local col5 ref" href="#445bge_root_num" title='bge_root_num' data-ref="445bge_root_num" data-ref-filename="445bge_root_num">bge_root_num</a>, <a class="macro" href="../../sys/sysctl.h.html#160" title="(-3)" data-ref="_M/CTL_CREATE">CTL_CREATE</a>,</td></tr>
<tr><th id="6199">6199</th><td>	    <a class="macro" href="../../sys/sysctl.h.html#158" title="(-1)" data-ref="_M/CTL_EOL">CTL_EOL</a>)) != <var>0</var>) {</td></tr>
<tr><th id="6200">6200</th><td>		<b>goto</b> <a class="lbl" href="#447out" data-ref="447out" data-ref-filename="447out">out</a>;</td></tr>
<tr><th id="6201">6201</th><td>	}</td></tr>
<tr><th id="6202">6202</th><td></td></tr>
<tr><th id="6203">6203</th><td>	<a class="tu ref" href="#bge_rxthresh_nodenum" title='bge_rxthresh_nodenum' data-use='w' data-ref="bge_rxthresh_nodenum" data-ref-filename="bge_rxthresh_nodenum">bge_rxthresh_nodenum</a> = <a class="local col6 ref" href="#446node" title='node' data-ref="446node" data-ref-filename="446node">node</a>-&gt;<a class="ref field" href="../../sys/sysctl.h.html#sysctlnode::sysctl_num" title='sysctlnode::sysctl_num' data-ref="sysctlnode::sysctl_num" data-ref-filename="sysctlnode..sysctl_num">sysctl_num</a>;</td></tr>
<tr><th id="6204">6204</th><td></td></tr>
<tr><th id="6205">6205</th><td>	<b>return</b>;</td></tr>
<tr><th id="6206">6206</th><td></td></tr>
<tr><th id="6207">6207</th><td><dfn class="lbl" id="447out" data-ref="447out" data-ref-filename="447out">out</dfn>:</td></tr>
<tr><th id="6208">6208</th><td>	<a class="ref fn" href="../../sys/systm.h.html#aprint_error" title='aprint_error' data-ref="aprint_error" data-ref-filename="aprint_error">aprint_error</a>(<q>"%s: sysctl_createv failed (rc = %d)\n"</q>, <b>__func__</b>, <a class="local col4 ref" href="#444rc" title='rc' data-ref="444rc" data-ref-filename="444rc">rc</a>);</td></tr>
<tr><th id="6209">6209</th><td>}</td></tr>
<tr><th id="6210">6210</th><td></td></tr>
<tr><th id="6211">6211</th><td><u>#<span data-ppcond="6211">ifdef</span> <span class="macro" data-ref="_M/BGE_DEBUG">BGE_DEBUG</span></u></td></tr>
<tr><th id="6212">6212</th><td><em>void</em></td></tr>
<tr><th id="6213">6213</th><td>bge_debug_info(<b>struct</b> bge_softc *sc)</td></tr>
<tr><th id="6214">6214</th><td>{</td></tr>
<tr><th id="6215">6215</th><td></td></tr>
<tr><th id="6216">6216</th><td>	printf(<q>"Hardware Flags:\n"</q>);</td></tr>
<tr><th id="6217">6217</th><td>	<b>if</b> (BGE_IS_57765_PLUS(sc))</td></tr>
<tr><th id="6218">6218</th><td>		printf(<q>" - 57765 Plus\n"</q>);</td></tr>
<tr><th id="6219">6219</th><td>	<b>if</b> (BGE_IS_5717_PLUS(sc))</td></tr>
<tr><th id="6220">6220</th><td>		printf(<q>" - 5717 Plus\n"</q>);</td></tr>
<tr><th id="6221">6221</th><td>	<b>if</b> (BGE_IS_5755_PLUS(sc))</td></tr>
<tr><th id="6222">6222</th><td>		printf(<q>" - 5755 Plus\n"</q>);</td></tr>
<tr><th id="6223">6223</th><td>	<b>if</b> (BGE_IS_575X_PLUS(sc))</td></tr>
<tr><th id="6224">6224</th><td>		printf(<q>" - 575X Plus\n"</q>);</td></tr>
<tr><th id="6225">6225</th><td>	<b>if</b> (BGE_IS_5705_PLUS(sc))</td></tr>
<tr><th id="6226">6226</th><td>		printf(<q>" - 5705 Plus\n"</q>);</td></tr>
<tr><th id="6227">6227</th><td>	<b>if</b> (BGE_IS_5714_FAMILY(sc))</td></tr>
<tr><th id="6228">6228</th><td>		printf(<q>" - 5714 Family\n"</q>);</td></tr>
<tr><th id="6229">6229</th><td>	<b>if</b> (BGE_IS_5700_FAMILY(sc))</td></tr>
<tr><th id="6230">6230</th><td>		printf(<q>" - 5700 Family\n"</q>);</td></tr>
<tr><th id="6231">6231</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_IS_5788)</td></tr>
<tr><th id="6232">6232</th><td>		printf(<q>" - 5788\n"</q>);</td></tr>
<tr><th id="6233">6233</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_JUMBO_CAPABLE)</td></tr>
<tr><th id="6234">6234</th><td>		printf(<q>" - Supports Jumbo Frames\n"</q>);</td></tr>
<tr><th id="6235">6235</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_NO_EEPROM)</td></tr>
<tr><th id="6236">6236</th><td>		printf(<q>" - No EEPROM\n"</q>);</td></tr>
<tr><th id="6237">6237</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_PCIX)</td></tr>
<tr><th id="6238">6238</th><td>		printf(<q>" - PCI-X Bus\n"</q>);</td></tr>
<tr><th id="6239">6239</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_PCIE)</td></tr>
<tr><th id="6240">6240</th><td>		printf(<q>" - PCI Express Bus\n"</q>);</td></tr>
<tr><th id="6241">6241</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_RX_ALIGNBUG)</td></tr>
<tr><th id="6242">6242</th><td>		printf(<q>" - RX Alignment Bug\n"</q>);</td></tr>
<tr><th id="6243">6243</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_APE)</td></tr>
<tr><th id="6244">6244</th><td>		printf(<q>" - APE\n"</q>);</td></tr>
<tr><th id="6245">6245</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_CPMU_PRESENT)</td></tr>
<tr><th id="6246">6246</th><td>		printf(<q>" - CPMU\n"</q>);</td></tr>
<tr><th id="6247">6247</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_TSO)</td></tr>
<tr><th id="6248">6248</th><td>		printf(<q>" - TSO\n"</q>);</td></tr>
<tr><th id="6249">6249</th><td>	<b>if</b> (sc-&gt;bge_flags &amp; BGEF_TAGGED_STATUS)</td></tr>
<tr><th id="6250">6250</th><td>		printf(<q>" - TAGGED_STATUS\n"</q>);</td></tr>
<tr><th id="6251">6251</th><td></td></tr>
<tr><th id="6252">6252</th><td>	<i>/* PHY related */</i></td></tr>
<tr><th id="6253">6253</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_NO_3LED)</td></tr>
<tr><th id="6254">6254</th><td>		printf(<q>" - No 3 LEDs\n"</q>);</td></tr>
<tr><th id="6255">6255</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_CRC_BUG)</td></tr>
<tr><th id="6256">6256</th><td>		printf(<q>" - CRC bug\n"</q>);</td></tr>
<tr><th id="6257">6257</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_ADC_BUG)</td></tr>
<tr><th id="6258">6258</th><td>		printf(<q>" - ADC bug\n"</q>);</td></tr>
<tr><th id="6259">6259</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_5704_A0_BUG)</td></tr>
<tr><th id="6260">6260</th><td>		printf(<q>" - 5704 A0 bug\n"</q>);</td></tr>
<tr><th id="6261">6261</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_JITTER_BUG)</td></tr>
<tr><th id="6262">6262</th><td>		printf(<q>" - jitter bug\n"</q>);</td></tr>
<tr><th id="6263">6263</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_BER_BUG)</td></tr>
<tr><th id="6264">6264</th><td>		printf(<q>" - BER bug\n"</q>);</td></tr>
<tr><th id="6265">6265</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_ADJUST_TRIM)</td></tr>
<tr><th id="6266">6266</th><td>		printf(<q>" - adjust trim\n"</q>);</td></tr>
<tr><th id="6267">6267</th><td>	<b>if</b> (sc-&gt;bge_phy_flags &amp; BGEPHYF_NO_WIRESPEED)</td></tr>
<tr><th id="6268">6268</th><td>		printf(<q>" - no wirespeed\n"</q>);</td></tr>
<tr><th id="6269">6269</th><td></td></tr>
<tr><th id="6270">6270</th><td>	<i>/* ASF related */</i></td></tr>
<tr><th id="6271">6271</th><td>	<b>if</b> (sc-&gt;bge_asf_mode &amp; ASF_ENABLE)</td></tr>
<tr><th id="6272">6272</th><td>		printf(<q>" - ASF enable\n"</q>);</td></tr>
<tr><th id="6273">6273</th><td>	<b>if</b> (sc-&gt;bge_asf_mode &amp; ASF_NEW_HANDSHAKE)</td></tr>
<tr><th id="6274">6274</th><td>		printf(<q>" - ASF new handshake\n"</q>);</td></tr>
<tr><th id="6275">6275</th><td>	<b>if</b> (sc-&gt;bge_asf_mode &amp; ASF_STACKUP)</td></tr>
<tr><th id="6276">6276</th><td>		printf(<q>" - ASF stackup\n"</q>);</td></tr>
<tr><th id="6277">6277</th><td>}</td></tr>
<tr><th id="6278">6278</th><td><u>#<span data-ppcond="6211">endif</span> /* BGE_DEBUG */</u></td></tr>
<tr><th id="6279">6279</th><td></td></tr>
<tr><th id="6280">6280</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6281">6281</th><td><dfn class="tu decl def fn" id="bge_get_eaddr_fw" title='bge_get_eaddr_fw' data-type='int bge_get_eaddr_fw(struct bge_softc * sc, uint8_t * ether_addr)' data-ref="bge_get_eaddr_fw" data-ref-filename="bge_get_eaddr_fw">bge_get_eaddr_fw</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="448sc" title='sc' data-type='struct bge_softc *' data-ref="448sc" data-ref-filename="448sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col9 decl" id="449ether_addr" title='ether_addr' data-type='uint8_t *' data-ref="449ether_addr" data-ref-filename="449ether_addr">ether_addr</dfn>[])</td></tr>
<tr><th id="6282">6282</th><td>{</td></tr>
<tr><th id="6283">6283</th><td>	<a class="typedef" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_t" title='prop_dictionary_t' data-type='struct _prop_dictionary *' data-ref="prop_dictionary_t" data-ref-filename="prop_dictionary_t">prop_dictionary_t</a> <dfn class="local col0 decl" id="450dict" title='dict' data-type='prop_dictionary_t' data-ref="450dict" data-ref-filename="450dict">dict</dfn>;</td></tr>
<tr><th id="6284">6284</th><td>	<a class="typedef" href="../../../common/include/prop/prop_data.h.html#prop_data_t" title='prop_data_t' data-type='struct _prop_data *' data-ref="prop_data_t" data-ref-filename="prop_data_t">prop_data_t</a> <dfn class="local col1 decl" id="451ea" title='ea' data-type='prop_data_t' data-ref="451ea" data-ref-filename="451ea">ea</dfn>;</td></tr>
<tr><th id="6285">6285</th><td></td></tr>
<tr><th id="6286">6286</th><td>	<b>if</b> ((<a class="local col8 ref" href="#448sc" title='sc' data-ref="448sc" data-ref-filename="448sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_flags" title='bge_softc::bge_flags' data-ref="bge_softc::bge_flags" data-ref-filename="bge_softc..bge_flags">bge_flags</a> &amp; <a class="macro" href="if_bgereg.h.html#2671" title="0x00000200" data-ref="_M/BGEF_NO_EEPROM">BGEF_NO_EEPROM</a>) == <var>0</var>)</td></tr>
<tr><th id="6287">6287</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="6288">6288</th><td></td></tr>
<tr><th id="6289">6289</th><td>	<a class="local col0 ref" href="#450dict" title='dict' data-ref="450dict" data-ref-filename="450dict">dict</a> = <a class="ref fn" href="../../sys/device.h.html#device_properties" title='device_properties' data-ref="device_properties" data-ref-filename="device_properties">device_properties</a>(<a class="local col8 ref" href="#448sc" title='sc' data-ref="448sc" data-ref-filename="448sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_dev" title='bge_softc::bge_dev' data-ref="bge_softc::bge_dev" data-ref-filename="bge_softc..bge_dev">bge_dev</a>);</td></tr>
<tr><th id="6290">6290</th><td>	<a class="local col1 ref" href="#451ea" title='ea' data-ref="451ea" data-ref-filename="451ea">ea</a> = <a class="ref fn" href="../../../common/include/prop/prop_dictionary.h.html#prop_dictionary_get" title='prop_dictionary_get' data-ref="prop_dictionary_get" data-ref-filename="prop_dictionary_get">prop_dictionary_get</a>(<a class="local col0 ref" href="#450dict" title='dict' data-ref="450dict" data-ref-filename="450dict">dict</a>, <q>"mac-address"</q>);</td></tr>
<tr><th id="6291">6291</th><td>	<b>if</b> (<a class="local col1 ref" href="#451ea" title='ea' data-ref="451ea" data-ref-filename="451ea">ea</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="6292">6292</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((prop_object_type(ea) == PROP_TYPE_DATA)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;prop_object_type(ea) == PROP_TYPE_DATA&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 6292))" data-ref="_M/KASSERT">KASSERT</a>(<a class="ref fn" href="../../../common/include/prop/prop_object.h.html#prop_object_type" title='prop_object_type' data-ref="prop_object_type" data-ref-filename="prop_object_type">prop_object_type</a>(<a class="local col1 ref" href="#451ea" title='ea' data-ref="451ea" data-ref-filename="451ea">ea</a>) == <a class="enum" href="../../../common/include/prop/prop_object.h.html#PROP_TYPE_DATA" title='PROP_TYPE_DATA' data-ref="PROP_TYPE_DATA" data-ref-filename="PROP_TYPE_DATA">PROP_TYPE_DATA</a>);</td></tr>
<tr><th id="6293">6293</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#279" title="(__builtin_expect(((prop_data_size(ea) == 6)) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;prop_data_size(ea) == ETHER_ADDR_LEN&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/dev/pci/if_bge.c&quot;, 6293))" data-ref="_M/KASSERT">KASSERT</a>(<a class="ref fn" href="../../../common/include/prop/prop_data.h.html#prop_data_size" title='prop_data_size' data-ref="prop_data_size" data-ref-filename="prop_data_size">prop_data_size</a>(<a class="local col1 ref" href="#451ea" title='ea' data-ref="451ea" data-ref-filename="451ea">ea</a>) == <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>);</td></tr>
<tr><th id="6294">6294</th><td>		<a class="macro" href="../../lib/libkern/libkern.h.html#380" title="__builtin_memcpy(ether_addr, prop_data_data_nocopy(ea), 6)" data-ref="_M/memcpy">memcpy</a>(<a class="local col9 ref" href="#449ether_addr" title='ether_addr' data-ref="449ether_addr" data-ref-filename="449ether_addr">ether_addr</a>, <a class="ref fn" href="../../../common/include/prop/prop_data.h.html#prop_data_data_nocopy" title='prop_data_data_nocopy' data-ref="prop_data_data_nocopy" data-ref-filename="prop_data_data_nocopy">prop_data_data_nocopy</a>(<a class="local col1 ref" href="#451ea" title='ea' data-ref="451ea" data-ref-filename="451ea">ea</a>), <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>);</td></tr>
<tr><th id="6295">6295</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="6296">6296</th><td>	}</td></tr>
<tr><th id="6297">6297</th><td></td></tr>
<tr><th id="6298">6298</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="6299">6299</th><td>}</td></tr>
<tr><th id="6300">6300</th><td></td></tr>
<tr><th id="6301">6301</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6302">6302</th><td><dfn class="tu decl def fn" id="bge_get_eaddr_mem" title='bge_get_eaddr_mem' data-type='int bge_get_eaddr_mem(struct bge_softc * sc, uint8_t * ether_addr)' data-ref="bge_get_eaddr_mem" data-ref-filename="bge_get_eaddr_mem">bge_get_eaddr_mem</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col2 decl" id="452sc" title='sc' data-type='struct bge_softc *' data-ref="452sc" data-ref-filename="452sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col3 decl" id="453ether_addr" title='ether_addr' data-type='uint8_t *' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</dfn>[])</td></tr>
<tr><th id="6303">6303</th><td>{</td></tr>
<tr><th id="6304">6304</th><td>	<a class="typedef" href="../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col4 decl" id="454mac_addr" title='mac_addr' data-type='uint32_t' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</dfn>;</td></tr>
<tr><th id="6305">6305</th><td></td></tr>
<tr><th id="6306">6306</th><td>	<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col2 ref" href="#452sc" title='sc' data-ref="452sc" data-ref-filename="452sc">sc</a>, <a class="macro" href="if_bgereg.h.html#83" title="0x00000C14" data-ref="_M/BGE_SRAM_MAC_ADDR_HIGH_MB">BGE_SRAM_MAC_ADDR_HIGH_MB</a>);</td></tr>
<tr><th id="6307">6307</th><td>	<b>if</b> ((<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> &gt;&gt; <var>16</var>) == <var>0x484b</var>) {</td></tr>
<tr><th id="6308">6308</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>0</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)(<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> &gt;&gt; <var>8</var>);</td></tr>
<tr><th id="6309">6309</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>1</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a>;</td></tr>
<tr><th id="6310">6310</th><td>		<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> = <a class="tu ref fn" href="#bge_readmem_ind" title='bge_readmem_ind' data-use='c' data-ref="bge_readmem_ind" data-ref-filename="bge_readmem_ind">bge_readmem_ind</a>(<a class="local col2 ref" href="#452sc" title='sc' data-ref="452sc" data-ref-filename="452sc">sc</a>, <a class="macro" href="if_bgereg.h.html#84" title="0x00000C18" data-ref="_M/BGE_SRAM_MAC_ADDR_LOW_MB">BGE_SRAM_MAC_ADDR_LOW_MB</a>);</td></tr>
<tr><th id="6311">6311</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>2</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)(<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> &gt;&gt; <var>24</var>);</td></tr>
<tr><th id="6312">6312</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>3</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)(<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> &gt;&gt; <var>16</var>);</td></tr>
<tr><th id="6313">6313</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>4</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)(<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a> &gt;&gt; <var>8</var>);</td></tr>
<tr><th id="6314">6314</th><td>		<a class="local col3 ref" href="#453ether_addr" title='ether_addr' data-ref="453ether_addr" data-ref-filename="453ether_addr">ether_addr</a>[<var>5</var>] = (<a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a>)<a class="local col4 ref" href="#454mac_addr" title='mac_addr' data-ref="454mac_addr" data-ref-filename="454mac_addr">mac_addr</a>;</td></tr>
<tr><th id="6315">6315</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="6316">6316</th><td>	}</td></tr>
<tr><th id="6317">6317</th><td>	<b>return</b> <var>1</var>;</td></tr>
<tr><th id="6318">6318</th><td>}</td></tr>
<tr><th id="6319">6319</th><td></td></tr>
<tr><th id="6320">6320</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6321">6321</th><td><dfn class="tu decl def fn" id="bge_get_eaddr_nvram" title='bge_get_eaddr_nvram' data-type='int bge_get_eaddr_nvram(struct bge_softc * sc, uint8_t * ether_addr)' data-ref="bge_get_eaddr_nvram" data-ref-filename="bge_get_eaddr_nvram">bge_get_eaddr_nvram</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col5 decl" id="455sc" title='sc' data-type='struct bge_softc *' data-ref="455sc" data-ref-filename="455sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col6 decl" id="456ether_addr" title='ether_addr' data-type='uint8_t *' data-ref="456ether_addr" data-ref-filename="456ether_addr">ether_addr</dfn>[])</td></tr>
<tr><th id="6322">6322</th><td>{</td></tr>
<tr><th id="6323">6323</th><td>	<em>int</em> <dfn class="local col7 decl" id="457mac_offset" title='mac_offset' data-type='int' data-ref="457mac_offset" data-ref-filename="457mac_offset">mac_offset</dfn> = <a class="macro" href="if_bgereg.h.html#2416" title="0x7C" data-ref="_M/BGE_EE_MAC_OFFSET">BGE_EE_MAC_OFFSET</a>;</td></tr>
<tr><th id="6324">6324</th><td></td></tr>
<tr><th id="6325">6325</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col5 ref" href="#455sc" title='sc' data-ref="455sc" data-ref-filename="455sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="6326">6326</th><td>		<a class="local col7 ref" href="#457mac_offset" title='mac_offset' data-ref="457mac_offset" data-ref-filename="457mac_offset">mac_offset</a> = <a class="macro" href="if_bgereg.h.html#2417" title="0x10" data-ref="_M/BGE_EE_MAC_OFFSET_5906">BGE_EE_MAC_OFFSET_5906</a>;</td></tr>
<tr><th id="6327">6327</th><td></td></tr>
<tr><th id="6328">6328</th><td>	<b>return</b> (<a class="tu ref fn" href="#bge_read_nvram" title='bge_read_nvram' data-use='c' data-ref="bge_read_nvram" data-ref-filename="bge_read_nvram">bge_read_nvram</a>(<a class="local col5 ref" href="#455sc" title='sc' data-ref="455sc" data-ref-filename="455sc">sc</a>, <a class="local col6 ref" href="#456ether_addr" title='ether_addr' data-ref="456ether_addr" data-ref-filename="456ether_addr">ether_addr</a>, <a class="local col7 ref" href="#457mac_offset" title='mac_offset' data-ref="457mac_offset" data-ref-filename="457mac_offset">mac_offset</a> + <var>2</var>,</td></tr>
<tr><th id="6329">6329</th><td>	    <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>));</td></tr>
<tr><th id="6330">6330</th><td>}</td></tr>
<tr><th id="6331">6331</th><td></td></tr>
<tr><th id="6332">6332</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6333">6333</th><td><dfn class="tu decl def fn" id="bge_get_eaddr_eeprom" title='bge_get_eaddr_eeprom' data-type='int bge_get_eaddr_eeprom(struct bge_softc * sc, uint8_t * ether_addr)' data-ref="bge_get_eaddr_eeprom" data-ref-filename="bge_get_eaddr_eeprom">bge_get_eaddr_eeprom</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col8 decl" id="458sc" title='sc' data-type='struct bge_softc *' data-ref="458sc" data-ref-filename="458sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col9 decl" id="459ether_addr" title='ether_addr' data-type='uint8_t *' data-ref="459ether_addr" data-ref-filename="459ether_addr">ether_addr</dfn>[])</td></tr>
<tr><th id="6334">6334</th><td>{</td></tr>
<tr><th id="6335">6335</th><td></td></tr>
<tr><th id="6336">6336</th><td>	<b>if</b> (<a class="macro" href="if_bgereg.h.html#356" title="((sc-&gt;bge_chipid) &gt;&gt; 12)" data-ref="_M/BGE_ASICREV">BGE_ASICREV</a>(<a class="local col8 ref" href="#458sc" title='sc' data-ref="458sc" data-ref-filename="458sc">sc</a>-&gt;<a class="ref field" href="if_bgevar.h.html#bge_softc::bge_chipid" title='bge_softc::bge_chipid' data-ref="bge_softc::bge_chipid" data-ref-filename="bge_softc..bge_chipid">bge_chipid</a>) == <a class="macro" href="if_bgereg.h.html#370" title="0x0c" data-ref="_M/BGE_ASICREV_BCM5906">BGE_ASICREV_BCM5906</a>)</td></tr>
<tr><th id="6337">6337</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="6338">6338</th><td></td></tr>
<tr><th id="6339">6339</th><td>	<b>return</b> (<a class="tu ref fn" href="#bge_read_eeprom" title='bge_read_eeprom' data-use='c' data-ref="bge_read_eeprom" data-ref-filename="bge_read_eeprom">bge_read_eeprom</a>(<a class="local col8 ref" href="#458sc" title='sc' data-ref="458sc" data-ref-filename="458sc">sc</a>, <a class="local col9 ref" href="#459ether_addr" title='ether_addr' data-ref="459ether_addr" data-ref-filename="459ether_addr">ether_addr</a>, <a class="macro" href="if_bgereg.h.html#2416" title="0x7C" data-ref="_M/BGE_EE_MAC_OFFSET">BGE_EE_MAC_OFFSET</a> + <var>2</var>,</td></tr>
<tr><th id="6340">6340</th><td>	   <a class="macro" href="../../net/if_ether.h.html#51" title="6" data-ref="_M/ETHER_ADDR_LEN">ETHER_ADDR_LEN</a>));</td></tr>
<tr><th id="6341">6341</th><td>}</td></tr>
<tr><th id="6342">6342</th><td></td></tr>
<tr><th id="6343">6343</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="6344">6344</th><td><dfn class="tu decl def fn" id="bge_get_eaddr" title='bge_get_eaddr' data-type='int bge_get_eaddr(struct bge_softc * sc, uint8_t * eaddr)' data-ref="bge_get_eaddr" data-ref-filename="bge_get_eaddr">bge_get_eaddr</dfn>(<b>struct</b> <a class="type" href="if_bgevar.h.html#bge_softc" title='bge_softc' data-ref="bge_softc" data-ref-filename="bge_softc">bge_softc</a> *<dfn class="local col0 decl" id="460sc" title='sc' data-type='struct bge_softc *' data-ref="460sc" data-ref-filename="460sc">sc</dfn>, <a class="typedef" href="../../sys/stdint.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> <dfn class="local col1 decl" id="461eaddr" title='eaddr' data-type='uint8_t *' data-ref="461eaddr" data-ref-filename="461eaddr">eaddr</dfn>[])</td></tr>
<tr><th id="6345">6345</th><td>{</td></tr>
<tr><th id="6346">6346</th><td>	<em>static</em> <em>const</em> <a class="typedef" href="#bge_eaddr_fcn_t" title='bge_eaddr_fcn_t' data-type='int (*)(struct bge_softc *, uint8_t *)' data-ref="bge_eaddr_fcn_t" data-ref-filename="bge_eaddr_fcn_t">bge_eaddr_fcn_t</a> <dfn class="local col2 decl" id="462bge_eaddr_funcs" title='bge_eaddr_funcs' data-type='const bge_eaddr_fcn_t [5]' data-ref="462bge_eaddr_funcs" data-ref-filename="462bge_eaddr_funcs">bge_eaddr_funcs</dfn>[] = {</td></tr>
<tr><th id="6347">6347</th><td>		<i>/* NOTE: Order is critical */</i></td></tr>
<tr><th id="6348">6348</th><td>		<a class="tu ref fn" href="#bge_get_eaddr_fw" title='bge_get_eaddr_fw' data-use='r' data-ref="bge_get_eaddr_fw" data-ref-filename="bge_get_eaddr_fw">bge_get_eaddr_fw</a>,</td></tr>
<tr><th id="6349">6349</th><td>		<a class="tu ref fn" href="#bge_get_eaddr_mem" title='bge_get_eaddr_mem' data-use='r' data-ref="bge_get_eaddr_mem" data-ref-filename="bge_get_eaddr_mem">bge_get_eaddr_mem</a>,</td></tr>
<tr><th id="6350">6350</th><td>		<a class="tu ref fn" href="#bge_get_eaddr_nvram" title='bge_get_eaddr_nvram' data-use='r' data-ref="bge_get_eaddr_nvram" data-ref-filename="bge_get_eaddr_nvram">bge_get_eaddr_nvram</a>,</td></tr>
<tr><th id="6351">6351</th><td>		<a class="tu ref fn" href="#bge_get_eaddr_eeprom" title='bge_get_eaddr_eeprom' data-use='r' data-ref="bge_get_eaddr_eeprom" data-ref-filename="bge_get_eaddr_eeprom">bge_get_eaddr_eeprom</a>,</td></tr>
<tr><th id="6352">6352</th><td>		<a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a></td></tr>
<tr><th id="6353">6353</th><td>	};</td></tr>
<tr><th id="6354">6354</th><td>	<em>const</em> <a class="typedef" href="#bge_eaddr_fcn_t" title='bge_eaddr_fcn_t' data-type='int (*)(struct bge_softc *, uint8_t *)' data-ref="bge_eaddr_fcn_t" data-ref-filename="bge_eaddr_fcn_t">bge_eaddr_fcn_t</a> *<dfn class="local col3 decl" id="463func" title='func' data-type='const bge_eaddr_fcn_t *' data-ref="463func" data-ref-filename="463func">func</dfn>;</td></tr>
<tr><th id="6355">6355</th><td></td></tr>
<tr><th id="6356">6356</th><td>	<b>for</b> (<a class="local col3 ref" href="#463func" title='func' data-ref="463func" data-ref-filename="463func">func</a> = <a class="local col2 ref" href="#462bge_eaddr_funcs" title='bge_eaddr_funcs' data-ref="462bge_eaddr_funcs" data-ref-filename="462bge_eaddr_funcs">bge_eaddr_funcs</a>; *<a class="local col3 ref" href="#463func" title='func' data-ref="463func" data-ref-filename="463func">func</a> != <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>; ++<a class="local col3 ref" href="#463func" title='func' data-ref="463func" data-ref-filename="463func">func</a>) {</td></tr>
<tr><th id="6357">6357</th><td>		<b>if</b> ((*<a class="local col3 ref" href="#463func" title='func' data-ref="463func" data-ref-filename="463func">func</a>)(<a class="local col0 ref" href="#460sc" title='sc' data-ref="460sc" data-ref-filename="460sc">sc</a>, <a class="local col1 ref" href="#461eaddr" title='eaddr' data-ref="461eaddr" data-ref-filename="461eaddr">eaddr</a>) == <var>0</var>)</td></tr>
<tr><th id="6358">6358</th><td>			<b>break</b>;</td></tr>
<tr><th id="6359">6359</th><td>	}</td></tr>
<tr><th id="6360">6360</th><td>	<b>return</b> (*<a class="local col3 ref" href="#463func" title='func' data-ref="463func" data-ref-filename="463func">func</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> ? <a class="macro" href="../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a> : <var>0</var>);</td></tr>
<tr><th id="6361">6361</th><td>}</td></tr>
<tr><th id="6362">6362</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
