<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>rf_diskqueue.c source code [netbsd/sys/dev/raidframe/rf_diskqueue.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/sys/dev/raidframe/rf_diskqueue.c'; var root_path = '../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>netbsd</a>/<a href='../..'>sys</a>/<a href='..'>dev</a>/<a href='./'>raidframe</a>/<a href='rf_diskqueue.c.html'>rf_diskqueue.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: rf_diskqueue.c,v 1.55 2019/02/10 17:13:33 christos Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td><i>/*</i></td></tr>
<tr><th id="3">3</th><td><i> * Copyright (c) 1995 Carnegie-Mellon University.</i></td></tr>
<tr><th id="4">4</th><td><i> * All rights reserved.</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Author: Mark Holland</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * Permission to use, copy, modify and distribute this software and</i></td></tr>
<tr><th id="9">9</th><td><i> * its documentation is hereby granted, provided that both the copyright</i></td></tr>
<tr><th id="10">10</th><td><i> * notice and this permission notice appear in all copies of the</i></td></tr>
<tr><th id="11">11</th><td><i> * software, derivative works or modified versions, and any portions</i></td></tr>
<tr><th id="12">12</th><td><i> * thereof, and that both notices appear in supporting documentation.</i></td></tr>
<tr><th id="13">13</th><td><i> *</i></td></tr>
<tr><th id="14">14</th><td><i> * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"</i></td></tr>
<tr><th id="15">15</th><td><i> * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND</i></td></tr>
<tr><th id="16">16</th><td><i> * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.</i></td></tr>
<tr><th id="17">17</th><td><i> *</i></td></tr>
<tr><th id="18">18</th><td><i> * Carnegie Mellon requests users of this software to return to</i></td></tr>
<tr><th id="19">19</th><td><i> *</i></td></tr>
<tr><th id="20">20</th><td><i> *  Software Distribution Coordinator  or  Software.Distribution@CS.CMU.EDU</i></td></tr>
<tr><th id="21">21</th><td><i> *  School of Computer Science</i></td></tr>
<tr><th id="22">22</th><td><i> *  Carnegie Mellon University</i></td></tr>
<tr><th id="23">23</th><td><i> *  Pittsburgh PA 15213-3890</i></td></tr>
<tr><th id="24">24</th><td><i> *</i></td></tr>
<tr><th id="25">25</th><td><i> * any improvements or extensions that they make and grant Carnegie the</i></td></tr>
<tr><th id="26">26</th><td><i> * rights to redistribute these changes.</i></td></tr>
<tr><th id="27">27</th><td><i> */</i></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><i>/****************************************************************************</i></td></tr>
<tr><th id="30">30</th><td><i> *</i></td></tr>
<tr><th id="31">31</th><td><i> * rf_diskqueue.c -- higher-level disk queue code</i></td></tr>
<tr><th id="32">32</th><td><i> *</i></td></tr>
<tr><th id="33">33</th><td><i> * the routines here are a generic wrapper around the actual queueing</i></td></tr>
<tr><th id="34">34</th><td><i> * routines.  The code here implements thread scheduling, synchronization,</i></td></tr>
<tr><th id="35">35</th><td><i> * and locking ops (see below) on top of the lower-level queueing code.</i></td></tr>
<tr><th id="36">36</th><td><i> *</i></td></tr>
<tr><th id="37">37</th><td><i> * to support atomic RMW, we implement "locking operations".  When a</i></td></tr>
<tr><th id="38">38</th><td><i> * locking op is dispatched to the lower levels of the driver, the</i></td></tr>
<tr><th id="39">39</th><td><i> * queue is locked, and no further I/Os are dispatched until the queue</i></td></tr>
<tr><th id="40">40</th><td><i> * receives &amp; completes a corresponding "unlocking operation".  This</i></td></tr>
<tr><th id="41">41</th><td><i> * code relies on the higher layers to guarantee that a locking op</i></td></tr>
<tr><th id="42">42</th><td><i> * will always be eventually followed by an unlocking op.  The model</i></td></tr>
<tr><th id="43">43</th><td><i> * is that the higher layers are structured so locking and unlocking</i></td></tr>
<tr><th id="44">44</th><td><i> * ops occur in pairs, i.e.  an unlocking op cannot be generated until</i></td></tr>
<tr><th id="45">45</th><td><i> * after a locking op reports completion.  There is no good way to</i></td></tr>
<tr><th id="46">46</th><td><i> * check to see that an unlocking op "corresponds" to the op that</i></td></tr>
<tr><th id="47">47</th><td><i> * currently has the queue locked, so we make no such attempt.  Since</i></td></tr>
<tr><th id="48">48</th><td><i> * by definition there can be only one locking op outstanding on a</i></td></tr>
<tr><th id="49">49</th><td><i> * disk, this should not be a problem.</i></td></tr>
<tr><th id="50">50</th><td><i> *</i></td></tr>
<tr><th id="51">51</th><td><i> * In the kernel, we allow multiple I/Os to be concurrently dispatched</i></td></tr>
<tr><th id="52">52</th><td><i> * to the disk driver.  In order to support locking ops in this</i></td></tr>
<tr><th id="53">53</th><td><i> * environment, when we decide to do a locking op, we stop dispatching</i></td></tr>
<tr><th id="54">54</th><td><i> * new I/Os and wait until all dispatched I/Os have completed before</i></td></tr>
<tr><th id="55">55</th><td><i> * dispatching the locking op.</i></td></tr>
<tr><th id="56">56</th><td><i> *</i></td></tr>
<tr><th id="57">57</th><td><i> * Unfortunately, the code is different in the 3 different operating</i></td></tr>
<tr><th id="58">58</th><td><i> * states (user level, kernel, simulator).  In the kernel, I/O is</i></td></tr>
<tr><th id="59">59</th><td><i> * non-blocking, and we have no disk threads to dispatch for us.</i></td></tr>
<tr><th id="60">60</th><td><i> * Therefore, we have to dispatch new I/Os to the scsi driver at the</i></td></tr>
<tr><th id="61">61</th><td><i> * time of enqueue, and also at the time of completion.  At user</i></td></tr>
<tr><th id="62">62</th><td><i> * level, I/O is blocking, and so only the disk threads may dispatch</i></td></tr>
<tr><th id="63">63</th><td><i> * I/Os.  Thus at user level, all we can do at enqueue time is enqueue</i></td></tr>
<tr><th id="64">64</th><td><i> * and wake up the disk thread to do the dispatch.</i></td></tr>
<tr><th id="65">65</th><td><i> *</i></td></tr>
<tr><th id="66">66</th><td><i> ****************************************************************************/</i></td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><u>#include <a href="../../sys/cdefs.h.html">&lt;sys/cdefs.h&gt;</a></u></td></tr>
<tr><th id="69">69</th><td><a class="macro" href="../../sys/cdefs_elf.h.html#156" title="__asm(&quot;.pushsection &quot; &quot;.ident&quot; &quot;\n&quot; &quot;.asciz \&quot;&quot; &quot;$NetBSD: rf_diskqueue.c,v 1.55 2019/02/10 17:13:33 christos Exp $&quot; &quot;\&quot;\n&quot; &quot;.popsection&quot;)" data-ref="_M/__KERNEL_RCSID">__KERNEL_RCSID</a>(<var>0</var>, <q>"$NetBSD: rf_diskqueue.c,v 1.55 2019/02/10 17:13:33 christos Exp $"</q>);</td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td><u>#include <a href="raidframevar.h.html">&lt;dev/raidframe/raidframevar.h&gt;</a></u></td></tr>
<tr><th id="72">72</th><td></td></tr>
<tr><th id="73">73</th><td><u>#include <a href="rf_threadstuff.h.html">"rf_threadstuff.h"</a></u></td></tr>
<tr><th id="74">74</th><td><u>#include <a href="rf_raid.h.html">"rf_raid.h"</a></u></td></tr>
<tr><th id="75">75</th><td><u>#include <a href="rf_diskqueue.h.html">"rf_diskqueue.h"</a></u></td></tr>
<tr><th id="76">76</th><td><u>#include <a href="rf_alloclist.h.html">"rf_alloclist.h"</a></u></td></tr>
<tr><th id="77">77</th><td><u>#include <a href="rf_acctrace.h.html">"rf_acctrace.h"</a></u></td></tr>
<tr><th id="78">78</th><td><u>#include <a href="rf_etimer.h.html">"rf_etimer.h"</a></u></td></tr>
<tr><th id="79">79</th><td><u>#include <a href="rf_general.h.html">"rf_general.h"</a></u></td></tr>
<tr><th id="80">80</th><td><u>#include <a href="rf_debugprint.h.html">"rf_debugprint.h"</a></u></td></tr>
<tr><th id="81">81</th><td><u>#include <a href="rf_shutdown.h.html">"rf_shutdown.h"</a></u></td></tr>
<tr><th id="82">82</th><td><u>#include <a href="rf_cvscan.h.html">"rf_cvscan.h"</a></u></td></tr>
<tr><th id="83">83</th><td><u>#include <a href="rf_sstf.h.html">"rf_sstf.h"</a></u></td></tr>
<tr><th id="84">84</th><td><u>#include <a href="rf_fifo.h.html">"rf_fifo.h"</a></u></td></tr>
<tr><th id="85">85</th><td><u>#include <a href="rf_kintf.h.html">"rf_kintf.h"</a></u></td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#rf_ShutdownDiskQueueSystem" title='rf_ShutdownDiskQueueSystem' data-type='void rf_ShutdownDiskQueueSystem(void * )' data-ref="rf_ShutdownDiskQueueSystem" data-ref-filename="rf_ShutdownDiskQueueSystem">rf_ShutdownDiskQueueSystem</a>(<em>void</em> *);</td></tr>
<tr><th id="88">88</th><td></td></tr>
<tr><th id="89">89</th><td><u>#<span data-ppcond="89">ifndef</span> <span class="macro" data-ref="_M/RF_DEBUG_DISKQUEUE">RF_DEBUG_DISKQUEUE</span></u></td></tr>
<tr><th id="90">90</th><td><u>#define <dfn class="macro" id="_M/RF_DEBUG_DISKQUEUE" data-ref="_M/RF_DEBUG_DISKQUEUE">RF_DEBUG_DISKQUEUE</dfn> 0</u></td></tr>
<tr><th id="91">91</th><td><u>#<span data-ppcond="89">endif</span></u></td></tr>
<tr><th id="92">92</th><td></td></tr>
<tr><th id="93">93</th><td><u>#<span data-ppcond="93">if</span> <a class="macro" href="#90" title="0" data-ref="_M/RF_DEBUG_DISKQUEUE">RF_DEBUG_DISKQUEUE</a></u></td></tr>
<tr><th id="94">94</th><td><u>#define Dprintf1(s,a)         if (rf_queueDebug) rf_debug_printf(s,(void *)((unsigned long)a),NULL,NULL,NULL,NULL,NULL,NULL,NULL)</u></td></tr>
<tr><th id="95">95</th><td><u>#define Dprintf2(s,a,b)       if (rf_queueDebug) rf_debug_printf(s,(void *)((unsigned long)a),(void *)((unsigned long)b),NULL,NULL,NULL,NULL,NULL,NULL)</u></td></tr>
<tr><th id="96">96</th><td><u>#define Dprintf3(s,a,b,c)     if (rf_queueDebug) rf_debug_printf(s,(void *)((unsigned long)a),(void *)((unsigned long)b),(void *)((unsigned long)c),NULL,NULL,NULL,NULL,NULL)</u></td></tr>
<tr><th id="97">97</th><td><u>#<span data-ppcond="93">else</span></u></td></tr>
<tr><th id="98">98</th><td><u>#define <dfn class="macro" id="_M/Dprintf1" data-ref="_M/Dprintf1">Dprintf1</dfn>(s,a)</u></td></tr>
<tr><th id="99">99</th><td><u>#define <dfn class="macro" id="_M/Dprintf2" data-ref="_M/Dprintf2">Dprintf2</dfn>(s,a,b)</u></td></tr>
<tr><th id="100">100</th><td><u>#define <dfn class="macro" id="_M/Dprintf3" data-ref="_M/Dprintf3">Dprintf3</dfn>(s,a,b,c)</u></td></tr>
<tr><th id="101">101</th><td><u>#<span data-ppcond="93">endif</span></u></td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><i  data-doc="diskqueuesw">/*****************************************************************************</i></td></tr>
<tr><th id="104">104</th><td><i  data-doc="diskqueuesw"> *</i></td></tr>
<tr><th id="105">105</th><td><i  data-doc="diskqueuesw"> * the disk queue switch defines all the functions used in the</i></td></tr>
<tr><th id="106">106</th><td><i  data-doc="diskqueuesw"> * different queueing disciplines queue ID, init routine, enqueue</i></td></tr>
<tr><th id="107">107</th><td><i  data-doc="diskqueuesw"> * routine, dequeue routine</i></td></tr>
<tr><th id="108">108</th><td><i  data-doc="diskqueuesw"> *</i></td></tr>
<tr><th id="109">109</th><td><i  data-doc="diskqueuesw"> ****************************************************************************/</i></td></tr>
<tr><th id="110">110</th><td></td></tr>
<tr><th id="111">111</th><td><em>static</em> <em>const</em> <a class="typedef" href="raidframevar.h.html#RF_DiskQueueSW_t" title='RF_DiskQueueSW_t' data-type='struct RF_DiskQueueSW_s' data-ref="RF_DiskQueueSW_t" data-ref-filename="RF_DiskQueueSW_t">RF_DiskQueueSW_t</a> <dfn class="tu decl def" id="diskqueuesw" title='diskqueuesw' data-type='const RF_DiskQueueSW_t [5]' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</dfn>[] = {</td></tr>
<tr><th id="112">112</th><td>	{<q>"fifo"</q>,		<i>/* FIFO */</i></td></tr>
<tr><th id="113">113</th><td>		<a class="ref fn" href="rf_fifo.h.html#rf_FifoCreate" title='rf_FifoCreate' data-ref="rf_FifoCreate" data-ref-filename="rf_FifoCreate">rf_FifoCreate</a>,</td></tr>
<tr><th id="114">114</th><td>		<a class="ref fn" href="rf_fifo.h.html#rf_FifoEnqueue" title='rf_FifoEnqueue' data-ref="rf_FifoEnqueue" data-ref-filename="rf_FifoEnqueue">rf_FifoEnqueue</a>,</td></tr>
<tr><th id="115">115</th><td>		<a class="ref fn" href="rf_fifo.h.html#rf_FifoDequeue" title='rf_FifoDequeue' data-ref="rf_FifoDequeue" data-ref-filename="rf_FifoDequeue">rf_FifoDequeue</a>,</td></tr>
<tr><th id="116">116</th><td>		<a class="ref fn" href="rf_fifo.h.html#rf_FifoPeek" title='rf_FifoPeek' data-ref="rf_FifoPeek" data-ref-filename="rf_FifoPeek">rf_FifoPeek</a>,</td></tr>
<tr><th id="117">117</th><td>	<a class="ref fn" href="rf_fifo.h.html#rf_FifoPromote" title='rf_FifoPromote' data-ref="rf_FifoPromote" data-ref-filename="rf_FifoPromote">rf_FifoPromote</a>},</td></tr>
<tr><th id="118">118</th><td></td></tr>
<tr><th id="119">119</th><td>	{<q>"cvscan"</q>,		<i>/* cvscan */</i></td></tr>
<tr><th id="120">120</th><td>		<a class="ref fn" href="rf_cvscan.h.html#rf_CvscanCreate" title='rf_CvscanCreate' data-ref="rf_CvscanCreate" data-ref-filename="rf_CvscanCreate">rf_CvscanCreate</a>,</td></tr>
<tr><th id="121">121</th><td>		<a class="ref fn" href="rf_cvscan.h.html#rf_CvscanEnqueue" title='rf_CvscanEnqueue' data-ref="rf_CvscanEnqueue" data-ref-filename="rf_CvscanEnqueue">rf_CvscanEnqueue</a>,</td></tr>
<tr><th id="122">122</th><td>		<a class="ref fn" href="rf_cvscan.h.html#rf_CvscanDequeue" title='rf_CvscanDequeue' data-ref="rf_CvscanDequeue" data-ref-filename="rf_CvscanDequeue">rf_CvscanDequeue</a>,</td></tr>
<tr><th id="123">123</th><td>		<a class="ref fn" href="rf_cvscan.h.html#rf_CvscanPeek" title='rf_CvscanPeek' data-ref="rf_CvscanPeek" data-ref-filename="rf_CvscanPeek">rf_CvscanPeek</a>,</td></tr>
<tr><th id="124">124</th><td>	<a class="ref fn" href="rf_cvscan.h.html#rf_CvscanPromote" title='rf_CvscanPromote' data-ref="rf_CvscanPromote" data-ref-filename="rf_CvscanPromote">rf_CvscanPromote</a>},</td></tr>
<tr><th id="125">125</th><td></td></tr>
<tr><th id="126">126</th><td>	{<q>"sstf"</q>,		<i>/* shortest seek time first */</i></td></tr>
<tr><th id="127">127</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfCreate" title='rf_SstfCreate' data-ref="rf_SstfCreate" data-ref-filename="rf_SstfCreate">rf_SstfCreate</a>,</td></tr>
<tr><th id="128">128</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfEnqueue" title='rf_SstfEnqueue' data-ref="rf_SstfEnqueue" data-ref-filename="rf_SstfEnqueue">rf_SstfEnqueue</a>,</td></tr>
<tr><th id="129">129</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfDequeue" title='rf_SstfDequeue' data-ref="rf_SstfDequeue" data-ref-filename="rf_SstfDequeue">rf_SstfDequeue</a>,</td></tr>
<tr><th id="130">130</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfPeek" title='rf_SstfPeek' data-ref="rf_SstfPeek" data-ref-filename="rf_SstfPeek">rf_SstfPeek</a>,</td></tr>
<tr><th id="131">131</th><td>	<a class="ref fn" href="rf_sstf.h.html#rf_SstfPromote" title='rf_SstfPromote' data-ref="rf_SstfPromote" data-ref-filename="rf_SstfPromote">rf_SstfPromote</a>},</td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td>	{<q>"scan"</q>,		<i>/* SCAN (two-way elevator) */</i></td></tr>
<tr><th id="134">134</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_ScanCreate" title='rf_ScanCreate' data-ref="rf_ScanCreate" data-ref-filename="rf_ScanCreate">rf_ScanCreate</a>,</td></tr>
<tr><th id="135">135</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfEnqueue" title='rf_SstfEnqueue' data-ref="rf_SstfEnqueue" data-ref-filename="rf_SstfEnqueue">rf_SstfEnqueue</a>,</td></tr>
<tr><th id="136">136</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_ScanDequeue" title='rf_ScanDequeue' data-ref="rf_ScanDequeue" data-ref-filename="rf_ScanDequeue">rf_ScanDequeue</a>,</td></tr>
<tr><th id="137">137</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_ScanPeek" title='rf_ScanPeek' data-ref="rf_ScanPeek" data-ref-filename="rf_ScanPeek">rf_ScanPeek</a>,</td></tr>
<tr><th id="138">138</th><td>	<a class="ref fn" href="rf_sstf.h.html#rf_SstfPromote" title='rf_SstfPromote' data-ref="rf_SstfPromote" data-ref-filename="rf_SstfPromote">rf_SstfPromote</a>},</td></tr>
<tr><th id="139">139</th><td></td></tr>
<tr><th id="140">140</th><td>	{<q>"cscan"</q>,		<i>/* CSCAN (one-way elevator) */</i></td></tr>
<tr><th id="141">141</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_CscanCreate" title='rf_CscanCreate' data-ref="rf_CscanCreate" data-ref-filename="rf_CscanCreate">rf_CscanCreate</a>,</td></tr>
<tr><th id="142">142</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_SstfEnqueue" title='rf_SstfEnqueue' data-ref="rf_SstfEnqueue" data-ref-filename="rf_SstfEnqueue">rf_SstfEnqueue</a>,</td></tr>
<tr><th id="143">143</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_CscanDequeue" title='rf_CscanDequeue' data-ref="rf_CscanDequeue" data-ref-filename="rf_CscanDequeue">rf_CscanDequeue</a>,</td></tr>
<tr><th id="144">144</th><td>		<a class="ref fn" href="rf_sstf.h.html#rf_CscanPeek" title='rf_CscanPeek' data-ref="rf_CscanPeek" data-ref-filename="rf_CscanPeek">rf_CscanPeek</a>,</td></tr>
<tr><th id="145">145</th><td>	<a class="ref fn" href="rf_sstf.h.html#rf_SstfPromote" title='rf_SstfPromote' data-ref="rf_SstfPromote" data-ref-filename="rf_SstfPromote">rf_SstfPromote</a>},</td></tr>
<tr><th id="146">146</th><td></td></tr>
<tr><th id="147">147</th><td>};</td></tr>
<tr><th id="148">148</th><td><u>#define <dfn class="macro" id="_M/NUM_DISK_QUEUE_TYPES" data-ref="_M/NUM_DISK_QUEUE_TYPES">NUM_DISK_QUEUE_TYPES</dfn> (sizeof(<a class="tu ref" href="#diskqueuesw" title='diskqueuesw' data-use='r' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</a>)/sizeof(<a class="typedef" href="raidframevar.h.html#RF_DiskQueueSW_t" title='RF_DiskQueueSW_t' data-type='struct RF_DiskQueueSW_s' data-ref="RF_DiskQueueSW_t" data-ref-filename="RF_DiskQueueSW_t">RF_DiskQueueSW_t</a>))</u></td></tr>
<tr><th id="149">149</th><td></td></tr>
<tr><th id="150">150</th><td><u>#define <dfn class="macro" id="_M/RF_MAX_FREE_DQD" data-ref="_M/RF_MAX_FREE_DQD">RF_MAX_FREE_DQD</dfn> 256</u></td></tr>
<tr><th id="151">151</th><td><u>#define <dfn class="macro" id="_M/RF_MIN_FREE_DQD" data-ref="_M/RF_MIN_FREE_DQD">RF_MIN_FREE_DQD</dfn>  64</u></td></tr>
<tr><th id="152">152</th><td></td></tr>
<tr><th id="153">153</th><td><u>#include <a href="../../sys/buf.h.html">&lt;sys/buf.h&gt;</a></u></td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td><i  data-doc="rf_ShutdownDiskQueue">/* configures a single disk queue */</i></td></tr>
<tr><th id="156">156</th><td></td></tr>
<tr><th id="157">157</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="158">158</th><td><dfn class="tu decl def fn" id="rf_ShutdownDiskQueue" title='rf_ShutdownDiskQueue' data-type='void rf_ShutdownDiskQueue(void * arg)' data-ref="rf_ShutdownDiskQueue" data-ref-filename="rf_ShutdownDiskQueue">rf_ShutdownDiskQueue</dfn>(<em>void</em> *<dfn class="local col2 decl" id="22arg" title='arg' data-type='void *' data-ref="22arg" data-ref-filename="22arg">arg</dfn>)</td></tr>
<tr><th id="159">159</th><td>{</td></tr>
<tr><th id="160">160</th><td>	<a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col3 decl" id="23diskqueue" title='diskqueue' data-type='RF_DiskQueue_t *' data-ref="23diskqueue" data-ref-filename="23diskqueue">diskqueue</dfn> = <a class="local col2 ref" href="#22arg" title='arg' data-ref="22arg" data-ref-filename="22arg">arg</a>;</td></tr>
<tr><th id="161">161</th><td></td></tr>
<tr><th id="162">162</th><td>	<a class="macro" href="rf_threadstuff.h.html#66" title="mutex_destroy(&amp;(diskqueue-&gt;mutex))" data-ref="_M/rf_destroy_mutex2">rf_destroy_mutex2</a>(<a class="local col3 ref" href="#23diskqueue" title='diskqueue' data-ref="23diskqueue" data-ref-filename="23diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#105" title='RF_DiskQueue_s::mutex' data-ref="RF_DiskQueue_s::mutex" data-ref-filename="RF_DiskQueue_s..mutex">mutex</a>);</td></tr>
<tr><th id="163">163</th><td>}</td></tr>
<tr><th id="164">164</th><td></td></tr>
<tr><th id="165">165</th><td><em>int</em></td></tr>
<tr><th id="166">166</th><td><dfn class="decl def fn" id="rf_ConfigureDiskQueue" title='rf_ConfigureDiskQueue' data-ref="rf_ConfigureDiskQueue" data-ref-filename="rf_ConfigureDiskQueue">rf_ConfigureDiskQueue</dfn>(<a class="typedef" href="raidframevar.h.html#RF_Raid_t" title='RF_Raid_t' data-type='struct RF_Raid_s' data-ref="RF_Raid_t" data-ref-filename="RF_Raid_t">RF_Raid_t</a> *<dfn class="local col4 decl" id="24raidPtr" title='raidPtr' data-type='RF_Raid_t *' data-ref="24raidPtr" data-ref-filename="24raidPtr">raidPtr</dfn>, <a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col5 decl" id="25diskqueue" title='diskqueue' data-type='RF_DiskQueue_t *' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</dfn>,</td></tr>
<tr><th id="167">167</th><td>		      <a class="typedef" href="raidframevar.h.html#RF_RowCol_t" title='RF_RowCol_t' data-type='int' data-ref="RF_RowCol_t" data-ref-filename="RF_RowCol_t">RF_RowCol_t</a> <dfn class="local col6 decl" id="26c" title='c' data-type='RF_RowCol_t' data-ref="26c" data-ref-filename="26c">c</dfn>, <em>const</em> <a class="typedef" href="raidframevar.h.html#RF_DiskQueueSW_t" title='RF_DiskQueueSW_t' data-type='struct RF_DiskQueueSW_s' data-ref="RF_DiskQueueSW_t" data-ref-filename="RF_DiskQueueSW_t">RF_DiskQueueSW_t</a> *<dfn class="local col7 decl" id="27p" title='p' data-type='const RF_DiskQueueSW_t *' data-ref="27p" data-ref-filename="27p">p</dfn>,</td></tr>
<tr><th id="168">168</th><td>		      <a class="typedef" href="raidframevar.h.html#RF_SectorCount_t" title='RF_SectorCount_t' data-type='RF_uint64' data-ref="RF_SectorCount_t" data-ref-filename="RF_SectorCount_t">RF_SectorCount_t</a> <dfn class="local col8 decl" id="28sectPerDisk" title='sectPerDisk' data-type='RF_SectorCount_t' data-ref="28sectPerDisk" data-ref-filename="28sectPerDisk">sectPerDisk</dfn>, <a class="typedef" href="../../sys/types.h.html#dev_t" title='dev_t' data-type='uint64_t' data-ref="dev_t" data-ref-filename="dev_t">dev_t</a> <dfn class="local col9 decl" id="29dev" title='dev' data-type='dev_t' data-ref="29dev" data-ref-filename="29dev">dev</dfn>,</td></tr>
<tr><th id="169">169</th><td>		      <em>int</em> <dfn class="local col0 decl" id="30maxOutstanding" title='maxOutstanding' data-type='int' data-ref="30maxOutstanding" data-ref-filename="30maxOutstanding">maxOutstanding</dfn>, <a class="typedef" href="raidframevar.h.html#RF_ShutdownList_t" title='RF_ShutdownList_t' data-type='struct RF_ShutdownList_s' data-ref="RF_ShutdownList_t" data-ref-filename="RF_ShutdownList_t">RF_ShutdownList_t</a> **<dfn class="local col1 decl" id="31listp" title='listp' data-type='RF_ShutdownList_t **' data-ref="31listp" data-ref-filename="31listp">listp</dfn>,</td></tr>
<tr><th id="170">170</th><td>		      <a class="typedef" href="raidframevar.h.html#RF_AllocListElem_t" title='RF_AllocListElem_t' data-type='struct RF_AllocListElem_s' data-ref="RF_AllocListElem_t" data-ref-filename="RF_AllocListElem_t">RF_AllocListElem_t</a> *<dfn class="local col2 decl" id="32clList" title='clList' data-type='RF_AllocListElem_t *' data-ref="32clList" data-ref-filename="32clList">clList</dfn>)</td></tr>
<tr><th id="171">171</th><td>{</td></tr>
<tr><th id="172">172</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::col" title='RF_DiskQueue_s::col' data-ref="RF_DiskQueue_s::col" data-ref-filename="RF_DiskQueue_s..col">col</a> = <a class="local col6 ref" href="#26c" title='c' data-ref="26c" data-ref-filename="26c">c</a>;</td></tr>
<tr><th id="173">173</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a> = <a class="local col7 ref" href="#27p" title='p' data-ref="27p" data-ref-filename="27p">p</a>;</td></tr>
<tr><th id="174">174</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qHdr" title='RF_DiskQueue_s::qHdr' data-ref="RF_DiskQueue_s::qHdr" data-ref-filename="RF_DiskQueue_s..qHdr">qHdr</a> = (<a class="local col7 ref" href="#27p" title='p' data-ref="27p" data-ref-filename="27p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Create" title='RF_DiskQueueSW_s::Create' data-ref="RF_DiskQueueSW_s::Create" data-ref-filename="RF_DiskQueueSW_s..Create">Create</a>) (<a class="local col8 ref" href="#28sectPerDisk" title='sectPerDisk' data-ref="28sectPerDisk" data-ref-filename="28sectPerDisk">sectPerDisk</a>, <a class="local col2 ref" href="#32clList" title='clList' data-ref="32clList" data-ref-filename="32clList">clList</a>, <a class="local col1 ref" href="#31listp" title='listp' data-ref="31listp" data-ref-filename="31listp">listp</a>);</td></tr>
<tr><th id="175">175</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::dev" title='RF_DiskQueue_s::dev' data-ref="RF_DiskQueue_s::dev" data-ref-filename="RF_DiskQueue_s..dev">dev</a> = <a class="local col9 ref" href="#29dev" title='dev' data-ref="29dev" data-ref-filename="29dev">dev</a>;</td></tr>
<tr><th id="176">176</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::numOutstanding" title='RF_DiskQueue_s::numOutstanding' data-ref="RF_DiskQueue_s::numOutstanding" data-ref-filename="RF_DiskQueue_s..numOutstanding">numOutstanding</a> = <var>0</var>;</td></tr>
<tr><th id="177">177</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::queueLength" title='RF_DiskQueue_s::queueLength' data-ref="RF_DiskQueue_s::queueLength" data-ref-filename="RF_DiskQueue_s..queueLength">queueLength</a> = <var>0</var>;</td></tr>
<tr><th id="178">178</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::maxOutstanding" title='RF_DiskQueue_s::maxOutstanding' data-ref="RF_DiskQueue_s::maxOutstanding" data-ref-filename="RF_DiskQueue_s..maxOutstanding">maxOutstanding</a> = <a class="local col0 ref" href="#30maxOutstanding" title='maxOutstanding' data-ref="30maxOutstanding" data-ref-filename="30maxOutstanding">maxOutstanding</a>;</td></tr>
<tr><th id="179">179</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::curPriority" title='RF_DiskQueue_s::curPriority' data-ref="RF_DiskQueue_s::curPriority" data-ref-filename="RF_DiskQueue_s..curPriority">curPriority</a> = <a class="macro" href="rf_diskqueue.h.html#52" title="1" data-ref="_M/RF_IO_NORMAL_PRIORITY">RF_IO_NORMAL_PRIORITY</a>;</td></tr>
<tr><th id="180">180</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::flags" title='RF_DiskQueue_s::flags' data-ref="RF_DiskQueue_s::flags" data-ref-filename="RF_DiskQueue_s..flags">flags</a> = <var>0</var>;</td></tr>
<tr><th id="181">181</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::raidPtr" title='RF_DiskQueue_s::raidPtr' data-ref="RF_DiskQueue_s::raidPtr" data-ref-filename="RF_DiskQueue_s..raidPtr">raidPtr</a> = <a class="local col4 ref" href="#24raidPtr" title='raidPtr' data-ref="24raidPtr" data-ref-filename="24raidPtr">raidPtr</a>;</td></tr>
<tr><th id="182">182</th><td>	<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::rf_cinfo" title='RF_DiskQueue_s::rf_cinfo' data-ref="RF_DiskQueue_s::rf_cinfo" data-ref-filename="RF_DiskQueue_s..rf_cinfo">rf_cinfo</a> = &amp;<a class="local col4 ref" href="#24raidPtr" title='raidPtr' data-ref="24raidPtr" data-ref-filename="24raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::raid_cinfo" title='RF_Raid_s::raid_cinfo' data-ref="RF_Raid_s::raid_cinfo" data-ref-filename="RF_Raid_s..raid_cinfo">raid_cinfo</a>[<a class="local col6 ref" href="#26c" title='c' data-ref="26c" data-ref-filename="26c">c</a>];</td></tr>
<tr><th id="183">183</th><td>	<a class="macro" href="rf_threadstuff.h.html#65" title="mutex_init(&amp;(diskqueue-&gt;mutex), MUTEX_DEFAULT, (0x6))" data-ref="_M/rf_init_mutex2">rf_init_mutex2</a>(<a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#105" title='RF_DiskQueue_s::mutex' data-ref="RF_DiskQueue_s::mutex" data-ref-filename="RF_DiskQueue_s..mutex">mutex</a>, <a class="macro" href="../../arch/x86/include/intrdefs.h.html#13" title="0x6" data-ref="_M/IPL_VM">IPL_VM</a>);</td></tr>
<tr><th id="184">184</th><td>	<a class="macro" href="rf_shutdown.h.html#68" title="_rf_ShutdownCreate(listp,rf_ShutdownDiskQueue,diskqueue)" data-ref="_M/rf_ShutdownCreate">rf_ShutdownCreate</a>(<a class="local col1 ref" href="#31listp" title='listp' data-ref="31listp" data-ref-filename="31listp">listp</a>, <a class="tu ref fn" href="#rf_ShutdownDiskQueue" title='rf_ShutdownDiskQueue' data-use='r' data-ref="rf_ShutdownDiskQueue" data-ref-filename="rf_ShutdownDiskQueue">rf_ShutdownDiskQueue</a>, <a class="local col5 ref" href="#25diskqueue" title='diskqueue' data-ref="25diskqueue" data-ref-filename="25diskqueue">diskqueue</a>);</td></tr>
<tr><th id="185">185</th><td>	<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="186">186</th><td>}</td></tr>
<tr><th id="187">187</th><td></td></tr>
<tr><th id="188">188</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="189">189</th><td><dfn class="tu decl def fn" id="rf_ShutdownDiskQueueSystem" title='rf_ShutdownDiskQueueSystem' data-type='void rf_ShutdownDiskQueueSystem(void * ignored)' data-ref="rf_ShutdownDiskQueueSystem" data-ref-filename="rf_ShutdownDiskQueueSystem">rf_ShutdownDiskQueueSystem</dfn>(<em>void</em> *<dfn class="local col3 decl" id="33ignored" title='ignored' data-type='void *' data-ref="33ignored" data-ref-filename="33ignored">ignored</dfn>)</td></tr>
<tr><th id="190">190</th><td>{</td></tr>
<tr><th id="191">191</th><td>	<a class="ref fn" href="../../sys/pool.h.html#pool_destroy" title='pool_destroy' data-ref="pool_destroy" data-ref-filename="pool_destroy">pool_destroy</a>(&amp;<a class="ref" href="rf_netbsd.h.html#rf_pools" title='rf_pools' data-ref="rf_pools" data-ref-filename="rf_pools">rf_pools</a>.<a class="ref field" href="rf_netbsd.h.html#RF_Pools_s::dqd" title='RF_Pools_s::dqd' data-ref="RF_Pools_s::dqd" data-ref-filename="RF_Pools_s..dqd">dqd</a>);</td></tr>
<tr><th id="192">192</th><td>}</td></tr>
<tr><th id="193">193</th><td></td></tr>
<tr><th id="194">194</th><td><em>int</em></td></tr>
<tr><th id="195">195</th><td><dfn class="decl def fn" id="rf_ConfigureDiskQueueSystem" title='rf_ConfigureDiskQueueSystem' data-ref="rf_ConfigureDiskQueueSystem" data-ref-filename="rf_ConfigureDiskQueueSystem">rf_ConfigureDiskQueueSystem</dfn>(<a class="typedef" href="raidframevar.h.html#RF_ShutdownList_t" title='RF_ShutdownList_t' data-type='struct RF_ShutdownList_s' data-ref="RF_ShutdownList_t" data-ref-filename="RF_ShutdownList_t">RF_ShutdownList_t</a> **<dfn class="local col4 decl" id="34listp" title='listp' data-type='RF_ShutdownList_t **' data-ref="34listp" data-ref-filename="34listp">listp</dfn>)</td></tr>
<tr><th id="196">196</th><td>{</td></tr>
<tr><th id="197">197</th><td></td></tr>
<tr><th id="198">198</th><td>	<a class="ref fn" href="rf_netbsd.h.html#rf_pool_init" title='rf_pool_init' data-ref="rf_pool_init" data-ref-filename="rf_pool_init">rf_pool_init</a>(&amp;<a class="ref" href="rf_netbsd.h.html#rf_pools" title='rf_pools' data-ref="rf_pools" data-ref-filename="rf_pools">rf_pools</a>.<a class="ref field" href="rf_netbsd.h.html#RF_Pools_s::dqd" title='RF_Pools_s::dqd' data-ref="RF_Pools_s::dqd" data-ref-filename="RF_Pools_s..dqd">dqd</a>, <b>sizeof</b>(<a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a>),</td></tr>
<tr><th id="199">199</th><td>		     <q>"rf_dqd_pl"</q>, <a class="macro" href="#151" title="64" data-ref="_M/RF_MIN_FREE_DQD">RF_MIN_FREE_DQD</a>, <a class="macro" href="#150" title="256" data-ref="_M/RF_MAX_FREE_DQD">RF_MAX_FREE_DQD</a>);</td></tr>
<tr><th id="200">200</th><td>	<a class="macro" href="rf_shutdown.h.html#68" title="_rf_ShutdownCreate(listp,rf_ShutdownDiskQueueSystem,((void *)0))" data-ref="_M/rf_ShutdownCreate">rf_ShutdownCreate</a>(<a class="local col4 ref" href="#34listp" title='listp' data-ref="34listp" data-ref-filename="34listp">listp</a>, <a class="tu ref fn" href="#rf_ShutdownDiskQueueSystem" title='rf_ShutdownDiskQueueSystem' data-use='r' data-ref="rf_ShutdownDiskQueueSystem" data-ref-filename="rf_ShutdownDiskQueueSystem">rf_ShutdownDiskQueueSystem</a>, <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="201">201</th><td></td></tr>
<tr><th id="202">202</th><td>	<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="203">203</th><td>}</td></tr>
<tr><th id="204">204</th><td></td></tr>
<tr><th id="205">205</th><td><em>int</em></td></tr>
<tr><th id="206">206</th><td><dfn class="decl def fn" id="rf_ConfigureDiskQueues" title='rf_ConfigureDiskQueues' data-ref="rf_ConfigureDiskQueues" data-ref-filename="rf_ConfigureDiskQueues">rf_ConfigureDiskQueues</dfn>(<a class="typedef" href="raidframevar.h.html#RF_ShutdownList_t" title='RF_ShutdownList_t' data-type='struct RF_ShutdownList_s' data-ref="RF_ShutdownList_t" data-ref-filename="RF_ShutdownList_t">RF_ShutdownList_t</a> **<dfn class="local col5 decl" id="35listp" title='listp' data-type='RF_ShutdownList_t **' data-ref="35listp" data-ref-filename="35listp">listp</dfn>, <a class="typedef" href="raidframevar.h.html#RF_Raid_t" title='RF_Raid_t' data-type='struct RF_Raid_s' data-ref="RF_Raid_t" data-ref-filename="RF_Raid_t">RF_Raid_t</a> *<dfn class="local col6 decl" id="36raidPtr" title='raidPtr' data-type='RF_Raid_t *' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</dfn>,</td></tr>
<tr><th id="207">207</th><td>		       <a class="typedef" href="raidframevar.h.html#RF_Config_t" title='RF_Config_t' data-type='struct RF_Config_s' data-ref="RF_Config_t" data-ref-filename="RF_Config_t">RF_Config_t</a> *<dfn class="local col7 decl" id="37cfgPtr" title='cfgPtr' data-type='RF_Config_t *' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</dfn>)</td></tr>
<tr><th id="208">208</th><td>{</td></tr>
<tr><th id="209">209</th><td>	<a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col8 decl" id="38diskQueues" title='diskQueues' data-type='RF_DiskQueue_t *' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</dfn>, *<dfn class="local col9 decl" id="39spareQueues" title='spareQueues' data-type='RF_DiskQueue_t *' data-ref="39spareQueues" data-ref-filename="39spareQueues">spareQueues</dfn>;</td></tr>
<tr><th id="210">210</th><td>	<em>const</em> <a class="typedef" href="raidframevar.h.html#RF_DiskQueueSW_t" title='RF_DiskQueueSW_t' data-type='struct RF_DiskQueueSW_s' data-ref="RF_DiskQueueSW_t" data-ref-filename="RF_DiskQueueSW_t">RF_DiskQueueSW_t</a> *<dfn class="local col0 decl" id="40p" title='p' data-type='const RF_DiskQueueSW_t *' data-ref="40p" data-ref-filename="40p">p</dfn>;</td></tr>
<tr><th id="211">211</th><td>	<a class="typedef" href="raidframevar.h.html#RF_RowCol_t" title='RF_RowCol_t' data-type='int' data-ref="RF_RowCol_t" data-ref-filename="RF_RowCol_t">RF_RowCol_t</a> <dfn class="local col1 decl" id="41r" title='r' data-type='RF_RowCol_t' data-ref="41r" data-ref-filename="41r">r</dfn>,<dfn class="local col2 decl" id="42c" title='c' data-type='RF_RowCol_t' data-ref="42c" data-ref-filename="42c">c</dfn>;</td></tr>
<tr><th id="212">212</th><td>	<em>int</em>     <dfn class="local col3 decl" id="43rc" title='rc' data-type='int' data-ref="43rc" data-ref-filename="43rc">rc</dfn>, <dfn class="local col4 decl" id="44i" title='i' data-type='int' data-ref="44i" data-ref-filename="44i">i</dfn>;</td></tr>
<tr><th id="213">213</th><td></td></tr>
<tr><th id="214">214</th><td>	<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::maxQueueDepth" title='RF_Raid_s::maxQueueDepth' data-ref="RF_Raid_s::maxQueueDepth" data-ref-filename="RF_Raid_s..maxQueueDepth">maxQueueDepth</a> = <a class="local col7 ref" href="#37cfgPtr" title='cfgPtr' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</a>-&gt;<a class="ref field" href="raidframevar.h.html#RF_Config_s::maxOutstandingDiskReqs" title='RF_Config_s::maxOutstandingDiskReqs' data-ref="RF_Config_s::maxOutstandingDiskReqs" data-ref-filename="RF_Config_s..maxOutstandingDiskReqs">maxOutstandingDiskReqs</a>;</td></tr>
<tr><th id="215">215</th><td></td></tr>
<tr><th id="216">216</th><td>	<b>for</b> (<a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="local col4 ref" href="#44i" title='i' data-ref="44i" data-ref-filename="44i">i</a> = <var>0</var>; <a class="local col4 ref" href="#44i" title='i' data-ref="44i" data-ref-filename="44i">i</a> &lt; <a class="macro" href="#148" title="(sizeof(diskqueuesw)/sizeof(RF_DiskQueueSW_t))" data-ref="_M/NUM_DISK_QUEUE_TYPES">NUM_DISK_QUEUE_TYPES</a>; <a class="local col4 ref" href="#44i" title='i' data-ref="44i" data-ref-filename="44i">i</a>++) {</td></tr>
<tr><th id="217">217</th><td>		<b>if</b> (!<a class="macro" href="../../lib/libkern/libkern.h.html#401" title="__builtin_strcmp(diskqueuesw[i].queueType, cfgPtr-&gt;diskQueueType)" data-ref="_M/strcmp">strcmp</a>(<a class="tu ref" href="#diskqueuesw" title='diskqueuesw' data-use='m' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</a>[<a class="local col4 ref" href="#44i" title='i' data-ref="44i" data-ref-filename="44i">i</a>].<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::queueType" title='RF_DiskQueueSW_s::queueType' data-ref="RF_DiskQueueSW_s::queueType" data-ref-filename="RF_DiskQueueSW_s..queueType">queueType</a>, <a class="local col7 ref" href="#37cfgPtr" title='cfgPtr' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</a>-&gt;<a class="ref field" href="raidframevar.h.html#RF_Config_s::diskQueueType" title='RF_Config_s::diskQueueType' data-ref="RF_Config_s::diskQueueType" data-ref-filename="RF_Config_s..diskQueueType">diskQueueType</a>)) {</td></tr>
<tr><th id="218">218</th><td>			<a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a> = &amp;<a class="tu ref" href="#diskqueuesw" title='diskqueuesw' data-use='a' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</a>[<a class="local col4 ref" href="#44i" title='i' data-ref="44i" data-ref-filename="44i">i</a>];</td></tr>
<tr><th id="219">219</th><td>			<b>break</b>;</td></tr>
<tr><th id="220">220</th><td>		}</td></tr>
<tr><th id="221">221</th><td>	}</td></tr>
<tr><th id="222">222</th><td>	<b>if</b> (<a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="223">223</th><td>		<a class="macro" href="rf_general.h.html#48" title="printf((&quot;Unknown queue type \&quot;%s\&quot;.  Using %s\n&quot;),(cfgPtr-&gt;diskQueueType),(diskqueuesw[0].queueType))" data-ref="_M/RF_ERRORMSG2">RF_ERRORMSG2</a>(<q>"Unknown queue type \"%s\".  Using %s\n"</q>, <a class="local col7 ref" href="#37cfgPtr" title='cfgPtr' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</a>-&gt;<a class="ref field" href="raidframevar.h.html#RF_Config_s::diskQueueType" title='RF_Config_s::diskQueueType' data-ref="RF_Config_s::diskQueueType" data-ref-filename="RF_Config_s..diskQueueType">diskQueueType</a>, <a class="tu ref" href="#diskqueuesw" title='diskqueuesw' data-use='m' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</a>[<var>0</var>].<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::queueType" title='RF_DiskQueueSW_s::queueType' data-ref="RF_DiskQueueSW_s::queueType" data-ref-filename="RF_DiskQueueSW_s..queueType">queueType</a>);</td></tr>
<tr><th id="224">224</th><td>		<a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a> = &amp;<a class="tu ref" href="#diskqueuesw" title='diskqueuesw' data-use='a' data-ref="diskqueuesw" data-ref-filename="diskqueuesw">diskqueuesw</a>[<var>0</var>];</td></tr>
<tr><th id="225">225</th><td>	}</td></tr>
<tr><th id="226">226</th><td>	<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::qType" title='RF_Raid_s::qType' data-ref="RF_Raid_s::qType" data-ref-filename="RF_Raid_s..qType">qType</a> = <a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a>;</td></tr>
<tr><th id="227">227</th><td></td></tr>
<tr><th id="228">228</th><td>	<a class="local col8 ref" href="#38diskQueues" title='diskQueues' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</a> = <a class="macro" href="rf_debugMem.h.html#51" title="_RF_MallocAndAdd((raidPtr-&gt;numCol + 10) * sizeof(*diskQueues), raidPtr-&gt;cleanupList)" data-ref="_M/RF_MallocAndAdd">RF_MallocAndAdd</a>(</td></tr>
<tr><th id="229">229</th><td>	    (<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numCol" title='RF_Raid_s::numCol' data-ref="RF_Raid_s::numCol" data-ref-filename="RF_Raid_s..numCol">numCol</a> + <a class="macro" href="raidframevar.h.html#296" title="10" data-ref="_M/RF_MAXSPARE">RF_MAXSPARE</a>) * <b>sizeof</b>(*<a class="local col8 ref" href="#38diskQueues" title='diskQueues' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</a>),</td></tr>
<tr><th id="230">230</th><td>	    <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::cleanupList" title='RF_Raid_s::cleanupList' data-ref="RF_Raid_s::cleanupList" data-ref-filename="RF_Raid_s..cleanupList">cleanupList</a>);</td></tr>
<tr><th id="231">231</th><td>	<b>if</b> (<a class="local col8 ref" href="#38diskQueues" title='diskQueues' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="232">232</th><td>		<b>return</b> (<a class="macro" href="../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="233">233</th><td>	<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::Queues" title='RF_Raid_s::Queues' data-ref="RF_Raid_s::Queues" data-ref-filename="RF_Raid_s..Queues">Queues</a> = <a class="local col8 ref" href="#38diskQueues" title='diskQueues' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</a>;</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td>	<b>for</b> (<a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a> = <var>0</var>; <a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a> &lt; <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numCol" title='RF_Raid_s::numCol' data-ref="RF_Raid_s::numCol" data-ref-filename="RF_Raid_s..numCol">numCol</a>; <a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a>++) {</td></tr>
<tr><th id="236">236</th><td>		<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a> = <a class="ref fn" href="#rf_ConfigureDiskQueue" title='rf_ConfigureDiskQueue' data-ref="rf_ConfigureDiskQueue" data-ref-filename="rf_ConfigureDiskQueue">rf_ConfigureDiskQueue</a>(<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>, &amp;<a class="local col8 ref" href="#38diskQueues" title='diskQueues' data-ref="38diskQueues" data-ref-filename="38diskQueues">diskQueues</a>[<a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a>],</td></tr>
<tr><th id="237">237</th><td>					   <a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a>, <a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a>,</td></tr>
<tr><th id="238">238</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::sectorsPerDisk" title='RF_Raid_s::sectorsPerDisk' data-ref="RF_Raid_s::sectorsPerDisk" data-ref-filename="RF_Raid_s..sectorsPerDisk">sectorsPerDisk</a>,</td></tr>
<tr><th id="239">239</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::Disks" title='RF_Raid_s::Disks' data-ref="RF_Raid_s::Disks" data-ref-filename="RF_Raid_s..Disks">Disks</a>[<a class="local col2 ref" href="#42c" title='c' data-ref="42c" data-ref-filename="42c">c</a>].<a class="ref field" href="raidframevar.h.html#RF_RaidDisk_s::dev" title='RF_RaidDisk_s::dev' data-ref="RF_RaidDisk_s::dev" data-ref-filename="RF_RaidDisk_s..dev">dev</a>,</td></tr>
<tr><th id="240">240</th><td>					   <a class="local col7 ref" href="#37cfgPtr" title='cfgPtr' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</a>-&gt;<a class="ref field" href="raidframevar.h.html#RF_Config_s::maxOutstandingDiskReqs" title='RF_Config_s::maxOutstandingDiskReqs' data-ref="RF_Config_s::maxOutstandingDiskReqs" data-ref-filename="RF_Config_s..maxOutstandingDiskReqs">maxOutstandingDiskReqs</a>,</td></tr>
<tr><th id="241">241</th><td>					   <a class="local col5 ref" href="#35listp" title='listp' data-ref="35listp" data-ref-filename="35listp">listp</a>, <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::cleanupList" title='RF_Raid_s::cleanupList' data-ref="RF_Raid_s::cleanupList" data-ref-filename="RF_Raid_s..cleanupList">cleanupList</a>);</td></tr>
<tr><th id="242">242</th><td>		<b>if</b> (<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a>)</td></tr>
<tr><th id="243">243</th><td>			<b>return</b> (<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a>);</td></tr>
<tr><th id="244">244</th><td>	}</td></tr>
<tr><th id="245">245</th><td></td></tr>
<tr><th id="246">246</th><td>	<a class="local col9 ref" href="#39spareQueues" title='spareQueues' data-ref="39spareQueues" data-ref-filename="39spareQueues">spareQueues</a> = &amp;<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::Queues" title='RF_Raid_s::Queues' data-ref="RF_Raid_s::Queues" data-ref-filename="RF_Raid_s..Queues">Queues</a>[<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numCol" title='RF_Raid_s::numCol' data-ref="RF_Raid_s::numCol" data-ref-filename="RF_Raid_s..numCol">numCol</a>];</td></tr>
<tr><th id="247">247</th><td>	<b>for</b> (<a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a> = <var>0</var>; <a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a> &lt; <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numSpare" title='RF_Raid_s::numSpare' data-ref="RF_Raid_s::numSpare" data-ref-filename="RF_Raid_s..numSpare">numSpare</a>; <a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a>++) {</td></tr>
<tr><th id="248">248</th><td>		<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a> = <a class="ref fn" href="#rf_ConfigureDiskQueue" title='rf_ConfigureDiskQueue' data-ref="rf_ConfigureDiskQueue" data-ref-filename="rf_ConfigureDiskQueue">rf_ConfigureDiskQueue</a>(<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>, &amp;<a class="local col9 ref" href="#39spareQueues" title='spareQueues' data-ref="39spareQueues" data-ref-filename="39spareQueues">spareQueues</a>[<a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a>],</td></tr>
<tr><th id="249">249</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numCol" title='RF_Raid_s::numCol' data-ref="RF_Raid_s::numCol" data-ref-filename="RF_Raid_s..numCol">numCol</a> + <a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a>, <a class="local col0 ref" href="#40p" title='p' data-ref="40p" data-ref-filename="40p">p</a>,</td></tr>
<tr><th id="250">250</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::sectorsPerDisk" title='RF_Raid_s::sectorsPerDisk' data-ref="RF_Raid_s::sectorsPerDisk" data-ref-filename="RF_Raid_s..sectorsPerDisk">sectorsPerDisk</a>,</td></tr>
<tr><th id="251">251</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::Disks" title='RF_Raid_s::Disks' data-ref="RF_Raid_s::Disks" data-ref-filename="RF_Raid_s..Disks">Disks</a>[<a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::numCol" title='RF_Raid_s::numCol' data-ref="RF_Raid_s::numCol" data-ref-filename="RF_Raid_s..numCol">numCol</a> + <a class="local col1 ref" href="#41r" title='r' data-ref="41r" data-ref-filename="41r">r</a>].<a class="ref field" href="raidframevar.h.html#RF_RaidDisk_s::dev" title='RF_RaidDisk_s::dev' data-ref="RF_RaidDisk_s::dev" data-ref-filename="RF_RaidDisk_s..dev">dev</a>,</td></tr>
<tr><th id="252">252</th><td>					   <a class="local col7 ref" href="#37cfgPtr" title='cfgPtr' data-ref="37cfgPtr" data-ref-filename="37cfgPtr">cfgPtr</a>-&gt;<a class="ref field" href="raidframevar.h.html#RF_Config_s::maxOutstandingDiskReqs" title='RF_Config_s::maxOutstandingDiskReqs' data-ref="RF_Config_s::maxOutstandingDiskReqs" data-ref-filename="RF_Config_s..maxOutstandingDiskReqs">maxOutstandingDiskReqs</a>, <a class="local col5 ref" href="#35listp" title='listp' data-ref="35listp" data-ref-filename="35listp">listp</a>,</td></tr>
<tr><th id="253">253</th><td>					   <a class="local col6 ref" href="#36raidPtr" title='raidPtr' data-ref="36raidPtr" data-ref-filename="36raidPtr">raidPtr</a>-&gt;<a class="ref field" href="rf_raid.h.html#RF_Raid_s::cleanupList" title='RF_Raid_s::cleanupList' data-ref="RF_Raid_s::cleanupList" data-ref-filename="RF_Raid_s..cleanupList">cleanupList</a>);</td></tr>
<tr><th id="254">254</th><td>		<b>if</b> (<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a>)</td></tr>
<tr><th id="255">255</th><td>			<b>return</b> (<a class="local col3 ref" href="#43rc" title='rc' data-ref="43rc" data-ref-filename="43rc">rc</a>);</td></tr>
<tr><th id="256">256</th><td>	}</td></tr>
<tr><th id="257">257</th><td>	<b>return</b> (<var>0</var>);</td></tr>
<tr><th id="258">258</th><td>}</td></tr>
<tr><th id="259">259</th><td><i>/* Enqueue a disk I/O</i></td></tr>
<tr><th id="260">260</th><td><i> *</i></td></tr>
<tr><th id="261">261</th><td><i> * In the kernel, I/O is non-blocking and so we'd like to have multiple</i></td></tr>
<tr><th id="262">262</th><td><i> * I/Os outstanding on the physical disks when possible.</i></td></tr>
<tr><th id="263">263</th><td><i> *</i></td></tr>
<tr><th id="264">264</th><td><i> * when any request arrives at a queue, we have two choices:</i></td></tr>
<tr><th id="265">265</th><td><i> *    dispatch it to the lower levels</i></td></tr>
<tr><th id="266">266</th><td><i> *    queue it up</i></td></tr>
<tr><th id="267">267</th><td><i> *</i></td></tr>
<tr><th id="268">268</th><td><i> * kernel rules for when to do what:</i></td></tr>
<tr><th id="269">269</th><td><i> *    unlocking req  :  always dispatch it</i></td></tr>
<tr><th id="270">270</th><td><i> *    normal req     :  queue empty =&gt; dispatch it &amp; set priority</i></td></tr>
<tr><th id="271">271</th><td><i> *                      queue not full &amp; priority is ok =&gt; dispatch it</i></td></tr>
<tr><th id="272">272</th><td><i> *                      else queue it</i></td></tr>
<tr><th id="273">273</th><td><i> */</i></td></tr>
<tr><th id="274">274</th><td><em>void</em></td></tr>
<tr><th id="275">275</th><td><dfn class="decl def fn" id="rf_DiskIOEnqueue" title='rf_DiskIOEnqueue' data-ref="rf_DiskIOEnqueue" data-ref-filename="rf_DiskIOEnqueue">rf_DiskIOEnqueue</dfn>(<a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col5 decl" id="45queue" title='queue' data-type='RF_DiskQueue_t *' data-ref="45queue" data-ref-filename="45queue">queue</dfn>, <a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a> *<dfn class="local col6 decl" id="46req" title='req' data-type='RF_DiskQueueData_t *' data-ref="46req" data-ref-filename="46req">req</dfn>, <em>int</em> <dfn class="local col7 decl" id="47pri" title='pri' data-type='int' data-ref="47pri" data-ref-filename="47pri">pri</dfn>)</td></tr>
<tr><th id="276">276</th><td>{</td></tr>
<tr><th id="277">277</th><td>	<a class="macro" href="rf_etimer.h.html#43" title="{ __builtin_memset(&amp;(req-&gt;qtime), 0, sizeof (req-&gt;qtime)); getmicrouptime(&amp;(req-&gt;qtime).st); }" data-ref="_M/RF_ETIMER_START">RF_ETIMER_START</a>(<a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::qtime" title='RF_DiskQueueData_s::qtime' data-ref="RF_DiskQueueData_s::qtime" data-ref-filename="RF_DiskQueueData_s..qtime">qtime</a>);</td></tr>
<tr><th id="278">278</th><td>	<a class="macro" href="rf_general.h.html#66" title="{ (void)(req-&gt;type == &apos;n&apos; || req-&gt;numSector); }" data-ref="_M/RF_ASSERT">RF_ASSERT</a>(<a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::type" title='RF_DiskQueueData_s::type' data-ref="RF_DiskQueueData_s::type" data-ref-filename="RF_DiskQueueData_s..type">type</a> == <a class="macro" href="raidframevar.h.html#197" title="&apos;n&apos;" data-ref="_M/RF_IO_TYPE_NOP">RF_IO_TYPE_NOP</a> || <a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::numSector" title='RF_DiskQueueData_s::numSector' data-ref="RF_DiskQueueData_s::numSector" data-ref-filename="RF_DiskQueueData_s..numSector">numSector</a>);</td></tr>
<tr><th id="279">279</th><td>	<a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::priority" title='RF_DiskQueueData_s::priority' data-ref="RF_DiskQueueData_s::priority" data-ref-filename="RF_DiskQueueData_s..priority">priority</a> = <a class="local col7 ref" href="#47pri" title='pri' data-ref="47pri" data-ref-filename="47pri">pri</a>;</td></tr>
<tr><th id="280">280</th><td></td></tr>
<tr><th id="281">281</th><td><u>#<span data-ppcond="281">if</span> <a class="macro" href="#90" title="0" data-ref="_M/RF_DEBUG_DISKQUEUE">RF_DEBUG_DISKQUEUE</a></u></td></tr>
<tr><th id="282">282</th><td>	<b>if</b> (rf_queueDebug &amp;&amp; (req-&gt;numSector == <var>0</var>)) {</td></tr>
<tr><th id="283">283</th><td>		printf(<q>"Warning: Enqueueing zero-sector access\n"</q>);</td></tr>
<tr><th id="284">284</th><td>	}</td></tr>
<tr><th id="285">285</th><td><u>#<span data-ppcond="281">endif</span></u></td></tr>
<tr><th id="286">286</th><td>	<a class="macro" href="rf_diskqueue.h.html#128" title="mutex_enter(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_LOCK_QUEUE_MUTEX">RF_LOCK_QUEUE_MUTEX</a>(<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>, <q>"DiskIOEnqueue"</q>);</td></tr>
<tr><th id="287">287</th><td>	<b>if</b> (<a class="macro" href="rf_diskqueue.h.html#132" title="(((queue)-&gt;numOutstanding == 0) || (!((queue)-&gt;numOutstanding == (queue)-&gt;maxOutstanding) &amp;&amp; ((req)-&gt;priority &gt;= (queue)-&gt;curPriority)))" data-ref="_M/RF_OK_TO_DISPATCH">RF_OK_TO_DISPATCH</a>(<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>, <a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>)) {</td></tr>
<tr><th id="288">288</th><td>		<a class="macro" href="#99" title="" data-ref="_M/Dprintf2">Dprintf2</a>(<q>"Dispatching pri %d regular op to c %d (ok to dispatch)\n"</q>, pri, queue-&gt;col);</td></tr>
<tr><th id="289">289</th><td>		<a class="ref fn" href="rf_kintf.h.html#rf_DispatchKernelIO" title='rf_DispatchKernelIO' data-ref="rf_DispatchKernelIO" data-ref-filename="rf_DispatchKernelIO">rf_DispatchKernelIO</a>(<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>, <a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>);</td></tr>
<tr><th id="290">290</th><td>	} <b>else</b> {</td></tr>
<tr><th id="291">291</th><td>		<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::queueLength" title='RF_DiskQueue_s::queueLength' data-ref="RF_DiskQueue_s::queueLength" data-ref-filename="RF_DiskQueue_s..queueLength">queueLength</a>++;	<i>/* increment count of number of requests waiting in this queue */</i></td></tr>
<tr><th id="292">292</th><td>		<a class="macro" href="#99" title="" data-ref="_M/Dprintf2">Dprintf2</a>(<q>"Enqueueing pri %d regular op to c %d (not ok to dispatch)\n"</q>, pri, queue-&gt;col);</td></tr>
<tr><th id="293">293</th><td>		<a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::queue" title='RF_DiskQueueData_s::queue' data-ref="RF_DiskQueueData_s::queue" data-ref-filename="RF_DiskQueueData_s..queue">queue</a> = (<em>void</em> *) <a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>;</td></tr>
<tr><th id="294">294</th><td>		(<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Enqueue" title='RF_DiskQueueSW_s::Enqueue' data-ref="RF_DiskQueueSW_s::Enqueue" data-ref-filename="RF_DiskQueueSW_s..Enqueue">Enqueue</a>) (<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qHdr" title='RF_DiskQueue_s::qHdr' data-ref="RF_DiskQueue_s::qHdr" data-ref-filename="RF_DiskQueue_s..qHdr">qHdr</a>, <a class="local col6 ref" href="#46req" title='req' data-ref="46req" data-ref-filename="46req">req</a>, <a class="local col7 ref" href="#47pri" title='pri' data-ref="47pri" data-ref-filename="47pri">pri</a>);</td></tr>
<tr><th id="295">295</th><td>	}</td></tr>
<tr><th id="296">296</th><td>	<a class="macro" href="rf_diskqueue.h.html#129" title="mutex_exit(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_UNLOCK_QUEUE_MUTEX">RF_UNLOCK_QUEUE_MUTEX</a>(<a class="local col5 ref" href="#45queue" title='queue' data-ref="45queue" data-ref-filename="45queue">queue</a>, <q>"DiskIOEnqueue"</q>);</td></tr>
<tr><th id="297">297</th><td>}</td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td></td></tr>
<tr><th id="300">300</th><td><i>/* get the next set of I/Os started */</i></td></tr>
<tr><th id="301">301</th><td><em>void</em></td></tr>
<tr><th id="302">302</th><td><dfn class="decl def fn" id="rf_DiskIOComplete" title='rf_DiskIOComplete' data-ref="rf_DiskIOComplete" data-ref-filename="rf_DiskIOComplete">rf_DiskIOComplete</dfn>(<a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col8 decl" id="48queue" title='queue' data-type='RF_DiskQueue_t *' data-ref="48queue" data-ref-filename="48queue">queue</dfn>, <a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a> *<dfn class="local col9 decl" id="49req" title='req' data-type='RF_DiskQueueData_t *' data-ref="49req" data-ref-filename="49req">req</dfn>, <em>int</em> <dfn class="local col0 decl" id="50status" title='status' data-type='int' data-ref="50status" data-ref-filename="50status">status</dfn>)</td></tr>
<tr><th id="303">303</th><td>{</td></tr>
<tr><th id="304">304</th><td>	<em>int</em>     <dfn class="local col1 decl" id="51done" title='done' data-type='int' data-ref="51done" data-ref-filename="51done">done</dfn> = <var>0</var>;</td></tr>
<tr><th id="305">305</th><td></td></tr>
<tr><th id="306">306</th><td>	<a class="macro" href="rf_diskqueue.h.html#128" title="mutex_enter(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_LOCK_QUEUE_MUTEX">RF_LOCK_QUEUE_MUTEX</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>, <q>"DiskIOComplete"</q>);</td></tr>
<tr><th id="307">307</th><td>	<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::numOutstanding" title='RF_DiskQueue_s::numOutstanding' data-ref="RF_DiskQueue_s::numOutstanding" data-ref-filename="RF_DiskQueue_s..numOutstanding">numOutstanding</a>--;</td></tr>
<tr><th id="308">308</th><td>	<a class="macro" href="rf_general.h.html#66" title="{ (void)(queue-&gt;numOutstanding &gt;= 0); }" data-ref="_M/RF_ASSERT">RF_ASSERT</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::numOutstanding" title='RF_DiskQueue_s::numOutstanding' data-ref="RF_DiskQueue_s::numOutstanding" data-ref-filename="RF_DiskQueue_s..numOutstanding">numOutstanding</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td>	<i>/* dispatch requests to the disk until we find one that we can't. */</i></td></tr>
<tr><th id="311">311</th><td>	<i>/* no reason to continue once we've filled up the queue */</i></td></tr>
<tr><th id="312">312</th><td>	<i>/* no reason to even start if the queue is locked */</i></td></tr>
<tr><th id="313">313</th><td></td></tr>
<tr><th id="314">314</th><td>	<b>while</b> (!<a class="local col1 ref" href="#51done" title='done' data-ref="51done" data-ref-filename="51done">done</a> &amp;&amp; !<a class="macro" href="rf_diskqueue.h.html#126" title="((queue)-&gt;numOutstanding == (queue)-&gt;maxOutstanding)" data-ref="_M/RF_QUEUE_FULL">RF_QUEUE_FULL</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>)) {</td></tr>
<tr><th id="315">315</th><td>		<a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a> = (<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Dequeue" title='RF_DiskQueueSW_s::Dequeue' data-ref="RF_DiskQueueSW_s::Dequeue" data-ref-filename="RF_DiskQueueSW_s..Dequeue">Dequeue</a>) (<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qHdr" title='RF_DiskQueue_s::qHdr' data-ref="RF_DiskQueue_s::qHdr" data-ref-filename="RF_DiskQueue_s..qHdr">qHdr</a>);</td></tr>
<tr><th id="316">316</th><td>		<b>if</b> (<a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a>) {</td></tr>
<tr><th id="317">317</th><td>			<a class="macro" href="#99" title="" data-ref="_M/Dprintf2">Dprintf2</a>(<q>"DiskIOComplete: extracting pri %d req from queue at c %d\n"</q>, req-&gt;priority, queue-&gt;col);</td></tr>
<tr><th id="318">318</th><td>			<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::queueLength" title='RF_DiskQueue_s::queueLength' data-ref="RF_DiskQueue_s::queueLength" data-ref-filename="RF_DiskQueue_s..queueLength">queueLength</a>--;	<i>/* decrement count of number of requests waiting in this queue */</i></td></tr>
<tr><th id="319">319</th><td>			<a class="macro" href="rf_general.h.html#66" title="{ (void)(queue-&gt;queueLength &gt;= 0); }" data-ref="_M/RF_ASSERT">RF_ASSERT</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::queueLength" title='RF_DiskQueue_s::queueLength' data-ref="RF_DiskQueue_s::queueLength" data-ref-filename="RF_DiskQueue_s..queueLength">queueLength</a> &gt;= <var>0</var>);</td></tr>
<tr><th id="320">320</th><td>			<b>if</b> (<a class="macro" href="rf_diskqueue.h.html#132" title="(((queue)-&gt;numOutstanding == 0) || (!((queue)-&gt;numOutstanding == (queue)-&gt;maxOutstanding) &amp;&amp; ((req)-&gt;priority &gt;= (queue)-&gt;curPriority)))" data-ref="_M/RF_OK_TO_DISPATCH">RF_OK_TO_DISPATCH</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>, <a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a>)) {</td></tr>
<tr><th id="321">321</th><td>				<a class="macro" href="#99" title="" data-ref="_M/Dprintf2">Dprintf2</a>(<q>"DiskIOComplete: dispatching pri %d regular req to c %d (ok to dispatch)\n"</q>, req-&gt;priority, queue-&gt;col);</td></tr>
<tr><th id="322">322</th><td>				<a class="ref fn" href="rf_kintf.h.html#rf_DispatchKernelIO" title='rf_DispatchKernelIO' data-ref="rf_DispatchKernelIO" data-ref-filename="rf_DispatchKernelIO">rf_DispatchKernelIO</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>, <a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a>);</td></tr>
<tr><th id="323">323</th><td>			} <b>else</b> {	</td></tr>
<tr><th id="324">324</th><td>				<i>/* we can't dispatch it, so just re-enqueue it.  </i></td></tr>
<tr><th id="325">325</th><td><i>				   potential trouble here if disk queues batch reqs */</i></td></tr>
<tr><th id="326">326</th><td>				<a class="macro" href="#99" title="" data-ref="_M/Dprintf2">Dprintf2</a>(<q>"DiskIOComplete: re-enqueueing pri %d regular req to c %d\n"</q>, req-&gt;priority, queue-&gt;col);</td></tr>
<tr><th id="327">327</th><td>				<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::queueLength" title='RF_DiskQueue_s::queueLength' data-ref="RF_DiskQueue_s::queueLength" data-ref-filename="RF_DiskQueue_s..queueLength">queueLength</a>++;</td></tr>
<tr><th id="328">328</th><td>				(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Enqueue" title='RF_DiskQueueSW_s::Enqueue' data-ref="RF_DiskQueueSW_s::Enqueue" data-ref-filename="RF_DiskQueueSW_s..Enqueue">Enqueue</a>) (<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qHdr" title='RF_DiskQueue_s::qHdr' data-ref="RF_DiskQueue_s::qHdr" data-ref-filename="RF_DiskQueue_s..qHdr">qHdr</a>, <a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a>, <a class="local col9 ref" href="#49req" title='req' data-ref="49req" data-ref-filename="49req">req</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::priority" title='RF_DiskQueueData_s::priority' data-ref="RF_DiskQueueData_s::priority" data-ref-filename="RF_DiskQueueData_s..priority">priority</a>);</td></tr>
<tr><th id="329">329</th><td>				<a class="local col1 ref" href="#51done" title='done' data-ref="51done" data-ref-filename="51done">done</a> = <var>1</var>;</td></tr>
<tr><th id="330">330</th><td>			}</td></tr>
<tr><th id="331">331</th><td>		} <b>else</b> {	</td></tr>
<tr><th id="332">332</th><td>			<a class="macro" href="#98" title="" data-ref="_M/Dprintf1">Dprintf1</a>(<q>"DiskIOComplete: no more requests to extract.\n"</q>, <q>""</q>);</td></tr>
<tr><th id="333">333</th><td>			<a class="local col1 ref" href="#51done" title='done' data-ref="51done" data-ref-filename="51done">done</a> = <var>1</var>;</td></tr>
<tr><th id="334">334</th><td>		}</td></tr>
<tr><th id="335">335</th><td>	}</td></tr>
<tr><th id="336">336</th><td></td></tr>
<tr><th id="337">337</th><td>	<a class="macro" href="rf_diskqueue.h.html#129" title="mutex_exit(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_UNLOCK_QUEUE_MUTEX">RF_UNLOCK_QUEUE_MUTEX</a>(<a class="local col8 ref" href="#48queue" title='queue' data-ref="48queue" data-ref-filename="48queue">queue</a>, <q>"DiskIOComplete"</q>);</td></tr>
<tr><th id="338">338</th><td>}</td></tr>
<tr><th id="339">339</th><td><i>/* promotes accesses tagged with the given parityStripeID from low priority</i></td></tr>
<tr><th id="340">340</th><td><i> * to normal priority.  This promotion is optional, meaning that a queue</i></td></tr>
<tr><th id="341">341</th><td><i> * need not implement it.  If there is no promotion routine associated with</i></td></tr>
<tr><th id="342">342</th><td><i> * a queue, this routine does nothing and returns -1.</i></td></tr>
<tr><th id="343">343</th><td><i> */</i></td></tr>
<tr><th id="344">344</th><td><em>int</em></td></tr>
<tr><th id="345">345</th><td><dfn class="decl def fn" id="rf_DiskIOPromote" title='rf_DiskIOPromote' data-ref="rf_DiskIOPromote" data-ref-filename="rf_DiskIOPromote">rf_DiskIOPromote</dfn>(<a class="typedef" href="raidframevar.h.html#RF_DiskQueue_t" title='RF_DiskQueue_t' data-type='struct RF_DiskQueue_s' data-ref="RF_DiskQueue_t" data-ref-filename="RF_DiskQueue_t">RF_DiskQueue_t</a> *<dfn class="local col2 decl" id="52queue" title='queue' data-type='RF_DiskQueue_t *' data-ref="52queue" data-ref-filename="52queue">queue</dfn>, <a class="typedef" href="raidframevar.h.html#RF_StripeNum_t" title='RF_StripeNum_t' data-type='RF_int64' data-ref="RF_StripeNum_t" data-ref-filename="RF_StripeNum_t">RF_StripeNum_t</a> <dfn class="local col3 decl" id="53parityStripeID" title='parityStripeID' data-type='RF_StripeNum_t' data-ref="53parityStripeID" data-ref-filename="53parityStripeID">parityStripeID</dfn>,</td></tr>
<tr><th id="346">346</th><td>		 <a class="typedef" href="raidframevar.h.html#RF_ReconUnitNum_t" title='RF_ReconUnitNum_t' data-type='int' data-ref="RF_ReconUnitNum_t" data-ref-filename="RF_ReconUnitNum_t">RF_ReconUnitNum_t</a> <dfn class="local col4 decl" id="54which_ru" title='which_ru' data-type='RF_ReconUnitNum_t' data-ref="54which_ru" data-ref-filename="54which_ru">which_ru</dfn>)</td></tr>
<tr><th id="347">347</th><td>{</td></tr>
<tr><th id="348">348</th><td>	<em>int</em>     <dfn class="local col5 decl" id="55retval" title='retval' data-type='int' data-ref="55retval" data-ref-filename="55retval">retval</dfn>;</td></tr>
<tr><th id="349">349</th><td></td></tr>
<tr><th id="350">350</th><td>	<b>if</b> (!<a class="local col2 ref" href="#52queue" title='queue' data-ref="52queue" data-ref-filename="52queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Promote" title='RF_DiskQueueSW_s::Promote' data-ref="RF_DiskQueueSW_s::Promote" data-ref-filename="RF_DiskQueueSW_s..Promote">Promote</a>)</td></tr>
<tr><th id="351">351</th><td>		<b>return</b> (-<var>1</var>);</td></tr>
<tr><th id="352">352</th><td>	<a class="macro" href="rf_diskqueue.h.html#128" title="mutex_enter(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_LOCK_QUEUE_MUTEX">RF_LOCK_QUEUE_MUTEX</a>(<a class="local col2 ref" href="#52queue" title='queue' data-ref="52queue" data-ref-filename="52queue">queue</a>, <q>"DiskIOPromote"</q>);</td></tr>
<tr><th id="353">353</th><td>	<a class="local col5 ref" href="#55retval" title='retval' data-ref="55retval" data-ref-filename="55retval">retval</a> = (<a class="local col2 ref" href="#52queue" title='queue' data-ref="52queue" data-ref-filename="52queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qPtr" title='RF_DiskQueue_s::qPtr' data-ref="RF_DiskQueue_s::qPtr" data-ref-filename="RF_DiskQueue_s..qPtr">qPtr</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueSW_s::Promote" title='RF_DiskQueueSW_s::Promote' data-ref="RF_DiskQueueSW_s::Promote" data-ref-filename="RF_DiskQueueSW_s..Promote">Promote</a>) (<a class="local col2 ref" href="#52queue" title='queue' data-ref="52queue" data-ref-filename="52queue">queue</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueue_s::qHdr" title='RF_DiskQueue_s::qHdr' data-ref="RF_DiskQueue_s::qHdr" data-ref-filename="RF_DiskQueue_s..qHdr">qHdr</a>, <a class="local col3 ref" href="#53parityStripeID" title='parityStripeID' data-ref="53parityStripeID" data-ref-filename="53parityStripeID">parityStripeID</a>, <a class="local col4 ref" href="#54which_ru" title='which_ru' data-ref="54which_ru" data-ref-filename="54which_ru">which_ru</a>);</td></tr>
<tr><th id="354">354</th><td>	<a class="macro" href="rf_diskqueue.h.html#129" title="mutex_exit(&amp;((queue)-&gt;mutex))" data-ref="_M/RF_UNLOCK_QUEUE_MUTEX">RF_UNLOCK_QUEUE_MUTEX</a>(<a class="local col2 ref" href="#52queue" title='queue' data-ref="52queue" data-ref-filename="52queue">queue</a>, <q>"DiskIOPromote"</q>);</td></tr>
<tr><th id="355">355</th><td>	<b>return</b> (<a class="local col5 ref" href="#55retval" title='retval' data-ref="55retval" data-ref-filename="55retval">retval</a>);</td></tr>
<tr><th id="356">356</th><td>}</td></tr>
<tr><th id="357">357</th><td></td></tr>
<tr><th id="358">358</th><td><a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a> *</td></tr>
<tr><th id="359">359</th><td><dfn class="decl def fn" id="rf_CreateDiskQueueData" title='rf_CreateDiskQueueData' data-ref="rf_CreateDiskQueueData" data-ref-filename="rf_CreateDiskQueueData">rf_CreateDiskQueueData</dfn>(<a class="typedef" href="raidframevar.h.html#RF_IoType_t" title='RF_IoType_t' data-type='char' data-ref="RF_IoType_t" data-ref-filename="RF_IoType_t">RF_IoType_t</a> <dfn class="local col6 decl" id="56typ" title='typ' data-type='RF_IoType_t' data-ref="56typ" data-ref-filename="56typ">typ</dfn>, <a class="typedef" href="raidframevar.h.html#RF_SectorNum_t" title='RF_SectorNum_t' data-type='RF_int64' data-ref="RF_SectorNum_t" data-ref-filename="RF_SectorNum_t">RF_SectorNum_t</a> <dfn class="local col7 decl" id="57ssect" title='ssect' data-type='RF_SectorNum_t' data-ref="57ssect" data-ref-filename="57ssect">ssect</dfn>,</td></tr>
<tr><th id="360">360</th><td>		       <a class="typedef" href="raidframevar.h.html#RF_SectorCount_t" title='RF_SectorCount_t' data-type='RF_uint64' data-ref="RF_SectorCount_t" data-ref-filename="RF_SectorCount_t">RF_SectorCount_t</a> <dfn class="local col8 decl" id="58nsect" title='nsect' data-type='RF_SectorCount_t' data-ref="58nsect" data-ref-filename="58nsect">nsect</dfn>, <em>void</em> *<dfn class="local col9 decl" id="59bf" title='bf' data-type='void *' data-ref="59bf" data-ref-filename="59bf">bf</dfn>,</td></tr>
<tr><th id="361">361</th><td>		       <a class="typedef" href="raidframevar.h.html#RF_StripeNum_t" title='RF_StripeNum_t' data-type='RF_int64' data-ref="RF_StripeNum_t" data-ref-filename="RF_StripeNum_t">RF_StripeNum_t</a> <dfn class="local col0 decl" id="60parityStripeID" title='parityStripeID' data-type='RF_StripeNum_t' data-ref="60parityStripeID" data-ref-filename="60parityStripeID">parityStripeID</dfn>,</td></tr>
<tr><th id="362">362</th><td>		       <a class="typedef" href="raidframevar.h.html#RF_ReconUnitNum_t" title='RF_ReconUnitNum_t' data-type='int' data-ref="RF_ReconUnitNum_t" data-ref-filename="RF_ReconUnitNum_t">RF_ReconUnitNum_t</a> <dfn class="local col1 decl" id="61which_ru" title='which_ru' data-type='RF_ReconUnitNum_t' data-ref="61which_ru" data-ref-filename="61which_ru">which_ru</dfn>,</td></tr>
<tr><th id="363">363</th><td>		       <em>int</em> (*<dfn class="local col2 decl" id="62wakeF" title='wakeF' data-type='int (*)(void *, int)' data-ref="62wakeF" data-ref-filename="62wakeF">wakeF</dfn>) (<em>void</em> *, <em>int</em>), <em>void</em> *<dfn class="local col3 decl" id="63arg" title='arg' data-type='void *' data-ref="63arg" data-ref-filename="63arg">arg</dfn>,</td></tr>
<tr><th id="364">364</th><td>		       <a class="typedef" href="rf_acctrace.h.html#RF_AccTraceEntry_t" title='RF_AccTraceEntry_t' data-type='struct RF_acctrace_entry_s' data-ref="RF_AccTraceEntry_t" data-ref-filename="RF_AccTraceEntry_t">RF_AccTraceEntry_t</a> *<dfn class="local col4 decl" id="64tracerec" title='tracerec' data-type='RF_AccTraceEntry_t *' data-ref="64tracerec" data-ref-filename="64tracerec">tracerec</dfn>, <a class="typedef" href="raidframevar.h.html#RF_Raid_t" title='RF_Raid_t' data-type='struct RF_Raid_s' data-ref="RF_Raid_t" data-ref-filename="RF_Raid_t">RF_Raid_t</a> *<dfn class="local col5 decl" id="65raidPtr" title='raidPtr' data-type='RF_Raid_t *' data-ref="65raidPtr" data-ref-filename="65raidPtr">raidPtr</dfn>,</td></tr>
<tr><th id="365">365</th><td>		       <a class="typedef" href="raidframevar.h.html#RF_DiskQueueDataFlags_t" title='RF_DiskQueueDataFlags_t' data-type='RF_uint32' data-ref="RF_DiskQueueDataFlags_t" data-ref-filename="RF_DiskQueueDataFlags_t">RF_DiskQueueDataFlags_t</a> <dfn class="local col6 decl" id="66flags" title='flags' data-type='RF_DiskQueueDataFlags_t' data-ref="66flags" data-ref-filename="66flags">flags</dfn>, <em>void</em> *<dfn class="local col7 decl" id="67kb_proc" title='kb_proc' data-type='void *' data-ref="67kb_proc" data-ref-filename="67kb_proc">kb_proc</dfn>,</td></tr>
<tr><th id="366">366</th><td>		       <em>int</em> <dfn class="local col8 decl" id="68waitflag" title='waitflag' data-type='int' data-ref="68waitflag" data-ref-filename="68waitflag">waitflag</dfn>)</td></tr>
<tr><th id="367">367</th><td>{</td></tr>
<tr><th id="368">368</th><td>	<a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a> *<dfn class="local col9 decl" id="69p" title='p' data-type='RF_DiskQueueData_t *' data-ref="69p" data-ref-filename="69p">p</dfn>;</td></tr>
<tr><th id="369">369</th><td></td></tr>
<tr><th id="370">370</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a> = <a class="ref fn" href="../../sys/pool.h.html#pool_get" title='pool_get' data-ref="pool_get" data-ref-filename="pool_get">pool_get</a>(&amp;<a class="ref" href="rf_netbsd.h.html#rf_pools" title='rf_pools' data-ref="rf_pools" data-ref-filename="rf_pools">rf_pools</a>.<a class="ref field" href="rf_netbsd.h.html#RF_Pools_s::dqd" title='RF_Pools_s::dqd' data-ref="RF_Pools_s::dqd" data-ref-filename="RF_Pools_s..dqd">dqd</a>, <a class="local col8 ref" href="#68waitflag" title='waitflag' data-ref="68waitflag" data-ref-filename="68waitflag">waitflag</a> | <a class="macro" href="../../sys/pool.h.html#162" title="0x8000" data-ref="_M/PR_ZERO">PR_ZERO</a>);</td></tr>
<tr><th id="371">371</th><td>	<b>if</b> (<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="372">372</th><td>		<b>return</b> (<a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="373">373</th><td></td></tr>
<tr><th id="374">374</th><td>	<b>if</b> (<a class="local col8 ref" href="#68waitflag" title='waitflag' data-ref="68waitflag" data-ref-filename="68waitflag">waitflag</a> == <a class="macro" href="../../sys/pool.h.html#150" title="0x01" data-ref="_M/PR_WAITOK">PR_WAITOK</a>) {</td></tr>
<tr><th id="375">375</th><td>		<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::bp" title='RF_DiskQueueData_s::bp' data-ref="RF_DiskQueueData_s::bp" data-ref-filename="RF_DiskQueueData_s..bp">bp</a> = <a class="ref fn" href="../../sys/buf.h.html#getiobuf" title='getiobuf' data-ref="getiobuf" data-ref-filename="getiobuf">getiobuf</a>(<a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="376">376</th><td>	} <b>else</b> {</td></tr>
<tr><th id="377">377</th><td>		<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::bp" title='RF_DiskQueueData_s::bp' data-ref="RF_DiskQueueData_s::bp" data-ref-filename="RF_DiskQueueData_s..bp">bp</a> = <a class="ref fn" href="../../sys/buf.h.html#getiobuf" title='getiobuf' data-ref="getiobuf" data-ref-filename="getiobuf">getiobuf</a>(<a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>);</td></tr>
<tr><th id="378">378</th><td>	}</td></tr>
<tr><th id="379">379</th><td>	<b>if</b> (<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::bp" title='RF_DiskQueueData_s::bp' data-ref="RF_DiskQueueData_s::bp" data-ref-filename="RF_DiskQueueData_s..bp">bp</a> == <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="380">380</th><td>		<a class="ref fn" href="../../sys/pool.h.html#pool_put" title='pool_put' data-ref="pool_put" data-ref-filename="pool_put">pool_put</a>(&amp;<a class="ref" href="rf_netbsd.h.html#rf_pools" title='rf_pools' data-ref="rf_pools" data-ref-filename="rf_pools">rf_pools</a>.<a class="ref field" href="rf_netbsd.h.html#RF_Pools_s::dqd" title='RF_Pools_s::dqd' data-ref="RF_Pools_s::dqd" data-ref-filename="RF_Pools_s..dqd">dqd</a>, <a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>);</td></tr>
<tr><th id="381">381</th><td>		<b>return</b> (<a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="382">382</th><td>	}</td></tr>
<tr><th id="383">383</th><td>	<a class="macro" href="../../sys/types.h.html#346" title="((p-&gt;bp-&gt;b_cflags) |= (0x00000010))" data-ref="_M/SET">SET</a>(<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::bp" title='RF_DiskQueueData_s::bp' data-ref="RF_DiskQueueData_s::bp" data-ref-filename="RF_DiskQueueData_s..bp">bp</a>-&gt;<a class="ref field" href="../../sys/buf.h.html#buf::b_cflags" title='buf::b_cflags' data-ref="buf::b_cflags" data-ref-filename="buf..b_cflags">b_cflags</a>, <a class="macro" href="../../sys/buf.h.html#178" title="0x00000010" data-ref="_M/BC_BUSY">BC_BUSY</a>);	<i>/* mark buffer busy */</i></td></tr>
<tr><th id="384">384</th><td></td></tr>
<tr><th id="385">385</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::sectorOffset" title='RF_DiskQueueData_s::sectorOffset' data-ref="RF_DiskQueueData_s::sectorOffset" data-ref-filename="RF_DiskQueueData_s..sectorOffset">sectorOffset</a> = <a class="local col7 ref" href="#57ssect" title='ssect' data-ref="57ssect" data-ref-filename="57ssect">ssect</a> + <a class="ref" href="rf_optnames.h.html#60" title='rf_protectedSectors' data-ref="rf_protectedSectors" data-ref-filename="rf_protectedSectors">rf_protectedSectors</a>;</td></tr>
<tr><th id="386">386</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::numSector" title='RF_DiskQueueData_s::numSector' data-ref="RF_DiskQueueData_s::numSector" data-ref-filename="RF_DiskQueueData_s..numSector">numSector</a> = <a class="local col8 ref" href="#58nsect" title='nsect' data-ref="58nsect" data-ref-filename="58nsect">nsect</a>;</td></tr>
<tr><th id="387">387</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::type" title='RF_DiskQueueData_s::type' data-ref="RF_DiskQueueData_s::type" data-ref-filename="RF_DiskQueueData_s..type">type</a> = <a class="local col6 ref" href="#56typ" title='typ' data-ref="56typ" data-ref-filename="56typ">typ</a>;</td></tr>
<tr><th id="388">388</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::buf" title='RF_DiskQueueData_s::buf' data-ref="RF_DiskQueueData_s::buf" data-ref-filename="RF_DiskQueueData_s..buf">buf</a> = <a class="local col9 ref" href="#59bf" title='bf' data-ref="59bf" data-ref-filename="59bf">bf</a>;</td></tr>
<tr><th id="389">389</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::parityStripeID" title='RF_DiskQueueData_s::parityStripeID' data-ref="RF_DiskQueueData_s::parityStripeID" data-ref-filename="RF_DiskQueueData_s..parityStripeID">parityStripeID</a> = <a class="local col0 ref" href="#60parityStripeID" title='parityStripeID' data-ref="60parityStripeID" data-ref-filename="60parityStripeID">parityStripeID</a>;</td></tr>
<tr><th id="390">390</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::which_ru" title='RF_DiskQueueData_s::which_ru' data-ref="RF_DiskQueueData_s::which_ru" data-ref-filename="RF_DiskQueueData_s..which_ru">which_ru</a> = <a class="local col1 ref" href="#61which_ru" title='which_ru' data-ref="61which_ru" data-ref-filename="61which_ru">which_ru</a>;</td></tr>
<tr><th id="391">391</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::CompleteFunc" title='RF_DiskQueueData_s::CompleteFunc' data-ref="RF_DiskQueueData_s::CompleteFunc" data-ref-filename="RF_DiskQueueData_s..CompleteFunc">CompleteFunc</a> = <a class="local col2 ref" href="#62wakeF" title='wakeF' data-ref="62wakeF" data-ref-filename="62wakeF">wakeF</a>;</td></tr>
<tr><th id="392">392</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::argument" title='RF_DiskQueueData_s::argument' data-ref="RF_DiskQueueData_s::argument" data-ref-filename="RF_DiskQueueData_s..argument">argument</a> = <a class="local col3 ref" href="#63arg" title='arg' data-ref="63arg" data-ref-filename="63arg">arg</a>;</td></tr>
<tr><th id="393">393</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::next" title='RF_DiskQueueData_s::next' data-ref="RF_DiskQueueData_s::next" data-ref-filename="RF_DiskQueueData_s..next">next</a> = <a class="macro" href="../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="394">394</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::tracerec" title='RF_DiskQueueData_s::tracerec' data-ref="RF_DiskQueueData_s::tracerec" data-ref-filename="RF_DiskQueueData_s..tracerec">tracerec</a> = <a class="local col4 ref" href="#64tracerec" title='tracerec' data-ref="64tracerec" data-ref-filename="64tracerec">tracerec</a>;</td></tr>
<tr><th id="395">395</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::priority" title='RF_DiskQueueData_s::priority' data-ref="RF_DiskQueueData_s::priority" data-ref-filename="RF_DiskQueueData_s..priority">priority</a> = <a class="macro" href="rf_diskqueue.h.html#52" title="1" data-ref="_M/RF_IO_NORMAL_PRIORITY">RF_IO_NORMAL_PRIORITY</a>;</td></tr>
<tr><th id="396">396</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::raidPtr" title='RF_DiskQueueData_s::raidPtr' data-ref="RF_DiskQueueData_s::raidPtr" data-ref-filename="RF_DiskQueueData_s..raidPtr">raidPtr</a> = <a class="local col5 ref" href="#65raidPtr" title='raidPtr' data-ref="65raidPtr" data-ref-filename="65raidPtr">raidPtr</a>;</td></tr>
<tr><th id="397">397</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::flags" title='RF_DiskQueueData_s::flags' data-ref="RF_DiskQueueData_s::flags" data-ref-filename="RF_DiskQueueData_s..flags">flags</a> = <a class="local col6 ref" href="#66flags" title='flags' data-ref="66flags" data-ref-filename="66flags">flags</a>;</td></tr>
<tr><th id="398">398</th><td>	<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::b_proc" title='RF_DiskQueueData_s::b_proc' data-ref="RF_DiskQueueData_s::b_proc" data-ref-filename="RF_DiskQueueData_s..b_proc">b_proc</a> = <a class="local col7 ref" href="#67kb_proc" title='kb_proc' data-ref="67kb_proc" data-ref-filename="67kb_proc">kb_proc</a>;</td></tr>
<tr><th id="399">399</th><td>	<b>return</b> (<a class="local col9 ref" href="#69p" title='p' data-ref="69p" data-ref-filename="69p">p</a>);</td></tr>
<tr><th id="400">400</th><td>}</td></tr>
<tr><th id="401">401</th><td></td></tr>
<tr><th id="402">402</th><td><em>void</em></td></tr>
<tr><th id="403">403</th><td><dfn class="decl def fn" id="rf_FreeDiskQueueData" title='rf_FreeDiskQueueData' data-ref="rf_FreeDiskQueueData" data-ref-filename="rf_FreeDiskQueueData">rf_FreeDiskQueueData</dfn>(<a class="typedef" href="raidframevar.h.html#RF_DiskQueueData_t" title='RF_DiskQueueData_t' data-type='struct RF_DiskQueueData_s' data-ref="RF_DiskQueueData_t" data-ref-filename="RF_DiskQueueData_t">RF_DiskQueueData_t</a> *<dfn class="local col0 decl" id="70p" title='p' data-type='RF_DiskQueueData_t *' data-ref="70p" data-ref-filename="70p">p</dfn>)</td></tr>
<tr><th id="404">404</th><td>{</td></tr>
<tr><th id="405">405</th><td>	<em>int</em> <dfn class="local col1 decl" id="71s" title='s' data-type='int' data-ref="71s" data-ref-filename="71s">s</dfn>;</td></tr>
<tr><th id="406">406</th><td>	<a class="local col1 ref" href="#71s" title='s' data-ref="71s" data-ref-filename="71s">s</a> = <a class="macro" href="../../sys/intr.h.html#91" title="splvm()" data-ref="_M/splbio">splbio</a>();		<i>/* XXX protect only pool_put, or neither? */</i></td></tr>
<tr><th id="407">407</th><td>	<a class="ref fn" href="../../sys/buf.h.html#putiobuf" title='putiobuf' data-ref="putiobuf" data-ref-filename="putiobuf">putiobuf</a>(<a class="local col0 ref" href="#70p" title='p' data-ref="70p" data-ref-filename="70p">p</a>-&gt;<a class="ref field" href="rf_diskqueue.h.html#RF_DiskQueueData_s::bp" title='RF_DiskQueueData_s::bp' data-ref="RF_DiskQueueData_s::bp" data-ref-filename="RF_DiskQueueData_s..bp">bp</a>);</td></tr>
<tr><th id="408">408</th><td>	<a class="ref fn" href="../../sys/pool.h.html#pool_put" title='pool_put' data-ref="pool_put" data-ref-filename="pool_put">pool_put</a>(&amp;<a class="ref" href="rf_netbsd.h.html#rf_pools" title='rf_pools' data-ref="rf_pools" data-ref-filename="rf_pools">rf_pools</a>.<a class="ref field" href="rf_netbsd.h.html#RF_Pools_s::dqd" title='RF_Pools_s::dqd' data-ref="RF_Pools_s::dqd" data-ref-filename="RF_Pools_s..dqd">dqd</a>, <a class="local col0 ref" href="#70p" title='p' data-ref="70p" data-ref-filename="70p">p</a>);</td></tr>
<tr><th id="409">409</th><td>	<a class="macro" href="../../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col1 ref" href="#71s" title='s' data-ref="71s" data-ref-filename="71s">s</a>);</td></tr>
<tr><th id="410">410</th><td>}</td></tr>
<tr><th id="411">411</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
