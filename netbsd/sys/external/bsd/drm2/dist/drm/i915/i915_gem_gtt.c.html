<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>i915_gem_gtt.c source code [netbsd/sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c'; var root_path = '../../../../../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../../../../../..'>netbsd</a>/<a href='../../../../../..'>sys</a>/<a href='../../../../..'>external</a>/<a href='../../../..'>bsd</a>/<a href='../../..'>drm2</a>/<a href='../..'>dist</a>/<a href='..'>drm</a>/<a href='./'>i915</a>/<a href='i915_gem_gtt.c.html'>i915_gem_gtt.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: i915_gem_gtt.c,v 1.15 2018/08/27 14:53:54 riastradh Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * Copyright © 2010 Daniel Vetter</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright © 2011-2014 Intel Corporation</i></td></tr>
<tr><th id="6">6</th><td><i> *</i></td></tr>
<tr><th id="7">7</th><td><i> * Permission is hereby granted, free of charge, to any person obtaining a</i></td></tr>
<tr><th id="8">8</th><td><i> * copy of this software and associated documentation files (the "Software"),</i></td></tr>
<tr><th id="9">9</th><td><i> * to deal in the Software without restriction, including without limitation</i></td></tr>
<tr><th id="10">10</th><td><i> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</i></td></tr>
<tr><th id="11">11</th><td><i> * and/or sell copies of the Software, and to permit persons to whom the</i></td></tr>
<tr><th id="12">12</th><td><i> * Software is furnished to do so, subject to the following conditions:</i></td></tr>
<tr><th id="13">13</th><td><i> *</i></td></tr>
<tr><th id="14">14</th><td><i> * The above copyright notice and this permission notice (including the next</i></td></tr>
<tr><th id="15">15</th><td><i> * paragraph) shall be included in all copies or substantial portions of the</i></td></tr>
<tr><th id="16">16</th><td><i> * Software.</i></td></tr>
<tr><th id="17">17</th><td><i> *</i></td></tr>
<tr><th id="18">18</th><td><i> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</i></td></tr>
<tr><th id="19">19</th><td><i> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</i></td></tr>
<tr><th id="20">20</th><td><i> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</i></td></tr>
<tr><th id="21">21</th><td><i> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</i></td></tr>
<tr><th id="22">22</th><td><i> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</i></td></tr>
<tr><th id="23">23</th><td><i> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</i></td></tr>
<tr><th id="24">24</th><td><i> * IN THE SOFTWARE.</i></td></tr>
<tr><th id="25">25</th><td><i> *</i></td></tr>
<tr><th id="26">26</th><td><i> */</i></td></tr>
<tr><th id="27">27</th><td></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../../../../../../sys/cdefs.h.html">&lt;sys/cdefs.h&gt;</a></u></td></tr>
<tr><th id="29">29</th><td><a class="macro" href="../../../../../../sys/cdefs_elf.h.html#156" title="__asm(&quot;.pushsection &quot; &quot;.ident&quot; &quot;\n&quot; &quot;.asciz \&quot;&quot; &quot;$NetBSD: i915_gem_gtt.c,v 1.15 2018/08/27 14:53:54 riastradh Exp $&quot; &quot;\&quot;\n&quot; &quot;.popsection&quot;)" data-ref="_M/__KERNEL_RCSID">__KERNEL_RCSID</a>(<var>0</var>, <q>"$NetBSD: i915_gem_gtt.c,v 1.15 2018/08/27 14:53:54 riastradh Exp $"</q>);</td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="../../../include/linux/bitmap.h.html">&lt;linux/bitmap.h&gt;</a></u></td></tr>
<tr><th id="32">32</th><td><u>#include <a href="../../../../common/include/linux/err.h.html">&lt;linux/err.h&gt;</a></u></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../../../include/linux/seq_file.h.html">&lt;linux/seq_file.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><u>#include <a href="../../include/drm/drmP.h.html">&lt;drm/drmP.h&gt;</a></u></td></tr>
<tr><th id="35">35</th><td><u>#include <a href="../../include/drm/i915_drm.h.html">&lt;drm/i915_drm.h&gt;</a></u></td></tr>
<tr><th id="36">36</th><td><u>#include <a href="i915_drv.h.html">"i915_drv.h"</a></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="i915_vgpu.h.html">"i915_vgpu.h"</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="../../../include/i915_trace.h.html">"i915_trace.h"</a></u></td></tr>
<tr><th id="39">39</th><td><u>#include <a href="intel_drv.h.html">"intel_drv.h"</a></u></td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td><u>#<span data-ppcond="41">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="42">42</th><td><u>#include &lt;drm/bus_dma_hacks.h&gt;</u></td></tr>
<tr><th id="43">43</th><td><u>#include &lt;x86/machdep.h&gt;</u></td></tr>
<tr><th id="44">44</th><td><u>#include &lt;x86/pte.h&gt;</u></td></tr>
<tr><th id="45">45</th><td><u>#define	_PAGE_PRESENT	PG_V	/* 0x01 PTE is present / valid */</u></td></tr>
<tr><th id="46">46</th><td><u>#define	_PAGE_RW	PG_RW	/* 0x02 read/write */</u></td></tr>
<tr><th id="47">47</th><td><u>#define	_PAGE_PWT	PG_WT	/* 0x08 write-through */</u></td></tr>
<tr><th id="48">48</th><td><u>#define	_PAGE_PCD	PG_N	/* 0x10 page cache disabled / non-cacheable */</u></td></tr>
<tr><th id="49">49</th><td><u>#define	_PAGE_PAT	PG_PAT	/* 0x80 page attribute table on PTE */</u></td></tr>
<tr><th id="50">50</th><td><u>#<span data-ppcond="41">endif</span></u></td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages">/**</i></td></tr>
<tr><th id="53">53</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * DOC: Global GTT views</i></td></tr>
<tr><th id="54">54</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="55">55</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Background and previous state</i></td></tr>
<tr><th id="56">56</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="57">57</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Historically objects could exists (be bound) in global GTT space only as</i></td></tr>
<tr><th id="58">58</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * singular instances with a view representing all of the object's backing pages</i></td></tr>
<tr><th id="59">59</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * in a linear fashion. This view will be called a normal view.</i></td></tr>
<tr><th id="60">60</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="61">61</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * To support multiple views of the same object, where the number of mapped</i></td></tr>
<tr><th id="62">62</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * pages is not equal to the backing store, or where the layout of the pages</i></td></tr>
<tr><th id="63">63</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * is not linear, concept of a GGTT view was added.</i></td></tr>
<tr><th id="64">64</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="65">65</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * One example of an alternative view is a stereo display driven by a single</i></td></tr>
<tr><th id="66">66</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * image. In this case we would have a framebuffer looking like this</i></td></tr>
<tr><th id="67">67</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * (2x2 pages):</i></td></tr>
<tr><th id="68">68</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="69">69</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *    12</i></td></tr>
<tr><th id="70">70</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *    34</i></td></tr>
<tr><th id="71">71</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="72">72</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Above would represent a normal GGTT view as normally mapped for GPU or CPU</i></td></tr>
<tr><th id="73">73</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * rendering. In contrast, fed to the display engine would be an alternative</i></td></tr>
<tr><th id="74">74</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * view which could look something like this:</i></td></tr>
<tr><th id="75">75</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="76">76</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *   1212</i></td></tr>
<tr><th id="77">77</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *   3434</i></td></tr>
<tr><th id="78">78</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="79">79</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * In this example both the size and layout of pages in the alternative view is</i></td></tr>
<tr><th id="80">80</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * different from the normal view.</i></td></tr>
<tr><th id="81">81</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="82">82</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Implementation and usage</i></td></tr>
<tr><th id="83">83</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="84">84</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * GGTT views are implemented using VMAs and are distinguished via enum</i></td></tr>
<tr><th id="85">85</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * i915_ggtt_view_type and struct i915_ggtt_view.</i></td></tr>
<tr><th id="86">86</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="87">87</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * A new flavour of core GEM functions which work with GGTT bound objects were</i></td></tr>
<tr><th id="88">88</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * added with the _ggtt_ infix, and sometimes with _view postfix to avoid</i></td></tr>
<tr><th id="89">89</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * renaming  in large amounts of code. They take the struct i915_ggtt_view</i></td></tr>
<tr><th id="90">90</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * parameter encapsulating all metadata required to implement a view.</i></td></tr>
<tr><th id="91">91</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="92">92</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * As a helper for callers which are only interested in the normal view,</i></td></tr>
<tr><th id="93">93</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * globally const i915_ggtt_view_normal singleton instance exists. All old core</i></td></tr>
<tr><th id="94">94</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * GEM API functions, the ones not taking the view parameter, are operating on,</i></td></tr>
<tr><th id="95">95</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * or with the normal GGTT view.</i></td></tr>
<tr><th id="96">96</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="97">97</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Code wanting to add or use a new GGTT view needs to:</i></td></tr>
<tr><th id="98">98</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="99">99</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * 1. Add a new enum with a suitable name.</i></td></tr>
<tr><th id="100">100</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * 2. Extend the metadata in the i915_ggtt_view structure if required.</i></td></tr>
<tr><th id="101">101</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * 3. Add support to i915_get_vma_pages().</i></td></tr>
<tr><th id="102">102</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="103">103</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * New views are required to build a scatter-gather table from within the</i></td></tr>
<tr><th id="104">104</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * i915_get_vma_pages function. This table is stored in the vma.ggtt_view and</i></td></tr>
<tr><th id="105">105</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * exists for the lifetime of an VMA.</i></td></tr>
<tr><th id="106">106</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="107">107</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * Core API is designed to have copy semantics which means that passed in</i></td></tr>
<tr><th id="108">108</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * struct i915_ggtt_view does not need to be persistent (left around after</i></td></tr>
<tr><th id="109">109</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> * calling the core API functions).</i></td></tr>
<tr><th id="110">110</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> *</i></td></tr>
<tr><th id="111">111</th><td><i class="doc" data-doc="i915_get_ggtt_vma_pages"> */</i></td></tr>
<tr><th id="112">112</th><td></td></tr>
<tr><th id="113">113</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="114">114</th><td><a class="tu decl fn" href="#i915_get_ggtt_vma_pages" title='i915_get_ggtt_vma_pages' data-type='int i915_get_ggtt_vma_pages(struct i915_vma * vma)' data-ref="i915_get_ggtt_vma_pages" data-ref-filename="i915_get_ggtt_vma_pages">i915_get_ggtt_vma_pages</a>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col6 decl" id="36vma" title='vma' data-type='struct i915_vma *' data-ref="36vma" data-ref-filename="36vma">vma</dfn>);</td></tr>
<tr><th id="115">115</th><td></td></tr>
<tr><th id="116">116</th><td><em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> <dfn class="decl def" id="i915_ggtt_view_normal" title='i915_ggtt_view_normal' data-ref="i915_ggtt_view_normal" data-ref-filename="i915_ggtt_view_normal">i915_ggtt_view_normal</dfn>;</td></tr>
<tr><th id="117">117</th><td><em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> <dfn class="decl def" id="i915_ggtt_view_rotated" title='i915_ggtt_view_rotated' data-ref="i915_ggtt_view_rotated" data-ref-filename="i915_ggtt_view_rotated">i915_ggtt_view_rotated</dfn> = {</td></tr>
<tr><th id="118">118</th><td>        .<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> = <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_ROTATED" title='I915_GGTT_VIEW_ROTATED' data-ref="I915_GGTT_VIEW_ROTATED" data-ref-filename="I915_GGTT_VIEW_ROTATED">I915_GGTT_VIEW_ROTATED</a></td></tr>
<tr><th id="119">119</th><td>};</td></tr>
<tr><th id="120">120</th><td></td></tr>
<tr><th id="121">121</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="sanitize_enable_ppgtt" title='sanitize_enable_ppgtt' data-type='int sanitize_enable_ppgtt(struct drm_device * dev, int enable_ppgtt)' data-ref="sanitize_enable_ppgtt" data-ref-filename="sanitize_enable_ppgtt">sanitize_enable_ppgtt</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="37dev" title='dev' data-type='struct drm_device *' data-ref="37dev" data-ref-filename="37dev">dev</dfn>, <em>int</em> <dfn class="local col8 decl" id="38enable_ppgtt" title='enable_ppgtt' data-type='int' data-ref="38enable_ppgtt" data-ref-filename="38enable_ppgtt">enable_ppgtt</dfn>)</td></tr>
<tr><th id="122">122</th><td>{</td></tr>
<tr><th id="123">123</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col9 decl" id="39has_aliasing_ppgtt" title='has_aliasing_ppgtt' data-type='_Bool' data-ref="39has_aliasing_ppgtt" data-ref-filename="39has_aliasing_ppgtt">has_aliasing_ppgtt</dfn>;</td></tr>
<tr><th id="124">124</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col0 decl" id="40has_full_ppgtt" title='has_full_ppgtt' data-type='_Bool' data-ref="40has_full_ppgtt" data-ref-filename="40has_full_ppgtt">has_full_ppgtt</dfn>;</td></tr>
<tr><th id="125">125</th><td></td></tr>
<tr><th id="126">126</th><td>	<a class="local col9 ref" href="#39has_aliasing_ppgtt" title='has_aliasing_ppgtt' data-ref="39has_aliasing_ppgtt" data-ref-filename="39has_aliasing_ppgtt">has_aliasing_ppgtt</a> = <a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>6</var>;</td></tr>
<tr><th id="127">127</th><td>	<a class="local col0 ref" href="#40has_full_ppgtt" title='has_full_ppgtt' data-ref="40has_full_ppgtt" data-ref-filename="40has_full_ppgtt">has_full_ppgtt</a> = <a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>7</var>;</td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>))</td></tr>
<tr><th id="130">130</th><td>		<a class="local col0 ref" href="#40has_full_ppgtt" title='has_full_ppgtt' data-ref="40has_full_ppgtt" data-ref-filename="40has_full_ppgtt">has_full_ppgtt</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>; <i>/* emulation is too hard */</i></td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td>	<i>/*</i></td></tr>
<tr><th id="133">133</th><td><i>	 * We don't allow disabling PPGTT for gen9+ as it's a requirement for</i></td></tr>
<tr><th id="134">134</th><td><i>	 * execlists, the sole mechanism available to submit work.</i></td></tr>
<tr><th id="135">135</th><td><i>	 */</i></td></tr>
<tr><th id="136">136</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>9</var> &amp;&amp;</td></tr>
<tr><th id="137">137</th><td>	    (<a class="local col8 ref" href="#38enable_ppgtt" title='enable_ppgtt' data-ref="38enable_ppgtt" data-ref-filename="38enable_ppgtt">enable_ppgtt</a> == <var>0</var> || !<a class="local col9 ref" href="#39has_aliasing_ppgtt" title='has_aliasing_ppgtt' data-ref="39has_aliasing_ppgtt" data-ref-filename="39has_aliasing_ppgtt">has_aliasing_ppgtt</a>))</td></tr>
<tr><th id="138">138</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="139">139</th><td></td></tr>
<tr><th id="140">140</th><td>	<b>if</b> (<a class="local col8 ref" href="#38enable_ppgtt" title='enable_ppgtt' data-ref="38enable_ppgtt" data-ref-filename="38enable_ppgtt">enable_ppgtt</a> == <var>1</var>)</td></tr>
<tr><th id="141">141</th><td>		<b>return</b> <var>1</var>;</td></tr>
<tr><th id="142">142</th><td></td></tr>
<tr><th id="143">143</th><td>	<b>if</b> (<a class="local col8 ref" href="#38enable_ppgtt" title='enable_ppgtt' data-ref="38enable_ppgtt" data-ref-filename="38enable_ppgtt">enable_ppgtt</a> == <var>2</var> &amp;&amp; <a class="local col0 ref" href="#40has_full_ppgtt" title='has_full_ppgtt' data-ref="40has_full_ppgtt" data-ref-filename="40has_full_ppgtt">has_full_ppgtt</a>)</td></tr>
<tr><th id="144">144</th><td>		<b>return</b> <var>2</var>;</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td><u>#<span data-ppcond="146">ifdef</span> <span class="macro" data-ref="_M/CONFIG_INTEL_IOMMU">CONFIG_INTEL_IOMMU</span></u></td></tr>
<tr><th id="147">147</th><td>	<i>/* Disable ppgtt on SNB if VT-d is on. */</i></td></tr>
<tr><th id="148">148</th><td>	<b>if</b> (INTEL_INFO(dev)-&gt;gen == <var>6</var> &amp;&amp; intel_iommu_gfx_mapped) {</td></tr>
<tr><th id="149">149</th><td>		DRM_INFO(<q>"Disabling PPGTT because VT-d is on\n"</q>);</td></tr>
<tr><th id="150">150</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="151">151</th><td>	}</td></tr>
<tr><th id="152">152</th><td><u>#<span data-ppcond="146">endif</span></u></td></tr>
<tr><th id="153">153</th><td></td></tr>
<tr><th id="154">154</th><td>	<i>/* Early VLV doesn't have this */</i></td></tr>
<tr><th id="155">155</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2557" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview)" data-ref="_M/IS_VALLEYVIEW">IS_VALLEYVIEW</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>) &amp;&amp; !<a class="macro" href="i915_drv.h.html#2558" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 8))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>) &amp;&amp;</td></tr>
<tr><th id="156">156</th><td>	    <a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>-&gt;<a class="ref field" href="../../../include/linux/pci.h.html#pci_dev::revision" title='pci_dev::revision' data-ref="pci_dev::revision" data-ref-filename="pci_dev..revision">revision</a> &lt; <var>0xb</var>) {</td></tr>
<tr><th id="157">157</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;disabling PPGTT on pre-B3 step VLV\n&quot;); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"disabling PPGTT on pre-B3 step VLV\n"</q>);</td></tr>
<tr><th id="158">158</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="159">159</th><td>	}</td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col7 ref" href="#37dev" title='dev' data-ref="37dev" data-ref-filename="37dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>8</var> &amp;&amp; <a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_execlists" title='i915_params::enable_execlists' data-ref="i915_params::enable_execlists" data-ref-filename="i915_params..enable_execlists">enable_execlists</a>)</td></tr>
<tr><th id="162">162</th><td>		<b>return</b> <var>2</var>;</td></tr>
<tr><th id="163">163</th><td>	<b>else</b></td></tr>
<tr><th id="164">164</th><td>		<b>return</b> <a class="local col9 ref" href="#39has_aliasing_ppgtt" title='has_aliasing_ppgtt' data-ref="39has_aliasing_ppgtt" data-ref-filename="39has_aliasing_ppgtt">has_aliasing_ppgtt</a> ? <var>1</var> : <var>0</var>;</td></tr>
<tr><th id="165">165</th><td>}</td></tr>
<tr><th id="166">166</th><td></td></tr>
<tr><th id="167">167</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="ppgtt_bind_vma" title='ppgtt_bind_vma' data-type='int ppgtt_bind_vma(struct i915_vma * vma, enum i915_cache_level cache_level, u32 unused)' data-ref="ppgtt_bind_vma" data-ref-filename="ppgtt_bind_vma">ppgtt_bind_vma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col1 decl" id="41vma" title='vma' data-type='struct i915_vma *' data-ref="41vma" data-ref-filename="41vma">vma</dfn>,</td></tr>
<tr><th id="168">168</th><td>			  <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col2 decl" id="42cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="42cache_level" data-ref-filename="42cache_level">cache_level</dfn>,</td></tr>
<tr><th id="169">169</th><td>			  <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col3 decl" id="43unused" title='unused' data-type='u32' data-ref="43unused" data-ref-filename="43unused">unused</dfn>)</td></tr>
<tr><th id="170">170</th><td>{</td></tr>
<tr><th id="171">171</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col4 decl" id="44pte_flags" title='pte_flags' data-type='u32' data-ref="44pte_flags" data-ref-filename="44pte_flags">pte_flags</dfn> = <var>0</var>;</td></tr>
<tr><th id="172">172</th><td></td></tr>
<tr><th id="173">173</th><td>	<i>/* Currently applicable only to VLV */</i></td></tr>
<tr><th id="174">174</th><td>	<b>if</b> (<a class="local col1 ref" href="#41vma" title='vma' data-ref="41vma" data-ref-filename="41vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::gt_ro" title='drm_i915_gem_object::gt_ro' data-ref="drm_i915_gem_object::gt_ro" data-ref-filename="drm_i915_gem_object..gt_ro">gt_ro</a>)</td></tr>
<tr><th id="175">175</th><td>		<a class="local col4 ref" href="#44pte_flags" title='pte_flags' data-ref="44pte_flags" data-ref-filename="44pte_flags">pte_flags</a> |= <a class="macro" href="i915_gem_gtt.h.html#334" title="(1&lt;&lt;0)" data-ref="_M/PTE_READ_ONLY">PTE_READ_ONLY</a>;</td></tr>
<tr><th id="176">176</th><td></td></tr>
<tr><th id="177">177</th><td>	<a class="local col1 ref" href="#41vma" title='vma' data-ref="41vma" data-ref-filename="41vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a>(<a class="local col1 ref" href="#41vma" title='vma' data-ref="41vma" data-ref-filename="41vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>, <a class="local col1 ref" href="#41vma" title='vma' data-ref="41vma" data-ref-filename="41vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::pages" title='drm_i915_gem_object::pages' data-ref="drm_i915_gem_object::pages" data-ref-filename="drm_i915_gem_object..pages">pages</a>, <a class="local col1 ref" href="#41vma" title='vma' data-ref="41vma" data-ref-filename="41vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="178">178</th><td>				<a class="local col2 ref" href="#42cache_level" title='cache_level' data-ref="42cache_level" data-ref-filename="42cache_level">cache_level</a>, <a class="local col4 ref" href="#44pte_flags" title='pte_flags' data-ref="44pte_flags" data-ref-filename="44pte_flags">pte_flags</a>);</td></tr>
<tr><th id="179">179</th><td></td></tr>
<tr><th id="180">180</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="181">181</th><td>}</td></tr>
<tr><th id="182">182</th><td></td></tr>
<tr><th id="183">183</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="ppgtt_unbind_vma" title='ppgtt_unbind_vma' data-type='void ppgtt_unbind_vma(struct i915_vma * vma)' data-ref="ppgtt_unbind_vma" data-ref-filename="ppgtt_unbind_vma">ppgtt_unbind_vma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col5 decl" id="45vma" title='vma' data-type='struct i915_vma *' data-ref="45vma" data-ref-filename="45vma">vma</dfn>)</td></tr>
<tr><th id="184">184</th><td>{</td></tr>
<tr><th id="185">185</th><td>	<a class="local col5 ref" href="#45vma" title='vma' data-ref="45vma" data-ref-filename="45vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(<a class="local col5 ref" href="#45vma" title='vma' data-ref="45vma" data-ref-filename="45vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>,</td></tr>
<tr><th id="186">186</th><td>			     <a class="local col5 ref" href="#45vma" title='vma' data-ref="45vma" data-ref-filename="45vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="187">187</th><td>			     <a class="local col5 ref" href="#45vma" title='vma' data-ref="45vma" data-ref-filename="45vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>,</td></tr>
<tr><th id="188">188</th><td>			     <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="189">189</th><td>}</td></tr>
<tr><th id="190">190</th><td></td></tr>
<tr><th id="191">191</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="tu decl def fn" id="gen8_pte_encode" title='gen8_pte_encode' data-type='gen8_pte_t gen8_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid)' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col6 decl" id="46addr" title='addr' data-type='dma_addr_t' data-ref="46addr" data-ref-filename="46addr">addr</dfn>,</td></tr>
<tr><th id="192">192</th><td>				  <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col7 decl" id="47level" title='level' data-type='enum i915_cache_level' data-ref="47level" data-ref-filename="47level">level</dfn>,</td></tr>
<tr><th id="193">193</th><td>				  <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col8 decl" id="48valid" title='valid' data-type='_Bool' data-ref="48valid" data-ref-filename="48valid">valid</dfn>)</td></tr>
<tr><th id="194">194</th><td>{</td></tr>
<tr><th id="195">195</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col9 decl" id="49pte" title='pte' data-type='gen8_pte_t' data-ref="49pte" data-ref-filename="49pte">pte</dfn> = valid ? <span class='error' title="use of undeclared identifier &apos;_PAGE_PRESENT&apos;">_PAGE_PRESENT</span> | <span class='error' title="use of undeclared identifier &apos;_PAGE_RW&apos;">_PAGE_RW</span> : <var>0</var>;</td></tr>
<tr><th id="196">196</th><td>	<a class="local col9 ref" href="#49pte" title='pte' data-ref="49pte" data-ref-filename="49pte">pte</a> |= <a class="local col6 ref" href="#46addr" title='addr' data-ref="46addr" data-ref-filename="46addr">addr</a>;</td></tr>
<tr><th id="197">197</th><td></td></tr>
<tr><th id="198">198</th><td>	<b>switch</b> (<a class="local col7 ref" href="#47level" title='level' data-ref="47level" data-ref-filename="47level">level</a>) {</td></tr>
<tr><th id="199">199</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>:</td></tr>
<tr><th id="200">200</th><td>		pte |= <a class="macro" href="i915_gem_gtt.h.html#117" title="(_PAGE_PWT | _PAGE_PCD)" data-ref="_M/PPAT_UNCACHED_INDEX">PPAT_UNCACHED_INDEX</a>;</td></tr>
<tr><th id="201">201</th><td>		<b>break</b>;</td></tr>
<tr><th id="202">202</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_WT" title='I915_CACHE_WT' data-ref="I915_CACHE_WT" data-ref-filename="I915_CACHE_WT">I915_CACHE_WT</a>:</td></tr>
<tr><th id="203">203</th><td>		pte |= <a class="macro" href="i915_gem_gtt.h.html#120" title="_PAGE_PCD" data-ref="_M/PPAT_DISPLAY_ELLC_INDEX">PPAT_DISPLAY_ELLC_INDEX</a>;</td></tr>
<tr><th id="204">204</th><td>		<b>break</b>;</td></tr>
<tr><th id="205">205</th><td>	<b>default</b>:</td></tr>
<tr><th id="206">206</th><td>		pte |= <a class="macro" href="i915_gem_gtt.h.html#119" title="_PAGE_PAT" data-ref="_M/PPAT_CACHED_INDEX">PPAT_CACHED_INDEX</a>;</td></tr>
<tr><th id="207">207</th><td>		<b>break</b>;</td></tr>
<tr><th id="208">208</th><td>	}</td></tr>
<tr><th id="209">209</th><td></td></tr>
<tr><th id="210">210</th><td>	<b>return</b> <a class="local col9 ref" href="#49pte" title='pte' data-ref="49pte" data-ref-filename="49pte">pte</a>;</td></tr>
<tr><th id="211">211</th><td>}</td></tr>
<tr><th id="212">212</th><td></td></tr>
<tr><th id="213">213</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen8_pde_t" title='gen8_pde_t' data-type='uint64_t' data-ref="gen8_pde_t" data-ref-filename="gen8_pde_t">gen8_pde_t</a> <dfn class="tu decl def fn" id="gen8_pde_encode" title='gen8_pde_encode' data-type='gen8_pde_t gen8_pde_encode(const dma_addr_t addr, const enum i915_cache_level level)' data-ref="gen8_pde_encode" data-ref-filename="gen8_pde_encode">gen8_pde_encode</dfn>(<em>const</em> <a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col0 decl" id="50addr" title='addr' data-type='const dma_addr_t' data-ref="50addr" data-ref-filename="50addr">addr</dfn>,</td></tr>
<tr><th id="214">214</th><td>				  <em>const</em> <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col1 decl" id="51level" title='level' data-type='const enum i915_cache_level' data-ref="51level" data-ref-filename="51level">level</dfn>)</td></tr>
<tr><th id="215">215</th><td>{</td></tr>
<tr><th id="216">216</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pde_t" title='gen8_pde_t' data-type='uint64_t' data-ref="gen8_pde_t" data-ref-filename="gen8_pde_t">gen8_pde_t</a> <dfn class="local col2 decl" id="52pde" title='pde' data-type='gen8_pde_t' data-ref="52pde" data-ref-filename="52pde">pde</dfn> = <span class='error' title="use of undeclared identifier &apos;_PAGE_PRESENT&apos;">_PAGE_PRESENT</span> | <span class='error' title="use of undeclared identifier &apos;_PAGE_RW&apos;">_PAGE_RW</span>;</td></tr>
<tr><th id="217">217</th><td>	<a class="local col2 ref" href="#52pde" title='pde' data-ref="52pde" data-ref-filename="52pde">pde</a> |= <a class="local col0 ref" href="#50addr" title='addr' data-ref="50addr" data-ref-filename="50addr">addr</a>;</td></tr>
<tr><th id="218">218</th><td>	<b>if</b> (<a class="local col1 ref" href="#51level" title='level' data-ref="51level" data-ref-filename="51level">level</a> != <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>)</td></tr>
<tr><th id="219">219</th><td>		<a class="local col2 ref" href="#52pde" title='pde' data-ref="52pde" data-ref-filename="52pde">pde</a> |= <a class="macro" href="i915_gem_gtt.h.html#118" title="0" data-ref="_M/PPAT_CACHED_PDE_INDEX">PPAT_CACHED_PDE_INDEX</a>;</td></tr>
<tr><th id="220">220</th><td>	<b>else</b></td></tr>
<tr><th id="221">221</th><td>		pde |= <a class="macro" href="i915_gem_gtt.h.html#117" title="(_PAGE_PWT | _PAGE_PCD)" data-ref="_M/PPAT_UNCACHED_INDEX">PPAT_UNCACHED_INDEX</a>;</td></tr>
<tr><th id="222">222</th><td>	<b>return</b> <a class="local col2 ref" href="#52pde" title='pde' data-ref="52pde" data-ref-filename="52pde">pde</a>;</td></tr>
<tr><th id="223">223</th><td>}</td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td><u>#define <dfn class="macro" id="_M/gen8_pdpe_encode" data-ref="_M/gen8_pdpe_encode">gen8_pdpe_encode</dfn> <a class="tu ref fn" href="#gen8_pde_encode" title='gen8_pde_encode' data-use='c' data-ref="gen8_pde_encode" data-ref-filename="gen8_pde_encode">gen8_pde_encode</a></u></td></tr>
<tr><th id="226">226</th><td><u>#define <dfn class="macro" id="_M/gen8_pml4e_encode" data-ref="_M/gen8_pml4e_encode">gen8_pml4e_encode</dfn> <a class="tu ref fn" href="#gen8_pde_encode" title='gen8_pde_encode' data-use='c' data-ref="gen8_pde_encode" data-ref-filename="gen8_pde_encode">gen8_pde_encode</a></u></td></tr>
<tr><th id="227">227</th><td></td></tr>
<tr><th id="228">228</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="tu decl def fn" id="snb_pte_encode" title='snb_pte_encode' data-type='gen6_pte_t snb_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid, u32 unused)' data-ref="snb_pte_encode" data-ref-filename="snb_pte_encode">snb_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col3 decl" id="53addr" title='addr' data-type='dma_addr_t' data-ref="53addr" data-ref-filename="53addr">addr</dfn>,</td></tr>
<tr><th id="229">229</th><td>				 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col4 decl" id="54level" title='level' data-type='enum i915_cache_level' data-ref="54level" data-ref-filename="54level">level</dfn>,</td></tr>
<tr><th id="230">230</th><td>				 <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col5 decl" id="55valid" title='valid' data-type='_Bool' data-ref="55valid" data-ref-filename="55valid">valid</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col6 decl" id="56unused" title='unused' data-type='u32' data-ref="56unused" data-ref-filename="56unused">unused</dfn>)</td></tr>
<tr><th id="231">231</th><td>{</td></tr>
<tr><th id="232">232</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col7 decl" id="57pte" title='pte' data-type='gen6_pte_t' data-ref="57pte" data-ref-filename="57pte">pte</dfn> = <a class="local col5 ref" href="#55valid" title='valid' data-ref="55valid" data-ref-filename="55valid">valid</a> ? <a class="macro" href="i915_gem_gtt.h.html#56" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PTE_VALID">GEN6_PTE_VALID</a> : <var>0</var>;</td></tr>
<tr><th id="233">233</th><td>	<a class="local col7 ref" href="#57pte" title='pte' data-ref="57pte" data-ref-filename="57pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#52" title="((addr) | (((addr) &gt;&gt; 28) &amp; 0xff0))" data-ref="_M/GEN6_PTE_ADDR_ENCODE">GEN6_PTE_ADDR_ENCODE</a>(<a class="local col3 ref" href="#53addr" title='addr' data-ref="53addr" data-ref-filename="53addr">addr</a>);</td></tr>
<tr><th id="234">234</th><td></td></tr>
<tr><th id="235">235</th><td>	<b>switch</b> (<a class="local col4 ref" href="#54level" title='level' data-ref="54level" data-ref-filename="54level">level</a>) {</td></tr>
<tr><th id="236">236</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_L3_LLC" title='I915_CACHE_L3_LLC' data-ref="I915_CACHE_L3_LLC" data-ref-filename="I915_CACHE_L3_LLC">I915_CACHE_L3_LLC</a>:</td></tr>
<tr><th id="237">237</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>:</td></tr>
<tr><th id="238">238</th><td>		<a class="local col7 ref" href="#57pte" title='pte' data-ref="57pte" data-ref-filename="57pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#54" title="(2 &lt;&lt; 1)" data-ref="_M/GEN6_PTE_CACHE_LLC">GEN6_PTE_CACHE_LLC</a>;</td></tr>
<tr><th id="239">239</th><td>		<b>break</b>;</td></tr>
<tr><th id="240">240</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>:</td></tr>
<tr><th id="241">241</th><td>		<a class="local col7 ref" href="#57pte" title='pte' data-ref="57pte" data-ref-filename="57pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#55" title="(1 &lt;&lt; 1)" data-ref="_M/GEN6_PTE_UNCACHED">GEN6_PTE_UNCACHED</a>;</td></tr>
<tr><th id="242">242</th><td>		<b>break</b>;</td></tr>
<tr><th id="243">243</th><td>	<b>default</b>:</td></tr>
<tr><th id="244">244</th><td>		<a class="macro" href="i915_drv.h.html#93" title="linux_warning((1)? (printf(&quot;warning: %s:%d: &quot; &quot;Missing switch case (%lu) in %s\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 244, (long) (level), __func__), 1) : 0);" data-ref="_M/MISSING_CASE">MISSING_CASE</a>(<a class="local col4 ref" href="#54level" title='level' data-ref="54level" data-ref-filename="54level">level</a>);</td></tr>
<tr><th id="245">245</th><td>	}</td></tr>
<tr><th id="246">246</th><td></td></tr>
<tr><th id="247">247</th><td>	<b>return</b> <a class="local col7 ref" href="#57pte" title='pte' data-ref="57pte" data-ref-filename="57pte">pte</a>;</td></tr>
<tr><th id="248">248</th><td>}</td></tr>
<tr><th id="249">249</th><td></td></tr>
<tr><th id="250">250</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="tu decl def fn" id="ivb_pte_encode" title='ivb_pte_encode' data-type='gen6_pte_t ivb_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid, u32 unused)' data-ref="ivb_pte_encode" data-ref-filename="ivb_pte_encode">ivb_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col8 decl" id="58addr" title='addr' data-type='dma_addr_t' data-ref="58addr" data-ref-filename="58addr">addr</dfn>,</td></tr>
<tr><th id="251">251</th><td>				 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col9 decl" id="59level" title='level' data-type='enum i915_cache_level' data-ref="59level" data-ref-filename="59level">level</dfn>,</td></tr>
<tr><th id="252">252</th><td>				 <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col0 decl" id="60valid" title='valid' data-type='_Bool' data-ref="60valid" data-ref-filename="60valid">valid</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col1 decl" id="61unused" title='unused' data-type='u32' data-ref="61unused" data-ref-filename="61unused">unused</dfn>)</td></tr>
<tr><th id="253">253</th><td>{</td></tr>
<tr><th id="254">254</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col2 decl" id="62pte" title='pte' data-type='gen6_pte_t' data-ref="62pte" data-ref-filename="62pte">pte</dfn> = <a class="local col0 ref" href="#60valid" title='valid' data-ref="60valid" data-ref-filename="60valid">valid</a> ? <a class="macro" href="i915_gem_gtt.h.html#56" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PTE_VALID">GEN6_PTE_VALID</a> : <var>0</var>;</td></tr>
<tr><th id="255">255</th><td>	<a class="local col2 ref" href="#62pte" title='pte' data-ref="62pte" data-ref-filename="62pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#52" title="((addr) | (((addr) &gt;&gt; 28) &amp; 0xff0))" data-ref="_M/GEN6_PTE_ADDR_ENCODE">GEN6_PTE_ADDR_ENCODE</a>(<a class="local col8 ref" href="#58addr" title='addr' data-ref="58addr" data-ref-filename="58addr">addr</a>);</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td>	<b>switch</b> (<a class="local col9 ref" href="#59level" title='level' data-ref="59level" data-ref-filename="59level">level</a>) {</td></tr>
<tr><th id="258">258</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_L3_LLC" title='I915_CACHE_L3_LLC' data-ref="I915_CACHE_L3_LLC" data-ref-filename="I915_CACHE_L3_LLC">I915_CACHE_L3_LLC</a>:</td></tr>
<tr><th id="259">259</th><td>		<a class="local col2 ref" href="#62pte" title='pte' data-ref="62pte" data-ref-filename="62pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#70" title="(3 &lt;&lt; 1)" data-ref="_M/GEN7_PTE_CACHE_L3_LLC">GEN7_PTE_CACHE_L3_LLC</a>;</td></tr>
<tr><th id="260">260</th><td>		<b>break</b>;</td></tr>
<tr><th id="261">261</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>:</td></tr>
<tr><th id="262">262</th><td>		<a class="local col2 ref" href="#62pte" title='pte' data-ref="62pte" data-ref-filename="62pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#54" title="(2 &lt;&lt; 1)" data-ref="_M/GEN6_PTE_CACHE_LLC">GEN6_PTE_CACHE_LLC</a>;</td></tr>
<tr><th id="263">263</th><td>		<b>break</b>;</td></tr>
<tr><th id="264">264</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>:</td></tr>
<tr><th id="265">265</th><td>		<a class="local col2 ref" href="#62pte" title='pte' data-ref="62pte" data-ref-filename="62pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#55" title="(1 &lt;&lt; 1)" data-ref="_M/GEN6_PTE_UNCACHED">GEN6_PTE_UNCACHED</a>;</td></tr>
<tr><th id="266">266</th><td>		<b>break</b>;</td></tr>
<tr><th id="267">267</th><td>	<b>default</b>:</td></tr>
<tr><th id="268">268</th><td>		<a class="macro" href="i915_drv.h.html#93" title="linux_warning((1)? (printf(&quot;warning: %s:%d: &quot; &quot;Missing switch case (%lu) in %s\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 268, (long) (level), __func__), 1) : 0);" data-ref="_M/MISSING_CASE">MISSING_CASE</a>(<a class="local col9 ref" href="#59level" title='level' data-ref="59level" data-ref-filename="59level">level</a>);</td></tr>
<tr><th id="269">269</th><td>	}</td></tr>
<tr><th id="270">270</th><td></td></tr>
<tr><th id="271">271</th><td>	<b>return</b> <a class="local col2 ref" href="#62pte" title='pte' data-ref="62pte" data-ref-filename="62pte">pte</a>;</td></tr>
<tr><th id="272">272</th><td>}</td></tr>
<tr><th id="273">273</th><td></td></tr>
<tr><th id="274">274</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="tu decl def fn" id="byt_pte_encode" title='byt_pte_encode' data-type='gen6_pte_t byt_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid, u32 flags)' data-ref="byt_pte_encode" data-ref-filename="byt_pte_encode">byt_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col3 decl" id="63addr" title='addr' data-type='dma_addr_t' data-ref="63addr" data-ref-filename="63addr">addr</dfn>,</td></tr>
<tr><th id="275">275</th><td>				 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col4 decl" id="64level" title='level' data-type='enum i915_cache_level' data-ref="64level" data-ref-filename="64level">level</dfn>,</td></tr>
<tr><th id="276">276</th><td>				 <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col5 decl" id="65valid" title='valid' data-type='_Bool' data-ref="65valid" data-ref-filename="65valid">valid</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col6 decl" id="66flags" title='flags' data-type='u32' data-ref="66flags" data-ref-filename="66flags">flags</dfn>)</td></tr>
<tr><th id="277">277</th><td>{</td></tr>
<tr><th id="278">278</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col7 decl" id="67pte" title='pte' data-type='gen6_pte_t' data-ref="67pte" data-ref-filename="67pte">pte</dfn> = <a class="local col5 ref" href="#65valid" title='valid' data-ref="65valid" data-ref-filename="65valid">valid</a> ? <a class="macro" href="i915_gem_gtt.h.html#56" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PTE_VALID">GEN6_PTE_VALID</a> : <var>0</var>;</td></tr>
<tr><th id="279">279</th><td>	<a class="local col7 ref" href="#67pte" title='pte' data-ref="67pte" data-ref-filename="67pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#52" title="((addr) | (((addr) &gt;&gt; 28) &amp; 0xff0))" data-ref="_M/GEN6_PTE_ADDR_ENCODE">GEN6_PTE_ADDR_ENCODE</a>(<a class="local col3 ref" href="#63addr" title='addr' data-ref="63addr" data-ref-filename="63addr">addr</a>);</td></tr>
<tr><th id="280">280</th><td></td></tr>
<tr><th id="281">281</th><td>	<b>if</b> (!(<a class="local col6 ref" href="#66flags" title='flags' data-ref="66flags" data-ref-filename="66flags">flags</a> &amp; <a class="macro" href="i915_gem_gtt.h.html#334" title="(1&lt;&lt;0)" data-ref="_M/PTE_READ_ONLY">PTE_READ_ONLY</a>))</td></tr>
<tr><th id="282">282</th><td>		<a class="local col7 ref" href="#67pte" title='pte' data-ref="67pte" data-ref-filename="67pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#73" title="(1 &lt;&lt; 1)" data-ref="_M/BYT_PTE_WRITEABLE">BYT_PTE_WRITEABLE</a>;</td></tr>
<tr><th id="283">283</th><td></td></tr>
<tr><th id="284">284</th><td>	<b>if</b> (<a class="local col4 ref" href="#64level" title='level' data-ref="64level" data-ref-filename="64level">level</a> != <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>)</td></tr>
<tr><th id="285">285</th><td>		<a class="local col7 ref" href="#67pte" title='pte' data-ref="67pte" data-ref-filename="67pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#72" title="(1 &lt;&lt; 2)" data-ref="_M/BYT_PTE_SNOOPED_BY_CPU_CACHES">BYT_PTE_SNOOPED_BY_CPU_CACHES</a>;</td></tr>
<tr><th id="286">286</th><td></td></tr>
<tr><th id="287">287</th><td>	<b>return</b> <a class="local col7 ref" href="#67pte" title='pte' data-ref="67pte" data-ref-filename="67pte">pte</a>;</td></tr>
<tr><th id="288">288</th><td>}</td></tr>
<tr><th id="289">289</th><td></td></tr>
<tr><th id="290">290</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="tu decl def fn" id="hsw_pte_encode" title='hsw_pte_encode' data-type='gen6_pte_t hsw_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid, u32 unused)' data-ref="hsw_pte_encode" data-ref-filename="hsw_pte_encode">hsw_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col8 decl" id="68addr" title='addr' data-type='dma_addr_t' data-ref="68addr" data-ref-filename="68addr">addr</dfn>,</td></tr>
<tr><th id="291">291</th><td>				 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col9 decl" id="69level" title='level' data-type='enum i915_cache_level' data-ref="69level" data-ref-filename="69level">level</dfn>,</td></tr>
<tr><th id="292">292</th><td>				 <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col0 decl" id="70valid" title='valid' data-type='_Bool' data-ref="70valid" data-ref-filename="70valid">valid</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col1 decl" id="71unused" title='unused' data-type='u32' data-ref="71unused" data-ref-filename="71unused">unused</dfn>)</td></tr>
<tr><th id="293">293</th><td>{</td></tr>
<tr><th id="294">294</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col2 decl" id="72pte" title='pte' data-type='gen6_pte_t' data-ref="72pte" data-ref-filename="72pte">pte</dfn> = <a class="local col0 ref" href="#70valid" title='valid' data-ref="70valid" data-ref-filename="70valid">valid</a> ? <a class="macro" href="i915_gem_gtt.h.html#56" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PTE_VALID">GEN6_PTE_VALID</a> : <var>0</var>;</td></tr>
<tr><th id="295">295</th><td>	<a class="local col2 ref" href="#72pte" title='pte' data-ref="72pte" data-ref-filename="72pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#88" title="((addr) | (((addr) &gt;&gt; 28) &amp; 0x7f0))" data-ref="_M/HSW_PTE_ADDR_ENCODE">HSW_PTE_ADDR_ENCODE</a>(<a class="local col8 ref" href="#68addr" title='addr' data-ref="68addr" data-ref-filename="68addr">addr</a>);</td></tr>
<tr><th id="296">296</th><td></td></tr>
<tr><th id="297">297</th><td>	<b>if</b> (<a class="local col9 ref" href="#69level" title='level' data-ref="69level" data-ref-filename="69level">level</a> != <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>)</td></tr>
<tr><th id="298">298</th><td>		<a class="local col2 ref" href="#72pte" title='pte' data-ref="72pte" data-ref-filename="72pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#80" title="((((0x2) &amp; 0x7) &lt;&lt; 1) | (((0x2) &amp; 0x8) &lt;&lt; (11 - 3)))" data-ref="_M/HSW_WB_LLC_AGE3">HSW_WB_LLC_AGE3</a>;</td></tr>
<tr><th id="299">299</th><td></td></tr>
<tr><th id="300">300</th><td>	<b>return</b> <a class="local col2 ref" href="#72pte" title='pte' data-ref="72pte" data-ref-filename="72pte">pte</a>;</td></tr>
<tr><th id="301">301</th><td>}</td></tr>
<tr><th id="302">302</th><td></td></tr>
<tr><th id="303">303</th><td><em>static</em> <a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="tu decl def fn" id="iris_pte_encode" title='iris_pte_encode' data-type='gen6_pte_t iris_pte_encode(dma_addr_t addr, enum i915_cache_level level, _Bool valid, u32 unused)' data-ref="iris_pte_encode" data-ref-filename="iris_pte_encode">iris_pte_encode</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col3 decl" id="73addr" title='addr' data-type='dma_addr_t' data-ref="73addr" data-ref-filename="73addr">addr</dfn>,</td></tr>
<tr><th id="304">304</th><td>				  <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col4 decl" id="74level" title='level' data-type='enum i915_cache_level' data-ref="74level" data-ref-filename="74level">level</dfn>,</td></tr>
<tr><th id="305">305</th><td>				  <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col5 decl" id="75valid" title='valid' data-type='_Bool' data-ref="75valid" data-ref-filename="75valid">valid</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col6 decl" id="76unused" title='unused' data-type='u32' data-ref="76unused" data-ref-filename="76unused">unused</dfn>)</td></tr>
<tr><th id="306">306</th><td>{</td></tr>
<tr><th id="307">307</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col7 decl" id="77pte" title='pte' data-type='gen6_pte_t' data-ref="77pte" data-ref-filename="77pte">pte</dfn> = <a class="local col5 ref" href="#75valid" title='valid' data-ref="75valid" data-ref-filename="75valid">valid</a> ? <a class="macro" href="i915_gem_gtt.h.html#56" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PTE_VALID">GEN6_PTE_VALID</a> : <var>0</var>;</td></tr>
<tr><th id="308">308</th><td>	<a class="local col7 ref" href="#77pte" title='pte' data-ref="77pte" data-ref-filename="77pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#88" title="((addr) | (((addr) &gt;&gt; 28) &amp; 0x7f0))" data-ref="_M/HSW_PTE_ADDR_ENCODE">HSW_PTE_ADDR_ENCODE</a>(<a class="local col3 ref" href="#73addr" title='addr' data-ref="73addr" data-ref-filename="73addr">addr</a>);</td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td>	<b>switch</b> (<a class="local col4 ref" href="#74level" title='level' data-ref="74level" data-ref-filename="74level">level</a>) {</td></tr>
<tr><th id="311">311</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>:</td></tr>
<tr><th id="312">312</th><td>		<b>break</b>;</td></tr>
<tr><th id="313">313</th><td>	<b>case</b> <a class="enum" href="i915_drv.h.html#I915_CACHE_WT" title='I915_CACHE_WT' data-ref="I915_CACHE_WT" data-ref-filename="I915_CACHE_WT">I915_CACHE_WT</a>:</td></tr>
<tr><th id="314">314</th><td>		<a class="local col7 ref" href="#77pte" title='pte' data-ref="77pte" data-ref-filename="77pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#84" title="((((0x7) &amp; 0x7) &lt;&lt; 1) | (((0x7) &amp; 0x8) &lt;&lt; (11 - 3)))" data-ref="_M/HSW_WT_ELLC_LLC_AGE3">HSW_WT_ELLC_LLC_AGE3</a>;</td></tr>
<tr><th id="315">315</th><td>		<b>break</b>;</td></tr>
<tr><th id="316">316</th><td>	<b>default</b>:</td></tr>
<tr><th id="317">317</th><td>		<a class="local col7 ref" href="#77pte" title='pte' data-ref="77pte" data-ref-filename="77pte">pte</a> |= <a class="macro" href="i915_gem_gtt.h.html#82" title="((((0x8) &amp; 0x7) &lt;&lt; 1) | (((0x8) &amp; 0x8) &lt;&lt; (11 - 3)))" data-ref="_M/HSW_WB_ELLC_LLC_AGE3">HSW_WB_ELLC_LLC_AGE3</a>;</td></tr>
<tr><th id="318">318</th><td>		<b>break</b>;</td></tr>
<tr><th id="319">319</th><td>	}</td></tr>
<tr><th id="320">320</th><td></td></tr>
<tr><th id="321">321</th><td>	<b>return</b> <a class="local col7 ref" href="#77pte" title='pte' data-ref="77pte" data-ref-filename="77pte">pte</a>;</td></tr>
<tr><th id="322">322</th><td>}</td></tr>
<tr><th id="323">323</th><td></td></tr>
<tr><th id="324">324</th><td><em>static</em> <em>void</em> *<a class="tu decl fn" href="#kmap_page_dma" title='kmap_page_dma' data-type='void * kmap_page_dma(struct i915_page_dma * )' data-ref="kmap_page_dma" data-ref-filename="kmap_page_dma">kmap_page_dma</a>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *);</td></tr>
<tr><th id="325">325</th><td><em>static</em> <em>void</em> <a class="tu decl fn" href="#kunmap_page_dma" title='kunmap_page_dma' data-type='void kunmap_page_dma(struct drm_device * , void * )' data-ref="kunmap_page_dma" data-ref-filename="kunmap_page_dma">kunmap_page_dma</a>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *, <em>void</em> *);</td></tr>
<tr><th id="326">326</th><td></td></tr>
<tr><th id="327">327</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="__setup_page_dma" title='__setup_page_dma' data-type='int __setup_page_dma(struct drm_device * dev, struct i915_page_dma * p, gfp_t flags)' data-ref="__setup_page_dma" data-ref-filename="__setup_page_dma">__setup_page_dma</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col8 decl" id="78dev" title='dev' data-type='struct drm_device *' data-ref="78dev" data-ref-filename="78dev">dev</dfn>,</td></tr>
<tr><th id="328">328</th><td>			    <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col9 decl" id="79p" title='p' data-type='struct i915_page_dma *' data-ref="79p" data-ref-filename="79p">p</dfn>, <a class="typedef" href="../../../../common/include/linux/gfp.h.html#gfp_t" title='gfp_t' data-type='int' data-ref="gfp_t" data-ref-filename="gfp_t">gfp_t</a> <dfn class="local col0 decl" id="80flags" title='flags' data-type='gfp_t' data-ref="80flags" data-ref-filename="80flags">flags</dfn>)</td></tr>
<tr><th id="329">329</th><td>{</td></tr>
<tr><th id="330">330</th><td><u>#<span data-ppcond="330">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="331">331</th><td>	<em>int</em> busdmaflags = <var>0</var>;</td></tr>
<tr><th id="332">332</th><td>	<em>int</em> error;</td></tr>
<tr><th id="333">333</th><td>	<em>int</em> nseg = <var>1</var>;</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td>	<b>if</b> (flags &amp; __GFP_WAIT)</td></tr>
<tr><th id="336">336</th><td>		busdmaflags |= BUS_DMA_WAITOK;</td></tr>
<tr><th id="337">337</th><td>	<b>else</b></td></tr>
<tr><th id="338">338</th><td>		busdmaflags |= BUS_DMA_NOWAIT;</td></tr>
<tr><th id="339">339</th><td></td></tr>
<tr><th id="340">340</th><td>	error = bus_dmamem_alloc(dev-&gt;dmat, PAGE_SIZE, PAGE_SIZE, <var>0</var>, &amp;p-&gt;seg,</td></tr>
<tr><th id="341">341</th><td>	    nseg, &amp;nseg, busdmaflags);</td></tr>
<tr><th id="342">342</th><td>	<b>if</b> (error) {</td></tr>
<tr><th id="343">343</th><td>fail0:		p-&gt;map = NULL;</td></tr>
<tr><th id="344">344</th><td>		<b>return</b> -error;	<i>/* XXX errno NetBSD-&gt;Linux */</i></td></tr>
<tr><th id="345">345</th><td>	}</td></tr>
<tr><th id="346">346</th><td>	KASSERT(nseg == <var>1</var>);</td></tr>
<tr><th id="347">347</th><td>	error = bus_dmamap_create(dev-&gt;dmat, PAGE_SIZE, <var>1</var>, PAGE_SIZE, <var>0</var>,</td></tr>
<tr><th id="348">348</th><td>	    busdmaflags, &amp;p-&gt;map);</td></tr>
<tr><th id="349">349</th><td>	<b>if</b> (error) {</td></tr>
<tr><th id="350">350</th><td>fail1:		bus_dmamem_free(dev-&gt;dmat, &amp;p-&gt;seg, <var>1</var>);</td></tr>
<tr><th id="351">351</th><td>		<b>goto</b> fail0;</td></tr>
<tr><th id="352">352</th><td>	}</td></tr>
<tr><th id="353">353</th><td>	error = bus_dmamap_load_raw(dev-&gt;dmat, p-&gt;map, &amp;p-&gt;seg, <var>1</var>, PAGE_SIZE,</td></tr>
<tr><th id="354">354</th><td>	    busdmaflags);</td></tr>
<tr><th id="355">355</th><td>	<b>if</b> (error) {</td></tr>
<tr><th id="356">356</th><td>fail2: __unused</td></tr>
<tr><th id="357">357</th><td>		bus_dmamap_destroy(dev-&gt;dmat, p-&gt;map);</td></tr>
<tr><th id="358">358</th><td>		<b>goto</b> fail1;</td></tr>
<tr><th id="359">359</th><td>	}</td></tr>
<tr><th id="360">360</th><td></td></tr>
<tr><th id="361">361</th><td>	<b>if</b> (flags &amp; __GFP_ZERO) {</td></tr>
<tr><th id="362">362</th><td>		<em>void</em> *va = kmap_page_dma(p);</td></tr>
<tr><th id="363">363</th><td>		memset(va, <var>0</var>, PAGE_SIZE);</td></tr>
<tr><th id="364">364</th><td>		kunmap_page_dma(dev, va);</td></tr>
<tr><th id="365">365</th><td>	}</td></tr>
<tr><th id="366">366</th><td><u>#<span data-ppcond="330">else</span></u></td></tr>
<tr><th id="367">367</th><td>	<b>struct</b> <a class="type" href="../../../../../../sys/device.h.html#device" title='device' data-ref="device" data-ref-filename="device">device</a> *<dfn class="local col1 decl" id="81device" title='device' data-type='struct device *' data-ref="81device" data-ref-filename="81device">device</dfn> = &amp;dev-&gt;pdev-&gt;<span class='error' title="no member named &apos;dev&apos; in &apos;struct pci_dev&apos;">dev</span>;</td></tr>
<tr><th id="368">368</th><td></td></tr>
<tr><th id="369">369</th><td>	<a class="local col9 ref" href="#79p" title='p' data-ref="79p" data-ref-filename="79p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a> = <a class="ref fn" href="#369" title='alloc_page' data-ref="alloc_page" data-ref-filename="alloc_page">alloc_page</a>(<a class="local col0 ref" href="#80flags" title='flags' data-ref="80flags" data-ref-filename="80flags">flags</a>);</td></tr>
<tr><th id="370">370</th><td>	<b>if</b> (!<a class="local col9 ref" href="#79p" title='p' data-ref="79p" data-ref-filename="79p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a>)</td></tr>
<tr><th id="371">371</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="372">372</th><td></td></tr>
<tr><th id="373">373</th><td>	p-&gt;daddr = dma_map_page(device,</td></tr>
<tr><th id="374">374</th><td>				p-&gt;page, <var>0</var>, <var>4096</var>, <span class='error' title="use of undeclared identifier &apos;PCI_DMA_BIDIRECTIONAL&apos;">PCI_DMA_BIDIRECTIONAL</span>);</td></tr>
<tr><th id="375">375</th><td></td></tr>
<tr><th id="376">376</th><td>	<b>if</b> (<a class="ref fn" href="#376" title='dma_mapping_error' data-ref="dma_mapping_error" data-ref-filename="dma_mapping_error">dma_mapping_error</a>(<a class="local col1 ref" href="#81device" title='device' data-ref="81device" data-ref-filename="81device">device</a>, <a class="local col9 ref" href="#79p" title='p' data-ref="79p" data-ref-filename="79p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::(anonymous)::daddr" title='i915_page_dma::(anonymous union)::daddr' data-ref="i915_page_dma::(anonymous)::daddr" data-ref-filename="i915_page_dma..(anonymous)..daddr">daddr</a>)) {</td></tr>
<tr><th id="377">377</th><td>		<a class="ref fn" href="#377" title='__free_page' data-ref="__free_page" data-ref-filename="__free_page">__free_page</a>(<a class="local col9 ref" href="#79p" title='p' data-ref="79p" data-ref-filename="79p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a>);</td></tr>
<tr><th id="378">378</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="379">379</th><td>	}</td></tr>
<tr><th id="380">380</th><td><u>#<span data-ppcond="330">endif</span></u></td></tr>
<tr><th id="381">381</th><td></td></tr>
<tr><th id="382">382</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="383">383</th><td>}</td></tr>
<tr><th id="384">384</th><td></td></tr>
<tr><th id="385">385</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="setup_page_dma" title='setup_page_dma' data-type='int setup_page_dma(struct drm_device * dev, struct i915_page_dma * p)' data-ref="setup_page_dma" data-ref-filename="setup_page_dma">setup_page_dma</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col2 decl" id="82dev" title='dev' data-type='struct drm_device *' data-ref="82dev" data-ref-filename="82dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col3 decl" id="83p" title='p' data-type='struct i915_page_dma *' data-ref="83p" data-ref-filename="83p">p</dfn>)</td></tr>
<tr><th id="386">386</th><td>{</td></tr>
<tr><th id="387">387</th><td>	<b>return</b> <a class="tu ref fn" href="#__setup_page_dma" title='__setup_page_dma' data-use='c' data-ref="__setup_page_dma" data-ref-filename="__setup_page_dma">__setup_page_dma</a>(<a class="local col2 ref" href="#82dev" title='dev' data-ref="82dev" data-ref-filename="82dev">dev</a>, <a class="local col3 ref" href="#83p" title='p' data-ref="83p" data-ref-filename="83p">p</a>, <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="388">388</th><td>}</td></tr>
<tr><th id="389">389</th><td></td></tr>
<tr><th id="390">390</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="cleanup_page_dma" title='cleanup_page_dma' data-type='void cleanup_page_dma(struct drm_device * dev, struct i915_page_dma * p)' data-ref="cleanup_page_dma" data-ref-filename="cleanup_page_dma">cleanup_page_dma</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="84dev" title='dev' data-type='struct drm_device *' data-ref="84dev" data-ref-filename="84dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col5 decl" id="85p" title='p' data-type='struct i915_page_dma *' data-ref="85p" data-ref-filename="85p">p</dfn>)</td></tr>
<tr><th id="391">391</th><td>{</td></tr>
<tr><th id="392">392</th><td><u>#<span data-ppcond="392">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="393">393</th><td>	<b>if</b> (WARN_ON(!p-&gt;map))</td></tr>
<tr><th id="394">394</th><td>		<b>return</b>;</td></tr>
<tr><th id="395">395</th><td></td></tr>
<tr><th id="396">396</th><td>	bus_dmamap_unload(dev-&gt;dmat, p-&gt;map);</td></tr>
<tr><th id="397">397</th><td>	bus_dmamap_destroy(dev-&gt;dmat, p-&gt;map);</td></tr>
<tr><th id="398">398</th><td>	bus_dmamem_free(dev-&gt;dmat, &amp;p-&gt;seg, <var>1</var>);</td></tr>
<tr><th id="399">399</th><td>	p-&gt;map = NULL;</td></tr>
<tr><th id="400">400</th><td><u>#<span data-ppcond="392">else</span></u></td></tr>
<tr><th id="401">401</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!p-&gt;page))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 401, &quot;!p-&gt;page&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col5 ref" href="#85p" title='p' data-ref="85p" data-ref-filename="85p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a>))</td></tr>
<tr><th id="402">402</th><td>		<b>return</b>;</td></tr>
<tr><th id="403">403</th><td></td></tr>
<tr><th id="404">404</th><td>	dma_unmap_page(&amp;dev-&gt;pdev-&gt;<span class='error' title="no member named &apos;dev&apos; in &apos;struct pci_dev&apos;">dev</span>, p-&gt;daddr, <var>4096</var>, <span class='error' title="use of undeclared identifier &apos;PCI_DMA_BIDIRECTIONAL&apos;">PCI_DMA_BIDIRECTIONAL</span>);</td></tr>
<tr><th id="405">405</th><td>	<a class="ref fn" href="#377" title='__free_page' data-ref="__free_page" data-ref-filename="__free_page">__free_page</a>(<a class="local col5 ref" href="#85p" title='p' data-ref="85p" data-ref-filename="85p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a>);</td></tr>
<tr><th id="406">406</th><td>	<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#382" title="__builtin_memset(p, 0, sizeof(*p))" data-ref="_M/memset">memset</a>(<a class="local col5 ref" href="#85p" title='p' data-ref="85p" data-ref-filename="85p">p</a>, <var>0</var>, <b>sizeof</b>(*<a class="local col5 ref" href="#85p" title='p' data-ref="85p" data-ref-filename="85p">p</a>));</td></tr>
<tr><th id="407">407</th><td><u>#<span data-ppcond="392">endif</span></u></td></tr>
<tr><th id="408">408</th><td>}</td></tr>
<tr><th id="409">409</th><td></td></tr>
<tr><th id="410">410</th><td><em>static</em> <em>void</em> *<dfn class="tu decl def fn" id="kmap_page_dma" title='kmap_page_dma' data-type='void * kmap_page_dma(struct i915_page_dma * p)' data-ref="kmap_page_dma" data-ref-filename="kmap_page_dma">kmap_page_dma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col6 decl" id="86p" title='p' data-type='struct i915_page_dma *' data-ref="86p" data-ref-filename="86p">p</dfn>)</td></tr>
<tr><th id="411">411</th><td>{</td></tr>
<tr><th id="412">412</th><td><u>#<span data-ppcond="412">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="413">413</th><td>	<b>return</b> kmap_atomic(container_of(PHYS_TO_VM_PAGE(p-&gt;seg.ds_addr),</td></tr>
<tr><th id="414">414</th><td>		<b>struct</b> page, p_vmp));</td></tr>
<tr><th id="415">415</th><td><u>#<span data-ppcond="412">else</span></u></td></tr>
<tr><th id="416">416</th><td>	<b>return</b> <a class="macro" href="../../../include/linux/highmem.h.html#45" title="linux_kmap_atomic(p-&gt;page)" data-ref="_M/kmap_atomic">kmap_atomic</a>(<a class="local col6 ref" href="#86p" title='p' data-ref="86p" data-ref-filename="86p">p</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::page" title='i915_page_dma::page' data-ref="i915_page_dma::page" data-ref-filename="i915_page_dma..page">page</a>);</td></tr>
<tr><th id="417">417</th><td><u>#<span data-ppcond="412">endif</span></u></td></tr>
<tr><th id="418">418</th><td>}</td></tr>
<tr><th id="419">419</th><td></td></tr>
<tr><th id="420">420</th><td><i  data-doc="kunmap_page_dma">/* We use the flushing unmap only with ppgtt structures:</i></td></tr>
<tr><th id="421">421</th><td><i  data-doc="kunmap_page_dma"> * page directories, page tables and scratch pages.</i></td></tr>
<tr><th id="422">422</th><td><i  data-doc="kunmap_page_dma"> */</i></td></tr>
<tr><th id="423">423</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="kunmap_page_dma" title='kunmap_page_dma' data-type='void kunmap_page_dma(struct drm_device * dev, void * vaddr)' data-ref="kunmap_page_dma" data-ref-filename="kunmap_page_dma">kunmap_page_dma</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="87dev" title='dev' data-type='struct drm_device *' data-ref="87dev" data-ref-filename="87dev">dev</dfn>, <em>void</em> *<dfn class="local col8 decl" id="88vaddr" title='vaddr' data-type='void *' data-ref="88vaddr" data-ref-filename="88vaddr">vaddr</dfn>)</td></tr>
<tr><th id="424">424</th><td>{</td></tr>
<tr><th id="425">425</th><td>	<i>/* There are only few exceptions for gen &gt;=6. chv and bxt.</i></td></tr>
<tr><th id="426">426</th><td><i>	 * And we are not sure about the latter so play safe for now.</i></td></tr>
<tr><th id="427">427</th><td><i>	 */</i></td></tr>
<tr><th id="428">428</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2558" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 8))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col7 ref" href="#87dev" title='dev' data-ref="87dev" data-ref-filename="87dev">dev</a>) || <a class="macro" href="i915_drv.h.html#2563" title="(!((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_skylake) &amp;&amp; !((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_kabylake) &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 9))" data-ref="_M/IS_BROXTON">IS_BROXTON</a>(<a class="local col7 ref" href="#87dev" title='dev' data-ref="87dev" data-ref-filename="87dev">dev</a>))</td></tr>
<tr><th id="429">429</th><td>		<a class="ref fn" href="../../include/drm/drmP.h.html#drm_clflush_virt_range" title='drm_clflush_virt_range' data-ref="drm_clflush_virt_range" data-ref-filename="drm_clflush_virt_range">drm_clflush_virt_range</a>(<a class="local col8 ref" href="#88vaddr" title='vaddr' data-ref="88vaddr" data-ref-filename="88vaddr">vaddr</a>, <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>);</td></tr>
<tr><th id="430">430</th><td></td></tr>
<tr><th id="431">431</th><td>	<a class="macro" href="../../../include/linux/highmem.h.html#47" title="linux_kunmap_atomic(vaddr)" data-ref="_M/kunmap_atomic">kunmap_atomic</a>(<a class="local col8 ref" href="#88vaddr" title='vaddr' data-ref="88vaddr" data-ref-filename="88vaddr">vaddr</a>);</td></tr>
<tr><th id="432">432</th><td>}</td></tr>
<tr><th id="433">433</th><td></td></tr>
<tr><th id="434">434</th><td><u>#define <dfn class="macro" id="_M/kmap_px" data-ref="_M/kmap_px">kmap_px</dfn>(px) <a class="tu ref fn" href="#kmap_page_dma" title='kmap_page_dma' data-use='c' data-ref="kmap_page_dma" data-ref-filename="kmap_page_dma">kmap_page_dma</a>(px_base(px))</u></td></tr>
<tr><th id="435">435</th><td><u>#define <dfn class="macro" id="_M/kunmap_px" data-ref="_M/kunmap_px">kunmap_px</dfn>(ppgtt, vaddr) <a class="tu ref fn" href="#kunmap_page_dma" title='kunmap_page_dma' data-use='c' data-ref="kunmap_page_dma" data-ref-filename="kunmap_page_dma">kunmap_page_dma</a>((ppgtt)-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, (vaddr))</u></td></tr>
<tr><th id="436">436</th><td></td></tr>
<tr><th id="437">437</th><td><u>#define <dfn class="macro" id="_M/setup_px" data-ref="_M/setup_px">setup_px</dfn>(dev, px) <a class="tu ref fn" href="#setup_page_dma" title='setup_page_dma' data-use='c' data-ref="setup_page_dma" data-ref-filename="setup_page_dma">setup_page_dma</a>((dev), px_base(px))</u></td></tr>
<tr><th id="438">438</th><td><u>#define <dfn class="macro" id="_M/cleanup_px" data-ref="_M/cleanup_px">cleanup_px</dfn>(dev, px) <a class="tu ref fn" href="#cleanup_page_dma" title='cleanup_page_dma' data-use='c' data-ref="cleanup_page_dma" data-ref-filename="cleanup_page_dma">cleanup_page_dma</a>((dev), px_base(px))</u></td></tr>
<tr><th id="439">439</th><td><u>#define <dfn class="macro" id="_M/fill_px" data-ref="_M/fill_px">fill_px</dfn>(dev, px, v) <a class="tu ref fn" href="#fill_page_dma" title='fill_page_dma' data-use='c' data-ref="fill_page_dma" data-ref-filename="fill_page_dma">fill_page_dma</a>((dev), px_base(px), (v))</u></td></tr>
<tr><th id="440">440</th><td><u>#define <dfn class="macro" id="_M/fill32_px" data-ref="_M/fill32_px">fill32_px</dfn>(dev, px, v) <a class="tu ref fn" href="#fill_page_dma_32" title='fill_page_dma_32' data-use='c' data-ref="fill_page_dma_32" data-ref-filename="fill_page_dma_32">fill_page_dma_32</a>((dev), px_base(px), (v))</u></td></tr>
<tr><th id="441">441</th><td></td></tr>
<tr><th id="442">442</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="fill_page_dma" title='fill_page_dma' data-type='void fill_page_dma(struct drm_device * dev, struct i915_page_dma * p, const uint64_t val)' data-ref="fill_page_dma" data-ref-filename="fill_page_dma">fill_page_dma</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="89dev" title='dev' data-type='struct drm_device *' data-ref="89dev" data-ref-filename="89dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col0 decl" id="90p" title='p' data-type='struct i915_page_dma *' data-ref="90p" data-ref-filename="90p">p</dfn>,</td></tr>
<tr><th id="443">443</th><td>			  <em>const</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="91val" title='val' data-type='const uint64_t' data-ref="91val" data-ref-filename="91val">val</dfn>)</td></tr>
<tr><th id="444">444</th><td>{</td></tr>
<tr><th id="445">445</th><td>	<em>int</em> <dfn class="local col2 decl" id="92i" title='i' data-type='int' data-ref="92i" data-ref-filename="92i">i</dfn>;</td></tr>
<tr><th id="446">446</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> * <em>const</em> <dfn class="local col3 decl" id="93vaddr" title='vaddr' data-type='uint64_t *const' data-ref="93vaddr" data-ref-filename="93vaddr">vaddr</dfn> = <a class="tu ref fn" href="#kmap_page_dma" title='kmap_page_dma' data-use='c' data-ref="kmap_page_dma" data-ref-filename="kmap_page_dma">kmap_page_dma</a>(<a class="local col0 ref" href="#90p" title='p' data-ref="90p" data-ref-filename="90p">p</a>);</td></tr>
<tr><th id="447">447</th><td></td></tr>
<tr><th id="448">448</th><td>	<b>for</b> (<a class="local col2 ref" href="#92i" title='i' data-ref="92i" data-ref-filename="92i">i</a> = <var>0</var>; <a class="local col2 ref" href="#92i" title='i' data-ref="92i" data-ref-filename="92i">i</a> &lt; <var>512</var>; <a class="local col2 ref" href="#92i" title='i' data-ref="92i" data-ref-filename="92i">i</a>++)</td></tr>
<tr><th id="449">449</th><td>		<a class="local col3 ref" href="#93vaddr" title='vaddr' data-ref="93vaddr" data-ref-filename="93vaddr">vaddr</a>[<a class="local col2 ref" href="#92i" title='i' data-ref="92i" data-ref-filename="92i">i</a>] = <a class="local col1 ref" href="#91val" title='val' data-ref="91val" data-ref-filename="91val">val</a>;</td></tr>
<tr><th id="450">450</th><td></td></tr>
<tr><th id="451">451</th><td>	<a class="tu ref fn" href="#kunmap_page_dma" title='kunmap_page_dma' data-use='c' data-ref="kunmap_page_dma" data-ref-filename="kunmap_page_dma">kunmap_page_dma</a>(<a class="local col9 ref" href="#89dev" title='dev' data-ref="89dev" data-ref-filename="89dev">dev</a>, <a class="local col3 ref" href="#93vaddr" title='vaddr' data-ref="93vaddr" data-ref-filename="93vaddr">vaddr</a>);</td></tr>
<tr><th id="452">452</th><td>}</td></tr>
<tr><th id="453">453</th><td></td></tr>
<tr><th id="454">454</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="fill_page_dma_32" title='fill_page_dma_32' data-type='void fill_page_dma_32(struct drm_device * dev, struct i915_page_dma * p, const uint32_t val32)' data-ref="fill_page_dma_32" data-ref-filename="fill_page_dma_32">fill_page_dma_32</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="94dev" title='dev' data-type='struct drm_device *' data-ref="94dev" data-ref-filename="94dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_dma" title='i915_page_dma' data-ref="i915_page_dma" data-ref-filename="i915_page_dma">i915_page_dma</a> *<dfn class="local col5 decl" id="95p" title='p' data-type='struct i915_page_dma *' data-ref="95p" data-ref-filename="95p">p</dfn>,</td></tr>
<tr><th id="455">455</th><td>			     <em>const</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="96val32" title='val32' data-type='const uint32_t' data-ref="96val32" data-ref-filename="96val32">val32</dfn>)</td></tr>
<tr><th id="456">456</th><td>{</td></tr>
<tr><th id="457">457</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="97v" title='v' data-type='uint64_t' data-ref="97v" data-ref-filename="97v">v</dfn> = <a class="local col6 ref" href="#96val32" title='val32' data-ref="96val32" data-ref-filename="96val32">val32</a>;</td></tr>
<tr><th id="458">458</th><td></td></tr>
<tr><th id="459">459</th><td>	<a class="local col7 ref" href="#97v" title='v' data-ref="97v" data-ref-filename="97v">v</a> = <a class="local col7 ref" href="#97v" title='v' data-ref="97v" data-ref-filename="97v">v</a> &lt;&lt; <var>32</var> | <a class="local col6 ref" href="#96val32" title='val32' data-ref="96val32" data-ref-filename="96val32">val32</a>;</td></tr>
<tr><th id="460">460</th><td></td></tr>
<tr><th id="461">461</th><td>	<a class="tu ref fn" href="#fill_page_dma" title='fill_page_dma' data-use='c' data-ref="fill_page_dma" data-ref-filename="fill_page_dma">fill_page_dma</a>(<a class="local col4 ref" href="#94dev" title='dev' data-ref="94dev" data-ref-filename="94dev">dev</a>, <a class="local col5 ref" href="#95p" title='p' data-ref="95p" data-ref-filename="95p">p</a>, <a class="local col7 ref" href="#97v" title='v' data-ref="97v" data-ref-filename="97v">v</a>);</td></tr>
<tr><th id="462">462</th><td>}</td></tr>
<tr><th id="463">463</th><td></td></tr>
<tr><th id="464">464</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_scratch" title='i915_page_scratch' data-ref="i915_page_scratch" data-ref-filename="i915_page_scratch">i915_page_scratch</a> *<dfn class="tu decl def fn" id="alloc_scratch_page" title='alloc_scratch_page' data-type='struct i915_page_scratch * alloc_scratch_page(struct drm_device * dev)' data-ref="alloc_scratch_page" data-ref-filename="alloc_scratch_page">alloc_scratch_page</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col8 decl" id="98dev" title='dev' data-type='struct drm_device *' data-ref="98dev" data-ref-filename="98dev">dev</dfn>)</td></tr>
<tr><th id="465">465</th><td>{</td></tr>
<tr><th id="466">466</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_scratch" title='i915_page_scratch' data-ref="i915_page_scratch" data-ref-filename="i915_page_scratch">i915_page_scratch</a> *<dfn class="local col9 decl" id="99sp" title='sp' data-type='struct i915_page_scratch *' data-ref="99sp" data-ref-filename="99sp">sp</dfn>;</td></tr>
<tr><th id="467">467</th><td>	<em>int</em> <dfn class="local col0 decl" id="100ret" title='ret' data-type='int' data-ref="100ret" data-ref-filename="100ret">ret</dfn>;</td></tr>
<tr><th id="468">468</th><td></td></tr>
<tr><th id="469">469</th><td>	<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="470">470</th><td>	<b>if</b> (<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a> == <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="471">471</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="472">472</th><td></td></tr>
<tr><th id="473">473</th><td>	<a class="local col0 ref" href="#100ret" title='ret' data-ref="100ret" data-ref-filename="100ret">ret</a> = <a class="tu ref fn" href="#__setup_page_dma" title='__setup_page_dma' data-use='c' data-ref="__setup_page_dma" data-ref-filename="__setup_page_dma">__setup_page_dma</a>(<a class="local col8 ref" href="#98dev" title='dev' data-ref="98dev" data-ref-filename="98dev">dev</a>, <a class="macro" href="i915_gem_gtt.h.html#254" title="(&amp;(sp)-&gt;base)" data-ref="_M/px_base">px_base</a>(<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#43" title="((((uintmax_t)(1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((1) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_DMA32">GFP_DMA32</a> | <a class="macro" href="../../../../common/include/linux/gfp.h.html#64" title="(((uintmax_t)(12) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((12) &amp; (8 * sizeof(uintmax_t) - 1))))" data-ref="_M/__GFP_ZERO">__GFP_ZERO</a>);</td></tr>
<tr><th id="474">474</th><td>	<b>if</b> (<a class="local col0 ref" href="#100ret" title='ret' data-ref="100ret" data-ref-filename="100ret">ret</a>) {</td></tr>
<tr><th id="475">475</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a>);</td></tr>
<tr><th id="476">476</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col0 ref" href="#100ret" title='ret' data-ref="100ret" data-ref-filename="100ret">ret</a>);</td></tr>
<tr><th id="477">477</th><td>	}</td></tr>
<tr><th id="478">478</th><td></td></tr>
<tr><th id="479">479</th><td><u>#<span data-ppcond="479">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>		/* XXX ??? */</u></td></tr>
<tr><th id="480">480</th><td>	<a class="ref fn" href="#480" title='set_pages_uc' data-ref="set_pages_uc" data-ref-filename="set_pages_uc">set_pages_uc</a>(<a class="macro" href="i915_gem_gtt.h.html#259" title="((&amp;(sp)-&gt;base)-&gt;page)" data-ref="_M/px_page">px_page</a>(<a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a>), <var>1</var>);</td></tr>
<tr><th id="481">481</th><td><u>#<span data-ppcond="479">endif</span></u></td></tr>
<tr><th id="482">482</th><td></td></tr>
<tr><th id="483">483</th><td>	<b>return</b> <a class="local col9 ref" href="#99sp" title='sp' data-ref="99sp" data-ref-filename="99sp">sp</a>;</td></tr>
<tr><th id="484">484</th><td>}</td></tr>
<tr><th id="485">485</th><td></td></tr>
<tr><th id="486">486</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="free_scratch_page" title='free_scratch_page' data-type='void free_scratch_page(struct drm_device * dev, struct i915_page_scratch * sp)' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col1 decl" id="101dev" title='dev' data-type='struct drm_device *' data-ref="101dev" data-ref-filename="101dev">dev</dfn>,</td></tr>
<tr><th id="487">487</th><td>			      <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_scratch" title='i915_page_scratch' data-ref="i915_page_scratch" data-ref-filename="i915_page_scratch">i915_page_scratch</a> *<dfn class="local col2 decl" id="102sp" title='sp' data-type='struct i915_page_scratch *' data-ref="102sp" data-ref-filename="102sp">sp</dfn>)</td></tr>
<tr><th id="488">488</th><td>{</td></tr>
<tr><th id="489">489</th><td><u>#<span data-ppcond="489">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>		/* XXX ??? */</u></td></tr>
<tr><th id="490">490</th><td>	<a class="ref fn" href="#490" title='set_pages_wb' data-ref="set_pages_wb" data-ref-filename="set_pages_wb">set_pages_wb</a>(<a class="macro" href="i915_gem_gtt.h.html#259" title="((&amp;(sp)-&gt;base)-&gt;page)" data-ref="_M/px_page">px_page</a>(<a class="local col2 ref" href="#102sp" title='sp' data-ref="102sp" data-ref-filename="102sp">sp</a>), <var>1</var>);</td></tr>
<tr><th id="491">491</th><td><u>#<span data-ppcond="489">endif</span></u></td></tr>
<tr><th id="492">492</th><td></td></tr>
<tr><th id="493">493</th><td>	<a class="macro" href="#438" title="cleanup_page_dma((dev), (&amp;(sp)-&gt;base))" data-ref="_M/cleanup_px">cleanup_px</a>(<a class="local col1 ref" href="#101dev" title='dev' data-ref="101dev" data-ref-filename="101dev">dev</a>, <a class="local col2 ref" href="#102sp" title='sp' data-ref="102sp" data-ref-filename="102sp">sp</a>);</td></tr>
<tr><th id="494">494</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col2 ref" href="#102sp" title='sp' data-ref="102sp" data-ref-filename="102sp">sp</a>);</td></tr>
<tr><th id="495">495</th><td>}</td></tr>
<tr><th id="496">496</th><td></td></tr>
<tr><th id="497">497</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="tu decl def fn" id="alloc_pt" title='alloc_pt' data-type='struct i915_page_table * alloc_pt(struct drm_device * dev)' data-ref="alloc_pt" data-ref-filename="alloc_pt">alloc_pt</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="103dev" title='dev' data-type='struct drm_device *' data-ref="103dev" data-ref-filename="103dev">dev</dfn>)</td></tr>
<tr><th id="498">498</th><td>{</td></tr>
<tr><th id="499">499</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col4 decl" id="104pt" title='pt' data-type='struct i915_page_table *' data-ref="104pt" data-ref-filename="104pt">pt</dfn>;</td></tr>
<tr><th id="500">500</th><td>	<em>const</em> <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col5 decl" id="105count" title='count' data-type='const size_t' data-ref="105count" data-ref-filename="105count">count</dfn> = <a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col3 ref" href="#103dev" title='dev' data-ref="103dev" data-ref-filename="103dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>8</var> ?</td></tr>
<tr><th id="501">501</th><td>		<a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a> : <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="502">502</th><td>	<em>int</em> <dfn class="local col6 decl" id="106ret" title='ret' data-type='int' data-ref="106ret" data-ref-filename="106ret">ret</dfn> = -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="503">503</th><td></td></tr>
<tr><th id="504">504</th><td>	<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="505">505</th><td>	<b>if</b> (!<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>)</td></tr>
<tr><th id="506">506</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="507">507</th><td></td></tr>
<tr><th id="508">508</th><td>	<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((count)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="local col5 ref" href="#105count" title='count' data-ref="105count" data-ref-filename="105count">count</a>), <b>sizeof</b>(*<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>),</td></tr>
<tr><th id="509">509</th><td>				<a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="510">510</th><td></td></tr>
<tr><th id="511">511</th><td>	<b>if</b> (!<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>)</td></tr>
<tr><th id="512">512</th><td>		<b>goto</b> <a class="lbl" href="#107fail_bitmap" data-ref="107fail_bitmap" data-ref-filename="107fail_bitmap">fail_bitmap</a>;</td></tr>
<tr><th id="513">513</th><td></td></tr>
<tr><th id="514">514</th><td>	<a class="local col6 ref" href="#106ret" title='ret' data-ref="106ret" data-ref-filename="106ret">ret</a> = <a class="macro" href="#437" title="setup_page_dma((dev), (&amp;(pt)-&gt;base))" data-ref="_M/setup_px">setup_px</a>(<a class="local col3 ref" href="#103dev" title='dev' data-ref="103dev" data-ref-filename="103dev">dev</a>, <a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>);</td></tr>
<tr><th id="515">515</th><td>	<b>if</b> (<a class="local col6 ref" href="#106ret" title='ret' data-ref="106ret" data-ref-filename="106ret">ret</a>)</td></tr>
<tr><th id="516">516</th><td>		<b>goto</b> <a class="lbl" href="#108fail_page_m" data-ref="108fail_page_m" data-ref-filename="108fail_page_m">fail_page_m</a>;</td></tr>
<tr><th id="517">517</th><td></td></tr>
<tr><th id="518">518</th><td>	<b>return</b> <a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>;</td></tr>
<tr><th id="519">519</th><td></td></tr>
<tr><th id="520">520</th><td><dfn class="lbl" id="108fail_page_m" data-ref="108fail_page_m" data-ref-filename="108fail_page_m">fail_page_m</dfn>:</td></tr>
<tr><th id="521">521</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>);</td></tr>
<tr><th id="522">522</th><td><dfn class="lbl" id="107fail_bitmap" data-ref="107fail_bitmap" data-ref-filename="107fail_bitmap">fail_bitmap</dfn>:</td></tr>
<tr><th id="523">523</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col4 ref" href="#104pt" title='pt' data-ref="104pt" data-ref-filename="104pt">pt</a>);</td></tr>
<tr><th id="524">524</th><td></td></tr>
<tr><th id="525">525</th><td>	<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col6 ref" href="#106ret" title='ret' data-ref="106ret" data-ref-filename="106ret">ret</a>);</td></tr>
<tr><th id="526">526</th><td>}</td></tr>
<tr><th id="527">527</th><td></td></tr>
<tr><th id="528">528</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="free_pt" title='free_pt' data-type='void free_pt(struct drm_device * dev, struct i915_page_table * pt)' data-ref="free_pt" data-ref-filename="free_pt">free_pt</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="109dev" title='dev' data-type='struct drm_device *' data-ref="109dev" data-ref-filename="109dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col0 decl" id="110pt" title='pt' data-type='struct i915_page_table *' data-ref="110pt" data-ref-filename="110pt">pt</dfn>)</td></tr>
<tr><th id="529">529</th><td>{</td></tr>
<tr><th id="530">530</th><td>	<a class="macro" href="#438" title="cleanup_page_dma((dev), (&amp;(pt)-&gt;base))" data-ref="_M/cleanup_px">cleanup_px</a>(<a class="local col9 ref" href="#109dev" title='dev' data-ref="109dev" data-ref-filename="109dev">dev</a>, <a class="local col0 ref" href="#110pt" title='pt' data-ref="110pt" data-ref-filename="110pt">pt</a>);</td></tr>
<tr><th id="531">531</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col0 ref" href="#110pt" title='pt' data-ref="110pt" data-ref-filename="110pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>);</td></tr>
<tr><th id="532">532</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col0 ref" href="#110pt" title='pt' data-ref="110pt" data-ref-filename="110pt">pt</a>);</td></tr>
<tr><th id="533">533</th><td>}</td></tr>
<tr><th id="534">534</th><td></td></tr>
<tr><th id="535">535</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_initialize_pt" title='gen8_initialize_pt' data-type='void gen8_initialize_pt(struct i915_address_space * vm, struct i915_page_table * pt)' data-ref="gen8_initialize_pt" data-ref-filename="gen8_initialize_pt">gen8_initialize_pt</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="111vm" title='vm' data-type='struct i915_address_space *' data-ref="111vm" data-ref-filename="111vm">vm</dfn>,</td></tr>
<tr><th id="536">536</th><td>			       <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col2 decl" id="112pt" title='pt' data-type='struct i915_page_table *' data-ref="112pt" data-ref-filename="112pt">pt</dfn>)</td></tr>
<tr><th id="537">537</th><td>{</td></tr>
<tr><th id="538">538</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col3 decl" id="113scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="113scratch_pte" data-ref-filename="113scratch_pte">scratch_pte</dfn>;</td></tr>
<tr><th id="539">539</th><td></td></tr>
<tr><th id="540">540</th><td>	<a class="local col3 ref" href="#113scratch_pte" title='scratch_pte' data-ref="113scratch_pte" data-ref-filename="113scratch_pte">scratch_pte</a> = <a class="tu ref fn" href="#gen8_pte_encode" title='gen8_pte_encode' data-use='c' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#111vm" title='vm' data-ref="111vm" data-ref-filename="111vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="541">541</th><td>				      <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="542">542</th><td></td></tr>
<tr><th id="543">543</th><td>	<a class="macro" href="#439" title="fill_page_dma((vm-&gt;dev), (&amp;(pt)-&gt;base), (scratch_pte))" data-ref="_M/fill_px">fill_px</a>(<a class="local col1 ref" href="#111vm" title='vm' data-ref="111vm" data-ref-filename="111vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col2 ref" href="#112pt" title='pt' data-ref="112pt" data-ref-filename="112pt">pt</a>, <a class="local col3 ref" href="#113scratch_pte" title='scratch_pte' data-ref="113scratch_pte" data-ref-filename="113scratch_pte">scratch_pte</a>);</td></tr>
<tr><th id="544">544</th><td>}</td></tr>
<tr><th id="545">545</th><td></td></tr>
<tr><th id="546">546</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_initialize_pt" title='gen6_initialize_pt' data-type='void gen6_initialize_pt(struct i915_address_space * vm, struct i915_page_table * pt)' data-ref="gen6_initialize_pt" data-ref-filename="gen6_initialize_pt">gen6_initialize_pt</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col4 decl" id="114vm" title='vm' data-type='struct i915_address_space *' data-ref="114vm" data-ref-filename="114vm">vm</dfn>,</td></tr>
<tr><th id="547">547</th><td>			       <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col5 decl" id="115pt" title='pt' data-type='struct i915_page_table *' data-ref="115pt" data-ref-filename="115pt">pt</dfn>)</td></tr>
<tr><th id="548">548</th><td>{</td></tr>
<tr><th id="549">549</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col6 decl" id="116scratch_pte" title='scratch_pte' data-type='gen6_pte_t' data-ref="116scratch_pte" data-ref-filename="116scratch_pte">scratch_pte</dfn>;</td></tr>
<tr><th id="550">550</th><td></td></tr>
<tr><th id="551">551</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr) == 0))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 551, &quot;px_dma(vm-&gt;scratch_page) == 0&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col4 ref" href="#114vm" title='vm' data-ref="114vm" data-ref-filename="114vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>) == <var>0</var>);</td></tr>
<tr><th id="552">552</th><td></td></tr>
<tr><th id="553">553</th><td>	<a class="local col6 ref" href="#116scratch_pte" title='scratch_pte' data-ref="116scratch_pte" data-ref-filename="116scratch_pte">scratch_pte</a> = <a class="local col4 ref" href="#114vm" title='vm' data-ref="114vm" data-ref-filename="114vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col4 ref" href="#114vm" title='vm' data-ref="114vm" data-ref-filename="114vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="554">554</th><td>				     <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, <var>0</var>);</td></tr>
<tr><th id="555">555</th><td></td></tr>
<tr><th id="556">556</th><td>	<a class="macro" href="#440" title="fill_page_dma_32((vm-&gt;dev), (&amp;(pt)-&gt;base), (scratch_pte))" data-ref="_M/fill32_px">fill32_px</a>(<a class="local col4 ref" href="#114vm" title='vm' data-ref="114vm" data-ref-filename="114vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col5 ref" href="#115pt" title='pt' data-ref="115pt" data-ref-filename="115pt">pt</a>, <a class="local col6 ref" href="#116scratch_pte" title='scratch_pte' data-ref="116scratch_pte" data-ref-filename="116scratch_pte">scratch_pte</a>);</td></tr>
<tr><th id="557">557</th><td>}</td></tr>
<tr><th id="558">558</th><td></td></tr>
<tr><th id="559">559</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="tu decl def fn" id="alloc_pd" title='alloc_pd' data-type='struct i915_page_directory * alloc_pd(struct drm_device * dev)' data-ref="alloc_pd" data-ref-filename="alloc_pd">alloc_pd</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="117dev" title='dev' data-type='struct drm_device *' data-ref="117dev" data-ref-filename="117dev">dev</dfn>)</td></tr>
<tr><th id="560">560</th><td>{</td></tr>
<tr><th id="561">561</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col8 decl" id="118pd" title='pd' data-type='struct i915_page_directory *' data-ref="118pd" data-ref-filename="118pd">pd</dfn>;</td></tr>
<tr><th id="562">562</th><td>	<em>int</em> <dfn class="local col9 decl" id="119ret" title='ret' data-type='int' data-ref="119ret" data-ref-filename="119ret">ret</dfn> = -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="563">563</th><td></td></tr>
<tr><th id="564">564</th><td>	<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="565">565</th><td>	<b>if</b> (!<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>)</td></tr>
<tr><th id="566">566</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="567">567</th><td></td></tr>
<tr><th id="568">568</th><td>	<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>),</td></tr>
<tr><th id="569">569</th><td>				<b>sizeof</b>(*<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="570">570</th><td>	<b>if</b> (!<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>)</td></tr>
<tr><th id="571">571</th><td>		<b>goto</b> <a class="lbl" href="#120fail_bitmap" data-ref="120fail_bitmap" data-ref-filename="120fail_bitmap">fail_bitmap</a>;</td></tr>
<tr><th id="572">572</th><td></td></tr>
<tr><th id="573">573</th><td>	<a class="local col9 ref" href="#119ret" title='ret' data-ref="119ret" data-ref-filename="119ret">ret</a> = <a class="macro" href="#437" title="setup_page_dma((dev), (&amp;(pd)-&gt;base))" data-ref="_M/setup_px">setup_px</a>(<a class="local col7 ref" href="#117dev" title='dev' data-ref="117dev" data-ref-filename="117dev">dev</a>, <a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>);</td></tr>
<tr><th id="574">574</th><td>	<b>if</b> (<a class="local col9 ref" href="#119ret" title='ret' data-ref="119ret" data-ref-filename="119ret">ret</a>)</td></tr>
<tr><th id="575">575</th><td>		<b>goto</b> <a class="lbl" href="#121fail_page_m" data-ref="121fail_page_m" data-ref-filename="121fail_page_m">fail_page_m</a>;</td></tr>
<tr><th id="576">576</th><td></td></tr>
<tr><th id="577">577</th><td>	<b>return</b> <a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>;</td></tr>
<tr><th id="578">578</th><td></td></tr>
<tr><th id="579">579</th><td><dfn class="lbl" id="121fail_page_m" data-ref="121fail_page_m" data-ref-filename="121fail_page_m">fail_page_m</dfn>:</td></tr>
<tr><th id="580">580</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>);</td></tr>
<tr><th id="581">581</th><td><dfn class="lbl" id="120fail_bitmap" data-ref="120fail_bitmap" data-ref-filename="120fail_bitmap">fail_bitmap</dfn>:</td></tr>
<tr><th id="582">582</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col8 ref" href="#118pd" title='pd' data-ref="118pd" data-ref-filename="118pd">pd</a>);</td></tr>
<tr><th id="583">583</th><td></td></tr>
<tr><th id="584">584</th><td>	<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col9 ref" href="#119ret" title='ret' data-ref="119ret" data-ref-filename="119ret">ret</a>);</td></tr>
<tr><th id="585">585</th><td>}</td></tr>
<tr><th id="586">586</th><td></td></tr>
<tr><th id="587">587</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="free_pd" title='free_pd' data-type='void free_pd(struct drm_device * dev, struct i915_page_directory * pd)' data-ref="free_pd" data-ref-filename="free_pd">free_pd</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col2 decl" id="122dev" title='dev' data-type='struct drm_device *' data-ref="122dev" data-ref-filename="122dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col3 decl" id="123pd" title='pd' data-type='struct i915_page_directory *' data-ref="123pd" data-ref-filename="123pd">pd</dfn>)</td></tr>
<tr><th id="588">588</th><td>{</td></tr>
<tr><th id="589">589</th><td>	<b>if</b> (<a class="macro" href="i915_gem_gtt.h.html#259" title="((&amp;(pd)-&gt;base)-&gt;page)" data-ref="_M/px_page">px_page</a>(<a class="local col3 ref" href="#123pd" title='pd' data-ref="123pd" data-ref-filename="123pd">pd</a>)) {</td></tr>
<tr><th id="590">590</th><td>		<a class="macro" href="#438" title="cleanup_page_dma((dev), (&amp;(pd)-&gt;base))" data-ref="_M/cleanup_px">cleanup_px</a>(<a class="local col2 ref" href="#122dev" title='dev' data-ref="122dev" data-ref-filename="122dev">dev</a>, <a class="local col3 ref" href="#123pd" title='pd' data-ref="123pd" data-ref-filename="123pd">pd</a>);</td></tr>
<tr><th id="591">591</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col3 ref" href="#123pd" title='pd' data-ref="123pd" data-ref-filename="123pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>);</td></tr>
<tr><th id="592">592</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col3 ref" href="#123pd" title='pd' data-ref="123pd" data-ref-filename="123pd">pd</a>);</td></tr>
<tr><th id="593">593</th><td>	}</td></tr>
<tr><th id="594">594</th><td>}</td></tr>
<tr><th id="595">595</th><td></td></tr>
<tr><th id="596">596</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_initialize_pd" title='gen8_initialize_pd' data-type='void gen8_initialize_pd(struct i915_address_space * vm, struct i915_page_directory * pd)' data-ref="gen8_initialize_pd" data-ref-filename="gen8_initialize_pd">gen8_initialize_pd</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col4 decl" id="124vm" title='vm' data-type='struct i915_address_space *' data-ref="124vm" data-ref-filename="124vm">vm</dfn>,</td></tr>
<tr><th id="597">597</th><td>			       <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col5 decl" id="125pd" title='pd' data-type='struct i915_page_directory *' data-ref="125pd" data-ref-filename="125pd">pd</dfn>)</td></tr>
<tr><th id="598">598</th><td>{</td></tr>
<tr><th id="599">599</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pde_t" title='gen8_pde_t' data-type='uint64_t' data-ref="gen8_pde_t" data-ref-filename="gen8_pde_t">gen8_pde_t</a> <dfn class="local col6 decl" id="126scratch_pde" title='scratch_pde' data-type='gen8_pde_t' data-ref="126scratch_pde" data-ref-filename="126scratch_pde">scratch_pde</dfn>;</td></tr>
<tr><th id="600">600</th><td></td></tr>
<tr><th id="601">601</th><td>	<a class="local col6 ref" href="#126scratch_pde" title='scratch_pde' data-ref="126scratch_pde" data-ref-filename="126scratch_pde">scratch_pde</a> = <a class="tu ref fn" href="#gen8_pde_encode" title='gen8_pde_encode' data-use='c' data-ref="gen8_pde_encode" data-ref-filename="gen8_pde_encode">gen8_pde_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_pt)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col4 ref" href="#124vm" title='vm' data-ref="124vm" data-ref-filename="124vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>), <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="602">602</th><td></td></tr>
<tr><th id="603">603</th><td>	<a class="macro" href="#439" title="fill_page_dma((vm-&gt;dev), (&amp;(pd)-&gt;base), (scratch_pde))" data-ref="_M/fill_px">fill_px</a>(<a class="local col4 ref" href="#124vm" title='vm' data-ref="124vm" data-ref-filename="124vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col5 ref" href="#125pd" title='pd' data-ref="125pd" data-ref-filename="125pd">pd</a>, <a class="local col6 ref" href="#126scratch_pde" title='scratch_pde' data-ref="126scratch_pde" data-ref-filename="126scratch_pde">scratch_pde</a>);</td></tr>
<tr><th id="604">604</th><td>}</td></tr>
<tr><th id="605">605</th><td></td></tr>
<tr><th id="606">606</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="__pdp_init" title='__pdp_init' data-type='int __pdp_init(struct drm_device * dev, struct i915_page_directory_pointer * pdp)' data-ref="__pdp_init" data-ref-filename="__pdp_init">__pdp_init</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="127dev" title='dev' data-type='struct drm_device *' data-ref="127dev" data-ref-filename="127dev">dev</dfn>,</td></tr>
<tr><th id="607">607</th><td>		      <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col8 decl" id="128pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="128pdp" data-ref-filename="128pdp">pdp</dfn>)</td></tr>
<tr><th id="608">608</th><td>{</td></tr>
<tr><th id="609">609</th><td>	<a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col9 decl" id="129pdpes" title='pdpes' data-type='size_t' data-ref="129pdpes" data-ref-filename="129pdpes">pdpes</dfn> = <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(dev);</td></tr>
<tr><th id="610">610</th><td></td></tr>
<tr><th id="611">611</th><td>	<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((pdpes)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="local col9 ref" href="#129pdpes" title='pdpes' data-ref="129pdpes" data-ref-filename="129pdpes">pdpes</a>),</td></tr>
<tr><th id="612">612</th><td>				  <b>sizeof</b>(<em>unsigned</em> <em>long</em>),</td></tr>
<tr><th id="613">613</th><td>				  <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="614">614</th><td>	<b>if</b> (!<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>)</td></tr>
<tr><th id="615">615</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="616">616</th><td></td></tr>
<tr><th id="617">617</th><td>	<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="local col9 ref" href="#129pdpes" title='pdpes' data-ref="129pdpes" data-ref-filename="129pdpes">pdpes</a>, <b>sizeof</b>(*<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>),</td></tr>
<tr><th id="618">618</th><td>				      <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="619">619</th><td>	<b>if</b> (!<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>) {</td></tr>
<tr><th id="620">620</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>);</td></tr>
<tr><th id="621">621</th><td>		<i>/* the PDP might be the statically allocated top level. Keep it</i></td></tr>
<tr><th id="622">622</th><td><i>		 * as clean as possible */</i></td></tr>
<tr><th id="623">623</th><td>		<a class="local col8 ref" href="#128pdp" title='pdp' data-ref="128pdp" data-ref-filename="128pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="624">624</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="625">625</th><td>	}</td></tr>
<tr><th id="626">626</th><td></td></tr>
<tr><th id="627">627</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="628">628</th><td>}</td></tr>
<tr><th id="629">629</th><td></td></tr>
<tr><th id="630">630</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="__pdp_fini" title='__pdp_fini' data-type='void __pdp_fini(struct i915_page_directory_pointer * pdp)' data-ref="__pdp_fini" data-ref-filename="__pdp_fini">__pdp_fini</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col0 decl" id="130pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="130pdp" data-ref-filename="130pdp">pdp</dfn>)</td></tr>
<tr><th id="631">631</th><td>{</td></tr>
<tr><th id="632">632</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col0 ref" href="#130pdp" title='pdp' data-ref="130pdp" data-ref-filename="130pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>);</td></tr>
<tr><th id="633">633</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col0 ref" href="#130pdp" title='pdp' data-ref="130pdp" data-ref-filename="130pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>);</td></tr>
<tr><th id="634">634</th><td>	<a class="local col0 ref" href="#130pdp" title='pdp' data-ref="130pdp" data-ref-filename="130pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="635">635</th><td>}</td></tr>
<tr><th id="636">636</th><td></td></tr>
<tr><th id="637">637</th><td><em>static</em> <b>struct</b></td></tr>
<tr><th id="638">638</th><td><a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="tu decl def fn" id="alloc_pdp" title='alloc_pdp' data-type='struct i915_page_directory_pointer * alloc_pdp(struct drm_device * dev)' data-ref="alloc_pdp" data-ref-filename="alloc_pdp">alloc_pdp</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col1 decl" id="131dev" title='dev' data-type='struct drm_device *' data-ref="131dev" data-ref-filename="131dev">dev</dfn>)</td></tr>
<tr><th id="639">639</th><td>{</td></tr>
<tr><th id="640">640</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col2 decl" id="132pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="132pdp" data-ref-filename="132pdp">pdp</dfn>;</td></tr>
<tr><th id="641">641</th><td>	<em>int</em> <dfn class="local col3 decl" id="133ret" title='ret' data-type='int' data-ref="133ret" data-ref-filename="133ret">ret</dfn> = -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="642">642</th><td></td></tr>
<tr><th id="643">643</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!(i915.enable_ppgtt == 3)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 643, &quot;!USES_FULL_48BIT_PPGTT(dev)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev));</td></tr>
<tr><th id="644">644</th><td></td></tr>
<tr><th id="645">645</th><td>	<a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="646">646</th><td>	<b>if</b> (!<a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>)</td></tr>
<tr><th id="647">647</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="648">648</th><td></td></tr>
<tr><th id="649">649</th><td>	<a class="local col3 ref" href="#133ret" title='ret' data-ref="133ret" data-ref-filename="133ret">ret</a> = <a class="tu ref fn" href="#__pdp_init" title='__pdp_init' data-use='c' data-ref="__pdp_init" data-ref-filename="__pdp_init">__pdp_init</a>(<a class="local col1 ref" href="#131dev" title='dev' data-ref="131dev" data-ref-filename="131dev">dev</a>, <a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>);</td></tr>
<tr><th id="650">650</th><td>	<b>if</b> (<a class="local col3 ref" href="#133ret" title='ret' data-ref="133ret" data-ref-filename="133ret">ret</a>)</td></tr>
<tr><th id="651">651</th><td>		<b>goto</b> <a class="lbl" href="#134fail_bitmap" data-ref="134fail_bitmap" data-ref-filename="134fail_bitmap">fail_bitmap</a>;</td></tr>
<tr><th id="652">652</th><td></td></tr>
<tr><th id="653">653</th><td>	<a class="local col3 ref" href="#133ret" title='ret' data-ref="133ret" data-ref-filename="133ret">ret</a> = <a class="macro" href="#437" title="setup_page_dma((dev), (&amp;(pdp)-&gt;base))" data-ref="_M/setup_px">setup_px</a>(<a class="local col1 ref" href="#131dev" title='dev' data-ref="131dev" data-ref-filename="131dev">dev</a>, <a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>);</td></tr>
<tr><th id="654">654</th><td>	<b>if</b> (<a class="local col3 ref" href="#133ret" title='ret' data-ref="133ret" data-ref-filename="133ret">ret</a>)</td></tr>
<tr><th id="655">655</th><td>		<b>goto</b> <a class="lbl" href="#135fail_page_m" data-ref="135fail_page_m" data-ref-filename="135fail_page_m">fail_page_m</a>;</td></tr>
<tr><th id="656">656</th><td></td></tr>
<tr><th id="657">657</th><td>	<b>return</b> <a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>;</td></tr>
<tr><th id="658">658</th><td></td></tr>
<tr><th id="659">659</th><td><dfn class="lbl" id="135fail_page_m" data-ref="135fail_page_m" data-ref-filename="135fail_page_m">fail_page_m</dfn>:</td></tr>
<tr><th id="660">660</th><td>	<a class="tu ref fn" href="#__pdp_fini" title='__pdp_fini' data-use='c' data-ref="__pdp_fini" data-ref-filename="__pdp_fini">__pdp_fini</a>(<a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>);</td></tr>
<tr><th id="661">661</th><td><dfn class="lbl" id="134fail_bitmap" data-ref="134fail_bitmap" data-ref-filename="134fail_bitmap">fail_bitmap</dfn>:</td></tr>
<tr><th id="662">662</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col2 ref" href="#132pdp" title='pdp' data-ref="132pdp" data-ref-filename="132pdp">pdp</a>);</td></tr>
<tr><th id="663">663</th><td></td></tr>
<tr><th id="664">664</th><td>	<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col3 ref" href="#133ret" title='ret' data-ref="133ret" data-ref-filename="133ret">ret</a>);</td></tr>
<tr><th id="665">665</th><td>}</td></tr>
<tr><th id="666">666</th><td></td></tr>
<tr><th id="667">667</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="free_pdp" title='free_pdp' data-type='void free_pdp(struct drm_device * dev, struct i915_page_directory_pointer * pdp)' data-ref="free_pdp" data-ref-filename="free_pdp">free_pdp</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col6 decl" id="136dev" title='dev' data-type='struct drm_device *' data-ref="136dev" data-ref-filename="136dev">dev</dfn>,</td></tr>
<tr><th id="668">668</th><td>		     <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col7 decl" id="137pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="137pdp" data-ref-filename="137pdp">pdp</dfn>)</td></tr>
<tr><th id="669">669</th><td>{</td></tr>
<tr><th id="670">670</th><td>	<a class="tu ref fn" href="#__pdp_fini" title='__pdp_fini' data-use='c' data-ref="__pdp_fini" data-ref-filename="__pdp_fini">__pdp_fini</a>(<a class="local col7 ref" href="#137pdp" title='pdp' data-ref="137pdp" data-ref-filename="137pdp">pdp</a>);</td></tr>
<tr><th id="671">671</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev)) {</td></tr>
<tr><th id="672">672</th><td>		<a class="macro" href="#438" title="cleanup_page_dma((dev), (&amp;(pdp)-&gt;base))" data-ref="_M/cleanup_px">cleanup_px</a>(<a class="local col6 ref" href="#136dev" title='dev' data-ref="136dev" data-ref-filename="136dev">dev</a>, <a class="local col7 ref" href="#137pdp" title='pdp' data-ref="137pdp" data-ref-filename="137pdp">pdp</a>);</td></tr>
<tr><th id="673">673</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col7 ref" href="#137pdp" title='pdp' data-ref="137pdp" data-ref-filename="137pdp">pdp</a>);</td></tr>
<tr><th id="674">674</th><td>	}</td></tr>
<tr><th id="675">675</th><td>}</td></tr>
<tr><th id="676">676</th><td></td></tr>
<tr><th id="677">677</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_initialize_pdp" title='gen8_initialize_pdp' data-type='void gen8_initialize_pdp(struct i915_address_space * vm, struct i915_page_directory_pointer * pdp)' data-ref="gen8_initialize_pdp" data-ref-filename="gen8_initialize_pdp">gen8_initialize_pdp</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="138vm" title='vm' data-type='struct i915_address_space *' data-ref="138vm" data-ref-filename="138vm">vm</dfn>,</td></tr>
<tr><th id="678">678</th><td>				<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col9 decl" id="139pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="139pdp" data-ref-filename="139pdp">pdp</dfn>)</td></tr>
<tr><th id="679">679</th><td>{</td></tr>
<tr><th id="680">680</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_ppgtt_pdpe_t" title='gen8_ppgtt_pdpe_t' data-type='uint64_t' data-ref="gen8_ppgtt_pdpe_t" data-ref-filename="gen8_ppgtt_pdpe_t">gen8_ppgtt_pdpe_t</a> <dfn class="local col0 decl" id="140scratch_pdpe" title='scratch_pdpe' data-type='gen8_ppgtt_pdpe_t' data-ref="140scratch_pdpe" data-ref-filename="140scratch_pdpe">scratch_pdpe</dfn>;</td></tr>
<tr><th id="681">681</th><td></td></tr>
<tr><th id="682">682</th><td>	<a class="local col0 ref" href="#140scratch_pdpe" title='scratch_pdpe' data-ref="140scratch_pdpe" data-ref-filename="140scratch_pdpe">scratch_pdpe</a> = <a class="macro" href="#225" title="gen8_pde_encode" data-ref="_M/gen8_pdpe_encode">gen8_pdpe_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_pd)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col8 ref" href="#138vm" title='vm' data-ref="138vm" data-ref-filename="138vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>), <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="683">683</th><td></td></tr>
<tr><th id="684">684</th><td>	<a class="macro" href="#439" title="fill_page_dma((vm-&gt;dev), (&amp;(pdp)-&gt;base), (scratch_pdpe))" data-ref="_M/fill_px">fill_px</a>(<a class="local col8 ref" href="#138vm" title='vm' data-ref="138vm" data-ref-filename="138vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col9 ref" href="#139pdp" title='pdp' data-ref="139pdp" data-ref-filename="139pdp">pdp</a>, <a class="local col0 ref" href="#140scratch_pdpe" title='scratch_pdpe' data-ref="140scratch_pdpe" data-ref-filename="140scratch_pdpe">scratch_pdpe</a>);</td></tr>
<tr><th id="685">685</th><td>}</td></tr>
<tr><th id="686">686</th><td></td></tr>
<tr><th id="687">687</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_initialize_pml4" title='gen8_initialize_pml4' data-type='void gen8_initialize_pml4(struct i915_address_space * vm, struct i915_pml4 * pml4)' data-ref="gen8_initialize_pml4" data-ref-filename="gen8_initialize_pml4">gen8_initialize_pml4</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="141vm" title='vm' data-type='struct i915_address_space *' data-ref="141vm" data-ref-filename="141vm">vm</dfn>,</td></tr>
<tr><th id="688">688</th><td>				 <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_pml4" title='i915_pml4' data-ref="i915_pml4" data-ref-filename="i915_pml4">i915_pml4</a> *<dfn class="local col2 decl" id="142pml4" title='pml4' data-type='struct i915_pml4 *' data-ref="142pml4" data-ref-filename="142pml4">pml4</dfn>)</td></tr>
<tr><th id="689">689</th><td>{</td></tr>
<tr><th id="690">690</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_ppgtt_pml4e_t" title='gen8_ppgtt_pml4e_t' data-type='uint64_t' data-ref="gen8_ppgtt_pml4e_t" data-ref-filename="gen8_ppgtt_pml4e_t">gen8_ppgtt_pml4e_t</a> <dfn class="local col3 decl" id="143scratch_pml4e" title='scratch_pml4e' data-type='gen8_ppgtt_pml4e_t' data-ref="143scratch_pml4e" data-ref-filename="143scratch_pml4e">scratch_pml4e</dfn>;</td></tr>
<tr><th id="691">691</th><td></td></tr>
<tr><th id="692">692</th><td>	<a class="local col3 ref" href="#143scratch_pml4e" title='scratch_pml4e' data-ref="143scratch_pml4e" data-ref-filename="143scratch_pml4e">scratch_pml4e</a> = <a class="macro" href="#226" title="gen8_pde_encode" data-ref="_M/gen8_pml4e_encode">gen8_pml4e_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_pdp)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#141vm" title='vm' data-ref="141vm" data-ref-filename="141vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a>),</td></tr>
<tr><th id="693">693</th><td>					  <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="694">694</th><td></td></tr>
<tr><th id="695">695</th><td>	<a class="macro" href="#439" title="fill_page_dma((vm-&gt;dev), (&amp;(pml4)-&gt;base), (scratch_pml4e))" data-ref="_M/fill_px">fill_px</a>(<a class="local col1 ref" href="#141vm" title='vm' data-ref="141vm" data-ref-filename="141vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col2 ref" href="#142pml4" title='pml4' data-ref="142pml4" data-ref-filename="142pml4">pml4</a>, <a class="local col3 ref" href="#143scratch_pml4e" title='scratch_pml4e' data-ref="143scratch_pml4e" data-ref-filename="143scratch_pml4e">scratch_pml4e</a>);</td></tr>
<tr><th id="696">696</th><td>}</td></tr>
<tr><th id="697">697</th><td></td></tr>
<tr><th id="698">698</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="699">699</th><td><dfn class="tu decl def fn" id="gen8_setup_page_directory" title='gen8_setup_page_directory' data-type='void gen8_setup_page_directory(struct i915_hw_ppgtt * ppgtt, struct i915_page_directory_pointer * pdp, struct i915_page_directory * pd, int index)' data-ref="gen8_setup_page_directory" data-ref-filename="gen8_setup_page_directory">gen8_setup_page_directory</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="144ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="144ppgtt" data-ref-filename="144ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="700">700</th><td>			  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col5 decl" id="145pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="145pdp" data-ref-filename="145pdp">pdp</dfn>,</td></tr>
<tr><th id="701">701</th><td>			  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col6 decl" id="146pd" title='pd' data-type='struct i915_page_directory *' data-ref="146pd" data-ref-filename="146pd">pd</dfn>,</td></tr>
<tr><th id="702">702</th><td>			  <em>int</em> <dfn class="local col7 decl" id="147index" title='index' data-type='int' data-ref="147index" data-ref-filename="147index">index</dfn>)</td></tr>
<tr><th id="703">703</th><td>{</td></tr>
<tr><th id="704">704</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_ppgtt_pdpe_t" title='gen8_ppgtt_pdpe_t' data-type='uint64_t' data-ref="gen8_ppgtt_pdpe_t" data-ref-filename="gen8_ppgtt_pdpe_t">gen8_ppgtt_pdpe_t</a> *<dfn class="local col8 decl" id="148page_directorypo" title='page_directorypo' data-type='gen8_ppgtt_pdpe_t *' data-ref="148page_directorypo" data-ref-filename="148page_directorypo">page_directorypo</dfn>;</td></tr>
<tr><th id="705">705</th><td></td></tr>
<tr><th id="706">706</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(ppgtt-&gt;base.dev))</td></tr>
<tr><th id="707">707</th><td>		<b>return</b>;</td></tr>
<tr><th id="708">708</th><td></td></tr>
<tr><th id="709">709</th><td>	<a class="local col8 ref" href="#148page_directorypo" title='page_directorypo' data-ref="148page_directorypo" data-ref-filename="148page_directorypo">page_directorypo</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pdp)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col5 ref" href="#145pdp" title='pdp' data-ref="145pdp" data-ref-filename="145pdp">pdp</a>);</td></tr>
<tr><th id="710">710</th><td>	<a class="local col8 ref" href="#148page_directorypo" title='page_directorypo' data-ref="148page_directorypo" data-ref-filename="148page_directorypo">page_directorypo</a>[<a class="local col7 ref" href="#147index" title='index' data-ref="147index" data-ref-filename="147index">index</a>] = <a class="macro" href="#225" title="gen8_pde_encode" data-ref="_M/gen8_pdpe_encode">gen8_pdpe_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(pd)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col6 ref" href="#146pd" title='pd' data-ref="146pd" data-ref-filename="146pd">pd</a>), <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="711">711</th><td>	<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (page_directorypo))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col4 ref" href="#144ppgtt" title='ppgtt' data-ref="144ppgtt" data-ref-filename="144ppgtt">ppgtt</a>, <a class="local col8 ref" href="#148page_directorypo" title='page_directorypo' data-ref="148page_directorypo" data-ref-filename="148page_directorypo">page_directorypo</a>);</td></tr>
<tr><th id="712">712</th><td>}</td></tr>
<tr><th id="713">713</th><td></td></tr>
<tr><th id="714">714</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="715">715</th><td><dfn class="tu decl def fn" id="gen8_setup_page_directory_pointer" title='gen8_setup_page_directory_pointer' data-type='void gen8_setup_page_directory_pointer(struct i915_hw_ppgtt * ppgtt, struct i915_pml4 * pml4, struct i915_page_directory_pointer * pdp, int index)' data-ref="gen8_setup_page_directory_pointer" data-ref-filename="gen8_setup_page_directory_pointer">gen8_setup_page_directory_pointer</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col9 decl" id="149ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="149ppgtt" data-ref-filename="149ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="716">716</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_pml4" title='i915_pml4' data-ref="i915_pml4" data-ref-filename="i915_pml4">i915_pml4</a> *<dfn class="local col0 decl" id="150pml4" title='pml4' data-type='struct i915_pml4 *' data-ref="150pml4" data-ref-filename="150pml4">pml4</dfn>,</td></tr>
<tr><th id="717">717</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col1 decl" id="151pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="151pdp" data-ref-filename="151pdp">pdp</dfn>,</td></tr>
<tr><th id="718">718</th><td>				  <em>int</em> <dfn class="local col2 decl" id="152index" title='index' data-type='int' data-ref="152index" data-ref-filename="152index">index</dfn>)</td></tr>
<tr><th id="719">719</th><td>{</td></tr>
<tr><th id="720">720</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_ppgtt_pml4e_t" title='gen8_ppgtt_pml4e_t' data-type='uint64_t' data-ref="gen8_ppgtt_pml4e_t" data-ref-filename="gen8_ppgtt_pml4e_t">gen8_ppgtt_pml4e_t</a> *<dfn class="local col3 decl" id="153pagemap" title='pagemap' data-type='gen8_ppgtt_pml4e_t *' data-ref="153pagemap" data-ref-filename="153pagemap">pagemap</dfn> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pml4)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col0 ref" href="#150pml4" title='pml4' data-ref="150pml4" data-ref-filename="150pml4">pml4</a>);</td></tr>
<tr><th id="721">721</th><td></td></tr>
<tr><th id="722">722</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!(i915.enable_ppgtt == 3)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 722, &quot;!USES_FULL_48BIT_PPGTT(ppgtt-&gt;base.dev)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(ppgtt-&gt;base.dev));</td></tr>
<tr><th id="723">723</th><td>	<a class="local col3 ref" href="#153pagemap" title='pagemap' data-ref="153pagemap" data-ref-filename="153pagemap">pagemap</a>[<a class="local col2 ref" href="#152index" title='index' data-ref="152index" data-ref-filename="152index">index</a>] = <a class="macro" href="#226" title="gen8_pde_encode" data-ref="_M/gen8_pml4e_encode">gen8_pml4e_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(pdp)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#151pdp" title='pdp' data-ref="151pdp" data-ref-filename="151pdp">pdp</a>), <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="724">724</th><td>	<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pagemap))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col9 ref" href="#149ppgtt" title='ppgtt' data-ref="149ppgtt" data-ref-filename="149ppgtt">ppgtt</a>, <a class="local col3 ref" href="#153pagemap" title='pagemap' data-ref="153pagemap" data-ref-filename="153pagemap">pagemap</a>);</td></tr>
<tr><th id="725">725</th><td>}</td></tr>
<tr><th id="726">726</th><td></td></tr>
<tr><th id="727">727</th><td><i  data-doc="gen8_write_pdp">/* Broadwell Page Directory Pointer Descriptors */</i></td></tr>
<tr><th id="728">728</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_write_pdp" title='gen8_write_pdp' data-type='int gen8_write_pdp(struct drm_i915_gem_request * req, unsigned int entry, dma_addr_t addr)' data-ref="gen8_write_pdp" data-ref-filename="gen8_write_pdp">gen8_write_pdp</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col4 decl" id="154req" title='req' data-type='struct drm_i915_gem_request *' data-ref="154req" data-ref-filename="154req">req</dfn>,</td></tr>
<tr><th id="729">729</th><td>			  <em>unsigned</em> <dfn class="local col5 decl" id="155entry" title='entry' data-type='unsigned int' data-ref="155entry" data-ref-filename="155entry">entry</dfn>,</td></tr>
<tr><th id="730">730</th><td>			  <a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col6 decl" id="156addr" title='addr' data-type='dma_addr_t' data-ref="156addr" data-ref-filename="156addr">addr</dfn>)</td></tr>
<tr><th id="731">731</th><td>{</td></tr>
<tr><th id="732">732</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col7 decl" id="157ring" title='ring' data-type='struct intel_engine_cs *' data-ref="157ring" data-ref-filename="157ring">ring</dfn> = <a class="local col4 ref" href="#154req" title='req' data-ref="154req" data-ref-filename="154req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>;</td></tr>
<tr><th id="733">733</th><td>	<em>int</em> <dfn class="local col8 decl" id="158ret" title='ret' data-type='int' data-ref="158ret" data-ref-filename="158ret">ret</dfn>;</td></tr>
<tr><th id="734">734</th><td></td></tr>
<tr><th id="735">735</th><td>	<a class="macro" href="../../../include/asm/bug.h.html#39" title="(__builtin_expect(((!(entry &gt;= 4))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;!(entry &gt;= 4)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 735))" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="local col5 ref" href="#155entry" title='entry' data-ref="155entry" data-ref-filename="155entry">entry</a> &gt;= <var>4</var>);</td></tr>
<tr><th id="736">736</th><td></td></tr>
<tr><th id="737">737</th><td>	<a class="local col8 ref" href="#158ret" title='ret' data-ref="158ret" data-ref-filename="158ret">ret</a> = <a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_begin" title='intel_ring_begin' data-ref="intel_ring_begin" data-ref-filename="intel_ring_begin">intel_ring_begin</a>(<a class="local col4 ref" href="#154req" title='req' data-ref="154req" data-ref-filename="154req">req</a>, <var>6</var>);</td></tr>
<tr><th id="738">738</th><td>	<b>if</b> (<a class="local col8 ref" href="#158ret" title='ret' data-ref="158ret" data-ref-filename="158ret">ret</a>)</td></tr>
<tr><th id="739">739</th><td>		<b>return</b> <a class="local col8 ref" href="#158ret" title='ret' data-ref="158ret" data-ref-filename="158ret">ret</a>;</td></tr>
<tr><th id="740">740</th><td></td></tr>
<tr><th id="741">741</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="i915_reg.h.html#358" title="(((0x22) &lt;&lt; 23) | (2*(1)-1))" data-ref="_M/MI_LOAD_REGISTER_IMM">MI_LOAD_REGISTER_IMM</a>(<var>1</var>));</td></tr>
<tr><th id="742">742</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="i915_reg.h.html#149" title="((ring)-&gt;mmio_base+0x270 + ((entry) * 8 + 4))" data-ref="_M/GEN8_RING_PDP_UDW">GEN8_RING_PDP_UDW</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="local col5 ref" href="#155entry" title='entry' data-ref="155entry" data-ref-filename="155entry">entry</a>));</td></tr>
<tr><th id="743">743</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#117" title="((uint32_t) (((addr) &gt;&gt; 16) &gt;&gt; 16))" data-ref="_M/upper_32_bits">upper_32_bits</a>(<a class="local col6 ref" href="#156addr" title='addr' data-ref="156addr" data-ref-filename="156addr">addr</a>));</td></tr>
<tr><th id="744">744</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="i915_reg.h.html#358" title="(((0x22) &lt;&lt; 23) | (2*(1)-1))" data-ref="_M/MI_LOAD_REGISTER_IMM">MI_LOAD_REGISTER_IMM</a>(<var>1</var>));</td></tr>
<tr><th id="745">745</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="i915_reg.h.html#150" title="((ring)-&gt;mmio_base+0x270 + (entry) * 8)" data-ref="_M/GEN8_RING_PDP_LDW">GEN8_RING_PDP_LDW</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="local col5 ref" href="#155entry" title='entry' data-ref="155entry" data-ref-filename="155entry">entry</a>));</td></tr>
<tr><th id="746">746</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#118" title="((uint32_t) ((addr) &amp; 0xffffffffUL))" data-ref="_M/lower_32_bits">lower_32_bits</a>(<a class="local col6 ref" href="#156addr" title='addr' data-ref="156addr" data-ref-filename="156addr">addr</a>));</td></tr>
<tr><th id="747">747</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_advance" title='intel_ring_advance' data-ref="intel_ring_advance" data-ref-filename="intel_ring_advance">intel_ring_advance</a>(<a class="local col7 ref" href="#157ring" title='ring' data-ref="157ring" data-ref-filename="157ring">ring</a>);</td></tr>
<tr><th id="748">748</th><td></td></tr>
<tr><th id="749">749</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="750">750</th><td>}</td></tr>
<tr><th id="751">751</th><td></td></tr>
<tr><th id="752">752</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_legacy_mm_switch" title='gen8_legacy_mm_switch' data-type='int gen8_legacy_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="gen8_legacy_mm_switch" data-ref-filename="gen8_legacy_mm_switch">gen8_legacy_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col9 decl" id="159ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="159ppgtt" data-ref-filename="159ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="753">753</th><td>				 <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col0 decl" id="160req" title='req' data-type='struct drm_i915_gem_request *' data-ref="160req" data-ref-filename="160req">req</dfn>)</td></tr>
<tr><th id="754">754</th><td>{</td></tr>
<tr><th id="755">755</th><td>	<em>int</em> <dfn class="local col1 decl" id="161i" title='i' data-type='int' data-ref="161i" data-ref-filename="161i">i</dfn>, <dfn class="local col2 decl" id="162ret" title='ret' data-type='int' data-ref="162ret" data-ref-filename="162ret">ret</dfn>;</td></tr>
<tr><th id="756">756</th><td></td></tr>
<tr><th id="757">757</th><td>	<b>for</b> (<a class="local col1 ref" href="#161i" title='i' data-ref="161i" data-ref-filename="161i">i</a> = <a class="macro" href="i915_gem_gtt.h.html#111" title="4" data-ref="_M/GEN8_LEGACY_PDPES">GEN8_LEGACY_PDPES</a> - <var>1</var>; <a class="local col1 ref" href="#161i" title='i' data-ref="161i" data-ref-filename="161i">i</a> &gt;= <var>0</var>; <a class="local col1 ref" href="#161i" title='i' data-ref="161i" data-ref-filename="161i">i</a>--) {</td></tr>
<tr><th id="758">758</th><td>		<em>const</em> <a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col3 decl" id="163pd_daddr" title='pd_daddr' data-type='const dma_addr_t' data-ref="163pd_daddr" data-ref-filename="163pd_daddr">pd_daddr</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#i915_page_dir_dma_addr" title='i915_page_dir_dma_addr' data-ref="i915_page_dir_dma_addr" data-ref-filename="i915_page_dir_dma_addr">i915_page_dir_dma_addr</a>(<a class="local col9 ref" href="#159ppgtt" title='ppgtt' data-ref="159ppgtt" data-ref-filename="159ppgtt">ppgtt</a>, <a class="local col1 ref" href="#161i" title='i' data-ref="161i" data-ref-filename="161i">i</a>);</td></tr>
<tr><th id="759">759</th><td></td></tr>
<tr><th id="760">760</th><td>		<a class="local col2 ref" href="#162ret" title='ret' data-ref="162ret" data-ref-filename="162ret">ret</a> = <a class="tu ref fn" href="#gen8_write_pdp" title='gen8_write_pdp' data-use='c' data-ref="gen8_write_pdp" data-ref-filename="gen8_write_pdp">gen8_write_pdp</a>(<a class="local col0 ref" href="#160req" title='req' data-ref="160req" data-ref-filename="160req">req</a>, <a class="local col1 ref" href="#161i" title='i' data-ref="161i" data-ref-filename="161i">i</a>, <a class="local col3 ref" href="#163pd_daddr" title='pd_daddr' data-ref="163pd_daddr" data-ref-filename="163pd_daddr">pd_daddr</a>);</td></tr>
<tr><th id="761">761</th><td>		<b>if</b> (<a class="local col2 ref" href="#162ret" title='ret' data-ref="162ret" data-ref-filename="162ret">ret</a>)</td></tr>
<tr><th id="762">762</th><td>			<b>return</b> <a class="local col2 ref" href="#162ret" title='ret' data-ref="162ret" data-ref-filename="162ret">ret</a>;</td></tr>
<tr><th id="763">763</th><td>	}</td></tr>
<tr><th id="764">764</th><td></td></tr>
<tr><th id="765">765</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="766">766</th><td>}</td></tr>
<tr><th id="767">767</th><td></td></tr>
<tr><th id="768">768</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_48b_mm_switch" title='gen8_48b_mm_switch' data-type='int gen8_48b_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="gen8_48b_mm_switch" data-ref-filename="gen8_48b_mm_switch">gen8_48b_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="164ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="164ppgtt" data-ref-filename="164ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="769">769</th><td>			      <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col5 decl" id="165req" title='req' data-type='struct drm_i915_gem_request *' data-ref="165req" data-ref-filename="165req">req</dfn>)</td></tr>
<tr><th id="770">770</th><td>{</td></tr>
<tr><th id="771">771</th><td>	<b>return</b> <a class="tu ref fn" href="#gen8_write_pdp" title='gen8_write_pdp' data-use='c' data-ref="gen8_write_pdp" data-ref-filename="gen8_write_pdp">gen8_write_pdp</a>(<a class="local col5 ref" href="#165req" title='req' data-ref="165req" data-ref-filename="165req">req</a>, <var>0</var>, <a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(&amp;ppgtt-&gt;pml4)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(&amp;<a class="local col4 ref" href="#164ppgtt" title='ppgtt' data-ref="164ppgtt" data-ref-filename="164ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>));</td></tr>
<tr><th id="772">772</th><td>}</td></tr>
<tr><th id="773">773</th><td></td></tr>
<tr><th id="774">774</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_clear_pte_range" title='gen8_ppgtt_clear_pte_range' data-type='void gen8_ppgtt_clear_pte_range(struct i915_address_space * vm, struct i915_page_directory_pointer * pdp, uint64_t start, uint64_t length, gen8_pte_t scratch_pte)' data-ref="gen8_ppgtt_clear_pte_range" data-ref-filename="gen8_ppgtt_clear_pte_range">gen8_ppgtt_clear_pte_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col6 decl" id="166vm" title='vm' data-type='struct i915_address_space *' data-ref="166vm" data-ref-filename="166vm">vm</dfn>,</td></tr>
<tr><th id="775">775</th><td>				       <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col7 decl" id="167pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="167pdp" data-ref-filename="167pdp">pdp</dfn>,</td></tr>
<tr><th id="776">776</th><td>				       <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="168start" title='start' data-type='uint64_t' data-ref="168start" data-ref-filename="168start">start</dfn>,</td></tr>
<tr><th id="777">777</th><td>				       <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="169length" title='length' data-type='uint64_t' data-ref="169length" data-ref-filename="169length">length</dfn>,</td></tr>
<tr><th id="778">778</th><td>				       <a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col0 decl" id="170scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="170scratch_pte" data-ref-filename="170scratch_pte">scratch_pte</dfn>)</td></tr>
<tr><th id="779">779</th><td>{</td></tr>
<tr><th id="780">780</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="171ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="171ppgtt" data-ref-filename="171ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="781">781</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col6 ref" href="#166vm" title='vm' data-ref="166vm" data-ref-filename="166vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="782">782</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> *<dfn class="local col2 decl" id="172pt_vaddr" title='pt_vaddr' data-type='gen8_pte_t *' data-ref="172pt_vaddr" data-ref-filename="172pt_vaddr">pt_vaddr</dfn>;</td></tr>
<tr><th id="783">783</th><td>	<em>unsigned</em> <dfn class="local col3 decl" id="173pdpe" title='pdpe' data-type='unsigned int' data-ref="173pdpe" data-ref-filename="173pdpe">pdpe</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pdpe_index" title='gen8_pdpe_index' data-ref="gen8_pdpe_index" data-ref-filename="gen8_pdpe_index">gen8_pdpe_index</a>(<a class="local col8 ref" href="#168start" title='start' data-ref="168start" data-ref-filename="168start">start</a>);</td></tr>
<tr><th id="784">784</th><td>	<em>unsigned</em> <dfn class="local col4 decl" id="174pde" title='pde' data-type='unsigned int' data-ref="174pde" data-ref-filename="174pde">pde</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pde_index" title='gen8_pde_index' data-ref="gen8_pde_index" data-ref-filename="gen8_pde_index">gen8_pde_index</a>(<a class="local col8 ref" href="#168start" title='start' data-ref="168start" data-ref-filename="168start">start</a>);</td></tr>
<tr><th id="785">785</th><td>	<em>unsigned</em> <dfn class="local col5 decl" id="175pte" title='pte' data-type='unsigned int' data-ref="175pte" data-ref-filename="175pte">pte</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_index" title='gen8_pte_index' data-ref="gen8_pte_index" data-ref-filename="gen8_pte_index">gen8_pte_index</a>(<a class="local col8 ref" href="#168start" title='start' data-ref="168start" data-ref-filename="168start">start</a>);</td></tr>
<tr><th id="786">786</th><td>	<em>unsigned</em> <dfn class="local col6 decl" id="176num_entries" title='num_entries' data-type='unsigned int' data-ref="176num_entries" data-ref-filename="176num_entries">num_entries</dfn> = <a class="local col9 ref" href="#169length" title='length' data-ref="169length" data-ref-filename="169length">length</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="787">787</th><td>	<em>unsigned</em> <dfn class="local col7 decl" id="177last_pte" title='last_pte' data-type='unsigned int' data-ref="177last_pte" data-ref-filename="177last_pte">last_pte</dfn>, <dfn class="local col8 decl" id="178i" title='i' data-type='unsigned int' data-ref="178i" data-ref-filename="178i">i</dfn>;</td></tr>
<tr><th id="788">788</th><td></td></tr>
<tr><th id="789">789</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pdp))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 789, &quot;!pdp&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col7 ref" href="#167pdp" title='pdp' data-ref="167pdp" data-ref-filename="167pdp">pdp</a>))</td></tr>
<tr><th id="790">790</th><td>		<b>return</b>;</td></tr>
<tr><th id="791">791</th><td></td></tr>
<tr><th id="792">792</th><td>	<b>while</b> (<a class="local col6 ref" href="#176num_entries" title='num_entries' data-ref="176num_entries" data-ref-filename="176num_entries">num_entries</a>) {</td></tr>
<tr><th id="793">793</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col9 decl" id="179pd" title='pd' data-type='struct i915_page_directory *' data-ref="179pd" data-ref-filename="179pd">pd</dfn>;</td></tr>
<tr><th id="794">794</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col0 decl" id="180pt" title='pt' data-type='struct i915_page_table *' data-ref="180pt" data-ref-filename="180pt">pt</dfn>;</td></tr>
<tr><th id="795">795</th><td></td></tr>
<tr><th id="796">796</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pdp-&gt;page_directory[pdpe]))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 796, &quot;!pdp-&gt;page_directory[pdpe]&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col7 ref" href="#167pdp" title='pdp' data-ref="167pdp" data-ref-filename="167pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col3 ref" href="#173pdpe" title='pdpe' data-ref="173pdpe" data-ref-filename="173pdpe">pdpe</a>]))</td></tr>
<tr><th id="797">797</th><td>			<b>break</b>;</td></tr>
<tr><th id="798">798</th><td></td></tr>
<tr><th id="799">799</th><td>		<a class="local col9 ref" href="#179pd" title='pd' data-ref="179pd" data-ref-filename="179pd">pd</a> = <a class="local col7 ref" href="#167pdp" title='pdp' data-ref="167pdp" data-ref-filename="167pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col3 ref" href="#173pdpe" title='pdpe' data-ref="173pdpe" data-ref-filename="173pdpe">pdpe</a>];</td></tr>
<tr><th id="800">800</th><td></td></tr>
<tr><th id="801">801</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pd-&gt;page_table[pde]))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 801, &quot;!pd-&gt;page_table[pde]&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col9 ref" href="#179pd" title='pd' data-ref="179pd" data-ref-filename="179pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col4 ref" href="#174pde" title='pde' data-ref="174pde" data-ref-filename="174pde">pde</a>]))</td></tr>
<tr><th id="802">802</th><td>			<b>break</b>;</td></tr>
<tr><th id="803">803</th><td></td></tr>
<tr><th id="804">804</th><td>		<a class="local col0 ref" href="#180pt" title='pt' data-ref="180pt" data-ref-filename="180pt">pt</a> = <a class="local col9 ref" href="#179pd" title='pd' data-ref="179pd" data-ref-filename="179pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col4 ref" href="#174pde" title='pde' data-ref="174pde" data-ref-filename="174pde">pde</a>];</td></tr>
<tr><th id="805">805</th><td></td></tr>
<tr><th id="806">806</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!((&amp;(pt)-&gt;base)-&gt;page)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 806, &quot;!px_page(pt)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="macro" href="i915_gem_gtt.h.html#259" title="((&amp;(pt)-&gt;base)-&gt;page)" data-ref="_M/px_page">px_page</a>(<a class="local col0 ref" href="#180pt" title='pt' data-ref="180pt" data-ref-filename="180pt">pt</a>)))</td></tr>
<tr><th id="807">807</th><td>			<b>break</b>;</td></tr>
<tr><th id="808">808</th><td></td></tr>
<tr><th id="809">809</th><td>		<a class="local col7 ref" href="#177last_pte" title='last_pte' data-ref="177last_pte" data-ref-filename="177last_pte">last_pte</a> = <a class="local col5 ref" href="#175pte" title='pte' data-ref="175pte" data-ref-filename="175pte">pte</a> + <a class="local col6 ref" href="#176num_entries" title='num_entries' data-ref="176num_entries" data-ref-filename="176num_entries">num_entries</a>;</td></tr>
<tr><th id="810">810</th><td>		<b>if</b> (<a class="local col7 ref" href="#177last_pte" title='last_pte' data-ref="177last_pte" data-ref-filename="177last_pte">last_pte</a> &gt; <a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a>)</td></tr>
<tr><th id="811">811</th><td>			<a class="local col7 ref" href="#177last_pte" title='last_pte' data-ref="177last_pte" data-ref-filename="177last_pte">last_pte</a> = <a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a>;</td></tr>
<tr><th id="812">812</th><td></td></tr>
<tr><th id="813">813</th><td>		<a class="local col2 ref" href="#172pt_vaddr" title='pt_vaddr' data-ref="172pt_vaddr" data-ref-filename="172pt_vaddr">pt_vaddr</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pt)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col0 ref" href="#180pt" title='pt' data-ref="180pt" data-ref-filename="180pt">pt</a>);</td></tr>
<tr><th id="814">814</th><td></td></tr>
<tr><th id="815">815</th><td>		<b>for</b> (<a class="local col8 ref" href="#178i" title='i' data-ref="178i" data-ref-filename="178i">i</a> = <a class="local col5 ref" href="#175pte" title='pte' data-ref="175pte" data-ref-filename="175pte">pte</a>; <a class="local col8 ref" href="#178i" title='i' data-ref="178i" data-ref-filename="178i">i</a> &lt; <a class="local col7 ref" href="#177last_pte" title='last_pte' data-ref="177last_pte" data-ref-filename="177last_pte">last_pte</a>; <a class="local col8 ref" href="#178i" title='i' data-ref="178i" data-ref-filename="178i">i</a>++) {</td></tr>
<tr><th id="816">816</th><td>			<a class="local col2 ref" href="#172pt_vaddr" title='pt_vaddr' data-ref="172pt_vaddr" data-ref-filename="172pt_vaddr">pt_vaddr</a>[<a class="local col8 ref" href="#178i" title='i' data-ref="178i" data-ref-filename="178i">i</a>] = <a class="local col0 ref" href="#170scratch_pte" title='scratch_pte' data-ref="170scratch_pte" data-ref-filename="170scratch_pte">scratch_pte</a>;</td></tr>
<tr><th id="817">817</th><td>			<a class="local col6 ref" href="#176num_entries" title='num_entries' data-ref="176num_entries" data-ref-filename="176num_entries">num_entries</a>--;</td></tr>
<tr><th id="818">818</th><td>		}</td></tr>
<tr><th id="819">819</th><td></td></tr>
<tr><th id="820">820</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col1 ref" href="#171ppgtt" title='ppgtt' data-ref="171ppgtt" data-ref-filename="171ppgtt">ppgtt</a>, <a class="local col2 ref" href="#172pt_vaddr" title='pt_vaddr' data-ref="172pt_vaddr" data-ref-filename="172pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="821">821</th><td></td></tr>
<tr><th id="822">822</th><td>		<a class="local col5 ref" href="#175pte" title='pte' data-ref="175pte" data-ref-filename="175pte">pte</a> = <var>0</var>;</td></tr>
<tr><th id="823">823</th><td>		<b>if</b> (++<a class="local col4 ref" href="#174pde" title='pde' data-ref="174pde" data-ref-filename="174pde">pde</a> == <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>) {</td></tr>
<tr><th id="824">824</th><td>			<b>if</b> (++<a class="local col3 ref" href="#173pdpe" title='pdpe' data-ref="173pdpe" data-ref-filename="173pdpe">pdpe</a> == <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(vm-&gt;dev))</td></tr>
<tr><th id="825">825</th><td>				<b>break</b>;</td></tr>
<tr><th id="826">826</th><td>			<a class="local col4 ref" href="#174pde" title='pde' data-ref="174pde" data-ref-filename="174pde">pde</a> = <var>0</var>;</td></tr>
<tr><th id="827">827</th><td>		}</td></tr>
<tr><th id="828">828</th><td>	}</td></tr>
<tr><th id="829">829</th><td>}</td></tr>
<tr><th id="830">830</th><td></td></tr>
<tr><th id="831">831</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_clear_range" title='gen8_ppgtt_clear_range' data-type='void gen8_ppgtt_clear_range(struct i915_address_space * vm, uint64_t start, uint64_t length, _Bool use_scratch)' data-ref="gen8_ppgtt_clear_range" data-ref-filename="gen8_ppgtt_clear_range">gen8_ppgtt_clear_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="181vm" title='vm' data-type='struct i915_address_space *' data-ref="181vm" data-ref-filename="181vm">vm</dfn>,</td></tr>
<tr><th id="832">832</th><td>				   <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="182start" title='start' data-type='uint64_t' data-ref="182start" data-ref-filename="182start">start</dfn>,</td></tr>
<tr><th id="833">833</th><td>				   <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="183length" title='length' data-type='uint64_t' data-ref="183length" data-ref-filename="183length">length</dfn>,</td></tr>
<tr><th id="834">834</th><td>				   <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col4 decl" id="184use_scratch" title='use_scratch' data-type='_Bool' data-ref="184use_scratch" data-ref-filename="184use_scratch">use_scratch</dfn>)</td></tr>
<tr><th id="835">835</th><td>{</td></tr>
<tr><th id="836">836</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col5 decl" id="185ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="185ppgtt" data-ref-filename="185ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="837">837</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#181vm" title='vm' data-ref="181vm" data-ref-filename="181vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="838">838</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col6 decl" id="186scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="186scratch_pte" data-ref-filename="186scratch_pte">scratch_pte</dfn> = <a class="tu ref fn" href="#gen8_pte_encode" title='gen8_pte_encode' data-use='c' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#181vm" title='vm' data-ref="181vm" data-ref-filename="181vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="839">839</th><td>						 <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="local col4 ref" href="#184use_scratch" title='use_scratch' data-ref="184use_scratch" data-ref-filename="184use_scratch">use_scratch</a>);</td></tr>
<tr><th id="840">840</th><td></td></tr>
<tr><th id="841">841</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(vm-&gt;dev)) {</td></tr>
<tr><th id="842">842</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_clear_pte_range" title='gen8_ppgtt_clear_pte_range' data-use='c' data-ref="gen8_ppgtt_clear_pte_range" data-ref-filename="gen8_ppgtt_clear_pte_range">gen8_ppgtt_clear_pte_range</a>(<a class="local col1 ref" href="#181vm" title='vm' data-ref="181vm" data-ref-filename="181vm">vm</a>, &amp;<a class="local col5 ref" href="#185ppgtt" title='ppgtt' data-ref="185ppgtt" data-ref-filename="185ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>, <a class="local col2 ref" href="#182start" title='start' data-ref="182start" data-ref-filename="182start">start</a>, <a class="local col3 ref" href="#183length" title='length' data-ref="183length" data-ref-filename="183length">length</a>,</td></tr>
<tr><th id="843">843</th><td>					   <a class="local col6 ref" href="#186scratch_pte" title='scratch_pte' data-ref="186scratch_pte" data-ref-filename="186scratch_pte">scratch_pte</a>);</td></tr>
<tr><th id="844">844</th><td>	} <b>else</b> {</td></tr>
<tr><th id="845">845</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="187templ4" title='templ4' data-type='uint64_t' data-ref="187templ4" data-ref-filename="187templ4">templ4</dfn>, <dfn class="local col8 decl" id="188pml4e" title='pml4e' data-type='uint64_t' data-ref="188pml4e" data-ref-filename="188pml4e">pml4e</dfn>;</td></tr>
<tr><th id="846">846</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col9 decl" id="189pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="189pdp" data-ref-filename="189pdp">pdp</dfn>;</td></tr>
<tr><th id="847">847</th><td></td></tr>
<tr><th id="848">848</th><td>		<a class="macro" href="i915_gem_gtt.h.html#564" title="for (pml4e = gen8_pml4e_index(start); length &gt; 0 &amp;&amp; pml4e &lt; 512 ? (pdp = (&amp;ppgtt-&gt;pml4)-&gt;pdps[pml4e]), 1 : 0; pml4e++, templ4 = ALIGN - start, templ4 = (( (templ4)&lt;(length))?(templ4):(length)), start += templ4, length -= templ4)" data-ref="_M/gen8_for_each_pml4e">gen8_for_each_pml4e</a>(<a class="local col9 ref" href="#189pdp" title='pdp' data-ref="189pdp" data-ref-filename="189pdp">pdp</a>, &amp;<a class="local col5 ref" href="#185ppgtt" title='ppgtt' data-ref="185ppgtt" data-ref-filename="185ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>, <a class="local col2 ref" href="#182start" title='start' data-ref="182start" data-ref-filename="182start">start</a>, <a class="local col3 ref" href="#183length" title='length' data-ref="183length" data-ref-filename="183length">length</a>, templ4, <a class="local col8 ref" href="#188pml4e" title='pml4e' data-ref="188pml4e" data-ref-filename="188pml4e">pml4e</a>) {</td></tr>
<tr><th id="849">849</th><td>			<a class="tu ref fn" href="#gen8_ppgtt_clear_pte_range" title='gen8_ppgtt_clear_pte_range' data-use='c' data-ref="gen8_ppgtt_clear_pte_range" data-ref-filename="gen8_ppgtt_clear_pte_range">gen8_ppgtt_clear_pte_range</a>(<a class="local col1 ref" href="#181vm" title='vm' data-ref="181vm" data-ref-filename="181vm">vm</a>, <a class="local col9 ref" href="#189pdp" title='pdp' data-ref="189pdp" data-ref-filename="189pdp">pdp</a>, <a class="local col2 ref" href="#182start" title='start' data-ref="182start" data-ref-filename="182start">start</a>, <a class="local col3 ref" href="#183length" title='length' data-ref="183length" data-ref-filename="183length">length</a>,</td></tr>
<tr><th id="850">850</th><td>						   <a class="local col6 ref" href="#186scratch_pte" title='scratch_pte' data-ref="186scratch_pte" data-ref-filename="186scratch_pte">scratch_pte</a>);</td></tr>
<tr><th id="851">851</th><td>		}</td></tr>
<tr><th id="852">852</th><td>	}</td></tr>
<tr><th id="853">853</th><td>}</td></tr>
<tr><th id="854">854</th><td></td></tr>
<tr><th id="855">855</th><td><u>#<span data-ppcond="855">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="856">856</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="857">857</th><td>gen8_ppgtt_insert_pte_entries(<b>struct</b> i915_address_space *vm,</td></tr>
<tr><th id="858">858</th><td>    <b>struct</b> i915_page_directory_pointer *pdp, bus_dmamap_t dmamap,</td></tr>
<tr><th id="859">859</th><td>    <em>unsigned</em> *segp, uint64_t start, <b>enum</b> i915_cache_level cache_level)</td></tr>
<tr><th id="860">860</th><td>{</td></tr>
<tr><th id="861">861</th><td>	<b>struct</b> i915_hw_ppgtt *ppgtt =</td></tr>
<tr><th id="862">862</th><td>	    container_of(vm, <b>struct</b> i915_hw_ppgtt, base);</td></tr>
<tr><th id="863">863</th><td>	gen8_pte_t *pt_vaddr;</td></tr>
<tr><th id="864">864</th><td>	<em>unsigned</em> pdpe = gen8_pdpe_index(start);</td></tr>
<tr><th id="865">865</th><td>	<em>unsigned</em> pde = gen8_pde_index(start);</td></tr>
<tr><th id="866">866</th><td>	<em>unsigned</em> pte = gen8_pte_index(start);</td></tr>
<tr><th id="867">867</th><td></td></tr>
<tr><th id="868">868</th><td>	pt_vaddr = NULL;</td></tr>
<tr><th id="869">869</th><td>	<b>for</b> (; *segp &lt; dmamap-&gt;dm_nsegs; (*segp)++) {</td></tr>
<tr><th id="870">870</th><td>		KASSERT(dmamap-&gt;dm_segs[*segp].ds_len == PAGE_SIZE);</td></tr>
<tr><th id="871">871</th><td>		<b>if</b> (pt_vaddr == NULL) {</td></tr>
<tr><th id="872">872</th><td>			<b>struct</b> i915_page_directory *pd =</td></tr>
<tr><th id="873">873</th><td>			    pdp-&gt;page_directory[pdpe];</td></tr>
<tr><th id="874">874</th><td>			<b>struct</b> i915_page_table *pt = pd-&gt;page_table[pde];</td></tr>
<tr><th id="875">875</th><td>			pt_vaddr = kmap_px(pt);</td></tr>
<tr><th id="876">876</th><td>		}</td></tr>
<tr><th id="877">877</th><td>		pt_vaddr[pte] = gen8_pte_encode(dmamap-&gt;dm_segs[*segp].ds_addr,</td></tr>
<tr><th id="878">878</th><td>		    cache_level, true);</td></tr>
<tr><th id="879">879</th><td>		<b>if</b> (++pte == GEN8_PTES) {</td></tr>
<tr><th id="880">880</th><td>			kunmap_px(ppgtt, pt_vaddr);</td></tr>
<tr><th id="881">881</th><td>			pt_vaddr = NULL;</td></tr>
<tr><th id="882">882</th><td>			<b>if</b> (++pde == I915_PDES) {</td></tr>
<tr><th id="883">883</th><td>				<b>if</b> (++pdpe == I915_PDPES_PER_PDP(vm-&gt;dev))</td></tr>
<tr><th id="884">884</th><td>					<b>break</b>;</td></tr>
<tr><th id="885">885</th><td>				pde = <var>0</var>;</td></tr>
<tr><th id="886">886</th><td>			}</td></tr>
<tr><th id="887">887</th><td>			pte = <var>0</var>;</td></tr>
<tr><th id="888">888</th><td>		}</td></tr>
<tr><th id="889">889</th><td>	}</td></tr>
<tr><th id="890">890</th><td>	<b>if</b> (pt_vaddr)</td></tr>
<tr><th id="891">891</th><td>		kunmap_px(ppgtt, pt_vaddr);</td></tr>
<tr><th id="892">892</th><td>}</td></tr>
<tr><th id="893">893</th><td><u>#<span data-ppcond="855">else</span></u></td></tr>
<tr><th id="894">894</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="895">895</th><td><dfn class="tu decl def fn" id="gen8_ppgtt_insert_pte_entries" title='gen8_ppgtt_insert_pte_entries' data-type='void gen8_ppgtt_insert_pte_entries(struct i915_address_space * vm, struct i915_page_directory_pointer * pdp, struct sg_page_iter * sg_iter, uint64_t start, enum i915_cache_level cache_level)' data-ref="gen8_ppgtt_insert_pte_entries" data-ref-filename="gen8_ppgtt_insert_pte_entries">gen8_ppgtt_insert_pte_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="190vm" title='vm' data-type='struct i915_address_space *' data-ref="190vm" data-ref-filename="190vm">vm</dfn>,</td></tr>
<tr><th id="896">896</th><td>			      <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col1 decl" id="191pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="191pdp" data-ref-filename="191pdp">pdp</dfn>,</td></tr>
<tr><th id="897">897</th><td>			      <b>struct</b> <a class="local col3 type" href="#193sg_page_iter" title='sg_page_iter' data-ref="193sg_page_iter" data-ref-filename="193sg_page_iter">sg_page_iter</a> *<dfn class="local col2 decl" id="192sg_iter" title='sg_iter' data-type='struct sg_page_iter *' data-ref="192sg_iter" data-ref-filename="192sg_iter">sg_iter</dfn>,</td></tr>
<tr><th id="898">898</th><td>			      <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="194start" title='start' data-type='uint64_t' data-ref="194start" data-ref-filename="194start">start</dfn>,</td></tr>
<tr><th id="899">899</th><td>			      <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col5 decl" id="195cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="195cache_level" data-ref-filename="195cache_level">cache_level</dfn>)</td></tr>
<tr><th id="900">900</th><td>{</td></tr>
<tr><th id="901">901</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="196ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="196ppgtt" data-ref-filename="196ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="902">902</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col0 ref" href="#190vm" title='vm' data-ref="190vm" data-ref-filename="190vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="903">903</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> *<dfn class="local col7 decl" id="197pt_vaddr" title='pt_vaddr' data-type='gen8_pte_t *' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</dfn>;</td></tr>
<tr><th id="904">904</th><td>	<em>unsigned</em> <dfn class="local col8 decl" id="198pdpe" title='pdpe' data-type='unsigned int' data-ref="198pdpe" data-ref-filename="198pdpe">pdpe</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pdpe_index" title='gen8_pdpe_index' data-ref="gen8_pdpe_index" data-ref-filename="gen8_pdpe_index">gen8_pdpe_index</a>(<a class="local col4 ref" href="#194start" title='start' data-ref="194start" data-ref-filename="194start">start</a>);</td></tr>
<tr><th id="905">905</th><td>	<em>unsigned</em> <dfn class="local col9 decl" id="199pde" title='pde' data-type='unsigned int' data-ref="199pde" data-ref-filename="199pde">pde</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pde_index" title='gen8_pde_index' data-ref="gen8_pde_index" data-ref-filename="gen8_pde_index">gen8_pde_index</a>(<a class="local col4 ref" href="#194start" title='start' data-ref="194start" data-ref-filename="194start">start</a>);</td></tr>
<tr><th id="906">906</th><td>	<em>unsigned</em> <dfn class="local col0 decl" id="200pte" title='pte' data-type='unsigned int' data-ref="200pte" data-ref-filename="200pte">pte</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_index" title='gen8_pte_index' data-ref="gen8_pte_index" data-ref-filename="gen8_pte_index">gen8_pte_index</a>(<a class="local col4 ref" href="#194start" title='start' data-ref="194start" data-ref-filename="194start">start</a>);</td></tr>
<tr><th id="907">907</th><td></td></tr>
<tr><th id="908">908</th><td>	<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="909">909</th><td></td></tr>
<tr><th id="910">910</th><td>	<b>while</b> (<a class="ref fn" href="#910" title='__sg_page_iter_next' data-ref="__sg_page_iter_next" data-ref-filename="__sg_page_iter_next">__sg_page_iter_next</a>(<a class="local col2 ref" href="#192sg_iter" title='sg_iter' data-ref="192sg_iter" data-ref-filename="192sg_iter">sg_iter</a>)) {</td></tr>
<tr><th id="911">911</th><td>		<b>if</b> (<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a> == <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="912">912</th><td>			<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col1 decl" id="201pd" title='pd' data-type='struct i915_page_directory *' data-ref="201pd" data-ref-filename="201pd">pd</dfn> = <a class="local col1 ref" href="#191pdp" title='pdp' data-ref="191pdp" data-ref-filename="191pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col8 ref" href="#198pdpe" title='pdpe' data-ref="198pdpe" data-ref-filename="198pdpe">pdpe</a>];</td></tr>
<tr><th id="913">913</th><td>			<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col2 decl" id="202pt" title='pt' data-type='struct i915_page_table *' data-ref="202pt" data-ref-filename="202pt">pt</dfn> = <a class="local col1 ref" href="#201pd" title='pd' data-ref="201pd" data-ref-filename="201pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col9 ref" href="#199pde" title='pde' data-ref="199pde" data-ref-filename="199pde">pde</a>];</td></tr>
<tr><th id="914">914</th><td>			<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pt)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col2 ref" href="#202pt" title='pt' data-ref="202pt" data-ref-filename="202pt">pt</a>);</td></tr>
<tr><th id="915">915</th><td>		}</td></tr>
<tr><th id="916">916</th><td></td></tr>
<tr><th id="917">917</th><td>		<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a>[<a class="local col0 ref" href="#200pte" title='pte' data-ref="200pte" data-ref-filename="200pte">pte</a>] =</td></tr>
<tr><th id="918">918</th><td>			<a class="tu ref fn" href="#gen8_pte_encode" title='gen8_pte_encode' data-use='c' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</a>(<a class="ref fn" href="#918" title='sg_page_iter_dma_address' data-ref="sg_page_iter_dma_address" data-ref-filename="sg_page_iter_dma_address">sg_page_iter_dma_address</a>(<a class="local col2 ref" href="#192sg_iter" title='sg_iter' data-ref="192sg_iter" data-ref-filename="192sg_iter">sg_iter</a>),</td></tr>
<tr><th id="919">919</th><td>					<a class="local col5 ref" href="#195cache_level" title='cache_level' data-ref="195cache_level" data-ref-filename="195cache_level">cache_level</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="920">920</th><td>		<b>if</b> (++<a class="local col0 ref" href="#200pte" title='pte' data-ref="200pte" data-ref-filename="200pte">pte</a> == <a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a>) {</td></tr>
<tr><th id="921">921</th><td>			<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col6 ref" href="#196ppgtt" title='ppgtt' data-ref="196ppgtt" data-ref-filename="196ppgtt">ppgtt</a>, <a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="922">922</th><td>			<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="923">923</th><td>			<b>if</b> (++<a class="local col9 ref" href="#199pde" title='pde' data-ref="199pde" data-ref-filename="199pde">pde</a> == <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>) {</td></tr>
<tr><th id="924">924</th><td>				<b>if</b> (++<a class="local col8 ref" href="#198pdpe" title='pdpe' data-ref="198pdpe" data-ref-filename="198pdpe">pdpe</a> == <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(vm-&gt;dev))</td></tr>
<tr><th id="925">925</th><td>					<b>break</b>;</td></tr>
<tr><th id="926">926</th><td>				<a class="local col9 ref" href="#199pde" title='pde' data-ref="199pde" data-ref-filename="199pde">pde</a> = <var>0</var>;</td></tr>
<tr><th id="927">927</th><td>			}</td></tr>
<tr><th id="928">928</th><td>			<a class="local col0 ref" href="#200pte" title='pte' data-ref="200pte" data-ref-filename="200pte">pte</a> = <var>0</var>;</td></tr>
<tr><th id="929">929</th><td>		}</td></tr>
<tr><th id="930">930</th><td>	}</td></tr>
<tr><th id="931">931</th><td></td></tr>
<tr><th id="932">932</th><td>	<b>if</b> (<a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a>)</td></tr>
<tr><th id="933">933</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col6 ref" href="#196ppgtt" title='ppgtt' data-ref="196ppgtt" data-ref-filename="196ppgtt">ppgtt</a>, <a class="local col7 ref" href="#197pt_vaddr" title='pt_vaddr' data-ref="197pt_vaddr" data-ref-filename="197pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="934">934</th><td>}</td></tr>
<tr><th id="935">935</th><td><u>#<span data-ppcond="855">endif</span></u></td></tr>
<tr><th id="936">936</th><td></td></tr>
<tr><th id="937">937</th><td><u>#<span data-ppcond="937">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="938">938</th><td><em>static</em> <em>void</em> gen8_ppgtt_insert_entries(<b>struct</b> i915_address_space *vm,</td></tr>
<tr><th id="939">939</th><td>    bus_dmamap_t dmamap, uint64_t start, <b>enum</b> i915_cache_level cache_level,</td></tr>
<tr><th id="940">940</th><td>    u32 unused)</td></tr>
<tr><th id="941">941</th><td>{</td></tr>
<tr><th id="942">942</th><td>	<b>struct</b> i915_hw_ppgtt *ppgtt =</td></tr>
<tr><th id="943">943</th><td>	    container_of(vm, <b>struct</b> i915_hw_ppgtt, base);</td></tr>
<tr><th id="944">944</th><td>	<em>unsigned</em> seg = <var>0</var>;</td></tr>
<tr><th id="945">945</th><td></td></tr>
<tr><th id="946">946</th><td>	<b>if</b> (!USES_FULL_48BIT_PPGTT(vm-&gt;dev)) {</td></tr>
<tr><th id="947">947</th><td>		gen8_ppgtt_insert_pte_entries(vm, &amp;ppgtt-&gt;pdp, dmamap, &amp;seg,</td></tr>
<tr><th id="948">948</th><td>		    start, cache_level);</td></tr>
<tr><th id="949">949</th><td>	} <b>else</b> {</td></tr>
<tr><th id="950">950</th><td>		<b>struct</b> i915_page_directory_pointer *pdp;</td></tr>
<tr><th id="951">951</th><td>		uint64_t templ4, pml4e;</td></tr>
<tr><th id="952">952</th><td>		uint64_t length = dmamap-&gt;dm_mapsize;</td></tr>
<tr><th id="953">953</th><td></td></tr>
<tr><th id="954">954</th><td>		gen8_for_each_pml4e(pdp, &amp;ppgtt-&gt;pml4, start, length, templ4,</td></tr>
<tr><th id="955">955</th><td>		    pml4e) {</td></tr>
<tr><th id="956">956</th><td>			gen8_ppgtt_insert_pte_entries(vm, pdp, dmamap, &amp;seg,</td></tr>
<tr><th id="957">957</th><td>			    start, cache_level);</td></tr>
<tr><th id="958">958</th><td>		}</td></tr>
<tr><th id="959">959</th><td>	}</td></tr>
<tr><th id="960">960</th><td>}</td></tr>
<tr><th id="961">961</th><td><u>#<span data-ppcond="937">else</span></u></td></tr>
<tr><th id="962">962</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_insert_entries" title='gen8_ppgtt_insert_entries' data-type='void gen8_ppgtt_insert_entries(struct i915_address_space * vm, struct sg_table * pages, uint64_t start, enum i915_cache_level cache_level, u32 unused)' data-ref="gen8_ppgtt_insert_entries" data-ref-filename="gen8_ppgtt_insert_entries">gen8_ppgtt_insert_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col3 decl" id="203vm" title='vm' data-type='struct i915_address_space *' data-ref="203vm" data-ref-filename="203vm">vm</dfn>,</td></tr>
<tr><th id="963">963</th><td>				      <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col4 decl" id="204pages" title='pages' data-type='struct sg_table *' data-ref="204pages" data-ref-filename="204pages">pages</dfn>,</td></tr>
<tr><th id="964">964</th><td>				      <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="205start" title='start' data-type='uint64_t' data-ref="205start" data-ref-filename="205start">start</dfn>,</td></tr>
<tr><th id="965">965</th><td>				      <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col6 decl" id="206cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="206cache_level" data-ref-filename="206cache_level">cache_level</dfn>,</td></tr>
<tr><th id="966">966</th><td>				      <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col7 decl" id="207unused" title='unused' data-type='u32' data-ref="207unused" data-ref-filename="207unused">unused</dfn>)</td></tr>
<tr><th id="967">967</th><td>{</td></tr>
<tr><th id="968">968</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col8 decl" id="208ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="208ppgtt" data-ref-filename="208ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="969">969</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col3 ref" href="#203vm" title='vm' data-ref="203vm" data-ref-filename="203vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="970">970</th><td>	<b>struct</b> <dfn class="local col9 type" id="209sg_page_iter" title='sg_page_iter' data-ref="209sg_page_iter" data-ref-filename="209sg_page_iter"><a class="local col9 type" href="#209sg_page_iter" title='sg_page_iter' data-ref="209sg_page_iter" data-ref-filename="209sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col0 decl" id="210sg_iter" title='sg_iter' data-type='struct sg_page_iter' data-ref="210sg_iter" data-ref-filename="210sg_iter">sg_iter</dfn></span>;</td></tr>
<tr><th id="971">971</th><td></td></tr>
<tr><th id="972">972</th><td>	__sg_page_iter_start(&amp;sg_iter, pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, sg_nents(pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl), <var>0</var>);</td></tr>
<tr><th id="973">973</th><td></td></tr>
<tr><th id="974">974</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(vm-&gt;dev)) {</td></tr>
<tr><th id="975">975</th><td>		gen8_ppgtt_insert_pte_entries(vm, &amp;ppgtt-&gt;pdp, &amp;sg_iter, start,</td></tr>
<tr><th id="976">976</th><td>					      cache_level);</td></tr>
<tr><th id="977">977</th><td>	} <b>else</b> {</td></tr>
<tr><th id="978">978</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col1 decl" id="211pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="211pdp" data-ref-filename="211pdp">pdp</dfn>;</td></tr>
<tr><th id="979">979</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="212templ4" title='templ4' data-type='uint64_t' data-ref="212templ4" data-ref-filename="212templ4">templ4</dfn>, <dfn class="local col3 decl" id="213pml4e" title='pml4e' data-type='uint64_t' data-ref="213pml4e" data-ref-filename="213pml4e">pml4e</dfn>;</td></tr>
<tr><th id="980">980</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="214length" title='length' data-type='uint64_t' data-ref="214length" data-ref-filename="214length">length</dfn> = (uint64_t)pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>orig_nents &lt;&lt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="981">981</th><td></td></tr>
<tr><th id="982">982</th><td>		<a class="macro" href="i915_gem_gtt.h.html#564" title="for (pml4e = gen8_pml4e_index(start); length &gt; 0 &amp;&amp; pml4e &lt; 512 ? (pdp = (&amp;ppgtt-&gt;pml4)-&gt;pdps[pml4e]), 1 : 0; pml4e++, templ4 = ALIGN - start, templ4 = (( (templ4)&lt;(length))?(templ4):(length)), start += templ4, length -= templ4)" data-ref="_M/gen8_for_each_pml4e">gen8_for_each_pml4e</a>(<a class="local col1 ref" href="#211pdp" title='pdp' data-ref="211pdp" data-ref-filename="211pdp">pdp</a>, &amp;<a class="local col8 ref" href="#208ppgtt" title='ppgtt' data-ref="208ppgtt" data-ref-filename="208ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>, <a class="local col5 ref" href="#205start" title='start' data-ref="205start" data-ref-filename="205start">start</a>, <a class="local col4 ref" href="#214length" title='length' data-ref="214length" data-ref-filename="214length">length</a>, templ4, <a class="local col3 ref" href="#213pml4e" title='pml4e' data-ref="213pml4e" data-ref-filename="213pml4e">pml4e</a>) {</td></tr>
<tr><th id="983">983</th><td>			gen8_ppgtt_insert_pte_entries(vm, pdp, &amp;sg_iter,</td></tr>
<tr><th id="984">984</th><td>						      start, cache_level);</td></tr>
<tr><th id="985">985</th><td>		}</td></tr>
<tr><th id="986">986</th><td>	}</td></tr>
<tr><th id="987">987</th><td>}</td></tr>
<tr><th id="988">988</th><td><u>#<span data-ppcond="937">endif</span></u></td></tr>
<tr><th id="989">989</th><td></td></tr>
<tr><th id="990">990</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_free_page_tables" title='gen8_free_page_tables' data-type='void gen8_free_page_tables(struct drm_device * dev, struct i915_page_directory * pd)' data-ref="gen8_free_page_tables" data-ref-filename="gen8_free_page_tables">gen8_free_page_tables</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col5 decl" id="215dev" title='dev' data-type='struct drm_device *' data-ref="215dev" data-ref-filename="215dev">dev</dfn>,</td></tr>
<tr><th id="991">991</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col6 decl" id="216pd" title='pd' data-type='struct i915_page_directory *' data-ref="216pd" data-ref-filename="216pd">pd</dfn>)</td></tr>
<tr><th id="992">992</th><td>{</td></tr>
<tr><th id="993">993</th><td>	<em>int</em> <dfn class="local col7 decl" id="217i" title='i' data-type='int' data-ref="217i" data-ref-filename="217i">i</dfn>;</td></tr>
<tr><th id="994">994</th><td></td></tr>
<tr><th id="995">995</th><td>	<b>if</b> (!<a class="macro" href="i915_gem_gtt.h.html#259" title="((&amp;(pd)-&gt;base)-&gt;page)" data-ref="_M/px_page">px_page</a>(<a class="local col6 ref" href="#216pd" title='pd' data-ref="216pd" data-ref-filename="216pd">pd</a>))</td></tr>
<tr><th id="996">996</th><td>		<b>return</b>;</td></tr>
<tr><th id="997">997</th><td></td></tr>
<tr><th id="998">998</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((i) = find_first_bit((pd-&gt;used_pdes), (512)); (i) &lt; (512); (i) = find_next_bit((pd-&gt;used_pdes), (512), (i) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col7 ref" href="#217i" title='i' data-ref="217i" data-ref-filename="217i">i</a>, <a class="local col6 ref" href="#216pd" title='pd' data-ref="216pd" data-ref-filename="216pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>) {</td></tr>
<tr><th id="999">999</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pd-&gt;page_table[i]))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 999, &quot;!pd-&gt;page_table[i]&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col6 ref" href="#216pd" title='pd' data-ref="216pd" data-ref-filename="216pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col7 ref" href="#217i" title='i' data-ref="217i" data-ref-filename="217i">i</a>]))</td></tr>
<tr><th id="1000">1000</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1001">1001</th><td></td></tr>
<tr><th id="1002">1002</th><td>		<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col5 ref" href="#215dev" title='dev' data-ref="215dev" data-ref-filename="215dev">dev</a>, <a class="local col6 ref" href="#216pd" title='pd' data-ref="216pd" data-ref-filename="216pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col7 ref" href="#217i" title='i' data-ref="217i" data-ref-filename="217i">i</a>]);</td></tr>
<tr><th id="1003">1003</th><td>		<a class="local col6 ref" href="#216pd" title='pd' data-ref="216pd" data-ref-filename="216pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col7 ref" href="#217i" title='i' data-ref="217i" data-ref-filename="217i">i</a>] = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="1004">1004</th><td>	}</td></tr>
<tr><th id="1005">1005</th><td>}</td></tr>
<tr><th id="1006">1006</th><td></td></tr>
<tr><th id="1007">1007</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_init_scratch" title='gen8_init_scratch' data-type='int gen8_init_scratch(struct i915_address_space * vm)' data-ref="gen8_init_scratch" data-ref-filename="gen8_init_scratch">gen8_init_scratch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="218vm" title='vm' data-type='struct i915_address_space *' data-ref="218vm" data-ref-filename="218vm">vm</dfn>)</td></tr>
<tr><th id="1008">1008</th><td>{</td></tr>
<tr><th id="1009">1009</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="219dev" title='dev' data-type='struct drm_device *' data-ref="219dev" data-ref-filename="219dev">dev</dfn> = <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1010">1010</th><td></td></tr>
<tr><th id="1011">1011</th><td>	<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a> = <a class="tu ref fn" href="#alloc_scratch_page" title='alloc_scratch_page' data-use='c' data-ref="alloc_scratch_page" data-ref-filename="alloc_scratch_page">alloc_scratch_page</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>);</td></tr>
<tr><th id="1012">1012</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>))</td></tr>
<tr><th id="1013">1013</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="1014">1014</th><td></td></tr>
<tr><th id="1015">1015</th><td>	<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a> = <a class="tu ref fn" href="#alloc_pt" title='alloc_pt' data-use='c' data-ref="alloc_pt" data-ref-filename="alloc_pt">alloc_pt</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>);</td></tr>
<tr><th id="1016">1016</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>)) {</td></tr>
<tr><th id="1017">1017</th><td>		<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="1018">1018</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1019">1019</th><td>	}</td></tr>
<tr><th id="1020">1020</th><td></td></tr>
<tr><th id="1021">1021</th><td>	<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a> = <a class="tu ref fn" href="#alloc_pd" title='alloc_pd' data-use='c' data-ref="alloc_pd" data-ref-filename="alloc_pd">alloc_pd</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>);</td></tr>
<tr><th id="1022">1022</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>)) {</td></tr>
<tr><th id="1023">1023</th><td>		<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1024">1024</th><td>		<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="1025">1025</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>);</td></tr>
<tr><th id="1026">1026</th><td>	}</td></tr>
<tr><th id="1027">1027</th><td></td></tr>
<tr><th id="1028">1028</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev)) {</td></tr>
<tr><th id="1029">1029</th><td>		<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a> = <a class="tu ref fn" href="#alloc_pdp" title='alloc_pdp' data-use='c' data-ref="alloc_pdp" data-ref-filename="alloc_pdp">alloc_pdp</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>);</td></tr>
<tr><th id="1030">1030</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a>)) {</td></tr>
<tr><th id="1031">1031</th><td>			<a class="tu ref fn" href="#free_pd" title='free_pd' data-use='c' data-ref="free_pd" data-ref-filename="free_pd">free_pd</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>);</td></tr>
<tr><th id="1032">1032</th><td>			<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1033">1033</th><td>			<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col9 ref" href="#219dev" title='dev' data-ref="219dev" data-ref-filename="219dev">dev</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="1034">1034</th><td>			<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a>);</td></tr>
<tr><th id="1035">1035</th><td>		}</td></tr>
<tr><th id="1036">1036</th><td>	}</td></tr>
<tr><th id="1037">1037</th><td></td></tr>
<tr><th id="1038">1038</th><td>	<a class="tu ref fn" href="#gen8_initialize_pt" title='gen8_initialize_pt' data-use='c' data-ref="gen8_initialize_pt" data-ref-filename="gen8_initialize_pt">gen8_initialize_pt</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1039">1039</th><td>	<a class="tu ref fn" href="#gen8_initialize_pd" title='gen8_initialize_pd' data-use='c' data-ref="gen8_initialize_pd" data-ref-filename="gen8_initialize_pd">gen8_initialize_pd</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>);</td></tr>
<tr><th id="1040">1040</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev))</td></tr>
<tr><th id="1041">1041</th><td>		<a class="tu ref fn" href="#gen8_initialize_pdp" title='gen8_initialize_pdp' data-use='c' data-ref="gen8_initialize_pdp" data-ref-filename="gen8_initialize_pdp">gen8_initialize_pdp</a>(<a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>, <a class="local col8 ref" href="#218vm" title='vm' data-ref="218vm" data-ref-filename="218vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a>);</td></tr>
<tr><th id="1042">1042</th><td></td></tr>
<tr><th id="1043">1043</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1044">1044</th><td>}</td></tr>
<tr><th id="1045">1045</th><td></td></tr>
<tr><th id="1046">1046</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_ppgtt_notify_vgt" title='gen8_ppgtt_notify_vgt' data-type='int gen8_ppgtt_notify_vgt(struct i915_hw_ppgtt * ppgtt, _Bool create)' data-ref="gen8_ppgtt_notify_vgt" data-ref-filename="gen8_ppgtt_notify_vgt">gen8_ppgtt_notify_vgt</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col0 decl" id="220ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="220ppgtt" data-ref-filename="220ppgtt">ppgtt</dfn>, <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col1 decl" id="221create" title='create' data-type='_Bool' data-ref="221create" data-ref-filename="221create">create</dfn>)</td></tr>
<tr><th id="1047">1047</th><td>{</td></tr>
<tr><th id="1048">1048</th><td>	<b>enum</b> <a class="type" href="i915_vgpu.h.html#vgt_g2v_type" title='vgt_g2v_type' data-ref="vgt_g2v_type" data-ref-filename="vgt_g2v_type">vgt_g2v_type</a> <dfn class="local col2 decl" id="222msg" title='msg' data-type='enum vgt_g2v_type' data-ref="222msg" data-ref-filename="222msg">msg</dfn>;</td></tr>
<tr><th id="1049">1049</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="223dev" title='dev' data-type='struct drm_device *' data-ref="223dev" data-ref-filename="223dev">dev</dfn> = <a class="local col0 ref" href="#220ppgtt" title='ppgtt' data-ref="220ppgtt" data-ref-filename="220ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1050">1050</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="224dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="224dev_priv" data-ref-filename="224dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#223dev" title='dev' data-ref="223dev" data-ref-filename="223dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="1051">1051</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col5 decl" id="225offset" title='offset' data-type='unsigned int' data-ref="225offset" data-ref-filename="225offset">offset</dfn> = <a class="macro" href="i915_vgpu.h.html#112" title="(0x78000 + __builtin_offsetof(struct vgt_if, pdp0_lo))" data-ref="_M/vgtif_reg">vgtif_reg</a>(pdp0_lo);</td></tr>
<tr><th id="1052">1052</th><td>	<em>int</em> <dfn class="local col6 decl" id="226i" title='i' data-type='int' data-ref="226i" data-ref-filename="226i">i</dfn>;</td></tr>
<tr><th id="1053">1053</th><td></td></tr>
<tr><th id="1054">1054</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev)) {</td></tr>
<tr><th id="1055">1055</th><td>		<a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col7 decl" id="227daddr" title='daddr' data-type='u64' data-ref="227daddr" data-ref-filename="227daddr">daddr</dfn> = <a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(&amp;ppgtt-&gt;pml4)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(&amp;<a class="local col0 ref" href="#220ppgtt" title='ppgtt' data-ref="220ppgtt" data-ref-filename="220ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>);</td></tr>
<tr><th id="1056">1056</th><td></td></tr>
<tr><th id="1057">1057</th><td>		<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (offset), (((uint32_t) ((daddr) &amp; 0xffffffffUL))), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="local col5 ref" href="#225offset" title='offset' data-ref="225offset" data-ref-filename="225offset">offset</a>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#118" title="((uint32_t) ((daddr) &amp; 0xffffffffUL))" data-ref="_M/lower_32_bits">lower_32_bits</a>(<a class="local col7 ref" href="#227daddr" title='daddr' data-ref="227daddr" data-ref-filename="227daddr">daddr</a>));</td></tr>
<tr><th id="1058">1058</th><td>		<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (offset + 4), (((uint32_t) (((daddr) &gt;&gt; 16) &gt;&gt; 16))), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="local col5 ref" href="#225offset" title='offset' data-ref="225offset" data-ref-filename="225offset">offset</a> + <var>4</var>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#117" title="((uint32_t) (((daddr) &gt;&gt; 16) &gt;&gt; 16))" data-ref="_M/upper_32_bits">upper_32_bits</a>(<a class="local col7 ref" href="#227daddr" title='daddr' data-ref="227daddr" data-ref-filename="227daddr">daddr</a>));</td></tr>
<tr><th id="1059">1059</th><td></td></tr>
<tr><th id="1060">1060</th><td>		<a class="local col2 ref" href="#222msg" title='msg' data-ref="222msg" data-ref-filename="222msg">msg</a> = (<a class="local col1 ref" href="#221create" title='create' data-ref="221create" data-ref-filename="221create">create</a> ? <a class="enum" href="i915_vgpu.h.html#VGT_G2V_PPGTT_L4_PAGE_TABLE_CREATE" title='VGT_G2V_PPGTT_L4_PAGE_TABLE_CREATE' data-ref="VGT_G2V_PPGTT_L4_PAGE_TABLE_CREATE" data-ref-filename="VGT_G2V_PPGTT_L4_PAGE_TABLE_CREATE">VGT_G2V_PPGTT_L4_PAGE_TABLE_CREATE</a> :</td></tr>
<tr><th id="1061">1061</th><td>				<a class="enum" href="i915_vgpu.h.html#VGT_G2V_PPGTT_L4_PAGE_TABLE_DESTROY" title='VGT_G2V_PPGTT_L4_PAGE_TABLE_DESTROY' data-ref="VGT_G2V_PPGTT_L4_PAGE_TABLE_DESTROY" data-ref-filename="VGT_G2V_PPGTT_L4_PAGE_TABLE_DESTROY">VGT_G2V_PPGTT_L4_PAGE_TABLE_DESTROY</a>);</td></tr>
<tr><th id="1062">1062</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1063">1063</th><td>		<b>for</b> (<a class="local col6 ref" href="#226i" title='i' data-ref="226i" data-ref-filename="226i">i</a> = <var>0</var>; <a class="local col6 ref" href="#226i" title='i' data-ref="226i" data-ref-filename="226i">i</a> &lt; <a class="macro" href="i915_gem_gtt.h.html#111" title="4" data-ref="_M/GEN8_LEGACY_PDPES">GEN8_LEGACY_PDPES</a>; <a class="local col6 ref" href="#226i" title='i' data-ref="226i" data-ref-filename="226i">i</a>++) {</td></tr>
<tr><th id="1064">1064</th><td>			<a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col8 decl" id="228daddr" title='daddr' data-type='u64' data-ref="228daddr" data-ref-filename="228daddr">daddr</dfn> = <a class="ref fn" href="i915_gem_gtt.h.html#i915_page_dir_dma_addr" title='i915_page_dir_dma_addr' data-ref="i915_page_dir_dma_addr" data-ref-filename="i915_page_dir_dma_addr">i915_page_dir_dma_addr</a>(<a class="local col0 ref" href="#220ppgtt" title='ppgtt' data-ref="220ppgtt" data-ref-filename="220ppgtt">ppgtt</a>, <a class="local col6 ref" href="#226i" title='i' data-ref="226i" data-ref-filename="226i">i</a>);</td></tr>
<tr><th id="1065">1065</th><td></td></tr>
<tr><th id="1066">1066</th><td>			<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (offset), (((uint32_t) ((daddr) &amp; 0xffffffffUL))), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="local col5 ref" href="#225offset" title='offset' data-ref="225offset" data-ref-filename="225offset">offset</a>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#118" title="((uint32_t) ((daddr) &amp; 0xffffffffUL))" data-ref="_M/lower_32_bits">lower_32_bits</a>(<a class="local col8 ref" href="#228daddr" title='daddr' data-ref="228daddr" data-ref-filename="228daddr">daddr</a>));</td></tr>
<tr><th id="1067">1067</th><td>			<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (offset + 4), (((uint32_t) (((daddr) &gt;&gt; 16) &gt;&gt; 16))), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="local col5 ref" href="#225offset" title='offset' data-ref="225offset" data-ref-filename="225offset">offset</a> + <var>4</var>, <a class="macro" href="../../../../common/include/linux/kernel.h.html#117" title="((uint32_t) (((daddr) &gt;&gt; 16) &gt;&gt; 16))" data-ref="_M/upper_32_bits">upper_32_bits</a>(<a class="local col8 ref" href="#228daddr" title='daddr' data-ref="228daddr" data-ref-filename="228daddr">daddr</a>));</td></tr>
<tr><th id="1068">1068</th><td></td></tr>
<tr><th id="1069">1069</th><td>			<a class="local col5 ref" href="#225offset" title='offset' data-ref="225offset" data-ref-filename="225offset">offset</a> += <var>8</var>;</td></tr>
<tr><th id="1070">1070</th><td>		}</td></tr>
<tr><th id="1071">1071</th><td></td></tr>
<tr><th id="1072">1072</th><td>		<a class="local col2 ref" href="#222msg" title='msg' data-ref="222msg" data-ref-filename="222msg">msg</a> = (<a class="local col1 ref" href="#221create" title='create' data-ref="221create" data-ref-filename="221create">create</a> ? <a class="enum" href="i915_vgpu.h.html#VGT_G2V_PPGTT_L3_PAGE_TABLE_CREATE" title='VGT_G2V_PPGTT_L3_PAGE_TABLE_CREATE' data-ref="VGT_G2V_PPGTT_L3_PAGE_TABLE_CREATE" data-ref-filename="VGT_G2V_PPGTT_L3_PAGE_TABLE_CREATE">VGT_G2V_PPGTT_L3_PAGE_TABLE_CREATE</a> :</td></tr>
<tr><th id="1073">1073</th><td>				<a class="enum" href="i915_vgpu.h.html#VGT_G2V_PPGTT_L3_PAGE_TABLE_DESTROY" title='VGT_G2V_PPGTT_L3_PAGE_TABLE_DESTROY' data-ref="VGT_G2V_PPGTT_L3_PAGE_TABLE_DESTROY" data-ref-filename="VGT_G2V_PPGTT_L3_PAGE_TABLE_DESTROY">VGT_G2V_PPGTT_L3_PAGE_TABLE_DESTROY</a>);</td></tr>
<tr><th id="1074">1074</th><td>	}</td></tr>
<tr><th id="1075">1075</th><td></td></tr>
<tr><th id="1076">1076</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, ((0x78000 + __builtin_offsetof(struct vgt_if, g2v_notify))), (msg), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_vgpu.h.html#112" title="(0x78000 + __builtin_offsetof(struct vgt_if, g2v_notify))" data-ref="_M/vgtif_reg">vgtif_reg</a>(g2v_notify), <a class="local col2 ref" href="#222msg" title='msg' data-ref="222msg" data-ref-filename="222msg">msg</a>);</td></tr>
<tr><th id="1077">1077</th><td></td></tr>
<tr><th id="1078">1078</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1079">1079</th><td>}</td></tr>
<tr><th id="1080">1080</th><td></td></tr>
<tr><th id="1081">1081</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_free_scratch" title='gen8_free_scratch' data-type='void gen8_free_scratch(struct i915_address_space * vm)' data-ref="gen8_free_scratch" data-ref-filename="gen8_free_scratch">gen8_free_scratch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col9 decl" id="229vm" title='vm' data-type='struct i915_address_space *' data-ref="229vm" data-ref-filename="229vm">vm</dfn>)</td></tr>
<tr><th id="1082">1082</th><td>{</td></tr>
<tr><th id="1083">1083</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col0 decl" id="230dev" title='dev' data-type='struct drm_device *' data-ref="230dev" data-ref-filename="230dev">dev</dfn> = <a class="local col9 ref" href="#229vm" title='vm' data-ref="229vm" data-ref-filename="229vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1084">1084</th><td></td></tr>
<tr><th id="1085">1085</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev))</td></tr>
<tr><th id="1086">1086</th><td>		<a class="tu ref fn" href="#free_pdp" title='free_pdp' data-use='c' data-ref="free_pdp" data-ref-filename="free_pdp">free_pdp</a>(<a class="local col0 ref" href="#230dev" title='dev' data-ref="230dev" data-ref-filename="230dev">dev</a>, <a class="local col9 ref" href="#229vm" title='vm' data-ref="229vm" data-ref-filename="229vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pdp" title='i915_address_space::scratch_pdp' data-ref="i915_address_space::scratch_pdp" data-ref-filename="i915_address_space..scratch_pdp">scratch_pdp</a>);</td></tr>
<tr><th id="1087">1087</th><td>	<a class="tu ref fn" href="#free_pd" title='free_pd' data-use='c' data-ref="free_pd" data-ref-filename="free_pd">free_pd</a>(<a class="local col0 ref" href="#230dev" title='dev' data-ref="230dev" data-ref-filename="230dev">dev</a>, <a class="local col9 ref" href="#229vm" title='vm' data-ref="229vm" data-ref-filename="229vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pd" title='i915_address_space::scratch_pd' data-ref="i915_address_space::scratch_pd" data-ref-filename="i915_address_space..scratch_pd">scratch_pd</a>);</td></tr>
<tr><th id="1088">1088</th><td>	<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col0 ref" href="#230dev" title='dev' data-ref="230dev" data-ref-filename="230dev">dev</a>, <a class="local col9 ref" href="#229vm" title='vm' data-ref="229vm" data-ref-filename="229vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1089">1089</th><td>	<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col0 ref" href="#230dev" title='dev' data-ref="230dev" data-ref-filename="230dev">dev</a>, <a class="local col9 ref" href="#229vm" title='vm' data-ref="229vm" data-ref-filename="229vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="1090">1090</th><td>}</td></tr>
<tr><th id="1091">1091</th><td></td></tr>
<tr><th id="1092">1092</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_cleanup_3lvl" title='gen8_ppgtt_cleanup_3lvl' data-type='void gen8_ppgtt_cleanup_3lvl(struct drm_device * dev, struct i915_page_directory_pointer * pdp)' data-ref="gen8_ppgtt_cleanup_3lvl" data-ref-filename="gen8_ppgtt_cleanup_3lvl">gen8_ppgtt_cleanup_3lvl</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col1 decl" id="231dev" title='dev' data-type='struct drm_device *' data-ref="231dev" data-ref-filename="231dev">dev</dfn>,</td></tr>
<tr><th id="1093">1093</th><td>				    <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col2 decl" id="232pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="232pdp" data-ref-filename="232pdp">pdp</dfn>)</td></tr>
<tr><th id="1094">1094</th><td>{</td></tr>
<tr><th id="1095">1095</th><td>	<em>int</em> <dfn class="local col3 decl" id="233i" title='i' data-type='int' data-ref="233i" data-ref-filename="233i">i</dfn>;</td></tr>
<tr><th id="1096">1096</th><td></td></tr>
<tr><th id="1097">1097</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((i) = find_first_bit((pdp-&gt;used_pdpes), (((i915.enable_ppgtt == 3) ? 512 : 4))); (i) &lt; (((i915.enable_ppgtt == 3) ? 512 : 4)); (i) = find_next_bit((pdp-&gt;used_pdpes), (((i915.enable_ppgtt == 3) ? 512 : 4)), (i) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col3 ref" href="#233i" title='i' data-ref="233i" data-ref-filename="233i">i</a>, <a class="local col2 ref" href="#232pdp" title='pdp' data-ref="232pdp" data-ref-filename="232pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>, <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(dev)) {</td></tr>
<tr><th id="1098">1098</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pdp-&gt;page_directory[i]))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1098, &quot;!pdp-&gt;page_directory[i]&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col2 ref" href="#232pdp" title='pdp' data-ref="232pdp" data-ref-filename="232pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col3 ref" href="#233i" title='i' data-ref="233i" data-ref-filename="233i">i</a>]))</td></tr>
<tr><th id="1099">1099</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1100">1100</th><td></td></tr>
<tr><th id="1101">1101</th><td>		<a class="tu ref fn" href="#gen8_free_page_tables" title='gen8_free_page_tables' data-use='c' data-ref="gen8_free_page_tables" data-ref-filename="gen8_free_page_tables">gen8_free_page_tables</a>(<a class="local col1 ref" href="#231dev" title='dev' data-ref="231dev" data-ref-filename="231dev">dev</a>, <a class="local col2 ref" href="#232pdp" title='pdp' data-ref="232pdp" data-ref-filename="232pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col3 ref" href="#233i" title='i' data-ref="233i" data-ref-filename="233i">i</a>]);</td></tr>
<tr><th id="1102">1102</th><td>		<a class="tu ref fn" href="#free_pd" title='free_pd' data-use='c' data-ref="free_pd" data-ref-filename="free_pd">free_pd</a>(<a class="local col1 ref" href="#231dev" title='dev' data-ref="231dev" data-ref-filename="231dev">dev</a>, <a class="local col2 ref" href="#232pdp" title='pdp' data-ref="232pdp" data-ref-filename="232pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col3 ref" href="#233i" title='i' data-ref="233i" data-ref-filename="233i">i</a>]);</td></tr>
<tr><th id="1103">1103</th><td>	}</td></tr>
<tr><th id="1104">1104</th><td></td></tr>
<tr><th id="1105">1105</th><td>	<a class="tu ref fn" href="#free_pdp" title='free_pdp' data-use='c' data-ref="free_pdp" data-ref-filename="free_pdp">free_pdp</a>(<a class="local col1 ref" href="#231dev" title='dev' data-ref="231dev" data-ref-filename="231dev">dev</a>, <a class="local col2 ref" href="#232pdp" title='pdp' data-ref="232pdp" data-ref-filename="232pdp">pdp</a>);</td></tr>
<tr><th id="1106">1106</th><td>}</td></tr>
<tr><th id="1107">1107</th><td></td></tr>
<tr><th id="1108">1108</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_cleanup_4lvl" title='gen8_ppgtt_cleanup_4lvl' data-type='void gen8_ppgtt_cleanup_4lvl(struct i915_hw_ppgtt * ppgtt)' data-ref="gen8_ppgtt_cleanup_4lvl" data-ref-filename="gen8_ppgtt_cleanup_4lvl">gen8_ppgtt_cleanup_4lvl</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="234ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="1109">1109</th><td>{</td></tr>
<tr><th id="1110">1110</th><td>	<em>int</em> <dfn class="local col5 decl" id="235i" title='i' data-type='int' data-ref="235i" data-ref-filename="235i">i</dfn>;</td></tr>
<tr><th id="1111">1111</th><td></td></tr>
<tr><th id="1112">1112</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((i) = find_first_bit((ppgtt-&gt;pml4.used_pml4es), (512)); (i) &lt; (512); (i) = find_next_bit((ppgtt-&gt;pml4.used_pml4es), (512), (i) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col5 ref" href="#235i" title='i' data-ref="235i" data-ref-filename="235i">i</a>, <a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>.<a class="ref field" href="i915_gem_gtt.h.html#290" title='i915_pml4::used_pml4es' data-ref="i915_pml4::used_pml4es" data-ref-filename="i915_pml4..used_pml4es">used_pml4es</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>) {</td></tr>
<tr><th id="1113">1113</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!ppgtt-&gt;pml4.pdps[i]))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1113, &quot;!ppgtt-&gt;pml4.pdps[i]&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_pml4::pdps" title='i915_pml4::pdps' data-ref="i915_pml4::pdps" data-ref-filename="i915_pml4..pdps">pdps</a>[<a class="local col5 ref" href="#235i" title='i' data-ref="235i" data-ref-filename="235i">i</a>]))</td></tr>
<tr><th id="1114">1114</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1115">1115</th><td></td></tr>
<tr><th id="1116">1116</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_cleanup_3lvl" title='gen8_ppgtt_cleanup_3lvl' data-use='c' data-ref="gen8_ppgtt_cleanup_3lvl" data-ref-filename="gen8_ppgtt_cleanup_3lvl">gen8_ppgtt_cleanup_3lvl</a>(<a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_pml4::pdps" title='i915_pml4::pdps' data-ref="i915_pml4::pdps" data-ref-filename="i915_pml4..pdps">pdps</a>[<a class="local col5 ref" href="#235i" title='i' data-ref="235i" data-ref-filename="235i">i</a>]);</td></tr>
<tr><th id="1117">1117</th><td>	}</td></tr>
<tr><th id="1118">1118</th><td></td></tr>
<tr><th id="1119">1119</th><td>	<a class="macro" href="#438" title="cleanup_page_dma((ppgtt-&gt;base.dev), (&amp;(&amp;ppgtt-&gt;pml4)-&gt;base))" data-ref="_M/cleanup_px">cleanup_px</a>(<a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, &amp;<a class="local col4 ref" href="#234ppgtt" title='ppgtt' data-ref="234ppgtt" data-ref-filename="234ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>);</td></tr>
<tr><th id="1120">1120</th><td>}</td></tr>
<tr><th id="1121">1121</th><td></td></tr>
<tr><th id="1122">1122</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_cleanup" title='gen8_ppgtt_cleanup' data-type='void gen8_ppgtt_cleanup(struct i915_address_space * vm)' data-ref="gen8_ppgtt_cleanup" data-ref-filename="gen8_ppgtt_cleanup">gen8_ppgtt_cleanup</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col6 decl" id="236vm" title='vm' data-type='struct i915_address_space *' data-ref="236vm" data-ref-filename="236vm">vm</dfn>)</td></tr>
<tr><th id="1123">1123</th><td>{</td></tr>
<tr><th id="1124">1124</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col7 decl" id="237ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="237ppgtt" data-ref-filename="237ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1125">1125</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col6 ref" href="#236vm" title='vm' data-ref="236vm" data-ref-filename="236vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1126">1126</th><td></td></tr>
<tr><th id="1127">1127</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col6 ref" href="#236vm" title='vm' data-ref="236vm" data-ref-filename="236vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>))</td></tr>
<tr><th id="1128">1128</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_notify_vgt" title='gen8_ppgtt_notify_vgt' data-use='c' data-ref="gen8_ppgtt_notify_vgt" data-ref-filename="gen8_ppgtt_notify_vgt">gen8_ppgtt_notify_vgt</a>(<a class="local col7 ref" href="#237ppgtt" title='ppgtt' data-ref="237ppgtt" data-ref-filename="237ppgtt">ppgtt</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>);</td></tr>
<tr><th id="1129">1129</th><td></td></tr>
<tr><th id="1130">1130</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(ppgtt-&gt;base.dev))</td></tr>
<tr><th id="1131">1131</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_cleanup_3lvl" title='gen8_ppgtt_cleanup_3lvl' data-use='c' data-ref="gen8_ppgtt_cleanup_3lvl" data-ref-filename="gen8_ppgtt_cleanup_3lvl">gen8_ppgtt_cleanup_3lvl</a>(<a class="local col7 ref" href="#237ppgtt" title='ppgtt' data-ref="237ppgtt" data-ref-filename="237ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, &amp;<a class="local col7 ref" href="#237ppgtt" title='ppgtt' data-ref="237ppgtt" data-ref-filename="237ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>);</td></tr>
<tr><th id="1132">1132</th><td>	<b>else</b></td></tr>
<tr><th id="1133">1133</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_cleanup_4lvl" title='gen8_ppgtt_cleanup_4lvl' data-use='c' data-ref="gen8_ppgtt_cleanup_4lvl" data-ref-filename="gen8_ppgtt_cleanup_4lvl">gen8_ppgtt_cleanup_4lvl</a>(<a class="local col7 ref" href="#237ppgtt" title='ppgtt' data-ref="237ppgtt" data-ref-filename="237ppgtt">ppgtt</a>);</td></tr>
<tr><th id="1134">1134</th><td></td></tr>
<tr><th id="1135">1135</th><td>	<a class="tu ref fn" href="#gen8_free_scratch" title='gen8_free_scratch' data-use='c' data-ref="gen8_free_scratch" data-ref-filename="gen8_free_scratch">gen8_free_scratch</a>(<a class="local col6 ref" href="#236vm" title='vm' data-ref="236vm" data-ref-filename="236vm">vm</a>);</td></tr>
<tr><th id="1136">1136</th><td>}</td></tr>
<tr><th id="1137">1137</th><td></td></tr>
<tr><th id="1138">1138</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs">/**</i></td></tr>
<tr><th id="1139">1139</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * gen8_ppgtt_alloc_pagetabs() - Allocate page tables for VA range.</i></td></tr>
<tr><th id="1140">1140</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *<span class="command"> @vm</span><span class="arg">:</span>	Master vm structure.</i></td></tr>
<tr><th id="1141">1141</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *<span class="command"> @pd</span><span class="arg">:</span>	Page directory for this address range.</i></td></tr>
<tr><th id="1142">1142</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *<span class="command"> @start</span>:	Starting virtual address to begin allocations.</i></td></tr>
<tr><th id="1143">1143</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *<span class="command"> @length</span>:	Size of the allocations.</i></td></tr>
<tr><th id="1144">1144</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *<span class="command"> @new</span>_pts:	Bitmap set by function with new allocations. Likely used by the</i></td></tr>
<tr><th id="1145">1145</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *		caller to free on error.</i></td></tr>
<tr><th id="1146">1146</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *</i></td></tr>
<tr><th id="1147">1147</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * Allocate the required number of page tables. Extremely similar to</i></td></tr>
<tr><th id="1148">1148</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * gen8_ppgtt_alloc_page_directories(). The main difference is here we are limited by</i></td></tr>
<tr><th id="1149">1149</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * the page directory boundary (instead of the page directory pointer). That</i></td></tr>
<tr><th id="1150">1150</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * boundary is 1GB virtual. Therefore, unlike gen8_ppgtt_alloc_page_directories(), it is</i></td></tr>
<tr><th id="1151">1151</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * possible, and likely that the caller will need to use multiple calls of this</i></td></tr>
<tr><th id="1152">1152</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * function to achieve the appropriate allocation.</i></td></tr>
<tr><th id="1153">1153</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> *</i></td></tr>
<tr><th id="1154">1154</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> * Return: 0 if success; negative error code otherwise.</i></td></tr>
<tr><th id="1155">1155</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_pagetabs"> */</i></td></tr>
<tr><th id="1156">1156</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_ppgtt_alloc_pagetabs" title='gen8_ppgtt_alloc_pagetabs' data-type='int gen8_ppgtt_alloc_pagetabs(struct i915_address_space * vm, struct i915_page_directory * pd, uint64_t start, uint64_t length, unsigned long * new_pts)' data-ref="gen8_ppgtt_alloc_pagetabs" data-ref-filename="gen8_ppgtt_alloc_pagetabs">gen8_ppgtt_alloc_pagetabs</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="238vm" title='vm' data-type='struct i915_address_space *' data-ref="238vm" data-ref-filename="238vm">vm</dfn>,</td></tr>
<tr><th id="1157">1157</th><td>				     <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col9 decl" id="239pd" title='pd' data-type='struct i915_page_directory *' data-ref="239pd" data-ref-filename="239pd">pd</dfn>,</td></tr>
<tr><th id="1158">1158</th><td>				     <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="240start" title='start' data-type='uint64_t' data-ref="240start" data-ref-filename="240start">start</dfn>,</td></tr>
<tr><th id="1159">1159</th><td>				     <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="241length" title='length' data-type='uint64_t' data-ref="241length" data-ref-filename="241length">length</dfn>,</td></tr>
<tr><th id="1160">1160</th><td>				     <em>unsigned</em> <em>long</em> *<dfn class="local col2 decl" id="242new_pts" title='new_pts' data-type='unsigned long *' data-ref="242new_pts" data-ref-filename="242new_pts">new_pts</dfn>)</td></tr>
<tr><th id="1161">1161</th><td>{</td></tr>
<tr><th id="1162">1162</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="243dev" title='dev' data-type='struct drm_device *' data-ref="243dev" data-ref-filename="243dev">dev</dfn> = <a class="local col8 ref" href="#238vm" title='vm' data-ref="238vm" data-ref-filename="238vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1163">1163</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col4 decl" id="244pt" title='pt' data-type='struct i915_page_table *' data-ref="244pt" data-ref-filename="244pt">pt</dfn>;</td></tr>
<tr><th id="1164">1164</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="245temp" title='temp' data-type='uint64_t' data-ref="245temp" data-ref-filename="245temp">temp</dfn>;</td></tr>
<tr><th id="1165">1165</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="246pde" title='pde' data-type='uint32_t' data-ref="246pde" data-ref-filename="246pde">pde</dfn>;</td></tr>
<tr><th id="1166">1166</th><td></td></tr>
<tr><th id="1167">1167</th><td>	<a class="macro" href="i915_gem_gtt.h.html#546" title="for (pde = gen8_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pde">gen8_for_each_pde</a>(<a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a>, <a class="local col9 ref" href="#239pd" title='pd' data-ref="239pd" data-ref-filename="239pd">pd</a>, <a class="local col0 ref" href="#240start" title='start' data-ref="240start" data-ref-filename="240start">start</a>, <a class="local col1 ref" href="#241length" title='length' data-ref="241length" data-ref-filename="241length">length</a>, temp, <a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>) {</td></tr>
<tr><th id="1168">1168</th><td>		<i>/* Don't reallocate page tables */</i></td></tr>
<tr><th id="1169">1169</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>, <a class="local col9 ref" href="#239pd" title='pd' data-ref="239pd" data-ref-filename="239pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>)) {</td></tr>
<tr><th id="1170">1170</th><td>			<i>/* Scratch is never allocated this way */</i></td></tr>
<tr><th id="1171">1171</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((pt == vm-&gt;scratch_pt))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1171, &quot;pt == vm-&gt;scratch_pt&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a> == <a class="local col8 ref" href="#238vm" title='vm' data-ref="238vm" data-ref-filename="238vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="1172">1172</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1173">1173</th><td>		}</td></tr>
<tr><th id="1174">1174</th><td></td></tr>
<tr><th id="1175">1175</th><td>		<a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a> = <a class="tu ref fn" href="#alloc_pt" title='alloc_pt' data-use='c' data-ref="alloc_pt" data-ref-filename="alloc_pt">alloc_pt</a>(<a class="local col3 ref" href="#243dev" title='dev' data-ref="243dev" data-ref-filename="243dev">dev</a>);</td></tr>
<tr><th id="1176">1176</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a>))</td></tr>
<tr><th id="1177">1177</th><td>			<b>goto</b> <a class="lbl" href="#247unwind_out" data-ref="247unwind_out" data-ref-filename="247unwind_out">unwind_out</a>;</td></tr>
<tr><th id="1178">1178</th><td></td></tr>
<tr><th id="1179">1179</th><td>		<a class="tu ref fn" href="#gen8_initialize_pt" title='gen8_initialize_pt' data-use='c' data-ref="gen8_initialize_pt" data-ref-filename="gen8_initialize_pt">gen8_initialize_pt</a>(<a class="local col8 ref" href="#238vm" title='vm' data-ref="238vm" data-ref-filename="238vm">vm</a>, <a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a>);</td></tr>
<tr><th id="1180">1180</th><td>		<a class="local col9 ref" href="#239pd" title='pd' data-ref="239pd" data-ref-filename="239pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>] = <a class="local col4 ref" href="#244pt" title='pt' data-ref="244pt" data-ref-filename="244pt">pt</a>;</td></tr>
<tr><th id="1181">1181</th><td>		<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>, <a class="local col2 ref" href="#242new_pts" title='new_pts' data-ref="242new_pts" data-ref-filename="242new_pts">new_pts</a>);</td></tr>
<tr><th id="1182">1182</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_table_entry_alloc" title='trace_i915_page_table_entry_alloc' data-ref="trace_i915_page_table_entry_alloc" data-ref-filename="trace_i915_page_table_entry_alloc">trace_i915_page_table_entry_alloc</a>(<a class="local col8 ref" href="#238vm" title='vm' data-ref="238vm" data-ref-filename="238vm">vm</a>, <a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>, <a class="local col0 ref" href="#240start" title='start' data-ref="240start" data-ref-filename="240start">start</a>, <a class="macro" href="i915_gem_gtt.h.html#107" title="21" data-ref="_M/GEN8_PDE_SHIFT">GEN8_PDE_SHIFT</a>);</td></tr>
<tr><th id="1183">1183</th><td>	}</td></tr>
<tr><th id="1184">1184</th><td></td></tr>
<tr><th id="1185">1185</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1186">1186</th><td></td></tr>
<tr><th id="1187">1187</th><td><dfn class="lbl" id="247unwind_out" data-ref="247unwind_out" data-ref-filename="247unwind_out">unwind_out</dfn>:</td></tr>
<tr><th id="1188">1188</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pde) = find_first_bit((new_pts), (512)); (pde) &lt; (512); (pde) = find_next_bit((new_pts), (512), (pde) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>, <a class="local col2 ref" href="#242new_pts" title='new_pts' data-ref="242new_pts" data-ref-filename="242new_pts">new_pts</a>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>)</td></tr>
<tr><th id="1189">1189</th><td>		<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col3 ref" href="#243dev" title='dev' data-ref="243dev" data-ref-filename="243dev">dev</a>, <a class="local col9 ref" href="#239pd" title='pd' data-ref="239pd" data-ref-filename="239pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col6 ref" href="#246pde" title='pde' data-ref="246pde" data-ref-filename="246pde">pde</a>]);</td></tr>
<tr><th id="1190">1190</th><td></td></tr>
<tr><th id="1191">1191</th><td>	<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1192">1192</th><td>}</td></tr>
<tr><th id="1193">1193</th><td></td></tr>
<tr><th id="1194">1194</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories">/**</i></td></tr>
<tr><th id="1195">1195</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * gen8_ppgtt_alloc_page_directories() - Allocate page directories for VA range.</i></td></tr>
<tr><th id="1196">1196</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @vm</span><span class="arg">:</span>	Master vm structure.</i></td></tr>
<tr><th id="1197">1197</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @pdp</span>:	Page directory pointer for this address range.</i></td></tr>
<tr><th id="1198">1198</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @start</span>:	Starting virtual address to begin allocations.</i></td></tr>
<tr><th id="1199">1199</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @length</span>:	Size of the allocations.</i></td></tr>
<tr><th id="1200">1200</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @new</span>_pds:	Bitmap set by function with new allocations. Likely used by the</i></td></tr>
<tr><th id="1201">1201</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *		caller to free on error.</i></td></tr>
<tr><th id="1202">1202</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *</i></td></tr>
<tr><th id="1203">1203</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * Allocate the required number of page directories starting at the pde index of</i></td></tr>
<tr><th id="1204">1204</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *<span class="command"> @start</span>, and ending at the pde index<span class="command"> @start</span> +<span class="command"> @length</span>. This function will skip</i></td></tr>
<tr><th id="1205">1205</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * over already allocated page directories within the range, and only allocate</i></td></tr>
<tr><th id="1206">1206</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * new ones, setting the appropriate pointer within the pdp as well as the</i></td></tr>
<tr><th id="1207">1207</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * correct position in the bitmap<span class="command"> @new</span>_pds.</i></td></tr>
<tr><th id="1208">1208</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *</i></td></tr>
<tr><th id="1209">1209</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * The function will only allocate the pages within the range for a give page</i></td></tr>
<tr><th id="1210">1210</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * directory pointer. In other words, if<span class="command"> @start</span> +<span class="command"> @length</span> straddles a virtually</i></td></tr>
<tr><th id="1211">1211</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * addressed PDP boundary (512GB for 4k pages), there will be more allocations</i></td></tr>
<tr><th id="1212">1212</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * required by the caller, This is not currently possible, and the BUG in the</i></td></tr>
<tr><th id="1213">1213</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * code will prevent it.</i></td></tr>
<tr><th id="1214">1214</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> *</i></td></tr>
<tr><th id="1215">1215</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> * Return: 0 if success; negative error code otherwise.</i></td></tr>
<tr><th id="1216">1216</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_directories"> */</i></td></tr>
<tr><th id="1217">1217</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1218">1218</th><td><dfn class="tu decl def fn" id="gen8_ppgtt_alloc_page_directories" title='gen8_ppgtt_alloc_page_directories' data-type='int gen8_ppgtt_alloc_page_directories(struct i915_address_space * vm, struct i915_page_directory_pointer * pdp, uint64_t start, uint64_t length, unsigned long * new_pds)' data-ref="gen8_ppgtt_alloc_page_directories" data-ref-filename="gen8_ppgtt_alloc_page_directories">gen8_ppgtt_alloc_page_directories</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="248vm" title='vm' data-type='struct i915_address_space *' data-ref="248vm" data-ref-filename="248vm">vm</dfn>,</td></tr>
<tr><th id="1219">1219</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col9 decl" id="249pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="249pdp" data-ref-filename="249pdp">pdp</dfn>,</td></tr>
<tr><th id="1220">1220</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="250start" title='start' data-type='uint64_t' data-ref="250start" data-ref-filename="250start">start</dfn>,</td></tr>
<tr><th id="1221">1221</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="251length" title='length' data-type='uint64_t' data-ref="251length" data-ref-filename="251length">length</dfn>,</td></tr>
<tr><th id="1222">1222</th><td>				  <em>unsigned</em> <em>long</em> *<dfn class="local col2 decl" id="252new_pds" title='new_pds' data-type='unsigned long *' data-ref="252new_pds" data-ref-filename="252new_pds">new_pds</dfn>)</td></tr>
<tr><th id="1223">1223</th><td>{</td></tr>
<tr><th id="1224">1224</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="253dev" title='dev' data-type='struct drm_device *' data-ref="253dev" data-ref-filename="253dev">dev</dfn> = <a class="local col8 ref" href="#248vm" title='vm' data-ref="248vm" data-ref-filename="248vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1225">1225</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col4 decl" id="254pd" title='pd' data-type='struct i915_page_directory *' data-ref="254pd" data-ref-filename="254pd">pd</dfn>;</td></tr>
<tr><th id="1226">1226</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="255temp" title='temp' data-type='uint64_t' data-ref="255temp" data-ref-filename="255temp">temp</dfn>;</td></tr>
<tr><th id="1227">1227</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="256pdpe" title='pdpe' data-type='uint32_t' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</dfn>;</td></tr>
<tr><th id="1228">1228</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="257pdpes" title='pdpes' data-type='uint32_t' data-ref="257pdpes" data-ref-filename="257pdpes">pdpes</dfn> = <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(dev);</td></tr>
<tr><th id="1229">1229</th><td></td></tr>
<tr><th id="1230">1230</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!bitmap_empty(new_pds, pdpes)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1230, &quot;!bitmap_empty(new_pds, pdpes)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_empty" title='bitmap_empty' data-ref="bitmap_empty" data-ref-filename="bitmap_empty">bitmap_empty</a>(<a class="local col2 ref" href="#252new_pds" title='new_pds' data-ref="252new_pds" data-ref-filename="252new_pds">new_pds</a>, <a class="local col7 ref" href="#257pdpes" title='pdpes' data-ref="257pdpes" data-ref-filename="257pdpes">pdpes</a>));</td></tr>
<tr><th id="1231">1231</th><td></td></tr>
<tr><th id="1232">1232</th><td>	<a class="macro" href="i915_gem_gtt.h.html#555" title="for (pdpe = gen8_pdpe_index(start); length &gt; 0 &amp;&amp; (pdpe &lt; ((i915.enable_ppgtt == 3) ? 512 : 4)) ? (pd = (pdp)-&gt;page_directory[pdpe]), 1 : 0; pdpe++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pdpe">gen8_for_each_pdpe</a>(<a class="local col4 ref" href="#254pd" title='pd' data-ref="254pd" data-ref-filename="254pd">pd</a>, <a class="local col9 ref" href="#249pdp" title='pdp' data-ref="249pdp" data-ref-filename="249pdp">pdp</a>, <a class="local col0 ref" href="#250start" title='start' data-ref="250start" data-ref-filename="250start">start</a>, <a class="local col1 ref" href="#251length" title='length' data-ref="251length" data-ref-filename="251length">length</a>, temp, <a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>) {</td></tr>
<tr><th id="1233">1233</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>, <a class="local col9 ref" href="#249pdp" title='pdp' data-ref="249pdp" data-ref-filename="249pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>))</td></tr>
<tr><th id="1234">1234</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1235">1235</th><td></td></tr>
<tr><th id="1236">1236</th><td>		<a class="local col4 ref" href="#254pd" title='pd' data-ref="254pd" data-ref-filename="254pd">pd</a> = <a class="tu ref fn" href="#alloc_pd" title='alloc_pd' data-use='c' data-ref="alloc_pd" data-ref-filename="alloc_pd">alloc_pd</a>(<a class="local col3 ref" href="#253dev" title='dev' data-ref="253dev" data-ref-filename="253dev">dev</a>);</td></tr>
<tr><th id="1237">1237</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col4 ref" href="#254pd" title='pd' data-ref="254pd" data-ref-filename="254pd">pd</a>))</td></tr>
<tr><th id="1238">1238</th><td>			<b>goto</b> <a class="lbl" href="#258unwind_out" data-ref="258unwind_out" data-ref-filename="258unwind_out">unwind_out</a>;</td></tr>
<tr><th id="1239">1239</th><td></td></tr>
<tr><th id="1240">1240</th><td>		<a class="tu ref fn" href="#gen8_initialize_pd" title='gen8_initialize_pd' data-use='c' data-ref="gen8_initialize_pd" data-ref-filename="gen8_initialize_pd">gen8_initialize_pd</a>(<a class="local col8 ref" href="#248vm" title='vm' data-ref="248vm" data-ref-filename="248vm">vm</a>, <a class="local col4 ref" href="#254pd" title='pd' data-ref="254pd" data-ref-filename="254pd">pd</a>);</td></tr>
<tr><th id="1241">1241</th><td>		<a class="local col9 ref" href="#249pdp" title='pdp' data-ref="249pdp" data-ref-filename="249pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>] = <a class="local col4 ref" href="#254pd" title='pd' data-ref="254pd" data-ref-filename="254pd">pd</a>;</td></tr>
<tr><th id="1242">1242</th><td>		<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>, <a class="local col2 ref" href="#252new_pds" title='new_pds' data-ref="252new_pds" data-ref-filename="252new_pds">new_pds</a>);</td></tr>
<tr><th id="1243">1243</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_directory_entry_alloc" title='trace_i915_page_directory_entry_alloc' data-ref="trace_i915_page_directory_entry_alloc" data-ref-filename="trace_i915_page_directory_entry_alloc">trace_i915_page_directory_entry_alloc</a>(<a class="local col8 ref" href="#248vm" title='vm' data-ref="248vm" data-ref-filename="248vm">vm</a>, <a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>, <a class="local col0 ref" href="#250start" title='start' data-ref="250start" data-ref-filename="250start">start</a>, <a class="macro" href="i915_gem_gtt.h.html#103" title="30" data-ref="_M/GEN8_PDPE_SHIFT">GEN8_PDPE_SHIFT</a>);</td></tr>
<tr><th id="1244">1244</th><td>	}</td></tr>
<tr><th id="1245">1245</th><td></td></tr>
<tr><th id="1246">1246</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1247">1247</th><td></td></tr>
<tr><th id="1248">1248</th><td><dfn class="lbl" id="258unwind_out" data-ref="258unwind_out" data-ref-filename="258unwind_out">unwind_out</dfn>:</td></tr>
<tr><th id="1249">1249</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pdpe) = find_first_bit((new_pds), (pdpes)); (pdpe) &lt; (pdpes); (pdpe) = find_next_bit((new_pds), (pdpes), (pdpe) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>, <a class="local col2 ref" href="#252new_pds" title='new_pds' data-ref="252new_pds" data-ref-filename="252new_pds">new_pds</a>, <a class="local col7 ref" href="#257pdpes" title='pdpes' data-ref="257pdpes" data-ref-filename="257pdpes">pdpes</a>)</td></tr>
<tr><th id="1250">1250</th><td>		<a class="tu ref fn" href="#free_pd" title='free_pd' data-use='c' data-ref="free_pd" data-ref-filename="free_pd">free_pd</a>(<a class="local col3 ref" href="#253dev" title='dev' data-ref="253dev" data-ref-filename="253dev">dev</a>, <a class="local col9 ref" href="#249pdp" title='pdp' data-ref="249pdp" data-ref-filename="249pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col6 ref" href="#256pdpe" title='pdpe' data-ref="256pdpe" data-ref-filename="256pdpe">pdpe</a>]);</td></tr>
<tr><th id="1251">1251</th><td></td></tr>
<tr><th id="1252">1252</th><td>	<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1253">1253</th><td>}</td></tr>
<tr><th id="1254">1254</th><td></td></tr>
<tr><th id="1255">1255</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers">/**</i></td></tr>
<tr><th id="1256">1256</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * gen8_ppgtt_alloc_page_dirpointers() - Allocate pdps for VA range.</i></td></tr>
<tr><th id="1257">1257</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *<span class="command"> @vm</span><span class="arg">:</span>	Master vm structure.</i></td></tr>
<tr><th id="1258">1258</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *<span class="command"> @pml4</span>:	Page map level 4 for this address range.</i></td></tr>
<tr><th id="1259">1259</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *<span class="command"> @start</span>:	Starting virtual address to begin allocations.</i></td></tr>
<tr><th id="1260">1260</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *<span class="command"> @length</span>:	Size of the allocations.</i></td></tr>
<tr><th id="1261">1261</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *<span class="command"> @new</span>_pdps:	Bitmap set by function with new allocations. Likely used by the</i></td></tr>
<tr><th id="1262">1262</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *		caller to free on error.</i></td></tr>
<tr><th id="1263">1263</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *</i></td></tr>
<tr><th id="1264">1264</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * Allocate the required number of page directory pointers. Extremely similar to</i></td></tr>
<tr><th id="1265">1265</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * gen8_ppgtt_alloc_page_directories() and gen8_ppgtt_alloc_pagetabs().</i></td></tr>
<tr><th id="1266">1266</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * The main difference is here we are limited by the pml4 boundary (instead of</i></td></tr>
<tr><th id="1267">1267</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * the page directory pointer).</i></td></tr>
<tr><th id="1268">1268</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> *</i></td></tr>
<tr><th id="1269">1269</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> * Return: 0 if success; negative error code otherwise.</i></td></tr>
<tr><th id="1270">1270</th><td><i class="doc" data-doc="gen8_ppgtt_alloc_page_dirpointers"> */</i></td></tr>
<tr><th id="1271">1271</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="1272">1272</th><td><dfn class="tu decl def fn" id="gen8_ppgtt_alloc_page_dirpointers" title='gen8_ppgtt_alloc_page_dirpointers' data-type='int gen8_ppgtt_alloc_page_dirpointers(struct i915_address_space * vm, struct i915_pml4 * pml4, uint64_t start, uint64_t length, unsigned long * new_pdps)' data-ref="gen8_ppgtt_alloc_page_dirpointers" data-ref-filename="gen8_ppgtt_alloc_page_dirpointers">gen8_ppgtt_alloc_page_dirpointers</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col9 decl" id="259vm" title='vm' data-type='struct i915_address_space *' data-ref="259vm" data-ref-filename="259vm">vm</dfn>,</td></tr>
<tr><th id="1273">1273</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_pml4" title='i915_pml4' data-ref="i915_pml4" data-ref-filename="i915_pml4">i915_pml4</a> *<dfn class="local col0 decl" id="260pml4" title='pml4' data-type='struct i915_pml4 *' data-ref="260pml4" data-ref-filename="260pml4">pml4</dfn>,</td></tr>
<tr><th id="1274">1274</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="261start" title='start' data-type='uint64_t' data-ref="261start" data-ref-filename="261start">start</dfn>,</td></tr>
<tr><th id="1275">1275</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="262length" title='length' data-type='uint64_t' data-ref="262length" data-ref-filename="262length">length</dfn>,</td></tr>
<tr><th id="1276">1276</th><td>				  <em>unsigned</em> <em>long</em> *<dfn class="local col3 decl" id="263new_pdps" title='new_pdps' data-type='unsigned long *' data-ref="263new_pdps" data-ref-filename="263new_pdps">new_pdps</dfn>)</td></tr>
<tr><th id="1277">1277</th><td>{</td></tr>
<tr><th id="1278">1278</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="264dev" title='dev' data-type='struct drm_device *' data-ref="264dev" data-ref-filename="264dev">dev</dfn> = <a class="local col9 ref" href="#259vm" title='vm' data-ref="259vm" data-ref-filename="259vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1279">1279</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col5 decl" id="265pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="265pdp" data-ref-filename="265pdp">pdp</dfn>;</td></tr>
<tr><th id="1280">1280</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="266temp" title='temp' data-type='uint64_t' data-ref="266temp" data-ref-filename="266temp">temp</dfn>;</td></tr>
<tr><th id="1281">1281</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="267pml4e" title='pml4e' data-type='uint32_t' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</dfn>;</td></tr>
<tr><th id="1282">1282</th><td></td></tr>
<tr><th id="1283">1283</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!bitmap_empty(new_pdps, 512)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1283, &quot;!bitmap_empty(new_pdps, GEN8_PML4ES_PER_PML4)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_empty" title='bitmap_empty' data-ref="bitmap_empty" data-ref-filename="bitmap_empty">bitmap_empty</a>(<a class="local col3 ref" href="#263new_pdps" title='new_pdps' data-ref="263new_pdps" data-ref-filename="263new_pdps">new_pdps</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>));</td></tr>
<tr><th id="1284">1284</th><td></td></tr>
<tr><th id="1285">1285</th><td>	<a class="macro" href="i915_gem_gtt.h.html#564" title="for (pml4e = gen8_pml4e_index(start); length &gt; 0 &amp;&amp; pml4e &lt; 512 ? (pdp = (pml4)-&gt;pdps[pml4e]), 1 : 0; pml4e++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pml4e">gen8_for_each_pml4e</a>(<a class="local col5 ref" href="#265pdp" title='pdp' data-ref="265pdp" data-ref-filename="265pdp">pdp</a>, <a class="local col0 ref" href="#260pml4" title='pml4' data-ref="260pml4" data-ref-filename="260pml4">pml4</a>, <a class="local col1 ref" href="#261start" title='start' data-ref="261start" data-ref-filename="261start">start</a>, <a class="local col2 ref" href="#262length" title='length' data-ref="262length" data-ref-filename="262length">length</a>, temp, <a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>) {</td></tr>
<tr><th id="1286">1286</th><td>		<b>if</b> (!<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>, <a class="local col0 ref" href="#260pml4" title='pml4' data-ref="260pml4" data-ref-filename="260pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#290" title='i915_pml4::used_pml4es' data-ref="i915_pml4::used_pml4es" data-ref-filename="i915_pml4..used_pml4es">used_pml4es</a>)) {</td></tr>
<tr><th id="1287">1287</th><td>			<a class="local col5 ref" href="#265pdp" title='pdp' data-ref="265pdp" data-ref-filename="265pdp">pdp</a> = <a class="tu ref fn" href="#alloc_pdp" title='alloc_pdp' data-use='c' data-ref="alloc_pdp" data-ref-filename="alloc_pdp">alloc_pdp</a>(<a class="local col4 ref" href="#264dev" title='dev' data-ref="264dev" data-ref-filename="264dev">dev</a>);</td></tr>
<tr><th id="1288">1288</th><td>			<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col5 ref" href="#265pdp" title='pdp' data-ref="265pdp" data-ref-filename="265pdp">pdp</a>))</td></tr>
<tr><th id="1289">1289</th><td>				<b>goto</b> <a class="lbl" href="#268unwind_out" data-ref="268unwind_out" data-ref-filename="268unwind_out">unwind_out</a>;</td></tr>
<tr><th id="1290">1290</th><td></td></tr>
<tr><th id="1291">1291</th><td>			<a class="tu ref fn" href="#gen8_initialize_pdp" title='gen8_initialize_pdp' data-use='c' data-ref="gen8_initialize_pdp" data-ref-filename="gen8_initialize_pdp">gen8_initialize_pdp</a>(<a class="local col9 ref" href="#259vm" title='vm' data-ref="259vm" data-ref-filename="259vm">vm</a>, <a class="local col5 ref" href="#265pdp" title='pdp' data-ref="265pdp" data-ref-filename="265pdp">pdp</a>);</td></tr>
<tr><th id="1292">1292</th><td>			<a class="local col0 ref" href="#260pml4" title='pml4' data-ref="260pml4" data-ref-filename="260pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_pml4::pdps" title='i915_pml4::pdps' data-ref="i915_pml4::pdps" data-ref-filename="i915_pml4..pdps">pdps</a>[<a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>] = <a class="local col5 ref" href="#265pdp" title='pdp' data-ref="265pdp" data-ref-filename="265pdp">pdp</a>;</td></tr>
<tr><th id="1293">1293</th><td>			<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>, <a class="local col3 ref" href="#263new_pdps" title='new_pdps' data-ref="263new_pdps" data-ref-filename="263new_pdps">new_pdps</a>);</td></tr>
<tr><th id="1294">1294</th><td>			<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_directory_pointer_entry_alloc" title='trace_i915_page_directory_pointer_entry_alloc' data-ref="trace_i915_page_directory_pointer_entry_alloc" data-ref-filename="trace_i915_page_directory_pointer_entry_alloc">trace_i915_page_directory_pointer_entry_alloc</a>(<a class="local col9 ref" href="#259vm" title='vm' data-ref="259vm" data-ref-filename="259vm">vm</a>,</td></tr>
<tr><th id="1295">1295</th><td>								      <a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>,</td></tr>
<tr><th id="1296">1296</th><td>								      <a class="local col1 ref" href="#261start" title='start' data-ref="261start" data-ref-filename="261start">start</a>,</td></tr>
<tr><th id="1297">1297</th><td>								      <a class="macro" href="i915_gem_gtt.h.html#101" title="39" data-ref="_M/GEN8_PML4E_SHIFT">GEN8_PML4E_SHIFT</a>);</td></tr>
<tr><th id="1298">1298</th><td>		}</td></tr>
<tr><th id="1299">1299</th><td>	}</td></tr>
<tr><th id="1300">1300</th><td></td></tr>
<tr><th id="1301">1301</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1302">1302</th><td></td></tr>
<tr><th id="1303">1303</th><td><dfn class="lbl" id="268unwind_out" data-ref="268unwind_out" data-ref-filename="268unwind_out">unwind_out</dfn>:</td></tr>
<tr><th id="1304">1304</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pml4e) = find_first_bit((new_pdps), (512)); (pml4e) &lt; (512); (pml4e) = find_next_bit((new_pdps), (512), (pml4e) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>, <a class="local col3 ref" href="#263new_pdps" title='new_pdps' data-ref="263new_pdps" data-ref-filename="263new_pdps">new_pdps</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>)</td></tr>
<tr><th id="1305">1305</th><td>		<a class="tu ref fn" href="#free_pdp" title='free_pdp' data-use='c' data-ref="free_pdp" data-ref-filename="free_pdp">free_pdp</a>(<a class="local col4 ref" href="#264dev" title='dev' data-ref="264dev" data-ref-filename="264dev">dev</a>, <a class="local col0 ref" href="#260pml4" title='pml4' data-ref="260pml4" data-ref-filename="260pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_pml4::pdps" title='i915_pml4::pdps' data-ref="i915_pml4::pdps" data-ref-filename="i915_pml4..pdps">pdps</a>[<a class="local col7 ref" href="#267pml4e" title='pml4e' data-ref="267pml4e" data-ref-filename="267pml4e">pml4e</a>]);</td></tr>
<tr><th id="1306">1306</th><td></td></tr>
<tr><th id="1307">1307</th><td>	<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1308">1308</th><td>}</td></tr>
<tr><th id="1309">1309</th><td></td></tr>
<tr><th id="1310">1310</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1311">1311</th><td><dfn class="tu decl def fn" id="free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-type='void free_gen8_temp_bitmaps(unsigned long * new_pds, unsigned long * new_pts)' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</dfn>(<em>unsigned</em> <em>long</em> *<dfn class="local col9 decl" id="269new_pds" title='new_pds' data-type='unsigned long *' data-ref="269new_pds" data-ref-filename="269new_pds">new_pds</dfn>, <em>unsigned</em> <em>long</em> *<dfn class="local col0 decl" id="270new_pts" title='new_pts' data-type='unsigned long *' data-ref="270new_pts" data-ref-filename="270new_pts">new_pts</dfn>)</td></tr>
<tr><th id="1312">1312</th><td>{</td></tr>
<tr><th id="1313">1313</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col0 ref" href="#270new_pts" title='new_pts' data-ref="270new_pts" data-ref-filename="270new_pts">new_pts</a>);</td></tr>
<tr><th id="1314">1314</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col9 ref" href="#269new_pds" title='new_pds' data-ref="269new_pds" data-ref-filename="269new_pds">new_pds</a>);</td></tr>
<tr><th id="1315">1315</th><td>}</td></tr>
<tr><th id="1316">1316</th><td></td></tr>
<tr><th id="1317">1317</th><td><i  data-doc="alloc_gen8_temp_bitmaps">/* Fills in the page directory bitmap, and the array of page tables bitmap. Both</i></td></tr>
<tr><th id="1318">1318</th><td><i  data-doc="alloc_gen8_temp_bitmaps"> * of these are based on the number of PDPEs in the system.</i></td></tr>
<tr><th id="1319">1319</th><td><i  data-doc="alloc_gen8_temp_bitmaps"> */</i></td></tr>
<tr><th id="1320">1320</th><td><em>static</em></td></tr>
<tr><th id="1321">1321</th><td><em>int</em> <a class="macro" href="../../../../common/include/linux/kernel.h.html#57" title="__attribute__((warn_unused_result))" data-ref="_M/__must_check">__must_check</a> <dfn class="tu decl def fn" id="alloc_gen8_temp_bitmaps" title='alloc_gen8_temp_bitmaps' data-type='int alloc_gen8_temp_bitmaps(unsigned long ** new_pds, unsigned long ** new_pts, uint32_t pdpes)' data-ref="alloc_gen8_temp_bitmaps" data-ref-filename="alloc_gen8_temp_bitmaps">alloc_gen8_temp_bitmaps</dfn>(<em>unsigned</em> <em>long</em> **<dfn class="local col1 decl" id="271new_pds" title='new_pds' data-type='unsigned long **' data-ref="271new_pds" data-ref-filename="271new_pds">new_pds</dfn>,</td></tr>
<tr><th id="1322">1322</th><td>					 <em>unsigned</em> <em>long</em> **<dfn class="local col2 decl" id="272new_pts" title='new_pts' data-type='unsigned long **' data-ref="272new_pts" data-ref-filename="272new_pts">new_pts</dfn>,</td></tr>
<tr><th id="1323">1323</th><td>					 <a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col3 decl" id="273pdpes" title='pdpes' data-type='uint32_t' data-ref="273pdpes" data-ref-filename="273pdpes">pdpes</dfn>)</td></tr>
<tr><th id="1324">1324</th><td>{</td></tr>
<tr><th id="1325">1325</th><td>	<em>unsigned</em> <em>long</em> *<dfn class="local col4 decl" id="274pds" title='pds' data-type='unsigned long *' data-ref="274pds" data-ref-filename="274pds">pds</dfn>;</td></tr>
<tr><th id="1326">1326</th><td>	<em>unsigned</em> <em>long</em> *<dfn class="local col5 decl" id="275pts" title='pts' data-type='unsigned long *' data-ref="275pts" data-ref-filename="275pts">pts</dfn>;</td></tr>
<tr><th id="1327">1327</th><td></td></tr>
<tr><th id="1328">1328</th><td>	<a class="local col4 ref" href="#274pds" title='pds' data-ref="274pds" data-ref-filename="274pds">pds</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((pdpes)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="local col3 ref" href="#273pdpes" title='pdpes' data-ref="273pdpes" data-ref-filename="273pdpes">pdpes</a>), <b>sizeof</b>(<em>unsigned</em> <em>long</em>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#47" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(10) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((10) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_TEMPORARY">GFP_TEMPORARY</a>);</td></tr>
<tr><th id="1329">1329</th><td>	<b>if</b> (!<a class="local col4 ref" href="#274pds" title='pds' data-ref="274pds" data-ref-filename="274pds">pds</a>)</td></tr>
<tr><th id="1330">1330</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1331">1331</th><td></td></tr>
<tr><th id="1332">1332</th><td>	<a class="local col5 ref" href="#275pts" title='pts' data-ref="275pts" data-ref-filename="275pts">pts</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kcalloc" title='kcalloc' data-ref="kcalloc" data-ref-filename="kcalloc">kcalloc</a>(<a class="local col3 ref" href="#273pdpes" title='pdpes' data-ref="273pdpes" data-ref-filename="273pdpes">pdpes</a>, <a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>) * <b>sizeof</b>(<em>unsigned</em> <em>long</em>),</td></tr>
<tr><th id="1333">1333</th><td>		      <a class="macro" href="../../../../common/include/linux/gfp.h.html#47" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(10) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((10) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_TEMPORARY">GFP_TEMPORARY</a>);</td></tr>
<tr><th id="1334">1334</th><td>	<b>if</b> (!<a class="local col5 ref" href="#275pts" title='pts' data-ref="275pts" data-ref-filename="275pts">pts</a>)</td></tr>
<tr><th id="1335">1335</th><td>		<b>goto</b> <a class="lbl" href="#276err_out" data-ref="276err_out" data-ref-filename="276err_out">err_out</a>;</td></tr>
<tr><th id="1336">1336</th><td></td></tr>
<tr><th id="1337">1337</th><td>	*<a class="local col1 ref" href="#271new_pds" title='new_pds' data-ref="271new_pds" data-ref-filename="271new_pds">new_pds</a> = <a class="local col4 ref" href="#274pds" title='pds' data-ref="274pds" data-ref-filename="274pds">pds</a>;</td></tr>
<tr><th id="1338">1338</th><td>	*<a class="local col2 ref" href="#272new_pts" title='new_pts' data-ref="272new_pts" data-ref-filename="272new_pts">new_pts</a> = <a class="local col5 ref" href="#275pts" title='pts' data-ref="275pts" data-ref-filename="275pts">pts</a>;</td></tr>
<tr><th id="1339">1339</th><td></td></tr>
<tr><th id="1340">1340</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1341">1341</th><td></td></tr>
<tr><th id="1342">1342</th><td><dfn class="lbl" id="276err_out" data-ref="276err_out" data-ref-filename="276err_out">err_out</dfn>:</td></tr>
<tr><th id="1343">1343</th><td>	<a class="tu ref fn" href="#free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-use='c' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</a>(<a class="local col4 ref" href="#274pds" title='pds' data-ref="274pds" data-ref-filename="274pds">pds</a>, <a class="local col5 ref" href="#275pts" title='pts' data-ref="275pts" data-ref-filename="275pts">pts</a>);</td></tr>
<tr><th id="1344">1344</th><td>	<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="1345">1345</th><td>}</td></tr>
<tr><th id="1346">1346</th><td></td></tr>
<tr><th id="1347">1347</th><td><i  data-doc="mark_tlbs_dirty">/* PDE TLBs are a pain to invalidate on GEN8+. When we modify</i></td></tr>
<tr><th id="1348">1348</th><td><i  data-doc="mark_tlbs_dirty"> * the page table structures, we mark them dirty so that</i></td></tr>
<tr><th id="1349">1349</th><td><i  data-doc="mark_tlbs_dirty"> * context switching/execlist queuing code takes extra steps</i></td></tr>
<tr><th id="1350">1350</th><td><i  data-doc="mark_tlbs_dirty"> * to ensure that tlbs are flushed.</i></td></tr>
<tr><th id="1351">1351</th><td><i  data-doc="mark_tlbs_dirty"> */</i></td></tr>
<tr><th id="1352">1352</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="mark_tlbs_dirty" title='mark_tlbs_dirty' data-type='void mark_tlbs_dirty(struct i915_hw_ppgtt * ppgtt)' data-ref="mark_tlbs_dirty" data-ref-filename="mark_tlbs_dirty">mark_tlbs_dirty</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col7 decl" id="277ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="277ppgtt" data-ref-filename="277ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="1353">1353</th><td>{</td></tr>
<tr><th id="1354">1354</th><td>	<a class="local col7 ref" href="#277ppgtt" title='ppgtt' data-ref="277ppgtt" data-ref-filename="277ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::pd_dirty_rings" title='i915_hw_ppgtt::pd_dirty_rings' data-ref="i915_hw_ppgtt::pd_dirty_rings" data-ref-filename="i915_hw_ppgtt..pd_dirty_rings">pd_dirty_rings</a> = <a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*ppgtt-&gt;base.dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(ppgtt-&gt;base.dev)); else if (__builtin_types_compatible_p(typeof(*ppgtt-&gt;base.dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(ppgtt-&gt;base.dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col7 ref" href="#277ppgtt" title='ppgtt' data-ref="277ppgtt" data-ref-filename="277ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::ring_mask" title='intel_device_info::ring_mask' data-ref="intel_device_info::ring_mask" data-ref-filename="intel_device_info..ring_mask">ring_mask</a>;</td></tr>
<tr><th id="1355">1355</th><td>}</td></tr>
<tr><th id="1356">1356</th><td></td></tr>
<tr><th id="1357">1357</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_alloc_va_range_3lvl" title='gen8_alloc_va_range_3lvl' data-type='int gen8_alloc_va_range_3lvl(struct i915_address_space * vm, struct i915_page_directory_pointer * pdp, uint64_t start, uint64_t length)' data-ref="gen8_alloc_va_range_3lvl" data-ref-filename="gen8_alloc_va_range_3lvl">gen8_alloc_va_range_3lvl</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="278vm" title='vm' data-type='struct i915_address_space *' data-ref="278vm" data-ref-filename="278vm">vm</dfn>,</td></tr>
<tr><th id="1358">1358</th><td>				    <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col9 decl" id="279pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="279pdp" data-ref-filename="279pdp">pdp</dfn>,</td></tr>
<tr><th id="1359">1359</th><td>				    <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="280start" title='start' data-type='uint64_t' data-ref="280start" data-ref-filename="280start">start</dfn>,</td></tr>
<tr><th id="1360">1360</th><td>				    <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="281length" title='length' data-type='uint64_t' data-ref="281length" data-ref-filename="281length">length</dfn>)</td></tr>
<tr><th id="1361">1361</th><td>{</td></tr>
<tr><th id="1362">1362</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col2 decl" id="282ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1363">1363</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col8 ref" href="#278vm" title='vm' data-ref="278vm" data-ref-filename="278vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1364">1364</th><td>	<em>unsigned</em> <em>long</em> *<dfn class="local col3 decl" id="283new_page_dirs" title='new_page_dirs' data-type='unsigned long *' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</dfn>, *<dfn class="local col4 decl" id="284new_page_tables" title='new_page_tables' data-type='unsigned long *' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</dfn>;</td></tr>
<tr><th id="1365">1365</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col5 decl" id="285dev" title='dev' data-type='struct drm_device *' data-ref="285dev" data-ref-filename="285dev">dev</dfn> = <a class="local col8 ref" href="#278vm" title='vm' data-ref="278vm" data-ref-filename="278vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1366">1366</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col6 decl" id="286pd" title='pd' data-type='struct i915_page_directory *' data-ref="286pd" data-ref-filename="286pd">pd</dfn>;</td></tr>
<tr><th id="1367">1367</th><td>	<em>const</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="287orig_start" title='orig_start' data-type='const uint64_t' data-ref="287orig_start" data-ref-filename="287orig_start">orig_start</dfn> = <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>;</td></tr>
<tr><th id="1368">1368</th><td>	<em>const</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col8 decl" id="288orig_length" title='orig_length' data-type='const uint64_t' data-ref="288orig_length" data-ref-filename="288orig_length">orig_length</dfn> = <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>;</td></tr>
<tr><th id="1369">1369</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="289temp" title='temp' data-type='uint64_t' data-ref="289temp" data-ref-filename="289temp">temp</dfn>;</td></tr>
<tr><th id="1370">1370</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="290pdpe" title='pdpe' data-type='uint32_t' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</dfn>;</td></tr>
<tr><th id="1371">1371</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="291pdpes" title='pdpes' data-type='uint32_t' data-ref="291pdpes" data-ref-filename="291pdpes">pdpes</dfn> = <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(dev);</td></tr>
<tr><th id="1372">1372</th><td>	<em>int</em> <dfn class="local col2 decl" id="292ret" title='ret' data-type='int' data-ref="292ret" data-ref-filename="292ret">ret</dfn>;</td></tr>
<tr><th id="1373">1373</th><td></td></tr>
<tr><th id="1374">1374</th><td>	<i>/* Wrap is never okay since we can only represent 48b, and we don't</i></td></tr>
<tr><th id="1375">1375</th><td><i>	 * actually use the other side of the canonical address space.</i></td></tr>
<tr><th id="1376">1376</th><td><i>	 */</i></td></tr>
<tr><th id="1377">1377</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((start + length &lt; start))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1377, &quot;start + length &lt; start&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a> + <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a> &lt; <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>))</td></tr>
<tr><th id="1378">1378</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#61" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1379">1379</th><td></td></tr>
<tr><th id="1380">1380</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((start + length &gt; vm-&gt;total))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1380, &quot;start + length &gt; vm-&gt;total&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a> + <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a> &gt; <a class="local col8 ref" href="#278vm" title='vm' data-ref="278vm" data-ref-filename="278vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>))</td></tr>
<tr><th id="1381">1381</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#61" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="1382">1382</th><td></td></tr>
<tr><th id="1383">1383</th><td>	<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a> = <a class="tu ref fn" href="#alloc_gen8_temp_bitmaps" title='alloc_gen8_temp_bitmaps' data-use='c' data-ref="alloc_gen8_temp_bitmaps" data-ref-filename="alloc_gen8_temp_bitmaps">alloc_gen8_temp_bitmaps</a>(&amp;<a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>, &amp;<a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a>, <a class="local col1 ref" href="#291pdpes" title='pdpes' data-ref="291pdpes" data-ref-filename="291pdpes">pdpes</a>);</td></tr>
<tr><th id="1384">1384</th><td>	<b>if</b> (<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>)</td></tr>
<tr><th id="1385">1385</th><td>		<b>return</b> <a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>;</td></tr>
<tr><th id="1386">1386</th><td></td></tr>
<tr><th id="1387">1387</th><td>	<i>/* Do the allocations first so we can easily bail out */</i></td></tr>
<tr><th id="1388">1388</th><td>	<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a> = <a class="tu ref fn" href="#gen8_ppgtt_alloc_page_directories" title='gen8_ppgtt_alloc_page_directories' data-use='c' data-ref="gen8_ppgtt_alloc_page_directories" data-ref-filename="gen8_ppgtt_alloc_page_directories">gen8_ppgtt_alloc_page_directories</a>(<a class="local col8 ref" href="#278vm" title='vm' data-ref="278vm" data-ref-filename="278vm">vm</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>, <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>, <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>,</td></tr>
<tr><th id="1389">1389</th><td>						<a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>);</td></tr>
<tr><th id="1390">1390</th><td>	<b>if</b> (<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>) {</td></tr>
<tr><th id="1391">1391</th><td>		<a class="tu ref fn" href="#free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-use='c' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</a>(<a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>, <a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a>);</td></tr>
<tr><th id="1392">1392</th><td>		<b>return</b> <a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>;</td></tr>
<tr><th id="1393">1393</th><td>	}</td></tr>
<tr><th id="1394">1394</th><td></td></tr>
<tr><th id="1395">1395</th><td>	<i>/* For every page directory referenced, allocate page tables */</i></td></tr>
<tr><th id="1396">1396</th><td>	<a class="macro" href="i915_gem_gtt.h.html#555" title="for (pdpe = gen8_pdpe_index(start); length &gt; 0 &amp;&amp; (pdpe &lt; ((i915.enable_ppgtt == 3) ? 512 : 4)) ? (pd = (pdp)-&gt;page_directory[pdpe]), 1 : 0; pdpe++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pdpe">gen8_for_each_pdpe</a>(<a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>, <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>, <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>, temp, <a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>) {</td></tr>
<tr><th id="1397">1397</th><td>		<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a> = <a class="tu ref fn" href="#gen8_ppgtt_alloc_pagetabs" title='gen8_ppgtt_alloc_pagetabs' data-use='c' data-ref="gen8_ppgtt_alloc_pagetabs" data-ref-filename="gen8_ppgtt_alloc_pagetabs">gen8_ppgtt_alloc_pagetabs</a>(<a class="local col8 ref" href="#278vm" title='vm' data-ref="278vm" data-ref-filename="278vm">vm</a>, <a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>, <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>, <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>,</td></tr>
<tr><th id="1398">1398</th><td>						<a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a> + <a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a> * <a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>));</td></tr>
<tr><th id="1399">1399</th><td>		<b>if</b> (<a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>)</td></tr>
<tr><th id="1400">1400</th><td>			<b>goto</b> <a class="lbl" href="#293err_out" data-ref="293err_out" data-ref-filename="293err_out">err_out</a>;</td></tr>
<tr><th id="1401">1401</th><td>	}</td></tr>
<tr><th id="1402">1402</th><td></td></tr>
<tr><th id="1403">1403</th><td>	<a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a> = <a class="local col7 ref" href="#287orig_start" title='orig_start' data-ref="287orig_start" data-ref-filename="287orig_start">orig_start</a>;</td></tr>
<tr><th id="1404">1404</th><td>	<a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a> = <a class="local col8 ref" href="#288orig_length" title='orig_length' data-ref="288orig_length" data-ref-filename="288orig_length">orig_length</a>;</td></tr>
<tr><th id="1405">1405</th><td></td></tr>
<tr><th id="1406">1406</th><td>	<i>/* Allocations have completed successfully, so set the bitmaps, and do</i></td></tr>
<tr><th id="1407">1407</th><td><i>	 * the mappings. */</i></td></tr>
<tr><th id="1408">1408</th><td>	<a class="macro" href="i915_gem_gtt.h.html#555" title="for (pdpe = gen8_pdpe_index(start); length &gt; 0 &amp;&amp; (pdpe &lt; ((i915.enable_ppgtt == 3) ? 512 : 4)) ? (pd = (pdp)-&gt;page_directory[pdpe]), 1 : 0; pdpe++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pdpe">gen8_for_each_pdpe</a>(<a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>, <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>, <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>, temp, <a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>) {</td></tr>
<tr><th id="1409">1409</th><td>		<a class="typedef" href="i915_gem_gtt.h.html#gen8_pde_t" title='gen8_pde_t' data-type='uint64_t' data-ref="gen8_pde_t" data-ref-filename="gen8_pde_t">gen8_pde_t</a> *<em>const</em> <dfn class="local col4 decl" id="294page_directory" title='page_directory' data-type='gen8_pde_t *const' data-ref="294page_directory" data-ref-filename="294page_directory">page_directory</dfn> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pd)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>);</td></tr>
<tr><th id="1410">1410</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col5 decl" id="295pt" title='pt' data-type='struct i915_page_table *' data-ref="295pt" data-ref-filename="295pt">pt</dfn>;</td></tr>
<tr><th id="1411">1411</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="296pd_len" title='pd_len' data-type='uint64_t' data-ref="296pd_len" data-ref-filename="296pd_len">pd_len</dfn> = <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>;</td></tr>
<tr><th id="1412">1412</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="297pd_start" title='pd_start' data-type='uint64_t' data-ref="297pd_start" data-ref-filename="297pd_start">pd_start</dfn> = <a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>;</td></tr>
<tr><th id="1413">1413</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="298pde" title='pde' data-type='uint32_t' data-ref="298pde" data-ref-filename="298pde">pde</dfn>;</td></tr>
<tr><th id="1414">1414</th><td></td></tr>
<tr><th id="1415">1415</th><td>		<i>/* Every pd should be allocated, we just did that above. */</i></td></tr>
<tr><th id="1416">1416</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pd))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1416, &quot;!pd&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>);</td></tr>
<tr><th id="1417">1417</th><td></td></tr>
<tr><th id="1418">1418</th><td>		<a class="macro" href="i915_gem_gtt.h.html#546" title="for (pde = gen8_pde_index(pd_start); pd_len &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - pd_start, temp = (( (temp)&lt;(pd_len))?(temp):(pd_len)), pd_start += temp, pd_len -= temp)" data-ref="_M/gen8_for_each_pde">gen8_for_each_pde</a>(<a class="local col5 ref" href="#295pt" title='pt' data-ref="295pt" data-ref-filename="295pt">pt</a>, <a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>, <a class="local col7 ref" href="#297pd_start" title='pd_start' data-ref="297pd_start" data-ref-filename="297pd_start">pd_start</a>, <a class="local col6 ref" href="#296pd_len" title='pd_len' data-ref="296pd_len" data-ref-filename="296pd_len">pd_len</a>, temp, <a class="local col8 ref" href="#298pde" title='pde' data-ref="298pde" data-ref-filename="298pde">pde</a>) {</td></tr>
<tr><th id="1419">1419</th><td>			<i>/* Same reasoning as pd */</i></td></tr>
<tr><th id="1420">1420</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pt))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1420, &quot;!pt&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col5 ref" href="#295pt" title='pt' data-ref="295pt" data-ref-filename="295pt">pt</a>);</td></tr>
<tr><th id="1421">1421</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pd_len))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1421, &quot;!pd_len&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col6 ref" href="#296pd_len" title='pd_len' data-ref="296pd_len" data-ref-filename="296pd_len">pd_len</a>);</td></tr>
<tr><th id="1422">1422</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!gen8_pte_count(pd_start, pd_len)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1422, &quot;!gen8_pte_count(pd_start, pd_len)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_count" title='gen8_pte_count' data-ref="gen8_pte_count" data-ref-filename="gen8_pte_count">gen8_pte_count</a>(<a class="local col7 ref" href="#297pd_start" title='pd_start' data-ref="297pd_start" data-ref-filename="297pd_start">pd_start</a>, <a class="local col6 ref" href="#296pd_len" title='pd_len' data-ref="296pd_len" data-ref-filename="296pd_len">pd_len</a>));</td></tr>
<tr><th id="1423">1423</th><td></td></tr>
<tr><th id="1424">1424</th><td>			<i>/* Set our used ptes within the page table */</i></td></tr>
<tr><th id="1425">1425</th><td>			<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_set" title='bitmap_set' data-ref="bitmap_set" data-ref-filename="bitmap_set">bitmap_set</a>(<a class="local col5 ref" href="#295pt" title='pt' data-ref="295pt" data-ref-filename="295pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>,</td></tr>
<tr><th id="1426">1426</th><td>				   <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_index" title='gen8_pte_index' data-ref="gen8_pte_index" data-ref-filename="gen8_pte_index">gen8_pte_index</a>(<a class="local col7 ref" href="#297pd_start" title='pd_start' data-ref="297pd_start" data-ref-filename="297pd_start">pd_start</a>),</td></tr>
<tr><th id="1427">1427</th><td>				   <a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_count" title='gen8_pte_count' data-ref="gen8_pte_count" data-ref-filename="gen8_pte_count">gen8_pte_count</a>(<a class="local col7 ref" href="#297pd_start" title='pd_start' data-ref="297pd_start" data-ref-filename="297pd_start">pd_start</a>, <a class="local col6 ref" href="#296pd_len" title='pd_len' data-ref="296pd_len" data-ref-filename="296pd_len">pd_len</a>));</td></tr>
<tr><th id="1428">1428</th><td></td></tr>
<tr><th id="1429">1429</th><td>			<i>/* Our pde is now pointing to the pagetable, pt */</i></td></tr>
<tr><th id="1430">1430</th><td>			<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col8 ref" href="#298pde" title='pde' data-ref="298pde" data-ref-filename="298pde">pde</a>, <a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>);</td></tr>
<tr><th id="1431">1431</th><td></td></tr>
<tr><th id="1432">1432</th><td>			<i>/* Map the PDE to the page table */</i></td></tr>
<tr><th id="1433">1433</th><td>			<a class="local col4 ref" href="#294page_directory" title='page_directory' data-ref="294page_directory" data-ref-filename="294page_directory">page_directory</a>[<a class="local col8 ref" href="#298pde" title='pde' data-ref="298pde" data-ref-filename="298pde">pde</a>] = <a class="tu ref fn" href="#gen8_pde_encode" title='gen8_pde_encode' data-use='c' data-ref="gen8_pde_encode" data-ref-filename="gen8_pde_encode">gen8_pde_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(pt)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col5 ref" href="#295pt" title='pt' data-ref="295pt" data-ref-filename="295pt">pt</a>),</td></tr>
<tr><th id="1434">1434</th><td>							      <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>);</td></tr>
<tr><th id="1435">1435</th><td>			<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_table_entry_map" title='trace_i915_page_table_entry_map' data-ref="trace_i915_page_table_entry_map" data-ref-filename="trace_i915_page_table_entry_map">trace_i915_page_table_entry_map</a>(&amp;<a class="local col2 ref" href="#282ppgtt" title='ppgtt' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, <a class="local col8 ref" href="#298pde" title='pde' data-ref="298pde" data-ref-filename="298pde">pde</a>, <a class="local col5 ref" href="#295pt" title='pt' data-ref="295pt" data-ref-filename="295pt">pt</a>,</td></tr>
<tr><th id="1436">1436</th><td>							<a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_index" title='gen8_pte_index' data-ref="gen8_pte_index" data-ref-filename="gen8_pte_index">gen8_pte_index</a>(<a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>),</td></tr>
<tr><th id="1437">1437</th><td>							<a class="ref fn" href="i915_gem_gtt.h.html#gen8_pte_count" title='gen8_pte_count' data-ref="gen8_pte_count" data-ref-filename="gen8_pte_count">gen8_pte_count</a>(<a class="local col0 ref" href="#280start" title='start' data-ref="280start" data-ref-filename="280start">start</a>, <a class="local col1 ref" href="#281length" title='length' data-ref="281length" data-ref-filename="281length">length</a>),</td></tr>
<tr><th id="1438">1438</th><td>							<a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a>);</td></tr>
<tr><th id="1439">1439</th><td></td></tr>
<tr><th id="1440">1440</th><td>			<i>/* NB: We haven't yet mapped ptes to pages. At this</i></td></tr>
<tr><th id="1441">1441</th><td><i>			 * point we're still relying on insert_entries() */</i></td></tr>
<tr><th id="1442">1442</th><td>		}</td></tr>
<tr><th id="1443">1443</th><td></td></tr>
<tr><th id="1444">1444</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (page_directory))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col2 ref" href="#282ppgtt" title='ppgtt' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</a>, <a class="local col4 ref" href="#294page_directory" title='page_directory' data-ref="294page_directory" data-ref-filename="294page_directory">page_directory</a>);</td></tr>
<tr><th id="1445">1445</th><td>		<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>);</td></tr>
<tr><th id="1446">1446</th><td>		<a class="tu ref fn" href="#gen8_setup_page_directory" title='gen8_setup_page_directory' data-use='c' data-ref="gen8_setup_page_directory" data-ref-filename="gen8_setup_page_directory">gen8_setup_page_directory</a>(<a class="local col2 ref" href="#282ppgtt" title='ppgtt' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>, <a class="local col6 ref" href="#286pd" title='pd' data-ref="286pd" data-ref-filename="286pd">pd</a>, <a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>);</td></tr>
<tr><th id="1447">1447</th><td>	}</td></tr>
<tr><th id="1448">1448</th><td></td></tr>
<tr><th id="1449">1449</th><td>	<a class="tu ref fn" href="#free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-use='c' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</a>(<a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>, <a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a>);</td></tr>
<tr><th id="1450">1450</th><td>	<a class="tu ref fn" href="#mark_tlbs_dirty" title='mark_tlbs_dirty' data-use='c' data-ref="mark_tlbs_dirty" data-ref-filename="mark_tlbs_dirty">mark_tlbs_dirty</a>(<a class="local col2 ref" href="#282ppgtt" title='ppgtt' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</a>);</td></tr>
<tr><th id="1451">1451</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1452">1452</th><td></td></tr>
<tr><th id="1453">1453</th><td><dfn class="lbl" id="293err_out" data-ref="293err_out" data-ref-filename="293err_out">err_out</dfn>:</td></tr>
<tr><th id="1454">1454</th><td>	<b>while</b> (<a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>--) {</td></tr>
<tr><th id="1455">1455</th><td>		<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((temp) = find_first_bit((new_page_tables + pdpe * (((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)), (512)); (temp) &lt; (512); (temp) = find_next_bit((new_page_tables + pdpe * (((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)), (512), (temp) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col9 ref" href="#289temp" title='temp' data-ref="289temp" data-ref-filename="289temp">temp</a>, <a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a> + <a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a> *</td></tr>
<tr><th id="1456">1456</th><td>				<a class="macro" href="../../../../common/include/linux/bitops.h.html#105" title="(((((512)) - 1) | (((sizeof(unsigned long) * 8)) - 1)) + 1)" data-ref="_M/BITS_TO_LONGS">BITS_TO_LONGS</a>(<a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>), <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>)</td></tr>
<tr><th id="1457">1457</th><td>			<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col5 ref" href="#285dev" title='dev' data-ref="285dev" data-ref-filename="285dev">dev</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>]-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col9 ref" href="#289temp" title='temp' data-ref="289temp" data-ref-filename="289temp">temp</a>]);</td></tr>
<tr><th id="1458">1458</th><td>	}</td></tr>
<tr><th id="1459">1459</th><td></td></tr>
<tr><th id="1460">1460</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pdpe) = find_first_bit((new_page_dirs), (pdpes)); (pdpe) &lt; (pdpes); (pdpe) = find_next_bit((new_page_dirs), (pdpes), (pdpe) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>, <a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>, <a class="local col1 ref" href="#291pdpes" title='pdpes' data-ref="291pdpes" data-ref-filename="291pdpes">pdpes</a>)</td></tr>
<tr><th id="1461">1461</th><td>		<a class="tu ref fn" href="#free_pd" title='free_pd' data-use='c' data-ref="free_pd" data-ref-filename="free_pd">free_pd</a>(<a class="local col5 ref" href="#285dev" title='dev' data-ref="285dev" data-ref-filename="285dev">dev</a>, <a class="local col9 ref" href="#279pdp" title='pdp' data-ref="279pdp" data-ref-filename="279pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::page_directory" title='i915_page_directory_pointer::page_directory' data-ref="i915_page_directory_pointer::page_directory" data-ref-filename="i915_page_directory_pointer..page_directory">page_directory</a>[<a class="local col0 ref" href="#290pdpe" title='pdpe' data-ref="290pdpe" data-ref-filename="290pdpe">pdpe</a>]);</td></tr>
<tr><th id="1462">1462</th><td></td></tr>
<tr><th id="1463">1463</th><td>	<a class="tu ref fn" href="#free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-use='c' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</a>(<a class="local col3 ref" href="#283new_page_dirs" title='new_page_dirs' data-ref="283new_page_dirs" data-ref-filename="283new_page_dirs">new_page_dirs</a>, <a class="local col4 ref" href="#284new_page_tables" title='new_page_tables' data-ref="284new_page_tables" data-ref-filename="284new_page_tables">new_page_tables</a>);</td></tr>
<tr><th id="1464">1464</th><td>	<a class="tu ref fn" href="#mark_tlbs_dirty" title='mark_tlbs_dirty' data-use='c' data-ref="mark_tlbs_dirty" data-ref-filename="mark_tlbs_dirty">mark_tlbs_dirty</a>(<a class="local col2 ref" href="#282ppgtt" title='ppgtt' data-ref="282ppgtt" data-ref-filename="282ppgtt">ppgtt</a>);</td></tr>
<tr><th id="1465">1465</th><td>	<b>return</b> <a class="local col2 ref" href="#292ret" title='ret' data-ref="292ret" data-ref-filename="292ret">ret</a>;</td></tr>
<tr><th id="1466">1466</th><td>}</td></tr>
<tr><th id="1467">1467</th><td></td></tr>
<tr><th id="1468">1468</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_alloc_va_range_4lvl" title='gen8_alloc_va_range_4lvl' data-type='int gen8_alloc_va_range_4lvl(struct i915_address_space * vm, struct i915_pml4 * pml4, uint64_t start, uint64_t length)' data-ref="gen8_alloc_va_range_4lvl" data-ref-filename="gen8_alloc_va_range_4lvl">gen8_alloc_va_range_4lvl</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col9 decl" id="299vm" title='vm' data-type='struct i915_address_space *' data-ref="299vm" data-ref-filename="299vm">vm</dfn>,</td></tr>
<tr><th id="1469">1469</th><td>				    <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_pml4" title='i915_pml4' data-ref="i915_pml4" data-ref-filename="i915_pml4">i915_pml4</a> *<dfn class="local col0 decl" id="300pml4" title='pml4' data-type='struct i915_pml4 *' data-ref="300pml4" data-ref-filename="300pml4">pml4</dfn>,</td></tr>
<tr><th id="1470">1470</th><td>				    <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="301start" title='start' data-type='uint64_t' data-ref="301start" data-ref-filename="301start">start</dfn>,</td></tr>
<tr><th id="1471">1471</th><td>				    <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="302length" title='length' data-type='uint64_t' data-ref="302length" data-ref-filename="302length">length</dfn>)</td></tr>
<tr><th id="1472">1472</th><td>{</td></tr>
<tr><th id="1473">1473</th><td>	<a class="macro" href="../../../include/linux/types.h.html#91" title="unsigned long new_pdps[((512) + ((8*sizeof(unsigned long)) - 1)) / (8*sizeof(unsigned long))]" data-ref="_M/DECLARE_BITMAP">DECLARE_BITMAP</a>(<dfn class="local col3 decl" id="303new_pdps" title='new_pdps' data-type='unsigned long [8]' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</dfn>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>);</td></tr>
<tr><th id="1474">1474</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="304ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="304ppgtt" data-ref-filename="304ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1475">1475</th><td>			<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col9 ref" href="#299vm" title='vm' data-ref="299vm" data-ref-filename="299vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1476">1476</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col5 decl" id="305pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="305pdp" data-ref-filename="305pdp">pdp</dfn>;</td></tr>
<tr><th id="1477">1477</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="306temp" title='temp' data-type='uint64_t' data-ref="306temp" data-ref-filename="306temp">temp</dfn>, <dfn class="local col7 decl" id="307pml4e" title='pml4e' data-type='uint64_t' data-ref="307pml4e" data-ref-filename="307pml4e">pml4e</dfn>;</td></tr>
<tr><th id="1478">1478</th><td>	<em>int</em> <dfn class="local col8 decl" id="308ret" title='ret' data-type='int' data-ref="308ret" data-ref-filename="308ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="1479">1479</th><td></td></tr>
<tr><th id="1480">1480</th><td>	<i>/* Do the pml4 allocations first, so we don't need to track the newly</i></td></tr>
<tr><th id="1481">1481</th><td><i>	 * allocated tables below the pdp */</i></td></tr>
<tr><th id="1482">1482</th><td>	<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_zero" title='bitmap_zero' data-ref="bitmap_zero" data-ref-filename="bitmap_zero">bitmap_zero</a>(<a class="local col3 ref" href="#1473" title='new_pdps' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>);</td></tr>
<tr><th id="1483">1483</th><td></td></tr>
<tr><th id="1484">1484</th><td>	<i>/* The pagedirectory and pagetable allocations are done in the shared 3</i></td></tr>
<tr><th id="1485">1485</th><td><i>	 * and 4 level code. Just allocate the pdps.</i></td></tr>
<tr><th id="1486">1486</th><td><i>	 */</i></td></tr>
<tr><th id="1487">1487</th><td>	<a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a> = <a class="tu ref fn" href="#gen8_ppgtt_alloc_page_dirpointers" title='gen8_ppgtt_alloc_page_dirpointers' data-use='c' data-ref="gen8_ppgtt_alloc_page_dirpointers" data-ref-filename="gen8_ppgtt_alloc_page_dirpointers">gen8_ppgtt_alloc_page_dirpointers</a>(<a class="local col9 ref" href="#299vm" title='vm' data-ref="299vm" data-ref-filename="299vm">vm</a>, <a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>, <a class="local col1 ref" href="#301start" title='start' data-ref="301start" data-ref-filename="301start">start</a>, <a class="local col2 ref" href="#302length" title='length' data-ref="302length" data-ref-filename="302length">length</a>,</td></tr>
<tr><th id="1488">1488</th><td>						<a class="local col3 ref" href="#1473" title='new_pdps' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</a>);</td></tr>
<tr><th id="1489">1489</th><td>	<b>if</b> (<a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a>)</td></tr>
<tr><th id="1490">1490</th><td>		<b>return</b> <a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a>;</td></tr>
<tr><th id="1491">1491</th><td></td></tr>
<tr><th id="1492">1492</th><td>	<a class="macro" href="../../../include/asm/bug.h.html#47" title="linux_warning((bitmap_weight(new_pdps, 512) &gt; 2)? (printf(&quot;warning: %s:%d: &quot; &quot;The allocation has spanned more than 512GB. &quot; &quot;It is highly likely this is incorrect.&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1494), 1) : 0)" data-ref="_M/WARN">WARN</a>(<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_weight" title='bitmap_weight' data-ref="bitmap_weight" data-ref-filename="bitmap_weight">bitmap_weight</a>(<a class="local col3 ref" href="#1473" title='new_pdps' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>) &gt; <var>2</var>,</td></tr>
<tr><th id="1493">1493</th><td>	     <q>"The allocation has spanned more than 512GB. "</q></td></tr>
<tr><th id="1494">1494</th><td>	     <q>"It is highly likely this is incorrect."</q>);</td></tr>
<tr><th id="1495">1495</th><td></td></tr>
<tr><th id="1496">1496</th><td>	<a class="macro" href="i915_gem_gtt.h.html#564" title="for (pml4e = gen8_pml4e_index(start); length &gt; 0 &amp;&amp; pml4e &lt; 512 ? (pdp = (pml4)-&gt;pdps[pml4e]), 1 : 0; pml4e++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pml4e">gen8_for_each_pml4e</a>(<a class="local col5 ref" href="#305pdp" title='pdp' data-ref="305pdp" data-ref-filename="305pdp">pdp</a>, <a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>, <a class="local col1 ref" href="#301start" title='start' data-ref="301start" data-ref-filename="301start">start</a>, <a class="local col2 ref" href="#302length" title='length' data-ref="302length" data-ref-filename="302length">length</a>, temp, <a class="local col7 ref" href="#307pml4e" title='pml4e' data-ref="307pml4e" data-ref-filename="307pml4e">pml4e</a>) {</td></tr>
<tr><th id="1497">1497</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!pdp))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1497, &quot;!pdp&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col5 ref" href="#305pdp" title='pdp' data-ref="305pdp" data-ref-filename="305pdp">pdp</a>);</td></tr>
<tr><th id="1498">1498</th><td></td></tr>
<tr><th id="1499">1499</th><td>		<a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a> = <a class="tu ref fn" href="#gen8_alloc_va_range_3lvl" title='gen8_alloc_va_range_3lvl' data-use='c' data-ref="gen8_alloc_va_range_3lvl" data-ref-filename="gen8_alloc_va_range_3lvl">gen8_alloc_va_range_3lvl</a>(<a class="local col9 ref" href="#299vm" title='vm' data-ref="299vm" data-ref-filename="299vm">vm</a>, <a class="local col5 ref" href="#305pdp" title='pdp' data-ref="305pdp" data-ref-filename="305pdp">pdp</a>, <a class="local col1 ref" href="#301start" title='start' data-ref="301start" data-ref-filename="301start">start</a>, <a class="local col2 ref" href="#302length" title='length' data-ref="302length" data-ref-filename="302length">length</a>);</td></tr>
<tr><th id="1500">1500</th><td>		<b>if</b> (<a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a>)</td></tr>
<tr><th id="1501">1501</th><td>			<b>goto</b> <a class="lbl" href="#309err_out" data-ref="309err_out" data-ref-filename="309err_out">err_out</a>;</td></tr>
<tr><th id="1502">1502</th><td></td></tr>
<tr><th id="1503">1503</th><td>		<a class="tu ref fn" href="#gen8_setup_page_directory_pointer" title='gen8_setup_page_directory_pointer' data-use='c' data-ref="gen8_setup_page_directory_pointer" data-ref-filename="gen8_setup_page_directory_pointer">gen8_setup_page_directory_pointer</a>(<a class="local col4 ref" href="#304ppgtt" title='ppgtt' data-ref="304ppgtt" data-ref-filename="304ppgtt">ppgtt</a>, <a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>, <a class="local col5 ref" href="#305pdp" title='pdp' data-ref="305pdp" data-ref-filename="305pdp">pdp</a>, <a class="local col7 ref" href="#307pml4e" title='pml4e' data-ref="307pml4e" data-ref-filename="307pml4e">pml4e</a>);</td></tr>
<tr><th id="1504">1504</th><td>	}</td></tr>
<tr><th id="1505">1505</th><td></td></tr>
<tr><th id="1506">1506</th><td>	<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_or" title='bitmap_or' data-ref="bitmap_or" data-ref-filename="bitmap_or">bitmap_or</a>(<a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#290" title='i915_pml4::used_pml4es' data-ref="i915_pml4::used_pml4es" data-ref-filename="i915_pml4..used_pml4es">used_pml4es</a>, <a class="local col3 ref" href="#1473" title='new_pdps' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</a>, <a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#290" title='i915_pml4::used_pml4es' data-ref="i915_pml4::used_pml4es" data-ref-filename="i915_pml4..used_pml4es">used_pml4es</a>,</td></tr>
<tr><th id="1507">1507</th><td>		  <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>);</td></tr>
<tr><th id="1508">1508</th><td></td></tr>
<tr><th id="1509">1509</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1510">1510</th><td></td></tr>
<tr><th id="1511">1511</th><td><dfn class="lbl" id="309err_out" data-ref="309err_out" data-ref-filename="309err_out">err_out</dfn>:</td></tr>
<tr><th id="1512">1512</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pml4e) = find_first_bit((new_pdps), (512)); (pml4e) &lt; (512); (pml4e) = find_next_bit((new_pdps), (512), (pml4e) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col7 ref" href="#307pml4e" title='pml4e' data-ref="307pml4e" data-ref-filename="307pml4e">pml4e</a>, <a class="local col3 ref" href="#1473" title='new_pdps' data-ref="303new_pdps" data-ref-filename="303new_pdps">new_pdps</a>, <a class="macro" href="i915_gem_gtt.h.html#100" title="512" data-ref="_M/GEN8_PML4ES_PER_PML4">GEN8_PML4ES_PER_PML4</a>)</td></tr>
<tr><th id="1513">1513</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_cleanup_3lvl" title='gen8_ppgtt_cleanup_3lvl' data-use='c' data-ref="gen8_ppgtt_cleanup_3lvl" data-ref-filename="gen8_ppgtt_cleanup_3lvl">gen8_ppgtt_cleanup_3lvl</a>(<a class="local col9 ref" href="#299vm" title='vm' data-ref="299vm" data-ref-filename="299vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col0 ref" href="#300pml4" title='pml4' data-ref="300pml4" data-ref-filename="300pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_pml4::pdps" title='i915_pml4::pdps' data-ref="i915_pml4::pdps" data-ref-filename="i915_pml4..pdps">pdps</a>[<a class="local col7 ref" href="#307pml4e" title='pml4e' data-ref="307pml4e" data-ref-filename="307pml4e">pml4e</a>]);</td></tr>
<tr><th id="1514">1514</th><td></td></tr>
<tr><th id="1515">1515</th><td>	<b>return</b> <a class="local col8 ref" href="#308ret" title='ret' data-ref="308ret" data-ref-filename="308ret">ret</a>;</td></tr>
<tr><th id="1516">1516</th><td>}</td></tr>
<tr><th id="1517">1517</th><td></td></tr>
<tr><th id="1518">1518</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_alloc_va_range" title='gen8_alloc_va_range' data-type='int gen8_alloc_va_range(struct i915_address_space * vm, uint64_t start, uint64_t length)' data-ref="gen8_alloc_va_range" data-ref-filename="gen8_alloc_va_range">gen8_alloc_va_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="310vm" title='vm' data-type='struct i915_address_space *' data-ref="310vm" data-ref-filename="310vm">vm</dfn>,</td></tr>
<tr><th id="1519">1519</th><td>			       <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="311start" title='start' data-type='uint64_t' data-ref="311start" data-ref-filename="311start">start</dfn>, <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="312length" title='length' data-type='uint64_t' data-ref="312length" data-ref-filename="312length">length</dfn>)</td></tr>
<tr><th id="1520">1520</th><td>{</td></tr>
<tr><th id="1521">1521</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col3 decl" id="313ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="313ppgtt" data-ref-filename="313ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1522">1522</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col0 ref" href="#310vm" title='vm' data-ref="310vm" data-ref-filename="310vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1523">1523</th><td></td></tr>
<tr><th id="1524">1524</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(vm-&gt;dev))</td></tr>
<tr><th id="1525">1525</th><td>		<b>return</b> <a class="tu ref fn" href="#gen8_alloc_va_range_4lvl" title='gen8_alloc_va_range_4lvl' data-use='c' data-ref="gen8_alloc_va_range_4lvl" data-ref-filename="gen8_alloc_va_range_4lvl">gen8_alloc_va_range_4lvl</a>(<a class="local col0 ref" href="#310vm" title='vm' data-ref="310vm" data-ref-filename="310vm">vm</a>, &amp;<a class="local col3 ref" href="#313ppgtt" title='ppgtt' data-ref="313ppgtt" data-ref-filename="313ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>, <a class="local col1 ref" href="#311start" title='start' data-ref="311start" data-ref-filename="311start">start</a>, <a class="local col2 ref" href="#312length" title='length' data-ref="312length" data-ref-filename="312length">length</a>);</td></tr>
<tr><th id="1526">1526</th><td>	<b>else</b></td></tr>
<tr><th id="1527">1527</th><td>		<b>return</b> <a class="tu ref fn" href="#gen8_alloc_va_range_3lvl" title='gen8_alloc_va_range_3lvl' data-use='c' data-ref="gen8_alloc_va_range_3lvl" data-ref-filename="gen8_alloc_va_range_3lvl">gen8_alloc_va_range_3lvl</a>(<a class="local col0 ref" href="#310vm" title='vm' data-ref="310vm" data-ref-filename="310vm">vm</a>, &amp;<a class="local col3 ref" href="#313ppgtt" title='ppgtt' data-ref="313ppgtt" data-ref-filename="313ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>, <a class="local col1 ref" href="#311start" title='start' data-ref="311start" data-ref-filename="311start">start</a>, <a class="local col2 ref" href="#312length" title='length' data-ref="312length" data-ref-filename="312length">length</a>);</td></tr>
<tr><th id="1528">1528</th><td>}</td></tr>
<tr><th id="1529">1529</th><td></td></tr>
<tr><th id="1530">1530</th><td><u>#<span data-ppcond="1530">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>		/* XXX debugfs */</u></td></tr>
<tr><th id="1531">1531</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_dump_pdp" title='gen8_dump_pdp' data-type='void gen8_dump_pdp(struct i915_page_directory_pointer * pdp, uint64_t start, uint64_t length, gen8_pte_t scratch_pte, struct seq_file * m)' data-ref="gen8_dump_pdp" data-ref-filename="gen8_dump_pdp">gen8_dump_pdp</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col4 decl" id="314pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="314pdp" data-ref-filename="314pdp">pdp</dfn>,</td></tr>
<tr><th id="1532">1532</th><td>			  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="315start" title='start' data-type='uint64_t' data-ref="315start" data-ref-filename="315start">start</dfn>, <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="316length" title='length' data-type='uint64_t' data-ref="316length" data-ref-filename="316length">length</dfn>,</td></tr>
<tr><th id="1533">1533</th><td>			  <a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col7 decl" id="317scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="317scratch_pte" data-ref-filename="317scratch_pte">scratch_pte</dfn>,</td></tr>
<tr><th id="1534">1534</th><td>			  <b>struct</b> <a class="local col9 type" href="#319seq_file" title='seq_file' data-ref="319seq_file" data-ref-filename="319seq_file">seq_file</a> *<dfn class="local col8 decl" id="318m" title='m' data-type='struct seq_file *' data-ref="318m" data-ref-filename="318m">m</dfn>)</td></tr>
<tr><th id="1535">1535</th><td>{</td></tr>
<tr><th id="1536">1536</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col0 decl" id="320pd" title='pd' data-type='struct i915_page_directory *' data-ref="320pd" data-ref-filename="320pd">pd</dfn>;</td></tr>
<tr><th id="1537">1537</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="321temp" title='temp' data-type='uint64_t' data-ref="321temp" data-ref-filename="321temp">temp</dfn>;</td></tr>
<tr><th id="1538">1538</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="322pdpe" title='pdpe' data-type='uint32_t' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</dfn>;</td></tr>
<tr><th id="1539">1539</th><td></td></tr>
<tr><th id="1540">1540</th><td>	<a class="macro" href="i915_gem_gtt.h.html#555" title="for (pdpe = gen8_pdpe_index(start); length &gt; 0 &amp;&amp; (pdpe &lt; ((i915.enable_ppgtt == 3) ? 512 : 4)) ? (pd = (pdp)-&gt;page_directory[pdpe]), 1 : 0; pdpe++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen8_for_each_pdpe">gen8_for_each_pdpe</a>(<a class="local col0 ref" href="#320pd" title='pd' data-ref="320pd" data-ref-filename="320pd">pd</a>, <a class="local col4 ref" href="#314pdp" title='pdp' data-ref="314pdp" data-ref-filename="314pdp">pdp</a>, <a class="local col5 ref" href="#315start" title='start' data-ref="315start" data-ref-filename="315start">start</a>, <a class="local col6 ref" href="#316length" title='length' data-ref="316length" data-ref-filename="316length">length</a>, temp, <a class="local col2 ref" href="#322pdpe" title='pdpe' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</a>) {</td></tr>
<tr><th id="1541">1541</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col3 decl" id="323pt" title='pt' data-type='struct i915_page_table *' data-ref="323pt" data-ref-filename="323pt">pt</dfn>;</td></tr>
<tr><th id="1542">1542</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="324pd_len" title='pd_len' data-type='uint64_t' data-ref="324pd_len" data-ref-filename="324pd_len">pd_len</dfn> = <a class="local col6 ref" href="#316length" title='length' data-ref="316length" data-ref-filename="316length">length</a>;</td></tr>
<tr><th id="1543">1543</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="325pd_start" title='pd_start' data-type='uint64_t' data-ref="325pd_start" data-ref-filename="325pd_start">pd_start</dfn> = <a class="local col5 ref" href="#315start" title='start' data-ref="315start" data-ref-filename="315start">start</a>;</td></tr>
<tr><th id="1544">1544</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="326pde" title='pde' data-type='uint32_t' data-ref="326pde" data-ref-filename="326pde">pde</dfn>;</td></tr>
<tr><th id="1545">1545</th><td></td></tr>
<tr><th id="1546">1546</th><td>		<b>if</b> (!<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col2 ref" href="#322pdpe" title='pdpe' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</a>, <a class="local col4 ref" href="#314pdp" title='pdp' data-ref="314pdp" data-ref-filename="314pdp">pdp</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a>))</td></tr>
<tr><th id="1547">1547</th><td>			<b>continue</b>;</td></tr>
<tr><th id="1548">1548</th><td></td></tr>
<tr><th id="1549">1549</th><td>		<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col8 ref" href="#318m" title='m' data-ref="318m" data-ref-filename="318m">m</a>, <q>"\tPDPE #%d\n"</q>, <a class="local col2 ref" href="#322pdpe" title='pdpe' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</a>);</td></tr>
<tr><th id="1550">1550</th><td>		<a class="macro" href="i915_gem_gtt.h.html#546" title="for (pde = gen8_pde_index(pd_start); pd_len &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - pd_start, temp = (( (temp)&lt;(pd_len))?(temp):(pd_len)), pd_start += temp, pd_len -= temp)" data-ref="_M/gen8_for_each_pde">gen8_for_each_pde</a>(<a class="local col3 ref" href="#323pt" title='pt' data-ref="323pt" data-ref-filename="323pt">pt</a>, <a class="local col0 ref" href="#320pd" title='pd' data-ref="320pd" data-ref-filename="320pd">pd</a>, <a class="local col5 ref" href="#325pd_start" title='pd_start' data-ref="325pd_start" data-ref-filename="325pd_start">pd_start</a>, <a class="local col4 ref" href="#324pd_len" title='pd_len' data-ref="324pd_len" data-ref-filename="324pd_len">pd_len</a>, temp, <a class="local col6 ref" href="#326pde" title='pde' data-ref="326pde" data-ref-filename="326pde">pde</a>) {</td></tr>
<tr><th id="1551">1551</th><td>			<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>  <dfn class="local col7 decl" id="327pte" title='pte' data-type='uint32_t' data-ref="327pte" data-ref-filename="327pte">pte</dfn>;</td></tr>
<tr><th id="1552">1552</th><td>			<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> *<dfn class="local col8 decl" id="328pt_vaddr" title='pt_vaddr' data-type='gen8_pte_t *' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</dfn>;</td></tr>
<tr><th id="1553">1553</th><td></td></tr>
<tr><th id="1554">1554</th><td>			<b>if</b> (!<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col6 ref" href="#326pde" title='pde' data-ref="326pde" data-ref-filename="326pde">pde</a>, <a class="local col0 ref" href="#320pd" title='pd' data-ref="320pd" data-ref-filename="320pd">pd</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::used_pdes" title='i915_page_directory::used_pdes' data-ref="i915_page_directory::used_pdes" data-ref-filename="i915_page_directory..used_pdes">used_pdes</a>))</td></tr>
<tr><th id="1555">1555</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1556">1556</th><td></td></tr>
<tr><th id="1557">1557</th><td>			<a class="local col8 ref" href="#328pt_vaddr" title='pt_vaddr' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(pt)-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col3 ref" href="#323pt" title='pt' data-ref="323pt" data-ref-filename="323pt">pt</a>);</td></tr>
<tr><th id="1558">1558</th><td>			<b>for</b> (<a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> = <var>0</var>; <a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> &lt; <a class="macro" href="i915_gem_gtt.h.html#112" title="((1 &lt;&lt; 12) / (sizeof(gen8_pte_t)))" data-ref="_M/GEN8_PTES">GEN8_PTES</a>; <a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> += <var>4</var>) {</td></tr>
<tr><th id="1559">1559</th><td>				<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="329va" title='va' data-type='uint64_t' data-ref="329va" data-ref-filename="329va">va</dfn> =</td></tr>
<tr><th id="1560">1560</th><td>					(<a class="local col2 ref" href="#322pdpe" title='pdpe' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</a> &lt;&lt; <a class="macro" href="i915_gem_gtt.h.html#103" title="30" data-ref="_M/GEN8_PDPE_SHIFT">GEN8_PDPE_SHIFT</a>) |</td></tr>
<tr><th id="1561">1561</th><td>					(<a class="local col6 ref" href="#326pde" title='pde' data-ref="326pde" data-ref-filename="326pde">pde</a> &lt;&lt; <a class="macro" href="i915_gem_gtt.h.html#107" title="21" data-ref="_M/GEN8_PDE_SHIFT">GEN8_PDE_SHIFT</a>) |</td></tr>
<tr><th id="1562">1562</th><td>					(<a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> &lt;&lt; <a class="macro" href="i915_gem_gtt.h.html#109" title="12" data-ref="_M/GEN8_PTE_SHIFT">GEN8_PTE_SHIFT</a>);</td></tr>
<tr><th id="1563">1563</th><td>				<em>int</em> <dfn class="local col0 decl" id="330i" title='i' data-type='int' data-ref="330i" data-ref-filename="330i">i</dfn>;</td></tr>
<tr><th id="1564">1564</th><td>				<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col1 decl" id="331found" title='found' data-type='_Bool' data-ref="331found" data-ref-filename="331found">found</dfn> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="1565">1565</th><td></td></tr>
<tr><th id="1566">1566</th><td>				<b>for</b> (<a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a> = <var>0</var>; <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a> &lt; <var>4</var>; <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a>++)</td></tr>
<tr><th id="1567">1567</th><td>					<b>if</b> (<a class="local col8 ref" href="#328pt_vaddr" title='pt_vaddr' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</a>[<a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> + <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a>] != <a class="local col7 ref" href="#317scratch_pte" title='scratch_pte' data-ref="317scratch_pte" data-ref-filename="317scratch_pte">scratch_pte</a>)</td></tr>
<tr><th id="1568">1568</th><td>						<a class="local col1 ref" href="#331found" title='found' data-ref="331found" data-ref-filename="331found">found</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="1569">1569</th><td>				<b>if</b> (!<a class="local col1 ref" href="#331found" title='found' data-ref="331found" data-ref-filename="331found">found</a>)</td></tr>
<tr><th id="1570">1570</th><td>					<b>continue</b>;</td></tr>
<tr><th id="1571">1571</th><td></td></tr>
<tr><th id="1572">1572</th><td>				<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col8 ref" href="#318m" title='m' data-ref="318m" data-ref-filename="318m">m</a>, <q>"\t\t0x%llx [%03d,%03d,%04d]: ="</q>, <a class="local col9 ref" href="#329va" title='va' data-ref="329va" data-ref-filename="329va">va</a>, <a class="local col2 ref" href="#322pdpe" title='pdpe' data-ref="322pdpe" data-ref-filename="322pdpe">pdpe</a>, <a class="local col6 ref" href="#326pde" title='pde' data-ref="326pde" data-ref-filename="326pde">pde</a>, <a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a>);</td></tr>
<tr><th id="1573">1573</th><td>				<b>for</b> (<a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a> = <var>0</var>; <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a> &lt; <var>4</var>; <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a>++) {</td></tr>
<tr><th id="1574">1574</th><td>					<b>if</b> (<a class="local col8 ref" href="#328pt_vaddr" title='pt_vaddr' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</a>[<a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> + <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a>] != <a class="local col7 ref" href="#317scratch_pte" title='scratch_pte' data-ref="317scratch_pte" data-ref-filename="317scratch_pte">scratch_pte</a>)</td></tr>
<tr><th id="1575">1575</th><td>						<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col8 ref" href="#318m" title='m' data-ref="318m" data-ref-filename="318m">m</a>, <q>" %llx"</q>, <a class="local col8 ref" href="#328pt_vaddr" title='pt_vaddr' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</a>[<a class="local col7 ref" href="#327pte" title='pte' data-ref="327pte" data-ref-filename="327pte">pte</a> + <a class="local col0 ref" href="#330i" title='i' data-ref="330i" data-ref-filename="330i">i</a>]);</td></tr>
<tr><th id="1576">1576</th><td>					<b>else</b></td></tr>
<tr><th id="1577">1577</th><td>						<a class="ref fn" href="#1577" title='seq_puts' data-ref="seq_puts" data-ref-filename="seq_puts">seq_puts</a>(<a class="local col8 ref" href="#318m" title='m' data-ref="318m" data-ref-filename="318m">m</a>, <q>"  SCRATCH "</q>);</td></tr>
<tr><th id="1578">1578</th><td>				}</td></tr>
<tr><th id="1579">1579</th><td>				<a class="ref fn" href="#1577" title='seq_puts' data-ref="seq_puts" data-ref-filename="seq_puts">seq_puts</a>(<a class="local col8 ref" href="#318m" title='m' data-ref="318m" data-ref-filename="318m">m</a>, <q>"\n"</q>);</td></tr>
<tr><th id="1580">1580</th><td>			}</td></tr>
<tr><th id="1581">1581</th><td>			<i>/* don't use kunmap_px, it could trigger</i></td></tr>
<tr><th id="1582">1582</th><td><i>			 * an unnecessary flush.</i></td></tr>
<tr><th id="1583">1583</th><td><i>			 */</i></td></tr>
<tr><th id="1584">1584</th><td>			<a class="macro" href="../../../include/linux/highmem.h.html#47" title="linux_kunmap_atomic(pt_vaddr)" data-ref="_M/kunmap_atomic">kunmap_atomic</a>(<a class="local col8 ref" href="#328pt_vaddr" title='pt_vaddr' data-ref="328pt_vaddr" data-ref-filename="328pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="1585">1585</th><td>		}</td></tr>
<tr><th id="1586">1586</th><td>	}</td></tr>
<tr><th id="1587">1587</th><td>}</td></tr>
<tr><th id="1588">1588</th><td></td></tr>
<tr><th id="1589">1589</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_dump_ppgtt" title='gen8_dump_ppgtt' data-type='void gen8_dump_ppgtt(struct i915_hw_ppgtt * ppgtt, struct seq_file * m)' data-ref="gen8_dump_ppgtt" data-ref-filename="gen8_dump_ppgtt">gen8_dump_ppgtt</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col2 decl" id="332ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</dfn>, <b>struct</b> <a class="local col4 type" href="#334seq_file" title='seq_file' data-ref="334seq_file" data-ref-filename="334seq_file">seq_file</a> *<dfn class="local col3 decl" id="333m" title='m' data-type='struct seq_file *' data-ref="333m" data-ref-filename="333m">m</dfn>)</td></tr>
<tr><th id="1590">1590</th><td>{</td></tr>
<tr><th id="1591">1591</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col5 decl" id="335vm" title='vm' data-type='struct i915_address_space *' data-ref="335vm" data-ref-filename="335vm">vm</dfn> = &amp;<a class="local col2 ref" href="#332ppgtt" title='ppgtt' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>;</td></tr>
<tr><th id="1592">1592</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="336start" title='start' data-type='uint64_t' data-ref="336start" data-ref-filename="336start">start</dfn> = <a class="local col2 ref" href="#332ppgtt" title='ppgtt' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a>;</td></tr>
<tr><th id="1593">1593</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="337length" title='length' data-type='uint64_t' data-ref="337length" data-ref-filename="337length">length</dfn> = <a class="local col2 ref" href="#332ppgtt" title='ppgtt' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>;</td></tr>
<tr><th id="1594">1594</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col8 decl" id="338scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="338scratch_pte" data-ref-filename="338scratch_pte">scratch_pte</dfn> = <a class="tu ref fn" href="#gen8_pte_encode" title='gen8_pte_encode' data-use='c' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col5 ref" href="#335vm" title='vm' data-ref="335vm" data-ref-filename="335vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="1595">1595</th><td>						 <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="1596">1596</th><td></td></tr>
<tr><th id="1597">1597</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(vm-&gt;dev)) {</td></tr>
<tr><th id="1598">1598</th><td>		<a class="tu ref fn" href="#gen8_dump_pdp" title='gen8_dump_pdp' data-use='c' data-ref="gen8_dump_pdp" data-ref-filename="gen8_dump_pdp">gen8_dump_pdp</a>(&amp;<a class="local col2 ref" href="#332ppgtt" title='ppgtt' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>, <a class="local col6 ref" href="#336start" title='start' data-ref="336start" data-ref-filename="336start">start</a>, <a class="local col7 ref" href="#337length" title='length' data-ref="337length" data-ref-filename="337length">length</a>, <a class="local col8 ref" href="#338scratch_pte" title='scratch_pte' data-ref="338scratch_pte" data-ref-filename="338scratch_pte">scratch_pte</a>, <a class="local col3 ref" href="#333m" title='m' data-ref="333m" data-ref-filename="333m">m</a>);</td></tr>
<tr><th id="1599">1599</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1600">1600</th><td>		<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col9 decl" id="339templ4" title='templ4' data-type='uint64_t' data-ref="339templ4" data-ref-filename="339templ4">templ4</dfn>, <dfn class="local col0 decl" id="340pml4e" title='pml4e' data-type='uint64_t' data-ref="340pml4e" data-ref-filename="340pml4e">pml4e</dfn>;</td></tr>
<tr><th id="1601">1601</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_pml4" title='i915_pml4' data-ref="i915_pml4" data-ref-filename="i915_pml4">i915_pml4</a> *<dfn class="local col1 decl" id="341pml4" title='pml4' data-type='struct i915_pml4 *' data-ref="341pml4" data-ref-filename="341pml4">pml4</dfn> = &amp;<a class="local col2 ref" href="#332ppgtt" title='ppgtt' data-ref="332ppgtt" data-ref-filename="332ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>;</td></tr>
<tr><th id="1602">1602</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory_pointer" title='i915_page_directory_pointer' data-ref="i915_page_directory_pointer" data-ref-filename="i915_page_directory_pointer">i915_page_directory_pointer</a> *<dfn class="local col2 decl" id="342pdp" title='pdp' data-type='struct i915_page_directory_pointer *' data-ref="342pdp" data-ref-filename="342pdp">pdp</dfn>;</td></tr>
<tr><th id="1603">1603</th><td></td></tr>
<tr><th id="1604">1604</th><td>		<a class="macro" href="i915_gem_gtt.h.html#564" title="for (pml4e = gen8_pml4e_index(start); length &gt; 0 &amp;&amp; pml4e &lt; 512 ? (pdp = (pml4)-&gt;pdps[pml4e]), 1 : 0; pml4e++, templ4 = ALIGN - start, templ4 = (( (templ4)&lt;(length))?(templ4):(length)), start += templ4, length -= templ4)" data-ref="_M/gen8_for_each_pml4e">gen8_for_each_pml4e</a>(<a class="local col2 ref" href="#342pdp" title='pdp' data-ref="342pdp" data-ref-filename="342pdp">pdp</a>, <a class="local col1 ref" href="#341pml4" title='pml4' data-ref="341pml4" data-ref-filename="341pml4">pml4</a>, <a class="local col6 ref" href="#336start" title='start' data-ref="336start" data-ref-filename="336start">start</a>, <a class="local col7 ref" href="#337length" title='length' data-ref="337length" data-ref-filename="337length">length</a>, templ4, <a class="local col0 ref" href="#340pml4e" title='pml4e' data-ref="340pml4e" data-ref-filename="340pml4e">pml4e</a>) {</td></tr>
<tr><th id="1605">1605</th><td>			<b>if</b> (!<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#test_bit" title='test_bit' data-ref="test_bit" data-ref-filename="test_bit">test_bit</a>(<a class="local col0 ref" href="#340pml4e" title='pml4e' data-ref="340pml4e" data-ref-filename="340pml4e">pml4e</a>, <a class="local col1 ref" href="#341pml4" title='pml4' data-ref="341pml4" data-ref-filename="341pml4">pml4</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#290" title='i915_pml4::used_pml4es' data-ref="i915_pml4::used_pml4es" data-ref-filename="i915_pml4..used_pml4es">used_pml4es</a>))</td></tr>
<tr><th id="1606">1606</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1607">1607</th><td></td></tr>
<tr><th id="1608">1608</th><td>			<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col3 ref" href="#333m" title='m' data-ref="333m" data-ref-filename="333m">m</a>, <q>"    PML4E #%llu\n"</q>, <a class="local col0 ref" href="#340pml4e" title='pml4e' data-ref="340pml4e" data-ref-filename="340pml4e">pml4e</a>);</td></tr>
<tr><th id="1609">1609</th><td>			<a class="tu ref fn" href="#gen8_dump_pdp" title='gen8_dump_pdp' data-use='c' data-ref="gen8_dump_pdp" data-ref-filename="gen8_dump_pdp">gen8_dump_pdp</a>(<a class="local col2 ref" href="#342pdp" title='pdp' data-ref="342pdp" data-ref-filename="342pdp">pdp</a>, <a class="local col6 ref" href="#336start" title='start' data-ref="336start" data-ref-filename="336start">start</a>, <a class="local col7 ref" href="#337length" title='length' data-ref="337length" data-ref-filename="337length">length</a>, <a class="local col8 ref" href="#338scratch_pte" title='scratch_pte' data-ref="338scratch_pte" data-ref-filename="338scratch_pte">scratch_pte</a>, <a class="local col3 ref" href="#333m" title='m' data-ref="333m" data-ref-filename="333m">m</a>);</td></tr>
<tr><th id="1610">1610</th><td>		}</td></tr>
<tr><th id="1611">1611</th><td>	}</td></tr>
<tr><th id="1612">1612</th><td>}</td></tr>
<tr><th id="1613">1613</th><td><u>#<span data-ppcond="1530">endif</span></u></td></tr>
<tr><th id="1614">1614</th><td></td></tr>
<tr><th id="1615">1615</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_preallocate_top_level_pdps" title='gen8_preallocate_top_level_pdps' data-type='int gen8_preallocate_top_level_pdps(struct i915_hw_ppgtt * ppgtt)' data-ref="gen8_preallocate_top_level_pdps" data-ref-filename="gen8_preallocate_top_level_pdps">gen8_preallocate_top_level_pdps</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col3 decl" id="343ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="343ppgtt" data-ref-filename="343ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="1616">1616</th><td>{</td></tr>
<tr><th id="1617">1617</th><td>	<em>unsigned</em> <em>long</em> *<dfn class="local col4 decl" id="344new_page_dirs" title='new_page_dirs' data-type='unsigned long *' data-ref="344new_page_dirs" data-ref-filename="344new_page_dirs">new_page_dirs</dfn>, *<dfn class="local col5 decl" id="345new_page_tables" title='new_page_tables' data-type='unsigned long *' data-ref="345new_page_tables" data-ref-filename="345new_page_tables">new_page_tables</dfn>;</td></tr>
<tr><th id="1618">1618</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="346pdpes" title='pdpes' data-type='uint32_t' data-ref="346pdpes" data-ref-filename="346pdpes">pdpes</dfn> = <a class="macro" href="i915_gem_gtt.h.html#114" title="((i915.enable_ppgtt == 3) ? 512 : 4)" data-ref="_M/I915_PDPES_PER_PDP">I915_PDPES_PER_PDP</a>(dev);</td></tr>
<tr><th id="1619">1619</th><td>	<em>int</em> <dfn class="local col7 decl" id="347ret" title='ret' data-type='int' data-ref="347ret" data-ref-filename="347ret">ret</dfn>;</td></tr>
<tr><th id="1620">1620</th><td></td></tr>
<tr><th id="1621">1621</th><td>	<i>/* We allocate temp bitmap for page tables for no gain</i></td></tr>
<tr><th id="1622">1622</th><td><i>	 * but as this is for init only, lets keep the things simple</i></td></tr>
<tr><th id="1623">1623</th><td><i>	 */</i></td></tr>
<tr><th id="1624">1624</th><td>	<a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a> = <a class="tu ref fn" href="#alloc_gen8_temp_bitmaps" title='alloc_gen8_temp_bitmaps' data-use='c' data-ref="alloc_gen8_temp_bitmaps" data-ref-filename="alloc_gen8_temp_bitmaps">alloc_gen8_temp_bitmaps</a>(&amp;<a class="local col4 ref" href="#344new_page_dirs" title='new_page_dirs' data-ref="344new_page_dirs" data-ref-filename="344new_page_dirs">new_page_dirs</a>, &amp;<a class="local col5 ref" href="#345new_page_tables" title='new_page_tables' data-ref="345new_page_tables" data-ref-filename="345new_page_tables">new_page_tables</a>, <a class="local col6 ref" href="#346pdpes" title='pdpes' data-ref="346pdpes" data-ref-filename="346pdpes">pdpes</a>);</td></tr>
<tr><th id="1625">1625</th><td>	<b>if</b> (<a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a>)</td></tr>
<tr><th id="1626">1626</th><td>		<b>return</b> <a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a>;</td></tr>
<tr><th id="1627">1627</th><td></td></tr>
<tr><th id="1628">1628</th><td>	<i>/* Allocate for all pdps regardless of how the ppgtt</i></td></tr>
<tr><th id="1629">1629</th><td><i>	 * was defined.</i></td></tr>
<tr><th id="1630">1630</th><td><i>	 */</i></td></tr>
<tr><th id="1631">1631</th><td>	<a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a> = <a class="tu ref fn" href="#gen8_ppgtt_alloc_page_directories" title='gen8_ppgtt_alloc_page_directories' data-use='c' data-ref="gen8_ppgtt_alloc_page_directories" data-ref-filename="gen8_ppgtt_alloc_page_directories">gen8_ppgtt_alloc_page_directories</a>(&amp;<a class="local col3 ref" href="#343ppgtt" title='ppgtt' data-ref="343ppgtt" data-ref-filename="343ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, &amp;<a class="local col3 ref" href="#343ppgtt" title='ppgtt' data-ref="343ppgtt" data-ref-filename="343ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>,</td></tr>
<tr><th id="1632">1632</th><td>						<var>0</var>, <var>1ULL</var> &lt;&lt; <var>32</var>,</td></tr>
<tr><th id="1633">1633</th><td>						<a class="local col4 ref" href="#344new_page_dirs" title='new_page_dirs' data-ref="344new_page_dirs" data-ref-filename="344new_page_dirs">new_page_dirs</a>);</td></tr>
<tr><th id="1634">1634</th><td>	<b>if</b> (!<a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a>)</td></tr>
<tr><th id="1635">1635</th><td>		*<a class="local col3 ref" href="#343ppgtt" title='ppgtt' data-ref="343ppgtt" data-ref-filename="343ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory_pointer::used_pdpes" title='i915_page_directory_pointer::used_pdpes' data-ref="i915_page_directory_pointer::used_pdpes" data-ref-filename="i915_page_directory_pointer..used_pdpes">used_pdpes</a> = *<a class="local col4 ref" href="#344new_page_dirs" title='new_page_dirs' data-ref="344new_page_dirs" data-ref-filename="344new_page_dirs">new_page_dirs</a>;</td></tr>
<tr><th id="1636">1636</th><td></td></tr>
<tr><th id="1637">1637</th><td>	<a class="tu ref fn" href="#free_gen8_temp_bitmaps" title='free_gen8_temp_bitmaps' data-use='c' data-ref="free_gen8_temp_bitmaps" data-ref-filename="free_gen8_temp_bitmaps">free_gen8_temp_bitmaps</a>(<a class="local col4 ref" href="#344new_page_dirs" title='new_page_dirs' data-ref="344new_page_dirs" data-ref-filename="344new_page_dirs">new_page_dirs</a>, <a class="local col5 ref" href="#345new_page_tables" title='new_page_tables' data-ref="345new_page_tables" data-ref-filename="345new_page_tables">new_page_tables</a>);</td></tr>
<tr><th id="1638">1638</th><td></td></tr>
<tr><th id="1639">1639</th><td>	<b>return</b> <a class="local col7 ref" href="#347ret" title='ret' data-ref="347ret" data-ref-filename="347ret">ret</a>;</td></tr>
<tr><th id="1640">1640</th><td>}</td></tr>
<tr><th id="1641">1641</th><td></td></tr>
<tr><th id="1642">1642</th><td><i  data-doc="gen8_ppgtt_init">/*</i></td></tr>
<tr><th id="1643">1643</th><td><i  data-doc="gen8_ppgtt_init"> * GEN8 legacy ppgtt programming is accomplished through a max 4 PDP registers</i></td></tr>
<tr><th id="1644">1644</th><td><i  data-doc="gen8_ppgtt_init"> * with a net effect resembling a 2-level page table in normal x86 terms. Each</i></td></tr>
<tr><th id="1645">1645</th><td><i  data-doc="gen8_ppgtt_init"> * PDP represents 1GB of memory 4 * 512 * 512 * 4096 = 4GB legacy 32b address</i></td></tr>
<tr><th id="1646">1646</th><td><i  data-doc="gen8_ppgtt_init"> * space.</i></td></tr>
<tr><th id="1647">1647</th><td><i  data-doc="gen8_ppgtt_init"> *</i></td></tr>
<tr><th id="1648">1648</th><td><i  data-doc="gen8_ppgtt_init"> */</i></td></tr>
<tr><th id="1649">1649</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_ppgtt_init" title='gen8_ppgtt_init' data-type='int gen8_ppgtt_init(struct i915_hw_ppgtt * ppgtt)' data-ref="gen8_ppgtt_init" data-ref-filename="gen8_ppgtt_init">gen8_ppgtt_init</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col8 decl" id="348ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="1650">1650</th><td>{</td></tr>
<tr><th id="1651">1651</th><td>	<em>int</em> <dfn class="local col9 decl" id="349ret" title='ret' data-type='int' data-ref="349ret" data-ref-filename="349ret">ret</dfn>;</td></tr>
<tr><th id="1652">1652</th><td></td></tr>
<tr><th id="1653">1653</th><td>	<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a> = <a class="tu ref fn" href="#gen8_init_scratch" title='gen8_init_scratch' data-use='c' data-ref="gen8_init_scratch" data-ref-filename="gen8_init_scratch">gen8_init_scratch</a>(&amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1654">1654</th><td>	<b>if</b> (<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>)</td></tr>
<tr><th id="1655">1655</th><td>		<b>return</b> <a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>;</td></tr>
<tr><th id="1656">1656</th><td></td></tr>
<tr><th id="1657">1657</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a> = <var>0</var>;</td></tr>
<tr><th id="1658">1658</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a> = <a class="tu ref fn" href="#gen8_ppgtt_cleanup" title='gen8_ppgtt_cleanup' data-use='r' data-ref="gen8_ppgtt_cleanup" data-ref-filename="gen8_ppgtt_cleanup">gen8_ppgtt_cleanup</a>;</td></tr>
<tr><th id="1659">1659</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a> = <a class="tu ref fn" href="#gen8_alloc_va_range" title='gen8_alloc_va_range' data-use='r' data-ref="gen8_alloc_va_range" data-ref-filename="gen8_alloc_va_range">gen8_alloc_va_range</a>;</td></tr>
<tr><th id="1660">1660</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a> = <a class="tu ref fn" href="#gen8_ppgtt_insert_entries" title='gen8_ppgtt_insert_entries' data-use='r' data-ref="gen8_ppgtt_insert_entries" data-ref-filename="gen8_ppgtt_insert_entries">gen8_ppgtt_insert_entries</a>;</td></tr>
<tr><th id="1661">1661</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a> = <a class="tu ref fn" href="#gen8_ppgtt_clear_range" title='gen8_ppgtt_clear_range' data-use='r' data-ref="gen8_ppgtt_clear_range" data-ref-filename="gen8_ppgtt_clear_range">gen8_ppgtt_clear_range</a>;</td></tr>
<tr><th id="1662">1662</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::unbind_vma" title='i915_address_space::unbind_vma' data-ref="i915_address_space::unbind_vma" data-ref-filename="i915_address_space..unbind_vma">unbind_vma</a> = <a class="tu ref fn" href="#ppgtt_unbind_vma" title='ppgtt_unbind_vma' data-use='r' data-ref="ppgtt_unbind_vma" data-ref-filename="ppgtt_unbind_vma">ppgtt_unbind_vma</a>;</td></tr>
<tr><th id="1663">1663</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::bind_vma" title='i915_address_space::bind_vma' data-ref="i915_address_space::bind_vma" data-ref-filename="i915_address_space..bind_vma">bind_vma</a> = <a class="tu ref fn" href="#ppgtt_bind_vma" title='ppgtt_bind_vma' data-use='r' data-ref="ppgtt_bind_vma" data-ref-filename="ppgtt_bind_vma">ppgtt_bind_vma</a>;</td></tr>
<tr><th id="1664">1664</th><td><u>#<span data-ppcond="1664">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>		/* XXX debugfs */</u></td></tr>
<tr><th id="1665">1665</th><td>	<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::debug_dump" title='i915_hw_ppgtt::debug_dump' data-ref="i915_hw_ppgtt::debug_dump" data-ref-filename="i915_hw_ppgtt..debug_dump">debug_dump</a> = <a class="tu ref fn" href="#gen8_dump_ppgtt" title='gen8_dump_ppgtt' data-use='r' data-ref="gen8_dump_ppgtt" data-ref-filename="gen8_dump_ppgtt">gen8_dump_ppgtt</a>;</td></tr>
<tr><th id="1666">1666</th><td><u>#<span data-ppcond="1664">endif</span></u></td></tr>
<tr><th id="1667">1667</th><td></td></tr>
<tr><th id="1668">1668</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(ppgtt-&gt;base.dev)) {</td></tr>
<tr><th id="1669">1669</th><td>		<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a> = <a class="macro" href="#437" title="setup_page_dma((ppgtt-&gt;base.dev), (&amp;(&amp;ppgtt-&gt;pml4)-&gt;base))" data-ref="_M/setup_px">setup_px</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, &amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>);</td></tr>
<tr><th id="1670">1670</th><td>		<b>if</b> (<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>)</td></tr>
<tr><th id="1671">1671</th><td>			<b>goto</b> <a class="lbl" href="#350free_scratch" data-ref="350free_scratch" data-ref-filename="350free_scratch">free_scratch</a>;</td></tr>
<tr><th id="1672">1672</th><td></td></tr>
<tr><th id="1673">1673</th><td>		<a class="tu ref fn" href="#gen8_initialize_pml4" title='gen8_initialize_pml4' data-use='c' data-ref="gen8_initialize_pml4" data-ref-filename="gen8_initialize_pml4">gen8_initialize_pml4</a>(&amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, &amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pml4" title='i915_hw_ppgtt::(anonymous union)::pml4' data-ref="i915_hw_ppgtt::(anonymous)::pml4" data-ref-filename="i915_hw_ppgtt..(anonymous)..pml4">pml4</a>);</td></tr>
<tr><th id="1674">1674</th><td></td></tr>
<tr><th id="1675">1675</th><td>		<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> = <var>1ULL</var> &lt;&lt; <var>48</var>;</td></tr>
<tr><th id="1676">1676</th><td>		<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#gen8_48b_mm_switch" title='gen8_48b_mm_switch' data-use='r' data-ref="gen8_48b_mm_switch" data-ref-filename="gen8_48b_mm_switch">gen8_48b_mm_switch</a>;</td></tr>
<tr><th id="1677">1677</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1678">1678</th><td>		<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a> = <a class="tu ref fn" href="#__pdp_init" title='__pdp_init' data-use='c' data-ref="__pdp_init" data-ref-filename="__pdp_init">__pdp_init</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, &amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pdp" title='i915_hw_ppgtt::(anonymous union)::pdp' data-ref="i915_hw_ppgtt::(anonymous)::pdp" data-ref-filename="i915_hw_ppgtt..(anonymous)..pdp">pdp</a>);</td></tr>
<tr><th id="1679">1679</th><td>		<b>if</b> (<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>)</td></tr>
<tr><th id="1680">1680</th><td>			<b>goto</b> <a class="lbl" href="#350free_scratch" data-ref="350free_scratch" data-ref-filename="350free_scratch">free_scratch</a>;</td></tr>
<tr><th id="1681">1681</th><td></td></tr>
<tr><th id="1682">1682</th><td>		<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> = <var>1ULL</var> &lt;&lt; <var>32</var>;</td></tr>
<tr><th id="1683">1683</th><td>		<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#gen8_legacy_mm_switch" title='gen8_legacy_mm_switch' data-use='r' data-ref="gen8_legacy_mm_switch" data-ref-filename="gen8_legacy_mm_switch">gen8_legacy_mm_switch</a>;</td></tr>
<tr><th id="1684">1684</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_directory_pointer_entry_alloc" title='trace_i915_page_directory_pointer_entry_alloc' data-ref="trace_i915_page_directory_pointer_entry_alloc" data-ref-filename="trace_i915_page_directory_pointer_entry_alloc">trace_i915_page_directory_pointer_entry_alloc</a>(&amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>,</td></tr>
<tr><th id="1685">1685</th><td>							      <var>0</var>, <var>0</var>,</td></tr>
<tr><th id="1686">1686</th><td>							      <a class="macro" href="i915_gem_gtt.h.html#101" title="39" data-ref="_M/GEN8_PML4E_SHIFT">GEN8_PML4E_SHIFT</a>);</td></tr>
<tr><th id="1687">1687</th><td></td></tr>
<tr><th id="1688">1688</th><td>		<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>)) {</td></tr>
<tr><th id="1689">1689</th><td>			<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a> = <a class="tu ref fn" href="#gen8_preallocate_top_level_pdps" title='gen8_preallocate_top_level_pdps' data-use='c' data-ref="gen8_preallocate_top_level_pdps" data-ref-filename="gen8_preallocate_top_level_pdps">gen8_preallocate_top_level_pdps</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>);</td></tr>
<tr><th id="1690">1690</th><td>			<b>if</b> (<a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>)</td></tr>
<tr><th id="1691">1691</th><td>				<b>goto</b> <a class="lbl" href="#350free_scratch" data-ref="350free_scratch" data-ref-filename="350free_scratch">free_scratch</a>;</td></tr>
<tr><th id="1692">1692</th><td>		}</td></tr>
<tr><th id="1693">1693</th><td>	}</td></tr>
<tr><th id="1694">1694</th><td></td></tr>
<tr><th id="1695">1695</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>))</td></tr>
<tr><th id="1696">1696</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_notify_vgt" title='gen8_ppgtt_notify_vgt' data-use='c' data-ref="gen8_ppgtt_notify_vgt" data-ref-filename="gen8_ppgtt_notify_vgt">gen8_ppgtt_notify_vgt</a>(<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="1697">1697</th><td></td></tr>
<tr><th id="1698">1698</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1699">1699</th><td></td></tr>
<tr><th id="1700">1700</th><td><dfn class="lbl" id="350free_scratch" data-ref="350free_scratch" data-ref-filename="350free_scratch">free_scratch</dfn>:</td></tr>
<tr><th id="1701">1701</th><td>	<a class="tu ref fn" href="#gen8_free_scratch" title='gen8_free_scratch' data-use='c' data-ref="gen8_free_scratch" data-ref-filename="gen8_free_scratch">gen8_free_scratch</a>(&amp;<a class="local col8 ref" href="#348ppgtt" title='ppgtt' data-ref="348ppgtt" data-ref-filename="348ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1702">1702</th><td>	<b>return</b> <a class="local col9 ref" href="#349ret" title='ret' data-ref="349ret" data-ref-filename="349ret">ret</a>;</td></tr>
<tr><th id="1703">1703</th><td>}</td></tr>
<tr><th id="1704">1704</th><td></td></tr>
<tr><th id="1705">1705</th><td><u>#<span data-ppcond="1705">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>		/* XXX debugfs */</u></td></tr>
<tr><th id="1706">1706</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_dump_ppgtt" title='gen6_dump_ppgtt' data-type='void gen6_dump_ppgtt(struct i915_hw_ppgtt * ppgtt, struct seq_file * m)' data-ref="gen6_dump_ppgtt" data-ref-filename="gen6_dump_ppgtt">gen6_dump_ppgtt</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="351ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</dfn>, <b>struct</b> <a class="local col3 type" href="#353seq_file" title='seq_file' data-ref="353seq_file" data-ref-filename="353seq_file">seq_file</a> *<dfn class="local col2 decl" id="352m" title='m' data-type='struct seq_file *' data-ref="352m" data-ref-filename="352m">m</dfn>)</td></tr>
<tr><th id="1707">1707</th><td>{</td></tr>
<tr><th id="1708">1708</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col4 decl" id="354vm" title='vm' data-type='struct i915_address_space *' data-ref="354vm" data-ref-filename="354vm">vm</dfn> = &amp;<a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>;</td></tr>
<tr><th id="1709">1709</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col5 decl" id="355unused" title='unused' data-type='struct i915_page_table *' data-ref="355unused" data-ref-filename="355unused">unused</dfn>;</td></tr>
<tr><th id="1710">1710</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col6 decl" id="356scratch_pte" title='scratch_pte' data-type='gen6_pte_t' data-ref="356scratch_pte" data-ref-filename="356scratch_pte">scratch_pte</dfn>;</td></tr>
<tr><th id="1711">1711</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="357pd_entry" title='pd_entry' data-type='uint32_t' data-ref="357pd_entry" data-ref-filename="357pd_entry">pd_entry</dfn>;</td></tr>
<tr><th id="1712">1712</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a>  <dfn class="local col8 decl" id="358pte" title='pte' data-type='uint32_t' data-ref="358pte" data-ref-filename="358pte">pte</dfn>, <dfn class="local col9 decl" id="359pde" title='pde' data-type='uint32_t' data-ref="359pde" data-ref-filename="359pde">pde</dfn>, <dfn class="local col0 decl" id="360temp" title='temp' data-type='uint32_t' data-ref="360temp" data-ref-filename="360temp">temp</dfn>;</td></tr>
<tr><th id="1713">1713</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col1 decl" id="361start" title='start' data-type='uint32_t' data-ref="361start" data-ref-filename="361start">start</dfn> = <a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a>, <dfn class="local col2 decl" id="362length" title='length' data-type='uint32_t' data-ref="362length" data-ref-filename="362length">length</dfn> = <a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>;</td></tr>
<tr><th id="1714">1714</th><td></td></tr>
<tr><th id="1715">1715</th><td>	<a class="local col6 ref" href="#356scratch_pte" title='scratch_pte' data-ref="356scratch_pte" data-ref-filename="356scratch_pte">scratch_pte</a> = <a class="local col4 ref" href="#354vm" title='vm' data-ref="354vm" data-ref-filename="354vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col4 ref" href="#354vm" title='vm' data-ref="354vm" data-ref-filename="354vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="1716">1716</th><td>				     <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, <var>0</var>);</td></tr>
<tr><th id="1717">1717</th><td></td></tr>
<tr><th id="1718">1718</th><td>	<a class="macro" href="i915_gem_gtt.h.html#449" title="for (pde = gen6_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (unused = (&amp;ppgtt-&gt;pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen6_for_each_pde">gen6_for_each_pde</a>(<a class="local col5 ref" href="#355unused" title='unused' data-ref="355unused" data-ref-filename="355unused">unused</a>, &amp;<a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <a class="local col1 ref" href="#361start" title='start' data-ref="361start" data-ref-filename="361start">start</a>, <a class="local col2 ref" href="#362length" title='length' data-ref="362length" data-ref-filename="362length">length</a>, temp, <a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a>) {</td></tr>
<tr><th id="1719">1719</th><td>		<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col3 decl" id="363expected" title='expected' data-type='u32' data-ref="363expected" data-ref-filename="363expected">expected</dfn>;</td></tr>
<tr><th id="1720">1720</th><td>		<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> *<dfn class="local col4 decl" id="364pt_vaddr" title='pt_vaddr' data-type='gen6_pte_t *' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</dfn>;</td></tr>
<tr><th id="1721">1721</th><td>		<em>const</em> <a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col5 decl" id="365pt_addr" title='pt_addr' data-type='const dma_addr_t' data-ref="365pt_addr" data-ref-filename="365pt_addr">pt_addr</dfn> = <a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(ppgtt-&gt;pd.page_table[pde])-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a>]);</td></tr>
<tr><th id="1722">1722</th><td>		pd_entry = readl(ppgtt-&gt;<span class='error' title="no member named &apos;pd_addr&apos; in &apos;struct i915_hw_ppgtt&apos;">pd_addr</span> + pde);</td></tr>
<tr><th id="1723">1723</th><td>		<a class="local col3 ref" href="#363expected" title='expected' data-ref="363expected" data-ref-filename="363expected">expected</a> = (<a class="macro" href="i915_gem_gtt.h.html#53" title="((pt_addr) | (((pt_addr) &gt;&gt; 28) &amp; 0xff0))" data-ref="_M/GEN6_PDE_ADDR_ENCODE">GEN6_PDE_ADDR_ENCODE</a>(<a class="local col5 ref" href="#365pt_addr" title='pt_addr' data-ref="365pt_addr" data-ref-filename="365pt_addr">pt_addr</a>) | <a class="macro" href="i915_gem_gtt.h.html#68" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PDE_VALID">GEN6_PDE_VALID</a>);</td></tr>
<tr><th id="1724">1724</th><td></td></tr>
<tr><th id="1725">1725</th><td>		<b>if</b> (<a class="local col7 ref" href="#357pd_entry" title='pd_entry' data-ref="357pd_entry" data-ref-filename="357pd_entry">pd_entry</a> != <a class="local col3 ref" href="#363expected" title='expected' data-ref="363expected" data-ref-filename="363expected">expected</a>)</td></tr>
<tr><th id="1726">1726</th><td>			<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>"\tPDE #%d mismatch: Actual PDE: %x Expected PDE: %x\n"</q>,</td></tr>
<tr><th id="1727">1727</th><td>				   <a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a>,</td></tr>
<tr><th id="1728">1728</th><td>				   <a class="local col7 ref" href="#357pd_entry" title='pd_entry' data-ref="357pd_entry" data-ref-filename="357pd_entry">pd_entry</a>,</td></tr>
<tr><th id="1729">1729</th><td>				   <a class="local col3 ref" href="#363expected" title='expected' data-ref="363expected" data-ref-filename="363expected">expected</a>);</td></tr>
<tr><th id="1730">1730</th><td>		<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>"\tPDE: %x\n"</q>, <a class="local col7 ref" href="#357pd_entry" title='pd_entry' data-ref="357pd_entry" data-ref-filename="357pd_entry">pd_entry</a>);</td></tr>
<tr><th id="1731">1731</th><td></td></tr>
<tr><th id="1732">1732</th><td>		<a class="local col4 ref" href="#364pt_vaddr" title='pt_vaddr' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(ppgtt-&gt;pd.page_table[pde])-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a>]);</td></tr>
<tr><th id="1733">1733</th><td></td></tr>
<tr><th id="1734">1734</th><td>		<b>for</b> (<a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> = <var>0</var>; <a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> &lt; <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>; <a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a>+=<var>4</var>) {</td></tr>
<tr><th id="1735">1735</th><td>			<em>unsigned</em> <em>long</em> <dfn class="local col6 decl" id="366va" title='va' data-type='unsigned long' data-ref="366va" data-ref-filename="366va">va</dfn> =</td></tr>
<tr><th id="1736">1736</th><td>				(<a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a> * <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a> * <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>) +</td></tr>
<tr><th id="1737">1737</th><td>				(<a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> * <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>);</td></tr>
<tr><th id="1738">1738</th><td>			<em>int</em> <dfn class="local col7 decl" id="367i" title='i' data-type='int' data-ref="367i" data-ref-filename="367i">i</dfn>;</td></tr>
<tr><th id="1739">1739</th><td>			<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col8 decl" id="368found" title='found' data-type='_Bool' data-ref="368found" data-ref-filename="368found">found</dfn> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="1740">1740</th><td>			<b>for</b> (<a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a> = <var>0</var>; <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a> &lt; <var>4</var>; <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a>++)</td></tr>
<tr><th id="1741">1741</th><td>				<b>if</b> (<a class="local col4 ref" href="#364pt_vaddr" title='pt_vaddr' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</a>[<a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> + <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a>] != <a class="local col6 ref" href="#356scratch_pte" title='scratch_pte' data-ref="356scratch_pte" data-ref-filename="356scratch_pte">scratch_pte</a>)</td></tr>
<tr><th id="1742">1742</th><td>					<a class="local col8 ref" href="#368found" title='found' data-ref="368found" data-ref-filename="368found">found</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="1743">1743</th><td>			<b>if</b> (!<a class="local col8 ref" href="#368found" title='found' data-ref="368found" data-ref-filename="368found">found</a>)</td></tr>
<tr><th id="1744">1744</th><td>				<b>continue</b>;</td></tr>
<tr><th id="1745">1745</th><td></td></tr>
<tr><th id="1746">1746</th><td>			<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>"\t\t0x%lx [%03d,%04d]: ="</q>, <a class="local col6 ref" href="#366va" title='va' data-ref="366va" data-ref-filename="366va">va</a>, <a class="local col9 ref" href="#359pde" title='pde' data-ref="359pde" data-ref-filename="359pde">pde</a>, <a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a>);</td></tr>
<tr><th id="1747">1747</th><td>			<b>for</b> (<a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a> = <var>0</var>; <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a> &lt; <var>4</var>; <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a>++) {</td></tr>
<tr><th id="1748">1748</th><td>				<b>if</b> (<a class="local col4 ref" href="#364pt_vaddr" title='pt_vaddr' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</a>[<a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> + <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a>] != <a class="local col6 ref" href="#356scratch_pte" title='scratch_pte' data-ref="356scratch_pte" data-ref-filename="356scratch_pte">scratch_pte</a>)</td></tr>
<tr><th id="1749">1749</th><td>					<a class="ref fn" href="#1549" title='seq_printf' data-ref="seq_printf" data-ref-filename="seq_printf">seq_printf</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>" %08x"</q>, <a class="local col4 ref" href="#364pt_vaddr" title='pt_vaddr' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</a>[<a class="local col8 ref" href="#358pte" title='pte' data-ref="358pte" data-ref-filename="358pte">pte</a> + <a class="local col7 ref" href="#367i" title='i' data-ref="367i" data-ref-filename="367i">i</a>]);</td></tr>
<tr><th id="1750">1750</th><td>				<b>else</b></td></tr>
<tr><th id="1751">1751</th><td>					<a class="ref fn" href="#1577" title='seq_puts' data-ref="seq_puts" data-ref-filename="seq_puts">seq_puts</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>"  SCRATCH "</q>);</td></tr>
<tr><th id="1752">1752</th><td>			}</td></tr>
<tr><th id="1753">1753</th><td>			<a class="ref fn" href="#1577" title='seq_puts' data-ref="seq_puts" data-ref-filename="seq_puts">seq_puts</a>(<a class="local col2 ref" href="#352m" title='m' data-ref="352m" data-ref-filename="352m">m</a>, <q>"\n"</q>);</td></tr>
<tr><th id="1754">1754</th><td>		}</td></tr>
<tr><th id="1755">1755</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col1 ref" href="#351ppgtt" title='ppgtt' data-ref="351ppgtt" data-ref-filename="351ppgtt">ppgtt</a>, <a class="local col4 ref" href="#364pt_vaddr" title='pt_vaddr' data-ref="364pt_vaddr" data-ref-filename="364pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="1756">1756</th><td>	}</td></tr>
<tr><th id="1757">1757</th><td>}</td></tr>
<tr><th id="1758">1758</th><td><u>#<span data-ppcond="1705">endif</span></u></td></tr>
<tr><th id="1759">1759</th><td></td></tr>
<tr><th id="1760">1760</th><td><i  data-doc="gen6_write_pde">/* Write pde (index) from the page directory @pd to the page table @pt */</i></td></tr>
<tr><th id="1761">1761</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_write_pde" title='gen6_write_pde' data-type='void gen6_write_pde(struct i915_page_directory * pd, const int pde, struct i915_page_table * pt)' data-ref="gen6_write_pde" data-ref-filename="gen6_write_pde">gen6_write_pde</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col9 decl" id="369pd" title='pd' data-type='struct i915_page_directory *' data-ref="369pd" data-ref-filename="369pd">pd</dfn>,</td></tr>
<tr><th id="1762">1762</th><td>			    <em>const</em> <em>int</em> <dfn class="local col0 decl" id="370pde" title='pde' data-type='const int' data-ref="370pde" data-ref-filename="370pde">pde</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col1 decl" id="371pt" title='pt' data-type='struct i915_page_table *' data-ref="371pt" data-ref-filename="371pt">pt</dfn>)</td></tr>
<tr><th id="1763">1763</th><td>{</td></tr>
<tr><th id="1764">1764</th><td>	<i>/* Caller needs to make sure the write completes if necessary */</i></td></tr>
<tr><th id="1765">1765</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col2 decl" id="372ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="372ppgtt" data-ref-filename="372ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1766">1766</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(pd)) - __builtin_offsetof(struct i915_hw_ppgtt, pd)) + (0 * sizeof((pd) - &amp;((struct i915_hw_ppgtt *)(((char *)(pd)) - __builtin_offsetof(struct i915_hw_ppgtt, pd)))-&gt;pd)))" data-ref="_M/container_of">container_of</a>(<a class="local col9 ref" href="#369pd" title='pd' data-ref="369pd" data-ref-filename="369pd">pd</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>);</td></tr>
<tr><th id="1767">1767</th><td><u>#<span data-ppcond="1767">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="1768">1768</th><td>	<b>struct</b> drm_i915_private *dev_priv = ppgtt-&gt;base.dev-&gt;dev_private;</td></tr>
<tr><th id="1769">1769</th><td>	<em>const</em> bus_space_tag_t bst = dev_priv-&gt;gtt.bst;</td></tr>
<tr><th id="1770">1770</th><td>	<em>const</em> bus_space_handle_t bsh = dev_priv-&gt;gtt.bsh;</td></tr>
<tr><th id="1771">1771</th><td>	<em>const</em> bus_addr_t pd_base = ppgtt-&gt;pd.base.ggtt_offset;</td></tr>
<tr><th id="1772">1772</th><td><u>#<span data-ppcond="1767">endif</span></u></td></tr>
<tr><th id="1773">1773</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col3 decl" id="373pd_entry" title='pd_entry' data-type='u32' data-ref="373pd_entry" data-ref-filename="373pd_entry">pd_entry</dfn>;</td></tr>
<tr><th id="1774">1774</th><td></td></tr>
<tr><th id="1775">1775</th><td>	<a class="local col3 ref" href="#373pd_entry" title='pd_entry' data-ref="373pd_entry" data-ref-filename="373pd_entry">pd_entry</a> = <a class="macro" href="i915_gem_gtt.h.html#53" title="((((&amp;(pt)-&gt;base)-&gt;daddr)) | (((((&amp;(pt)-&gt;base)-&gt;daddr)) &gt;&gt; 28) &amp; 0xff0))" data-ref="_M/GEN6_PDE_ADDR_ENCODE">GEN6_PDE_ADDR_ENCODE</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(pt)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col1 ref" href="#371pt" title='pt' data-ref="371pt" data-ref-filename="371pt">pt</a>));</td></tr>
<tr><th id="1776">1776</th><td>	<a class="local col3 ref" href="#373pd_entry" title='pd_entry' data-ref="373pd_entry" data-ref-filename="373pd_entry">pd_entry</a> |= <a class="macro" href="i915_gem_gtt.h.html#68" title="(1 &lt;&lt; 0)" data-ref="_M/GEN6_PDE_VALID">GEN6_PDE_VALID</a>;</td></tr>
<tr><th id="1777">1777</th><td></td></tr>
<tr><th id="1778">1778</th><td><u>#<span data-ppcond="1778">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="1779">1779</th><td>	CTASSERT(<b>sizeof</b>(gen6_pte_t) == <var>4</var>);</td></tr>
<tr><th id="1780">1780</th><td>	bus_space_write_4(bst, bsh, pd_base + <var>4</var>*pde, pd_entry);</td></tr>
<tr><th id="1781">1781</th><td><u>#<span data-ppcond="1778">else</span></u></td></tr>
<tr><th id="1782">1782</th><td>	writel(pd_entry, ppgtt-&gt;<span class='error' title="no member named &apos;pd_addr&apos; in &apos;struct i915_hw_ppgtt&apos;">pd_addr</span> + pde);</td></tr>
<tr><th id="1783">1783</th><td><u>#<span data-ppcond="1778">endif</span></u></td></tr>
<tr><th id="1784">1784</th><td>}</td></tr>
<tr><th id="1785">1785</th><td></td></tr>
<tr><th id="1786">1786</th><td><i  data-doc="gen6_write_page_range">/* Write all the page tables found in the ppgtt structure to incrementing page</i></td></tr>
<tr><th id="1787">1787</th><td><i  data-doc="gen6_write_page_range"> * directories. */</i></td></tr>
<tr><th id="1788">1788</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_write_page_range" title='gen6_write_page_range' data-type='void gen6_write_page_range(struct drm_i915_private * dev_priv, struct i915_page_directory * pd, uint32_t start, uint32_t length)' data-ref="gen6_write_page_range" data-ref-filename="gen6_write_page_range">gen6_write_page_range</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="374dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="374dev_priv" data-ref-filename="374dev_priv">dev_priv</dfn>,</td></tr>
<tr><th id="1789">1789</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_directory" title='i915_page_directory' data-ref="i915_page_directory" data-ref-filename="i915_page_directory">i915_page_directory</a> *<dfn class="local col5 decl" id="375pd" title='pd' data-type='struct i915_page_directory *' data-ref="375pd" data-ref-filename="375pd">pd</dfn>,</td></tr>
<tr><th id="1790">1790</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col6 decl" id="376start" title='start' data-type='uint32_t' data-ref="376start" data-ref-filename="376start">start</dfn>, <a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="377length" title='length' data-type='uint32_t' data-ref="377length" data-ref-filename="377length">length</dfn>)</td></tr>
<tr><th id="1791">1791</th><td>{</td></tr>
<tr><th id="1792">1792</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col8 decl" id="378pt" title='pt' data-type='struct i915_page_table *' data-ref="378pt" data-ref-filename="378pt">pt</dfn>;</td></tr>
<tr><th id="1793">1793</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="379pde" title='pde' data-type='uint32_t' data-ref="379pde" data-ref-filename="379pde">pde</dfn>, <dfn class="local col0 decl" id="380temp" title='temp' data-type='uint32_t' data-ref="380temp" data-ref-filename="380temp">temp</dfn>;</td></tr>
<tr><th id="1794">1794</th><td></td></tr>
<tr><th id="1795">1795</th><td>	<a class="macro" href="i915_gem_gtt.h.html#449" title="for (pde = gen6_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen6_for_each_pde">gen6_for_each_pde</a>(<a class="local col8 ref" href="#378pt" title='pt' data-ref="378pt" data-ref-filename="378pt">pt</a>, <a class="local col5 ref" href="#375pd" title='pd' data-ref="375pd" data-ref-filename="375pd">pd</a>, <a class="local col6 ref" href="#376start" title='start' data-ref="376start" data-ref-filename="376start">start</a>, <a class="local col7 ref" href="#377length" title='length' data-ref="377length" data-ref-filename="377length">length</a>, temp, <a class="local col9 ref" href="#379pde" title='pde' data-ref="379pde" data-ref-filename="379pde">pde</a>)</td></tr>
<tr><th id="1796">1796</th><td>		<a class="tu ref fn" href="#gen6_write_pde" title='gen6_write_pde' data-use='c' data-ref="gen6_write_pde" data-ref-filename="gen6_write_pde">gen6_write_pde</a>(<a class="local col5 ref" href="#375pd" title='pd' data-ref="375pd" data-ref-filename="375pd">pd</a>, <a class="local col9 ref" href="#379pde" title='pde' data-ref="379pde" data-ref-filename="379pde">pde</a>, <a class="local col8 ref" href="#378pt" title='pt' data-ref="378pt" data-ref-filename="378pt">pt</a>);</td></tr>
<tr><th id="1797">1797</th><td></td></tr>
<tr><th id="1798">1798</th><td>	<i>/* Make sure write is complete before other code can use this page</i></td></tr>
<tr><th id="1799">1799</th><td><i>	 * table. Also require for WC mapped PTEs */</i></td></tr>
<tr><th id="1800">1800</th><td><u>#<span data-ppcond="1800">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="1801">1801</th><td>	bus_space_read_4(dev_priv-&gt;gtt.bst, dev_priv-&gt;gtt.bsh, <var>0</var>);</td></tr>
<tr><th id="1802">1802</th><td><u>#<span data-ppcond="1800">else</span></u></td></tr>
<tr><th id="1803">1803</th><td>	readl(dev_priv-&gt;gtt.gsm);</td></tr>
<tr><th id="1804">1804</th><td><u>#<span data-ppcond="1800">endif</span></u></td></tr>
<tr><th id="1805">1805</th><td>}</td></tr>
<tr><th id="1806">1806</th><td></td></tr>
<tr><th id="1807">1807</th><td><em>static</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="tu decl def fn" id="get_pd_offset" title='get_pd_offset' data-type='uint32_t get_pd_offset(struct i915_hw_ppgtt * ppgtt)' data-ref="get_pd_offset" data-ref-filename="get_pd_offset">get_pd_offset</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="381ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="381ppgtt" data-ref-filename="381ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="1808">1808</th><td>{</td></tr>
<tr><th id="1809">1809</th><td>	<a class="macro" href="../../../include/asm/bug.h.html#39" title="(__builtin_expect(((!(ppgtt-&gt;pd.base.ggtt_offset &amp; 0x3f))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;!(ppgtt-&gt;pd.base.ggtt_offset &amp; 0x3f)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 1809))" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="local col1 ref" href="#381ppgtt" title='ppgtt' data-ref="381ppgtt" data-ref-filename="381ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::base" title='i915_page_directory::base' data-ref="i915_page_directory::base" data-ref-filename="i915_page_directory..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::(anonymous)::ggtt_offset" title='i915_page_dma::(anonymous union)::ggtt_offset' data-ref="i915_page_dma::(anonymous)::ggtt_offset" data-ref-filename="i915_page_dma..(anonymous)..ggtt_offset">ggtt_offset</a> &amp; <var>0x3f</var>);</td></tr>
<tr><th id="1810">1810</th><td></td></tr>
<tr><th id="1811">1811</th><td>	<b>return</b> (<a class="local col1 ref" href="#381ppgtt" title='ppgtt' data-ref="381ppgtt" data-ref-filename="381ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::base" title='i915_page_directory::base' data-ref="i915_page_directory::base" data-ref-filename="i915_page_directory..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::(anonymous)::ggtt_offset" title='i915_page_dma::(anonymous union)::ggtt_offset' data-ref="i915_page_dma::(anonymous)::ggtt_offset" data-ref-filename="i915_page_dma..(anonymous)..ggtt_offset">ggtt_offset</a> / <var>64</var>) &lt;&lt; <var>16</var>;</td></tr>
<tr><th id="1812">1812</th><td>}</td></tr>
<tr><th id="1813">1813</th><td></td></tr>
<tr><th id="1814">1814</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="hsw_mm_switch" title='hsw_mm_switch' data-type='int hsw_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="hsw_mm_switch" data-ref-filename="hsw_mm_switch">hsw_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col2 decl" id="382ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="382ppgtt" data-ref-filename="382ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="1815">1815</th><td>			 <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col3 decl" id="383req" title='req' data-type='struct drm_i915_gem_request *' data-ref="383req" data-ref-filename="383req">req</dfn>)</td></tr>
<tr><th id="1816">1816</th><td>{</td></tr>
<tr><th id="1817">1817</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col4 decl" id="384ring" title='ring' data-type='struct intel_engine_cs *' data-ref="384ring" data-ref-filename="384ring">ring</dfn> = <a class="local col3 ref" href="#383req" title='req' data-ref="383req" data-ref-filename="383req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>;</td></tr>
<tr><th id="1818">1818</th><td>	<em>int</em> <dfn class="local col5 decl" id="385ret" title='ret' data-type='int' data-ref="385ret" data-ref-filename="385ret">ret</dfn>;</td></tr>
<tr><th id="1819">1819</th><td></td></tr>
<tr><th id="1820">1820</th><td>	<i>/* NB: TLBs must be flushed and invalidated before a switch */</i></td></tr>
<tr><th id="1821">1821</th><td>	<a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a> = <a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>-&gt;<a class="ref field" href="intel_ringbuffer.h.html#intel_engine_cs::flush" title='intel_engine_cs::flush' data-ref="intel_engine_cs::flush" data-ref-filename="intel_engine_cs..flush">flush</a>(<a class="local col3 ref" href="#383req" title='req' data-ref="383req" data-ref-filename="383req">req</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>);</td></tr>
<tr><th id="1822">1822</th><td>	<b>if</b> (<a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a>)</td></tr>
<tr><th id="1823">1823</th><td>		<b>return</b> <a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a>;</td></tr>
<tr><th id="1824">1824</th><td></td></tr>
<tr><th id="1825">1825</th><td>	<a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a> = <a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_begin" title='intel_ring_begin' data-ref="intel_ring_begin" data-ref-filename="intel_ring_begin">intel_ring_begin</a>(<a class="local col3 ref" href="#383req" title='req' data-ref="383req" data-ref-filename="383req">req</a>, <var>6</var>);</td></tr>
<tr><th id="1826">1826</th><td>	<b>if</b> (<a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a>)</td></tr>
<tr><th id="1827">1827</th><td>		<b>return</b> <a class="local col5 ref" href="#385ret" title='ret' data-ref="385ret" data-ref-filename="385ret">ret</a>;</td></tr>
<tr><th id="1828">1828</th><td></td></tr>
<tr><th id="1829">1829</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="macro" href="i915_reg.h.html#358" title="(((0x22) &lt;&lt; 23) | (2*(2)-1))" data-ref="_M/MI_LOAD_REGISTER_IMM">MI_LOAD_REGISTER_IMM</a>(<var>2</var>));</td></tr>
<tr><th id="1830">1830</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="macro" href="i915_reg.h.html#146" title="((ring)-&gt;mmio_base+0x220)" data-ref="_M/RING_PP_DIR_DCLV">RING_PP_DIR_DCLV</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>));</td></tr>
<tr><th id="1831">1831</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="macro" href="i915_reg.h.html#147" title="0xffffffff" data-ref="_M/PP_DIR_DCLV_2G">PP_DIR_DCLV_2G</a>);</td></tr>
<tr><th id="1832">1832</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="macro" href="i915_reg.h.html#144" title="((ring)-&gt;mmio_base+0x228)" data-ref="_M/RING_PP_DIR_BASE">RING_PP_DIR_BASE</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>));</td></tr>
<tr><th id="1833">1833</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="tu ref fn" href="#get_pd_offset" title='get_pd_offset' data-use='c' data-ref="get_pd_offset" data-ref-filename="get_pd_offset">get_pd_offset</a>(<a class="local col2 ref" href="#382ppgtt" title='ppgtt' data-ref="382ppgtt" data-ref-filename="382ppgtt">ppgtt</a>));</td></tr>
<tr><th id="1834">1834</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>, <a class="macro" href="i915_reg.h.html#266" title="(((0) &lt;&lt; 23) | (0))" data-ref="_M/MI_NOOP">MI_NOOP</a>);</td></tr>
<tr><th id="1835">1835</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_advance" title='intel_ring_advance' data-ref="intel_ring_advance" data-ref-filename="intel_ring_advance">intel_ring_advance</a>(<a class="local col4 ref" href="#384ring" title='ring' data-ref="384ring" data-ref-filename="384ring">ring</a>);</td></tr>
<tr><th id="1836">1836</th><td></td></tr>
<tr><th id="1837">1837</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1838">1838</th><td>}</td></tr>
<tr><th id="1839">1839</th><td></td></tr>
<tr><th id="1840">1840</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="vgpu_mm_switch" title='vgpu_mm_switch' data-type='int vgpu_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="vgpu_mm_switch" data-ref-filename="vgpu_mm_switch">vgpu_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="386ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="386ppgtt" data-ref-filename="386ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="1841">1841</th><td>			  <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col7 decl" id="387req" title='req' data-type='struct drm_i915_gem_request *' data-ref="387req" data-ref-filename="387req">req</dfn>)</td></tr>
<tr><th id="1842">1842</th><td>{</td></tr>
<tr><th id="1843">1843</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col8 decl" id="388ring" title='ring' data-type='struct intel_engine_cs *' data-ref="388ring" data-ref-filename="388ring">ring</dfn> = <a class="local col7 ref" href="#387req" title='req' data-ref="387req" data-ref-filename="387req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>;</td></tr>
<tr><th id="1844">1844</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="389dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="389dev_priv" data-ref-filename="389dev_priv">dev_priv</dfn> = <a class="ref fn" href="i915_drv.h.html#to_i915" title='to_i915' data-ref="to_i915" data-ref-filename="to_i915">to_i915</a>(<a class="local col6 ref" href="#386ppgtt" title='ppgtt' data-ref="386ppgtt" data-ref-filename="386ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>);</td></tr>
<tr><th id="1845">1845</th><td></td></tr>
<tr><th id="1846">1846</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x220)), (0xffffffff), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#146" title="((ring)-&gt;mmio_base+0x220)" data-ref="_M/RING_PP_DIR_DCLV">RING_PP_DIR_DCLV</a>(<a class="local col8 ref" href="#388ring" title='ring' data-ref="388ring" data-ref-filename="388ring">ring</a>), <a class="macro" href="i915_reg.h.html#147" title="0xffffffff" data-ref="_M/PP_DIR_DCLV_2G">PP_DIR_DCLV_2G</a>);</td></tr>
<tr><th id="1847">1847</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x228)), (get_pd_offset(ppgtt)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#144" title="((ring)-&gt;mmio_base+0x228)" data-ref="_M/RING_PP_DIR_BASE">RING_PP_DIR_BASE</a>(<a class="local col8 ref" href="#388ring" title='ring' data-ref="388ring" data-ref-filename="388ring">ring</a>), <a class="tu ref fn" href="#get_pd_offset" title='get_pd_offset' data-use='c' data-ref="get_pd_offset" data-ref-filename="get_pd_offset">get_pd_offset</a>(<a class="local col6 ref" href="#386ppgtt" title='ppgtt' data-ref="386ppgtt" data-ref-filename="386ppgtt">ppgtt</a>));</td></tr>
<tr><th id="1848">1848</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1849">1849</th><td>}</td></tr>
<tr><th id="1850">1850</th><td></td></tr>
<tr><th id="1851">1851</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen7_mm_switch" title='gen7_mm_switch' data-type='int gen7_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="gen7_mm_switch" data-ref-filename="gen7_mm_switch">gen7_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col0 decl" id="390ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="390ppgtt" data-ref-filename="390ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="1852">1852</th><td>			  <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col1 decl" id="391req" title='req' data-type='struct drm_i915_gem_request *' data-ref="391req" data-ref-filename="391req">req</dfn>)</td></tr>
<tr><th id="1853">1853</th><td>{</td></tr>
<tr><th id="1854">1854</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col2 decl" id="392ring" title='ring' data-type='struct intel_engine_cs *' data-ref="392ring" data-ref-filename="392ring">ring</dfn> = <a class="local col1 ref" href="#391req" title='req' data-ref="391req" data-ref-filename="391req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>;</td></tr>
<tr><th id="1855">1855</th><td>	<em>int</em> <dfn class="local col3 decl" id="393ret" title='ret' data-type='int' data-ref="393ret" data-ref-filename="393ret">ret</dfn>;</td></tr>
<tr><th id="1856">1856</th><td></td></tr>
<tr><th id="1857">1857</th><td>	<i>/* NB: TLBs must be flushed and invalidated before a switch */</i></td></tr>
<tr><th id="1858">1858</th><td>	<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a> = <a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>-&gt;<a class="ref field" href="intel_ringbuffer.h.html#intel_engine_cs::flush" title='intel_engine_cs::flush' data-ref="intel_engine_cs::flush" data-ref-filename="intel_engine_cs..flush">flush</a>(<a class="local col1 ref" href="#391req" title='req' data-ref="391req" data-ref-filename="391req">req</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>);</td></tr>
<tr><th id="1859">1859</th><td>	<b>if</b> (<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>)</td></tr>
<tr><th id="1860">1860</th><td>		<b>return</b> <a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>;</td></tr>
<tr><th id="1861">1861</th><td></td></tr>
<tr><th id="1862">1862</th><td>	<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a> = <a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_begin" title='intel_ring_begin' data-ref="intel_ring_begin" data-ref-filename="intel_ring_begin">intel_ring_begin</a>(<a class="local col1 ref" href="#391req" title='req' data-ref="391req" data-ref-filename="391req">req</a>, <var>6</var>);</td></tr>
<tr><th id="1863">1863</th><td>	<b>if</b> (<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>)</td></tr>
<tr><th id="1864">1864</th><td>		<b>return</b> <a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>;</td></tr>
<tr><th id="1865">1865</th><td></td></tr>
<tr><th id="1866">1866</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="macro" href="i915_reg.h.html#358" title="(((0x22) &lt;&lt; 23) | (2*(2)-1))" data-ref="_M/MI_LOAD_REGISTER_IMM">MI_LOAD_REGISTER_IMM</a>(<var>2</var>));</td></tr>
<tr><th id="1867">1867</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="macro" href="i915_reg.h.html#146" title="((ring)-&gt;mmio_base+0x220)" data-ref="_M/RING_PP_DIR_DCLV">RING_PP_DIR_DCLV</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>));</td></tr>
<tr><th id="1868">1868</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="macro" href="i915_reg.h.html#147" title="0xffffffff" data-ref="_M/PP_DIR_DCLV_2G">PP_DIR_DCLV_2G</a>);</td></tr>
<tr><th id="1869">1869</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="macro" href="i915_reg.h.html#144" title="((ring)-&gt;mmio_base+0x228)" data-ref="_M/RING_PP_DIR_BASE">RING_PP_DIR_BASE</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>));</td></tr>
<tr><th id="1870">1870</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="tu ref fn" href="#get_pd_offset" title='get_pd_offset' data-use='c' data-ref="get_pd_offset" data-ref-filename="get_pd_offset">get_pd_offset</a>(<a class="local col0 ref" href="#390ppgtt" title='ppgtt' data-ref="390ppgtt" data-ref-filename="390ppgtt">ppgtt</a>));</td></tr>
<tr><th id="1871">1871</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_emit" title='intel_ring_emit' data-ref="intel_ring_emit" data-ref-filename="intel_ring_emit">intel_ring_emit</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>, <a class="macro" href="i915_reg.h.html#266" title="(((0) &lt;&lt; 23) | (0))" data-ref="_M/MI_NOOP">MI_NOOP</a>);</td></tr>
<tr><th id="1872">1872</th><td>	<a class="ref fn" href="intel_ringbuffer.h.html#intel_ring_advance" title='intel_ring_advance' data-ref="intel_ring_advance" data-ref-filename="intel_ring_advance">intel_ring_advance</a>(<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>);</td></tr>
<tr><th id="1873">1873</th><td></td></tr>
<tr><th id="1874">1874</th><td>	<i>/* XXX: RCS is the only one to auto invalidate the TLBs? */</i></td></tr>
<tr><th id="1875">1875</th><td>	<b>if</b> (<a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>-&gt;<a class="ref field" href="intel_ringbuffer.h.html#intel_engine_cs::id" title='intel_engine_cs::id' data-ref="intel_engine_cs::id" data-ref-filename="intel_engine_cs..id">id</a> != <a class="enum" href="intel_ringbuffer.h.html#RCS" title='RCS' data-ref="RCS" data-ref-filename="RCS">RCS</a>) {</td></tr>
<tr><th id="1876">1876</th><td>		<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a> = <a class="local col2 ref" href="#392ring" title='ring' data-ref="392ring" data-ref-filename="392ring">ring</a>-&gt;<a class="ref field" href="intel_ringbuffer.h.html#intel_engine_cs::flush" title='intel_engine_cs::flush' data-ref="intel_engine_cs::flush" data-ref-filename="intel_engine_cs..flush">flush</a>(<a class="local col1 ref" href="#391req" title='req' data-ref="391req" data-ref-filename="391req">req</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>, <a class="macro" href="i915_drv.h.html#278" title="(0x00000002 | 0x00000004 | 0x00000008 | 0x00000010 | 0x00000020)" data-ref="_M/I915_GEM_GPU_DOMAINS">I915_GEM_GPU_DOMAINS</a>);</td></tr>
<tr><th id="1877">1877</th><td>		<b>if</b> (<a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>)</td></tr>
<tr><th id="1878">1878</th><td>			<b>return</b> <a class="local col3 ref" href="#393ret" title='ret' data-ref="393ret" data-ref-filename="393ret">ret</a>;</td></tr>
<tr><th id="1879">1879</th><td>	}</td></tr>
<tr><th id="1880">1880</th><td></td></tr>
<tr><th id="1881">1881</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1882">1882</th><td>}</td></tr>
<tr><th id="1883">1883</th><td></td></tr>
<tr><th id="1884">1884</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_mm_switch" title='gen6_mm_switch' data-type='int gen6_mm_switch(struct i915_hw_ppgtt * ppgtt, struct drm_i915_gem_request * req)' data-ref="gen6_mm_switch" data-ref-filename="gen6_mm_switch">gen6_mm_switch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="394ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="394ppgtt" data-ref-filename="394ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="1885">1885</th><td>			  <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col5 decl" id="395req" title='req' data-type='struct drm_i915_gem_request *' data-ref="395req" data-ref-filename="395req">req</dfn>)</td></tr>
<tr><th id="1886">1886</th><td>{</td></tr>
<tr><th id="1887">1887</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col6 decl" id="396ring" title='ring' data-type='struct intel_engine_cs *' data-ref="396ring" data-ref-filename="396ring">ring</dfn> = <a class="local col5 ref" href="#395req" title='req' data-ref="395req" data-ref-filename="395req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>;</td></tr>
<tr><th id="1888">1888</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="397dev" title='dev' data-type='struct drm_device *' data-ref="397dev" data-ref-filename="397dev">dev</dfn> = <a class="local col4 ref" href="#394ppgtt" title='ppgtt' data-ref="394ppgtt" data-ref-filename="394ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="1889">1889</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col8 decl" id="398dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="398dev_priv" data-ref-filename="398dev_priv">dev_priv</dfn> = <a class="local col7 ref" href="#397dev" title='dev' data-ref="397dev" data-ref-filename="397dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="1890">1890</th><td></td></tr>
<tr><th id="1891">1891</th><td></td></tr>
<tr><th id="1892">1892</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x220)), (0xffffffff), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#146" title="((ring)-&gt;mmio_base+0x220)" data-ref="_M/RING_PP_DIR_DCLV">RING_PP_DIR_DCLV</a>(<a class="local col6 ref" href="#396ring" title='ring' data-ref="396ring" data-ref-filename="396ring">ring</a>), <a class="macro" href="i915_reg.h.html#147" title="0xffffffff" data-ref="_M/PP_DIR_DCLV_2G">PP_DIR_DCLV_2G</a>);</td></tr>
<tr><th id="1893">1893</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x228)), (get_pd_offset(ppgtt)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#144" title="((ring)-&gt;mmio_base+0x228)" data-ref="_M/RING_PP_DIR_BASE">RING_PP_DIR_BASE</a>(<a class="local col6 ref" href="#396ring" title='ring' data-ref="396ring" data-ref-filename="396ring">ring</a>), <a class="tu ref fn" href="#get_pd_offset" title='get_pd_offset' data-use='c' data-ref="get_pd_offset" data-ref-filename="get_pd_offset">get_pd_offset</a>(<a class="local col4 ref" href="#394ppgtt" title='ppgtt' data-ref="394ppgtt" data-ref-filename="394ppgtt">ppgtt</a>));</td></tr>
<tr><th id="1894">1894</th><td></td></tr>
<tr><th id="1895">1895</th><td>	<a class="macro" href="i915_drv.h.html#3615" title="(void)dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (((ring)-&gt;mmio_base+0x220)), 0)" data-ref="_M/POSTING_READ">POSTING_READ</a>(<a class="macro" href="i915_reg.h.html#146" title="((ring)-&gt;mmio_base+0x220)" data-ref="_M/RING_PP_DIR_DCLV">RING_PP_DIR_DCLV</a>(<a class="local col6 ref" href="#396ring" title='ring' data-ref="396ring" data-ref-filename="396ring">ring</a>));</td></tr>
<tr><th id="1896">1896</th><td></td></tr>
<tr><th id="1897">1897</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="1898">1898</th><td>}</td></tr>
<tr><th id="1899">1899</th><td></td></tr>
<tr><th id="1900">1900</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ppgtt_enable" title='gen8_ppgtt_enable' data-type='void gen8_ppgtt_enable(struct drm_device * dev)' data-ref="gen8_ppgtt_enable" data-ref-filename="gen8_ppgtt_enable">gen8_ppgtt_enable</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="399dev" title='dev' data-type='struct drm_device *' data-ref="399dev" data-ref-filename="399dev">dev</dfn>)</td></tr>
<tr><th id="1901">1901</th><td>{</td></tr>
<tr><th id="1902">1902</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col0 decl" id="400dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="400dev_priv" data-ref-filename="400dev_priv">dev_priv</dfn> = <a class="local col9 ref" href="#399dev" title='dev' data-ref="399dev" data-ref-filename="399dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="1903">1903</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col1 decl" id="401ring" title='ring' data-type='struct intel_engine_cs *' data-ref="401ring" data-ref-filename="401ring">ring</dfn>;</td></tr>
<tr><th id="1904">1904</th><td>	<em>int</em> <dfn class="local col2 decl" id="402j" title='j' data-type='int' data-ref="402j" data-ref-filename="402j">j</dfn>;</td></tr>
<tr><th id="1905">1905</th><td></td></tr>
<tr><th id="1906">1906</th><td>	<a class="macro" href="i915_drv.h.html#2053" title="for ((j) = 0; (j) &lt; 5; (j)++) if (((ring) = &amp;(dev_priv)-&gt;ring[(j)]), intel_ring_initialized((ring)))" data-ref="_M/for_each_ring">for_each_ring</a>(ring, dev_priv, <a class="local col2 ref" href="#402j" title='j' data-ref="402j" data-ref-filename="402j">j</a>) {</td></tr>
<tr><th id="1907">1907</th><td>		<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col3 decl" id="403four_level" title='four_level' data-type='u32' data-ref="403four_level" data-ref-filename="403four_level">four_level</dfn> = <a class="macro" href="i915_drv.h.html#2664" title="(i915.enable_ppgtt == 3)" data-ref="_M/USES_FULL_48BIT_PPGTT">USES_FULL_48BIT_PPGTT</a>(dev) ? <a class="macro" href="i915_reg.h.html#1731" title="(1&lt;&lt;7)" data-ref="_M/GEN8_GFX_PPGTT_48B">GEN8_GFX_PPGTT_48B</a> : <var>0</var>;</td></tr>
<tr><th id="1908">1908</th><td>		<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x29c)), (({ typeof((1&lt;&lt;9) | four_level) _a = ((1&lt;&lt;9) | four_level); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert12[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert13[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert14[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1723" title="((ring)-&gt;mmio_base+0x29c)" data-ref="_M/RING_MODE_GEN7">RING_MODE_GEN7</a>(<a class="local col1 ref" href="#401ring" title='ring' data-ref="401ring" data-ref-filename="401ring">ring</a>),</td></tr>
<tr><th id="1909">1909</th><td>			   <a class="macro" href="i915_reg.h.html#51" title="({ typeof((1&lt;&lt;9) | four_level) _a = ((1&lt;&lt;9) | four_level); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert15[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert16[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert17[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })" data-ref="_M/_MASKED_BIT_ENABLE">_MASKED_BIT_ENABLE</a>(<a class="macro" href="i915_reg.h.html#1730" title="(1&lt;&lt;9)" data-ref="_M/GFX_PPGTT_ENABLE">GFX_PPGTT_ENABLE</a> | <a class="local col3 ref" href="#403four_level" title='four_level' data-ref="403four_level" data-ref-filename="403four_level">four_level</a>));</td></tr>
<tr><th id="1910">1910</th><td>	}</td></tr>
<tr><th id="1911">1911</th><td>}</td></tr>
<tr><th id="1912">1912</th><td></td></tr>
<tr><th id="1913">1913</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen7_ppgtt_enable" title='gen7_ppgtt_enable' data-type='void gen7_ppgtt_enable(struct drm_device * dev)' data-ref="gen7_ppgtt_enable" data-ref-filename="gen7_ppgtt_enable">gen7_ppgtt_enable</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="404dev" title='dev' data-type='struct drm_device *' data-ref="404dev" data-ref-filename="404dev">dev</dfn>)</td></tr>
<tr><th id="1914">1914</th><td>{</td></tr>
<tr><th id="1915">1915</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="405dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="405dev_priv" data-ref-filename="405dev_priv">dev_priv</dfn> = <a class="local col4 ref" href="#404dev" title='dev' data-ref="404dev" data-ref-filename="404dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="1916">1916</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col6 decl" id="406ring" title='ring' data-type='struct intel_engine_cs *' data-ref="406ring" data-ref-filename="406ring">ring</dfn>;</td></tr>
<tr><th id="1917">1917</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col7 decl" id="407ecochk" title='ecochk' data-type='uint32_t' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</dfn>, <dfn class="local col8 decl" id="408ecobits" title='ecobits' data-type='uint32_t' data-ref="408ecobits" data-ref-filename="408ecobits">ecobits</dfn>;</td></tr>
<tr><th id="1918">1918</th><td>	<em>int</em> <dfn class="local col9 decl" id="409i" title='i' data-type='int' data-ref="409i" data-ref-filename="409i">i</dfn>;</td></tr>
<tr><th id="1919">1919</th><td></td></tr>
<tr><th id="1920">1920</th><td>	<a class="local col8 ref" href="#408ecobits" title='ecobits' data-ref="408ecobits" data-ref-filename="408ecobits">ecobits</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x14090), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#178" title="0x14090" data-ref="_M/GAC_ECO_BITS">GAC_ECO_BITS</a>);</td></tr>
<tr><th id="1921">1921</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x14090), (ecobits | (3&lt;&lt;8)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#178" title="0x14090" data-ref="_M/GAC_ECO_BITS">GAC_ECO_BITS</a>, <a class="local col8 ref" href="#408ecobits" title='ecobits' data-ref="408ecobits" data-ref-filename="408ecobits">ecobits</a> | <a class="macro" href="i915_reg.h.html#180" title="(3&lt;&lt;8)" data-ref="_M/ECOBITS_PPGTT_CACHE64B">ECOBITS_PPGTT_CACHE64B</a>);</td></tr>
<tr><th id="1922">1922</th><td></td></tr>
<tr><th id="1923">1923</th><td>	<a class="local col7 ref" href="#407ecochk" title='ecochk' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x4090), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#165" title="0x4090" data-ref="_M/GAM_ECOCHK">GAM_ECOCHK</a>);</td></tr>
<tr><th id="1924">1924</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2559" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_haswell)" data-ref="_M/IS_HASWELL">IS_HASWELL</a>(<a class="local col4 ref" href="#404dev" title='dev' data-ref="404dev" data-ref-filename="404dev">dev</a>)) {</td></tr>
<tr><th id="1925">1925</th><td>		<a class="local col7 ref" href="#407ecochk" title='ecochk' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</a> |= <a class="macro" href="i915_reg.h.html#176" title="(0x3&lt;&lt;3)" data-ref="_M/ECOCHK_PPGTT_WB_HSW">ECOCHK_PPGTT_WB_HSW</a>;</td></tr>
<tr><th id="1926">1926</th><td>	} <b>else</b> {</td></tr>
<tr><th id="1927">1927</th><td>		<a class="local col7 ref" href="#407ecochk" title='ecochk' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</a> |= <a class="macro" href="i915_reg.h.html#173" title="(0x1&lt;&lt;3)" data-ref="_M/ECOCHK_PPGTT_LLC_IVB">ECOCHK_PPGTT_LLC_IVB</a>;</td></tr>
<tr><th id="1928">1928</th><td>		<a class="local col7 ref" href="#407ecochk" title='ecochk' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</a> &amp;= ~<a class="macro" href="i915_reg.h.html#172" title="(0x1&lt;&lt;4)" data-ref="_M/ECOCHK_PPGTT_GFDT_IVB">ECOCHK_PPGTT_GFDT_IVB</a>;</td></tr>
<tr><th id="1929">1929</th><td>	}</td></tr>
<tr><th id="1930">1930</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x4090), (ecochk), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#165" title="0x4090" data-ref="_M/GAM_ECOCHK">GAM_ECOCHK</a>, <a class="local col7 ref" href="#407ecochk" title='ecochk' data-ref="407ecochk" data-ref-filename="407ecochk">ecochk</a>);</td></tr>
<tr><th id="1931">1931</th><td></td></tr>
<tr><th id="1932">1932</th><td>	<a class="macro" href="i915_drv.h.html#2053" title="for ((i) = 0; (i) &lt; 5; (i)++) if (((ring) = &amp;(dev_priv)-&gt;ring[(i)]), intel_ring_initialized((ring)))" data-ref="_M/for_each_ring">for_each_ring</a>(ring, dev_priv, <a class="local col9 ref" href="#409i" title='i' data-ref="409i" data-ref-filename="409i">i</a>) {</td></tr>
<tr><th id="1933">1933</th><td>		<i>/* GFX_MODE is per-ring on gen7+ */</i></td></tr>
<tr><th id="1934">1934</th><td>		<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (((ring)-&gt;mmio_base+0x29c)), (({ typeof((1&lt;&lt;9)) _a = ((1&lt;&lt;9)); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert21[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert22[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert23[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1723" title="((ring)-&gt;mmio_base+0x29c)" data-ref="_M/RING_MODE_GEN7">RING_MODE_GEN7</a>(<a class="local col6 ref" href="#406ring" title='ring' data-ref="406ring" data-ref-filename="406ring">ring</a>),</td></tr>
<tr><th id="1935">1935</th><td>			   <a class="macro" href="i915_reg.h.html#51" title="({ typeof((1&lt;&lt;9)) _a = ((1&lt;&lt;9)); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert24[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert25[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert26[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })" data-ref="_M/_MASKED_BIT_ENABLE">_MASKED_BIT_ENABLE</a>(<a class="macro" href="i915_reg.h.html#1730" title="(1&lt;&lt;9)" data-ref="_M/GFX_PPGTT_ENABLE">GFX_PPGTT_ENABLE</a>));</td></tr>
<tr><th id="1936">1936</th><td>	}</td></tr>
<tr><th id="1937">1937</th><td>}</td></tr>
<tr><th id="1938">1938</th><td></td></tr>
<tr><th id="1939">1939</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ppgtt_enable" title='gen6_ppgtt_enable' data-type='void gen6_ppgtt_enable(struct drm_device * dev)' data-ref="gen6_ppgtt_enable" data-ref-filename="gen6_ppgtt_enable">gen6_ppgtt_enable</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col0 decl" id="410dev" title='dev' data-type='struct drm_device *' data-ref="410dev" data-ref-filename="410dev">dev</dfn>)</td></tr>
<tr><th id="1940">1940</th><td>{</td></tr>
<tr><th id="1941">1941</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="411dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="411dev_priv" data-ref-filename="411dev_priv">dev_priv</dfn> = <a class="local col0 ref" href="#410dev" title='dev' data-ref="410dev" data-ref-filename="410dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="1942">1942</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="412ecochk" title='ecochk' data-type='uint32_t' data-ref="412ecochk" data-ref-filename="412ecochk">ecochk</dfn>, <dfn class="local col3 decl" id="413gab_ctl" title='gab_ctl' data-type='uint32_t' data-ref="413gab_ctl" data-ref-filename="413gab_ctl">gab_ctl</dfn>, <dfn class="local col4 decl" id="414ecobits" title='ecobits' data-type='uint32_t' data-ref="414ecobits" data-ref-filename="414ecobits">ecobits</dfn>;</td></tr>
<tr><th id="1943">1943</th><td></td></tr>
<tr><th id="1944">1944</th><td>	<a class="local col4 ref" href="#414ecobits" title='ecobits' data-ref="414ecobits" data-ref-filename="414ecobits">ecobits</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x14090), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#178" title="0x14090" data-ref="_M/GAC_ECO_BITS">GAC_ECO_BITS</a>);</td></tr>
<tr><th id="1945">1945</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x14090), (ecobits | (1&lt;&lt;13) | (3&lt;&lt;8)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#178" title="0x14090" data-ref="_M/GAC_ECO_BITS">GAC_ECO_BITS</a>, <a class="local col4 ref" href="#414ecobits" title='ecobits' data-ref="414ecobits" data-ref-filename="414ecobits">ecobits</a> | <a class="macro" href="i915_reg.h.html#179" title="(1&lt;&lt;13)" data-ref="_M/ECOBITS_SNB_BIT">ECOBITS_SNB_BIT</a> |</td></tr>
<tr><th id="1946">1946</th><td>		   <a class="macro" href="i915_reg.h.html#180" title="(3&lt;&lt;8)" data-ref="_M/ECOBITS_PPGTT_CACHE64B">ECOBITS_PPGTT_CACHE64B</a>);</td></tr>
<tr><th id="1947">1947</th><td></td></tr>
<tr><th id="1948">1948</th><td>	<a class="local col3 ref" href="#413gab_ctl" title='gab_ctl' data-ref="413gab_ctl" data-ref-filename="413gab_ctl">gab_ctl</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x24000), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#183" title="0x24000" data-ref="_M/GAB_CTL">GAB_CTL</a>);</td></tr>
<tr><th id="1949">1949</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x24000), (gab_ctl | (1&lt;&lt;8)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#183" title="0x24000" data-ref="_M/GAB_CTL">GAB_CTL</a>, <a class="local col3 ref" href="#413gab_ctl" title='gab_ctl' data-ref="413gab_ctl" data-ref-filename="413gab_ctl">gab_ctl</a> | <a class="macro" href="i915_reg.h.html#184" title="(1&lt;&lt;8)" data-ref="_M/GAB_CTL_CONT_AFTER_PAGEFAULT">GAB_CTL_CONT_AFTER_PAGEFAULT</a>);</td></tr>
<tr><th id="1950">1950</th><td></td></tr>
<tr><th id="1951">1951</th><td>	<a class="local col2 ref" href="#412ecochk" title='ecochk' data-ref="412ecochk" data-ref-filename="412ecochk">ecochk</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x4090), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#165" title="0x4090" data-ref="_M/GAM_ECOCHK">GAM_ECOCHK</a>);</td></tr>
<tr><th id="1952">1952</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x4090), (ecochk | (1&lt;&lt;10) | (0x3&lt;&lt;3)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#165" title="0x4090" data-ref="_M/GAM_ECOCHK">GAM_ECOCHK</a>, <a class="local col2 ref" href="#412ecochk" title='ecochk' data-ref="412ecochk" data-ref-filename="412ecochk">ecochk</a> | <a class="macro" href="i915_reg.h.html#167" title="(1&lt;&lt;10)" data-ref="_M/ECOCHK_SNB_BIT">ECOCHK_SNB_BIT</a> | <a class="macro" href="i915_reg.h.html#170" title="(0x3&lt;&lt;3)" data-ref="_M/ECOCHK_PPGTT_CACHE64B">ECOCHK_PPGTT_CACHE64B</a>);</td></tr>
<tr><th id="1953">1953</th><td></td></tr>
<tr><th id="1954">1954</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x02520), (({ typeof((1&lt;&lt;9)) _a = ((1&lt;&lt;9)); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert30[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert31[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert32[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1721" title="0x02520" data-ref="_M/GFX_MODE">GFX_MODE</a>, <a class="macro" href="i915_reg.h.html#51" title="({ typeof((1&lt;&lt;9)) _a = ((1&lt;&lt;9)); ({ if (__builtin_constant_p(_a)) { typedef char __ctassert33[ (!(((_a) &amp; 0xffff0000))) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a)) { typedef char __ctassert34[ (!((_a) &amp; 0xffff0000)) ? 1 : -1] __attribute__((__unused__)); } if (__builtin_constant_p(_a) &amp;&amp; __builtin_constant_p(_a)) { typedef char __ctassert35[ (!((_a) &amp; ~(_a))) ? 1 : -1] __attribute__((__unused__)); } (_a) &lt;&lt; 16 | (_a); }); })" data-ref="_M/_MASKED_BIT_ENABLE">_MASKED_BIT_ENABLE</a>(<a class="macro" href="i915_reg.h.html#1730" title="(1&lt;&lt;9)" data-ref="_M/GFX_PPGTT_ENABLE">GFX_PPGTT_ENABLE</a>));</td></tr>
<tr><th id="1955">1955</th><td>}</td></tr>
<tr><th id="1956">1956</th><td></td></tr>
<tr><th id="1957">1957</th><td><i  data-doc="gen6_ppgtt_clear_range">/* PPGTT support for Sandybdrige/Gen6 and later */</i></td></tr>
<tr><th id="1958">1958</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ppgtt_clear_range" title='gen6_ppgtt_clear_range' data-type='void gen6_ppgtt_clear_range(struct i915_address_space * vm, uint64_t start, uint64_t length, _Bool use_scratch)' data-ref="gen6_ppgtt_clear_range" data-ref-filename="gen6_ppgtt_clear_range">gen6_ppgtt_clear_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col5 decl" id="415vm" title='vm' data-type='struct i915_address_space *' data-ref="415vm" data-ref-filename="415vm">vm</dfn>,</td></tr>
<tr><th id="1959">1959</th><td>				   <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="416start" title='start' data-type='uint64_t' data-ref="416start" data-ref-filename="416start">start</dfn>,</td></tr>
<tr><th id="1960">1960</th><td>				   <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="417length" title='length' data-type='uint64_t' data-ref="417length" data-ref-filename="417length">length</dfn>,</td></tr>
<tr><th id="1961">1961</th><td>				   <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col8 decl" id="418use_scratch" title='use_scratch' data-type='_Bool' data-ref="418use_scratch" data-ref-filename="418use_scratch">use_scratch</dfn>)</td></tr>
<tr><th id="1962">1962</th><td>{</td></tr>
<tr><th id="1963">1963</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col9 decl" id="419ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="419ppgtt" data-ref-filename="419ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="1964">1964</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col5 ref" href="#415vm" title='vm' data-ref="415vm" data-ref-filename="415vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="1965">1965</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> *<dfn class="local col0 decl" id="420pt_vaddr" title='pt_vaddr' data-type='gen6_pte_t *' data-ref="420pt_vaddr" data-ref-filename="420pt_vaddr">pt_vaddr</dfn>, <dfn class="local col1 decl" id="421scratch_pte" title='scratch_pte' data-type='gen6_pte_t' data-ref="421scratch_pte" data-ref-filename="421scratch_pte">scratch_pte</dfn>;</td></tr>
<tr><th id="1966">1966</th><td>	<em>unsigned</em> <dfn class="local col2 decl" id="422first_entry" title='first_entry' data-type='unsigned int' data-ref="422first_entry" data-ref-filename="422first_entry">first_entry</dfn> = <a class="local col6 ref" href="#416start" title='start' data-ref="416start" data-ref-filename="416start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1967">1967</th><td>	<em>unsigned</em> <dfn class="local col3 decl" id="423num_entries" title='num_entries' data-type='unsigned int' data-ref="423num_entries" data-ref-filename="423num_entries">num_entries</dfn> = <a class="local col7 ref" href="#417length" title='length' data-ref="417length" data-ref-filename="417length">length</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="1968">1968</th><td>	<em>unsigned</em> <dfn class="local col4 decl" id="424act_pt" title='act_pt' data-type='unsigned int' data-ref="424act_pt" data-ref-filename="424act_pt">act_pt</dfn> = <a class="local col2 ref" href="#422first_entry" title='first_entry' data-ref="422first_entry" data-ref-filename="422first_entry">first_entry</a> / <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="1969">1969</th><td>	<em>unsigned</em> <dfn class="local col5 decl" id="425first_pte" title='first_pte' data-type='unsigned int' data-ref="425first_pte" data-ref-filename="425first_pte">first_pte</dfn> = <a class="local col2 ref" href="#422first_entry" title='first_entry' data-ref="422first_entry" data-ref-filename="422first_entry">first_entry</a> % <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="1970">1970</th><td>	<em>unsigned</em> <dfn class="local col6 decl" id="426last_pte" title='last_pte' data-type='unsigned int' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</dfn>, <dfn class="local col7 decl" id="427i" title='i' data-type='unsigned int' data-ref="427i" data-ref-filename="427i">i</dfn>;</td></tr>
<tr><th id="1971">1971</th><td></td></tr>
<tr><th id="1972">1972</th><td>	<a class="local col1 ref" href="#421scratch_pte" title='scratch_pte' data-ref="421scratch_pte" data-ref-filename="421scratch_pte">scratch_pte</a> = <a class="local col5 ref" href="#415vm" title='vm' data-ref="415vm" data-ref-filename="415vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col5 ref" href="#415vm" title='vm' data-ref="415vm" data-ref-filename="415vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="1973">1973</th><td>				     <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, <var>0</var>);</td></tr>
<tr><th id="1974">1974</th><td></td></tr>
<tr><th id="1975">1975</th><td>	<b>while</b> (<a class="local col3 ref" href="#423num_entries" title='num_entries' data-ref="423num_entries" data-ref-filename="423num_entries">num_entries</a>) {</td></tr>
<tr><th id="1976">1976</th><td>		<a class="local col6 ref" href="#426last_pte" title='last_pte' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</a> = <a class="local col5 ref" href="#425first_pte" title='first_pte' data-ref="425first_pte" data-ref-filename="425first_pte">first_pte</a> + <a class="local col3 ref" href="#423num_entries" title='num_entries' data-ref="423num_entries" data-ref-filename="423num_entries">num_entries</a>;</td></tr>
<tr><th id="1977">1977</th><td>		<b>if</b> (<a class="local col6 ref" href="#426last_pte" title='last_pte' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</a> &gt; <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>)</td></tr>
<tr><th id="1978">1978</th><td>			<a class="local col6 ref" href="#426last_pte" title='last_pte' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</a> = <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="1979">1979</th><td></td></tr>
<tr><th id="1980">1980</th><td>		<a class="local col0 ref" href="#420pt_vaddr" title='pt_vaddr' data-ref="420pt_vaddr" data-ref-filename="420pt_vaddr">pt_vaddr</a> = <a class="macro" href="#434" title="kmap_page_dma((&amp;(ppgtt-&gt;pd.page_table[act_pt])-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(<a class="local col9 ref" href="#419ppgtt" title='ppgtt' data-ref="419ppgtt" data-ref-filename="419ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col4 ref" href="#424act_pt" title='act_pt' data-ref="424act_pt" data-ref-filename="424act_pt">act_pt</a>]);</td></tr>
<tr><th id="1981">1981</th><td></td></tr>
<tr><th id="1982">1982</th><td>		<b>for</b> (<a class="local col7 ref" href="#427i" title='i' data-ref="427i" data-ref-filename="427i">i</a> = <a class="local col5 ref" href="#425first_pte" title='first_pte' data-ref="425first_pte" data-ref-filename="425first_pte">first_pte</a>; <a class="local col7 ref" href="#427i" title='i' data-ref="427i" data-ref-filename="427i">i</a> &lt; <a class="local col6 ref" href="#426last_pte" title='last_pte' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</a>; <a class="local col7 ref" href="#427i" title='i' data-ref="427i" data-ref-filename="427i">i</a>++)</td></tr>
<tr><th id="1983">1983</th><td>			<a class="local col0 ref" href="#420pt_vaddr" title='pt_vaddr' data-ref="420pt_vaddr" data-ref-filename="420pt_vaddr">pt_vaddr</a>[<a class="local col7 ref" href="#427i" title='i' data-ref="427i" data-ref-filename="427i">i</a>] = <a class="local col1 ref" href="#421scratch_pte" title='scratch_pte' data-ref="421scratch_pte" data-ref-filename="421scratch_pte">scratch_pte</a>;</td></tr>
<tr><th id="1984">1984</th><td></td></tr>
<tr><th id="1985">1985</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(<a class="local col9 ref" href="#419ppgtt" title='ppgtt' data-ref="419ppgtt" data-ref-filename="419ppgtt">ppgtt</a>, <a class="local col0 ref" href="#420pt_vaddr" title='pt_vaddr' data-ref="420pt_vaddr" data-ref-filename="420pt_vaddr">pt_vaddr</a>);</td></tr>
<tr><th id="1986">1986</th><td></td></tr>
<tr><th id="1987">1987</th><td>		<a class="local col3 ref" href="#423num_entries" title='num_entries' data-ref="423num_entries" data-ref-filename="423num_entries">num_entries</a> -= <a class="local col6 ref" href="#426last_pte" title='last_pte' data-ref="426last_pte" data-ref-filename="426last_pte">last_pte</a> - <a class="local col5 ref" href="#425first_pte" title='first_pte' data-ref="425first_pte" data-ref-filename="425first_pte">first_pte</a>;</td></tr>
<tr><th id="1988">1988</th><td>		<a class="local col5 ref" href="#425first_pte" title='first_pte' data-ref="425first_pte" data-ref-filename="425first_pte">first_pte</a> = <var>0</var>;</td></tr>
<tr><th id="1989">1989</th><td>		<a class="local col4 ref" href="#424act_pt" title='act_pt' data-ref="424act_pt" data-ref-filename="424act_pt">act_pt</a>++;</td></tr>
<tr><th id="1990">1990</th><td>	}</td></tr>
<tr><th id="1991">1991</th><td>}</td></tr>
<tr><th id="1992">1992</th><td></td></tr>
<tr><th id="1993">1993</th><td><u>#<span data-ppcond="1993">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="1994">1994</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="1995">1995</th><td>gen6_ppgtt_insert_entries(<b>struct</b> i915_address_space *vm, bus_dmamap_t dmamap,</td></tr>
<tr><th id="1996">1996</th><td>    uint64_t start, <b>enum</b> i915_cache_level cache_level, uint32_t flags)</td></tr>
<tr><th id="1997">1997</th><td>{</td></tr>
<tr><th id="1998">1998</th><td>	<b>struct</b> i915_hw_ppgtt *ppgtt =</td></tr>
<tr><th id="1999">1999</th><td>		container_of(vm, <b>struct</b> i915_hw_ppgtt, base);</td></tr>
<tr><th id="2000">2000</th><td>	gen6_pte_t *pt_vaddr;</td></tr>
<tr><th id="2001">2001</th><td>	<em>unsigned</em> first_entry = start &gt;&gt; PAGE_SHIFT;</td></tr>
<tr><th id="2002">2002</th><td>	<em>unsigned</em> act_pt = first_entry / GEN6_PTES;</td></tr>
<tr><th id="2003">2003</th><td>	<em>unsigned</em> act_pte = first_entry % GEN6_PTES;</td></tr>
<tr><th id="2004">2004</th><td>	<em>unsigned</em> seg;</td></tr>
<tr><th id="2005">2005</th><td></td></tr>
<tr><th id="2006">2006</th><td>	pt_vaddr = NULL;</td></tr>
<tr><th id="2007">2007</th><td>	KASSERT(<var>0</var> &lt; dmamap-&gt;dm_nsegs);</td></tr>
<tr><th id="2008">2008</th><td>	<b>for</b> (seg = <var>0</var>; seg &lt; dmamap-&gt;dm_nsegs; seg++) {</td></tr>
<tr><th id="2009">2009</th><td>		KASSERT(dmamap-&gt;dm_segs[seg].ds_len == PAGE_SIZE);</td></tr>
<tr><th id="2010">2010</th><td>		<b>if</b> (pt_vaddr == NULL)</td></tr>
<tr><th id="2011">2011</th><td>			pt_vaddr = kmap_px(ppgtt-&gt;pd.page_table[act_pt]);</td></tr>
<tr><th id="2012">2012</th><td>		pt_vaddr[act_pte] =</td></tr>
<tr><th id="2013">2013</th><td>		    vm-&gt;pte_encode(dmamap-&gt;dm_segs[seg].ds_addr, cache_level,</td></tr>
<tr><th id="2014">2014</th><td>			true, flags);</td></tr>
<tr><th id="2015">2015</th><td>		<b>if</b> (++act_pte == GEN6_PTES) {</td></tr>
<tr><th id="2016">2016</th><td>			kunmap_px(ppgtt, pt_vaddr);</td></tr>
<tr><th id="2017">2017</th><td>			pt_vaddr = NULL;</td></tr>
<tr><th id="2018">2018</th><td>			act_pt++;</td></tr>
<tr><th id="2019">2019</th><td>			act_pte = <var>0</var>;</td></tr>
<tr><th id="2020">2020</th><td>		}</td></tr>
<tr><th id="2021">2021</th><td>	}</td></tr>
<tr><th id="2022">2022</th><td>	<b>if</b> (pt_vaddr)</td></tr>
<tr><th id="2023">2023</th><td>		kunmap_px(ppgtt, pt_vaddr);</td></tr>
<tr><th id="2024">2024</th><td>}</td></tr>
<tr><th id="2025">2025</th><td><u>#<span data-ppcond="1993">else</span></u></td></tr>
<tr><th id="2026">2026</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ppgtt_insert_entries" title='gen6_ppgtt_insert_entries' data-type='void gen6_ppgtt_insert_entries(struct i915_address_space * vm, struct sg_table * pages, uint64_t start, enum i915_cache_level cache_level, u32 flags)' data-ref="gen6_ppgtt_insert_entries" data-ref-filename="gen6_ppgtt_insert_entries">gen6_ppgtt_insert_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="428vm" title='vm' data-type='struct i915_address_space *' data-ref="428vm" data-ref-filename="428vm">vm</dfn>,</td></tr>
<tr><th id="2027">2027</th><td>				      <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col9 decl" id="429pages" title='pages' data-type='struct sg_table *' data-ref="429pages" data-ref-filename="429pages">pages</dfn>,</td></tr>
<tr><th id="2028">2028</th><td>				      <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="430start" title='start' data-type='uint64_t' data-ref="430start" data-ref-filename="430start">start</dfn>,</td></tr>
<tr><th id="2029">2029</th><td>				      <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col1 decl" id="431cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="431cache_level" data-ref-filename="431cache_level">cache_level</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col2 decl" id="432flags" title='flags' data-type='u32' data-ref="432flags" data-ref-filename="432flags">flags</dfn>)</td></tr>
<tr><th id="2030">2030</th><td>{</td></tr>
<tr><th id="2031">2031</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col3 decl" id="433ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="433ppgtt" data-ref-filename="433ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="2032">2032</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col8 ref" href="#428vm" title='vm' data-ref="428vm" data-ref-filename="428vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2033">2033</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> *<dfn class="local col4 decl" id="434pt_vaddr" title='pt_vaddr' data-type='gen6_pte_t *' data-ref="434pt_vaddr" data-ref-filename="434pt_vaddr">pt_vaddr</dfn>;</td></tr>
<tr><th id="2034">2034</th><td>	<em>unsigned</em> <dfn class="local col5 decl" id="435first_entry" title='first_entry' data-type='unsigned int' data-ref="435first_entry" data-ref-filename="435first_entry">first_entry</dfn> = <a class="local col0 ref" href="#430start" title='start' data-ref="430start" data-ref-filename="430start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2035">2035</th><td>	<em>unsigned</em> <dfn class="local col6 decl" id="436act_pt" title='act_pt' data-type='unsigned int' data-ref="436act_pt" data-ref-filename="436act_pt">act_pt</dfn> = <a class="local col5 ref" href="#435first_entry" title='first_entry' data-ref="435first_entry" data-ref-filename="435first_entry">first_entry</a> / <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="2036">2036</th><td>	<em>unsigned</em> <dfn class="local col7 decl" id="437act_pte" title='act_pte' data-type='unsigned int' data-ref="437act_pte" data-ref-filename="437act_pte">act_pte</dfn> = <a class="local col5 ref" href="#435first_entry" title='first_entry' data-ref="435first_entry" data-ref-filename="435first_entry">first_entry</a> % <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>;</td></tr>
<tr><th id="2037">2037</th><td>	<b>struct</b> <dfn class="local col8 type" id="438sg_page_iter" title='sg_page_iter' data-ref="438sg_page_iter" data-ref-filename="438sg_page_iter"><a class="local col8 type" href="#438sg_page_iter" title='sg_page_iter' data-ref="438sg_page_iter" data-ref-filename="438sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col9 decl" id="439sg_iter" title='sg_iter' data-type='struct sg_page_iter' data-ref="439sg_iter" data-ref-filename="439sg_iter">sg_iter</dfn></span>;</td></tr>
<tr><th id="2038">2038</th><td></td></tr>
<tr><th id="2039">2039</th><td>	<a class="local col4 ref" href="#434pt_vaddr" title='pt_vaddr' data-ref="434pt_vaddr" data-ref-filename="434pt_vaddr">pt_vaddr</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2040">2040</th><td>	for_each_sg_page(pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, &amp;sg_iter, pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents, <var>0</var>) {</td></tr>
<tr><th id="2041">2041</th><td>		<b>if</b> (pt_vaddr == <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="2042">2042</th><td>			pt_vaddr = <a class="macro" href="#434" title="kmap_page_dma((&amp;(ppgtt-&gt;pd.page_table[act_pt])-&gt;base))" data-ref="_M/kmap_px">kmap_px</a>(ppgtt-&gt;pd.page_table[act_pt]);</td></tr>
<tr><th id="2043">2043</th><td></td></tr>
<tr><th id="2044">2044</th><td>		pt_vaddr[act_pte] =</td></tr>
<tr><th id="2045">2045</th><td>			vm-&gt;pte_encode(sg_page_iter_dma_address(&amp;sg_iter),</td></tr>
<tr><th id="2046">2046</th><td>				       cache_level, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, flags);</td></tr>
<tr><th id="2047">2047</th><td></td></tr>
<tr><th id="2048">2048</th><td>		<b>if</b> (++act_pte == <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>) {</td></tr>
<tr><th id="2049">2049</th><td>			<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(ppgtt, pt_vaddr);</td></tr>
<tr><th id="2050">2050</th><td>			pt_vaddr = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="2051">2051</th><td>			act_pt++;</td></tr>
<tr><th id="2052">2052</th><td>			act_pte = <var>0</var>;</td></tr>
<tr><th id="2053">2053</th><td>		}</td></tr>
<tr><th id="2054">2054</th><td>	}</td></tr>
<tr><th id="2055">2055</th><td>	<b>if</b> (pt_vaddr)</td></tr>
<tr><th id="2056">2056</th><td>		<a class="macro" href="#435" title="kunmap_page_dma((ppgtt)-&gt;base.dev, (pt_vaddr))" data-ref="_M/kunmap_px">kunmap_px</a>(ppgtt, pt_vaddr);</td></tr>
<tr><th id="2057">2057</th><td>}</td></tr>
<tr><th id="2058">2058</th><td><u>#<span data-ppcond="1993">endif</span></u></td></tr>
<tr><th id="2059">2059</th><td></td></tr>
<tr><th id="2060">2060</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_alloc_va_range" title='gen6_alloc_va_range' data-type='int gen6_alloc_va_range(struct i915_address_space * vm, uint64_t start_in, uint64_t length_in)' data-ref="gen6_alloc_va_range" data-ref-filename="gen6_alloc_va_range">gen6_alloc_va_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="440vm" title='vm' data-type='struct i915_address_space *' data-ref="440vm" data-ref-filename="440vm">vm</dfn>,</td></tr>
<tr><th id="2061">2061</th><td>			       <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="441start_in" title='start_in' data-type='uint64_t' data-ref="441start_in" data-ref-filename="441start_in">start_in</dfn>, <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="442length_in" title='length_in' data-type='uint64_t' data-ref="442length_in" data-ref-filename="442length_in">length_in</dfn>)</td></tr>
<tr><th id="2062">2062</th><td>{</td></tr>
<tr><th id="2063">2063</th><td>	<a class="macro" href="../../../include/linux/types.h.html#91" title="unsigned long new_page_tables[((512) + ((8*sizeof(unsigned long)) - 1)) / (8*sizeof(unsigned long))]" data-ref="_M/DECLARE_BITMAP">DECLARE_BITMAP</a>(<dfn class="local col3 decl" id="443new_page_tables" title='new_page_tables' data-type='unsigned long [8]' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</dfn>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>);</td></tr>
<tr><th id="2064">2064</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="444dev" title='dev' data-type='struct drm_device *' data-ref="444dev" data-ref-filename="444dev">dev</dfn> = <a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2065">2065</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="445dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="445dev_priv" data-ref-filename="445dev_priv">dev_priv</dfn> = <a class="local col4 ref" href="#444dev" title='dev' data-ref="444dev" data-ref-filename="444dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2066">2066</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="446ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="2067">2067</th><td>				<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2068">2068</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col7 decl" id="447pt" title='pt' data-type='struct i915_page_table *' data-ref="447pt" data-ref-filename="447pt">pt</dfn>;</td></tr>
<tr><th id="2069">2069</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col8 decl" id="448start" title='start' data-type='uint32_t' data-ref="448start" data-ref-filename="448start">start</dfn>, <dfn class="local col9 decl" id="449length" title='length' data-type='uint32_t' data-ref="449length" data-ref-filename="449length">length</dfn>, <dfn class="local col0 decl" id="450start_save" title='start_save' data-type='uint32_t' data-ref="450start_save" data-ref-filename="450start_save">start_save</dfn>, <dfn class="local col1 decl" id="451length_save" title='length_save' data-type='uint32_t' data-ref="451length_save" data-ref-filename="451length_save">length_save</dfn>;</td></tr>
<tr><th id="2070">2070</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col2 decl" id="452pde" title='pde' data-type='uint32_t' data-ref="452pde" data-ref-filename="452pde">pde</dfn>, <dfn class="local col3 decl" id="453temp" title='temp' data-type='uint32_t' data-ref="453temp" data-ref-filename="453temp">temp</dfn>;</td></tr>
<tr><th id="2071">2071</th><td>	<em>int</em> <dfn class="local col4 decl" id="454ret" title='ret' data-type='int' data-ref="454ret" data-ref-filename="454ret">ret</dfn>;</td></tr>
<tr><th id="2072">2072</th><td></td></tr>
<tr><th id="2073">2073</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((start_in + length_in &gt; ppgtt-&gt;base.total))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2073, &quot;start_in + length_in &gt; ppgtt-&gt;base.total&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col1 ref" href="#441start_in" title='start_in' data-ref="441start_in" data-ref-filename="441start_in">start_in</a> + <a class="local col2 ref" href="#442length_in" title='length_in' data-ref="442length_in" data-ref-filename="442length_in">length_in</a> &gt; <a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>))</td></tr>
<tr><th id="2074">2074</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#61" title="19" data-ref="_M/ENODEV">ENODEV</a>;</td></tr>
<tr><th id="2075">2075</th><td></td></tr>
<tr><th id="2076">2076</th><td>	<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a> = <a class="local col0 ref" href="#450start_save" title='start_save' data-ref="450start_save" data-ref-filename="450start_save">start_save</a> = <a class="local col1 ref" href="#441start_in" title='start_in' data-ref="441start_in" data-ref-filename="441start_in">start_in</a>;</td></tr>
<tr><th id="2077">2077</th><td>	<a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a> = <a class="local col1 ref" href="#451length_save" title='length_save' data-ref="451length_save" data-ref-filename="451length_save">length_save</a> = <a class="local col2 ref" href="#442length_in" title='length_in' data-ref="442length_in" data-ref-filename="442length_in">length_in</a>;</td></tr>
<tr><th id="2078">2078</th><td></td></tr>
<tr><th id="2079">2079</th><td>	<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_zero" title='bitmap_zero' data-ref="bitmap_zero" data-ref-filename="bitmap_zero">bitmap_zero</a>(<a class="local col3 ref" href="#2063" title='new_page_tables' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</a>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>);</td></tr>
<tr><th id="2080">2080</th><td></td></tr>
<tr><th id="2081">2081</th><td>	<i>/* The allocation is done in two stages so that we can bail out with</i></td></tr>
<tr><th id="2082">2082</th><td><i>	 * minimal amount of pain. The first stage finds new page tables that</i></td></tr>
<tr><th id="2083">2083</th><td><i>	 * need allocation. The second stage marks use ptes within the page</i></td></tr>
<tr><th id="2084">2084</th><td><i>	 * tables.</i></td></tr>
<tr><th id="2085">2085</th><td><i>	 */</i></td></tr>
<tr><th id="2086">2086</th><td>	<a class="macro" href="i915_gem_gtt.h.html#449" title="for (pde = gen6_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (&amp;ppgtt-&gt;pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen6_for_each_pde">gen6_for_each_pde</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>, &amp;<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>, <a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a>, temp, <a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>) {</td></tr>
<tr><th id="2087">2087</th><td>		<b>if</b> (<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a> != <a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>) {</td></tr>
<tr><th id="2088">2088</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((bitmap_empty(pt-&gt;used_ptes, ((1 &lt;&lt; 12) / (sizeof(gen6_pte_t))))))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2088, &quot;bitmap_empty(pt-&gt;used_ptes, GEN6_PTES)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_empty" title='bitmap_empty' data-ref="bitmap_empty" data-ref-filename="bitmap_empty">bitmap_empty</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>, <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>));</td></tr>
<tr><th id="2089">2089</th><td>			<b>continue</b>;</td></tr>
<tr><th id="2090">2090</th><td>		}</td></tr>
<tr><th id="2091">2091</th><td></td></tr>
<tr><th id="2092">2092</th><td>		<i>/* We've already allocated a page table */</i></td></tr>
<tr><th id="2093">2093</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!bitmap_empty(pt-&gt;used_ptes, ((1 &lt;&lt; 12) / (sizeof(gen6_pte_t))))))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2093, &quot;!bitmap_empty(pt-&gt;used_ptes, GEN6_PTES)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_empty" title='bitmap_empty' data-ref="bitmap_empty" data-ref-filename="bitmap_empty">bitmap_empty</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>, <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>));</td></tr>
<tr><th id="2094">2094</th><td></td></tr>
<tr><th id="2095">2095</th><td>		<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a> = <a class="tu ref fn" href="#alloc_pt" title='alloc_pt' data-use='c' data-ref="alloc_pt" data-ref-filename="alloc_pt">alloc_pt</a>(<a class="local col4 ref" href="#444dev" title='dev' data-ref="444dev" data-ref-filename="444dev">dev</a>);</td></tr>
<tr><th id="2096">2096</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>)) {</td></tr>
<tr><th id="2097">2097</th><td>			<a class="local col4 ref" href="#454ret" title='ret' data-ref="454ret" data-ref-filename="454ret">ret</a> = <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>);</td></tr>
<tr><th id="2098">2098</th><td>			<b>goto</b> <a class="lbl" href="#455unwind_out" data-ref="455unwind_out" data-ref-filename="455unwind_out">unwind_out</a>;</td></tr>
<tr><th id="2099">2099</th><td>		}</td></tr>
<tr><th id="2100">2100</th><td></td></tr>
<tr><th id="2101">2101</th><td>		<a class="tu ref fn" href="#gen6_initialize_pt" title='gen6_initialize_pt' data-use='c' data-ref="gen6_initialize_pt" data-ref-filename="gen6_initialize_pt">gen6_initialize_pt</a>(<a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>, <a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>);</td></tr>
<tr><th id="2102">2102</th><td></td></tr>
<tr><th id="2103">2103</th><td>		<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>] = <a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>;</td></tr>
<tr><th id="2104">2104</th><td>		<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__set_bit" title='__set_bit' data-ref="__set_bit" data-ref-filename="__set_bit">__set_bit</a>(<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col3 ref" href="#2063" title='new_page_tables' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</a>);</td></tr>
<tr><th id="2105">2105</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_table_entry_alloc" title='trace_i915_page_table_entry_alloc' data-ref="trace_i915_page_table_entry_alloc" data-ref-filename="trace_i915_page_table_entry_alloc">trace_i915_page_table_entry_alloc</a>(<a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>, <a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>, <a class="macro" href="i915_gem_gtt.h.html#67" title="22" data-ref="_M/GEN6_PDE_SHIFT">GEN6_PDE_SHIFT</a>);</td></tr>
<tr><th id="2106">2106</th><td>	}</td></tr>
<tr><th id="2107">2107</th><td></td></tr>
<tr><th id="2108">2108</th><td>	<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a> = <a class="local col0 ref" href="#450start_save" title='start_save' data-ref="450start_save" data-ref-filename="450start_save">start_save</a>;</td></tr>
<tr><th id="2109">2109</th><td>	<a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a> = <a class="local col1 ref" href="#451length_save" title='length_save' data-ref="451length_save" data-ref-filename="451length_save">length_save</a>;</td></tr>
<tr><th id="2110">2110</th><td></td></tr>
<tr><th id="2111">2111</th><td>	<a class="macro" href="i915_gem_gtt.h.html#449" title="for (pde = gen6_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (pt = (&amp;ppgtt-&gt;pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen6_for_each_pde">gen6_for_each_pde</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>, &amp;<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>, <a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a>, temp, <a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>) {</td></tr>
<tr><th id="2112">2112</th><td>		<a class="macro" href="../../../include/linux/types.h.html#91" title="unsigned long tmp_bitmap[((((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))) + ((8*sizeof(unsigned long)) - 1)) / (8*sizeof(unsigned long))]" data-ref="_M/DECLARE_BITMAP">DECLARE_BITMAP</a>(<dfn class="local col6 decl" id="456tmp_bitmap" title='tmp_bitmap' data-type='unsigned long [16]' data-ref="456tmp_bitmap" data-ref-filename="456tmp_bitmap">tmp_bitmap</dfn>, <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>);</td></tr>
<tr><th id="2113">2113</th><td></td></tr>
<tr><th id="2114">2114</th><td>		<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_zero" title='bitmap_zero' data-ref="bitmap_zero" data-ref-filename="bitmap_zero">bitmap_zero</a>(<a class="local col6 ref" href="#2112" title='tmp_bitmap' data-ref="456tmp_bitmap" data-ref-filename="456tmp_bitmap">tmp_bitmap</a>, <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>);</td></tr>
<tr><th id="2115">2115</th><td>		<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_set" title='bitmap_set' data-ref="bitmap_set" data-ref-filename="bitmap_set">bitmap_set</a>(<a class="local col6 ref" href="#2112" title='tmp_bitmap' data-ref="456tmp_bitmap" data-ref-filename="456tmp_bitmap">tmp_bitmap</a>, <a class="ref fn" href="i915_gem_gtt.h.html#gen6_pte_index" title='gen6_pte_index' data-ref="gen6_pte_index" data-ref-filename="gen6_pte_index">gen6_pte_index</a>(<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>),</td></tr>
<tr><th id="2116">2116</th><td>			   <a class="ref fn" href="i915_gem_gtt.h.html#gen6_pte_count" title='gen6_pte_count' data-ref="gen6_pte_count" data-ref-filename="gen6_pte_count">gen6_pte_count</a>(<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>, <a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a>));</td></tr>
<tr><th id="2117">2117</th><td></td></tr>
<tr><th id="2118">2118</th><td>		<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/bitops.h.html#__test_and_clear_bit" title='__test_and_clear_bit' data-ref="__test_and_clear_bit" data-ref-filename="__test_and_clear_bit">__test_and_clear_bit</a>(<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col3 ref" href="#2063" title='new_page_tables' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</a>))</td></tr>
<tr><th id="2119">2119</th><td>			<a class="tu ref fn" href="#gen6_write_pde" title='gen6_write_pde' data-use='c' data-ref="gen6_write_pde" data-ref-filename="gen6_write_pde">gen6_write_pde</a>(&amp;<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>);</td></tr>
<tr><th id="2120">2120</th><td></td></tr>
<tr><th id="2121">2121</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_page_table_entry_map" title='trace_i915_page_table_entry_map' data-ref="trace_i915_page_table_entry_map" data-ref-filename="trace_i915_page_table_entry_map">trace_i915_page_table_entry_map</a>(<a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>, <a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>,</td></tr>
<tr><th id="2122">2122</th><td>					 <a class="ref fn" href="i915_gem_gtt.h.html#gen6_pte_index" title='gen6_pte_index' data-ref="gen6_pte_index" data-ref-filename="gen6_pte_index">gen6_pte_index</a>(<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>),</td></tr>
<tr><th id="2123">2123</th><td>					 <a class="ref fn" href="i915_gem_gtt.h.html#gen6_pte_count" title='gen6_pte_count' data-ref="gen6_pte_count" data-ref-filename="gen6_pte_count">gen6_pte_count</a>(<a class="local col8 ref" href="#448start" title='start' data-ref="448start" data-ref-filename="448start">start</a>, <a class="local col9 ref" href="#449length" title='length' data-ref="449length" data-ref-filename="449length">length</a>),</td></tr>
<tr><th id="2124">2124</th><td>					 <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>);</td></tr>
<tr><th id="2125">2125</th><td>		<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_or" title='bitmap_or' data-ref="bitmap_or" data-ref-filename="bitmap_or">bitmap_or</a>(<a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>, <a class="local col6 ref" href="#2112" title='tmp_bitmap' data-ref="456tmp_bitmap" data-ref-filename="456tmp_bitmap">tmp_bitmap</a>, <a class="local col7 ref" href="#447pt" title='pt' data-ref="447pt" data-ref-filename="447pt">pt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_page_table::used_ptes" title='i915_page_table::used_ptes' data-ref="i915_page_table::used_ptes" data-ref-filename="i915_page_table..used_ptes">used_ptes</a>,</td></tr>
<tr><th id="2126">2126</th><td>				<a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a>);</td></tr>
<tr><th id="2127">2127</th><td>	}</td></tr>
<tr><th id="2128">2128</th><td></td></tr>
<tr><th id="2129">2129</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!bitmap_empty(new_page_tables, 512)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2129, &quot;!bitmap_empty(new_page_tables, I915_PDES)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../include/linux/bitmap.h.html#bitmap_empty" title='bitmap_empty' data-ref="bitmap_empty" data-ref-filename="bitmap_empty">bitmap_empty</a>(<a class="local col3 ref" href="#2063" title='new_page_tables' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</a>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>));</td></tr>
<tr><th id="2130">2130</th><td></td></tr>
<tr><th id="2131">2131</th><td>	<i>/* Make sure write is complete before other code can use this page</i></td></tr>
<tr><th id="2132">2132</th><td><i>	 * table. Also require for WC mapped PTEs */</i></td></tr>
<tr><th id="2133">2133</th><td><u>#<span data-ppcond="2133">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2134">2134</th><td>	bus_space_read_4(dev_priv-&gt;gtt.bst, dev_priv-&gt;gtt.bsh, <var>0</var>);</td></tr>
<tr><th id="2135">2135</th><td><u>#<span data-ppcond="2133">else</span></u></td></tr>
<tr><th id="2136">2136</th><td>	readl(dev_priv-&gt;gtt.gsm);</td></tr>
<tr><th id="2137">2137</th><td><u>#<span data-ppcond="2133">endif</span></u></td></tr>
<tr><th id="2138">2138</th><td></td></tr>
<tr><th id="2139">2139</th><td>	<a class="tu ref fn" href="#mark_tlbs_dirty" title='mark_tlbs_dirty' data-use='c' data-ref="mark_tlbs_dirty" data-ref-filename="mark_tlbs_dirty">mark_tlbs_dirty</a>(<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2140">2140</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2141">2141</th><td></td></tr>
<tr><th id="2142">2142</th><td><dfn class="lbl" id="455unwind_out" data-ref="455unwind_out" data-ref-filename="455unwind_out">unwind_out</dfn>:</td></tr>
<tr><th id="2143">2143</th><td>	<a class="macro" href="../../../../common/include/linux/bitops.h.html#269" title="for ((pde) = find_first_bit((new_page_tables), (512)); (pde) &lt; (512); (pde) = find_next_bit((new_page_tables), (512), (pde) + 1))" data-ref="_M/for_each_set_bit">for_each_set_bit</a>(<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>, <a class="local col3 ref" href="#2063" title='new_page_tables' data-ref="443new_page_tables" data-ref-filename="443new_page_tables">new_page_tables</a>, <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a>) {</td></tr>
<tr><th id="2144">2144</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col7 decl" id="457pt" title='pt' data-type='struct i915_page_table *' data-ref="457pt" data-ref-filename="457pt">pt</dfn> = <a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>];</td></tr>
<tr><th id="2145">2145</th><td></td></tr>
<tr><th id="2146">2146</th><td>		<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col2 ref" href="#452pde" title='pde' data-ref="452pde" data-ref-filename="452pde">pde</a>] = <a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>;</td></tr>
<tr><th id="2147">2147</th><td>		<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col0 ref" href="#440vm" title='vm' data-ref="440vm" data-ref-filename="440vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col7 ref" href="#457pt" title='pt' data-ref="457pt" data-ref-filename="457pt">pt</a>);</td></tr>
<tr><th id="2148">2148</th><td>	}</td></tr>
<tr><th id="2149">2149</th><td></td></tr>
<tr><th id="2150">2150</th><td>	<a class="tu ref fn" href="#mark_tlbs_dirty" title='mark_tlbs_dirty' data-use='c' data-ref="mark_tlbs_dirty" data-ref-filename="mark_tlbs_dirty">mark_tlbs_dirty</a>(<a class="local col6 ref" href="#446ppgtt" title='ppgtt' data-ref="446ppgtt" data-ref-filename="446ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2151">2151</th><td>	<b>return</b> <a class="local col4 ref" href="#454ret" title='ret' data-ref="454ret" data-ref-filename="454ret">ret</a>;</td></tr>
<tr><th id="2152">2152</th><td>}</td></tr>
<tr><th id="2153">2153</th><td></td></tr>
<tr><th id="2154">2154</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_init_scratch" title='gen6_init_scratch' data-type='int gen6_init_scratch(struct i915_address_space * vm)' data-ref="gen6_init_scratch" data-ref-filename="gen6_init_scratch">gen6_init_scratch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="458vm" title='vm' data-type='struct i915_address_space *' data-ref="458vm" data-ref-filename="458vm">vm</dfn>)</td></tr>
<tr><th id="2155">2155</th><td>{</td></tr>
<tr><th id="2156">2156</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="459dev" title='dev' data-type='struct drm_device *' data-ref="459dev" data-ref-filename="459dev">dev</dfn> = <a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2157">2157</th><td></td></tr>
<tr><th id="2158">2158</th><td>	<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a> = <a class="tu ref fn" href="#alloc_scratch_page" title='alloc_scratch_page' data-use='c' data-ref="alloc_scratch_page" data-ref-filename="alloc_scratch_page">alloc_scratch_page</a>(<a class="local col9 ref" href="#459dev" title='dev' data-ref="459dev" data-ref-filename="459dev">dev</a>);</td></tr>
<tr><th id="2159">2159</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>))</td></tr>
<tr><th id="2160">2160</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="2161">2161</th><td></td></tr>
<tr><th id="2162">2162</th><td>	<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a> = <a class="tu ref fn" href="#alloc_pt" title='alloc_pt' data-use='c' data-ref="alloc_pt" data-ref-filename="alloc_pt">alloc_pt</a>(<a class="local col9 ref" href="#459dev" title='dev' data-ref="459dev" data-ref-filename="459dev">dev</a>);</td></tr>
<tr><th id="2163">2163</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>)) {</td></tr>
<tr><th id="2164">2164</th><td>		<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col9 ref" href="#459dev" title='dev' data-ref="459dev" data-ref-filename="459dev">dev</a>, <a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="2165">2165</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="2166">2166</th><td>	}</td></tr>
<tr><th id="2167">2167</th><td></td></tr>
<tr><th id="2168">2168</th><td>	<a class="tu ref fn" href="#gen6_initialize_pt" title='gen6_initialize_pt' data-use='c' data-ref="gen6_initialize_pt" data-ref-filename="gen6_initialize_pt">gen6_initialize_pt</a>(<a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>, <a class="local col8 ref" href="#458vm" title='vm' data-ref="458vm" data-ref-filename="458vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="2169">2169</th><td></td></tr>
<tr><th id="2170">2170</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2171">2171</th><td>}</td></tr>
<tr><th id="2172">2172</th><td></td></tr>
<tr><th id="2173">2173</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_free_scratch" title='gen6_free_scratch' data-type='void gen6_free_scratch(struct i915_address_space * vm)' data-ref="gen6_free_scratch" data-ref-filename="gen6_free_scratch">gen6_free_scratch</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="460vm" title='vm' data-type='struct i915_address_space *' data-ref="460vm" data-ref-filename="460vm">vm</dfn>)</td></tr>
<tr><th id="2174">2174</th><td>{</td></tr>
<tr><th id="2175">2175</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col1 decl" id="461dev" title='dev' data-type='struct drm_device *' data-ref="461dev" data-ref-filename="461dev">dev</dfn> = <a class="local col0 ref" href="#460vm" title='vm' data-ref="460vm" data-ref-filename="460vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2176">2176</th><td></td></tr>
<tr><th id="2177">2177</th><td>	<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col1 ref" href="#461dev" title='dev' data-ref="461dev" data-ref-filename="461dev">dev</a>, <a class="local col0 ref" href="#460vm" title='vm' data-ref="460vm" data-ref-filename="460vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>);</td></tr>
<tr><th id="2178">2178</th><td>	<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col1 ref" href="#461dev" title='dev' data-ref="461dev" data-ref-filename="461dev">dev</a>, <a class="local col0 ref" href="#460vm" title='vm' data-ref="460vm" data-ref-filename="460vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="2179">2179</th><td>}</td></tr>
<tr><th id="2180">2180</th><td></td></tr>
<tr><th id="2181">2181</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ppgtt_cleanup" title='gen6_ppgtt_cleanup' data-type='void gen6_ppgtt_cleanup(struct i915_address_space * vm)' data-ref="gen6_ppgtt_cleanup" data-ref-filename="gen6_ppgtt_cleanup">gen6_ppgtt_cleanup</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col2 decl" id="462vm" title='vm' data-type='struct i915_address_space *' data-ref="462vm" data-ref-filename="462vm">vm</dfn>)</td></tr>
<tr><th id="2182">2182</th><td>{</td></tr>
<tr><th id="2183">2183</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col3 decl" id="463ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="463ppgtt" data-ref-filename="463ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="2184">2184</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col2 ref" href="#462vm" title='vm' data-ref="462vm" data-ref-filename="462vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2185">2185</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col4 decl" id="464pt" title='pt' data-type='struct i915_page_table *' data-ref="464pt" data-ref-filename="464pt">pt</dfn>;</td></tr>
<tr><th id="2186">2186</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col5 decl" id="465pde" title='pde' data-type='uint32_t' data-ref="465pde" data-ref-filename="465pde">pde</dfn>;</td></tr>
<tr><th id="2187">2187</th><td></td></tr>
<tr><th id="2188">2188</th><td>	<a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_remove_node" title='drm_mm_remove_node' data-ref="drm_mm_remove_node" data-ref-filename="drm_mm_remove_node">drm_mm_remove_node</a>(&amp;<a class="local col3 ref" href="#463ppgtt" title='ppgtt' data-ref="463ppgtt" data-ref-filename="463ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::node" title='i915_hw_ppgtt::node' data-ref="i915_hw_ppgtt::node" data-ref-filename="i915_hw_ppgtt..node">node</a>);</td></tr>
<tr><th id="2189">2189</th><td></td></tr>
<tr><th id="2190">2190</th><td>	<a class="macro" href="i915_gem_gtt.h.html#459" title="for (pde = 0; pt = ppgtt-&gt;pd.page_table[pde], pde &lt; 512; pde++)" data-ref="_M/gen6_for_all_pdes">gen6_for_all_pdes</a>(<a class="local col4 ref" href="#464pt" title='pt' data-ref="464pt" data-ref-filename="464pt">pt</a>, <a class="local col3 ref" href="#463ppgtt" title='ppgtt' data-ref="463ppgtt" data-ref-filename="463ppgtt">ppgtt</a>, <a class="local col5 ref" href="#465pde" title='pde' data-ref="465pde" data-ref-filename="465pde">pde</a>) {</td></tr>
<tr><th id="2191">2191</th><td>		<b>if</b> (<a class="local col4 ref" href="#464pt" title='pt' data-ref="464pt" data-ref-filename="464pt">pt</a> != <a class="local col2 ref" href="#462vm" title='vm' data-ref="462vm" data-ref-filename="462vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>)</td></tr>
<tr><th id="2192">2192</th><td>			<a class="tu ref fn" href="#free_pt" title='free_pt' data-use='c' data-ref="free_pt" data-ref-filename="free_pt">free_pt</a>(<a class="local col3 ref" href="#463ppgtt" title='ppgtt' data-ref="463ppgtt" data-ref-filename="463ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col4 ref" href="#464pt" title='pt' data-ref="464pt" data-ref-filename="464pt">pt</a>);</td></tr>
<tr><th id="2193">2193</th><td>	}</td></tr>
<tr><th id="2194">2194</th><td></td></tr>
<tr><th id="2195">2195</th><td>	<a class="tu ref fn" href="#gen6_free_scratch" title='gen6_free_scratch' data-use='c' data-ref="gen6_free_scratch" data-ref-filename="gen6_free_scratch">gen6_free_scratch</a>(<a class="local col2 ref" href="#462vm" title='vm' data-ref="462vm" data-ref-filename="462vm">vm</a>);</td></tr>
<tr><th id="2196">2196</th><td>}</td></tr>
<tr><th id="2197">2197</th><td></td></tr>
<tr><th id="2198">2198</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_ppgtt_allocate_page_directories" title='gen6_ppgtt_allocate_page_directories' data-type='int gen6_ppgtt_allocate_page_directories(struct i915_hw_ppgtt * ppgtt)' data-ref="gen6_ppgtt_allocate_page_directories" data-ref-filename="gen6_ppgtt_allocate_page_directories">gen6_ppgtt_allocate_page_directories</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="466ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="466ppgtt" data-ref-filename="466ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="2199">2199</th><td>{</td></tr>
<tr><th id="2200">2200</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col7 decl" id="467vm" title='vm' data-type='struct i915_address_space *' data-ref="467vm" data-ref-filename="467vm">vm</dfn> = &amp;<a class="local col6 ref" href="#466ppgtt" title='ppgtt' data-ref="466ppgtt" data-ref-filename="466ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>;</td></tr>
<tr><th id="2201">2201</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col8 decl" id="468dev" title='dev' data-type='struct drm_device *' data-ref="468dev" data-ref-filename="468dev">dev</dfn> = <a class="local col6 ref" href="#466ppgtt" title='ppgtt' data-ref="466ppgtt" data-ref-filename="466ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2202">2202</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="469dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="469dev_priv" data-ref-filename="469dev_priv">dev_priv</dfn> = <a class="local col8 ref" href="#468dev" title='dev' data-ref="468dev" data-ref-filename="468dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2203">2203</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col0 decl" id="470retried" title='retried' data-type='_Bool' data-ref="470retried" data-ref-filename="470retried">retried</dfn> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="2204">2204</th><td>	<em>int</em> <dfn class="local col1 decl" id="471ret" title='ret' data-type='int' data-ref="471ret" data-ref-filename="471ret">ret</dfn>;</td></tr>
<tr><th id="2205">2205</th><td></td></tr>
<tr><th id="2206">2206</th><td>	<i>/* PPGTT PDEs reside in the GGTT and consists of 512 entries. The</i></td></tr>
<tr><th id="2207">2207</th><td><i>	 * allocator works in address space sizes, so it's multiplied by page</i></td></tr>
<tr><th id="2208">2208</th><td><i>	 * size. We allocate at the top of the GTT to avoid fragmentation.</i></td></tr>
<tr><th id="2209">2209</th><td><i>	 */</i></td></tr>
<tr><th id="2210">2210</th><td>	<a class="macro" href="../../../include/asm/bug.h.html#39" title="(__builtin_expect(((!(!drm_mm_initialized(&amp;dev_priv-&gt;gtt.base.mm)))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;!(!drm_mm_initialized(&amp;dev_priv-&gt;gtt.base.mm))&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2210))" data-ref="_M/BUG_ON">BUG_ON</a>(!drm_mm_initialized(&amp;dev_priv-&gt;gtt.base.mm));</td></tr>
<tr><th id="2211">2211</th><td></td></tr>
<tr><th id="2212">2212</th><td>	<a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a> = <a class="tu ref fn" href="#gen6_init_scratch" title='gen6_init_scratch' data-use='c' data-ref="gen6_init_scratch" data-ref-filename="gen6_init_scratch">gen6_init_scratch</a>(<a class="local col7 ref" href="#467vm" title='vm' data-ref="467vm" data-ref-filename="467vm">vm</a>);</td></tr>
<tr><th id="2213">2213</th><td>	<b>if</b> (<a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a>)</td></tr>
<tr><th id="2214">2214</th><td>		<b>return</b> <a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a>;</td></tr>
<tr><th id="2215">2215</th><td></td></tr>
<tr><th id="2216">2216</th><td><dfn class="lbl" id="472alloc" data-ref="472alloc" data-ref-filename="472alloc">alloc</dfn>:</td></tr>
<tr><th id="2217">2217</th><td>	ret = drm_mm_insert_node_in_range_generic(&amp;dev_priv-&gt;gtt.base.mm,</td></tr>
<tr><th id="2218">2218</th><td>						  &amp;ppgtt-&gt;node, <a class="macro" href="i915_gem_gtt.h.html#65" title="(512 * (1 &lt;&lt; 12))" data-ref="_M/GEN6_PD_SIZE">GEN6_PD_SIZE</a>,</td></tr>
<tr><th id="2219">2219</th><td>						  <a class="macro" href="i915_gem_gtt.h.html#66" title="((1 &lt;&lt; 12) * 16)" data-ref="_M/GEN6_PD_ALIGN">GEN6_PD_ALIGN</a>, <var>0</var>,</td></tr>
<tr><th id="2220">2220</th><td>						  <var>0</var>, dev_priv-&gt;gtt.base.total,</td></tr>
<tr><th id="2221">2221</th><td>						  <a class="macro" href="../../include/drm/drm_mm.h.html#62" title="DRM_MM_SEARCH_BELOW, DRM_MM_CREATE_TOP" data-ref="_M/DRM_MM_TOPDOWN">DRM_MM_TOPDOWN</a>);</td></tr>
<tr><th id="2222">2222</th><td>	<b>if</b> (<a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a> == -<a class="macro" href="../../../../../../sys/errno.h.html#70" title="28" data-ref="_M/ENOSPC">ENOSPC</a> &amp;&amp; !<a class="local col0 ref" href="#470retried" title='retried' data-ref="470retried" data-ref-filename="470retried">retried</a>) {</td></tr>
<tr><th id="2223">2223</th><td>		ret = i915_gem_evict_something(dev, &amp;dev_priv-&gt;gtt.base,</td></tr>
<tr><th id="2224">2224</th><td>					       <a class="macro" href="i915_gem_gtt.h.html#65" title="(512 * (1 &lt;&lt; 12))" data-ref="_M/GEN6_PD_SIZE">GEN6_PD_SIZE</a>, <a class="macro" href="i915_gem_gtt.h.html#66" title="((1 &lt;&lt; 12) * 16)" data-ref="_M/GEN6_PD_ALIGN">GEN6_PD_ALIGN</a>,</td></tr>
<tr><th id="2225">2225</th><td>					       I915_CACHE_NONE,</td></tr>
<tr><th id="2226">2226</th><td>					       <var>0</var>, dev_priv-&gt;gtt.base.total,</td></tr>
<tr><th id="2227">2227</th><td>					       <var>0</var>);</td></tr>
<tr><th id="2228">2228</th><td>		<b>if</b> (<a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a>)</td></tr>
<tr><th id="2229">2229</th><td>			<b>goto</b> <a class="lbl" href="#473err_out" data-ref="473err_out" data-ref-filename="473err_out">err_out</a>;</td></tr>
<tr><th id="2230">2230</th><td></td></tr>
<tr><th id="2231">2231</th><td>		<a class="local col0 ref" href="#470retried" title='retried' data-ref="470retried" data-ref-filename="470retried">retried</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="2232">2232</th><td>		<b>goto</b> <a class="lbl" href="#472alloc" data-ref="472alloc" data-ref-filename="472alloc">alloc</a>;</td></tr>
<tr><th id="2233">2233</th><td>	}</td></tr>
<tr><th id="2234">2234</th><td></td></tr>
<tr><th id="2235">2235</th><td>	<b>if</b> (<a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a>)</td></tr>
<tr><th id="2236">2236</th><td>		<b>goto</b> <a class="lbl" href="#473err_out" data-ref="473err_out" data-ref-filename="473err_out">err_out</a>;</td></tr>
<tr><th id="2237">2237</th><td></td></tr>
<tr><th id="2238">2238</th><td></td></tr>
<tr><th id="2239">2239</th><td>	<b>if</b> (ppgtt-&gt;node.start &lt; dev_priv-&gt;gtt.mappable_end)</td></tr>
<tr><th id="2240">2240</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#228" title="do { if (__builtin_expect((drm_debug &amp; 0x01) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Forced to use aperture for PDEs\n&quot;); } while (0)" data-ref="_M/DRM_DEBUG">DRM_DEBUG</a>(<q>"Forced to use aperture for PDEs\n"</q>);</td></tr>
<tr><th id="2241">2241</th><td></td></tr>
<tr><th id="2242">2242</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2243">2243</th><td></td></tr>
<tr><th id="2244">2244</th><td><dfn class="lbl" id="473err_out" data-ref="473err_out" data-ref-filename="473err_out">err_out</dfn>:</td></tr>
<tr><th id="2245">2245</th><td>	<a class="tu ref fn" href="#gen6_free_scratch" title='gen6_free_scratch' data-use='c' data-ref="gen6_free_scratch" data-ref-filename="gen6_free_scratch">gen6_free_scratch</a>(<a class="local col7 ref" href="#467vm" title='vm' data-ref="467vm" data-ref-filename="467vm">vm</a>);</td></tr>
<tr><th id="2246">2246</th><td>	<b>return</b> <a class="local col1 ref" href="#471ret" title='ret' data-ref="471ret" data-ref-filename="471ret">ret</a>;</td></tr>
<tr><th id="2247">2247</th><td>}</td></tr>
<tr><th id="2248">2248</th><td></td></tr>
<tr><th id="2249">2249</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_ppgtt_alloc" title='gen6_ppgtt_alloc' data-type='int gen6_ppgtt_alloc(struct i915_hw_ppgtt * ppgtt)' data-ref="gen6_ppgtt_alloc" data-ref-filename="gen6_ppgtt_alloc">gen6_ppgtt_alloc</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col4 decl" id="474ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="474ppgtt" data-ref-filename="474ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="2250">2250</th><td>{</td></tr>
<tr><th id="2251">2251</th><td>	<b>return</b> <a class="tu ref fn" href="#gen6_ppgtt_allocate_page_directories" title='gen6_ppgtt_allocate_page_directories' data-use='c' data-ref="gen6_ppgtt_allocate_page_directories" data-ref-filename="gen6_ppgtt_allocate_page_directories">gen6_ppgtt_allocate_page_directories</a>(<a class="local col4 ref" href="#474ppgtt" title='ppgtt' data-ref="474ppgtt" data-ref-filename="474ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2252">2252</th><td>}</td></tr>
<tr><th id="2253">2253</th><td></td></tr>
<tr><th id="2254">2254</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_scratch_va_range" title='gen6_scratch_va_range' data-type='void gen6_scratch_va_range(struct i915_hw_ppgtt * ppgtt, uint64_t start, uint64_t length)' data-ref="gen6_scratch_va_range" data-ref-filename="gen6_scratch_va_range">gen6_scratch_va_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col5 decl" id="475ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="475ppgtt" data-ref-filename="475ppgtt">ppgtt</dfn>,</td></tr>
<tr><th id="2255">2255</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="476start" title='start' data-type='uint64_t' data-ref="476start" data-ref-filename="476start">start</dfn>, <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col7 decl" id="477length" title='length' data-type='uint64_t' data-ref="477length" data-ref-filename="477length">length</dfn>)</td></tr>
<tr><th id="2256">2256</th><td>{</td></tr>
<tr><th id="2257">2257</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_table" title='i915_page_table' data-ref="i915_page_table" data-ref-filename="i915_page_table">i915_page_table</a> *<dfn class="local col8 decl" id="478unused" title='unused' data-type='struct i915_page_table *' data-ref="478unused" data-ref-filename="478unused">unused</dfn> <a class="macro" href="../../../../../../sys/cdefs.h.html#263" title="__attribute__((__unused__))" data-ref="_M/__unused">__unused</a>;</td></tr>
<tr><th id="2258">2258</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col9 decl" id="479pde" title='pde' data-type='uint32_t' data-ref="479pde" data-ref-filename="479pde">pde</dfn>, <dfn class="local col0 decl" id="480temp" title='temp' data-type='uint32_t' data-ref="480temp" data-ref-filename="480temp">temp</dfn>;</td></tr>
<tr><th id="2259">2259</th><td></td></tr>
<tr><th id="2260">2260</th><td>	<a class="macro" href="i915_gem_gtt.h.html#449" title="for (pde = gen6_pde_index(start); length &gt; 0 &amp;&amp; pde &lt; 512 ? (unused = (&amp;ppgtt-&gt;pd)-&gt;page_table[pde]), 1 : 0; pde++, temp = ALIGN - start, temp = (( (temp)&lt;(length))?(temp):(length)), start += temp, length -= temp)" data-ref="_M/gen6_for_each_pde">gen6_for_each_pde</a>(<a class="local col8 ref" href="#478unused" title='unused' data-ref="478unused" data-ref-filename="478unused">unused</a>, &amp;<a class="local col5 ref" href="#475ppgtt" title='ppgtt' data-ref="475ppgtt" data-ref-filename="475ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <a class="local col6 ref" href="#476start" title='start' data-ref="476start" data-ref-filename="476start">start</a>, <a class="local col7 ref" href="#477length" title='length' data-ref="477length" data-ref-filename="477length">length</a>, temp, <a class="local col9 ref" href="#479pde" title='pde' data-ref="479pde" data-ref-filename="479pde">pde</a>)</td></tr>
<tr><th id="2261">2261</th><td>		<a class="local col5 ref" href="#475ppgtt" title='ppgtt' data-ref="475ppgtt" data-ref-filename="475ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::page_table" title='i915_page_directory::page_table' data-ref="i915_page_directory::page_table" data-ref-filename="i915_page_directory..page_table">page_table</a>[<a class="local col9 ref" href="#479pde" title='pde' data-ref="479pde" data-ref-filename="479pde">pde</a>] = <a class="local col5 ref" href="#475ppgtt" title='ppgtt' data-ref="475ppgtt" data-ref-filename="475ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_pt" title='i915_address_space::scratch_pt' data-ref="i915_address_space::scratch_pt" data-ref-filename="i915_address_space..scratch_pt">scratch_pt</a>;</td></tr>
<tr><th id="2262">2262</th><td>}</td></tr>
<tr><th id="2263">2263</th><td></td></tr>
<tr><th id="2264">2264</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_ppgtt_init" title='gen6_ppgtt_init' data-type='int gen6_ppgtt_init(struct i915_hw_ppgtt * ppgtt)' data-ref="gen6_ppgtt_init" data-ref-filename="gen6_ppgtt_init">gen6_ppgtt_init</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="481ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="2265">2265</th><td>{</td></tr>
<tr><th id="2266">2266</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col2 decl" id="482dev" title='dev' data-type='struct drm_device *' data-ref="482dev" data-ref-filename="482dev">dev</dfn> = <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2267">2267</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col3 decl" id="483dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="483dev_priv" data-ref-filename="483dev_priv">dev_priv</dfn> = <a class="local col2 ref" href="#482dev" title='dev' data-ref="482dev" data-ref-filename="482dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2268">2268</th><td>	<em>int</em> <dfn class="local col4 decl" id="484ret" title='ret' data-type='int' data-ref="484ret" data-ref-filename="484ret">ret</dfn>;</td></tr>
<tr><th id="2269">2269</th><td></td></tr>
<tr><th id="2270">2270</th><td>	ppgtt-&gt;base.pte_encode = dev_priv-&gt;gtt.base.pte_encode;</td></tr>
<tr><th id="2271">2271</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2641" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 6)" data-ref="_M/IS_GEN6">IS_GEN6</a>(<a class="local col2 ref" href="#482dev" title='dev' data-ref="482dev" data-ref-filename="482dev">dev</a>)) {</td></tr>
<tr><th id="2272">2272</th><td>		<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#gen6_mm_switch" title='gen6_mm_switch' data-use='r' data-ref="gen6_mm_switch" data-ref-filename="gen6_mm_switch">gen6_mm_switch</a>;</td></tr>
<tr><th id="2273">2273</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2559" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_haswell)" data-ref="_M/IS_HASWELL">IS_HASWELL</a>(<a class="local col2 ref" href="#482dev" title='dev' data-ref="482dev" data-ref-filename="482dev">dev</a>)) {</td></tr>
<tr><th id="2274">2274</th><td>		<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#hsw_mm_switch" title='hsw_mm_switch' data-use='r' data-ref="hsw_mm_switch" data-ref-filename="hsw_mm_switch">hsw_mm_switch</a>;</td></tr>
<tr><th id="2275">2275</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2642" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 7)" data-ref="_M/IS_GEN7">IS_GEN7</a>(<a class="local col2 ref" href="#482dev" title='dev' data-ref="482dev" data-ref-filename="482dev">dev</a>)) {</td></tr>
<tr><th id="2276">2276</th><td>		<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#gen7_mm_switch" title='gen7_mm_switch' data-use='r' data-ref="gen7_mm_switch" data-ref-filename="gen7_mm_switch">gen7_mm_switch</a>;</td></tr>
<tr><th id="2277">2277</th><td>	} <b>else</b></td></tr>
<tr><th id="2278">2278</th><td>		<a class="macro" href="../../../include/asm/bug.h.html#38" title="panic(&quot;%s:%d: BUG!&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2278)" data-ref="_M/BUG">BUG</a>();</td></tr>
<tr><th id="2279">2279</th><td></td></tr>
<tr><th id="2280">2280</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col2 ref" href="#482dev" title='dev' data-ref="482dev" data-ref-filename="482dev">dev</a>))</td></tr>
<tr><th id="2281">2281</th><td>		<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a> = <a class="tu ref fn" href="#vgpu_mm_switch" title='vgpu_mm_switch' data-use='r' data-ref="vgpu_mm_switch" data-ref-filename="vgpu_mm_switch">vgpu_mm_switch</a>;</td></tr>
<tr><th id="2282">2282</th><td></td></tr>
<tr><th id="2283">2283</th><td>	<a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret" data-ref-filename="484ret">ret</a> = <a class="tu ref fn" href="#gen6_ppgtt_alloc" title='gen6_ppgtt_alloc' data-use='c' data-ref="gen6_ppgtt_alloc" data-ref-filename="gen6_ppgtt_alloc">gen6_ppgtt_alloc</a>(<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2284">2284</th><td>	<b>if</b> (<a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret" data-ref-filename="484ret">ret</a>)</td></tr>
<tr><th id="2285">2285</th><td>		<b>return</b> <a class="local col4 ref" href="#484ret" title='ret' data-ref="484ret" data-ref-filename="484ret">ret</a>;</td></tr>
<tr><th id="2286">2286</th><td></td></tr>
<tr><th id="2287">2287</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a> = <a class="tu ref fn" href="#gen6_alloc_va_range" title='gen6_alloc_va_range' data-use='r' data-ref="gen6_alloc_va_range" data-ref-filename="gen6_alloc_va_range">gen6_alloc_va_range</a>;</td></tr>
<tr><th id="2288">2288</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a> = <a class="tu ref fn" href="#gen6_ppgtt_clear_range" title='gen6_ppgtt_clear_range' data-use='r' data-ref="gen6_ppgtt_clear_range" data-ref-filename="gen6_ppgtt_clear_range">gen6_ppgtt_clear_range</a>;</td></tr>
<tr><th id="2289">2289</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a> = <a class="tu ref fn" href="#gen6_ppgtt_insert_entries" title='gen6_ppgtt_insert_entries' data-use='r' data-ref="gen6_ppgtt_insert_entries" data-ref-filename="gen6_ppgtt_insert_entries">gen6_ppgtt_insert_entries</a>;</td></tr>
<tr><th id="2290">2290</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::unbind_vma" title='i915_address_space::unbind_vma' data-ref="i915_address_space::unbind_vma" data-ref-filename="i915_address_space..unbind_vma">unbind_vma</a> = <a class="tu ref fn" href="#ppgtt_unbind_vma" title='ppgtt_unbind_vma' data-use='r' data-ref="ppgtt_unbind_vma" data-ref-filename="ppgtt_unbind_vma">ppgtt_unbind_vma</a>;</td></tr>
<tr><th id="2291">2291</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::bind_vma" title='i915_address_space::bind_vma' data-ref="i915_address_space::bind_vma" data-ref-filename="i915_address_space..bind_vma">bind_vma</a> = <a class="tu ref fn" href="#ppgtt_bind_vma" title='ppgtt_bind_vma' data-use='r' data-ref="ppgtt_bind_vma" data-ref-filename="ppgtt_bind_vma">ppgtt_bind_vma</a>;</td></tr>
<tr><th id="2292">2292</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a> = <a class="tu ref fn" href="#gen6_ppgtt_cleanup" title='gen6_ppgtt_cleanup' data-use='r' data-ref="gen6_ppgtt_cleanup" data-ref-filename="gen6_ppgtt_cleanup">gen6_ppgtt_cleanup</a>;</td></tr>
<tr><th id="2293">2293</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a> = <var>0</var>;</td></tr>
<tr><th id="2294">2294</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> = <a class="macro" href="i915_gem_gtt.h.html#60" title="512" data-ref="_M/I915_PDES">I915_PDES</a> * <a class="macro" href="i915_gem_gtt.h.html#64" title="((1 &lt;&lt; 12) / (sizeof(gen6_pte_t)))" data-ref="_M/GEN6_PTES">GEN6_PTES</a> * <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>;</td></tr>
<tr><th id="2295">2295</th><td><u>#<span data-ppcond="2295">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2296">2296</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::debug_dump" title='i915_hw_ppgtt::debug_dump' data-ref="i915_hw_ppgtt::debug_dump" data-ref-filename="i915_hw_ppgtt..debug_dump">debug_dump</a> = <a class="tu ref fn" href="#gen6_dump_ppgtt" title='gen6_dump_ppgtt' data-use='r' data-ref="gen6_dump_ppgtt" data-ref-filename="gen6_dump_ppgtt">gen6_dump_ppgtt</a>;</td></tr>
<tr><th id="2297">2297</th><td><u>#<span data-ppcond="2295">endif</span></u></td></tr>
<tr><th id="2298">2298</th><td></td></tr>
<tr><th id="2299">2299</th><td>	<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::base" title='i915_page_directory::base' data-ref="i915_page_directory::base" data-ref-filename="i915_page_directory..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::(anonymous)::ggtt_offset" title='i915_page_dma::(anonymous union)::ggtt_offset' data-ref="i915_page_dma::(anonymous)::ggtt_offset" data-ref-filename="i915_page_dma..(anonymous)..ggtt_offset">ggtt_offset</a> =</td></tr>
<tr><th id="2300">2300</th><td>		<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::node" title='i915_hw_ppgtt::node' data-ref="i915_hw_ppgtt::node" data-ref-filename="i915_hw_ppgtt..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a> / <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a> * <b>sizeof</b>(<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a>);</td></tr>
<tr><th id="2301">2301</th><td></td></tr>
<tr><th id="2302">2302</th><td><u>#<span data-ppcond="2302">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2303">2303</th><td>	ppgtt-&gt;<span class='error' title="no member named &apos;pd_addr&apos; in &apos;struct i915_hw_ppgtt&apos;">pd_addr</span> = (gen6_pte_t <span class='error' title="expected &apos;)&apos;">__iomem</span> *)dev_priv-&gt;gtt.gsm +</td></tr>
<tr><th id="2304">2304</th><td>		ppgtt-&gt;pd.base.ggtt_offset / <b>sizeof</b>(gen6_pte_t);</td></tr>
<tr><th id="2305">2305</th><td><u>#<span data-ppcond="2302">endif</span></u></td></tr>
<tr><th id="2306">2306</th><td></td></tr>
<tr><th id="2307">2307</th><td>	<a class="tu ref fn" href="#gen6_scratch_va_range" title='gen6_scratch_va_range' data-use='c' data-ref="gen6_scratch_va_range" data-ref-filename="gen6_scratch_va_range">gen6_scratch_va_range</a>(<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>, <var>0</var>, <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>);</td></tr>
<tr><th id="2308">2308</th><td></td></tr>
<tr><th id="2309">2309</th><td>	<a class="tu ref fn" href="#gen6_write_page_range" title='gen6_write_page_range' data-use='c' data-ref="gen6_write_page_range" data-ref-filename="gen6_write_page_range">gen6_write_page_range</a>(<a class="local col3 ref" href="#483dev_priv" title='dev_priv' data-ref="483dev_priv" data-ref-filename="483dev_priv">dev_priv</a>, &amp;<a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>, <var>0</var>, <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>);</td></tr>
<tr><th id="2310">2310</th><td></td></tr>
<tr><th id="2311">2311</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Allocated pde space (%&quot;&quot;ld&quot;&quot;M) at GTT entry: %&quot;&quot;lx&quot;&quot;\n&quot;, ppgtt-&gt;node.size &gt;&gt; 20, ppgtt-&gt;node.start / (1 &lt;&lt; 12)); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"Allocated pde space (%"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#47" title="&quot;ld&quot;" data-ref="_M/PRId64">PRId64</a><q>"M) at GTT entry: %"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#109" title="&quot;lx&quot;" data-ref="_M/PRIx64">PRIx64</a><q>"\n"</q>,</td></tr>
<tr><th id="2312">2312</th><td>			 <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::node" title='i915_hw_ppgtt::node' data-ref="i915_hw_ppgtt::node" data-ref-filename="i915_hw_ppgtt..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::size" title='drm_mm_node::size' data-ref="drm_mm_node::size" data-ref-filename="drm_mm_node..size">size</a> &gt;&gt; <var>20</var>,</td></tr>
<tr><th id="2313">2313</th><td>			 <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::node" title='i915_hw_ppgtt::node' data-ref="i915_hw_ppgtt::node" data-ref-filename="i915_hw_ppgtt..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a> / PAGE_SIZE);</td></tr>
<tr><th id="2314">2314</th><td></td></tr>
<tr><th id="2315">2315</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#228" title="do { if (__builtin_expect((drm_debug &amp; 0x01) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Adding PPGTT at offset %x\n&quot;, ppgtt-&gt;pd.base.ggtt_offset &lt;&lt; 10); } while (0)" data-ref="_M/DRM_DEBUG">DRM_DEBUG</a>(<q>"Adding PPGTT at offset %x\n"</q>,</td></tr>
<tr><th id="2316">2316</th><td>		  <a class="local col1 ref" href="#481ppgtt" title='ppgtt' data-ref="481ppgtt" data-ref-filename="481ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_directory::base" title='i915_page_directory::base' data-ref="i915_page_directory::base" data-ref-filename="i915_page_directory..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_page_dma::(anonymous)::ggtt_offset" title='i915_page_dma::(anonymous union)::ggtt_offset' data-ref="i915_page_dma::(anonymous)::ggtt_offset" data-ref-filename="i915_page_dma..(anonymous)..ggtt_offset">ggtt_offset</a> &lt;&lt; <var>10</var>);</td></tr>
<tr><th id="2317">2317</th><td></td></tr>
<tr><th id="2318">2318</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2319">2319</th><td>}</td></tr>
<tr><th id="2320">2320</th><td></td></tr>
<tr><th id="2321">2321</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="__hw_ppgtt_init" title='__hw_ppgtt_init' data-type='int __hw_ppgtt_init(struct drm_device * dev, struct i915_hw_ppgtt * ppgtt)' data-ref="__hw_ppgtt_init" data-ref-filename="__hw_ppgtt_init">__hw_ppgtt_init</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col5 decl" id="485dev" title='dev' data-type='struct drm_device *' data-ref="485dev" data-ref-filename="485dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="486ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="486ppgtt" data-ref-filename="486ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="2322">2322</th><td>{</td></tr>
<tr><th id="2323">2323</th><td>	<a class="local col6 ref" href="#486ppgtt" title='ppgtt' data-ref="486ppgtt" data-ref-filename="486ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a> = <a class="local col5 ref" href="#485dev" title='dev' data-ref="485dev" data-ref-filename="485dev">dev</a>;</td></tr>
<tr><th id="2324">2324</th><td></td></tr>
<tr><th id="2325">2325</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col5 ref" href="#485dev" title='dev' data-ref="485dev" data-ref-filename="485dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>8</var>)</td></tr>
<tr><th id="2326">2326</th><td>		<b>return</b> <a class="tu ref fn" href="#gen6_ppgtt_init" title='gen6_ppgtt_init' data-use='c' data-ref="gen6_ppgtt_init" data-ref-filename="gen6_ppgtt_init">gen6_ppgtt_init</a>(<a class="local col6 ref" href="#486ppgtt" title='ppgtt' data-ref="486ppgtt" data-ref-filename="486ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2327">2327</th><td>	<b>else</b></td></tr>
<tr><th id="2328">2328</th><td>		<b>return</b> <a class="tu ref fn" href="#gen8_ppgtt_init" title='gen8_ppgtt_init' data-use='c' data-ref="gen8_ppgtt_init" data-ref-filename="gen8_ppgtt_init">gen8_ppgtt_init</a>(<a class="local col6 ref" href="#486ppgtt" title='ppgtt' data-ref="486ppgtt" data-ref-filename="486ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2329">2329</th><td>}</td></tr>
<tr><th id="2330">2330</th><td></td></tr>
<tr><th id="2331">2331</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_address_space_init" title='i915_address_space_init' data-type='void i915_address_space_init(struct i915_address_space * vm, struct drm_i915_private * dev_priv)' data-ref="i915_address_space_init" data-ref-filename="i915_address_space_init">i915_address_space_init</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col7 decl" id="487vm" title='vm' data-type='struct i915_address_space *' data-ref="487vm" data-ref-filename="487vm">vm</dfn>,</td></tr>
<tr><th id="2332">2332</th><td>				    <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col8 decl" id="488dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="488dev_priv" data-ref-filename="488dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="2333">2333</th><td>{</td></tr>
<tr><th id="2334">2334</th><td>	<a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_init" title='drm_mm_init' data-ref="drm_mm_init" data-ref-filename="drm_mm_init">drm_mm_init</a>(&amp;<a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>, <a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a>, <a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>);</td></tr>
<tr><th id="2335">2335</th><td>	<a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a> = <a class="local col8 ref" href="#488dev_priv" title='dev_priv' data-ref="488dev_priv" data-ref-filename="488dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::dev" title='drm_i915_private::dev' data-ref="drm_i915_private::dev" data-ref-filename="drm_i915_private..dev">dev</a>;</td></tr>
<tr><th id="2336">2336</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::active_list" title='i915_address_space::active_list' data-ref="i915_address_space::active_list" data-ref-filename="i915_address_space..active_list">active_list</a>);</td></tr>
<tr><th id="2337">2337</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::inactive_list" title='i915_address_space::inactive_list' data-ref="i915_address_space::inactive_list" data-ref-filename="i915_address_space..inactive_list">inactive_list</a>);</td></tr>
<tr><th id="2338">2338</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_add_tail" title='list_add_tail' data-ref="list_add_tail" data-ref-filename="list_add_tail">list_add_tail</a>(&amp;<a class="local col7 ref" href="#487vm" title='vm' data-ref="487vm" data-ref-filename="487vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::global_link" title='i915_address_space::global_link' data-ref="i915_address_space::global_link" data-ref-filename="i915_address_space..global_link">global_link</a>, &amp;<a class="local col8 ref" href="#488dev_priv" title='dev_priv' data-ref="488dev_priv" data-ref-filename="488dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::vm_list" title='drm_i915_private::vm_list' data-ref="drm_i915_private::vm_list" data-ref-filename="drm_i915_private..vm_list">vm_list</a>);</td></tr>
<tr><th id="2339">2339</th><td>}</td></tr>
<tr><th id="2340">2340</th><td></td></tr>
<tr><th id="2341">2341</th><td><em>int</em> <dfn class="decl def fn" id="i915_ppgtt_init" title='i915_ppgtt_init' data-ref="i915_ppgtt_init" data-ref-filename="i915_ppgtt_init">i915_ppgtt_init</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="489dev" title='dev' data-type='struct drm_device *' data-ref="489dev" data-ref-filename="489dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col0 decl" id="490ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="490ppgtt" data-ref-filename="490ppgtt">ppgtt</dfn>)</td></tr>
<tr><th id="2342">2342</th><td>{</td></tr>
<tr><th id="2343">2343</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="491dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="491dev_priv" data-ref-filename="491dev_priv">dev_priv</dfn> = <a class="local col9 ref" href="#489dev" title='dev' data-ref="489dev" data-ref-filename="489dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2344">2344</th><td>	<em>int</em> <dfn class="local col2 decl" id="492ret" title='ret' data-type='int' data-ref="492ret" data-ref-filename="492ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="2345">2345</th><td></td></tr>
<tr><th id="2346">2346</th><td>	<a class="local col2 ref" href="#492ret" title='ret' data-ref="492ret" data-ref-filename="492ret">ret</a> = <a class="tu ref fn" href="#__hw_ppgtt_init" title='__hw_ppgtt_init' data-use='c' data-ref="__hw_ppgtt_init" data-ref-filename="__hw_ppgtt_init">__hw_ppgtt_init</a>(<a class="local col9 ref" href="#489dev" title='dev' data-ref="489dev" data-ref-filename="489dev">dev</a>, <a class="local col0 ref" href="#490ppgtt" title='ppgtt' data-ref="490ppgtt" data-ref-filename="490ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2347">2347</th><td>	<b>if</b> (<a class="local col2 ref" href="#492ret" title='ret' data-ref="492ret" data-ref-filename="492ret">ret</a> == <var>0</var>) {</td></tr>
<tr><th id="2348">2348</th><td>		<a class="ref fn" href="../../../include/linux/kref.h.html#kref_init" title='kref_init' data-ref="kref_init" data-ref-filename="kref_init">kref_init</a>(&amp;<a class="local col0 ref" href="#490ppgtt" title='ppgtt' data-ref="490ppgtt" data-ref-filename="490ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::ref" title='i915_hw_ppgtt::ref' data-ref="i915_hw_ppgtt::ref" data-ref-filename="i915_hw_ppgtt..ref">ref</a>);</td></tr>
<tr><th id="2349">2349</th><td>		<a class="tu ref fn" href="#i915_address_space_init" title='i915_address_space_init' data-use='c' data-ref="i915_address_space_init" data-ref-filename="i915_address_space_init">i915_address_space_init</a>(&amp;<a class="local col0 ref" href="#490ppgtt" title='ppgtt' data-ref="490ppgtt" data-ref-filename="490ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, <a class="local col1 ref" href="#491dev_priv" title='dev_priv' data-ref="491dev_priv" data-ref-filename="491dev_priv">dev_priv</a>);</td></tr>
<tr><th id="2350">2350</th><td>	}</td></tr>
<tr><th id="2351">2351</th><td></td></tr>
<tr><th id="2352">2352</th><td>	<b>return</b> <a class="local col2 ref" href="#492ret" title='ret' data-ref="492ret" data-ref-filename="492ret">ret</a>;</td></tr>
<tr><th id="2353">2353</th><td>}</td></tr>
<tr><th id="2354">2354</th><td></td></tr>
<tr><th id="2355">2355</th><td><em>int</em> <dfn class="decl def fn" id="i915_ppgtt_init_hw" title='i915_ppgtt_init_hw' data-ref="i915_ppgtt_init_hw" data-ref-filename="i915_ppgtt_init_hw">i915_ppgtt_init_hw</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="493dev" title='dev' data-type='struct drm_device *' data-ref="493dev" data-ref-filename="493dev">dev</dfn>)</td></tr>
<tr><th id="2356">2356</th><td>{</td></tr>
<tr><th id="2357">2357</th><td>	<i>/* In the case of execlists, PPGTT is enabled by the context descriptor</i></td></tr>
<tr><th id="2358">2358</th><td><i>	 * and the PDPs are contained within the context itself.  We don't</i></td></tr>
<tr><th id="2359">2359</th><td><i>	 * need to do anything here. */</i></td></tr>
<tr><th id="2360">2360</th><td>	<b>if</b> (<a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_execlists" title='i915_params::enable_execlists' data-ref="i915_params::enable_execlists" data-ref-filename="i915_params..enable_execlists">enable_execlists</a>)</td></tr>
<tr><th id="2361">2361</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2362">2362</th><td></td></tr>
<tr><th id="2363">2363</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2662" title="(i915.enable_ppgtt)" data-ref="_M/USES_PPGTT">USES_PPGTT</a>(dev))</td></tr>
<tr><th id="2364">2364</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2365">2365</th><td></td></tr>
<tr><th id="2366">2366</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2641" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 6)" data-ref="_M/IS_GEN6">IS_GEN6</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>))</td></tr>
<tr><th id="2367">2367</th><td>		<a class="tu ref fn" href="#gen6_ppgtt_enable" title='gen6_ppgtt_enable' data-use='c' data-ref="gen6_ppgtt_enable" data-ref-filename="gen6_ppgtt_enable">gen6_ppgtt_enable</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>);</td></tr>
<tr><th id="2368">2368</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2642" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 7)" data-ref="_M/IS_GEN7">IS_GEN7</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>))</td></tr>
<tr><th id="2369">2369</th><td>		<a class="tu ref fn" href="#gen7_ppgtt_enable" title='gen7_ppgtt_enable' data-use='c' data-ref="gen7_ppgtt_enable" data-ref-filename="gen7_ppgtt_enable">gen7_ppgtt_enable</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>);</td></tr>
<tr><th id="2370">2370</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>8</var>)</td></tr>
<tr><th id="2371">2371</th><td>		<a class="tu ref fn" href="#gen8_ppgtt_enable" title='gen8_ppgtt_enable' data-use='c' data-ref="gen8_ppgtt_enable" data-ref-filename="gen8_ppgtt_enable">gen8_ppgtt_enable</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>);</td></tr>
<tr><th id="2372">2372</th><td>	<b>else</b></td></tr>
<tr><th id="2373">2373</th><td>		<a class="macro" href="i915_drv.h.html#93" title="linux_warning((1)? (printf(&quot;warning: %s:%d: &quot; &quot;Missing switch case (%lu) in %s\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2373, (long) ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen), __func__), 1) : 0);" data-ref="_M/MISSING_CASE">MISSING_CASE</a>(<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col3 ref" href="#493dev" title='dev' data-ref="493dev" data-ref-filename="493dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a>);</td></tr>
<tr><th id="2374">2374</th><td></td></tr>
<tr><th id="2375">2375</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2376">2376</th><td>}</td></tr>
<tr><th id="2377">2377</th><td></td></tr>
<tr><th id="2378">2378</th><td><em>int</em> <dfn class="decl def fn" id="i915_ppgtt_init_ring" title='i915_ppgtt_init_ring' data-ref="i915_ppgtt_init_ring" data-ref-filename="i915_ppgtt_init_ring">i915_ppgtt_init_ring</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_request" title='drm_i915_gem_request' data-ref="drm_i915_gem_request" data-ref-filename="drm_i915_gem_request">drm_i915_gem_request</a> *<dfn class="local col4 decl" id="494req" title='req' data-type='struct drm_i915_gem_request *' data-ref="494req" data-ref-filename="494req">req</dfn>)</td></tr>
<tr><th id="2379">2379</th><td>{</td></tr>
<tr><th id="2380">2380</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="495dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="495dev_priv" data-ref-filename="495dev_priv">dev_priv</dfn> = <a class="local col4 ref" href="#494req" title='req' data-ref="494req" data-ref-filename="494req">req</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_request::ring" title='drm_i915_gem_request::ring' data-ref="drm_i915_gem_request::ring" data-ref-filename="drm_i915_gem_request..ring">ring</a>-&gt;<a class="ref field" href="intel_ringbuffer.h.html#intel_engine_cs::dev" title='intel_engine_cs::dev' data-ref="intel_engine_cs::dev" data-ref-filename="intel_engine_cs..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2381">2381</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="496ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="496ppgtt" data-ref-filename="496ppgtt">ppgtt</dfn> = <a class="local col5 ref" href="#495dev_priv" title='dev_priv' data-ref="495dev_priv" data-ref-filename="495dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>;</td></tr>
<tr><th id="2382">2382</th><td></td></tr>
<tr><th id="2383">2383</th><td>	<b>if</b> (<a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_execlists" title='i915_params::enable_execlists' data-ref="i915_params::enable_execlists" data-ref-filename="i915_params..enable_execlists">enable_execlists</a>)</td></tr>
<tr><th id="2384">2384</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2385">2385</th><td></td></tr>
<tr><th id="2386">2386</th><td>	<b>if</b> (!<a class="local col6 ref" href="#496ppgtt" title='ppgtt' data-ref="496ppgtt" data-ref-filename="496ppgtt">ppgtt</a>)</td></tr>
<tr><th id="2387">2387</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2388">2388</th><td></td></tr>
<tr><th id="2389">2389</th><td>	<b>return</b> <a class="local col6 ref" href="#496ppgtt" title='ppgtt' data-ref="496ppgtt" data-ref-filename="496ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::switch_mm" title='i915_hw_ppgtt::switch_mm' data-ref="i915_hw_ppgtt::switch_mm" data-ref-filename="i915_hw_ppgtt..switch_mm">switch_mm</a>(<a class="local col6 ref" href="#496ppgtt" title='ppgtt' data-ref="496ppgtt" data-ref-filename="496ppgtt">ppgtt</a>, <a class="local col4 ref" href="#494req" title='req' data-ref="494req" data-ref-filename="494req">req</a>);</td></tr>
<tr><th id="2390">2390</th><td>}</td></tr>
<tr><th id="2391">2391</th><td></td></tr>
<tr><th id="2392">2392</th><td><b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *</td></tr>
<tr><th id="2393">2393</th><td><dfn class="decl def fn" id="i915_ppgtt_create" title='i915_ppgtt_create' data-ref="i915_ppgtt_create" data-ref-filename="i915_ppgtt_create">i915_ppgtt_create</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col7 decl" id="497dev" title='dev' data-type='struct drm_device *' data-ref="497dev" data-ref-filename="497dev">dev</dfn>, <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_file_private" title='drm_i915_file_private' data-ref="drm_i915_file_private" data-ref-filename="drm_i915_file_private">drm_i915_file_private</a> *<dfn class="local col8 decl" id="498fpriv" title='fpriv' data-type='struct drm_i915_file_private *' data-ref="498fpriv" data-ref-filename="498fpriv">fpriv</dfn>)</td></tr>
<tr><th id="2394">2394</th><td>{</td></tr>
<tr><th id="2395">2395</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col9 decl" id="499ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</dfn>;</td></tr>
<tr><th id="2396">2396</th><td>	<em>int</em> <dfn class="local col0 decl" id="500ret" title='ret' data-type='int' data-ref="500ret" data-ref-filename="500ret">ret</dfn>;</td></tr>
<tr><th id="2397">2397</th><td></td></tr>
<tr><th id="2398">2398</th><td>	<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="2399">2399</th><td>	<b>if</b> (!<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>)</td></tr>
<tr><th id="2400">2400</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="2401">2401</th><td></td></tr>
<tr><th id="2402">2402</th><td>	<a class="local col0 ref" href="#500ret" title='ret' data-ref="500ret" data-ref-filename="500ret">ret</a> = <a class="ref fn" href="#i915_ppgtt_init" title='i915_ppgtt_init' data-ref="i915_ppgtt_init" data-ref-filename="i915_ppgtt_init">i915_ppgtt_init</a>(<a class="local col7 ref" href="#497dev" title='dev' data-ref="497dev" data-ref-filename="497dev">dev</a>, <a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2403">2403</th><td>	<b>if</b> (<a class="local col0 ref" href="#500ret" title='ret' data-ref="500ret" data-ref-filename="500ret">ret</a>) {</td></tr>
<tr><th id="2404">2404</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2405">2405</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col0 ref" href="#500ret" title='ret' data-ref="500ret" data-ref-filename="500ret">ret</a>);</td></tr>
<tr><th id="2406">2406</th><td>	}</td></tr>
<tr><th id="2407">2407</th><td></td></tr>
<tr><th id="2408">2408</th><td>	<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::file_priv" title='i915_hw_ppgtt::file_priv' data-ref="i915_hw_ppgtt::file_priv" data-ref-filename="i915_hw_ppgtt..file_priv">file_priv</a> = <a class="local col8 ref" href="#498fpriv" title='fpriv' data-ref="498fpriv" data-ref-filename="498fpriv">fpriv</a>;</td></tr>
<tr><th id="2409">2409</th><td></td></tr>
<tr><th id="2410">2410</th><td>	<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_ppgtt_create" title='trace_i915_ppgtt_create' data-ref="trace_i915_ppgtt_create" data-ref-filename="trace_i915_ppgtt_create">trace_i915_ppgtt_create</a>(&amp;<a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2411">2411</th><td></td></tr>
<tr><th id="2412">2412</th><td>	<b>return</b> <a class="local col9 ref" href="#499ppgtt" title='ppgtt' data-ref="499ppgtt" data-ref-filename="499ppgtt">ppgtt</a>;</td></tr>
<tr><th id="2413">2413</th><td>}</td></tr>
<tr><th id="2414">2414</th><td></td></tr>
<tr><th id="2415">2415</th><td><em>void</em>  <dfn class="decl def fn" id="i915_ppgtt_release" title='i915_ppgtt_release' data-ref="i915_ppgtt_release" data-ref-filename="i915_ppgtt_release">i915_ppgtt_release</dfn>(<b>struct</b> <a class="type" href="../../../include/linux/kref.h.html#kref" title='kref' data-ref="kref" data-ref-filename="kref">kref</a> *<dfn class="local col1 decl" id="501kref" title='kref' data-type='struct kref *' data-ref="501kref" data-ref-filename="501kref">kref</dfn>)</td></tr>
<tr><th id="2416">2416</th><td>{</td></tr>
<tr><th id="2417">2417</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col2 decl" id="502ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="2418">2418</th><td>		<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(kref)) - __builtin_offsetof(struct i915_hw_ppgtt, ref)) + (0 * sizeof((kref) - &amp;((struct i915_hw_ppgtt *)(((char *)(kref)) - __builtin_offsetof(struct i915_hw_ppgtt, ref)))-&gt;ref)))" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#501kref" title='kref' data-ref="501kref" data-ref-filename="501kref">kref</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::ref" title='i915_hw_ppgtt::ref' data-ref="i915_hw_ppgtt::ref" data-ref-filename="i915_hw_ppgtt..ref">ref</a>);</td></tr>
<tr><th id="2419">2419</th><td></td></tr>
<tr><th id="2420">2420</th><td>	<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_ppgtt_release" title='trace_i915_ppgtt_release' data-ref="trace_i915_ppgtt_release" data-ref-filename="trace_i915_ppgtt_release">trace_i915_ppgtt_release</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2421">2421</th><td></td></tr>
<tr><th id="2422">2422</th><td>	<i>/* vmas should already be unbound */</i></td></tr>
<tr><th id="2423">2423</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!list_empty(&amp;ppgtt-&gt;base.active_list)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2423, &quot;!list_empty(&amp;ppgtt-&gt;base.active_list)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty" data-ref-filename="list_empty">list_empty</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::active_list" title='i915_address_space::active_list' data-ref="i915_address_space::active_list" data-ref-filename="i915_address_space..active_list">active_list</a>));</td></tr>
<tr><th id="2424">2424</th><td>	<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!list_empty(&amp;ppgtt-&gt;base.inactive_list)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2424, &quot;!list_empty(&amp;ppgtt-&gt;base.inactive_list)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty" data-ref-filename="list_empty">list_empty</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::inactive_list" title='i915_address_space::inactive_list' data-ref="i915_address_space::inactive_list" data-ref-filename="i915_address_space..inactive_list">inactive_list</a>));</td></tr>
<tr><th id="2425">2425</th><td></td></tr>
<tr><th id="2426">2426</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_del" title='list_del' data-ref="list_del" data-ref-filename="list_del">list_del</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::global_link" title='i915_address_space::global_link' data-ref="i915_address_space::global_link" data-ref-filename="i915_address_space..global_link">global_link</a>);</td></tr>
<tr><th id="2427">2427</th><td>	<a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_takedown" title='drm_mm_takedown' data-ref="drm_mm_takedown" data-ref-filename="drm_mm_takedown">drm_mm_takedown</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>);</td></tr>
<tr><th id="2428">2428</th><td></td></tr>
<tr><th id="2429">2429</th><td>	<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a>(&amp;<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="2430">2430</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col2 ref" href="#502ppgtt" title='ppgtt' data-ref="502ppgtt" data-ref-filename="502ppgtt">ppgtt</a>);</td></tr>
<tr><th id="2431">2431</th><td>}</td></tr>
<tr><th id="2432">2432</th><td></td></tr>
<tr><th id="2433">2433</th><td><b>extern</b> <em>int</em> <a class="decl" href="../../../include/drm/intel-gtt.h.html#intel_iommu_gfx_mapped" title='intel_iommu_gfx_mapped' data-ref="intel_iommu_gfx_mapped" data-ref-filename="intel_iommu_gfx_mapped" id="intel_iommu_gfx_mapped">intel_iommu_gfx_mapped</a>;</td></tr>
<tr><th id="2434">2434</th><td><i  data-doc="needs_idle_maps">/* Certain Gen5 chipsets require require idling the GPU before</i></td></tr>
<tr><th id="2435">2435</th><td><i  data-doc="needs_idle_maps"> * unmapping anything from the GTT when VT-d is enabled.</i></td></tr>
<tr><th id="2436">2436</th><td><i  data-doc="needs_idle_maps"> */</i></td></tr>
<tr><th id="2437">2437</th><td><em>static</em> <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="tu decl def fn" id="needs_idle_maps" title='needs_idle_maps' data-type='_Bool needs_idle_maps(struct drm_device * dev)' data-ref="needs_idle_maps" data-ref-filename="needs_idle_maps">needs_idle_maps</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="503dev" title='dev' data-type='struct drm_device *' data-ref="503dev" data-ref-filename="503dev">dev</dfn>)</td></tr>
<tr><th id="2438">2438</th><td>{</td></tr>
<tr><th id="2439">2439</th><td><u>#<span data-ppcond="2439">ifdef</span> <span class="macro" data-ref="_M/CONFIG_INTEL_IOMMU">CONFIG_INTEL_IOMMU</span></u></td></tr>
<tr><th id="2440">2440</th><td>	<i>/* Query intel_iommu to see if we need the workaround. Presumably that</i></td></tr>
<tr><th id="2441">2441</th><td><i>	 * was loaded first.</i></td></tr>
<tr><th id="2442">2442</th><td><i>	 */</i></td></tr>
<tr><th id="2443">2443</th><td>	<b>if</b> (IS_GEN5(dev) &amp;&amp; IS_MOBILE(dev) &amp;&amp; intel_iommu_gfx_mapped)</td></tr>
<tr><th id="2444">2444</th><td>		<b>return</b> true;</td></tr>
<tr><th id="2445">2445</th><td><u>#<span data-ppcond="2439">endif</span></u></td></tr>
<tr><th id="2446">2446</th><td>	<b>return</b> <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="2447">2447</th><td>}</td></tr>
<tr><th id="2448">2448</th><td></td></tr>
<tr><th id="2449">2449</th><td><em>static</em> <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="tu decl def fn" id="do_idling" title='do_idling' data-type='_Bool do_idling(struct drm_i915_private * dev_priv)' data-ref="do_idling" data-ref-filename="do_idling">do_idling</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="504dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="504dev_priv" data-ref-filename="504dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="2450">2450</th><td>{</td></tr>
<tr><th id="2451">2451</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col5 decl" id="505ret" title='ret' data-type='_Bool' data-ref="505ret" data-ref-filename="505ret">ret</dfn> = <a class="local col4 ref" href="#504dev_priv" title='dev_priv' data-ref="504dev_priv" data-ref-filename="504dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::interruptible" title='i915_gem_mm::interruptible' data-ref="i915_gem_mm::interruptible" data-ref-filename="i915_gem_mm..interruptible">interruptible</a>;</td></tr>
<tr><th id="2452">2452</th><td></td></tr>
<tr><th id="2453">2453</th><td>	<b>if</b> (<a class="macro" href="../../../../common/include/linux/kernel.h.html#66" title="__builtin_expect((dev_priv-&gt;gtt.do_idle_maps) != 0, 0)" data-ref="_M/unlikely">unlikely</a>(dev_priv-&gt;gtt.do_idle_maps)) {</td></tr>
<tr><th id="2454">2454</th><td>		<a class="local col4 ref" href="#504dev_priv" title='dev_priv' data-ref="504dev_priv" data-ref-filename="504dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::interruptible" title='i915_gem_mm::interruptible' data-ref="i915_gem_mm::interruptible" data-ref-filename="i915_gem_mm..interruptible">interruptible</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="2455">2455</th><td>		<b>if</b> (<a class="ref fn" href="i915_drv.h.html#i915_gpu_idle" title='i915_gpu_idle' data-ref="i915_gpu_idle" data-ref-filename="i915_gpu_idle">i915_gpu_idle</a>(<a class="local col4 ref" href="#504dev_priv" title='dev_priv' data-ref="504dev_priv" data-ref-filename="504dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::dev" title='drm_i915_private::dev' data-ref="drm_i915_private::dev" data-ref-filename="drm_i915_private..dev">dev</a>)) {</td></tr>
<tr><th id="2456">2456</th><td>			<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2456, __func__, &quot;Couldn&apos;t idle GPU\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Couldn't idle GPU\n"</q>);</td></tr>
<tr><th id="2457">2457</th><td>			<i>/* Wait a bit, in hopes it avoids the hang */</i></td></tr>
<tr><th id="2458">2458</th><td>			<a class="ref fn" href="../../../include/linux/delay.h.html#udelay" title='udelay' data-ref="udelay" data-ref-filename="udelay">udelay</a>(<var>10</var>);</td></tr>
<tr><th id="2459">2459</th><td>		}</td></tr>
<tr><th id="2460">2460</th><td>	}</td></tr>
<tr><th id="2461">2461</th><td></td></tr>
<tr><th id="2462">2462</th><td>	<b>return</b> <a class="local col5 ref" href="#505ret" title='ret' data-ref="505ret" data-ref-filename="505ret">ret</a>;</td></tr>
<tr><th id="2463">2463</th><td>}</td></tr>
<tr><th id="2464">2464</th><td></td></tr>
<tr><th id="2465">2465</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="undo_idling" title='undo_idling' data-type='void undo_idling(struct drm_i915_private * dev_priv, _Bool interruptible)' data-ref="undo_idling" data-ref-filename="undo_idling">undo_idling</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="506dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="506dev_priv" data-ref-filename="506dev_priv">dev_priv</dfn>, <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col7 decl" id="507interruptible" title='interruptible' data-type='_Bool' data-ref="507interruptible" data-ref-filename="507interruptible">interruptible</dfn>)</td></tr>
<tr><th id="2466">2466</th><td>{</td></tr>
<tr><th id="2467">2467</th><td>	<b>if</b> (<a class="macro" href="../../../../common/include/linux/kernel.h.html#66" title="__builtin_expect((dev_priv-&gt;gtt.do_idle_maps) != 0, 0)" data-ref="_M/unlikely">unlikely</a>(dev_priv-&gt;gtt.do_idle_maps))</td></tr>
<tr><th id="2468">2468</th><td>		<a class="local col6 ref" href="#506dev_priv" title='dev_priv' data-ref="506dev_priv" data-ref-filename="506dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::interruptible" title='i915_gem_mm::interruptible' data-ref="i915_gem_mm::interruptible" data-ref-filename="i915_gem_mm..interruptible">interruptible</a> = <a class="local col7 ref" href="#507interruptible" title='interruptible' data-ref="507interruptible" data-ref-filename="507interruptible">interruptible</a>;</td></tr>
<tr><th id="2469">2469</th><td>}</td></tr>
<tr><th id="2470">2470</th><td></td></tr>
<tr><th id="2471">2471</th><td><em>void</em> <dfn class="decl def fn" id="i915_check_and_clear_faults" title='i915_check_and_clear_faults' data-ref="i915_check_and_clear_faults" data-ref-filename="i915_check_and_clear_faults">i915_check_and_clear_faults</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col8 decl" id="508dev" title='dev' data-type='struct drm_device *' data-ref="508dev" data-ref-filename="508dev">dev</dfn>)</td></tr>
<tr><th id="2472">2472</th><td>{</td></tr>
<tr><th id="2473">2473</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="509dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="509dev_priv" data-ref-filename="509dev_priv">dev_priv</dfn> = <a class="local col8 ref" href="#508dev" title='dev' data-ref="508dev" data-ref-filename="508dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2474">2474</th><td>	<b>struct</b> <a class="type" href="intel_ringbuffer.h.html#intel_engine_cs" title='intel_engine_cs' data-ref="intel_engine_cs" data-ref-filename="intel_engine_cs">intel_engine_cs</a> *<dfn class="local col0 decl" id="510ring" title='ring' data-type='struct intel_engine_cs *' data-ref="510ring" data-ref-filename="510ring">ring</dfn>;</td></tr>
<tr><th id="2475">2475</th><td>	<em>int</em> <dfn class="local col1 decl" id="511i" title='i' data-type='int' data-ref="511i" data-ref-filename="511i">i</dfn>;</td></tr>
<tr><th id="2476">2476</th><td></td></tr>
<tr><th id="2477">2477</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col8 ref" href="#508dev" title='dev' data-ref="508dev" data-ref-filename="508dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>6</var>)</td></tr>
<tr><th id="2478">2478</th><td>		<b>return</b>;</td></tr>
<tr><th id="2479">2479</th><td></td></tr>
<tr><th id="2480">2480</th><td>	<a class="macro" href="i915_drv.h.html#2053" title="for ((i) = 0; (i) &lt; 5; (i)++) if (((ring) = &amp;(dev_priv)-&gt;ring[(i)]), intel_ring_initialized((ring)))" data-ref="_M/for_each_ring">for_each_ring</a>(ring, dev_priv, <a class="local col1 ref" href="#511i" title='i' data-ref="511i" data-ref-filename="511i">i</a>) {</td></tr>
<tr><th id="2481">2481</th><td>		<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col2 decl" id="512fault_reg" title='fault_reg' data-type='u32' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</dfn>;</td></tr>
<tr><th id="2482">2482</th><td>		<a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a> = <a class="macro" href="i915_drv.h.html#3591" title="dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, ((0x4094 + 0x100*(ring)-&gt;id)), 1)" data-ref="_M/I915_READ">I915_READ</a>(<a class="macro" href="i915_reg.h.html#1558" title="(0x4094 + 0x100*(ring)-&gt;id)" data-ref="_M/RING_FAULT_REG">RING_FAULT_REG</a>(<a class="local col0 ref" href="#510ring" title='ring' data-ref="510ring" data-ref-filename="510ring">ring</a>));</td></tr>
<tr><th id="2483">2483</th><td>		<b>if</b> (<a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a> &amp; <a class="macro" href="i915_reg.h.html#1562" title="(1&lt;&lt;0)" data-ref="_M/RING_FAULT_VALID">RING_FAULT_VALID</a>) {</td></tr>
<tr><th id="2484">2484</th><td>			<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Unexpected fault\n&quot; &quot;\tAddr: 0x%08&quot;&quot;x&quot;&quot;\n&quot; &quot;\tAddress space: %s\n&quot; &quot;\tSource ID: %d\n&quot; &quot;\tType: %d\n&quot;, fault_reg &amp; (~((1 &lt;&lt; 12)-1)), fault_reg &amp; (1&lt;&lt;11) ? &quot;GGTT&quot; : &quot;PPGTT&quot;, (((fault_reg) &gt;&gt; 3) &amp; 0xff), (((fault_reg) &gt;&gt; 1) &amp; 0x3)); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"Unexpected fault\n"</q></td></tr>
<tr><th id="2485">2485</th><td>					 <q>"\tAddr: 0x%08"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#108" title="&quot;x&quot;" data-ref="_M/PRIx32">PRIx32</a><q>"\n"</q></td></tr>
<tr><th id="2486">2486</th><td>					 <q>"\tAddress space: %s\n"</q></td></tr>
<tr><th id="2487">2487</th><td>					 <q>"\tSource ID: %d\n"</q></td></tr>
<tr><th id="2488">2488</th><td>					 <q>"\tType: %d\n"</q>,</td></tr>
<tr><th id="2489">2489</th><td>					 <a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a> &amp; PAGE_MASK,</td></tr>
<tr><th id="2490">2490</th><td>					 <a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a> &amp; RING_FAULT_GTTSEL_MASK ? <q>"GGTT"</q> : <q>"PPGTT"</q>,</td></tr>
<tr><th id="2491">2491</th><td>					 RING_FAULT_SRCID(<a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a>),</td></tr>
<tr><th id="2492">2492</th><td>					 RING_FAULT_FAULT_TYPE(<a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a>));</td></tr>
<tr><th id="2493">2493</th><td>			<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, ((0x4094 + 0x100*(ring)-&gt;id)), (fault_reg &amp; ~(1&lt;&lt;0)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1558" title="(0x4094 + 0x100*(ring)-&gt;id)" data-ref="_M/RING_FAULT_REG">RING_FAULT_REG</a>(<a class="local col0 ref" href="#510ring" title='ring' data-ref="510ring" data-ref-filename="510ring">ring</a>),</td></tr>
<tr><th id="2494">2494</th><td>				   <a class="local col2 ref" href="#512fault_reg" title='fault_reg' data-ref="512fault_reg" data-ref-filename="512fault_reg">fault_reg</a> &amp; ~<a class="macro" href="i915_reg.h.html#1562" title="(1&lt;&lt;0)" data-ref="_M/RING_FAULT_VALID">RING_FAULT_VALID</a>);</td></tr>
<tr><th id="2495">2495</th><td>		}</td></tr>
<tr><th id="2496">2496</th><td>	}</td></tr>
<tr><th id="2497">2497</th><td>	<a class="macro" href="i915_drv.h.html#3615" title="(void)dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, ((0x4094 + 0x100*(&amp;dev_priv-&gt;ring[RCS])-&gt;id)), 0)" data-ref="_M/POSTING_READ">POSTING_READ</a>(<a class="macro" href="i915_reg.h.html#1558" title="(0x4094 + 0x100*(&amp;dev_priv-&gt;ring[RCS])-&gt;id)" data-ref="_M/RING_FAULT_REG">RING_FAULT_REG</a>(&amp;dev_priv-&gt;ring[RCS]));</td></tr>
<tr><th id="2498">2498</th><td>}</td></tr>
<tr><th id="2499">2499</th><td></td></tr>
<tr><th id="2500">2500</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_ggtt_flush" title='i915_ggtt_flush' data-type='void i915_ggtt_flush(struct drm_i915_private * dev_priv)' data-ref="i915_ggtt_flush" data-ref-filename="i915_ggtt_flush">i915_ggtt_flush</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col3 decl" id="513dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="513dev_priv" data-ref-filename="513dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="2501">2501</th><td>{</td></tr>
<tr><th id="2502">2502</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev_priv-&gt;dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev_priv-&gt;dev)); else if (__builtin_types_compatible_p(typeof(*dev_priv-&gt;dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev_priv-&gt;dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col3 ref" href="#513dev_priv" title='dev_priv' data-ref="513dev_priv" data-ref-filename="513dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::dev" title='drm_i915_private::dev' data-ref="drm_i915_private::dev" data-ref-filename="drm_i915_private..dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>6</var>) {</td></tr>
<tr><th id="2503">2503</th><td>		<a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gtt_chipset_flush" title='intel_gtt_chipset_flush' data-ref="intel_gtt_chipset_flush" data-ref-filename="intel_gtt_chipset_flush">intel_gtt_chipset_flush</a>();</td></tr>
<tr><th id="2504">2504</th><td>	} <b>else</b> {</td></tr>
<tr><th id="2505">2505</th><td>		<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x101008), ((1&lt;&lt;0)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>, <a class="macro" href="i915_reg.h.html#1872" title="(1&lt;&lt;0)" data-ref="_M/GFX_FLSH_CNTL_EN">GFX_FLSH_CNTL_EN</a>);</td></tr>
<tr><th id="2506">2506</th><td>		<a class="macro" href="i915_drv.h.html#3615" title="(void)dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x101008), 0)" data-ref="_M/POSTING_READ">POSTING_READ</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>);</td></tr>
<tr><th id="2507">2507</th><td>	}</td></tr>
<tr><th id="2508">2508</th><td>}</td></tr>
<tr><th id="2509">2509</th><td></td></tr>
<tr><th id="2510">2510</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_suspend_gtt_mappings" title='i915_gem_suspend_gtt_mappings' data-ref="i915_gem_suspend_gtt_mappings" data-ref-filename="i915_gem_suspend_gtt_mappings">i915_gem_suspend_gtt_mappings</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="514dev" title='dev' data-type='struct drm_device *' data-ref="514dev" data-ref-filename="514dev">dev</dfn>)</td></tr>
<tr><th id="2511">2511</th><td>{</td></tr>
<tr><th id="2512">2512</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="515dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="515dev_priv" data-ref-filename="515dev_priv">dev_priv</dfn> = <a class="local col4 ref" href="#514dev" title='dev' data-ref="514dev" data-ref-filename="514dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2513">2513</th><td></td></tr>
<tr><th id="2514">2514</th><td>	<i>/* Don't bother messing with faults pre GEN6 as we have little</i></td></tr>
<tr><th id="2515">2515</th><td><i>	 * documentation supporting that it's a good idea.</i></td></tr>
<tr><th id="2516">2516</th><td><i>	 */</i></td></tr>
<tr><th id="2517">2517</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col4 ref" href="#514dev" title='dev' data-ref="514dev" data-ref-filename="514dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>6</var>)</td></tr>
<tr><th id="2518">2518</th><td>		<b>return</b>;</td></tr>
<tr><th id="2519">2519</th><td></td></tr>
<tr><th id="2520">2520</th><td>	<a class="ref fn" href="#i915_check_and_clear_faults" title='i915_check_and_clear_faults' data-ref="i915_check_and_clear_faults" data-ref-filename="i915_check_and_clear_faults">i915_check_and_clear_faults</a>(<a class="local col4 ref" href="#514dev" title='dev' data-ref="514dev" data-ref-filename="514dev">dev</a>);</td></tr>
<tr><th id="2521">2521</th><td></td></tr>
<tr><th id="2522">2522</th><td>	dev_priv-&gt;gtt.base.clear_range(&amp;dev_priv-&gt;gtt.base,</td></tr>
<tr><th id="2523">2523</th><td>				       dev_priv-&gt;gtt.base.start,</td></tr>
<tr><th id="2524">2524</th><td>				       dev_priv-&gt;gtt.base.total,</td></tr>
<tr><th id="2525">2525</th><td>				       <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="2526">2526</th><td></td></tr>
<tr><th id="2527">2527</th><td>	<a class="tu ref fn" href="#i915_ggtt_flush" title='i915_ggtt_flush' data-use='c' data-ref="i915_ggtt_flush" data-ref-filename="i915_ggtt_flush">i915_ggtt_flush</a>(<a class="local col5 ref" href="#515dev_priv" title='dev_priv' data-ref="515dev_priv" data-ref-filename="515dev_priv">dev_priv</a>);</td></tr>
<tr><th id="2528">2528</th><td>}</td></tr>
<tr><th id="2529">2529</th><td></td></tr>
<tr><th id="2530">2530</th><td><em>int</em> <dfn class="decl def fn" id="i915_gem_gtt_prepare_object" title='i915_gem_gtt_prepare_object' data-ref="i915_gem_gtt_prepare_object" data-ref-filename="i915_gem_gtt_prepare_object">i915_gem_gtt_prepare_object</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col6 decl" id="516obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="516obj" data-ref-filename="516obj">obj</dfn>)</td></tr>
<tr><th id="2531">2531</th><td>{</td></tr>
<tr><th id="2532">2532</th><td><u>#<span data-ppcond="2532">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2533">2533</th><td>	KASSERT(<var>0</var> &lt; obj-&gt;base.size);</td></tr>
<tr><th id="2534">2534</th><td>	<i>/* XXX errno NetBSD-&gt;Linux */</i></td></tr>
<tr><th id="2535">2535</th><td>	<b>return</b> -bus_dmamap_load_pglist(obj-&gt;base.dev-&gt;dmat, obj-&gt;pages,</td></tr>
<tr><th id="2536">2536</th><td>	    &amp;obj-&gt;pageq, obj-&gt;base.size, BUS_DMA_NOWAIT);</td></tr>
<tr><th id="2537">2537</th><td><u>#<span data-ppcond="2532">else</span></u></td></tr>
<tr><th id="2538">2538</th><td>	<b>if</b> (!dma_map_sg(&amp;obj-&gt;base.dev-&gt;pdev-&gt;<span class='error' title="no member named &apos;dev&apos; in &apos;struct pci_dev&apos;">dev</span>,</td></tr>
<tr><th id="2539">2539</th><td>			obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents,</td></tr>
<tr><th id="2540">2540</th><td>			<span class='error' title="use of undeclared identifier &apos;PCI_DMA_BIDIRECTIONAL&apos;">PCI_DMA_BIDIRECTIONAL</span>))</td></tr>
<tr><th id="2541">2541</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#70" title="28" data-ref="_M/ENOSPC">ENOSPC</a>;</td></tr>
<tr><th id="2542">2542</th><td></td></tr>
<tr><th id="2543">2543</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2544">2544</th><td><u>#<span data-ppcond="2532">endif</span></u></td></tr>
<tr><th id="2545">2545</th><td>}</td></tr>
<tr><th id="2546">2546</th><td></td></tr>
<tr><th id="2547">2547</th><td><u>#<span data-ppcond="2547">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2548">2548</th><td><em>static</em> gen8_pte_t</td></tr>
<tr><th id="2549">2549</th><td>gen8_get_pte(bus_space_tag_t bst, bus_space_handle_t bsh, <em>unsigned</em> i)</td></tr>
<tr><th id="2550">2550</th><td>{</td></tr>
<tr><th id="2551">2551</th><td>	CTASSERT(_BYTE_ORDER == _LITTLE_ENDIAN); <i>/* x86 */</i></td></tr>
<tr><th id="2552">2552</th><td>	CTASSERT(<b>sizeof</b>(gen8_pte_t) == <var>8</var>);</td></tr>
<tr><th id="2553">2553</th><td><u>#ifdef _LP64			/* XXX How to detect bus_space_read_8?  */</u></td></tr>
<tr><th id="2554">2554</th><td>	<b>return</b> bus_space_read_8(bst, bsh, <var>8</var>*i);</td></tr>
<tr><th id="2555">2555</th><td><u>#else</u></td></tr>
<tr><th id="2556">2556</th><td>	<i>/*</i></td></tr>
<tr><th id="2557">2557</th><td><i>	 * XXX I'm not sure this case can actually happen in practice:</i></td></tr>
<tr><th id="2558">2558</th><td><i>	 * 32-bit gen8 chipsets?</i></td></tr>
<tr><th id="2559">2559</th><td><i>	 */</i></td></tr>
<tr><th id="2560">2560</th><td>	<b>return</b> bus_space_read_4(bst, bsh, <var>8</var>*i) |</td></tr>
<tr><th id="2561">2561</th><td>	    ((uint64_t)bus_space_read_4(bst, bsh, <var>8</var>*i + <var>4</var>) &lt;&lt; <var>32</var>);</td></tr>
<tr><th id="2562">2562</th><td><u>#endif</u></td></tr>
<tr><th id="2563">2563</th><td>}</td></tr>
<tr><th id="2564">2564</th><td></td></tr>
<tr><th id="2565">2565</th><td><em>static</em> <b>inline</b> <em>void</em></td></tr>
<tr><th id="2566">2566</th><td>gen8_set_pte(bus_space_tag_t bst, bus_space_handle_t bsh, <em>unsigned</em> i,</td></tr>
<tr><th id="2567">2567</th><td>    gen8_pte_t pte)</td></tr>
<tr><th id="2568">2568</th><td>{</td></tr>
<tr><th id="2569">2569</th><td>	CTASSERT(_BYTE_ORDER == _LITTLE_ENDIAN); <i>/* x86 */</i></td></tr>
<tr><th id="2570">2570</th><td>	CTASSERT(<b>sizeof</b>(gen8_pte_t) == <var>8</var>);</td></tr>
<tr><th id="2571">2571</th><td><u>#ifdef _LP64			/* XXX How to detect bus_space_write_8?  */</u></td></tr>
<tr><th id="2572">2572</th><td>	bus_space_write_8(bst, bsh, <var>8</var>*i, pte);</td></tr>
<tr><th id="2573">2573</th><td><u>#else</u></td></tr>
<tr><th id="2574">2574</th><td>	bus_space_write_4(bst, bsh, <var>8</var>*i, (uint32_t)pte);</td></tr>
<tr><th id="2575">2575</th><td>	bus_space_write_4(bst, bsh, <var>8</var>*i + <var>4</var>, (uint32_t)(pte &gt;&gt; <var>32</var>));</td></tr>
<tr><th id="2576">2576</th><td><u>#endif</u></td></tr>
<tr><th id="2577">2577</th><td>}</td></tr>
<tr><th id="2578">2578</th><td><u>#<span data-ppcond="2547">else</span></u></td></tr>
<tr><th id="2579">2579</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_set_pte" title='gen8_set_pte' data-type='void gen8_set_pte(int __iomem)' data-ref="gen8_set_pte" data-ref-filename="gen8_set_pte">gen8_set_pte</dfn>(<em>void</em> <span class='error' title="argument may not have &apos;void&apos; type"><dfn class="local col7 decl" id="517__iomem" title='__iomem' data-type='int' data-ref="517__iomem" data-ref-filename="517__iomem">__iomem</dfn></span> <span class='error' title="expected &apos;)&apos;">*</span>addr, gen8_pte_t pte)</td></tr>
<tr><th id="2580">2580</th><td>{</td></tr>
<tr><th id="2581">2581</th><td><u>#<span data-ppcond="2581">ifdef</span> <span class="macro" data-ref="_M/writeq">writeq</span></u></td></tr>
<tr><th id="2582">2582</th><td>	writeq(pte, addr);</td></tr>
<tr><th id="2583">2583</th><td><u>#<span data-ppcond="2581">else</span></u></td></tr>
<tr><th id="2584">2584</th><td>	iowrite32((u32)<span class='error' title="use of undeclared identifier &apos;pte&apos;">pte</span>, <span class='error' title="use of undeclared identifier &apos;addr&apos;">addr</span>);</td></tr>
<tr><th id="2585">2585</th><td>	iowrite32(<span class='error' title="use of undeclared identifier &apos;pte&apos;">pte</span> &gt;&gt; <var>32</var>, <span class='error' title="use of undeclared identifier &apos;addr&apos;">addr</span> + <var>4</var>);</td></tr>
<tr><th id="2586">2586</th><td><u>#<span data-ppcond="2581">endif</span></u></td></tr>
<tr><th id="2587">2587</th><td>}</td></tr>
<tr><th id="2588">2588</th><td><u>#<span data-ppcond="2547">endif</span></u></td></tr>
<tr><th id="2589">2589</th><td></td></tr>
<tr><th id="2590">2590</th><td><u>#<span data-ppcond="2590">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2591">2591</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="2592">2592</th><td>gen8_ggtt_insert_entries(<b>struct</b> i915_address_space *vm, bus_dmamap_t dmamap,</td></tr>
<tr><th id="2593">2593</th><td>    uint64_t start, <b>enum</b> i915_cache_level level, uint32_t unused_flags)</td></tr>
<tr><th id="2594">2594</th><td>{</td></tr>
<tr><th id="2595">2595</th><td>	<b>struct</b> drm_i915_private *dev_priv = vm-&gt;dev-&gt;dev_private;</td></tr>
<tr><th id="2596">2596</th><td>	<em>unsigned</em> first_entry = start &gt;&gt; PAGE_SHIFT;</td></tr>
<tr><th id="2597">2597</th><td>	<em>const</em> bus_space_tag_t bst = dev_priv-&gt;gtt.bst;</td></tr>
<tr><th id="2598">2598</th><td>	<em>const</em> bus_space_handle_t bsh = dev_priv-&gt;gtt.bsh;</td></tr>
<tr><th id="2599">2599</th><td>	<em>unsigned</em> i;</td></tr>
<tr><th id="2600">2600</th><td></td></tr>
<tr><th id="2601">2601</th><td>	KASSERT(<var>0</var> &lt; dmamap-&gt;dm_nsegs);</td></tr>
<tr><th id="2602">2602</th><td>	<b>for</b> (i = <var>0</var>; i &lt; dmamap-&gt;dm_nsegs; i++) {</td></tr>
<tr><th id="2603">2603</th><td>		KASSERT(dmamap-&gt;dm_segs[i].ds_len == PAGE_SIZE);</td></tr>
<tr><th id="2604">2604</th><td>		gen8_set_pte(bst, bsh, first_entry + i,</td></tr>
<tr><th id="2605">2605</th><td>		    gen8_pte_encode(dmamap-&gt;dm_segs[i].ds_addr, level, true));</td></tr>
<tr><th id="2606">2606</th><td>	}</td></tr>
<tr><th id="2607">2607</th><td>	<b>if</b> (<var>0</var> &lt; i) {</td></tr>
<tr><th id="2608">2608</th><td>		<i>/* Posting read.  */</i></td></tr>
<tr><th id="2609">2609</th><td>		WARN_ON(gen8_get_pte(bst, bsh, (first_entry + i - <var>1</var>))</td></tr>
<tr><th id="2610">2610</th><td>		    != gen8_pte_encode(dmamap-&gt;dm_segs[i - <var>1</var>].ds_addr, level,</td></tr>
<tr><th id="2611">2611</th><td>			true));</td></tr>
<tr><th id="2612">2612</th><td>	}</td></tr>
<tr><th id="2613">2613</th><td>	I915_WRITE(GFX_FLSH_CNTL_GEN6, GFX_FLSH_CNTL_EN);</td></tr>
<tr><th id="2614">2614</th><td>	POSTING_READ(GFX_FLSH_CNTL_GEN6);</td></tr>
<tr><th id="2615">2615</th><td>}</td></tr>
<tr><th id="2616">2616</th><td><u>#<span data-ppcond="2590">else</span></u></td></tr>
<tr><th id="2617">2617</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ggtt_insert_entries" title='gen8_ggtt_insert_entries' data-type='void gen8_ggtt_insert_entries(struct i915_address_space * vm, struct sg_table * st, uint64_t start, enum i915_cache_level level, u32 unused)' data-ref="gen8_ggtt_insert_entries" data-ref-filename="gen8_ggtt_insert_entries">gen8_ggtt_insert_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="518vm" title='vm' data-type='struct i915_address_space *' data-ref="518vm" data-ref-filename="518vm">vm</dfn>,</td></tr>
<tr><th id="2618">2618</th><td>				     <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col9 decl" id="519st" title='st' data-type='struct sg_table *' data-ref="519st" data-ref-filename="519st">st</dfn>,</td></tr>
<tr><th id="2619">2619</th><td>				     <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="520start" title='start' data-type='uint64_t' data-ref="520start" data-ref-filename="520start">start</dfn>,</td></tr>
<tr><th id="2620">2620</th><td>				     <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col1 decl" id="521level" title='level' data-type='enum i915_cache_level' data-ref="521level" data-ref-filename="521level">level</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col2 decl" id="522unused" title='unused' data-type='u32' data-ref="522unused" data-ref-filename="522unused">unused</dfn>)</td></tr>
<tr><th id="2621">2621</th><td>{</td></tr>
<tr><th id="2622">2622</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col3 decl" id="523dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="523dev_priv" data-ref-filename="523dev_priv">dev_priv</dfn> = <a class="local col8 ref" href="#518vm" title='vm' data-ref="518vm" data-ref-filename="518vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2623">2623</th><td>	<em>unsigned</em> <dfn class="local col4 decl" id="524first_entry" title='first_entry' data-type='unsigned int' data-ref="524first_entry" data-ref-filename="524first_entry">first_entry</dfn> = <a class="local col0 ref" href="#520start" title='start' data-ref="520start" data-ref-filename="520start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2624">2624</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col5 decl" id="525__iomem" title='__iomem' data-type='gen8_pte_t' data-ref="525__iomem" data-ref-filename="525__iomem">__iomem</dfn><span class='error' title="expected &apos;;&apos; at end of declaration"></span> *gtt_entries =</td></tr>
<tr><th id="2625">2625</th><td>		(gen8_pte_t __iomem *)dev_priv-&gt;gtt.gsm + first_entry;</td></tr>
<tr><th id="2626">2626</th><td>	<em>int</em> <dfn class="local col6 decl" id="526i" title='i' data-type='int' data-ref="526i" data-ref-filename="526i">i</dfn> = <var>0</var>;</td></tr>
<tr><th id="2627">2627</th><td>	<b>struct</b> <dfn class="local col7 type" id="527sg_page_iter" title='sg_page_iter' data-ref="527sg_page_iter" data-ref-filename="527sg_page_iter"><a class="local col7 type" href="#527sg_page_iter" title='sg_page_iter' data-ref="527sg_page_iter" data-ref-filename="527sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col8 decl" id="528sg_iter" title='sg_iter' data-type='struct sg_page_iter' data-ref="528sg_iter" data-ref-filename="528sg_iter">sg_iter</dfn></span>;</td></tr>
<tr><th id="2628">2628</th><td>	<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col9 decl" id="529addr" title='addr' data-type='dma_addr_t' data-ref="529addr" data-ref-filename="529addr">addr</dfn> = <var>0</var>; <i>/* shut up gcc */</i></td></tr>
<tr><th id="2629">2629</th><td></td></tr>
<tr><th id="2630">2630</th><td>	for_each_sg_page(st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, &amp;sg_iter, st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents, <var>0</var>) {</td></tr>
<tr><th id="2631">2631</th><td>		addr = sg_dma_address(sg_iter.sg) +</td></tr>
<tr><th id="2632">2632</th><td>			(sg_iter.sg_pgoffset &lt;&lt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>);</td></tr>
<tr><th id="2633">2633</th><td>		gen8_set_pte(&amp;gtt_entries[i],</td></tr>
<tr><th id="2634">2634</th><td>			     gen8_pte_encode(addr, level, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>));</td></tr>
<tr><th id="2635">2635</th><td>		i++;</td></tr>
<tr><th id="2636">2636</th><td>	}</td></tr>
<tr><th id="2637">2637</th><td></td></tr>
<tr><th id="2638">2638</th><td>	<i>/*</i></td></tr>
<tr><th id="2639">2639</th><td><i>	 * XXX: This serves as a posting read to make sure that the PTE has</i></td></tr>
<tr><th id="2640">2640</th><td><i>	 * actually been updated. There is some concern that even though</i></td></tr>
<tr><th id="2641">2641</th><td><i>	 * registers and PTEs are within the same BAR that they are potentially</i></td></tr>
<tr><th id="2642">2642</th><td><i>	 * of NUMA access patterns. Therefore, even with the way we assume</i></td></tr>
<tr><th id="2643">2643</th><td><i>	 * hardware should work, we must keep this posting read for paranoia.</i></td></tr>
<tr><th id="2644">2644</th><td><i>	 */</i></td></tr>
<tr><th id="2645">2645</th><td>	<b>if</b> (i != <var>0</var>)</td></tr>
<tr><th id="2646">2646</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((readq(&amp;gtt_entries[i-1]) != gen8_pte_encode(addr, level, 1)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2647, &quot;readq(&amp;gtt_entries[i-1]) != gen8_pte_encode(addr, level, true)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(readq(&amp;gtt_entries[i-<var>1</var>])</td></tr>
<tr><th id="2647">2647</th><td>			!= gen8_pte_encode(addr, level, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>));</td></tr>
<tr><th id="2648">2648</th><td></td></tr>
<tr><th id="2649">2649</th><td>	<i>/* This next bit makes the above posting read even more important. We</i></td></tr>
<tr><th id="2650">2650</th><td><i>	 * want to flush the TLBs only after we're certain all the PTE updates</i></td></tr>
<tr><th id="2651">2651</th><td><i>	 * have finished.</i></td></tr>
<tr><th id="2652">2652</th><td><i>	 */</i></td></tr>
<tr><th id="2653">2653</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x101008), ((1&lt;&lt;0)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>, <a class="macro" href="i915_reg.h.html#1872" title="(1&lt;&lt;0)" data-ref="_M/GFX_FLSH_CNTL_EN">GFX_FLSH_CNTL_EN</a>);</td></tr>
<tr><th id="2654">2654</th><td>	<a class="macro" href="i915_drv.h.html#3615" title="(void)dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x101008), 0)" data-ref="_M/POSTING_READ">POSTING_READ</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>);</td></tr>
<tr><th id="2655">2655</th><td>}</td></tr>
<tr><th id="2656">2656</th><td><u>#<span data-ppcond="2590">endif</span></u></td></tr>
<tr><th id="2657">2657</th><td></td></tr>
<tr><th id="2658">2658</th><td><i>/*</i></td></tr>
<tr><th id="2659">2659</th><td><i> * Binds an object into the global gtt with the specified cache level. The object</i></td></tr>
<tr><th id="2660">2660</th><td><i> * will be accessible to the GPU via commands whose operands reference offsets</i></td></tr>
<tr><th id="2661">2661</th><td><i> * within the global GTT as well as accessible by the GPU through the GMADR</i></td></tr>
<tr><th id="2662">2662</th><td><i> * mapped BAR (dev_priv-&gt;mm.gtt-&gt;gtt).</i></td></tr>
<tr><th id="2663">2663</th><td><i> */</i></td></tr>
<tr><th id="2664">2664</th><td><u>#<span data-ppcond="2664">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2665">2665</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="2666">2666</th><td>gen6_ggtt_insert_entries(<b>struct</b> i915_address_space *vm, bus_dmamap_t dmamap,</td></tr>
<tr><th id="2667">2667</th><td>    uint64_t start, <b>enum</b> i915_cache_level level, uint32_t flags)</td></tr>
<tr><th id="2668">2668</th><td>{</td></tr>
<tr><th id="2669">2669</th><td>	<b>struct</b> drm_i915_private *dev_priv = vm-&gt;dev-&gt;dev_private;</td></tr>
<tr><th id="2670">2670</th><td>	<em>unsigned</em> first_entry = start &gt;&gt; PAGE_SHIFT;</td></tr>
<tr><th id="2671">2671</th><td>	<em>const</em> bus_space_tag_t bst = dev_priv-&gt;gtt.bst;</td></tr>
<tr><th id="2672">2672</th><td>	<em>const</em> bus_space_handle_t bsh = dev_priv-&gt;gtt.bsh;</td></tr>
<tr><th id="2673">2673</th><td>	<em>unsigned</em> i;</td></tr>
<tr><th id="2674">2674</th><td></td></tr>
<tr><th id="2675">2675</th><td>	KASSERT(<var>0</var> &lt; dmamap-&gt;dm_nsegs);</td></tr>
<tr><th id="2676">2676</th><td>	<b>for</b> (i = <var>0</var>; i &lt; dmamap-&gt;dm_nsegs; i++) {</td></tr>
<tr><th id="2677">2677</th><td>		KASSERT(dmamap-&gt;dm_segs[i].ds_len == PAGE_SIZE);</td></tr>
<tr><th id="2678">2678</th><td>		CTASSERT(<b>sizeof</b>(gen6_pte_t) == <var>4</var>);</td></tr>
<tr><th id="2679">2679</th><td>		bus_space_write_4(bst, bsh, <var>4</var>*(first_entry + i),</td></tr>
<tr><th id="2680">2680</th><td>		    vm-&gt;pte_encode(dmamap-&gt;dm_segs[i].ds_addr, level, true,</td></tr>
<tr><th id="2681">2681</th><td>			flags));</td></tr>
<tr><th id="2682">2682</th><td>	}</td></tr>
<tr><th id="2683">2683</th><td>	<b>if</b> (<var>0</var> &lt; i) {</td></tr>
<tr><th id="2684">2684</th><td>		<i>/* Posting read.  */</i></td></tr>
<tr><th id="2685">2685</th><td>		WARN_ON(bus_space_read_4(bst, bsh, <var>4</var>*(first_entry + i - <var>1</var>))</td></tr>
<tr><th id="2686">2686</th><td>		    != vm-&gt;pte_encode(dmamap-&gt;dm_segs[i - <var>1</var>].ds_addr, level,</td></tr>
<tr><th id="2687">2687</th><td>			true, flags));</td></tr>
<tr><th id="2688">2688</th><td>	}</td></tr>
<tr><th id="2689">2689</th><td>	I915_WRITE(GFX_FLSH_CNTL_GEN6, GFX_FLSH_CNTL_EN);</td></tr>
<tr><th id="2690">2690</th><td>	POSTING_READ(GFX_FLSH_CNTL_GEN6);</td></tr>
<tr><th id="2691">2691</th><td>}</td></tr>
<tr><th id="2692">2692</th><td><u>#<span data-ppcond="2664">else</span></u></td></tr>
<tr><th id="2693">2693</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ggtt_insert_entries" title='gen6_ggtt_insert_entries' data-type='void gen6_ggtt_insert_entries(struct i915_address_space * vm, struct sg_table * st, uint64_t start, enum i915_cache_level level, u32 flags)' data-ref="gen6_ggtt_insert_entries" data-ref-filename="gen6_ggtt_insert_entries">gen6_ggtt_insert_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="530vm" title='vm' data-type='struct i915_address_space *' data-ref="530vm" data-ref-filename="530vm">vm</dfn>,</td></tr>
<tr><th id="2694">2694</th><td>				     <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col1 decl" id="531st" title='st' data-type='struct sg_table *' data-ref="531st" data-ref-filename="531st">st</dfn>,</td></tr>
<tr><th id="2695">2695</th><td>				     <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="532start" title='start' data-type='uint64_t' data-ref="532start" data-ref-filename="532start">start</dfn>,</td></tr>
<tr><th id="2696">2696</th><td>				     <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col3 decl" id="533level" title='level' data-type='enum i915_cache_level' data-ref="533level" data-ref-filename="533level">level</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col4 decl" id="534flags" title='flags' data-type='u32' data-ref="534flags" data-ref-filename="534flags">flags</dfn>)</td></tr>
<tr><th id="2697">2697</th><td>{</td></tr>
<tr><th id="2698">2698</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col5 decl" id="535dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="535dev_priv" data-ref-filename="535dev_priv">dev_priv</dfn> = <a class="local col0 ref" href="#530vm" title='vm' data-ref="530vm" data-ref-filename="530vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2699">2699</th><td>	<em>unsigned</em> <dfn class="local col6 decl" id="536first_entry" title='first_entry' data-type='unsigned int' data-ref="536first_entry" data-ref-filename="536first_entry">first_entry</dfn> = <a class="local col2 ref" href="#532start" title='start' data-ref="532start" data-ref-filename="532start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2700">2700</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col7 decl" id="537__iomem" title='__iomem' data-type='gen6_pte_t' data-ref="537__iomem" data-ref-filename="537__iomem">__iomem</dfn><span class='error' title="expected &apos;;&apos; at end of declaration"></span> *gtt_entries =</td></tr>
<tr><th id="2701">2701</th><td>		(gen6_pte_t __iomem *)dev_priv-&gt;gtt.gsm + first_entry;</td></tr>
<tr><th id="2702">2702</th><td>	<em>int</em> <dfn class="local col8 decl" id="538i" title='i' data-type='int' data-ref="538i" data-ref-filename="538i">i</dfn> = <var>0</var>;</td></tr>
<tr><th id="2703">2703</th><td>	<b>struct</b> <dfn class="local col9 type" id="539sg_page_iter" title='sg_page_iter' data-ref="539sg_page_iter" data-ref-filename="539sg_page_iter"><a class="local col9 type" href="#539sg_page_iter" title='sg_page_iter' data-ref="539sg_page_iter" data-ref-filename="539sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col0 decl" id="540sg_iter" title='sg_iter' data-type='struct sg_page_iter' data-ref="540sg_iter" data-ref-filename="540sg_iter">sg_iter</dfn></span>;</td></tr>
<tr><th id="2704">2704</th><td>	<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> <dfn class="local col1 decl" id="541addr" title='addr' data-type='dma_addr_t' data-ref="541addr" data-ref-filename="541addr">addr</dfn> = <var>0</var>;</td></tr>
<tr><th id="2705">2705</th><td></td></tr>
<tr><th id="2706">2706</th><td>	for_each_sg_page(st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, &amp;sg_iter, st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents, <var>0</var>) {</td></tr>
<tr><th id="2707">2707</th><td>		addr = sg_page_iter_dma_address(&amp;sg_iter);</td></tr>
<tr><th id="2708">2708</th><td>		iowrite32(vm-&gt;pte_encode(addr, level, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, flags), &amp;gtt_entries[i]);</td></tr>
<tr><th id="2709">2709</th><td>		i++;</td></tr>
<tr><th id="2710">2710</th><td>	}</td></tr>
<tr><th id="2711">2711</th><td></td></tr>
<tr><th id="2712">2712</th><td>	<i>/* XXX: This serves as a posting read to make sure that the PTE has</i></td></tr>
<tr><th id="2713">2713</th><td><i>	 * actually been updated. There is some concern that even though</i></td></tr>
<tr><th id="2714">2714</th><td><i>	 * registers and PTEs are within the same BAR that they are potentially</i></td></tr>
<tr><th id="2715">2715</th><td><i>	 * of NUMA access patterns. Therefore, even with the way we assume</i></td></tr>
<tr><th id="2716">2716</th><td><i>	 * hardware should work, we must keep this posting read for paranoia.</i></td></tr>
<tr><th id="2717">2717</th><td><i>	 */</i></td></tr>
<tr><th id="2718">2718</th><td>	<b>if</b> (i != <var>0</var>) {</td></tr>
<tr><th id="2719">2719</th><td>		<em>unsigned</em> <em>long</em> gtt = readl(&amp;gtt_entries[i-<var>1</var>]);</td></tr>
<tr><th id="2720">2720</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((gtt != vm-&gt;pte_encode(addr, level, 1, flags)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2720, &quot;gtt != vm-&gt;pte_encode(addr, level, true, flags)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(gtt != vm-&gt;pte_encode(addr, level, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>, flags));</td></tr>
<tr><th id="2721">2721</th><td>	}</td></tr>
<tr><th id="2722">2722</th><td></td></tr>
<tr><th id="2723">2723</th><td>	<i>/* This next bit makes the above posting read even more important. We</i></td></tr>
<tr><th id="2724">2724</th><td><i>	 * want to flush the TLBs only after we're certain all the PTE updates</i></td></tr>
<tr><th id="2725">2725</th><td><i>	 * have finished.</i></td></tr>
<tr><th id="2726">2726</th><td><i>	 */</i></td></tr>
<tr><th id="2727">2727</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x101008), ((1&lt;&lt;0)), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>, <a class="macro" href="i915_reg.h.html#1872" title="(1&lt;&lt;0)" data-ref="_M/GFX_FLSH_CNTL_EN">GFX_FLSH_CNTL_EN</a>);</td></tr>
<tr><th id="2728">2728</th><td>	<a class="macro" href="i915_drv.h.html#3615" title="(void)dev_priv-&gt;uncore.funcs.mmio_readl(dev_priv, (0x101008), 0)" data-ref="_M/POSTING_READ">POSTING_READ</a>(<a class="macro" href="i915_reg.h.html#1871" title="0x101008" data-ref="_M/GFX_FLSH_CNTL_GEN6">GFX_FLSH_CNTL_GEN6</a>);</td></tr>
<tr><th id="2729">2729</th><td>}</td></tr>
<tr><th id="2730">2730</th><td><u>#<span data-ppcond="2664">endif</span></u></td></tr>
<tr><th id="2731">2731</th><td></td></tr>
<tr><th id="2732">2732</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen8_ggtt_clear_range" title='gen8_ggtt_clear_range' data-type='void gen8_ggtt_clear_range(struct i915_address_space * vm, uint64_t start, uint64_t length, _Bool use_scratch)' data-ref="gen8_ggtt_clear_range" data-ref-filename="gen8_ggtt_clear_range">gen8_ggtt_clear_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col2 decl" id="542vm" title='vm' data-type='struct i915_address_space *' data-ref="542vm" data-ref-filename="542vm">vm</dfn>,</td></tr>
<tr><th id="2733">2733</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col3 decl" id="543start" title='start' data-type='uint64_t' data-ref="543start" data-ref-filename="543start">start</dfn>,</td></tr>
<tr><th id="2734">2734</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="544length" title='length' data-type='uint64_t' data-ref="544length" data-ref-filename="544length">length</dfn>,</td></tr>
<tr><th id="2735">2735</th><td>				  <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col5 decl" id="545use_scratch" title='use_scratch' data-type='_Bool' data-ref="545use_scratch" data-ref-filename="545use_scratch">use_scratch</dfn>)</td></tr>
<tr><th id="2736">2736</th><td>{</td></tr>
<tr><th id="2737">2737</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="546dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="546dev_priv" data-ref-filename="546dev_priv">dev_priv</dfn> = <a class="local col2 ref" href="#542vm" title='vm' data-ref="542vm" data-ref-filename="542vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2738">2738</th><td>	<em>unsigned</em> <dfn class="local col7 decl" id="547first_entry" title='first_entry' data-type='unsigned int' data-ref="547first_entry" data-ref-filename="547first_entry">first_entry</dfn> = <a class="local col3 ref" href="#543start" title='start' data-ref="543start" data-ref-filename="543start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2739">2739</th><td>	<em>unsigned</em> <dfn class="local col8 decl" id="548num_entries" title='num_entries' data-type='unsigned int' data-ref="548num_entries" data-ref-filename="548num_entries">num_entries</dfn> = <a class="local col4 ref" href="#544length" title='length' data-ref="544length" data-ref-filename="544length">length</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2740">2740</th><td><u>#<span data-ppcond="2740">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2741">2741</th><td>	<em>const</em> bus_space_tag_t bst = dev_priv-&gt;gtt.bst;</td></tr>
<tr><th id="2742">2742</th><td>	<em>const</em> bus_space_handle_t bsh = dev_priv-&gt;gtt.bsh;</td></tr>
<tr><th id="2743">2743</th><td>	gen8_pte_t scratch_pte;</td></tr>
<tr><th id="2744">2744</th><td><u>#<span data-ppcond="2740">else</span></u></td></tr>
<tr><th id="2745">2745</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a> <dfn class="local col9 decl" id="549scratch_pte" title='scratch_pte' data-type='gen8_pte_t' data-ref="549scratch_pte" data-ref-filename="549scratch_pte">scratch_pte</dfn>, <dfn class="local col0 decl" id="550__iomem" title='__iomem' data-type='gen8_pte_t' data-ref="550__iomem" data-ref-filename="550__iomem">__iomem</dfn><span class='error' title="expected &apos;;&apos; at end of declaration"></span> *gtt_base =</td></tr>
<tr><th id="2746">2746</th><td>		(gen8_pte_t __iomem *) dev_priv-&gt;gtt.gsm + first_entry;</td></tr>
<tr><th id="2747">2747</th><td><u>#<span data-ppcond="2740">endif</span></u></td></tr>
<tr><th id="2748">2748</th><td>	<em>const</em> <em>int</em> <dfn class="local col1 decl" id="551max_entries" title='max_entries' data-type='const int' data-ref="551max_entries" data-ref-filename="551max_entries">max_entries</dfn> = <a class="macro" href="i915_gem_gtt.h.html#47" title="((dev_priv-&gt;gtt).base.total &gt;&gt; 12)" data-ref="_M/gtt_total_entries">gtt_total_entries</a>(dev_priv-&gt;gtt) - first_entry;</td></tr>
<tr><th id="2749">2749</th><td>	<em>int</em> <dfn class="local col2 decl" id="552i" title='i' data-type='int' data-ref="552i" data-ref-filename="552i">i</dfn>;</td></tr>
<tr><th id="2750">2750</th><td></td></tr>
<tr><th id="2751">2751</th><td>	<b>if</b> (<a class="macro" href="../../../include/asm/bug.h.html#47" title="linux_warning((num_entries &gt; max_entries)? (printf(&quot;warning: %s:%d: &quot; &quot;First entry = %d; Num entries = %d (max=%d)\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2753, first_entry, num_entries, max_entries), 1) : 0)" data-ref="_M/WARN">WARN</a>(<a class="local col8 ref" href="#548num_entries" title='num_entries' data-ref="548num_entries" data-ref-filename="548num_entries">num_entries</a> &gt; <a class="local col1 ref" href="#551max_entries" title='max_entries' data-ref="551max_entries" data-ref-filename="551max_entries">max_entries</a>,</td></tr>
<tr><th id="2752">2752</th><td>		 <q>"First entry = %d; Num entries = %d (max=%d)\n"</q>,</td></tr>
<tr><th id="2753">2753</th><td>		 <a class="local col7 ref" href="#547first_entry" title='first_entry' data-ref="547first_entry" data-ref-filename="547first_entry">first_entry</a>, <a class="local col8 ref" href="#548num_entries" title='num_entries' data-ref="548num_entries" data-ref-filename="548num_entries">num_entries</a>, <a class="local col1 ref" href="#551max_entries" title='max_entries' data-ref="551max_entries" data-ref-filename="551max_entries">max_entries</a>))</td></tr>
<tr><th id="2754">2754</th><td>		<a class="local col8 ref" href="#548num_entries" title='num_entries' data-ref="548num_entries" data-ref-filename="548num_entries">num_entries</a> = <a class="local col1 ref" href="#551max_entries" title='max_entries' data-ref="551max_entries" data-ref-filename="551max_entries">max_entries</a>;</td></tr>
<tr><th id="2755">2755</th><td></td></tr>
<tr><th id="2756">2756</th><td>	<a class="local col9 ref" href="#549scratch_pte" title='scratch_pte' data-ref="549scratch_pte" data-ref-filename="549scratch_pte">scratch_pte</a> = <a class="tu ref fn" href="#gen8_pte_encode" title='gen8_pte_encode' data-use='c' data-ref="gen8_pte_encode" data-ref-filename="gen8_pte_encode">gen8_pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col2 ref" href="#542vm" title='vm' data-ref="542vm" data-ref-filename="542vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="2757">2757</th><td>				      <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>,</td></tr>
<tr><th id="2758">2758</th><td>				      <a class="local col5 ref" href="#545use_scratch" title='use_scratch' data-ref="545use_scratch" data-ref-filename="545use_scratch">use_scratch</a>);</td></tr>
<tr><th id="2759">2759</th><td><u>#<span data-ppcond="2759">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2760">2760</th><td>	<b>for</b> (i = <var>0</var>; i &lt; num_entries; i++)</td></tr>
<tr><th id="2761">2761</th><td>		gen8_set_pte(bst, bsh, first_entry + i, scratch_pte);</td></tr>
<tr><th id="2762">2762</th><td>	(<em>void</em>)gen8_get_pte(bst, bsh, first_entry);</td></tr>
<tr><th id="2763">2763</th><td><u>#<span data-ppcond="2759">else</span></u></td></tr>
<tr><th id="2764">2764</th><td>	<b>for</b> (i = <var>0</var>; i &lt; num_entries; i++)</td></tr>
<tr><th id="2765">2765</th><td>		gen8_set_pte(&amp;<span class='error' title="use of undeclared identifier &apos;gtt_base&apos;">gtt_base</span>[i], scratch_pte);</td></tr>
<tr><th id="2766">2766</th><td>	readl(<span class='error' title="use of undeclared identifier &apos;gtt_base&apos;">gtt_base</span>);</td></tr>
<tr><th id="2767">2767</th><td><u>#<span data-ppcond="2759">endif</span></u></td></tr>
<tr><th id="2768">2768</th><td>}</td></tr>
<tr><th id="2769">2769</th><td></td></tr>
<tr><th id="2770">2770</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_ggtt_clear_range" title='gen6_ggtt_clear_range' data-type='void gen6_ggtt_clear_range(struct i915_address_space * vm, uint64_t start, uint64_t length, _Bool use_scratch)' data-ref="gen6_ggtt_clear_range" data-ref-filename="gen6_ggtt_clear_range">gen6_ggtt_clear_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col3 decl" id="553vm" title='vm' data-type='struct i915_address_space *' data-ref="553vm" data-ref-filename="553vm">vm</dfn>,</td></tr>
<tr><th id="2771">2771</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col4 decl" id="554start" title='start' data-type='uint64_t' data-ref="554start" data-ref-filename="554start">start</dfn>,</td></tr>
<tr><th id="2772">2772</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col5 decl" id="555length" title='length' data-type='uint64_t' data-ref="555length" data-ref-filename="555length">length</dfn>,</td></tr>
<tr><th id="2773">2773</th><td>				  <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col6 decl" id="556use_scratch" title='use_scratch' data-type='_Bool' data-ref="556use_scratch" data-ref-filename="556use_scratch">use_scratch</dfn>)</td></tr>
<tr><th id="2774">2774</th><td>{</td></tr>
<tr><th id="2775">2775</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col7 decl" id="557dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="557dev_priv" data-ref-filename="557dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#553vm" title='vm' data-ref="553vm" data-ref-filename="553vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2776">2776</th><td>	<em>unsigned</em> <dfn class="local col8 decl" id="558first_entry" title='first_entry' data-type='unsigned int' data-ref="558first_entry" data-ref-filename="558first_entry">first_entry</dfn> = <a class="local col4 ref" href="#554start" title='start' data-ref="554start" data-ref-filename="554start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2777">2777</th><td>	<em>unsigned</em> <dfn class="local col9 decl" id="559num_entries" title='num_entries' data-type='unsigned int' data-ref="559num_entries" data-ref-filename="559num_entries">num_entries</dfn> = <a class="local col5 ref" href="#555length" title='length' data-ref="555length" data-ref-filename="555length">length</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2778">2778</th><td><u>#<span data-ppcond="2778">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2779">2779</th><td>	<em>const</em> bus_space_tag_t bst = dev_priv-&gt;gtt.bst;</td></tr>
<tr><th id="2780">2780</th><td>	<em>const</em> bus_space_handle_t bsh = dev_priv-&gt;gtt.bsh;</td></tr>
<tr><th id="2781">2781</th><td>	gen8_pte_t scratch_pte;</td></tr>
<tr><th id="2782">2782</th><td><u>#<span data-ppcond="2778">else</span></u></td></tr>
<tr><th id="2783">2783</th><td>	<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a> <dfn class="local col0 decl" id="560scratch_pte" title='scratch_pte' data-type='gen6_pte_t' data-ref="560scratch_pte" data-ref-filename="560scratch_pte">scratch_pte</dfn>, <dfn class="local col1 decl" id="561__iomem" title='__iomem' data-type='gen6_pte_t' data-ref="561__iomem" data-ref-filename="561__iomem">__iomem</dfn><span class='error' title="expected &apos;;&apos; at end of declaration"></span> *gtt_base =</td></tr>
<tr><th id="2784">2784</th><td>		(gen6_pte_t __iomem *) dev_priv-&gt;gtt.gsm + first_entry;</td></tr>
<tr><th id="2785">2785</th><td><u>#<span data-ppcond="2778">endif</span></u></td></tr>
<tr><th id="2786">2786</th><td>	<em>const</em> <em>int</em> <dfn class="local col2 decl" id="562max_entries" title='max_entries' data-type='const int' data-ref="562max_entries" data-ref-filename="562max_entries">max_entries</dfn> = <a class="macro" href="i915_gem_gtt.h.html#47" title="((dev_priv-&gt;gtt).base.total &gt;&gt; 12)" data-ref="_M/gtt_total_entries">gtt_total_entries</a>(dev_priv-&gt;gtt) - first_entry;</td></tr>
<tr><th id="2787">2787</th><td>	<em>int</em> <dfn class="local col3 decl" id="563i" title='i' data-type='int' data-ref="563i" data-ref-filename="563i">i</dfn>;</td></tr>
<tr><th id="2788">2788</th><td></td></tr>
<tr><th id="2789">2789</th><td>	<b>if</b> (<a class="macro" href="../../../include/asm/bug.h.html#47" title="linux_warning((num_entries &gt; max_entries)? (printf(&quot;warning: %s:%d: &quot; &quot;First entry = %d; Num entries = %d (max=%d)\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2791, first_entry, num_entries, max_entries), 1) : 0)" data-ref="_M/WARN">WARN</a>(<a class="local col9 ref" href="#559num_entries" title='num_entries' data-ref="559num_entries" data-ref-filename="559num_entries">num_entries</a> &gt; <a class="local col2 ref" href="#562max_entries" title='max_entries' data-ref="562max_entries" data-ref-filename="562max_entries">max_entries</a>,</td></tr>
<tr><th id="2790">2790</th><td>		 <q>"First entry = %d; Num entries = %d (max=%d)\n"</q>,</td></tr>
<tr><th id="2791">2791</th><td>		 <a class="local col8 ref" href="#558first_entry" title='first_entry' data-ref="558first_entry" data-ref-filename="558first_entry">first_entry</a>, <a class="local col9 ref" href="#559num_entries" title='num_entries' data-ref="559num_entries" data-ref-filename="559num_entries">num_entries</a>, <a class="local col2 ref" href="#562max_entries" title='max_entries' data-ref="562max_entries" data-ref-filename="562max_entries">max_entries</a>))</td></tr>
<tr><th id="2792">2792</th><td>		<a class="local col9 ref" href="#559num_entries" title='num_entries' data-ref="559num_entries" data-ref-filename="559num_entries">num_entries</a> = <a class="local col2 ref" href="#562max_entries" title='max_entries' data-ref="562max_entries" data-ref-filename="562max_entries">max_entries</a>;</td></tr>
<tr><th id="2793">2793</th><td></td></tr>
<tr><th id="2794">2794</th><td>	<a class="local col0 ref" href="#560scratch_pte" title='scratch_pte' data-ref="560scratch_pte" data-ref-filename="560scratch_pte">scratch_pte</a> = <a class="local col3 ref" href="#553vm" title='vm' data-ref="553vm" data-ref-filename="553vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a>(<a class="macro" href="i915_gem_gtt.h.html#260" title="((&amp;(vm-&gt;scratch_page)-&gt;base)-&gt;daddr)" data-ref="_M/px_dma">px_dma</a>(<a class="local col3 ref" href="#553vm" title='vm' data-ref="553vm" data-ref-filename="553vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>),</td></tr>
<tr><th id="2795">2795</th><td>				     <a class="enum" href="i915_drv.h.html#I915_CACHE_LLC" title='I915_CACHE_LLC' data-ref="I915_CACHE_LLC" data-ref-filename="I915_CACHE_LLC">I915_CACHE_LLC</a>, <a class="local col6 ref" href="#556use_scratch" title='use_scratch' data-ref="556use_scratch" data-ref-filename="556use_scratch">use_scratch</a>, <var>0</var>);</td></tr>
<tr><th id="2796">2796</th><td></td></tr>
<tr><th id="2797">2797</th><td><u>#<span data-ppcond="2797">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2798">2798</th><td>	CTASSERT(<b>sizeof</b>(gen6_pte_t) == <var>4</var>);</td></tr>
<tr><th id="2799">2799</th><td>	<b>for</b> (i = <var>0</var>; i &lt; num_entries; i++)</td></tr>
<tr><th id="2800">2800</th><td>		bus_space_write_4(bst, bsh, <var>4</var>*(first_entry + i), scratch_pte);</td></tr>
<tr><th id="2801">2801</th><td>	(<em>void</em>)bus_space_read_4(bst, bsh, <var>4</var>*first_entry);</td></tr>
<tr><th id="2802">2802</th><td><u>#<span data-ppcond="2797">else</span></u></td></tr>
<tr><th id="2803">2803</th><td>	<b>for</b> (i = <var>0</var>; i &lt; num_entries; i++)</td></tr>
<tr><th id="2804">2804</th><td>		iowrite32(scratch_pte, &amp;<span class='error' title="use of undeclared identifier &apos;gtt_base&apos;">gtt_base</span>[i]);</td></tr>
<tr><th id="2805">2805</th><td>	readl(<span class='error' title="use of undeclared identifier &apos;gtt_base&apos;">gtt_base</span>);</td></tr>
<tr><th id="2806">2806</th><td><u>#<span data-ppcond="2797">endif</span></u></td></tr>
<tr><th id="2807">2807</th><td>}</td></tr>
<tr><th id="2808">2808</th><td></td></tr>
<tr><th id="2809">2809</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_ggtt_insert_entries" title='i915_ggtt_insert_entries' data-type='void i915_ggtt_insert_entries(struct i915_address_space * vm, struct sg_table * pages, uint64_t start, enum i915_cache_level cache_level, u32 unused)' data-ref="i915_ggtt_insert_entries" data-ref-filename="i915_ggtt_insert_entries">i915_ggtt_insert_entries</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col4 decl" id="564vm" title='vm' data-type='struct i915_address_space *' data-ref="564vm" data-ref-filename="564vm">vm</dfn>,</td></tr>
<tr><th id="2810">2810</th><td><u>#<span data-ppcond="2810">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2811">2811</th><td>				     bus_dmamap_t pages,</td></tr>
<tr><th id="2812">2812</th><td><u>#<span data-ppcond="2810">else</span></u></td></tr>
<tr><th id="2813">2813</th><td>				     <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col5 decl" id="565pages" title='pages' data-type='struct sg_table *' data-ref="565pages" data-ref-filename="565pages">pages</dfn>,</td></tr>
<tr><th id="2814">2814</th><td><u>#<span data-ppcond="2810">endif</span></u></td></tr>
<tr><th id="2815">2815</th><td>				     <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="566start" title='start' data-type='uint64_t' data-ref="566start" data-ref-filename="566start">start</dfn>,</td></tr>
<tr><th id="2816">2816</th><td>				     <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col7 decl" id="567cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="567cache_level" data-ref-filename="567cache_level">cache_level</dfn>, <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col8 decl" id="568unused" title='unused' data-type='u32' data-ref="568unused" data-ref-filename="568unused">unused</dfn>)</td></tr>
<tr><th id="2817">2817</th><td>{</td></tr>
<tr><th id="2818">2818</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col9 decl" id="569flags" title='flags' data-type='unsigned int' data-ref="569flags" data-ref-filename="569flags">flags</dfn> = (<a class="local col7 ref" href="#567cache_level" title='cache_level' data-ref="567cache_level" data-ref-filename="567cache_level">cache_level</a> == <a class="enum" href="i915_drv.h.html#I915_CACHE_NONE" title='I915_CACHE_NONE' data-ref="I915_CACHE_NONE" data-ref-filename="I915_CACHE_NONE">I915_CACHE_NONE</a>) ?</td></tr>
<tr><th id="2819">2819</th><td>		<a class="macro" href="../../../include/drm/intel-gtt.h.html#53" title="1" data-ref="_M/AGP_USER_MEMORY">AGP_USER_MEMORY</a> : <a class="macro" href="../../../include/drm/intel-gtt.h.html#54" title="2" data-ref="_M/AGP_USER_CACHED_MEMORY">AGP_USER_CACHED_MEMORY</a>;</td></tr>
<tr><th id="2820">2820</th><td></td></tr>
<tr><th id="2821">2821</th><td>	<a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gtt_insert_sg_entries" title='intel_gtt_insert_sg_entries' data-ref="intel_gtt_insert_sg_entries" data-ref-filename="intel_gtt_insert_sg_entries">intel_gtt_insert_sg_entries</a>(<a class="local col5 ref" href="#565pages" title='pages' data-ref="565pages" data-ref-filename="565pages">pages</a>, <a class="local col6 ref" href="#566start" title='start' data-ref="566start" data-ref-filename="566start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>, <a class="local col9 ref" href="#569flags" title='flags' data-ref="569flags" data-ref-filename="569flags">flags</a>);</td></tr>
<tr><th id="2822">2822</th><td>}</td></tr>
<tr><th id="2823">2823</th><td></td></tr>
<tr><th id="2824">2824</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_ggtt_clear_range" title='i915_ggtt_clear_range' data-type='void i915_ggtt_clear_range(struct i915_address_space * vm, uint64_t start, uint64_t length, _Bool unused)' data-ref="i915_ggtt_clear_range" data-ref-filename="i915_ggtt_clear_range">i915_ggtt_clear_range</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="570vm" title='vm' data-type='struct i915_address_space *' data-ref="570vm" data-ref-filename="570vm">vm</dfn>,</td></tr>
<tr><th id="2825">2825</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col1 decl" id="571start" title='start' data-type='uint64_t' data-ref="571start" data-ref-filename="571start">start</dfn>,</td></tr>
<tr><th id="2826">2826</th><td>				  <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="572length" title='length' data-type='uint64_t' data-ref="572length" data-ref-filename="572length">length</dfn>,</td></tr>
<tr><th id="2827">2827</th><td>				  <a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col3 decl" id="573unused" title='unused' data-type='_Bool' data-ref="573unused" data-ref-filename="573unused">unused</dfn>)</td></tr>
<tr><th id="2828">2828</th><td>{</td></tr>
<tr><th id="2829">2829</th><td>	<em>unsigned</em> <dfn class="local col4 decl" id="574first_entry" title='first_entry' data-type='unsigned int' data-ref="574first_entry" data-ref-filename="574first_entry">first_entry</dfn> = <a class="local col1 ref" href="#571start" title='start' data-ref="571start" data-ref-filename="571start">start</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2830">2830</th><td>	<em>unsigned</em> <dfn class="local col5 decl" id="575num_entries" title='num_entries' data-type='unsigned int' data-ref="575num_entries" data-ref-filename="575num_entries">num_entries</dfn> = <a class="local col2 ref" href="#572length" title='length' data-ref="572length" data-ref-filename="572length">length</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="2831">2831</th><td>	<a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gtt_clear_range" title='intel_gtt_clear_range' data-ref="intel_gtt_clear_range" data-ref-filename="intel_gtt_clear_range">intel_gtt_clear_range</a>(<a class="local col4 ref" href="#574first_entry" title='first_entry' data-ref="574first_entry" data-ref-filename="574first_entry">first_entry</a>, <a class="local col5 ref" href="#575num_entries" title='num_entries' data-ref="575num_entries" data-ref-filename="575num_entries">num_entries</a>);</td></tr>
<tr><th id="2832">2832</th><td>}</td></tr>
<tr><th id="2833">2833</th><td></td></tr>
<tr><th id="2834">2834</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="ggtt_bind_vma" title='ggtt_bind_vma' data-type='int ggtt_bind_vma(struct i915_vma * vma, enum i915_cache_level cache_level, u32 flags)' data-ref="ggtt_bind_vma" data-ref-filename="ggtt_bind_vma">ggtt_bind_vma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col6 decl" id="576vma" title='vma' data-type='struct i915_vma *' data-ref="576vma" data-ref-filename="576vma">vma</dfn>,</td></tr>
<tr><th id="2835">2835</th><td>			 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col7 decl" id="577cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="577cache_level" data-ref-filename="577cache_level">cache_level</dfn>,</td></tr>
<tr><th id="2836">2836</th><td>			 <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col8 decl" id="578flags" title='flags' data-type='u32' data-ref="578flags" data-ref-filename="578flags">flags</dfn>)</td></tr>
<tr><th id="2837">2837</th><td>{</td></tr>
<tr><th id="2838">2838</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col9 decl" id="579obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="579obj" data-ref-filename="579obj">obj</dfn> = <a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>;</td></tr>
<tr><th id="2839">2839</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col0 decl" id="580pte_flags" title='pte_flags' data-type='u32' data-ref="580pte_flags" data-ref-filename="580pte_flags">pte_flags</dfn> = <var>0</var>;</td></tr>
<tr><th id="2840">2840</th><td>	<em>int</em> <dfn class="local col1 decl" id="581ret" title='ret' data-type='int' data-ref="581ret" data-ref-filename="581ret">ret</dfn>;</td></tr>
<tr><th id="2841">2841</th><td></td></tr>
<tr><th id="2842">2842</th><td>	<a class="local col1 ref" href="#581ret" title='ret' data-ref="581ret" data-ref-filename="581ret">ret</a> = <a class="tu ref fn" href="#i915_get_ggtt_vma_pages" title='i915_get_ggtt_vma_pages' data-use='c' data-ref="i915_get_ggtt_vma_pages" data-ref-filename="i915_get_ggtt_vma_pages">i915_get_ggtt_vma_pages</a>(<a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>);</td></tr>
<tr><th id="2843">2843</th><td>	<b>if</b> (<a class="local col1 ref" href="#581ret" title='ret' data-ref="581ret" data-ref-filename="581ret">ret</a>)</td></tr>
<tr><th id="2844">2844</th><td>		<b>return</b> <a class="local col1 ref" href="#581ret" title='ret' data-ref="581ret" data-ref-filename="581ret">ret</a>;</td></tr>
<tr><th id="2845">2845</th><td></td></tr>
<tr><th id="2846">2846</th><td>	<i>/* Currently applicable only to VLV */</i></td></tr>
<tr><th id="2847">2847</th><td>	<b>if</b> (<a class="local col9 ref" href="#579obj" title='obj' data-ref="579obj" data-ref-filename="579obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::gt_ro" title='drm_i915_gem_object::gt_ro' data-ref="drm_i915_gem_object::gt_ro" data-ref-filename="drm_i915_gem_object..gt_ro">gt_ro</a>)</td></tr>
<tr><th id="2848">2848</th><td>		<a class="local col0 ref" href="#580pte_flags" title='pte_flags' data-ref="580pte_flags" data-ref-filename="580pte_flags">pte_flags</a> |= <a class="macro" href="i915_gem_gtt.h.html#334" title="(1&lt;&lt;0)" data-ref="_M/PTE_READ_ONLY">PTE_READ_ONLY</a>;</td></tr>
<tr><th id="2849">2849</th><td></td></tr>
<tr><th id="2850">2850</th><td>	<a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a>(<a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>, <a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>,</td></tr>
<tr><th id="2851">2851</th><td>				<a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="2852">2852</th><td>				<a class="local col7 ref" href="#577cache_level" title='cache_level' data-ref="577cache_level" data-ref-filename="577cache_level">cache_level</a>, <a class="local col0 ref" href="#580pte_flags" title='pte_flags' data-ref="580pte_flags" data-ref-filename="580pte_flags">pte_flags</a>);</td></tr>
<tr><th id="2853">2853</th><td></td></tr>
<tr><th id="2854">2854</th><td>	<i>/*</i></td></tr>
<tr><th id="2855">2855</th><td><i>	 * Without aliasing PPGTT there's no difference between</i></td></tr>
<tr><th id="2856">2856</th><td><i>	 * GLOBAL/LOCAL_BIND, it's all the same ptes. Hence unconditionally</i></td></tr>
<tr><th id="2857">2857</th><td><i>	 * upgrade to both bound if we bind either to avoid double-binding.</i></td></tr>
<tr><th id="2858">2858</th><td><i>	 */</i></td></tr>
<tr><th id="2859">2859</th><td>	<a class="local col6 ref" href="#576vma" title='vma' data-ref="576vma" data-ref-filename="576vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> |= <a class="macro" href="i915_gem_gtt.h.html#193" title="(1&lt;&lt;0)" data-ref="_M/GLOBAL_BIND">GLOBAL_BIND</a> | <a class="macro" href="i915_gem_gtt.h.html#194" title="(1&lt;&lt;1)" data-ref="_M/LOCAL_BIND">LOCAL_BIND</a>;</td></tr>
<tr><th id="2860">2860</th><td></td></tr>
<tr><th id="2861">2861</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2862">2862</th><td>}</td></tr>
<tr><th id="2863">2863</th><td></td></tr>
<tr><th id="2864">2864</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="aliasing_gtt_bind_vma" title='aliasing_gtt_bind_vma' data-type='int aliasing_gtt_bind_vma(struct i915_vma * vma, enum i915_cache_level cache_level, u32 flags)' data-ref="aliasing_gtt_bind_vma" data-ref-filename="aliasing_gtt_bind_vma">aliasing_gtt_bind_vma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col2 decl" id="582vma" title='vma' data-type='struct i915_vma *' data-ref="582vma" data-ref-filename="582vma">vma</dfn>,</td></tr>
<tr><th id="2865">2865</th><td>				 <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col3 decl" id="583cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="583cache_level" data-ref-filename="583cache_level">cache_level</dfn>,</td></tr>
<tr><th id="2866">2866</th><td>				 <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col4 decl" id="584flags" title='flags' data-type='u32' data-ref="584flags" data-ref-filename="584flags">flags</dfn>)</td></tr>
<tr><th id="2867">2867</th><td>{</td></tr>
<tr><th id="2868">2868</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col5 decl" id="585dev" title='dev' data-type='struct drm_device *' data-ref="585dev" data-ref-filename="585dev">dev</dfn> = <a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2869">2869</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="586dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="586dev_priv" data-ref-filename="586dev_priv">dev_priv</dfn> = <a class="local col5 ref" href="#585dev" title='dev' data-ref="585dev" data-ref-filename="585dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2870">2870</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col7 decl" id="587obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="587obj" data-ref-filename="587obj">obj</dfn> = <a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>;</td></tr>
<tr><th id="2871">2871</th><td><u>#<span data-ppcond="2871">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2872">2872</th><td>	bus_dmamap_t pages = obj-&gt;pages;</td></tr>
<tr><th id="2873">2873</th><td><u>#<span data-ppcond="2871">else</span></u></td></tr>
<tr><th id="2874">2874</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col8 decl" id="588pages" title='pages' data-type='struct sg_table *' data-ref="588pages" data-ref-filename="588pages">pages</dfn> = <a class="local col7 ref" href="#587obj" title='obj' data-ref="587obj" data-ref-filename="587obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::pages" title='drm_i915_gem_object::pages' data-ref="drm_i915_gem_object::pages" data-ref-filename="drm_i915_gem_object..pages">pages</a>;</td></tr>
<tr><th id="2875">2875</th><td><u>#<span data-ppcond="2871">endif</span></u></td></tr>
<tr><th id="2876">2876</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col9 decl" id="589pte_flags" title='pte_flags' data-type='u32' data-ref="589pte_flags" data-ref-filename="589pte_flags">pte_flags</dfn> = <var>0</var>;</td></tr>
<tr><th id="2877">2877</th><td>	<em>int</em> <dfn class="local col0 decl" id="590ret" title='ret' data-type='int' data-ref="590ret" data-ref-filename="590ret">ret</dfn>;</td></tr>
<tr><th id="2878">2878</th><td></td></tr>
<tr><th id="2879">2879</th><td>	<a class="local col0 ref" href="#590ret" title='ret' data-ref="590ret" data-ref-filename="590ret">ret</a> = <a class="tu ref fn" href="#i915_get_ggtt_vma_pages" title='i915_get_ggtt_vma_pages' data-use='c' data-ref="i915_get_ggtt_vma_pages" data-ref-filename="i915_get_ggtt_vma_pages">i915_get_ggtt_vma_pages</a>(<a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>);</td></tr>
<tr><th id="2880">2880</th><td>	<b>if</b> (<a class="local col0 ref" href="#590ret" title='ret' data-ref="590ret" data-ref-filename="590ret">ret</a>)</td></tr>
<tr><th id="2881">2881</th><td>		<b>return</b> <a class="local col0 ref" href="#590ret" title='ret' data-ref="590ret" data-ref-filename="590ret">ret</a>;</td></tr>
<tr><th id="2882">2882</th><td>	<a class="local col8 ref" href="#588pages" title='pages' data-ref="588pages" data-ref-filename="588pages">pages</a> = <a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>;</td></tr>
<tr><th id="2883">2883</th><td></td></tr>
<tr><th id="2884">2884</th><td>	<i>/* Currently applicable only to VLV */</i></td></tr>
<tr><th id="2885">2885</th><td>	<b>if</b> (<a class="local col7 ref" href="#587obj" title='obj' data-ref="587obj" data-ref-filename="587obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::gt_ro" title='drm_i915_gem_object::gt_ro' data-ref="drm_i915_gem_object::gt_ro" data-ref-filename="drm_i915_gem_object..gt_ro">gt_ro</a>)</td></tr>
<tr><th id="2886">2886</th><td>		<a class="local col9 ref" href="#589pte_flags" title='pte_flags' data-ref="589pte_flags" data-ref-filename="589pte_flags">pte_flags</a> |= <a class="macro" href="i915_gem_gtt.h.html#334" title="(1&lt;&lt;0)" data-ref="_M/PTE_READ_ONLY">PTE_READ_ONLY</a>;</td></tr>
<tr><th id="2887">2887</th><td></td></tr>
<tr><th id="2888">2888</th><td></td></tr>
<tr><th id="2889">2889</th><td>	<b>if</b> (<a class="local col4 ref" href="#584flags" title='flags' data-ref="584flags" data-ref-filename="584flags">flags</a> &amp; <a class="macro" href="i915_gem_gtt.h.html#193" title="(1&lt;&lt;0)" data-ref="_M/GLOBAL_BIND">GLOBAL_BIND</a>) {</td></tr>
<tr><th id="2890">2890</th><td>		<a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a>(<a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>, <a class="local col8 ref" href="#588pages" title='pages' data-ref="588pages" data-ref-filename="588pages">pages</a>,</td></tr>
<tr><th id="2891">2891</th><td>					<a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="2892">2892</th><td>					<a class="local col3 ref" href="#583cache_level" title='cache_level' data-ref="583cache_level" data-ref-filename="583cache_level">cache_level</a>, <a class="local col9 ref" href="#589pte_flags" title='pte_flags' data-ref="589pte_flags" data-ref-filename="589pte_flags">pte_flags</a>);</td></tr>
<tr><th id="2893">2893</th><td>	}</td></tr>
<tr><th id="2894">2894</th><td></td></tr>
<tr><th id="2895">2895</th><td>	<b>if</b> (<a class="local col4 ref" href="#584flags" title='flags' data-ref="584flags" data-ref-filename="584flags">flags</a> &amp; <a class="macro" href="i915_gem_gtt.h.html#194" title="(1&lt;&lt;1)" data-ref="_M/LOCAL_BIND">LOCAL_BIND</a>) {</td></tr>
<tr><th id="2896">2896</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="591appgtt" title='appgtt' data-type='struct i915_hw_ppgtt *' data-ref="591appgtt" data-ref-filename="591appgtt">appgtt</dfn> = <a class="local col6 ref" href="#586dev_priv" title='dev_priv' data-ref="586dev_priv" data-ref-filename="586dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>;</td></tr>
<tr><th id="2897">2897</th><td>		<a class="local col1 ref" href="#591appgtt" title='appgtt' data-ref="591appgtt" data-ref-filename="591appgtt">appgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::insert_entries" title='i915_address_space::insert_entries' data-ref="i915_address_space::insert_entries" data-ref-filename="i915_address_space..insert_entries">insert_entries</a>(&amp;<a class="local col1 ref" href="#591appgtt" title='appgtt' data-ref="591appgtt" data-ref-filename="591appgtt">appgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, <a class="local col8 ref" href="#588pages" title='pages' data-ref="588pages" data-ref-filename="588pages">pages</a>,</td></tr>
<tr><th id="2898">2898</th><td>					    <a class="local col2 ref" href="#582vma" title='vma' data-ref="582vma" data-ref-filename="582vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="2899">2899</th><td>					    <a class="local col3 ref" href="#583cache_level" title='cache_level' data-ref="583cache_level" data-ref-filename="583cache_level">cache_level</a>, <a class="local col9 ref" href="#589pte_flags" title='pte_flags' data-ref="589pte_flags" data-ref-filename="589pte_flags">pte_flags</a>);</td></tr>
<tr><th id="2900">2900</th><td>	}</td></tr>
<tr><th id="2901">2901</th><td></td></tr>
<tr><th id="2902">2902</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="2903">2903</th><td>}</td></tr>
<tr><th id="2904">2904</th><td></td></tr>
<tr><th id="2905">2905</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="ggtt_unbind_vma" title='ggtt_unbind_vma' data-type='void ggtt_unbind_vma(struct i915_vma * vma)' data-ref="ggtt_unbind_vma" data-ref-filename="ggtt_unbind_vma">ggtt_unbind_vma</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col2 decl" id="592vma" title='vma' data-type='struct i915_vma *' data-ref="592vma" data-ref-filename="592vma">vma</dfn>)</td></tr>
<tr><th id="2906">2906</th><td>{</td></tr>
<tr><th id="2907">2907</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="593dev" title='dev' data-type='struct drm_device *' data-ref="593dev" data-ref-filename="593dev">dev</dfn> = <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>;</td></tr>
<tr><th id="2908">2908</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="594dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="594dev_priv" data-ref-filename="594dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#593dev" title='dev' data-ref="593dev" data-ref-filename="593dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2909">2909</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col5 decl" id="595obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="595obj" data-ref-filename="595obj">obj</dfn> = <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>;</td></tr>
<tr><th id="2910">2910</th><td>	<em>const</em> <a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col6 decl" id="596size" title='size' data-type='const uint64_t' data-ref="596size" data-ref-filename="596size">size</dfn> = <a class="macro" href="../../../../common/include/linux/kernel.h.html#79" title="(( (obj-&gt;base.size)&lt;(vma-&gt;node.size))?(obj-&gt;base.size):(vma-&gt;node.size))" data-ref="_M/min_t">min_t</a>(uint64_t,</td></tr>
<tr><th id="2911">2911</th><td>				    <a class="local col5 ref" href="#595obj" title='obj' data-ref="595obj" data-ref-filename="595obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>,</td></tr>
<tr><th id="2912">2912</th><td>				    <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::size" title='drm_mm_node::size' data-ref="drm_mm_node::size" data-ref-filename="drm_mm_node..size">size</a>);</td></tr>
<tr><th id="2913">2913</th><td></td></tr>
<tr><th id="2914">2914</th><td>	<b>if</b> (<a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> &amp; <a class="macro" href="i915_gem_gtt.h.html#193" title="(1&lt;&lt;0)" data-ref="_M/GLOBAL_BIND">GLOBAL_BIND</a>) {</td></tr>
<tr><th id="2915">2915</th><td>		<a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(<a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>,</td></tr>
<tr><th id="2916">2916</th><td>				     <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="2917">2917</th><td>				     <a class="local col6 ref" href="#596size" title='size' data-ref="596size" data-ref-filename="596size">size</a>,</td></tr>
<tr><th id="2918">2918</th><td>				     <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="2919">2919</th><td>	}</td></tr>
<tr><th id="2920">2920</th><td></td></tr>
<tr><th id="2921">2921</th><td>	<b>if</b> (<a class="local col4 ref" href="#594dev_priv" title='dev_priv' data-ref="594dev_priv" data-ref-filename="594dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a> &amp;&amp; <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> &amp; <a class="macro" href="i915_gem_gtt.h.html#194" title="(1&lt;&lt;1)" data-ref="_M/LOCAL_BIND">LOCAL_BIND</a>) {</td></tr>
<tr><th id="2922">2922</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col7 decl" id="597appgtt" title='appgtt' data-type='struct i915_hw_ppgtt *' data-ref="597appgtt" data-ref-filename="597appgtt">appgtt</dfn> = <a class="local col4 ref" href="#594dev_priv" title='dev_priv' data-ref="594dev_priv" data-ref-filename="594dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>;</td></tr>
<tr><th id="2923">2923</th><td></td></tr>
<tr><th id="2924">2924</th><td>		<a class="local col7 ref" href="#597appgtt" title='appgtt' data-ref="597appgtt" data-ref-filename="597appgtt">appgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(&amp;<a class="local col7 ref" href="#597appgtt" title='appgtt' data-ref="597appgtt" data-ref-filename="597appgtt">appgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>,</td></tr>
<tr><th id="2925">2925</th><td>					 <a class="local col2 ref" href="#592vma" title='vma' data-ref="592vma" data-ref-filename="592vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="2926">2926</th><td>					 <a class="local col6 ref" href="#596size" title='size' data-ref="596size" data-ref-filename="596size">size</a>,</td></tr>
<tr><th id="2927">2927</th><td>					 <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="2928">2928</th><td>	}</td></tr>
<tr><th id="2929">2929</th><td>}</td></tr>
<tr><th id="2930">2930</th><td></td></tr>
<tr><th id="2931">2931</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_gtt_finish_object" title='i915_gem_gtt_finish_object' data-ref="i915_gem_gtt_finish_object" data-ref-filename="i915_gem_gtt_finish_object">i915_gem_gtt_finish_object</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col8 decl" id="598obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="598obj" data-ref-filename="598obj">obj</dfn>)</td></tr>
<tr><th id="2932">2932</th><td>{</td></tr>
<tr><th id="2933">2933</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="599dev" title='dev' data-type='struct drm_device *' data-ref="599dev" data-ref-filename="599dev">dev</dfn> = <a class="local col8 ref" href="#598obj" title='obj' data-ref="598obj" data-ref-filename="598obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::dev" title='drm_gem_object::dev' data-ref="drm_gem_object::dev" data-ref-filename="drm_gem_object..dev">dev</a>;</td></tr>
<tr><th id="2934">2934</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col0 decl" id="600dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="600dev_priv" data-ref-filename="600dev_priv">dev_priv</dfn> = <a class="local col9 ref" href="#599dev" title='dev' data-ref="599dev" data-ref-filename="599dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2935">2935</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col1 decl" id="601interruptible" title='interruptible' data-type='_Bool' data-ref="601interruptible" data-ref-filename="601interruptible">interruptible</dfn>;</td></tr>
<tr><th id="2936">2936</th><td></td></tr>
<tr><th id="2937">2937</th><td>	<a class="local col1 ref" href="#601interruptible" title='interruptible' data-ref="601interruptible" data-ref-filename="601interruptible">interruptible</a> = <a class="tu ref fn" href="#do_idling" title='do_idling' data-use='c' data-ref="do_idling" data-ref-filename="do_idling">do_idling</a>(<a class="local col0 ref" href="#600dev_priv" title='dev_priv' data-ref="600dev_priv" data-ref-filename="600dev_priv">dev_priv</a>);</td></tr>
<tr><th id="2938">2938</th><td></td></tr>
<tr><th id="2939">2939</th><td><u>#<span data-ppcond="2939">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="2940">2940</th><td>	bus_dmamap_unload(dev-&gt;dmat, obj-&gt;pages);</td></tr>
<tr><th id="2941">2941</th><td><u>#<span data-ppcond="2939">else</span></u></td></tr>
<tr><th id="2942">2942</th><td>	dma_unmap_sg(&amp;dev-&gt;pdev-&gt;<span class='error' title="no member named &apos;dev&apos; in &apos;struct pci_dev&apos;">dev</span>, obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents,</td></tr>
<tr><th id="2943">2943</th><td>		     <span class='error' title="use of undeclared identifier &apos;PCI_DMA_BIDIRECTIONAL&apos;">PCI_DMA_BIDIRECTIONAL</span>);</td></tr>
<tr><th id="2944">2944</th><td><u>#<span data-ppcond="2939">endif</span></u></td></tr>
<tr><th id="2945">2945</th><td></td></tr>
<tr><th id="2946">2946</th><td>	<a class="tu ref fn" href="#undo_idling" title='undo_idling' data-use='c' data-ref="undo_idling" data-ref-filename="undo_idling">undo_idling</a>(<a class="local col0 ref" href="#600dev_priv" title='dev_priv' data-ref="600dev_priv" data-ref-filename="600dev_priv">dev_priv</a>, <a class="local col1 ref" href="#601interruptible" title='interruptible' data-ref="601interruptible" data-ref-filename="601interruptible">interruptible</a>);</td></tr>
<tr><th id="2947">2947</th><td>}</td></tr>
<tr><th id="2948">2948</th><td></td></tr>
<tr><th id="2949">2949</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_gtt_color_adjust" title='i915_gtt_color_adjust' data-type='void i915_gtt_color_adjust(struct drm_mm_node * node, unsigned long color, u64 * start, u64 * end)' data-ref="i915_gtt_color_adjust" data-ref-filename="i915_gtt_color_adjust">i915_gtt_color_adjust</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drm_mm.h.html#drm_mm_node" title='drm_mm_node' data-ref="drm_mm_node" data-ref-filename="drm_mm_node">drm_mm_node</a> *<dfn class="local col2 decl" id="602node" title='node' data-type='struct drm_mm_node *' data-ref="602node" data-ref-filename="602node">node</dfn>,</td></tr>
<tr><th id="2950">2950</th><td>				  <em>unsigned</em> <em>long</em> <dfn class="local col3 decl" id="603color" title='color' data-type='unsigned long' data-ref="603color" data-ref-filename="603color">color</dfn>,</td></tr>
<tr><th id="2951">2951</th><td>				  <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col4 decl" id="604start" title='start' data-type='u64 *' data-ref="604start" data-ref-filename="604start">start</dfn>,</td></tr>
<tr><th id="2952">2952</th><td>				  <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col5 decl" id="605end" title='end' data-type='u64 *' data-ref="605end" data-ref-filename="605end">end</dfn>)</td></tr>
<tr><th id="2953">2953</th><td>{</td></tr>
<tr><th id="2954">2954</th><td>	<b>if</b> (<a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a>-&gt;<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::color" title='drm_mm_node::color' data-ref="drm_mm_node::color" data-ref-filename="drm_mm_node..color">color</a> != <a class="local col3 ref" href="#603color" title='color' data-ref="603color" data-ref-filename="603color">color</a>)</td></tr>
<tr><th id="2955">2955</th><td>		*<a class="local col4 ref" href="#604start" title='start' data-ref="604start" data-ref-filename="604start">start</a> += <var>4096</var>;</td></tr>
<tr><th id="2956">2956</th><td></td></tr>
<tr><th id="2957">2957</th><td>	<b>if</b> (!<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_empty" title='list_empty' data-ref="list_empty" data-ref-filename="list_empty">list_empty</a>(&amp;<a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a>-&gt;<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::node_list" title='drm_mm_node::node_list' data-ref="drm_mm_node::node_list" data-ref-filename="drm_mm_node..node_list">node_list</a>)) {</td></tr>
<tr><th id="2958">2958</th><td>		<a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a> = <a class="macro" href="../../../../common/include/linux/list.h.html#224" title="((struct drm_mm_node *)(((char *)(node-&gt;node_list.next)) - __builtin_offsetof(struct drm_mm_node, node_list)) + (0 * sizeof((node-&gt;node_list.next) - &amp;((struct drm_mm_node *)(((char *)(node-&gt;node_list.next)) - __builtin_offsetof(struct drm_mm_node, node_list)))-&gt;node_list)))" data-ref="_M/list_entry">list_entry</a>(<a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a>-&gt;<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::node_list" title='drm_mm_node::node_list' data-ref="drm_mm_node::node_list" data-ref-filename="drm_mm_node..node_list">node_list</a>.<a class="ref field" href="../../../../common/include/linux/list.h.html#list_head::next" title='list_head::next' data-ref="list_head::next" data-ref-filename="list_head..next">next</a>,</td></tr>
<tr><th id="2959">2959</th><td>				  <b>struct</b> <a class="type" href="../../include/drm/drm_mm.h.html#drm_mm_node" title='drm_mm_node' data-ref="drm_mm_node" data-ref-filename="drm_mm_node">drm_mm_node</a>,</td></tr>
<tr><th id="2960">2960</th><td>				  <a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::node_list" title='drm_mm_node::node_list' data-ref="drm_mm_node::node_list" data-ref-filename="drm_mm_node..node_list">node_list</a>);</td></tr>
<tr><th id="2961">2961</th><td>		<b>if</b> (<a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a>-&gt;<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::allocated" title='drm_mm_node::allocated' data-ref="drm_mm_node::allocated" data-ref-filename="drm_mm_node..allocated">allocated</a> &amp;&amp; <a class="local col2 ref" href="#602node" title='node' data-ref="602node" data-ref-filename="602node">node</a>-&gt;<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::color" title='drm_mm_node::color' data-ref="drm_mm_node::color" data-ref-filename="drm_mm_node..color">color</a> != <a class="local col3 ref" href="#603color" title='color' data-ref="603color" data-ref-filename="603color">color</a>)</td></tr>
<tr><th id="2962">2962</th><td>			*<a class="local col5 ref" href="#605end" title='end' data-ref="605end" data-ref-filename="605end">end</a> -= <var>4096</var>;</td></tr>
<tr><th id="2963">2963</th><td>	}</td></tr>
<tr><th id="2964">2964</th><td>}</td></tr>
<tr><th id="2965">2965</th><td></td></tr>
<tr><th id="2966">2966</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="i915_gem_setup_global_gtt" title='i915_gem_setup_global_gtt' data-type='int i915_gem_setup_global_gtt(struct drm_device * dev, u64 start, u64 mappable_end, u64 end)' data-ref="i915_gem_setup_global_gtt" data-ref-filename="i915_gem_setup_global_gtt">i915_gem_setup_global_gtt</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col6 decl" id="606dev" title='dev' data-type='struct drm_device *' data-ref="606dev" data-ref-filename="606dev">dev</dfn>,</td></tr>
<tr><th id="2967">2967</th><td>				     <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col7 decl" id="607start" title='start' data-type='u64' data-ref="607start" data-ref-filename="607start">start</dfn>,</td></tr>
<tr><th id="2968">2968</th><td>				     <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col8 decl" id="608mappable_end" title='mappable_end' data-type='u64' data-ref="608mappable_end" data-ref-filename="608mappable_end">mappable_end</dfn>,</td></tr>
<tr><th id="2969">2969</th><td>				     <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col9 decl" id="609end" title='end' data-type='u64' data-ref="609end" data-ref-filename="609end">end</dfn>)</td></tr>
<tr><th id="2970">2970</th><td>{</td></tr>
<tr><th id="2971">2971</th><td>	<i>/* Let GEM Manage all of the aperture.</i></td></tr>
<tr><th id="2972">2972</th><td><i>	 *</i></td></tr>
<tr><th id="2973">2973</th><td><i>	 * However, leave one page at the end still bound to the scratch page.</i></td></tr>
<tr><th id="2974">2974</th><td><i>	 * There are a number of places where the hardware apparently prefetches</i></td></tr>
<tr><th id="2975">2975</th><td><i>	 * past the end of the object, and we've seen multiple hangs with the</i></td></tr>
<tr><th id="2976">2976</th><td><i>	 * GPU head pointer stuck in a batchbuffer bound at the last page of the</i></td></tr>
<tr><th id="2977">2977</th><td><i>	 * aperture.  One page should be enough to keep any prefetching inside</i></td></tr>
<tr><th id="2978">2978</th><td><i>	 * of the aperture.</i></td></tr>
<tr><th id="2979">2979</th><td><i>	 */</i></td></tr>
<tr><th id="2980">2980</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col0 decl" id="610dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="610dev_priv" data-ref-filename="610dev_priv">dev_priv</dfn> = <a class="local col6 ref" href="#606dev" title='dev' data-ref="606dev" data-ref-filename="606dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="2981">2981</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="611ggtt_vm" title='ggtt_vm' data-type='struct i915_address_space *' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</dfn> = &amp;dev_priv-&gt;gtt.base;</td></tr>
<tr><th id="2982">2982</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drm_mm.h.html#drm_mm_node" title='drm_mm_node' data-ref="drm_mm_node" data-ref-filename="drm_mm_node">drm_mm_node</a> *<dfn class="local col2 decl" id="612entry" title='entry' data-type='struct drm_mm_node *' data-ref="612entry" data-ref-filename="612entry">entry</dfn>;</td></tr>
<tr><th id="2983">2983</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col3 decl" id="613obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="613obj" data-ref-filename="613obj">obj</dfn>;</td></tr>
<tr><th id="2984">2984</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col4 decl" id="614hole_start" title='hole_start' data-type='unsigned long' data-ref="614hole_start" data-ref-filename="614hole_start">hole_start</dfn>, <dfn class="local col5 decl" id="615hole_end" title='hole_end' data-type='unsigned long' data-ref="615hole_end" data-ref-filename="615hole_end">hole_end</dfn>;</td></tr>
<tr><th id="2985">2985</th><td>	<em>int</em> <dfn class="local col6 decl" id="616ret" title='ret' data-type='int' data-ref="616ret" data-ref-filename="616ret">ret</dfn>;</td></tr>
<tr><th id="2986">2986</th><td></td></tr>
<tr><th id="2987">2987</th><td>	<a class="macro" href="../../../include/asm/bug.h.html#39" title="(__builtin_expect(((!(mappable_end &gt; end))) != 0, 1) ? (void)0 : kern_assert(&quot;kernel %sassertion \&quot;%s\&quot; failed: file \&quot;%s\&quot;, line %d &quot;, &quot;diagnostic &quot;, &quot;!(mappable_end &gt; end)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 2987))" data-ref="_M/BUG_ON">BUG_ON</a>(<a class="local col8 ref" href="#608mappable_end" title='mappable_end' data-ref="608mappable_end" data-ref-filename="608mappable_end">mappable_end</a> &gt; <a class="local col9 ref" href="#609end" title='end' data-ref="609end" data-ref-filename="609end">end</a>);</td></tr>
<tr><th id="2988">2988</th><td></td></tr>
<tr><th id="2989">2989</th><td>	<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a> = <a class="local col7 ref" href="#607start" title='start' data-ref="607start" data-ref-filename="607start">start</a>;</td></tr>
<tr><th id="2990">2990</th><td></td></tr>
<tr><th id="2991">2991</th><td>	<i>/* Subtract the guard page before address space initialization to</i></td></tr>
<tr><th id="2992">2992</th><td><i>	 * shrink the range used by drm_mm */</i></td></tr>
<tr><th id="2993">2993</th><td>	<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> = <a class="local col9 ref" href="#609end" title='end' data-ref="609end" data-ref-filename="609end">end</a> - <a class="local col7 ref" href="#607start" title='start' data-ref="607start" data-ref-filename="607start">start</a> - <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>;</td></tr>
<tr><th id="2994">2994</th><td>	<a class="tu ref fn" href="#i915_address_space_init" title='i915_address_space_init' data-use='c' data-ref="i915_address_space_init" data-ref-filename="i915_address_space_init">i915_address_space_init</a>(<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>, <a class="local col0 ref" href="#610dev_priv" title='dev_priv' data-ref="610dev_priv" data-ref-filename="610dev_priv">dev_priv</a>);</td></tr>
<tr><th id="2995">2995</th><td>	<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> += <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>;</td></tr>
<tr><th id="2996">2996</th><td></td></tr>
<tr><th id="2997">2997</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col6 ref" href="#606dev" title='dev' data-ref="606dev" data-ref-filename="606dev">dev</a>)) {</td></tr>
<tr><th id="2998">2998</th><td>		<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a> = <a class="ref fn" href="i915_vgpu.h.html#intel_vgt_balloon" title='intel_vgt_balloon' data-ref="intel_vgt_balloon" data-ref-filename="intel_vgt_balloon">intel_vgt_balloon</a>(<a class="local col6 ref" href="#606dev" title='dev' data-ref="606dev" data-ref-filename="606dev">dev</a>);</td></tr>
<tr><th id="2999">2999</th><td>		<b>if</b> (<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>)</td></tr>
<tr><th id="3000">3000</th><td>			<b>return</b> <a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>;</td></tr>
<tr><th id="3001">3001</th><td>	}</td></tr>
<tr><th id="3002">3002</th><td></td></tr>
<tr><th id="3003">3003</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2655" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;has_llc)" data-ref="_M/HAS_LLC">HAS_LLC</a>(<a class="local col6 ref" href="#606dev" title='dev' data-ref="606dev" data-ref-filename="606dev">dev</a>))</td></tr>
<tr><th id="3004">3004</th><td>		<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm::color_adjust" title='drm_mm::color_adjust' data-ref="drm_mm::color_adjust" data-ref-filename="drm_mm..color_adjust">color_adjust</a> = <a class="tu ref fn" href="#i915_gtt_color_adjust" title='i915_gtt_color_adjust' data-use='r' data-ref="i915_gtt_color_adjust" data-ref-filename="i915_gtt_color_adjust">i915_gtt_color_adjust</a>;</td></tr>
<tr><th id="3005">3005</th><td></td></tr>
<tr><th id="3006">3006</th><td>	<i>/* Mark any preallocated objects as occupied */</i></td></tr>
<tr><th id="3007">3007</th><td>	<a class="macro" href="../../../../common/include/linux/list.h.html#246" title="for ((obj) = ((typeof(*(obj)) *)(((char *)(list_first((&amp;dev_priv-&gt;mm.bound_list)))) - __builtin_offsetof(typeof(*(obj)), global_list)) + (0 * sizeof((list_first((&amp;dev_priv-&gt;mm.bound_list))) - &amp;((typeof(*(obj)) *)(((char *)(list_first((&amp;dev_priv-&gt;mm.bound_list)))) - __builtin_offsetof(typeof(*(obj)), global_list)))-&gt;global_list))); &amp;(obj)-&gt;global_list != (&amp;dev_priv-&gt;mm.bound_list); (obj) = ((typeof(*(obj)) *)(((char *)(list_next(&amp;(obj)-&gt;global_list))) - __builtin_offsetof(typeof(*(obj)), global_list)) + (0 * sizeof((list_next(&amp;(obj)-&gt;global_list)) - &amp;((typeof(*(obj)) *)(((char *)(list_next(&amp;(obj)-&gt;global_list))) - __builtin_offsetof(typeof(*(obj)), global_list)))-&gt;global_list))))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col3 ref" href="#613obj" title='obj' data-ref="613obj" data-ref-filename="613obj">obj</a>, &amp;<a class="local col0 ref" href="#610dev_priv" title='dev_priv' data-ref="610dev_priv" data-ref-filename="610dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::bound_list" title='i915_gem_mm::bound_list' data-ref="i915_gem_mm::bound_list" data-ref-filename="i915_gem_mm..bound_list">bound_list</a>, <a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::global_list" title='drm_i915_gem_object::global_list' data-ref="drm_i915_gem_object::global_list" data-ref-filename="drm_i915_gem_object..global_list">global_list</a>) {</td></tr>
<tr><th id="3008">3008</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col7 decl" id="617vma" title='vma' data-type='struct i915_vma *' data-ref="617vma" data-ref-filename="617vma">vma</dfn> = <a class="ref fn" href="i915_drv.h.html#i915_gem_obj_to_vma" title='i915_gem_obj_to_vma' data-ref="i915_gem_obj_to_vma" data-ref-filename="i915_gem_obj_to_vma">i915_gem_obj_to_vma</a>(<a class="local col3 ref" href="#613obj" title='obj' data-ref="613obj" data-ref-filename="613obj">obj</a>, <a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>);</td></tr>
<tr><th id="3009">3009</th><td></td></tr>
<tr><th id="3010">3010</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#239" title="do { if (__builtin_expect((drm_debug &amp; 0x04) != 0, 0)) drm_ut_debug_printk(__func__, &quot;reserving preallocated space: %&quot;&quot;lx&quot;&quot; + %zx\n&quot;, i915_gem_obj_ggtt_offset(obj), obj-&gt;base.size); } while (0)" data-ref="_M/DRM_DEBUG_KMS">DRM_DEBUG_KMS</a>(<q>"reserving preallocated space: %"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#109" title="&quot;lx&quot;" data-ref="_M/PRIx64">PRIx64</a><q>" + %zx\n"</q>,</td></tr>
<tr><th id="3011">3011</th><td>			      <a class="ref fn" href="i915_drv.h.html#i915_gem_obj_ggtt_offset" title='i915_gem_obj_ggtt_offset' data-ref="i915_gem_obj_ggtt_offset" data-ref-filename="i915_gem_obj_ggtt_offset">i915_gem_obj_ggtt_offset</a>(<a class="local col3 ref" href="#613obj" title='obj' data-ref="613obj" data-ref-filename="613obj">obj</a>), <a class="local col3 ref" href="#613obj" title='obj' data-ref="613obj" data-ref-filename="613obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>);</td></tr>
<tr><th id="3012">3012</th><td></td></tr>
<tr><th id="3013">3013</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((i915_gem_obj_ggtt_bound(obj)))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3013, &quot;i915_gem_obj_ggtt_bound(obj)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="i915_drv.h.html#i915_gem_obj_ggtt_bound" title='i915_gem_obj_ggtt_bound' data-ref="i915_gem_obj_ggtt_bound" data-ref-filename="i915_gem_obj_ggtt_bound">i915_gem_obj_ggtt_bound</a>(<a class="local col3 ref" href="#613obj" title='obj' data-ref="613obj" data-ref-filename="613obj">obj</a>));</td></tr>
<tr><th id="3014">3014</th><td>		<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a> = <a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_reserve_node" title='drm_mm_reserve_node' data-ref="drm_mm_reserve_node" data-ref-filename="drm_mm_reserve_node">drm_mm_reserve_node</a>(&amp;<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>, &amp;<a class="local col7 ref" href="#617vma" title='vma' data-ref="617vma" data-ref-filename="617vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>);</td></tr>
<tr><th id="3015">3015</th><td>		<b>if</b> (<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>) {</td></tr>
<tr><th id="3016">3016</th><td>			<a class="macro" href="../../include/drm/drmP.h.html#239" title="do { if (__builtin_expect((drm_debug &amp; 0x04) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Reservation failed: %i\n&quot;, ret); } while (0)" data-ref="_M/DRM_DEBUG_KMS">DRM_DEBUG_KMS</a>(<q>"Reservation failed: %i\n"</q>, <a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>);</td></tr>
<tr><th id="3017">3017</th><td>			<b>return</b> <a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>;</td></tr>
<tr><th id="3018">3018</th><td>		}</td></tr>
<tr><th id="3019">3019</th><td>		<a class="local col7 ref" href="#617vma" title='vma' data-ref="617vma" data-ref-filename="617vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> |= <a class="macro" href="i915_gem_gtt.h.html#193" title="(1&lt;&lt;0)" data-ref="_M/GLOBAL_BIND">GLOBAL_BIND</a>;</td></tr>
<tr><th id="3020">3020</th><td>		<a class="ref fn" href="i915_drv.h.html#__i915_vma_set_map_and_fenceable" title='__i915_vma_set_map_and_fenceable' data-ref="__i915_vma_set_map_and_fenceable" data-ref-filename="__i915_vma_set_map_and_fenceable">__i915_vma_set_map_and_fenceable</a>(<a class="local col7 ref" href="#617vma" title='vma' data-ref="617vma" data-ref-filename="617vma">vma</a>);</td></tr>
<tr><th id="3021">3021</th><td>		<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_add_tail" title='list_add_tail' data-ref="list_add_tail" data-ref-filename="list_add_tail">list_add_tail</a>(&amp;<a class="local col7 ref" href="#617vma" title='vma' data-ref="617vma" data-ref-filename="617vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::mm_list" title='i915_vma::mm_list' data-ref="i915_vma::mm_list" data-ref-filename="i915_vma..mm_list">mm_list</a>, &amp;<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::inactive_list" title='i915_address_space::inactive_list' data-ref="i915_address_space::inactive_list" data-ref-filename="i915_address_space..inactive_list">inactive_list</a>);</td></tr>
<tr><th id="3022">3022</th><td>	}</td></tr>
<tr><th id="3023">3023</th><td></td></tr>
<tr><th id="3024">3024</th><td>	<i>/* Clear any non-preallocated blocks */</i></td></tr>
<tr><th id="3025">3025</th><td>	<a class="macro" href="../../include/drm/drm_mm.h.html#205" title="for (entry = ((struct drm_mm_node *)(((char *)((&amp;ggtt_vm-&gt;mm)-&gt;hole_stack.next)) - __builtin_offsetof(struct drm_mm_node, hole_stack)) + (0 * sizeof(((&amp;ggtt_vm-&gt;mm)-&gt;hole_stack.next) - &amp;((struct drm_mm_node *)(((char *)((&amp;ggtt_vm-&gt;mm)-&gt;hole_stack.next)) - __builtin_offsetof(struct drm_mm_node, hole_stack)))-&gt;hole_stack))); &amp;entry-&gt;hole_stack != &amp;(&amp;ggtt_vm-&gt;mm)-&gt;hole_stack ? hole_start = drm_mm_hole_node_start(entry), hole_end = drm_mm_hole_node_end(entry), 1 : 0; entry = ((struct drm_mm_node *)(((char *)(entry-&gt;hole_stack.next)) - __builtin_offsetof(struct drm_mm_node, hole_stack)) + (0 * sizeof((entry-&gt;hole_stack.next) - &amp;((struct drm_mm_node *)(((char *)(entry-&gt;hole_stack.next)) - __builtin_offsetof(struct drm_mm_node, hole_stack)))-&gt;hole_stack))))" data-ref="_M/drm_mm_for_each_hole">drm_mm_for_each_hole</a>(<a class="local col2 ref" href="#612entry" title='entry' data-ref="612entry" data-ref-filename="612entry">entry</a>, &amp;<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>, <a class="local col4 ref" href="#614hole_start" title='hole_start' data-ref="614hole_start" data-ref-filename="614hole_start">hole_start</a>, <a class="local col5 ref" href="#615hole_end" title='hole_end' data-ref="615hole_end" data-ref-filename="615hole_end">hole_end</a>) {</td></tr>
<tr><th id="3026">3026</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#239" title="do { if (__builtin_expect((drm_debug &amp; 0x04) != 0, 0)) drm_ut_debug_printk(__func__, &quot;clearing unused GTT space: [%lx, %lx]\n&quot;, hole_start, hole_end); } while (0)" data-ref="_M/DRM_DEBUG_KMS">DRM_DEBUG_KMS</a>(<q>"clearing unused GTT space: [%lx, %lx]\n"</q>,</td></tr>
<tr><th id="3027">3027</th><td>			      <a class="local col4 ref" href="#614hole_start" title='hole_start' data-ref="614hole_start" data-ref-filename="614hole_start">hole_start</a>, <a class="local col5 ref" href="#615hole_end" title='hole_end' data-ref="615hole_end" data-ref-filename="615hole_end">hole_end</a>);</td></tr>
<tr><th id="3028">3028</th><td>		<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>, <a class="local col4 ref" href="#614hole_start" title='hole_start' data-ref="614hole_start" data-ref-filename="614hole_start">hole_start</a>,</td></tr>
<tr><th id="3029">3029</th><td>				     <a class="local col5 ref" href="#615hole_end" title='hole_end' data-ref="615hole_end" data-ref-filename="615hole_end">hole_end</a> - <a class="local col4 ref" href="#614hole_start" title='hole_start' data-ref="614hole_start" data-ref-filename="614hole_start">hole_start</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="3030">3030</th><td>	}</td></tr>
<tr><th id="3031">3031</th><td></td></tr>
<tr><th id="3032">3032</th><td>	<i>/* And finally clear the reserved guard page */</i></td></tr>
<tr><th id="3033">3033</th><td>	<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(<a class="local col1 ref" href="#611ggtt_vm" title='ggtt_vm' data-ref="611ggtt_vm" data-ref-filename="611ggtt_vm">ggtt_vm</a>, <a class="local col9 ref" href="#609end" title='end' data-ref="609end" data-ref-filename="609end">end</a> - <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="3034">3034</th><td></td></tr>
<tr><th id="3035">3035</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2662" title="(i915.enable_ppgtt)" data-ref="_M/USES_PPGTT">USES_PPGTT</a>(dev) &amp;&amp; !<a class="macro" href="i915_drv.h.html#2663" title="(i915.enable_ppgtt &gt;= 2)" data-ref="_M/USES_FULL_PPGTT">USES_FULL_PPGTT</a>(dev)) {</td></tr>
<tr><th id="3036">3036</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col8 decl" id="618ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</dfn>;</td></tr>
<tr><th id="3037">3037</th><td></td></tr>
<tr><th id="3038">3038</th><td>		<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kzalloc" title='kzalloc' data-ref="kzalloc" data-ref-filename="kzalloc">kzalloc</a>(<b>sizeof</b>(*<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3039">3039</th><td>		<b>if</b> (!<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>)</td></tr>
<tr><th id="3040">3040</th><td>			<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3041">3041</th><td></td></tr>
<tr><th id="3042">3042</th><td>		<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a> = <a class="tu ref fn" href="#__hw_ppgtt_init" title='__hw_ppgtt_init' data-use='c' data-ref="__hw_ppgtt_init" data-ref-filename="__hw_ppgtt_init">__hw_ppgtt_init</a>(<a class="local col6 ref" href="#606dev" title='dev' data-ref="606dev" data-ref-filename="606dev">dev</a>, <a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>);</td></tr>
<tr><th id="3043">3043</th><td>		<b>if</b> (<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>) {</td></tr>
<tr><th id="3044">3044</th><td>			<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a>(&amp;<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="3045">3045</th><td>			<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>);</td></tr>
<tr><th id="3046">3046</th><td>			<b>return</b> <a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>;</td></tr>
<tr><th id="3047">3047</th><td>		}</td></tr>
<tr><th id="3048">3048</th><td></td></tr>
<tr><th id="3049">3049</th><td>		<b>if</b> (<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a>)</td></tr>
<tr><th id="3050">3050</th><td>			<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a> = <a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a>(&amp;<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>, <var>0</var>,</td></tr>
<tr><th id="3051">3051</th><td>							    <a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>);</td></tr>
<tr><th id="3052">3052</th><td>		<b>if</b> (<a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>) {</td></tr>
<tr><th id="3053">3053</th><td>			<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a>(&amp;<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="3054">3054</th><td>			<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>);</td></tr>
<tr><th id="3055">3055</th><td>			<b>return</b> <a class="local col6 ref" href="#616ret" title='ret' data-ref="616ret" data-ref-filename="616ret">ret</a>;</td></tr>
<tr><th id="3056">3056</th><td>		}</td></tr>
<tr><th id="3057">3057</th><td></td></tr>
<tr><th id="3058">3058</th><td>		<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::clear_range" title='i915_address_space::clear_range' data-ref="i915_address_space::clear_range" data-ref-filename="i915_address_space..clear_range">clear_range</a>(&amp;<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>,</td></tr>
<tr><th id="3059">3059</th><td>					<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::start" title='i915_address_space::start' data-ref="i915_address_space::start" data-ref-filename="i915_address_space..start">start</a>,</td></tr>
<tr><th id="3060">3060</th><td>					<a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>,</td></tr>
<tr><th id="3061">3061</th><td>					<a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="3062">3062</th><td></td></tr>
<tr><th id="3063">3063</th><td>		<a class="local col0 ref" href="#610dev_priv" title='dev_priv' data-ref="610dev_priv" data-ref-filename="610dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a> = <a class="local col8 ref" href="#618ppgtt" title='ppgtt' data-ref="618ppgtt" data-ref-filename="618ppgtt">ppgtt</a>;</td></tr>
<tr><th id="3064">3064</th><td>		<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((dev_priv-&gt;gtt.base.bind_vma != ggtt_bind_vma))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3064, &quot;dev_priv-&gt;gtt.base.bind_vma != ggtt_bind_vma&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(dev_priv-&gt;gtt.base.bind_vma != ggtt_bind_vma);</td></tr>
<tr><th id="3065">3065</th><td>		dev_priv-&gt;gtt.base.bind_vma = aliasing_gtt_bind_vma;</td></tr>
<tr><th id="3066">3066</th><td>	}</td></tr>
<tr><th id="3067">3067</th><td></td></tr>
<tr><th id="3068">3068</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3069">3069</th><td>}</td></tr>
<tr><th id="3070">3070</th><td></td></tr>
<tr><th id="3071">3071</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_init_global_gtt" title='i915_gem_init_global_gtt' data-ref="i915_gem_init_global_gtt" data-ref-filename="i915_gem_init_global_gtt">i915_gem_init_global_gtt</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col9 decl" id="619dev" title='dev' data-type='struct drm_device *' data-ref="619dev" data-ref-filename="619dev">dev</dfn>)</td></tr>
<tr><th id="3072">3072</th><td>{</td></tr>
<tr><th id="3073">3073</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col0 decl" id="620dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="620dev_priv" data-ref-filename="620dev_priv">dev_priv</dfn> = <a class="local col9 ref" href="#619dev" title='dev' data-ref="619dev" data-ref-filename="619dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3074">3074</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col1 decl" id="621gtt_size" title='gtt_size' data-type='u64' data-ref="621gtt_size" data-ref-filename="621gtt_size">gtt_size</dfn>, <dfn class="local col2 decl" id="622mappable_size" title='mappable_size' data-type='u64' data-ref="622mappable_size" data-ref-filename="622mappable_size">mappable_size</dfn>;</td></tr>
<tr><th id="3075">3075</th><td></td></tr>
<tr><th id="3076">3076</th><td>	gtt_size = dev_priv-&gt;gtt.base.total;</td></tr>
<tr><th id="3077">3077</th><td>	mappable_size = dev_priv-&gt;gtt.mappable_end;</td></tr>
<tr><th id="3078">3078</th><td></td></tr>
<tr><th id="3079">3079</th><td>	<a class="tu ref fn" href="#i915_gem_setup_global_gtt" title='i915_gem_setup_global_gtt' data-use='c' data-ref="i915_gem_setup_global_gtt" data-ref-filename="i915_gem_setup_global_gtt">i915_gem_setup_global_gtt</a>(<a class="local col9 ref" href="#619dev" title='dev' data-ref="619dev" data-ref-filename="619dev">dev</a>, <var>0</var>, <a class="local col2 ref" href="#622mappable_size" title='mappable_size' data-ref="622mappable_size" data-ref-filename="622mappable_size">mappable_size</a>, <a class="local col1 ref" href="#621gtt_size" title='gtt_size' data-ref="621gtt_size" data-ref-filename="621gtt_size">gtt_size</a>);</td></tr>
<tr><th id="3080">3080</th><td>}</td></tr>
<tr><th id="3081">3081</th><td></td></tr>
<tr><th id="3082">3082</th><td><em>void</em> <dfn class="decl def fn" id="i915_global_gtt_cleanup" title='i915_global_gtt_cleanup' data-ref="i915_global_gtt_cleanup" data-ref-filename="i915_global_gtt_cleanup">i915_global_gtt_cleanup</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="623dev" title='dev' data-type='struct drm_device *' data-ref="623dev" data-ref-filename="623dev">dev</dfn>)</td></tr>
<tr><th id="3083">3083</th><td>{</td></tr>
<tr><th id="3084">3084</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col4 decl" id="624dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="624dev_priv" data-ref-filename="624dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#623dev" title='dev' data-ref="623dev" data-ref-filename="623dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3085">3085</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col5 decl" id="625vm" title='vm' data-type='struct i915_address_space *' data-ref="625vm" data-ref-filename="625vm">vm</dfn> = &amp;dev_priv-&gt;gtt.base;</td></tr>
<tr><th id="3086">3086</th><td></td></tr>
<tr><th id="3087">3087</th><td>	<b>if</b> (<a class="local col4 ref" href="#624dev_priv" title='dev_priv' data-ref="624dev_priv" data-ref-filename="624dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>) {</td></tr>
<tr><th id="3088">3088</th><td>		<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col6 decl" id="626ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="626ppgtt" data-ref-filename="626ppgtt">ppgtt</dfn> = <a class="local col4 ref" href="#624dev_priv" title='dev_priv' data-ref="624dev_priv" data-ref-filename="624dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>;</td></tr>
<tr><th id="3089">3089</th><td></td></tr>
<tr><th id="3090">3090</th><td>		<a class="local col6 ref" href="#626ppgtt" title='ppgtt' data-ref="626ppgtt" data-ref-filename="626ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a>(&amp;<a class="local col6 ref" href="#626ppgtt" title='ppgtt' data-ref="626ppgtt" data-ref-filename="626ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="3091">3091</th><td>		<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col6 ref" href="#626ppgtt" title='ppgtt' data-ref="626ppgtt" data-ref-filename="626ppgtt">ppgtt</a>);</td></tr>
<tr><th id="3092">3092</th><td>	}</td></tr>
<tr><th id="3093">3093</th><td></td></tr>
<tr><th id="3094">3094</th><td>	<b>if</b> (<a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_initialized" title='drm_mm_initialized' data-ref="drm_mm_initialized" data-ref-filename="drm_mm_initialized">drm_mm_initialized</a>(&amp;<a class="local col5 ref" href="#625vm" title='vm' data-ref="625vm" data-ref-filename="625vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>)) {</td></tr>
<tr><th id="3095">3095</th><td>		<b>if</b> (<a class="ref fn" href="i915_drv.h.html#intel_vgpu_active" title='intel_vgpu_active' data-ref="intel_vgpu_active" data-ref-filename="intel_vgpu_active">intel_vgpu_active</a>(<a class="local col3 ref" href="#623dev" title='dev' data-ref="623dev" data-ref-filename="623dev">dev</a>))</td></tr>
<tr><th id="3096">3096</th><td>			<a class="ref fn" href="i915_vgpu.h.html#intel_vgt_deballoon" title='intel_vgt_deballoon' data-ref="intel_vgt_deballoon" data-ref-filename="intel_vgt_deballoon">intel_vgt_deballoon</a>();</td></tr>
<tr><th id="3097">3097</th><td></td></tr>
<tr><th id="3098">3098</th><td>		<a class="ref fn" href="../../include/drm/drm_mm.h.html#drm_mm_takedown" title='drm_mm_takedown' data-ref="drm_mm_takedown" data-ref-filename="drm_mm_takedown">drm_mm_takedown</a>(&amp;<a class="local col5 ref" href="#625vm" title='vm' data-ref="625vm" data-ref-filename="625vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::mm" title='i915_address_space::mm' data-ref="i915_address_space::mm" data-ref-filename="i915_address_space..mm">mm</a>);</td></tr>
<tr><th id="3099">3099</th><td>		<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_del" title='list_del' data-ref="list_del" data-ref-filename="list_del">list_del</a>(&amp;<a class="local col5 ref" href="#625vm" title='vm' data-ref="625vm" data-ref-filename="625vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::global_link" title='i915_address_space::global_link' data-ref="i915_address_space::global_link" data-ref-filename="i915_address_space..global_link">global_link</a>);</td></tr>
<tr><th id="3100">3100</th><td>	}</td></tr>
<tr><th id="3101">3101</th><td></td></tr>
<tr><th id="3102">3102</th><td>	<a class="local col5 ref" href="#625vm" title='vm' data-ref="625vm" data-ref-filename="625vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a>(<a class="local col5 ref" href="#625vm" title='vm' data-ref="625vm" data-ref-filename="625vm">vm</a>);</td></tr>
<tr><th id="3103">3103</th><td>}</td></tr>
<tr><th id="3104">3104</th><td></td></tr>
<tr><th id="3105">3105</th><td><em>static</em> <em>unsigned</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_get_total_gtt_size" title='gen6_get_total_gtt_size' data-type='unsigned int gen6_get_total_gtt_size(u16 snb_gmch_ctl)' data-ref="gen6_get_total_gtt_size" data-ref-filename="gen6_get_total_gtt_size">gen6_get_total_gtt_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col7 decl" id="627snb_gmch_ctl" title='snb_gmch_ctl' data-type='u16' data-ref="627snb_gmch_ctl" data-ref-filename="627snb_gmch_ctl">snb_gmch_ctl</dfn>)</td></tr>
<tr><th id="3106">3106</th><td>{</td></tr>
<tr><th id="3107">3107</th><td>	<a class="local col7 ref" href="#627snb_gmch_ctl" title='snb_gmch_ctl' data-ref="627snb_gmch_ctl" data-ref-filename="627snb_gmch_ctl">snb_gmch_ctl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#50" title="8" data-ref="_M/SNB_GMCH_GGMS_SHIFT">SNB_GMCH_GGMS_SHIFT</a>;</td></tr>
<tr><th id="3108">3108</th><td>	<a class="local col7 ref" href="#627snb_gmch_ctl" title='snb_gmch_ctl' data-ref="627snb_gmch_ctl" data-ref-filename="627snb_gmch_ctl">snb_gmch_ctl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#51" title="0x3" data-ref="_M/SNB_GMCH_GGMS_MASK">SNB_GMCH_GGMS_MASK</a>;</td></tr>
<tr><th id="3109">3109</th><td>	<b>return</b> <a class="local col7 ref" href="#627snb_gmch_ctl" title='snb_gmch_ctl' data-ref="627snb_gmch_ctl" data-ref-filename="627snb_gmch_ctl">snb_gmch_ctl</a> &lt;&lt; <var>20</var>;</td></tr>
<tr><th id="3110">3110</th><td>}</td></tr>
<tr><th id="3111">3111</th><td></td></tr>
<tr><th id="3112">3112</th><td><em>static</em> <em>unsigned</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_get_total_gtt_size" title='gen8_get_total_gtt_size' data-type='unsigned int gen8_get_total_gtt_size(u16 bdw_gmch_ctl)' data-ref="gen8_get_total_gtt_size" data-ref-filename="gen8_get_total_gtt_size">gen8_get_total_gtt_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col8 decl" id="628bdw_gmch_ctl" title='bdw_gmch_ctl' data-type='u16' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</dfn>)</td></tr>
<tr><th id="3113">3113</th><td>{</td></tr>
<tr><th id="3114">3114</th><td>	<a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#54" title="6" data-ref="_M/BDW_GMCH_GGMS_SHIFT">BDW_GMCH_GGMS_SHIFT</a>;</td></tr>
<tr><th id="3115">3115</th><td>	<a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#55" title="0x3" data-ref="_M/BDW_GMCH_GGMS_MASK">BDW_GMCH_GGMS_MASK</a>;</td></tr>
<tr><th id="3116">3116</th><td>	<b>if</b> (<a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a>)</td></tr>
<tr><th id="3117">3117</th><td>		<a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a> = <var>1</var> &lt;&lt; <a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a>;</td></tr>
<tr><th id="3118">3118</th><td></td></tr>
<tr><th id="3119">3119</th><td><u>#<span data-ppcond="3119">ifdef</span> <span class="macro" data-ref="_M/CONFIG_X86_32">CONFIG_X86_32</span></u></td></tr>
<tr><th id="3120">3120</th><td>	<i>/* Limit 32b platforms to a 2GB GGTT: 4 &lt;&lt; 20 / pte size * PAGE_SIZE */</i></td></tr>
<tr><th id="3121">3121</th><td>	<b>if</b> (bdw_gmch_ctl &gt; <var>4</var>)</td></tr>
<tr><th id="3122">3122</th><td>		bdw_gmch_ctl = <var>4</var>;</td></tr>
<tr><th id="3123">3123</th><td><u>#<span data-ppcond="3119">endif</span></u></td></tr>
<tr><th id="3124">3124</th><td></td></tr>
<tr><th id="3125">3125</th><td>	<b>return</b> <a class="local col8 ref" href="#628bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="628bdw_gmch_ctl" data-ref-filename="628bdw_gmch_ctl">bdw_gmch_ctl</a> &lt;&lt; <var>20</var>;</td></tr>
<tr><th id="3126">3126</th><td>}</td></tr>
<tr><th id="3127">3127</th><td></td></tr>
<tr><th id="3128">3128</th><td><em>static</em> <em>unsigned</em> <em>int</em> <dfn class="tu decl def fn" id="chv_get_total_gtt_size" title='chv_get_total_gtt_size' data-type='unsigned int chv_get_total_gtt_size(u16 gmch_ctrl)' data-ref="chv_get_total_gtt_size" data-ref-filename="chv_get_total_gtt_size">chv_get_total_gtt_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col9 decl" id="629gmch_ctrl" title='gmch_ctrl' data-type='u16' data-ref="629gmch_ctrl" data-ref-filename="629gmch_ctrl">gmch_ctrl</dfn>)</td></tr>
<tr><th id="3129">3129</th><td>{</td></tr>
<tr><th id="3130">3130</th><td>	<a class="local col9 ref" href="#629gmch_ctrl" title='gmch_ctrl' data-ref="629gmch_ctrl" data-ref-filename="629gmch_ctrl">gmch_ctrl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#50" title="8" data-ref="_M/SNB_GMCH_GGMS_SHIFT">SNB_GMCH_GGMS_SHIFT</a>;</td></tr>
<tr><th id="3131">3131</th><td>	<a class="local col9 ref" href="#629gmch_ctrl" title='gmch_ctrl' data-ref="629gmch_ctrl" data-ref-filename="629gmch_ctrl">gmch_ctrl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#51" title="0x3" data-ref="_M/SNB_GMCH_GGMS_MASK">SNB_GMCH_GGMS_MASK</a>;</td></tr>
<tr><th id="3132">3132</th><td></td></tr>
<tr><th id="3133">3133</th><td>	<b>if</b> (<a class="local col9 ref" href="#629gmch_ctrl" title='gmch_ctrl' data-ref="629gmch_ctrl" data-ref-filename="629gmch_ctrl">gmch_ctrl</a>)</td></tr>
<tr><th id="3134">3134</th><td>		<b>return</b> <var>1</var> &lt;&lt; (<var>20</var> + <a class="local col9 ref" href="#629gmch_ctrl" title='gmch_ctrl' data-ref="629gmch_ctrl" data-ref-filename="629gmch_ctrl">gmch_ctrl</a>);</td></tr>
<tr><th id="3135">3135</th><td></td></tr>
<tr><th id="3136">3136</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3137">3137</th><td>}</td></tr>
<tr><th id="3138">3138</th><td></td></tr>
<tr><th id="3139">3139</th><td><em>static</em> <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="tu decl def fn" id="gen6_get_stolen_size" title='gen6_get_stolen_size' data-type='size_t gen6_get_stolen_size(u16 snb_gmch_ctl)' data-ref="gen6_get_stolen_size" data-ref-filename="gen6_get_stolen_size">gen6_get_stolen_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col0 decl" id="630snb_gmch_ctl" title='snb_gmch_ctl' data-type='u16' data-ref="630snb_gmch_ctl" data-ref-filename="630snb_gmch_ctl">snb_gmch_ctl</dfn>)</td></tr>
<tr><th id="3140">3140</th><td>{</td></tr>
<tr><th id="3141">3141</th><td>	<a class="local col0 ref" href="#630snb_gmch_ctl" title='snb_gmch_ctl' data-ref="630snb_gmch_ctl" data-ref-filename="630snb_gmch_ctl">snb_gmch_ctl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#52" title="3" data-ref="_M/SNB_GMCH_GMS_SHIFT">SNB_GMCH_GMS_SHIFT</a>;</td></tr>
<tr><th id="3142">3142</th><td>	<a class="local col0 ref" href="#630snb_gmch_ctl" title='snb_gmch_ctl' data-ref="630snb_gmch_ctl" data-ref-filename="630snb_gmch_ctl">snb_gmch_ctl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#53" title="0x1f" data-ref="_M/SNB_GMCH_GMS_MASK">SNB_GMCH_GMS_MASK</a>;</td></tr>
<tr><th id="3143">3143</th><td>	<b>return</b> <a class="local col0 ref" href="#630snb_gmch_ctl" title='snb_gmch_ctl' data-ref="630snb_gmch_ctl" data-ref-filename="630snb_gmch_ctl">snb_gmch_ctl</a> &lt;&lt; <var>25</var>; <i>/* 32 MB units */</i></td></tr>
<tr><th id="3144">3144</th><td>}</td></tr>
<tr><th id="3145">3145</th><td></td></tr>
<tr><th id="3146">3146</th><td><em>static</em> <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="tu decl def fn" id="gen8_get_stolen_size" title='gen8_get_stolen_size' data-type='size_t gen8_get_stolen_size(u16 bdw_gmch_ctl)' data-ref="gen8_get_stolen_size" data-ref-filename="gen8_get_stolen_size">gen8_get_stolen_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col1 decl" id="631bdw_gmch_ctl" title='bdw_gmch_ctl' data-type='u16' data-ref="631bdw_gmch_ctl" data-ref-filename="631bdw_gmch_ctl">bdw_gmch_ctl</dfn>)</td></tr>
<tr><th id="3147">3147</th><td>{</td></tr>
<tr><th id="3148">3148</th><td>	<a class="local col1 ref" href="#631bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="631bdw_gmch_ctl" data-ref-filename="631bdw_gmch_ctl">bdw_gmch_ctl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#56" title="8" data-ref="_M/BDW_GMCH_GMS_SHIFT">BDW_GMCH_GMS_SHIFT</a>;</td></tr>
<tr><th id="3149">3149</th><td>	<a class="local col1 ref" href="#631bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="631bdw_gmch_ctl" data-ref-filename="631bdw_gmch_ctl">bdw_gmch_ctl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#57" title="0xff" data-ref="_M/BDW_GMCH_GMS_MASK">BDW_GMCH_GMS_MASK</a>;</td></tr>
<tr><th id="3150">3150</th><td>	<b>return</b> <a class="local col1 ref" href="#631bdw_gmch_ctl" title='bdw_gmch_ctl' data-ref="631bdw_gmch_ctl" data-ref-filename="631bdw_gmch_ctl">bdw_gmch_ctl</a> &lt;&lt; <var>25</var>; <i>/* 32 MB units */</i></td></tr>
<tr><th id="3151">3151</th><td>}</td></tr>
<tr><th id="3152">3152</th><td></td></tr>
<tr><th id="3153">3153</th><td><em>static</em> <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="tu decl def fn" id="chv_get_stolen_size" title='chv_get_stolen_size' data-type='size_t chv_get_stolen_size(u16 gmch_ctrl)' data-ref="chv_get_stolen_size" data-ref-filename="chv_get_stolen_size">chv_get_stolen_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col2 decl" id="632gmch_ctrl" title='gmch_ctrl' data-type='u16' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</dfn>)</td></tr>
<tr><th id="3154">3154</th><td>{</td></tr>
<tr><th id="3155">3155</th><td>	<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#52" title="3" data-ref="_M/SNB_GMCH_GMS_SHIFT">SNB_GMCH_GMS_SHIFT</a>;</td></tr>
<tr><th id="3156">3156</th><td>	<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#53" title="0x1f" data-ref="_M/SNB_GMCH_GMS_MASK">SNB_GMCH_GMS_MASK</a>;</td></tr>
<tr><th id="3157">3157</th><td></td></tr>
<tr><th id="3158">3158</th><td>	<i>/*</i></td></tr>
<tr><th id="3159">3159</th><td><i>	 * 0x0  to 0x10: 32MB increments starting at 0MB</i></td></tr>
<tr><th id="3160">3160</th><td><i>	 * 0x11 to 0x16: 4MB increments starting at 8MB</i></td></tr>
<tr><th id="3161">3161</th><td><i>	 * 0x17 to 0x1d: 4MB increments start at 36MB</i></td></tr>
<tr><th id="3162">3162</th><td><i>	 */</i></td></tr>
<tr><th id="3163">3163</th><td>	<b>if</b> (<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> &lt; <var>0x11</var>)</td></tr>
<tr><th id="3164">3164</th><td>		<b>return</b> <a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> &lt;&lt; <var>25</var>;</td></tr>
<tr><th id="3165">3165</th><td>	<b>else</b> <b>if</b> (<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> &lt; <var>0x17</var>)</td></tr>
<tr><th id="3166">3166</th><td>		<b>return</b> (<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> - <var>0x11</var> + <var>2</var>) &lt;&lt; <var>22</var>;</td></tr>
<tr><th id="3167">3167</th><td>	<b>else</b></td></tr>
<tr><th id="3168">3168</th><td>		<b>return</b> (<a class="local col2 ref" href="#632gmch_ctrl" title='gmch_ctrl' data-ref="632gmch_ctrl" data-ref-filename="632gmch_ctrl">gmch_ctrl</a> - <var>0x17</var> + <var>9</var>) &lt;&lt; <var>22</var>;</td></tr>
<tr><th id="3169">3169</th><td>}</td></tr>
<tr><th id="3170">3170</th><td></td></tr>
<tr><th id="3171">3171</th><td><em>static</em> <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="tu decl def fn" id="gen9_get_stolen_size" title='gen9_get_stolen_size' data-type='size_t gen9_get_stolen_size(u16 gen9_gmch_ctl)' data-ref="gen9_get_stolen_size" data-ref-filename="gen9_get_stolen_size">gen9_get_stolen_size</dfn>(<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col3 decl" id="633gen9_gmch_ctl" title='gen9_gmch_ctl' data-type='u16' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</dfn>)</td></tr>
<tr><th id="3172">3172</th><td>{</td></tr>
<tr><th id="3173">3173</th><td>	<a class="local col3 ref" href="#633gen9_gmch_ctl" title='gen9_gmch_ctl' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</a> &gt;&gt;= <a class="macro" href="../../include/drm/i915_drm.h.html#56" title="8" data-ref="_M/BDW_GMCH_GMS_SHIFT">BDW_GMCH_GMS_SHIFT</a>;</td></tr>
<tr><th id="3174">3174</th><td>	<a class="local col3 ref" href="#633gen9_gmch_ctl" title='gen9_gmch_ctl' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</a> &amp;= <a class="macro" href="../../include/drm/i915_drm.h.html#57" title="0xff" data-ref="_M/BDW_GMCH_GMS_MASK">BDW_GMCH_GMS_MASK</a>;</td></tr>
<tr><th id="3175">3175</th><td></td></tr>
<tr><th id="3176">3176</th><td>	<b>if</b> (<a class="local col3 ref" href="#633gen9_gmch_ctl" title='gen9_gmch_ctl' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</a> &lt; <var>0xf0</var>)</td></tr>
<tr><th id="3177">3177</th><td>		<b>return</b> <a class="local col3 ref" href="#633gen9_gmch_ctl" title='gen9_gmch_ctl' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</a> &lt;&lt; <var>25</var>; <i>/* 32 MB units */</i></td></tr>
<tr><th id="3178">3178</th><td>	<b>else</b></td></tr>
<tr><th id="3179">3179</th><td>		<i>/* 4MB increments starting at 0xf0 for 4MB */</i></td></tr>
<tr><th id="3180">3180</th><td>		<b>return</b> (<a class="local col3 ref" href="#633gen9_gmch_ctl" title='gen9_gmch_ctl' data-ref="633gen9_gmch_ctl" data-ref-filename="633gen9_gmch_ctl">gen9_gmch_ctl</a> - <var>0xf0</var> + <var>1</var>) &lt;&lt; <var>22</var>;</td></tr>
<tr><th id="3181">3181</th><td>}</td></tr>
<tr><th id="3182">3182</th><td></td></tr>
<tr><th id="3183">3183</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="ggtt_probe_common" title='ggtt_probe_common' data-type='int ggtt_probe_common(struct drm_device * dev, size_t gtt_size)' data-ref="ggtt_probe_common" data-ref-filename="ggtt_probe_common">ggtt_probe_common</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col4 decl" id="634dev" title='dev' data-type='struct drm_device *' data-ref="634dev" data-ref-filename="634dev">dev</dfn>,</td></tr>
<tr><th id="3184">3184</th><td>			     <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col5 decl" id="635gtt_size" title='gtt_size' data-type='size_t' data-ref="635gtt_size" data-ref-filename="635gtt_size">gtt_size</dfn>)</td></tr>
<tr><th id="3185">3185</th><td>{</td></tr>
<tr><th id="3186">3186</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="636dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="636dev_priv" data-ref-filename="636dev_priv">dev_priv</dfn> = <a class="local col4 ref" href="#634dev" title='dev' data-ref="634dev" data-ref-filename="634dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3187">3187</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_page_scratch" title='i915_page_scratch' data-ref="i915_page_scratch" data-ref-filename="i915_page_scratch">i915_page_scratch</a> *<dfn class="local col7 decl" id="637scratch_page" title='scratch_page' data-type='struct i915_page_scratch *' data-ref="637scratch_page" data-ref-filename="637scratch_page">scratch_page</dfn>;</td></tr>
<tr><th id="3188">3188</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#phys_addr_t" title='phys_addr_t' data-type='paddr_t' data-ref="phys_addr_t" data-ref-filename="phys_addr_t">phys_addr_t</a> <dfn class="local col8 decl" id="638gtt_phys_addr" title='gtt_phys_addr' data-type='phys_addr_t' data-ref="638gtt_phys_addr" data-ref-filename="638gtt_phys_addr">gtt_phys_addr</dfn>;</td></tr>
<tr><th id="3189">3189</th><td></td></tr>
<tr><th id="3190">3190</th><td>	<i>/* For Modern GENs the PTEs and register space are split in the BAR */</i></td></tr>
<tr><th id="3191">3191</th><td>	<a class="local col8 ref" href="#638gtt_phys_addr" title='gtt_phys_addr' data-ref="638gtt_phys_addr" data-ref-filename="638gtt_phys_addr">gtt_phys_addr</a> = <a class="macro" href="../../../include/linux/pci.h.html#212" title="linux_pci_resource_start" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col4 ref" href="#634dev" title='dev' data-ref="634dev" data-ref-filename="634dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>0</var>) +</td></tr>
<tr><th id="3192">3192</th><td>		(<a class="macro" href="../../../include/linux/pci.h.html#211" title="linux_pci_resource_len" data-ref="_M/pci_resource_len">pci_resource_len</a>(<a class="local col4 ref" href="#634dev" title='dev' data-ref="634dev" data-ref-filename="634dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>0</var>) / <var>2</var>);</td></tr>
<tr><th id="3193">3193</th><td></td></tr>
<tr><th id="3194">3194</th><td><u>#<span data-ppcond="3194">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3195">3195</th><td>	<em>int</em> ret;</td></tr>
<tr><th id="3196">3196</th><td>	dev_priv-&gt;gtt.bst = dev-&gt;pdev-&gt;pd_pa.pa_memt;</td></tr>
<tr><th id="3197">3197</th><td>	<i>/* XXX errno NetBSD-&gt;Linux */</i></td></tr>
<tr><th id="3198">3198</th><td>	ret = -bus_space_map(dev_priv-&gt;gtt.bst, gtt_phys_addr, gtt_size,</td></tr>
<tr><th id="3199">3199</th><td>	    IS_BROXTON(dev) ? <var>0</var> : BUS_SPACE_MAP_PREFETCHABLE,</td></tr>
<tr><th id="3200">3200</th><td>	    &amp;dev_priv-&gt;gtt.bsh);</td></tr>
<tr><th id="3201">3201</th><td>	<b>if</b> (ret) {</td></tr>
<tr><th id="3202">3202</th><td>		DRM_ERROR(<q>"Failed to map the graphics translation table: %d\n"</q>,</td></tr>
<tr><th id="3203">3203</th><td>		    ret);</td></tr>
<tr><th id="3204">3204</th><td>		<b>return</b> ret;</td></tr>
<tr><th id="3205">3205</th><td>	}</td></tr>
<tr><th id="3206">3206</th><td>	dev_priv-&gt;gtt.size = gtt_size;</td></tr>
<tr><th id="3207">3207</th><td><u>#<span data-ppcond="3194">else</span></u></td></tr>
<tr><th id="3208">3208</th><td>	<i>/*</i></td></tr>
<tr><th id="3209">3209</th><td><i>	 * On BXT writes larger than 64 bit to the GTT pagetable range will be</i></td></tr>
<tr><th id="3210">3210</th><td><i>	 * dropped. For WC mappings in general we have 64 byte burst writes</i></td></tr>
<tr><th id="3211">3211</th><td><i>	 * when the WC buffer is flushed, so we can't use it, but have to</i></td></tr>
<tr><th id="3212">3212</th><td><i>	 * resort to an uncached mapping. The WC issue is easily caught by the</i></td></tr>
<tr><th id="3213">3213</th><td><i>	 * readback check when writing GTT PTE entries.</i></td></tr>
<tr><th id="3214">3214</th><td><i>	 */</i></td></tr>
<tr><th id="3215">3215</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2563" title="(!((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_skylake) &amp;&amp; !((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_kabylake) &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 9))" data-ref="_M/IS_BROXTON">IS_BROXTON</a>(dev))</td></tr>
<tr><th id="3216">3216</th><td>		dev_priv-&gt;gtt.gsm = ioremap_nocache(gtt_phys_addr, gtt_size);</td></tr>
<tr><th id="3217">3217</th><td>	<b>else</b></td></tr>
<tr><th id="3218">3218</th><td>		dev_priv-&gt;gtt.gsm = ioremap_wc(gtt_phys_addr, gtt_size);</td></tr>
<tr><th id="3219">3219</th><td>	<b>if</b> (!dev_priv-&gt;gtt.gsm) {</td></tr>
<tr><th id="3220">3220</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3220, __func__, &quot;Failed to map the gtt page table\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to map the gtt page table\n"</q>);</td></tr>
<tr><th id="3221">3221</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3222">3222</th><td>	}</td></tr>
<tr><th id="3223">3223</th><td><u>#<span data-ppcond="3194">endif</span></u></td></tr>
<tr><th id="3224">3224</th><td></td></tr>
<tr><th id="3225">3225</th><td>	<a class="local col7 ref" href="#637scratch_page" title='scratch_page' data-ref="637scratch_page" data-ref-filename="637scratch_page">scratch_page</a> = <a class="tu ref fn" href="#alloc_scratch_page" title='alloc_scratch_page' data-use='c' data-ref="alloc_scratch_page" data-ref-filename="alloc_scratch_page">alloc_scratch_page</a>(<a class="local col4 ref" href="#634dev" title='dev' data-ref="634dev" data-ref-filename="634dev">dev</a>);</td></tr>
<tr><th id="3226">3226</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col7 ref" href="#637scratch_page" title='scratch_page' data-ref="637scratch_page" data-ref-filename="637scratch_page">scratch_page</a>)) {</td></tr>
<tr><th id="3227">3227</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3227, __func__, &quot;Scratch setup failed\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Scratch setup failed\n"</q>);</td></tr>
<tr><th id="3228">3228</th><td>		<i>/* iounmap will also get called at remove, but meh */</i></td></tr>
<tr><th id="3229">3229</th><td><u>#<span data-ppcond="3229">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3230">3230</th><td>		bus_space_unmap(dev_priv-&gt;gtt.bst, dev_priv-&gt;gtt.bsh,</td></tr>
<tr><th id="3231">3231</th><td>		    dev_priv-&gt;gtt.size);</td></tr>
<tr><th id="3232">3232</th><td><u>#<span data-ppcond="3229">else</span></u></td></tr>
<tr><th id="3233">3233</th><td>		iounmap(dev_priv-&gt;gtt.gsm);</td></tr>
<tr><th id="3234">3234</th><td><u>#<span data-ppcond="3229">endif</span></u></td></tr>
<tr><th id="3235">3235</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col7 ref" href="#637scratch_page" title='scratch_page' data-ref="637scratch_page" data-ref-filename="637scratch_page">scratch_page</a>);</td></tr>
<tr><th id="3236">3236</th><td>	}</td></tr>
<tr><th id="3237">3237</th><td></td></tr>
<tr><th id="3238">3238</th><td>	dev_priv-&gt;gtt.base.scratch_page = scratch_page;</td></tr>
<tr><th id="3239">3239</th><td></td></tr>
<tr><th id="3240">3240</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3241">3241</th><td>}</td></tr>
<tr><th id="3242">3242</th><td></td></tr>
<tr><th id="3243">3243</th><td><i  data-doc="bdw_setup_private_ppat">/* The GGTT and PPGTT need a private PPAT setup in order to handle cacheability</i></td></tr>
<tr><th id="3244">3244</th><td><i  data-doc="bdw_setup_private_ppat"> * bits. When using advanced contexts each context stores its own PAT, but</i></td></tr>
<tr><th id="3245">3245</th><td><i  data-doc="bdw_setup_private_ppat"> * writing this data shouldn't be harmful even in those cases. */</i></td></tr>
<tr><th id="3246">3246</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="bdw_setup_private_ppat" title='bdw_setup_private_ppat' data-type='void bdw_setup_private_ppat(struct drm_i915_private * dev_priv)' data-ref="bdw_setup_private_ppat" data-ref-filename="bdw_setup_private_ppat">bdw_setup_private_ppat</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col9 decl" id="639dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="639dev_priv" data-ref-filename="639dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="3247">3247</th><td>{</td></tr>
<tr><th id="3248">3248</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col0 decl" id="640pat" title='pat' data-type='uint64_t' data-ref="640pat" data-ref-filename="640pat">pat</dfn>;</td></tr>
<tr><th id="3249">3249</th><td></td></tr>
<tr><th id="3250">3250</th><td>	<a class="local col0 ref" href="#640pat" title='pat' data-ref="640pat" data-ref-filename="640pat">pat</a> = <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((3&lt;&lt;0) | (1&lt;&lt;2)) &lt;&lt; ((0) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>0</var>, <a class="macro" href="i915_gem_gtt.h.html#127" title="(3&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WB">GEN8_PPAT_WB</a> | <a class="macro" href="i915_gem_gtt.h.html#126" title="(1&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLC">GEN8_PPAT_LLC</a>)     | <i>/* for normal objects, no eLLC */</i></td></tr>
<tr><th id="3251">3251</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;0) | (2&lt;&lt;2)) &lt;&lt; ((1) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>1</var>, <a class="macro" href="i915_gem_gtt.h.html#129" title="(1&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WC">GEN8_PPAT_WC</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a>) | <i>/* for something pointing to ptes? */</i></td></tr>
<tr><th id="3252">3252</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((2&lt;&lt;0) | (2&lt;&lt;2)) &lt;&lt; ((2) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>2</var>, <a class="macro" href="i915_gem_gtt.h.html#128" title="(2&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WT">GEN8_PPAT_WT</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a>) | <i>/* for scanout with eLLC */</i></td></tr>
<tr><th id="3253">3253</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((0&lt;&lt;0)) &lt;&lt; ((3) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>3</var>, <a class="macro" href="i915_gem_gtt.h.html#130" title="(0&lt;&lt;0)" data-ref="_M/GEN8_PPAT_UC">GEN8_PPAT_UC</a>)                     | <i>/* Uncached objects, mostly for scanout */</i></td></tr>
<tr><th id="3254">3254</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((3&lt;&lt;0) | (2&lt;&lt;2) | (0&lt;&lt;4)) &lt;&lt; ((4) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>4</var>, <a class="macro" href="i915_gem_gtt.h.html#127" title="(3&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WB">GEN8_PPAT_WB</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a> | <a class="macro" href="i915_gem_gtt.h.html#123" title="(0&lt;&lt;4)" data-ref="_M/GEN8_PPAT_AGE">GEN8_PPAT_AGE</a>(<var>0</var>)) |</td></tr>
<tr><th id="3255">3255</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((3&lt;&lt;0) | (2&lt;&lt;2) | (1&lt;&lt;4)) &lt;&lt; ((5) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>5</var>, <a class="macro" href="i915_gem_gtt.h.html#127" title="(3&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WB">GEN8_PPAT_WB</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a> | <a class="macro" href="i915_gem_gtt.h.html#123" title="(1&lt;&lt;4)" data-ref="_M/GEN8_PPAT_AGE">GEN8_PPAT_AGE</a>(<var>1</var>)) |</td></tr>
<tr><th id="3256">3256</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((3&lt;&lt;0) | (2&lt;&lt;2) | (2&lt;&lt;4)) &lt;&lt; ((6) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>6</var>, <a class="macro" href="i915_gem_gtt.h.html#127" title="(3&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WB">GEN8_PPAT_WB</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a> | <a class="macro" href="i915_gem_gtt.h.html#123" title="(2&lt;&lt;4)" data-ref="_M/GEN8_PPAT_AGE">GEN8_PPAT_AGE</a>(<var>2</var>)) |</td></tr>
<tr><th id="3257">3257</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((3&lt;&lt;0) | (2&lt;&lt;2) | (3&lt;&lt;4)) &lt;&lt; ((7) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>7</var>, <a class="macro" href="i915_gem_gtt.h.html#127" title="(3&lt;&lt;0)" data-ref="_M/GEN8_PPAT_WB">GEN8_PPAT_WB</a> | <a class="macro" href="i915_gem_gtt.h.html#125" title="(2&lt;&lt;2)" data-ref="_M/GEN8_PPAT_LLCELLC">GEN8_PPAT_LLCELLC</a> | <a class="macro" href="i915_gem_gtt.h.html#123" title="(3&lt;&lt;4)" data-ref="_M/GEN8_PPAT_AGE">GEN8_PPAT_AGE</a>(<var>3</var>));</td></tr>
<tr><th id="3258">3258</th><td></td></tr>
<tr><th id="3259">3259</th><td>	<b>if</b> (!<a class="macro" href="i915_drv.h.html#2662" title="(i915.enable_ppgtt)" data-ref="_M/USES_PPGTT">USES_PPGTT</a>(dev_priv-&gt;dev))</td></tr>
<tr><th id="3260">3260</th><td>		<i>/* Spec: "For GGTT, there is NO pat_sel[2:0] from the entry,</i></td></tr>
<tr><th id="3261">3261</th><td><i>		 * so RTL will always use the value corresponding to</i></td></tr>
<tr><th id="3262">3262</th><td><i>		 * pat_sel = 000".</i></td></tr>
<tr><th id="3263">3263</th><td><i>		 * So let's disable cache for GGTT to avoid screen corruptions.</i></td></tr>
<tr><th id="3264">3264</th><td><i>		 * MOCS still can be used though.</i></td></tr>
<tr><th id="3265">3265</th><td><i>		 * - System agent ggtt writes (i.e. cpu gtt mmaps) already work</i></td></tr>
<tr><th id="3266">3266</th><td><i>		 * before this patch, i.e. the same uncached + snooping access</i></td></tr>
<tr><th id="3267">3267</th><td><i>		 * like on gen6/7 seems to be in effect.</i></td></tr>
<tr><th id="3268">3268</th><td><i>		 * - So this just fixes blitter/render access. Again it looks</i></td></tr>
<tr><th id="3269">3269</th><td><i>		 * like it's not just uncached access, but uncached + snooping.</i></td></tr>
<tr><th id="3270">3270</th><td><i>		 * So we can still hold onto all our assumptions wrt cpu</i></td></tr>
<tr><th id="3271">3271</th><td><i>		 * clflushing on LLC machines.</i></td></tr>
<tr><th id="3272">3272</th><td><i>		 */</i></td></tr>
<tr><th id="3273">3273</th><td>		<a class="local col0 ref" href="#640pat" title='pat' data-ref="640pat" data-ref-filename="640pat">pat</a> = <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((0&lt;&lt;0)) &lt;&lt; ((0) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>0</var>, <a class="macro" href="i915_gem_gtt.h.html#130" title="(0&lt;&lt;0)" data-ref="_M/GEN8_PPAT_UC">GEN8_PPAT_UC</a>);</td></tr>
<tr><th id="3274">3274</th><td></td></tr>
<tr><th id="3275">3275</th><td>	<i>/* XXX: spec defines this as 2 distinct registers. It's unclear if a 64b</i></td></tr>
<tr><th id="3276">3276</th><td><i>	 * write would work. */</i></td></tr>
<tr><th id="3277">3277</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x40e0), (pat), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1564" title="0x40e0" data-ref="_M/GEN8_PRIVATE_PAT_LO">GEN8_PRIVATE_PAT_LO</a>, <a class="local col0 ref" href="#640pat" title='pat' data-ref="640pat" data-ref-filename="640pat">pat</a>);</td></tr>
<tr><th id="3278">3278</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, ((0x40e0 + 4)), (pat &gt;&gt; 32), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1565" title="(0x40e0 + 4)" data-ref="_M/GEN8_PRIVATE_PAT_HI">GEN8_PRIVATE_PAT_HI</a>, <a class="local col0 ref" href="#640pat" title='pat' data-ref="640pat" data-ref-filename="640pat">pat</a> &gt;&gt; <var>32</var>);</td></tr>
<tr><th id="3279">3279</th><td>}</td></tr>
<tr><th id="3280">3280</th><td></td></tr>
<tr><th id="3281">3281</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="chv_setup_private_ppat" title='chv_setup_private_ppat' data-type='void chv_setup_private_ppat(struct drm_i915_private * dev_priv)' data-ref="chv_setup_private_ppat" data-ref-filename="chv_setup_private_ppat">chv_setup_private_ppat</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col1 decl" id="641dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="641dev_priv" data-ref-filename="641dev_priv">dev_priv</dfn>)</td></tr>
<tr><th id="3282">3282</th><td>{</td></tr>
<tr><th id="3283">3283</th><td>	<a class="typedef" href="../../../../../../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> <dfn class="local col2 decl" id="642pat" title='pat' data-type='uint64_t' data-ref="642pat" data-ref-filename="642pat">pat</dfn>;</td></tr>
<tr><th id="3284">3284</th><td></td></tr>
<tr><th id="3285">3285</th><td>	<i>/*</i></td></tr>
<tr><th id="3286">3286</th><td><i>	 * Map WB on BDW to snooped on CHV.</i></td></tr>
<tr><th id="3287">3287</th><td><i>	 *</i></td></tr>
<tr><th id="3288">3288</th><td><i>	 * Only the snoop bit has meaning for CHV, the rest is</i></td></tr>
<tr><th id="3289">3289</th><td><i>	 * ignored.</i></td></tr>
<tr><th id="3290">3290</th><td><i>	 *</i></td></tr>
<tr><th id="3291">3291</th><td><i>	 * The hardware will never snoop for certain types of accesses:</i></td></tr>
<tr><th id="3292">3292</th><td><i>	 * - CPU GTT (GMADR-&gt;GGTT-&gt;no snoop-&gt;memory)</i></td></tr>
<tr><th id="3293">3293</th><td><i>	 * - PPGTT page tables</i></td></tr>
<tr><th id="3294">3294</th><td><i>	 * - some other special cycles</i></td></tr>
<tr><th id="3295">3295</th><td><i>	 *</i></td></tr>
<tr><th id="3296">3296</th><td><i>	 * As with BDW, we also need to consider the following for GT accesses:</i></td></tr>
<tr><th id="3297">3297</th><td><i>	 * "For GGTT, there is NO pat_sel[2:0] from the entry,</i></td></tr>
<tr><th id="3298">3298</th><td><i>	 * so RTL will always use the value corresponding to</i></td></tr>
<tr><th id="3299">3299</th><td><i>	 * pat_sel = 000".</i></td></tr>
<tr><th id="3300">3300</th><td><i>	 * Which means we must set the snoop bit in PAT entry 0</i></td></tr>
<tr><th id="3301">3301</th><td><i>	 * in order to keep the global status page working.</i></td></tr>
<tr><th id="3302">3302</th><td><i>	 */</i></td></tr>
<tr><th id="3303">3303</th><td>	<a class="local col2 ref" href="#642pat" title='pat' data-ref="642pat" data-ref-filename="642pat">pat</a> = <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;6)) &lt;&lt; ((0) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>0</var>, <a class="macro" href="i915_gem_gtt.h.html#122" title="(1&lt;&lt;6)" data-ref="_M/CHV_PPAT_SNOOP">CHV_PPAT_SNOOP</a>) |</td></tr>
<tr><th id="3304">3304</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) (0) &lt;&lt; ((1) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>1</var>, <var>0</var>) |</td></tr>
<tr><th id="3305">3305</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) (0) &lt;&lt; ((2) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>2</var>, <var>0</var>) |</td></tr>
<tr><th id="3306">3306</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) (0) &lt;&lt; ((3) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>3</var>, <var>0</var>) |</td></tr>
<tr><th id="3307">3307</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;6)) &lt;&lt; ((4) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>4</var>, <a class="macro" href="i915_gem_gtt.h.html#122" title="(1&lt;&lt;6)" data-ref="_M/CHV_PPAT_SNOOP">CHV_PPAT_SNOOP</a>) |</td></tr>
<tr><th id="3308">3308</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;6)) &lt;&lt; ((5) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>5</var>, <a class="macro" href="i915_gem_gtt.h.html#122" title="(1&lt;&lt;6)" data-ref="_M/CHV_PPAT_SNOOP">CHV_PPAT_SNOOP</a>) |</td></tr>
<tr><th id="3309">3309</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;6)) &lt;&lt; ((6) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>6</var>, <a class="macro" href="i915_gem_gtt.h.html#122" title="(1&lt;&lt;6)" data-ref="_M/CHV_PPAT_SNOOP">CHV_PPAT_SNOOP</a>) |</td></tr>
<tr><th id="3310">3310</th><td>	      <a class="macro" href="i915_gem_gtt.h.html#132" title="((uint64_t) ((1&lt;&lt;6)) &lt;&lt; ((7) * 8))" data-ref="_M/GEN8_PPAT">GEN8_PPAT</a>(<var>7</var>, <a class="macro" href="i915_gem_gtt.h.html#122" title="(1&lt;&lt;6)" data-ref="_M/CHV_PPAT_SNOOP">CHV_PPAT_SNOOP</a>);</td></tr>
<tr><th id="3311">3311</th><td></td></tr>
<tr><th id="3312">3312</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, (0x40e0), (pat), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1564" title="0x40e0" data-ref="_M/GEN8_PRIVATE_PAT_LO">GEN8_PRIVATE_PAT_LO</a>, <a class="local col2 ref" href="#642pat" title='pat' data-ref="642pat" data-ref-filename="642pat">pat</a>);</td></tr>
<tr><th id="3313">3313</th><td>	<a class="macro" href="i915_drv.h.html#3592" title="dev_priv-&gt;uncore.funcs.mmio_writel(dev_priv, ((0x40e0 + 4)), (pat &gt;&gt; 32), 1)" data-ref="_M/I915_WRITE">I915_WRITE</a>(<a class="macro" href="i915_reg.h.html#1565" title="(0x40e0 + 4)" data-ref="_M/GEN8_PRIVATE_PAT_HI">GEN8_PRIVATE_PAT_HI</a>, <a class="local col2 ref" href="#642pat" title='pat' data-ref="642pat" data-ref-filename="642pat">pat</a> &gt;&gt; <var>32</var>);</td></tr>
<tr><th id="3314">3314</th><td>}</td></tr>
<tr><th id="3315">3315</th><td></td></tr>
<tr><th id="3316">3316</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen8_gmch_probe" title='gen8_gmch_probe' data-type='int gen8_gmch_probe(struct drm_device * dev, u64 * gtt_total, size_t * stolen, phys_addr_t * mappable_base, u64 * mappable_end)' data-ref="gen8_gmch_probe" data-ref-filename="gen8_gmch_probe">gen8_gmch_probe</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="643dev" title='dev' data-type='struct drm_device *' data-ref="643dev" data-ref-filename="643dev">dev</dfn>,</td></tr>
<tr><th id="3317">3317</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col4 decl" id="644gtt_total" title='gtt_total' data-type='u64 *' data-ref="644gtt_total" data-ref-filename="644gtt_total">gtt_total</dfn>,</td></tr>
<tr><th id="3318">3318</th><td>			   <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> *<dfn class="local col5 decl" id="645stolen" title='stolen' data-type='size_t *' data-ref="645stolen" data-ref-filename="645stolen">stolen</dfn>,</td></tr>
<tr><th id="3319">3319</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#phys_addr_t" title='phys_addr_t' data-type='paddr_t' data-ref="phys_addr_t" data-ref-filename="phys_addr_t">phys_addr_t</a> *<dfn class="local col6 decl" id="646mappable_base" title='mappable_base' data-type='phys_addr_t *' data-ref="646mappable_base" data-ref-filename="646mappable_base">mappable_base</dfn>,</td></tr>
<tr><th id="3320">3320</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col7 decl" id="647mappable_end" title='mappable_end' data-type='u64 *' data-ref="647mappable_end" data-ref-filename="647mappable_end">mappable_end</dfn>)</td></tr>
<tr><th id="3321">3321</th><td>{</td></tr>
<tr><th id="3322">3322</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col8 decl" id="648dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="648dev_priv" data-ref-filename="648dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3323">3323</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> <dfn class="local col9 decl" id="649gtt_size" title='gtt_size' data-type='u64' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</dfn>;</td></tr>
<tr><th id="3324">3324</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col0 decl" id="650snb_gmch_ctl" title='snb_gmch_ctl' data-type='u16' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</dfn>;</td></tr>
<tr><th id="3325">3325</th><td>	<em>int</em> <dfn class="local col1 decl" id="651ret" title='ret' data-type='int' data-ref="651ret" data-ref-filename="651ret">ret</dfn>;</td></tr>
<tr><th id="3326">3326</th><td></td></tr>
<tr><th id="3327">3327</th><td>	<i>/* TODO: We're not aware of mappable constraints on gen8 yet */</i></td></tr>
<tr><th id="3328">3328</th><td>	*<a class="local col6 ref" href="#646mappable_base" title='mappable_base' data-ref="646mappable_base" data-ref-filename="646mappable_base">mappable_base</a> = <a class="macro" href="../../../include/linux/pci.h.html#212" title="linux_pci_resource_start" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>2</var>);</td></tr>
<tr><th id="3329">3329</th><td>	*<a class="local col7 ref" href="#647mappable_end" title='mappable_end' data-ref="647mappable_end" data-ref-filename="647mappable_end">mappable_end</a> = <a class="macro" href="../../../include/linux/pci.h.html#211" title="linux_pci_resource_len" data-ref="_M/pci_resource_len">pci_resource_len</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>2</var>);</td></tr>
<tr><th id="3330">3330</th><td></td></tr>
<tr><th id="3331">3331</th><td><u>#<span data-ppcond="3331">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3332">3332</th><td>	<b>if</b> (!<a class="ref fn" href="#3332" title='pci_set_dma_mask' data-ref="pci_set_dma_mask" data-ref-filename="pci_set_dma_mask">pci_set_dma_mask</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="ref fn" href="../../../include/linux/dma-mapping.h.html#DMA_BIT_MASK" title='DMA_BIT_MASK' data-ref="DMA_BIT_MASK" data-ref-filename="DMA_BIT_MASK">DMA_BIT_MASK</a>(<var>39</var>)))</td></tr>
<tr><th id="3333">3333</th><td>		<a class="ref fn" href="#3333" title='pci_set_consistent_dma_mask' data-ref="pci_set_consistent_dma_mask" data-ref-filename="pci_set_consistent_dma_mask">pci_set_consistent_dma_mask</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="ref fn" href="../../../include/linux/dma-mapping.h.html#DMA_BIT_MASK" title='DMA_BIT_MASK' data-ref="DMA_BIT_MASK" data-ref-filename="DMA_BIT_MASK">DMA_BIT_MASK</a>(<var>39</var>));</td></tr>
<tr><th id="3334">3334</th><td><u>#<span data-ppcond="3331">endif</span></u></td></tr>
<tr><th id="3335">3335</th><td></td></tr>
<tr><th id="3336">3336</th><td>	<a class="macro" href="../../../include/linux/pci.h.html#208" title="linux_pci_read_config_word" data-ref="_M/pci_read_config_word">pci_read_config_word</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="macro" href="../../include/drm/i915_drm.h.html#49" title="0x50" data-ref="_M/SNB_GMCH_CTRL">SNB_GMCH_CTRL</a>, &amp;<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3337">3337</th><td></td></tr>
<tr><th id="3338">3338</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>9</var>) {</td></tr>
<tr><th id="3339">3339</th><td>		*<a class="local col5 ref" href="#645stolen" title='stolen' data-ref="645stolen" data-ref-filename="645stolen">stolen</a> = <a class="tu ref fn" href="#gen9_get_stolen_size" title='gen9_get_stolen_size' data-use='c' data-ref="gen9_get_stolen_size" data-ref-filename="gen9_get_stolen_size">gen9_get_stolen_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3340">3340</th><td>		<a class="local col9 ref" href="#649gtt_size" title='gtt_size' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</a> = <a class="tu ref fn" href="#gen8_get_total_gtt_size" title='gen8_get_total_gtt_size' data-use='c' data-ref="gen8_get_total_gtt_size" data-ref-filename="gen8_get_total_gtt_size">gen8_get_total_gtt_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3341">3341</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2558" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 8))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>)) {</td></tr>
<tr><th id="3342">3342</th><td>		*<a class="local col5 ref" href="#645stolen" title='stolen' data-ref="645stolen" data-ref-filename="645stolen">stolen</a> = <a class="tu ref fn" href="#chv_get_stolen_size" title='chv_get_stolen_size' data-use='c' data-ref="chv_get_stolen_size" data-ref-filename="chv_get_stolen_size">chv_get_stolen_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3343">3343</th><td>		<a class="local col9 ref" href="#649gtt_size" title='gtt_size' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</a> = <a class="tu ref fn" href="#chv_get_total_gtt_size" title='chv_get_total_gtt_size' data-use='c' data-ref="chv_get_total_gtt_size" data-ref-filename="chv_get_total_gtt_size">chv_get_total_gtt_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3344">3344</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3345">3345</th><td>		*<a class="local col5 ref" href="#645stolen" title='stolen' data-ref="645stolen" data-ref-filename="645stolen">stolen</a> = <a class="tu ref fn" href="#gen8_get_stolen_size" title='gen8_get_stolen_size' data-use='c' data-ref="gen8_get_stolen_size" data-ref-filename="gen8_get_stolen_size">gen8_get_stolen_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3346">3346</th><td>		<a class="local col9 ref" href="#649gtt_size" title='gtt_size' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</a> = <a class="tu ref fn" href="#gen8_get_total_gtt_size" title='gen8_get_total_gtt_size' data-use='c' data-ref="gen8_get_total_gtt_size" data-ref-filename="gen8_get_total_gtt_size">gen8_get_total_gtt_size</a>(<a class="local col0 ref" href="#650snb_gmch_ctl" title='snb_gmch_ctl' data-ref="650snb_gmch_ctl" data-ref-filename="650snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3347">3347</th><td>	}</td></tr>
<tr><th id="3348">3348</th><td></td></tr>
<tr><th id="3349">3349</th><td>	*<a class="local col4 ref" href="#644gtt_total" title='gtt_total' data-ref="644gtt_total" data-ref-filename="644gtt_total">gtt_total</a> = (<a class="local col9 ref" href="#649gtt_size" title='gtt_size' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</a> / <b>sizeof</b>(<a class="typedef" href="i915_gem_gtt.h.html#gen8_pte_t" title='gen8_pte_t' data-type='uint64_t' data-ref="gen8_pte_t" data-ref-filename="gen8_pte_t">gen8_pte_t</a>)) &lt;&lt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3350">3350</th><td></td></tr>
<tr><th id="3351">3351</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2558" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 8))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>) || <a class="macro" href="i915_drv.h.html#2563" title="(!((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_skylake) &amp;&amp; !((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_kabylake) &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 9))" data-ref="_M/IS_BROXTON">IS_BROXTON</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>))</td></tr>
<tr><th id="3352">3352</th><td>		<a class="tu ref fn" href="#chv_setup_private_ppat" title='chv_setup_private_ppat' data-use='c' data-ref="chv_setup_private_ppat" data-ref-filename="chv_setup_private_ppat">chv_setup_private_ppat</a>(<a class="local col8 ref" href="#648dev_priv" title='dev_priv' data-ref="648dev_priv" data-ref-filename="648dev_priv">dev_priv</a>);</td></tr>
<tr><th id="3353">3353</th><td>	<b>else</b></td></tr>
<tr><th id="3354">3354</th><td>		<a class="tu ref fn" href="#bdw_setup_private_ppat" title='bdw_setup_private_ppat' data-use='c' data-ref="bdw_setup_private_ppat" data-ref-filename="bdw_setup_private_ppat">bdw_setup_private_ppat</a>(<a class="local col8 ref" href="#648dev_priv" title='dev_priv' data-ref="648dev_priv" data-ref-filename="648dev_priv">dev_priv</a>);</td></tr>
<tr><th id="3355">3355</th><td></td></tr>
<tr><th id="3356">3356</th><td>	<a class="local col1 ref" href="#651ret" title='ret' data-ref="651ret" data-ref-filename="651ret">ret</a> = <a class="tu ref fn" href="#ggtt_probe_common" title='ggtt_probe_common' data-use='c' data-ref="ggtt_probe_common" data-ref-filename="ggtt_probe_common">ggtt_probe_common</a>(<a class="local col3 ref" href="#643dev" title='dev' data-ref="643dev" data-ref-filename="643dev">dev</a>, <a class="local col9 ref" href="#649gtt_size" title='gtt_size' data-ref="649gtt_size" data-ref-filename="649gtt_size">gtt_size</a>);</td></tr>
<tr><th id="3357">3357</th><td></td></tr>
<tr><th id="3358">3358</th><td>	dev_priv-&gt;gtt.base.clear_range = gen8_ggtt_clear_range;</td></tr>
<tr><th id="3359">3359</th><td>	dev_priv-&gt;gtt.base.insert_entries = gen8_ggtt_insert_entries;</td></tr>
<tr><th id="3360">3360</th><td>	dev_priv-&gt;gtt.base.bind_vma = ggtt_bind_vma;</td></tr>
<tr><th id="3361">3361</th><td>	dev_priv-&gt;gtt.base.unbind_vma = ggtt_unbind_vma;</td></tr>
<tr><th id="3362">3362</th><td></td></tr>
<tr><th id="3363">3363</th><td>	<i>/* XXX 39-bit addresses?  Really?  See pci_set_dma_mask above...  */</i></td></tr>
<tr><th id="3364">3364</th><td>	dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((38))&gt;((0)))?((38)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((38))&gt;((0)))?((38)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((38))&lt;=((0)))?((38)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((38))&lt;=((0)))?((38)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>38</var>, <var>0</var>);</td></tr>
<tr><th id="3365">3365</th><td></td></tr>
<tr><th id="3366">3366</th><td>	<b>return</b> <a class="local col1 ref" href="#651ret" title='ret' data-ref="651ret" data-ref-filename="651ret">ret</a>;</td></tr>
<tr><th id="3367">3367</th><td>}</td></tr>
<tr><th id="3368">3368</th><td></td></tr>
<tr><th id="3369">3369</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="gen6_gmch_probe" title='gen6_gmch_probe' data-type='int gen6_gmch_probe(struct drm_device * dev, u64 * gtt_total, size_t * stolen, phys_addr_t * mappable_base, u64 * mappable_end)' data-ref="gen6_gmch_probe" data-ref-filename="gen6_gmch_probe">gen6_gmch_probe</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col2 decl" id="652dev" title='dev' data-type='struct drm_device *' data-ref="652dev" data-ref-filename="652dev">dev</dfn>,</td></tr>
<tr><th id="3370">3370</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col3 decl" id="653gtt_total" title='gtt_total' data-type='u64 *' data-ref="653gtt_total" data-ref-filename="653gtt_total">gtt_total</dfn>,</td></tr>
<tr><th id="3371">3371</th><td>			   <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> *<dfn class="local col4 decl" id="654stolen" title='stolen' data-type='size_t *' data-ref="654stolen" data-ref-filename="654stolen">stolen</dfn>,</td></tr>
<tr><th id="3372">3372</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#phys_addr_t" title='phys_addr_t' data-type='paddr_t' data-ref="phys_addr_t" data-ref-filename="phys_addr_t">phys_addr_t</a> *<dfn class="local col5 decl" id="655mappable_base" title='mappable_base' data-type='phys_addr_t *' data-ref="655mappable_base" data-ref-filename="655mappable_base">mappable_base</dfn>,</td></tr>
<tr><th id="3373">3373</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col6 decl" id="656mappable_end" title='mappable_end' data-type='u64 *' data-ref="656mappable_end" data-ref-filename="656mappable_end">mappable_end</dfn>)</td></tr>
<tr><th id="3374">3374</th><td>{</td></tr>
<tr><th id="3375">3375</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col7 decl" id="657dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="657dev_priv" data-ref-filename="657dev_priv">dev_priv</dfn> = <a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3376">3376</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col8 decl" id="658gtt_size" title='gtt_size' data-type='unsigned int' data-ref="658gtt_size" data-ref-filename="658gtt_size">gtt_size</dfn>;</td></tr>
<tr><th id="3377">3377</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u16" title='u16' data-type='uint16_t' data-ref="u16" data-ref-filename="u16">u16</a> <dfn class="local col9 decl" id="659snb_gmch_ctl" title='snb_gmch_ctl' data-type='u16' data-ref="659snb_gmch_ctl" data-ref-filename="659snb_gmch_ctl">snb_gmch_ctl</dfn>;</td></tr>
<tr><th id="3378">3378</th><td>	<em>int</em> <dfn class="local col0 decl" id="660ret" title='ret' data-type='int' data-ref="660ret" data-ref-filename="660ret">ret</dfn>;</td></tr>
<tr><th id="3379">3379</th><td></td></tr>
<tr><th id="3380">3380</th><td>	*<a class="local col5 ref" href="#655mappable_base" title='mappable_base' data-ref="655mappable_base" data-ref-filename="655mappable_base">mappable_base</a> = <a class="macro" href="../../../include/linux/pci.h.html#212" title="linux_pci_resource_start" data-ref="_M/pci_resource_start">pci_resource_start</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>2</var>);</td></tr>
<tr><th id="3381">3381</th><td>	*<a class="local col6 ref" href="#656mappable_end" title='mappable_end' data-ref="656mappable_end" data-ref-filename="656mappable_end">mappable_end</a> = <a class="macro" href="../../../include/linux/pci.h.html#211" title="linux_pci_resource_len" data-ref="_M/pci_resource_len">pci_resource_len</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <var>2</var>);</td></tr>
<tr><th id="3382">3382</th><td></td></tr>
<tr><th id="3383">3383</th><td>	<i>/* 64/512MB is the current min/max we actually know of, but this is just</i></td></tr>
<tr><th id="3384">3384</th><td><i>	 * a coarse sanity check.</i></td></tr>
<tr><th id="3385">3385</th><td><i>	 */</i></td></tr>
<tr><th id="3386">3386</th><td>	<b>if</b> ((*<a class="local col6 ref" href="#656mappable_end" title='mappable_end' data-ref="656mappable_end" data-ref-filename="656mappable_end">mappable_end</a> &lt; (<var>64</var>&lt;&lt;<var>20</var>) || (*<a class="local col6 ref" href="#656mappable_end" title='mappable_end' data-ref="656mappable_end" data-ref-filename="656mappable_end">mappable_end</a> &gt; (<var>512</var>&lt;&lt;<var>20</var>)))) {</td></tr>
<tr><th id="3387">3387</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3388, __func__, &quot;Unknown GMADR size (%&quot;&quot;lx&quot;&quot;)\n&quot;, dev_priv-&gt;gtt.mappable_end)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Unknown GMADR size (%"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#109" title="&quot;lx&quot;" data-ref="_M/PRIx64">PRIx64</a><q>")\n"</q>,</td></tr>
<tr><th id="3388">3388</th><td>			  dev_priv-&gt;gtt.mappable_end);</td></tr>
<tr><th id="3389">3389</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#47" title="6" data-ref="_M/ENXIO">ENXIO</a>;</td></tr>
<tr><th id="3390">3390</th><td>	}</td></tr>
<tr><th id="3391">3391</th><td></td></tr>
<tr><th id="3392">3392</th><td><u>#<span data-ppcond="3392">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3393">3393</th><td>	<b>if</b> (!<a class="ref fn" href="#3332" title='pci_set_dma_mask' data-ref="pci_set_dma_mask" data-ref-filename="pci_set_dma_mask">pci_set_dma_mask</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="ref fn" href="../../../include/linux/dma-mapping.h.html#DMA_BIT_MASK" title='DMA_BIT_MASK' data-ref="DMA_BIT_MASK" data-ref-filename="DMA_BIT_MASK">DMA_BIT_MASK</a>(<var>40</var>)))</td></tr>
<tr><th id="3394">3394</th><td>		<a class="ref fn" href="#3333" title='pci_set_consistent_dma_mask' data-ref="pci_set_consistent_dma_mask" data-ref-filename="pci_set_consistent_dma_mask">pci_set_consistent_dma_mask</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="ref fn" href="../../../include/linux/dma-mapping.h.html#DMA_BIT_MASK" title='DMA_BIT_MASK' data-ref="DMA_BIT_MASK" data-ref-filename="DMA_BIT_MASK">DMA_BIT_MASK</a>(<var>40</var>));</td></tr>
<tr><th id="3395">3395</th><td><u>#<span data-ppcond="3392">endif</span></u></td></tr>
<tr><th id="3396">3396</th><td>	<a class="macro" href="../../../include/linux/pci.h.html#208" title="linux_pci_read_config_word" data-ref="_M/pci_read_config_word">pci_read_config_word</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="macro" href="../../include/drm/i915_drm.h.html#49" title="0x50" data-ref="_M/SNB_GMCH_CTRL">SNB_GMCH_CTRL</a>, &amp;<a class="local col9 ref" href="#659snb_gmch_ctl" title='snb_gmch_ctl' data-ref="659snb_gmch_ctl" data-ref-filename="659snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3397">3397</th><td></td></tr>
<tr><th id="3398">3398</th><td>	*<a class="local col4 ref" href="#654stolen" title='stolen' data-ref="654stolen" data-ref-filename="654stolen">stolen</a> = <a class="tu ref fn" href="#gen6_get_stolen_size" title='gen6_get_stolen_size' data-use='c' data-ref="gen6_get_stolen_size" data-ref-filename="gen6_get_stolen_size">gen6_get_stolen_size</a>(<a class="local col9 ref" href="#659snb_gmch_ctl" title='snb_gmch_ctl' data-ref="659snb_gmch_ctl" data-ref-filename="659snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3399">3399</th><td></td></tr>
<tr><th id="3400">3400</th><td>	<a class="local col8 ref" href="#658gtt_size" title='gtt_size' data-ref="658gtt_size" data-ref-filename="658gtt_size">gtt_size</a> = <a class="tu ref fn" href="#gen6_get_total_gtt_size" title='gen6_get_total_gtt_size' data-use='c' data-ref="gen6_get_total_gtt_size" data-ref-filename="gen6_get_total_gtt_size">gen6_get_total_gtt_size</a>(<a class="local col9 ref" href="#659snb_gmch_ctl" title='snb_gmch_ctl' data-ref="659snb_gmch_ctl" data-ref-filename="659snb_gmch_ctl">snb_gmch_ctl</a>);</td></tr>
<tr><th id="3401">3401</th><td>	*<a class="local col3 ref" href="#653gtt_total" title='gtt_total' data-ref="653gtt_total" data-ref-filename="653gtt_total">gtt_total</a> = (<a class="local col8 ref" href="#658gtt_size" title='gtt_size' data-ref="658gtt_size" data-ref-filename="658gtt_size">gtt_size</a> / <b>sizeof</b>(<a class="typedef" href="i915_gem_gtt.h.html#gen6_pte_t" title='gen6_pte_t' data-type='uint32_t' data-ref="gen6_pte_t" data-ref-filename="gen6_pte_t">gen6_pte_t</a>)) &lt;&lt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3402">3402</th><td></td></tr>
<tr><th id="3403">3403</th><td>	<a class="local col0 ref" href="#660ret" title='ret' data-ref="660ret" data-ref-filename="660ret">ret</a> = <a class="tu ref fn" href="#ggtt_probe_common" title='ggtt_probe_common' data-use='c' data-ref="ggtt_probe_common" data-ref-filename="ggtt_probe_common">ggtt_probe_common</a>(<a class="local col2 ref" href="#652dev" title='dev' data-ref="652dev" data-ref-filename="652dev">dev</a>, <a class="local col8 ref" href="#658gtt_size" title='gtt_size' data-ref="658gtt_size" data-ref-filename="658gtt_size">gtt_size</a>);</td></tr>
<tr><th id="3404">3404</th><td></td></tr>
<tr><th id="3405">3405</th><td>	dev_priv-&gt;gtt.base.clear_range = gen6_ggtt_clear_range;</td></tr>
<tr><th id="3406">3406</th><td>	dev_priv-&gt;gtt.base.insert_entries = gen6_ggtt_insert_entries;</td></tr>
<tr><th id="3407">3407</th><td>	dev_priv-&gt;gtt.base.bind_vma = ggtt_bind_vma;</td></tr>
<tr><th id="3408">3408</th><td>	dev_priv-&gt;gtt.base.unbind_vma = ggtt_unbind_vma;</td></tr>
<tr><th id="3409">3409</th><td></td></tr>
<tr><th id="3410">3410</th><td>	dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((39))&gt;((0)))?((39)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((39))&gt;((0)))?((39)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((39))&lt;=((0)))?((39)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((39))&lt;=((0)))?((39)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>39</var>, <var>0</var>);</td></tr>
<tr><th id="3411">3411</th><td></td></tr>
<tr><th id="3412">3412</th><td>	<b>return</b> <a class="local col0 ref" href="#660ret" title='ret' data-ref="660ret" data-ref-filename="660ret">ret</a>;</td></tr>
<tr><th id="3413">3413</th><td>}</td></tr>
<tr><th id="3414">3414</th><td></td></tr>
<tr><th id="3415">3415</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="gen6_gmch_remove" title='gen6_gmch_remove' data-type='void gen6_gmch_remove(struct i915_address_space * vm)' data-ref="gen6_gmch_remove" data-ref-filename="gen6_gmch_remove">gen6_gmch_remove</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="661vm" title='vm' data-type='struct i915_address_space *' data-ref="661vm" data-ref-filename="661vm">vm</dfn>)</td></tr>
<tr><th id="3416">3416</th><td>{</td></tr>
<tr><th id="3417">3417</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_gtt" title='i915_gtt' data-ref="i915_gtt" data-ref-filename="i915_gtt">i915_gtt</a> *<dfn class="local col2 decl" id="662gtt" title='gtt' data-type='struct i915_gtt *' data-ref="662gtt" data-ref-filename="662gtt">gtt</dfn> = <a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_gtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_gtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_gtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_gtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col1 ref" href="#661vm" title='vm' data-ref="661vm" data-ref-filename="661vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_gtt" title='i915_gtt' data-ref="i915_gtt" data-ref-filename="i915_gtt">i915_gtt</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>);</td></tr>
<tr><th id="3418">3418</th><td></td></tr>
<tr><th id="3419">3419</th><td><u>#<span data-ppcond="3419">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3420">3420</th><td>	bus_space_unmap(gtt-&gt;bst, gtt-&gt;bsh, gtt-&gt;size);</td></tr>
<tr><th id="3421">3421</th><td><u>#<span data-ppcond="3419">else</span></u></td></tr>
<tr><th id="3422">3422</th><td>	iounmap(gtt-&gt;<span class='error' title="no member named &apos;gsm&apos; in &apos;struct i915_gtt&apos;">gsm</span>);</td></tr>
<tr><th id="3423">3423</th><td><u>#<span data-ppcond="3419">endif</span></u></td></tr>
<tr><th id="3424">3424</th><td>	<a class="tu ref fn" href="#free_scratch_page" title='free_scratch_page' data-use='c' data-ref="free_scratch_page" data-ref-filename="free_scratch_page">free_scratch_page</a>(<a class="local col1 ref" href="#661vm" title='vm' data-ref="661vm" data-ref-filename="661vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a>, <a class="local col1 ref" href="#661vm" title='vm' data-ref="661vm" data-ref-filename="661vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::scratch_page" title='i915_address_space::scratch_page' data-ref="i915_address_space::scratch_page" data-ref-filename="i915_address_space..scratch_page">scratch_page</a>);</td></tr>
<tr><th id="3425">3425</th><td>}</td></tr>
<tr><th id="3426">3426</th><td></td></tr>
<tr><th id="3427">3427</th><td><em>static</em> <em>int</em> <dfn class="tu decl def fn" id="i915_gmch_probe" title='i915_gmch_probe' data-type='int i915_gmch_probe(struct drm_device * dev, u64 * gtt_total, size_t * stolen, phys_addr_t * mappable_base, u64 * mappable_end)' data-ref="i915_gmch_probe" data-ref-filename="i915_gmch_probe">i915_gmch_probe</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col3 decl" id="663dev" title='dev' data-type='struct drm_device *' data-ref="663dev" data-ref-filename="663dev">dev</dfn>,</td></tr>
<tr><th id="3428">3428</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col4 decl" id="664gtt_total" title='gtt_total' data-type='u64 *' data-ref="664gtt_total" data-ref-filename="664gtt_total">gtt_total</dfn>,</td></tr>
<tr><th id="3429">3429</th><td>			   <a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> *<dfn class="local col5 decl" id="665stolen" title='stolen' data-type='size_t *' data-ref="665stolen" data-ref-filename="665stolen">stolen</dfn>,</td></tr>
<tr><th id="3430">3430</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#phys_addr_t" title='phys_addr_t' data-type='paddr_t' data-ref="phys_addr_t" data-ref-filename="phys_addr_t">phys_addr_t</a> *<dfn class="local col6 decl" id="666mappable_base" title='mappable_base' data-type='phys_addr_t *' data-ref="666mappable_base" data-ref-filename="666mappable_base">mappable_base</dfn>,</td></tr>
<tr><th id="3431">3431</th><td>			   <a class="typedef" href="../../../include/linux/types.h.html#u64" title='u64' data-type='uint64_t' data-ref="u64" data-ref-filename="u64">u64</a> *<dfn class="local col7 decl" id="667mappable_end" title='mappable_end' data-type='u64 *' data-ref="667mappable_end" data-ref-filename="667mappable_end">mappable_end</dfn>)</td></tr>
<tr><th id="3432">3432</th><td>{</td></tr>
<tr><th id="3433">3433</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col8 decl" id="668dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="668dev_priv" data-ref-filename="668dev_priv">dev_priv</dfn> = <a class="local col3 ref" href="#663dev" title='dev' data-ref="663dev" data-ref-filename="663dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3434">3434</th><td>	<em>int</em> <dfn class="local col9 decl" id="669ret" title='ret' data-type='int' data-ref="669ret" data-ref-filename="669ret">ret</dfn>;</td></tr>
<tr><th id="3435">3435</th><td></td></tr>
<tr><th id="3436">3436</th><td>	<a class="local col9 ref" href="#669ret" title='ret' data-ref="669ret" data-ref-filename="669ret">ret</a> = <a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gmch_probe" title='intel_gmch_probe' data-ref="intel_gmch_probe" data-ref-filename="intel_gmch_probe">intel_gmch_probe</a>(<a class="local col8 ref" href="#668dev_priv" title='dev_priv' data-ref="668dev_priv" data-ref-filename="668dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::bridge_dev" title='drm_i915_private::bridge_dev' data-ref="drm_i915_private::bridge_dev" data-ref-filename="drm_i915_private..bridge_dev">bridge_dev</a>, <a class="local col8 ref" href="#668dev_priv" title='dev_priv' data-ref="668dev_priv" data-ref-filename="668dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::dev" title='drm_i915_private::dev' data-ref="drm_i915_private::dev" data-ref-filename="drm_i915_private..dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::pdev" title='drm_device::pdev' data-ref="drm_device::pdev" data-ref-filename="drm_device..pdev">pdev</a>, <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3437">3437</th><td>	<b>if</b> (!<a class="local col9 ref" href="#669ret" title='ret' data-ref="669ret" data-ref-filename="669ret">ret</a>) {</td></tr>
<tr><th id="3438">3438</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3438, __func__, &quot;failed to set up gmch\n&quot;)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"failed to set up gmch\n"</q>);</td></tr>
<tr><th id="3439">3439</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#46" title="5" data-ref="_M/EIO">EIO</a>;</td></tr>
<tr><th id="3440">3440</th><td>	}</td></tr>
<tr><th id="3441">3441</th><td></td></tr>
<tr><th id="3442">3442</th><td>	<a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gtt_get" title='intel_gtt_get' data-ref="intel_gtt_get" data-ref-filename="intel_gtt_get">intel_gtt_get</a>(<a class="local col4 ref" href="#664gtt_total" title='gtt_total' data-ref="664gtt_total" data-ref-filename="664gtt_total">gtt_total</a>, <a class="local col5 ref" href="#665stolen" title='stolen' data-ref="665stolen" data-ref-filename="665stolen">stolen</a>, <a class="local col6 ref" href="#666mappable_base" title='mappable_base' data-ref="666mappable_base" data-ref-filename="666mappable_base">mappable_base</a>, <a class="local col7 ref" href="#667mappable_end" title='mappable_end' data-ref="667mappable_end" data-ref-filename="667mappable_end">mappable_end</a>);</td></tr>
<tr><th id="3443">3443</th><td></td></tr>
<tr><th id="3444">3444</th><td>	dev_priv-&gt;gtt.do_idle_maps = needs_idle_maps(dev_priv-&gt;dev);</td></tr>
<tr><th id="3445">3445</th><td>	dev_priv-&gt;gtt.base.insert_entries = i915_ggtt_insert_entries;</td></tr>
<tr><th id="3446">3446</th><td>	dev_priv-&gt;gtt.base.clear_range = i915_ggtt_clear_range;</td></tr>
<tr><th id="3447">3447</th><td>	dev_priv-&gt;gtt.base.bind_vma = ggtt_bind_vma;</td></tr>
<tr><th id="3448">3448</th><td>	dev_priv-&gt;gtt.base.unbind_vma = ggtt_unbind_vma;</td></tr>
<tr><th id="3449">3449</th><td></td></tr>
<tr><th id="3450">3450</th><td>	<b>if</b> (<a class="macro" href="../../../../common/include/linux/kernel.h.html#66" title="__builtin_expect((dev_priv-&gt;gtt.do_idle_maps) != 0, 0)" data-ref="_M/unlikely">unlikely</a>(dev_priv-&gt;gtt.do_idle_maps))</td></tr>
<tr><th id="3451">3451</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#183" title="do { printf(&quot;kern info: &quot; &quot;[&quot; &quot;drm&quot; &quot;] &quot; &quot;applying Ironlake quirks for intel_iommu\n&quot;); } while (0)" data-ref="_M/DRM_INFO">DRM_INFO</a>(<q>"applying Ironlake quirks for intel_iommu\n"</q>);</td></tr>
<tr><th id="3452">3452</th><td></td></tr>
<tr><th id="3453">3453</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(dev)-&gt;gen &lt;= <var>2</var>)</td></tr>
<tr><th id="3454">3454</th><td>		dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((29))&gt;((0)))?((29)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((29))&gt;((0)))?((29)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((29))&lt;=((0)))?((29)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((29))&lt;=((0)))?((29)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>29</var>, <var>0</var>);</td></tr>
<tr><th id="3455">3455</th><td>	<b>else</b> <b>if</b> ((<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(dev)-&gt;gen &lt;= <var>3</var>) ||</td></tr>
<tr><th id="3456">3456</th><td>	    <a class="macro" href="i915_drv.h.html#2544" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_broadwater)" data-ref="_M/IS_BROADWATER">IS_BROADWATER</a>(dev) || <a class="macro" href="i915_drv.h.html#2545" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_crestline)" data-ref="_M/IS_CRESTLINE">IS_CRESTLINE</a>(dev))</td></tr>
<tr><th id="3457">3457</th><td>		dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((31))&gt;((0)))?((31)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((31))&gt;((0)))?((31)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((31))&lt;=((0)))?((31)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((31))&lt;=((0)))?((31)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>31</var>, <var>0</var>);</td></tr>
<tr><th id="3458">3458</th><td>	<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(dev)-&gt;gen &lt;= <var>5</var>)</td></tr>
<tr><th id="3459">3459</th><td>		dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((35))&gt;((0)))?((35)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((35))&gt;((0)))?((35)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((35))&lt;=((0)))?((35)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((35))&lt;=((0)))?((35)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>35</var>, <var>0</var>);</td></tr>
<tr><th id="3460">3460</th><td>	<b>else</b></td></tr>
<tr><th id="3461">3461</th><td>		dev_priv-&gt;gtt.max_paddr = <a class="macro" href="../../../../../../sys/cdefs.h.html#593" title="(((((uintmax_t)((( ((39))&gt;((0)))?((39)):((0))) + 1) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((39))&gt;((0)))?((39)):((0))) + 1) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1) ^ ((((uintmax_t)((( ((39))&lt;=((0)))?((39)):((0)))) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)(((( ((39))&lt;=((0)))?((39)):((0)))) &amp; (8 * sizeof(uintmax_t) - 1)))) - 1))" data-ref="_M/__BITS">__BITS</a>(<var>39</var>, <var>0</var>);</td></tr>
<tr><th id="3462">3462</th><td></td></tr>
<tr><th id="3463">3463</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3464">3464</th><td>}</td></tr>
<tr><th id="3465">3465</th><td></td></tr>
<tr><th id="3466">3466</th><td><em>static</em> <em>void</em> <dfn class="tu decl def fn" id="i915_gmch_remove" title='i915_gmch_remove' data-type='void i915_gmch_remove(struct i915_address_space * vm)' data-ref="i915_gmch_remove" data-ref-filename="i915_gmch_remove">i915_gmch_remove</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col0 decl" id="670vm" title='vm' data-type='struct i915_address_space *' data-ref="670vm" data-ref-filename="670vm">vm</dfn>)</td></tr>
<tr><th id="3467">3467</th><td>{</td></tr>
<tr><th id="3468">3468</th><td>	<a class="ref fn" href="../../../include/drm/intel-gtt.h.html#intel_gmch_remove" title='intel_gmch_remove' data-ref="intel_gmch_remove" data-ref-filename="intel_gmch_remove">intel_gmch_remove</a>();</td></tr>
<tr><th id="3469">3469</th><td>}</td></tr>
<tr><th id="3470">3470</th><td></td></tr>
<tr><th id="3471">3471</th><td><em>int</em> <dfn class="decl def fn" id="i915_gem_gtt_init" title='i915_gem_gtt_init' data-ref="i915_gem_gtt_init" data-ref-filename="i915_gem_gtt_init">i915_gem_gtt_init</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col1 decl" id="671dev" title='dev' data-type='struct drm_device *' data-ref="671dev" data-ref-filename="671dev">dev</dfn>)</td></tr>
<tr><th id="3472">3472</th><td>{</td></tr>
<tr><th id="3473">3473</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col2 decl" id="672dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="672dev_priv" data-ref-filename="672dev_priv">dev_priv</dfn> = <a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3474">3474</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_gtt" title='i915_gtt' data-ref="i915_gtt" data-ref-filename="i915_gtt">i915_gtt</a> *<dfn class="local col3 decl" id="673gtt" title='gtt' data-type='struct i915_gtt *' data-ref="673gtt" data-ref-filename="673gtt">gtt</dfn> = &amp;dev_priv-&gt;gtt;</td></tr>
<tr><th id="3475">3475</th><td>	<em>int</em> <dfn class="local col4 decl" id="674ret" title='ret' data-type='int' data-ref="674ret" data-ref-filename="674ret">ret</dfn>;</td></tr>
<tr><th id="3476">3476</th><td></td></tr>
<tr><th id="3477">3477</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt;= <var>5</var>) {</td></tr>
<tr><th id="3478">3478</th><td>		<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::gtt_probe" title='i915_gtt::gtt_probe' data-ref="i915_gtt::gtt_probe" data-ref-filename="i915_gtt..gtt_probe">gtt_probe</a> = <a class="tu ref fn" href="#i915_gmch_probe" title='i915_gmch_probe' data-use='r' data-ref="i915_gmch_probe" data-ref-filename="i915_gmch_probe">i915_gmch_probe</a>;</td></tr>
<tr><th id="3479">3479</th><td>		<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a> = <a class="tu ref fn" href="#i915_gmch_remove" title='i915_gmch_remove' data-use='r' data-ref="i915_gmch_remove" data-ref-filename="i915_gmch_remove">i915_gmch_remove</a>;</td></tr>
<tr><th id="3480">3480</th><td>	} <b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &lt; <var>8</var>) {</td></tr>
<tr><th id="3481">3481</th><td>		<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::gtt_probe" title='i915_gtt::gtt_probe' data-ref="i915_gtt::gtt_probe" data-ref-filename="i915_gtt..gtt_probe">gtt_probe</a> = <a class="tu ref fn" href="#gen6_gmch_probe" title='gen6_gmch_probe' data-use='r' data-ref="gen6_gmch_probe" data-ref-filename="gen6_gmch_probe">gen6_gmch_probe</a>;</td></tr>
<tr><th id="3482">3482</th><td>		<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::cleanup" title='i915_address_space::cleanup' data-ref="i915_address_space::cleanup" data-ref-filename="i915_address_space..cleanup">cleanup</a> = <a class="tu ref fn" href="#gen6_gmch_remove" title='gen6_gmch_remove' data-use='r' data-ref="gen6_gmch_remove" data-ref-filename="gen6_gmch_remove">gen6_gmch_remove</a>;</td></tr>
<tr><th id="3483">3483</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#2559" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_haswell)" data-ref="_M/IS_HASWELL">IS_HASWELL</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>) &amp;&amp; <a class="local col2 ref" href="#672dev_priv" title='dev_priv' data-ref="672dev_priv" data-ref-filename="672dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::ellc_size" title='drm_i915_private::ellc_size' data-ref="drm_i915_private::ellc_size" data-ref-filename="drm_i915_private..ellc_size">ellc_size</a>)</td></tr>
<tr><th id="3484">3484</th><td>			<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a> = <a class="tu ref fn" href="#iris_pte_encode" title='iris_pte_encode' data-use='r' data-ref="iris_pte_encode" data-ref-filename="iris_pte_encode">iris_pte_encode</a>;</td></tr>
<tr><th id="3485">3485</th><td>		<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2559" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_haswell)" data-ref="_M/IS_HASWELL">IS_HASWELL</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>))</td></tr>
<tr><th id="3486">3486</th><td>			<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a> = <a class="tu ref fn" href="#hsw_pte_encode" title='hsw_pte_encode' data-use='r' data-ref="hsw_pte_encode" data-ref-filename="hsw_pte_encode">hsw_pte_encode</a>;</td></tr>
<tr><th id="3487">3487</th><td>		<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2557" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview)" data-ref="_M/IS_VALLEYVIEW">IS_VALLEYVIEW</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>))</td></tr>
<tr><th id="3488">3488</th><td>			<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a> = <a class="tu ref fn" href="#byt_pte_encode" title='byt_pte_encode' data-use='r' data-ref="byt_pte_encode" data-ref-filename="byt_pte_encode">byt_pte_encode</a>;</td></tr>
<tr><th id="3489">3489</th><td>		<b>else</b> <b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>7</var>)</td></tr>
<tr><th id="3490">3490</th><td>			<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a> = <a class="tu ref fn" href="#ivb_pte_encode" title='ivb_pte_encode' data-use='r' data-ref="ivb_pte_encode" data-ref-filename="ivb_pte_encode">ivb_pte_encode</a>;</td></tr>
<tr><th id="3491">3491</th><td>		<b>else</b></td></tr>
<tr><th id="3492">3492</th><td>			<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::pte_encode" title='i915_address_space::pte_encode' data-ref="i915_address_space::pte_encode" data-ref-filename="i915_address_space..pte_encode">pte_encode</a> = <a class="tu ref fn" href="#snb_pte_encode" title='snb_pte_encode' data-use='r' data-ref="snb_pte_encode" data-ref-filename="snb_pte_encode">snb_pte_encode</a>;</td></tr>
<tr><th id="3493">3493</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3494">3494</th><td>		dev_priv-&gt;gtt.gtt_probe = gen8_gmch_probe;</td></tr>
<tr><th id="3495">3495</th><td>		dev_priv-&gt;gtt.base.cleanup = gen6_gmch_remove;</td></tr>
<tr><th id="3496">3496</th><td>	}</td></tr>
<tr><th id="3497">3497</th><td></td></tr>
<tr><th id="3498">3498</th><td>	<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::dev" title='i915_address_space::dev' data-ref="i915_address_space::dev" data-ref-filename="i915_address_space..dev">dev</a> = <a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>;</td></tr>
<tr><th id="3499">3499</th><td></td></tr>
<tr><th id="3500">3500</th><td>	<a class="local col4 ref" href="#674ret" title='ret' data-ref="674ret" data-ref-filename="674ret">ret</a> = <a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::gtt_probe" title='i915_gtt::gtt_probe' data-ref="i915_gtt::gtt_probe" data-ref-filename="i915_gtt..gtt_probe">gtt_probe</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>, &amp;<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>, &amp;<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::stolen_size" title='i915_gtt::stolen_size' data-ref="i915_gtt::stolen_size" data-ref-filename="i915_gtt..stolen_size">stolen_size</a>,</td></tr>
<tr><th id="3501">3501</th><td>			     &amp;<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::mappable_base" title='i915_gtt::mappable_base' data-ref="i915_gtt::mappable_base" data-ref-filename="i915_gtt..mappable_base">mappable_base</a>, &amp;<a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::mappable_end" title='i915_gtt::mappable_end' data-ref="i915_gtt::mappable_end" data-ref-filename="i915_gtt..mappable_end">mappable_end</a>);</td></tr>
<tr><th id="3502">3502</th><td>	<b>if</b> (<a class="local col4 ref" href="#674ret" title='ret' data-ref="674ret" data-ref-filename="674ret">ret</a>)</td></tr>
<tr><th id="3503">3503</th><td>		<b>return</b> <a class="local col4 ref" href="#674ret" title='ret' data-ref="674ret" data-ref-filename="674ret">ret</a>;</td></tr>
<tr><th id="3504">3504</th><td></td></tr>
<tr><th id="3505">3505</th><td><u>#<span data-ppcond="3505">ifdef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3506">3506</th><td>	dev_priv-&gt;gtt.pgfl = x86_select_freelist(dev_priv-&gt;gtt.max_paddr);</td></tr>
<tr><th id="3507">3507</th><td>	ret = drm_limit_dma_space(dev, <var>0</var>, dev_priv-&gt;gtt.max_paddr);</td></tr>
<tr><th id="3508">3508</th><td>	<b>if</b> (ret) {</td></tr>
<tr><th id="3509">3509</th><td>		DRM_ERROR(<q>"Unable to limit DMA paddr allocations: %d!\n"</q>, ret);</td></tr>
<tr><th id="3510">3510</th><td>		gtt-&gt;base.cleanup(&amp;gtt-&gt;base);</td></tr>
<tr><th id="3511">3511</th><td>		<b>return</b> ret;</td></tr>
<tr><th id="3512">3512</th><td>	}</td></tr>
<tr><th id="3513">3513</th><td><u>#<span data-ppcond="3505">endif</span></u></td></tr>
<tr><th id="3514">3514</th><td></td></tr>
<tr><th id="3515">3515</th><td>	<i>/* GMADR is the PCI mmio aperture into the global GTT. */</i></td></tr>
<tr><th id="3516">3516</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#183" title="do { printf(&quot;kern info: &quot; &quot;[&quot; &quot;drm&quot; &quot;] &quot; &quot;Memory usable by graphics device = %&quot;&quot;lu&quot;&quot;M\n&quot;, gtt-&gt;base.total &gt;&gt; 20); } while (0)" data-ref="_M/DRM_INFO">DRM_INFO</a>(<q>"Memory usable by graphics device = %"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#94" title="&quot;lu&quot;" data-ref="_M/PRIu64">PRIu64</a><q>"M\n"</q>,</td></tr>
<tr><th id="3517">3517</th><td>		 <a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::base" title='i915_gtt::base' data-ref="i915_gtt::base" data-ref-filename="i915_gtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a> &gt;&gt; <var>20</var>);</td></tr>
<tr><th id="3518">3518</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;GMADR size = %&quot;&quot;ld&quot;&quot;M\n&quot;, gtt-&gt;mappable_end &gt;&gt; 20); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"GMADR size = %"</q><a class="macro" href="../../../../../../sys/common_int_fmtio.h.html#47" title="&quot;ld&quot;" data-ref="_M/PRId64">PRId64</a><q>"M\n"</q>, <a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::mappable_end" title='i915_gtt::mappable_end' data-ref="i915_gtt::mappable_end" data-ref-filename="i915_gtt..mappable_end">mappable_end</a> &gt;&gt; <var>20</var>);</td></tr>
<tr><th id="3519">3519</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;GTT stolen size = %zdM\n&quot;, gtt-&gt;stolen_size &gt;&gt; 20); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"GTT stolen size = %zdM\n"</q>, <a class="local col3 ref" href="#673gtt" title='gtt' data-ref="673gtt" data-ref-filename="673gtt">gtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_gtt::stolen_size" title='i915_gtt::stolen_size' data-ref="i915_gtt::stolen_size" data-ref-filename="i915_gtt..stolen_size">stolen_size</a> &gt;&gt; <var>20</var>);</td></tr>
<tr><th id="3520">3520</th><td><u>#<span data-ppcond="3520">ifdef</span> <span class="macro" data-ref="_M/CONFIG_INTEL_IOMMU">CONFIG_INTEL_IOMMU</span></u></td></tr>
<tr><th id="3521">3521</th><td>	<b>if</b> (intel_iommu_gfx_mapped)</td></tr>
<tr><th id="3522">3522</th><td>		DRM_INFO(<q>"VT-d active for gfx access\n"</q>);</td></tr>
<tr><th id="3523">3523</th><td><u>#<span data-ppcond="3520">endif</span></u></td></tr>
<tr><th id="3524">3524</th><td>	<i>/*</i></td></tr>
<tr><th id="3525">3525</th><td><i>	 * i915.enable_ppgtt is read-only, so do an early pass to validate the</i></td></tr>
<tr><th id="3526">3526</th><td><i>	 * user's requested state against the hardware/driver capabilities.  We</i></td></tr>
<tr><th id="3527">3527</th><td><i>	 * do this now so that we can print out any log messages once rather</i></td></tr>
<tr><th id="3528">3528</th><td><i>	 * than every time we check intel_enable_ppgtt().</i></td></tr>
<tr><th id="3529">3529</th><td><i>	 */</i></td></tr>
<tr><th id="3530">3530</th><td>	<a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_ppgtt" title='i915_params::enable_ppgtt' data-ref="i915_params::enable_ppgtt" data-ref-filename="i915_params..enable_ppgtt">enable_ppgtt</a> = <a class="tu ref fn" href="#sanitize_enable_ppgtt" title='sanitize_enable_ppgtt' data-use='c' data-ref="sanitize_enable_ppgtt" data-ref-filename="sanitize_enable_ppgtt">sanitize_enable_ppgtt</a>(<a class="local col1 ref" href="#671dev" title='dev' data-ref="671dev" data-ref-filename="671dev">dev</a>, <a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_ppgtt" title='i915_params::enable_ppgtt' data-ref="i915_params::enable_ppgtt" data-ref-filename="i915_params..enable_ppgtt">enable_ppgtt</a>);</td></tr>
<tr><th id="3531">3531</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#234" title="do { if (__builtin_expect((drm_debug &amp; 0x02) != 0, 0)) drm_ut_debug_printk(__func__, &quot;ppgtt mode: %i\n&quot;, i915.enable_ppgtt); } while (0)" data-ref="_M/DRM_DEBUG_DRIVER">DRM_DEBUG_DRIVER</a>(<q>"ppgtt mode: %i\n"</q>, <a class="ref" href="i915_drv.h.html#i915" title='i915' data-ref="i915" data-ref-filename="i915">i915</a>.<a class="ref field" href="i915_drv.h.html#i915_params::enable_ppgtt" title='i915_params::enable_ppgtt' data-ref="i915_params::enable_ppgtt" data-ref-filename="i915_params..enable_ppgtt">enable_ppgtt</a>);</td></tr>
<tr><th id="3532">3532</th><td></td></tr>
<tr><th id="3533">3533</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3534">3534</th><td>}</td></tr>
<tr><th id="3535">3535</th><td></td></tr>
<tr><th id="3536">3536</th><td><em>void</em> <dfn class="decl def fn" id="i915_gem_restore_gtt_mappings" title='i915_gem_restore_gtt_mappings' data-ref="i915_gem_restore_gtt_mappings" data-ref-filename="i915_gem_restore_gtt_mappings">i915_gem_restore_gtt_mappings</dfn>(<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#drm_device" title='drm_device' data-ref="drm_device" data-ref-filename="drm_device">drm_device</a> *<dfn class="local col5 decl" id="675dev" title='dev' data-type='struct drm_device *' data-ref="675dev" data-ref-filename="675dev">dev</dfn>)</td></tr>
<tr><th id="3537">3537</th><td>{</td></tr>
<tr><th id="3538">3538</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_private" title='drm_i915_private' data-ref="drm_i915_private" data-ref-filename="drm_i915_private">drm_i915_private</a> *<dfn class="local col6 decl" id="676dev_priv" title='dev_priv' data-type='struct drm_i915_private *' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</dfn> = <a class="local col5 ref" href="#675dev" title='dev' data-ref="675dev" data-ref-filename="675dev">dev</a>-&gt;<a class="ref field" href="../../include/drm/drmP.h.html#drm_device::dev_private" title='drm_device::dev_private' data-ref="drm_device::dev_private" data-ref-filename="drm_device..dev_private">dev_private</a>;</td></tr>
<tr><th id="3539">3539</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col7 decl" id="677obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="677obj" data-ref-filename="677obj">obj</dfn>;</td></tr>
<tr><th id="3540">3540</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col8 decl" id="678vm" title='vm' data-type='struct i915_address_space *' data-ref="678vm" data-ref-filename="678vm">vm</dfn>;</td></tr>
<tr><th id="3541">3541</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col9 decl" id="679vma" title='vma' data-type='struct i915_vma *' data-ref="679vma" data-ref-filename="679vma">vma</dfn>;</td></tr>
<tr><th id="3542">3542</th><td>	<a class="macro" href="../../../../../../sys/stdbool.h.html#37" title="_Bool" data-ref="_M/bool">bool</a> <dfn class="local col0 decl" id="680flush" title='flush' data-type='_Bool' data-ref="680flush" data-ref-filename="680flush">flush</dfn>;</td></tr>
<tr><th id="3543">3543</th><td></td></tr>
<tr><th id="3544">3544</th><td>	<a class="ref fn" href="#i915_check_and_clear_faults" title='i915_check_and_clear_faults' data-ref="i915_check_and_clear_faults" data-ref-filename="i915_check_and_clear_faults">i915_check_and_clear_faults</a>(<a class="local col5 ref" href="#675dev" title='dev' data-ref="675dev" data-ref-filename="675dev">dev</a>);</td></tr>
<tr><th id="3545">3545</th><td></td></tr>
<tr><th id="3546">3546</th><td>	<i>/* First fill our portion of the GTT with scratch pages */</i></td></tr>
<tr><th id="3547">3547</th><td>	dev_priv-&gt;gtt.base.clear_range(&amp;dev_priv-&gt;gtt.base,</td></tr>
<tr><th id="3548">3548</th><td>				       dev_priv-&gt;gtt.base.start,</td></tr>
<tr><th id="3549">3549</th><td>				       dev_priv-&gt;gtt.base.total,</td></tr>
<tr><th id="3550">3550</th><td>				       <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>);</td></tr>
<tr><th id="3551">3551</th><td></td></tr>
<tr><th id="3552">3552</th><td>	<i>/* Cache flush objects bound into GGTT and rebind them. */</i></td></tr>
<tr><th id="3553">3553</th><td>	vm = &amp;dev_priv-&gt;gtt.base;</td></tr>
<tr><th id="3554">3554</th><td>	<a class="macro" href="../../../../common/include/linux/list.h.html#246" title="for ((obj) = ((typeof(*(obj)) *)(((char *)(list_first((&amp;dev_priv-&gt;mm.bound_list)))) - __builtin_offsetof(typeof(*(obj)), global_list)) + (0 * sizeof((list_first((&amp;dev_priv-&gt;mm.bound_list))) - &amp;((typeof(*(obj)) *)(((char *)(list_first((&amp;dev_priv-&gt;mm.bound_list)))) - __builtin_offsetof(typeof(*(obj)), global_list)))-&gt;global_list))); &amp;(obj)-&gt;global_list != (&amp;dev_priv-&gt;mm.bound_list); (obj) = ((typeof(*(obj)) *)(((char *)(list_next(&amp;(obj)-&gt;global_list))) - __builtin_offsetof(typeof(*(obj)), global_list)) + (0 * sizeof((list_next(&amp;(obj)-&gt;global_list)) - &amp;((typeof(*(obj)) *)(((char *)(list_next(&amp;(obj)-&gt;global_list))) - __builtin_offsetof(typeof(*(obj)), global_list)))-&gt;global_list))))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col7 ref" href="#677obj" title='obj' data-ref="677obj" data-ref-filename="677obj">obj</a>, &amp;<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::bound_list" title='i915_gem_mm::bound_list' data-ref="i915_gem_mm::bound_list" data-ref-filename="i915_gem_mm..bound_list">bound_list</a>, <a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::global_list" title='drm_i915_gem_object::global_list' data-ref="drm_i915_gem_object::global_list" data-ref-filename="drm_i915_gem_object..global_list">global_list</a>) {</td></tr>
<tr><th id="3555">3555</th><td>		<a class="local col0 ref" href="#680flush" title='flush' data-ref="680flush" data-ref-filename="680flush">flush</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#40" title="0" data-ref="_M/false">false</a>;</td></tr>
<tr><th id="3556">3556</th><td>		<a class="macro" href="../../../../common/include/linux/list.h.html#246" title="for ((vma) = ((typeof(*(vma)) *)(((char *)(list_first((&amp;obj-&gt;vma_list)))) - __builtin_offsetof(typeof(*(vma)), vma_link)) + (0 * sizeof((list_first((&amp;obj-&gt;vma_list))) - &amp;((typeof(*(vma)) *)(((char *)(list_first((&amp;obj-&gt;vma_list)))) - __builtin_offsetof(typeof(*(vma)), vma_link)))-&gt;vma_link))); &amp;(vma)-&gt;vma_link != (&amp;obj-&gt;vma_list); (vma) = ((typeof(*(vma)) *)(((char *)(list_next(&amp;(vma)-&gt;vma_link))) - __builtin_offsetof(typeof(*(vma)), vma_link)) + (0 * sizeof((list_next(&amp;(vma)-&gt;vma_link)) - &amp;((typeof(*(vma)) *)(((char *)(list_next(&amp;(vma)-&gt;vma_link))) - __builtin_offsetof(typeof(*(vma)), vma_link)))-&gt;vma_link))))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col9 ref" href="#679vma" title='vma' data-ref="679vma" data-ref-filename="679vma">vma</a>, &amp;<a class="local col7 ref" href="#677obj" title='obj' data-ref="677obj" data-ref-filename="677obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::vma_list" title='drm_i915_gem_object::vma_list' data-ref="drm_i915_gem_object::vma_list" data-ref-filename="drm_i915_gem_object..vma_list">vma_list</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vma_link" title='i915_vma::vma_link' data-ref="i915_vma::vma_link" data-ref-filename="i915_vma..vma_link">vma_link</a>) {</td></tr>
<tr><th id="3557">3557</th><td>			<b>if</b> (<a class="local col9 ref" href="#679vma" title='vma' data-ref="679vma" data-ref-filename="679vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a> != <a class="local col8 ref" href="#678vm" title='vm' data-ref="678vm" data-ref-filename="678vm">vm</a>)</td></tr>
<tr><th id="3558">3558</th><td>				<b>continue</b>;</td></tr>
<tr><th id="3559">3559</th><td></td></tr>
<tr><th id="3560">3560</th><td>			<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((i915_vma_bind(vma, obj-&gt;cache_level, (1&lt;&lt;5))))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3561, &quot;i915_vma_bind(vma, obj-&gt;cache_level, PIN_UPDATE)&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="#i915_vma_bind" title='i915_vma_bind' data-ref="i915_vma_bind" data-ref-filename="i915_vma_bind">i915_vma_bind</a>(<a class="local col9 ref" href="#679vma" title='vma' data-ref="679vma" data-ref-filename="679vma">vma</a>, <a class="local col7 ref" href="#677obj" title='obj' data-ref="677obj" data-ref-filename="677obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::cache_level" title='drm_i915_gem_object::cache_level' data-ref="drm_i915_gem_object::cache_level" data-ref-filename="drm_i915_gem_object..cache_level">cache_level</a>,</td></tr>
<tr><th id="3561">3561</th><td>					      <a class="macro" href="i915_drv.h.html#2951" title="(1&lt;&lt;5)" data-ref="_M/PIN_UPDATE">PIN_UPDATE</a>));</td></tr>
<tr><th id="3562">3562</th><td></td></tr>
<tr><th id="3563">3563</th><td>			<a class="local col0 ref" href="#680flush" title='flush' data-ref="680flush" data-ref-filename="680flush">flush</a> = <a class="macro" href="../../../../../../sys/stdbool.h.html#39" title="1" data-ref="_M/true">true</a>;</td></tr>
<tr><th id="3564">3564</th><td>		}</td></tr>
<tr><th id="3565">3565</th><td></td></tr>
<tr><th id="3566">3566</th><td>		<b>if</b> (<a class="local col0 ref" href="#680flush" title='flush' data-ref="680flush" data-ref-filename="680flush">flush</a>)</td></tr>
<tr><th id="3567">3567</th><td>			<a class="ref fn" href="i915_drv.h.html#i915_gem_clflush_object" title='i915_gem_clflush_object' data-ref="i915_gem_clflush_object" data-ref-filename="i915_gem_clflush_object">i915_gem_clflush_object</a>(<a class="local col7 ref" href="#677obj" title='obj' data-ref="677obj" data-ref-filename="677obj">obj</a>, <a class="local col7 ref" href="#677obj" title='obj' data-ref="677obj" data-ref-filename="677obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::pin_display" title='drm_i915_gem_object::pin_display' data-ref="drm_i915_gem_object::pin_display" data-ref-filename="drm_i915_gem_object..pin_display">pin_display</a>);</td></tr>
<tr><th id="3568">3568</th><td>	}</td></tr>
<tr><th id="3569">3569</th><td></td></tr>
<tr><th id="3570">3570</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2522" title="(&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)" data-ref="_M/INTEL_INFO">INTEL_INFO</a>(<a class="local col5 ref" href="#675dev" title='dev' data-ref="675dev" data-ref-filename="675dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#intel_device_info::gen" title='intel_device_info::gen' data-ref="intel_device_info::gen" data-ref-filename="intel_device_info..gen">gen</a> &gt;= <var>8</var>) {</td></tr>
<tr><th id="3571">3571</th><td>		<b>if</b> (<a class="macro" href="i915_drv.h.html#2558" title="((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_valleyview &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 8))" data-ref="_M/IS_CHERRYVIEW">IS_CHERRYVIEW</a>(<a class="local col5 ref" href="#675dev" title='dev' data-ref="675dev" data-ref-filename="675dev">dev</a>) || <a class="macro" href="i915_drv.h.html#2563" title="(!((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_skylake) &amp;&amp; !((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;is_kabylake) &amp;&amp; ((&amp;({ struct drm_i915_private *__p; if (__builtin_types_compatible_p(typeof(*dev), struct drm_i915_private)) __p = (struct drm_i915_private *)((void *)(unsigned long)(const void *)(dev)); else if (__builtin_types_compatible_p(typeof(*dev), struct drm_device)) __p = to_i915((struct drm_device *)((void *)(unsigned long)(const void *)(dev))); else do {} while (0); __p; })-&gt;info)-&gt;gen == 9))" data-ref="_M/IS_BROXTON">IS_BROXTON</a>(<a class="local col5 ref" href="#675dev" title='dev' data-ref="675dev" data-ref-filename="675dev">dev</a>))</td></tr>
<tr><th id="3572">3572</th><td>			<a class="tu ref fn" href="#chv_setup_private_ppat" title='chv_setup_private_ppat' data-use='c' data-ref="chv_setup_private_ppat" data-ref-filename="chv_setup_private_ppat">chv_setup_private_ppat</a>(<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>);</td></tr>
<tr><th id="3573">3573</th><td>		<b>else</b></td></tr>
<tr><th id="3574">3574</th><td>			<a class="tu ref fn" href="#bdw_setup_private_ppat" title='bdw_setup_private_ppat' data-use='c' data-ref="bdw_setup_private_ppat" data-ref-filename="bdw_setup_private_ppat">bdw_setup_private_ppat</a>(<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>);</td></tr>
<tr><th id="3575">3575</th><td></td></tr>
<tr><th id="3576">3576</th><td>		<b>return</b>;</td></tr>
<tr><th id="3577">3577</th><td>	}</td></tr>
<tr><th id="3578">3578</th><td></td></tr>
<tr><th id="3579">3579</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#2662" title="(i915.enable_ppgtt)" data-ref="_M/USES_PPGTT">USES_PPGTT</a>(dev)) {</td></tr>
<tr><th id="3580">3580</th><td>		<a class="macro" href="../../../../common/include/linux/list.h.html#246" title="for ((vm) = ((typeof(*(vm)) *)(((char *)(list_first((&amp;dev_priv-&gt;vm_list)))) - __builtin_offsetof(typeof(*(vm)), global_link)) + (0 * sizeof((list_first((&amp;dev_priv-&gt;vm_list))) - &amp;((typeof(*(vm)) *)(((char *)(list_first((&amp;dev_priv-&gt;vm_list)))) - __builtin_offsetof(typeof(*(vm)), global_link)))-&gt;global_link))); &amp;(vm)-&gt;global_link != (&amp;dev_priv-&gt;vm_list); (vm) = ((typeof(*(vm)) *)(((char *)(list_next(&amp;(vm)-&gt;global_link))) - __builtin_offsetof(typeof(*(vm)), global_link)) + (0 * sizeof((list_next(&amp;(vm)-&gt;global_link)) - &amp;((typeof(*(vm)) *)(((char *)(list_next(&amp;(vm)-&gt;global_link))) - __builtin_offsetof(typeof(*(vm)), global_link)))-&gt;global_link))))" data-ref="_M/list_for_each_entry">list_for_each_entry</a>(<a class="local col8 ref" href="#678vm" title='vm' data-ref="678vm" data-ref-filename="678vm">vm</a>, &amp;<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::vm_list" title='drm_i915_private::vm_list' data-ref="drm_i915_private::vm_list" data-ref-filename="drm_i915_private..vm_list">vm_list</a>, <a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::global_link" title='i915_address_space::global_link' data-ref="i915_address_space::global_link" data-ref-filename="i915_address_space..global_link">global_link</a>) {</td></tr>
<tr><th id="3581">3581</th><td>			<i>/* TODO: Perhaps it shouldn't be gen6 specific */</i></td></tr>
<tr><th id="3582">3582</th><td></td></tr>
<tr><th id="3583">3583</th><td>			<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a> *<dfn class="local col1 decl" id="681ppgtt" title='ppgtt' data-type='struct i915_hw_ppgtt *' data-ref="681ppgtt" data-ref-filename="681ppgtt">ppgtt</dfn> =</td></tr>
<tr><th id="3584">3584</th><td>					<a class="macro" href="../../../../../../lib/libkern/libkern.h.html#351" title="((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)) + (0 * sizeof((vm) - &amp;((struct i915_hw_ppgtt *)(((char *)(vm)) - __builtin_offsetof(struct i915_hw_ppgtt, base)))-&gt;base)))" data-ref="_M/container_of">container_of</a>(<a class="local col8 ref" href="#678vm" title='vm' data-ref="678vm" data-ref-filename="678vm">vm</a>, <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_hw_ppgtt" title='i915_hw_ppgtt' data-ref="i915_hw_ppgtt" data-ref-filename="i915_hw_ppgtt">i915_hw_ppgtt</a>,</td></tr>
<tr><th id="3585">3585</th><td>						     <a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>);</td></tr>
<tr><th id="3586">3586</th><td></td></tr>
<tr><th id="3587">3587</th><td>			<b>if</b> (<a class="ref fn" href="i915_drv.h.html#i915_is_ggtt" title='i915_is_ggtt' data-ref="i915_is_ggtt" data-ref-filename="i915_is_ggtt">i915_is_ggtt</a>(<a class="local col8 ref" href="#678vm" title='vm' data-ref="678vm" data-ref-filename="678vm">vm</a>))</td></tr>
<tr><th id="3588">3588</th><td>				<a class="local col1 ref" href="#681ppgtt" title='ppgtt' data-ref="681ppgtt" data-ref-filename="681ppgtt">ppgtt</a> = <a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::mm" title='drm_i915_private::mm' data-ref="drm_i915_private::mm" data-ref-filename="drm_i915_private..mm">mm</a>.<a class="ref field" href="i915_drv.h.html#i915_gem_mm::aliasing_ppgtt" title='i915_gem_mm::aliasing_ppgtt' data-ref="i915_gem_mm::aliasing_ppgtt" data-ref-filename="i915_gem_mm..aliasing_ppgtt">aliasing_ppgtt</a>;</td></tr>
<tr><th id="3589">3589</th><td></td></tr>
<tr><th id="3590">3590</th><td>			<a class="tu ref fn" href="#gen6_write_page_range" title='gen6_write_page_range' data-use='c' data-ref="gen6_write_page_range" data-ref-filename="gen6_write_page_range">gen6_write_page_range</a>(<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>, &amp;<a class="local col1 ref" href="#681ppgtt" title='ppgtt' data-ref="681ppgtt" data-ref-filename="681ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::(anonymous)::pd" title='i915_hw_ppgtt::(anonymous union)::pd' data-ref="i915_hw_ppgtt::(anonymous)::pd" data-ref-filename="i915_hw_ppgtt..(anonymous)..pd">pd</a>,</td></tr>
<tr><th id="3591">3591</th><td>					      <var>0</var>, <a class="local col1 ref" href="#681ppgtt" title='ppgtt' data-ref="681ppgtt" data-ref-filename="681ppgtt">ppgtt</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_hw_ppgtt::base" title='i915_hw_ppgtt::base' data-ref="i915_hw_ppgtt::base" data-ref-filename="i915_hw_ppgtt..base">base</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::total" title='i915_address_space::total' data-ref="i915_address_space::total" data-ref-filename="i915_address_space..total">total</a>);</td></tr>
<tr><th id="3592">3592</th><td>		}</td></tr>
<tr><th id="3593">3593</th><td>	}</td></tr>
<tr><th id="3594">3594</th><td></td></tr>
<tr><th id="3595">3595</th><td>	<a class="tu ref fn" href="#i915_ggtt_flush" title='i915_ggtt_flush' data-use='c' data-ref="i915_ggtt_flush" data-ref-filename="i915_ggtt_flush">i915_ggtt_flush</a>(<a class="local col6 ref" href="#676dev_priv" title='dev_priv' data-ref="676dev_priv" data-ref-filename="676dev_priv">dev_priv</a>);</td></tr>
<tr><th id="3596">3596</th><td>}</td></tr>
<tr><th id="3597">3597</th><td></td></tr>
<tr><th id="3598">3598</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *</td></tr>
<tr><th id="3599">3599</th><td><dfn class="tu decl def fn" id="__i915_gem_vma_create" title='__i915_gem_vma_create' data-type='struct i915_vma * __i915_gem_vma_create(struct drm_i915_gem_object * obj, struct i915_address_space * vm, const struct i915_ggtt_view * ggtt_view)' data-ref="__i915_gem_vma_create" data-ref-filename="__i915_gem_vma_create">__i915_gem_vma_create</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col2 decl" id="682obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="682obj" data-ref-filename="682obj">obj</dfn>,</td></tr>
<tr><th id="3600">3600</th><td>		      <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col3 decl" id="683vm" title='vm' data-type='struct i915_address_space *' data-ref="683vm" data-ref-filename="683vm">vm</dfn>,</td></tr>
<tr><th id="3601">3601</th><td>		      <em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> *<dfn class="local col4 decl" id="684ggtt_view" title='ggtt_view' data-type='const struct i915_ggtt_view *' data-ref="684ggtt_view" data-ref-filename="684ggtt_view">ggtt_view</dfn>)</td></tr>
<tr><th id="3602">3602</th><td>{</td></tr>
<tr><th id="3603">3603</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col5 decl" id="685vma" title='vma' data-type='struct i915_vma *' data-ref="685vma" data-ref-filename="685vma">vma</dfn>;</td></tr>
<tr><th id="3604">3604</th><td></td></tr>
<tr><th id="3605">3605</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((i915_is_ggtt(vm) != !!ggtt_view))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3605, &quot;i915_is_ggtt(vm) != !!ggtt_view&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="ref fn" href="i915_drv.h.html#i915_is_ggtt" title='i915_is_ggtt' data-ref="i915_is_ggtt" data-ref-filename="i915_is_ggtt">i915_is_ggtt</a>(<a class="local col3 ref" href="#683vm" title='vm' data-ref="683vm" data-ref-filename="683vm">vm</a>) != !!<a class="local col4 ref" href="#684ggtt_view" title='ggtt_view' data-ref="684ggtt_view" data-ref-filename="684ggtt_view">ggtt_view</a>))</td></tr>
<tr><th id="3606">3606</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="3607">3607</th><td></td></tr>
<tr><th id="3608">3608</th><td>	<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a> = <a class="ref fn" href="../../../../common/include/linux/slab.h.html#kmem_cache_zalloc" title='kmem_cache_zalloc' data-ref="kmem_cache_zalloc" data-ref-filename="kmem_cache_zalloc">kmem_cache_zalloc</a>(<a class="ref fn" href="i915_drv.h.html#to_i915" title='to_i915' data-ref="to_i915" data-ref-filename="to_i915">to_i915</a>(<a class="local col2 ref" href="#682obj" title='obj' data-ref="682obj" data-ref-filename="682obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::dev" title='drm_gem_object::dev' data-ref="drm_gem_object::dev" data-ref-filename="drm_gem_object..dev">dev</a>)-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_private::vmas" title='drm_i915_private::vmas' data-ref="drm_i915_private::vmas" data-ref-filename="drm_i915_private..vmas">vmas</a>, <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3609">3609</th><td>	<b>if</b> (<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a> == <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="3610">3610</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>);</td></tr>
<tr><th id="3611">3611</th><td></td></tr>
<tr><th id="3612">3612</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vma_link" title='i915_vma::vma_link' data-ref="i915_vma::vma_link" data-ref-filename="i915_vma..vma_link">vma_link</a>);</td></tr>
<tr><th id="3613">3613</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::mm_list" title='i915_vma::mm_list' data-ref="i915_vma::mm_list" data-ref-filename="i915_vma..mm_list">mm_list</a>);</td></tr>
<tr><th id="3614">3614</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#INIT_LIST_HEAD" title='INIT_LIST_HEAD' data-ref="INIT_LIST_HEAD" data-ref-filename="INIT_LIST_HEAD">INIT_LIST_HEAD</a>(&amp;<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::exec_list" title='i915_vma::exec_list' data-ref="i915_vma::exec_list" data-ref-filename="i915_vma..exec_list">exec_list</a>);</td></tr>
<tr><th id="3615">3615</th><td>	<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a> = <a class="local col3 ref" href="#683vm" title='vm' data-ref="683vm" data-ref-filename="683vm">vm</a>;</td></tr>
<tr><th id="3616">3616</th><td>	<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a> = <a class="local col2 ref" href="#682obj" title='obj' data-ref="682obj" data-ref-filename="682obj">obj</a>;</td></tr>
<tr><th id="3617">3617</th><td></td></tr>
<tr><th id="3618">3618</th><td>	<b>if</b> (<a class="ref fn" href="i915_drv.h.html#i915_is_ggtt" title='i915_is_ggtt' data-ref="i915_is_ggtt" data-ref-filename="i915_is_ggtt">i915_is_ggtt</a>(<a class="local col3 ref" href="#683vm" title='vm' data-ref="683vm" data-ref-filename="683vm">vm</a>))</td></tr>
<tr><th id="3619">3619</th><td>		<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a> = *<a class="local col4 ref" href="#684ggtt_view" title='ggtt_view' data-ref="684ggtt_view" data-ref-filename="684ggtt_view">ggtt_view</a>;</td></tr>
<tr><th id="3620">3620</th><td></td></tr>
<tr><th id="3621">3621</th><td>	<a class="ref fn" href="../../../../common/include/linux/list.h.html#list_add_tail" title='list_add_tail' data-ref="list_add_tail" data-ref-filename="list_add_tail">list_add_tail</a>(&amp;<a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vma_link" title='i915_vma::vma_link' data-ref="i915_vma::vma_link" data-ref-filename="i915_vma..vma_link">vma_link</a>, &amp;<a class="local col2 ref" href="#682obj" title='obj' data-ref="682obj" data-ref-filename="682obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::vma_list" title='drm_i915_gem_object::vma_list' data-ref="drm_i915_gem_object::vma_list" data-ref-filename="drm_i915_gem_object..vma_list">vma_list</a>);</td></tr>
<tr><th id="3622">3622</th><td>	<b>if</b> (!<a class="ref fn" href="i915_drv.h.html#i915_is_ggtt" title='i915_is_ggtt' data-ref="i915_is_ggtt" data-ref-filename="i915_is_ggtt">i915_is_ggtt</a>(<a class="local col3 ref" href="#683vm" title='vm' data-ref="683vm" data-ref-filename="683vm">vm</a>))</td></tr>
<tr><th id="3623">3623</th><td>		<a class="ref fn" href="i915_gem_gtt.h.html#i915_ppgtt_get" title='i915_ppgtt_get' data-ref="i915_ppgtt_get" data-ref-filename="i915_ppgtt_get">i915_ppgtt_get</a>(<a class="ref fn" href="i915_drv.h.html#i915_vm_to_ppgtt" title='i915_vm_to_ppgtt' data-ref="i915_vm_to_ppgtt" data-ref-filename="i915_vm_to_ppgtt">i915_vm_to_ppgtt</a>(<a class="local col3 ref" href="#683vm" title='vm' data-ref="683vm" data-ref-filename="683vm">vm</a>));</td></tr>
<tr><th id="3624">3624</th><td></td></tr>
<tr><th id="3625">3625</th><td>	<b>return</b> <a class="local col5 ref" href="#685vma" title='vma' data-ref="685vma" data-ref-filename="685vma">vma</a>;</td></tr>
<tr><th id="3626">3626</th><td>}</td></tr>
<tr><th id="3627">3627</th><td></td></tr>
<tr><th id="3628">3628</th><td><b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *</td></tr>
<tr><th id="3629">3629</th><td><dfn class="decl def fn" id="i915_gem_obj_lookup_or_create_vma" title='i915_gem_obj_lookup_or_create_vma' data-ref="i915_gem_obj_lookup_or_create_vma" data-ref-filename="i915_gem_obj_lookup_or_create_vma">i915_gem_obj_lookup_or_create_vma</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col6 decl" id="686obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="686obj" data-ref-filename="686obj">obj</dfn>,</td></tr>
<tr><th id="3630">3630</th><td>				  <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col7 decl" id="687vm" title='vm' data-type='struct i915_address_space *' data-ref="687vm" data-ref-filename="687vm">vm</dfn>)</td></tr>
<tr><th id="3631">3631</th><td>{</td></tr>
<tr><th id="3632">3632</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col8 decl" id="688vma" title='vma' data-type='struct i915_vma *' data-ref="688vma" data-ref-filename="688vma">vma</dfn>;</td></tr>
<tr><th id="3633">3633</th><td></td></tr>
<tr><th id="3634">3634</th><td>	<a class="local col8 ref" href="#688vma" title='vma' data-ref="688vma" data-ref-filename="688vma">vma</a> = <a class="ref fn" href="i915_drv.h.html#i915_gem_obj_to_vma" title='i915_gem_obj_to_vma' data-ref="i915_gem_obj_to_vma" data-ref-filename="i915_gem_obj_to_vma">i915_gem_obj_to_vma</a>(<a class="local col6 ref" href="#686obj" title='obj' data-ref="686obj" data-ref-filename="686obj">obj</a>, <a class="local col7 ref" href="#687vm" title='vm' data-ref="687vm" data-ref-filename="687vm">vm</a>);</td></tr>
<tr><th id="3635">3635</th><td>	<b>if</b> (!<a class="local col8 ref" href="#688vma" title='vma' data-ref="688vma" data-ref-filename="688vma">vma</a>)</td></tr>
<tr><th id="3636">3636</th><td>		<a class="local col8 ref" href="#688vma" title='vma' data-ref="688vma" data-ref-filename="688vma">vma</a> = <a class="tu ref fn" href="#__i915_gem_vma_create" title='__i915_gem_vma_create' data-use='c' data-ref="__i915_gem_vma_create" data-ref-filename="__i915_gem_vma_create">__i915_gem_vma_create</a>(<a class="local col6 ref" href="#686obj" title='obj' data-ref="686obj" data-ref-filename="686obj">obj</a>, <a class="local col7 ref" href="#687vm" title='vm' data-ref="687vm" data-ref-filename="687vm">vm</a>,</td></tr>
<tr><th id="3637">3637</th><td>					    <a class="ref fn" href="i915_drv.h.html#i915_is_ggtt" title='i915_is_ggtt' data-ref="i915_is_ggtt" data-ref-filename="i915_is_ggtt">i915_is_ggtt</a>(<a class="local col7 ref" href="#687vm" title='vm' data-ref="687vm" data-ref-filename="687vm">vm</a>) ? &amp;<a class="ref" href="i915_gem_gtt.h.html#i915_ggtt_view_normal" title='i915_ggtt_view_normal' data-ref="i915_ggtt_view_normal" data-ref-filename="i915_ggtt_view_normal">i915_ggtt_view_normal</a> : <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3638">3638</th><td></td></tr>
<tr><th id="3639">3639</th><td>	<b>return</b> <a class="local col8 ref" href="#688vma" title='vma' data-ref="688vma" data-ref-filename="688vma">vma</a>;</td></tr>
<tr><th id="3640">3640</th><td>}</td></tr>
<tr><th id="3641">3641</th><td></td></tr>
<tr><th id="3642">3642</th><td><b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *</td></tr>
<tr><th id="3643">3643</th><td><dfn class="decl def fn" id="i915_gem_obj_lookup_or_create_ggtt_vma" title='i915_gem_obj_lookup_or_create_ggtt_vma' data-ref="i915_gem_obj_lookup_or_create_ggtt_vma" data-ref-filename="i915_gem_obj_lookup_or_create_ggtt_vma">i915_gem_obj_lookup_or_create_ggtt_vma</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col9 decl" id="689obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="689obj" data-ref-filename="689obj">obj</dfn>,</td></tr>
<tr><th id="3644">3644</th><td>				       <em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> *<dfn class="local col0 decl" id="690view" title='view' data-type='const struct i915_ggtt_view *' data-ref="690view" data-ref-filename="690view">view</dfn>)</td></tr>
<tr><th id="3645">3645</th><td>{</td></tr>
<tr><th id="3646">3646</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_address_space" title='i915_address_space' data-ref="i915_address_space" data-ref-filename="i915_address_space">i915_address_space</a> *<dfn class="local col1 decl" id="691ggtt" title='ggtt' data-type='struct i915_address_space *' data-ref="691ggtt" data-ref-filename="691ggtt">ggtt</dfn> = <a class="macro" href="i915_drv.h.html#3227" title="(&amp;((struct drm_i915_private *)(obj)-&gt;base.dev-&gt;dev_private)-&gt;gtt.base)" data-ref="_M/i915_obj_to_ggtt">i915_obj_to_ggtt</a>(obj);</td></tr>
<tr><th id="3647">3647</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col2 decl" id="692vma" title='vma' data-type='struct i915_vma *' data-ref="692vma" data-ref-filename="692vma">vma</dfn>;</td></tr>
<tr><th id="3648">3648</th><td></td></tr>
<tr><th id="3649">3649</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((!view))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3649, &quot;!view&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(!<a class="local col0 ref" href="#690view" title='view' data-ref="690view" data-ref-filename="690view">view</a>))</td></tr>
<tr><th id="3650">3650</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(-<a class="macro" href="../../../../../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>);</td></tr>
<tr><th id="3651">3651</th><td></td></tr>
<tr><th id="3652">3652</th><td>	<a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a> = <a class="ref fn" href="i915_drv.h.html#i915_gem_obj_to_ggtt_view" title='i915_gem_obj_to_ggtt_view' data-ref="i915_gem_obj_to_ggtt_view" data-ref-filename="i915_gem_obj_to_ggtt_view">i915_gem_obj_to_ggtt_view</a>(<a class="local col9 ref" href="#689obj" title='obj' data-ref="689obj" data-ref-filename="689obj">obj</a>, <a class="local col0 ref" href="#690view" title='view' data-ref="690view" data-ref-filename="690view">view</a>);</td></tr>
<tr><th id="3653">3653</th><td></td></tr>
<tr><th id="3654">3654</th><td>	<b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a>))</td></tr>
<tr><th id="3655">3655</th><td>		<b>return</b> <a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a>;</td></tr>
<tr><th id="3656">3656</th><td></td></tr>
<tr><th id="3657">3657</th><td>	<b>if</b> (!<a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a>)</td></tr>
<tr><th id="3658">3658</th><td>		<a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a> = <a class="tu ref fn" href="#__i915_gem_vma_create" title='__i915_gem_vma_create' data-use='c' data-ref="__i915_gem_vma_create" data-ref-filename="__i915_gem_vma_create">__i915_gem_vma_create</a>(<a class="local col9 ref" href="#689obj" title='obj' data-ref="689obj" data-ref-filename="689obj">obj</a>, <a class="local col1 ref" href="#691ggtt" title='ggtt' data-ref="691ggtt" data-ref-filename="691ggtt">ggtt</a>, <a class="local col0 ref" href="#690view" title='view' data-ref="690view" data-ref-filename="690view">view</a>);</td></tr>
<tr><th id="3659">3659</th><td></td></tr>
<tr><th id="3660">3660</th><td>	<b>return</b> <a class="local col2 ref" href="#692vma" title='vma' data-ref="692vma" data-ref-filename="692vma">vma</a>;</td></tr>
<tr><th id="3661">3661</th><td></td></tr>
<tr><th id="3662">3662</th><td>}</td></tr>
<tr><th id="3663">3663</th><td></td></tr>
<tr><th id="3664">3664</th><td><u>#<span data-ppcond="3664">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3665">3665</th><td><em>static</em> <b>struct</b> <a class="type" href="i915_drv.h.html#scatterlist" title='scatterlist' data-ref="scatterlist" data-ref-filename="scatterlist">scatterlist</a> *</td></tr>
<tr><th id="3666">3666</th><td><dfn class="tu decl def fn" id="rotate_pages" title='rotate_pages' data-type='struct scatterlist * rotate_pages(dma_addr_t * in, unsigned int offset, unsigned int width, unsigned int height, struct sg_table * st, struct scatterlist * sg)' data-ref="rotate_pages" data-ref-filename="rotate_pages">rotate_pages</dfn>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> *<dfn class="local col3 decl" id="693in" title='in' data-type='dma_addr_t *' data-ref="693in" data-ref-filename="693in">in</dfn>, <em>unsigned</em> <em>int</em> <dfn class="local col4 decl" id="694offset" title='offset' data-type='unsigned int' data-ref="694offset" data-ref-filename="694offset">offset</dfn>,</td></tr>
<tr><th id="3667">3667</th><td>	     <em>unsigned</em> <em>int</em> <dfn class="local col5 decl" id="695width" title='width' data-type='unsigned int' data-ref="695width" data-ref-filename="695width">width</dfn>, <em>unsigned</em> <em>int</em> <dfn class="local col6 decl" id="696height" title='height' data-type='unsigned int' data-ref="696height" data-ref-filename="696height">height</dfn>,</td></tr>
<tr><th id="3668">3668</th><td>	     <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col7 decl" id="697st" title='st' data-type='struct sg_table *' data-ref="697st" data-ref-filename="697st">st</dfn>, <b>struct</b> <a class="type" href="i915_drv.h.html#scatterlist" title='scatterlist' data-ref="scatterlist" data-ref-filename="scatterlist">scatterlist</a> *<dfn class="local col8 decl" id="698sg" title='sg' data-type='struct scatterlist *' data-ref="698sg" data-ref-filename="698sg">sg</dfn>)</td></tr>
<tr><th id="3669">3669</th><td>{</td></tr>
<tr><th id="3670">3670</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col9 decl" id="699column" title='column' data-type='unsigned int' data-ref="699column" data-ref-filename="699column">column</dfn>, <dfn class="local col0 decl" id="700row" title='row' data-type='unsigned int' data-ref="700row" data-ref-filename="700row">row</dfn>;</td></tr>
<tr><th id="3671">3671</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col1 decl" id="701src_idx" title='src_idx' data-type='unsigned int' data-ref="701src_idx" data-ref-filename="701src_idx">src_idx</dfn>;</td></tr>
<tr><th id="3672">3672</th><td></td></tr>
<tr><th id="3673">3673</th><td>	<b>if</b> (!<a class="local col8 ref" href="#698sg" title='sg' data-ref="698sg" data-ref-filename="698sg">sg</a>) {</td></tr>
<tr><th id="3674">3674</th><td>		st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents = <var>0</var>;</td></tr>
<tr><th id="3675">3675</th><td>		sg = st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl;</td></tr>
<tr><th id="3676">3676</th><td>	}</td></tr>
<tr><th id="3677">3677</th><td></td></tr>
<tr><th id="3678">3678</th><td>	<b>for</b> (<a class="local col9 ref" href="#699column" title='column' data-ref="699column" data-ref-filename="699column">column</a> = <var>0</var>; <a class="local col9 ref" href="#699column" title='column' data-ref="699column" data-ref-filename="699column">column</a> &lt; <a class="local col5 ref" href="#695width" title='width' data-ref="695width" data-ref-filename="695width">width</a>; <a class="local col9 ref" href="#699column" title='column' data-ref="699column" data-ref-filename="699column">column</a>++) {</td></tr>
<tr><th id="3679">3679</th><td>		<a class="local col1 ref" href="#701src_idx" title='src_idx' data-ref="701src_idx" data-ref-filename="701src_idx">src_idx</a> = <a class="local col5 ref" href="#695width" title='width' data-ref="695width" data-ref-filename="695width">width</a> * (<a class="local col6 ref" href="#696height" title='height' data-ref="696height" data-ref-filename="696height">height</a> - <var>1</var>) + <a class="local col9 ref" href="#699column" title='column' data-ref="699column" data-ref-filename="699column">column</a>;</td></tr>
<tr><th id="3680">3680</th><td>		<b>for</b> (<a class="local col0 ref" href="#700row" title='row' data-ref="700row" data-ref-filename="700row">row</a> = <var>0</var>; <a class="local col0 ref" href="#700row" title='row' data-ref="700row" data-ref-filename="700row">row</a> &lt; <a class="local col6 ref" href="#696height" title='height' data-ref="696height" data-ref-filename="696height">height</a>; <a class="local col0 ref" href="#700row" title='row' data-ref="700row" data-ref-filename="700row">row</a>++) {</td></tr>
<tr><th id="3681">3681</th><td>			st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents++;</td></tr>
<tr><th id="3682">3682</th><td>			<i>/* We don't need the pages, but need to initialize</i></td></tr>
<tr><th id="3683">3683</th><td><i>			 * the entries so the sg list can be happily traversed.</i></td></tr>
<tr><th id="3684">3684</th><td><i>			 * The only thing we need are DMA addresses.</i></td></tr>
<tr><th id="3685">3685</th><td><i>			 */</i></td></tr>
<tr><th id="3686">3686</th><td>			<a class="ref fn" href="#3686" title='sg_set_page' data-ref="sg_set_page" data-ref-filename="sg_set_page">sg_set_page</a>(<a class="local col8 ref" href="#698sg" title='sg' data-ref="698sg" data-ref-filename="698sg">sg</a>, <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <var>0</var>);</td></tr>
<tr><th id="3687">3687</th><td>			sg_dma_address(sg) <span class='error' title="expression is not assignable">=</span> in[offset + src_idx];</td></tr>
<tr><th id="3688">3688</th><td>			sg_dma_len(sg) <span class='error' title="expression is not assignable">=</span> <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>;</td></tr>
<tr><th id="3689">3689</th><td>			<a class="local col8 ref" href="#698sg" title='sg' data-ref="698sg" data-ref-filename="698sg">sg</a> = <a class="ref fn" href="#3689" title='sg_next' data-ref="sg_next" data-ref-filename="sg_next">sg_next</a>(<a class="local col8 ref" href="#698sg" title='sg' data-ref="698sg" data-ref-filename="698sg">sg</a>);</td></tr>
<tr><th id="3690">3690</th><td>			<a class="local col1 ref" href="#701src_idx" title='src_idx' data-ref="701src_idx" data-ref-filename="701src_idx">src_idx</a> -= <a class="local col5 ref" href="#695width" title='width' data-ref="695width" data-ref-filename="695width">width</a>;</td></tr>
<tr><th id="3691">3691</th><td>		}</td></tr>
<tr><th id="3692">3692</th><td>	}</td></tr>
<tr><th id="3693">3693</th><td></td></tr>
<tr><th id="3694">3694</th><td>	<b>return</b> <a class="local col8 ref" href="#698sg" title='sg' data-ref="698sg" data-ref-filename="698sg">sg</a>;</td></tr>
<tr><th id="3695">3695</th><td>}</td></tr>
<tr><th id="3696">3696</th><td></td></tr>
<tr><th id="3697">3697</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *</td></tr>
<tr><th id="3698">3698</th><td><dfn class="tu decl def fn" id="intel_rotate_fb_obj_pages" title='intel_rotate_fb_obj_pages' data-type='struct sg_table * intel_rotate_fb_obj_pages(struct i915_ggtt_view * ggtt_view, struct drm_i915_gem_object * obj)' data-ref="intel_rotate_fb_obj_pages" data-ref-filename="intel_rotate_fb_obj_pages">intel_rotate_fb_obj_pages</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> *<dfn class="local col2 decl" id="702ggtt_view" title='ggtt_view' data-type='struct i915_ggtt_view *' data-ref="702ggtt_view" data-ref-filename="702ggtt_view">ggtt_view</dfn>,</td></tr>
<tr><th id="3699">3699</th><td>			  <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col3 decl" id="703obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="703obj" data-ref-filename="703obj">obj</dfn>)</td></tr>
<tr><th id="3700">3700</th><td>{</td></tr>
<tr><th id="3701">3701</th><td>	<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#intel_rotation_info" title='intel_rotation_info' data-ref="intel_rotation_info" data-ref-filename="intel_rotation_info">intel_rotation_info</a> *<dfn class="local col4 decl" id="704rot_info" title='rot_info' data-type='struct intel_rotation_info *' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</dfn> = &amp;<a class="local col2 ref" href="#702ggtt_view" title='ggtt_view' data-ref="702ggtt_view" data-ref-filename="702ggtt_view">ggtt_view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymous)::rotation_info" title='i915_ggtt_view::(anonymous union)::rotation_info' data-ref="i915_ggtt_view::(anonymous)::rotation_info" data-ref-filename="i915_ggtt_view..(anonymous)..rotation_info">rotation_info</a>;</td></tr>
<tr><th id="3702">3702</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col5 decl" id="705size_pages" title='size_pages' data-type='unsigned int' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</dfn> = <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::size" title='intel_rotation_info::size' data-ref="intel_rotation_info::size" data-ref-filename="intel_rotation_info..size">size</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3703">3703</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col6 decl" id="706size_pages_uv" title='size_pages_uv' data-type='unsigned int' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</dfn>;</td></tr>
<tr><th id="3704">3704</th><td>	<b>struct</b> <dfn class="local col7 type" id="707sg_page_iter" title='sg_page_iter' data-ref="707sg_page_iter" data-ref-filename="707sg_page_iter"><a class="local col7 type" href="#707sg_page_iter" title='sg_page_iter' data-ref="707sg_page_iter" data-ref-filename="707sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col8 decl" id="708sg_iter" title='sg_iter' data-type='struct sg_page_iter' data-ref="708sg_iter" data-ref-filename="708sg_iter">sg_iter</dfn></span>;</td></tr>
<tr><th id="3705">3705</th><td>	<em>unsigned</em> <em>long</em> <dfn class="local col9 decl" id="709i" title='i' data-type='unsigned long' data-ref="709i" data-ref-filename="709i">i</dfn>;</td></tr>
<tr><th id="3706">3706</th><td>	<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a> *<dfn class="local col0 decl" id="710page_addr_list" title='page_addr_list' data-type='dma_addr_t *' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</dfn>;</td></tr>
<tr><th id="3707">3707</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col1 decl" id="711st" title='st' data-type='struct sg_table *' data-ref="711st" data-ref-filename="711st">st</dfn>;</td></tr>
<tr><th id="3708">3708</th><td>	<em>unsigned</em> <em>int</em> <dfn class="local col2 decl" id="712uv_start_page" title='uv_start_page' data-type='unsigned int' data-ref="712uv_start_page" data-ref-filename="712uv_start_page">uv_start_page</dfn>;</td></tr>
<tr><th id="3709">3709</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#scatterlist" title='scatterlist' data-ref="scatterlist" data-ref-filename="scatterlist">scatterlist</a> *<dfn class="local col3 decl" id="713sg" title='sg' data-type='struct scatterlist *' data-ref="713sg" data-ref-filename="713sg">sg</dfn>;</td></tr>
<tr><th id="3710">3710</th><td>	<em>int</em> <dfn class="local col4 decl" id="714ret" title='ret' data-type='int' data-ref="714ret" data-ref-filename="714ret">ret</dfn> = -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3711">3711</th><td></td></tr>
<tr><th id="3712">3712</th><td>	<i>/* Allocate a temporary list of source pages for random access. */</i></td></tr>
<tr><th id="3713">3713</th><td>	<a class="local col0 ref" href="#710page_addr_list" title='page_addr_list' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</a> = <a class="ref fn" href="../../../include/drm/drm_mem_util.h.html#drm_malloc_ab" title='drm_malloc_ab' data-ref="drm_malloc_ab" data-ref-filename="drm_malloc_ab">drm_malloc_ab</a>(<a class="local col3 ref" href="#703obj" title='obj' data-ref="703obj" data-ref-filename="703obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a> / <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>,</td></tr>
<tr><th id="3714">3714</th><td>				       <b>sizeof</b>(<a class="typedef" href="../../../include/linux/dma-mapping.h.html#dma_addr_t" title='dma_addr_t' data-type='bus_addr_t' data-ref="dma_addr_t" data-ref-filename="dma_addr_t">dma_addr_t</a>));</td></tr>
<tr><th id="3715">3715</th><td>	<b>if</b> (!<a class="local col0 ref" href="#710page_addr_list" title='page_addr_list' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</a>)</td></tr>
<tr><th id="3716">3716</th><td>		<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col4 ref" href="#714ret" title='ret' data-ref="714ret" data-ref-filename="714ret">ret</a>);</td></tr>
<tr><th id="3717">3717</th><td></td></tr>
<tr><th id="3718">3718</th><td>	<i>/* Account for UV plane with NV12. */</i></td></tr>
<tr><th id="3719">3719</th><td>	<b>if</b> (<a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pixel_format" title='intel_rotation_info::pixel_format' data-ref="intel_rotation_info::pixel_format" data-ref-filename="intel_rotation_info..pixel_format">pixel_format</a> == <a class="macro" href="../../uapi/drm/drm_fourcc.h.html#114" title="((__u32)(&apos;N&apos;) | ((__u32)(&apos;V&apos;) &lt;&lt; 8) | ((__u32)(&apos;1&apos;) &lt;&lt; 16) | ((__u32)(&apos;2&apos;) &lt;&lt; 24))" data-ref="_M/DRM_FORMAT_NV12">DRM_FORMAT_NV12</a>)</td></tr>
<tr><th id="3720">3720</th><td>		<a class="local col6 ref" href="#706size_pages_uv" title='size_pages_uv' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</a> = <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::size_uv" title='intel_rotation_info::size_uv' data-ref="intel_rotation_info::size_uv" data-ref-filename="intel_rotation_info..size_uv">size_uv</a> &gt;&gt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3721">3721</th><td>	<b>else</b></td></tr>
<tr><th id="3722">3722</th><td>		<a class="local col6 ref" href="#706size_pages_uv" title='size_pages_uv' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</a> = <var>0</var>;</td></tr>
<tr><th id="3723">3723</th><td></td></tr>
<tr><th id="3724">3724</th><td>	<i>/* Allocate target SG list. */</i></td></tr>
<tr><th id="3725">3725</th><td>	st = kmalloc(<b>sizeof</b><span class='error' title="invalid application of &apos;sizeof&apos; to an incomplete type &apos;struct sg_table&apos;">(</span>*st), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3726">3726</th><td>	<b>if</b> (!<a class="local col1 ref" href="#711st" title='st' data-ref="711st" data-ref-filename="711st">st</a>)</td></tr>
<tr><th id="3727">3727</th><td>		<b>goto</b> <a class="lbl" href="#715err_st_alloc" data-ref="715err_st_alloc" data-ref-filename="715err_st_alloc">err_st_alloc</a>;</td></tr>
<tr><th id="3728">3728</th><td></td></tr>
<tr><th id="3729">3729</th><td>	<a class="local col4 ref" href="#714ret" title='ret' data-ref="714ret" data-ref-filename="714ret">ret</a> = <a class="ref fn" href="#3729" title='sg_alloc_table' data-ref="sg_alloc_table" data-ref-filename="sg_alloc_table">sg_alloc_table</a>(<a class="local col1 ref" href="#711st" title='st' data-ref="711st" data-ref-filename="711st">st</a>, <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a> + <a class="local col6 ref" href="#706size_pages_uv" title='size_pages_uv' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</a>, <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3730">3730</th><td>	<b>if</b> (<a class="local col4 ref" href="#714ret" title='ret' data-ref="714ret" data-ref-filename="714ret">ret</a>)</td></tr>
<tr><th id="3731">3731</th><td>		<b>goto</b> <a class="lbl" href="#716err_sg_alloc" data-ref="716err_sg_alloc" data-ref-filename="716err_sg_alloc">err_sg_alloc</a>;</td></tr>
<tr><th id="3732">3732</th><td></td></tr>
<tr><th id="3733">3733</th><td>	<i>/* Populate source page list from the object. */</i></td></tr>
<tr><th id="3734">3734</th><td>	<a class="local col9 ref" href="#709i" title='i' data-ref="709i" data-ref-filename="709i">i</a> = <var>0</var>;</td></tr>
<tr><th id="3735">3735</th><td>	for_each_sg_page(obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, &amp;sg_iter, obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents, <var>0</var>) {</td></tr>
<tr><th id="3736">3736</th><td>		page_addr_list[i] = sg_page_iter_dma_address(&amp;sg_iter);</td></tr>
<tr><th id="3737">3737</th><td>		i++;</td></tr>
<tr><th id="3738">3738</th><td>	}</td></tr>
<tr><th id="3739">3739</th><td></td></tr>
<tr><th id="3740">3740</th><td>	<i>/* Rotate the pages. */</i></td></tr>
<tr><th id="3741">3741</th><td>	sg = rotate_pages(page_addr_list, <var>0</var>,</td></tr>
<tr><th id="3742">3742</th><td>		     rot_info-&gt;width_pages, rot_info-&gt;height_pages,</td></tr>
<tr><th id="3743">3743</th><td>		     st, <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>);</td></tr>
<tr><th id="3744">3744</th><td></td></tr>
<tr><th id="3745">3745</th><td>	<i>/* Append the UV plane if NV12. */</i></td></tr>
<tr><th id="3746">3746</th><td>	<b>if</b> (<a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pixel_format" title='intel_rotation_info::pixel_format' data-ref="intel_rotation_info::pixel_format" data-ref-filename="intel_rotation_info..pixel_format">pixel_format</a> == <a class="macro" href="../../uapi/drm/drm_fourcc.h.html#114" title="((__u32)(&apos;N&apos;) | ((__u32)(&apos;V&apos;) &lt;&lt; 8) | ((__u32)(&apos;1&apos;) &lt;&lt; 16) | ((__u32)(&apos;2&apos;) &lt;&lt; 24))" data-ref="_M/DRM_FORMAT_NV12">DRM_FORMAT_NV12</a>) {</td></tr>
<tr><th id="3747">3747</th><td>		<a class="local col2 ref" href="#712uv_start_page" title='uv_start_page' data-ref="712uv_start_page" data-ref-filename="712uv_start_page">uv_start_page</a> = <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a>;</td></tr>
<tr><th id="3748">3748</th><td></td></tr>
<tr><th id="3749">3749</th><td>		<i>/* Check for tile-row un-alignment. */</i></td></tr>
<tr><th id="3750">3750</th><td>		<b>if</b> (<a class="macro" href="../../../include/linux/mm.h.html#49" title="((rot_info-&gt;uv_offset) &amp; ((1 &lt;&lt; 12)-1))" data-ref="_M/offset_in_page">offset_in_page</a>(<a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::uv_offset" title='intel_rotation_info::uv_offset' data-ref="intel_rotation_info::uv_offset" data-ref-filename="intel_rotation_info..uv_offset">uv_offset</a>))</td></tr>
<tr><th id="3751">3751</th><td>			<a class="local col2 ref" href="#712uv_start_page" title='uv_start_page' data-ref="712uv_start_page" data-ref-filename="712uv_start_page">uv_start_page</a>--;</td></tr>
<tr><th id="3752">3752</th><td></td></tr>
<tr><th id="3753">3753</th><td>		<a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::uv_start_page" title='intel_rotation_info::uv_start_page' data-ref="intel_rotation_info::uv_start_page" data-ref-filename="intel_rotation_info..uv_start_page">uv_start_page</a> = <a class="local col2 ref" href="#712uv_start_page" title='uv_start_page' data-ref="712uv_start_page" data-ref-filename="712uv_start_page">uv_start_page</a>;</td></tr>
<tr><th id="3754">3754</th><td></td></tr>
<tr><th id="3755">3755</th><td>		<a class="tu ref fn" href="#rotate_pages" title='rotate_pages' data-use='c' data-ref="rotate_pages" data-ref-filename="rotate_pages">rotate_pages</a>(<a class="local col0 ref" href="#710page_addr_list" title='page_addr_list' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</a>, <a class="local col2 ref" href="#712uv_start_page" title='uv_start_page' data-ref="712uv_start_page" data-ref-filename="712uv_start_page">uv_start_page</a>,</td></tr>
<tr><th id="3756">3756</th><td>			     <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::width_pages_uv" title='intel_rotation_info::width_pages_uv' data-ref="intel_rotation_info::width_pages_uv" data-ref-filename="intel_rotation_info..width_pages_uv">width_pages_uv</a>,</td></tr>
<tr><th id="3757">3757</th><td>			     <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::height_pages_uv" title='intel_rotation_info::height_pages_uv' data-ref="intel_rotation_info::height_pages_uv" data-ref-filename="intel_rotation_info..height_pages_uv">height_pages_uv</a>,</td></tr>
<tr><th id="3758">3758</th><td>			     <a class="local col1 ref" href="#711st" title='st' data-ref="711st" data-ref-filename="711st">st</a>, <a class="local col3 ref" href="#713sg" title='sg' data-ref="713sg" data-ref-filename="713sg">sg</a>);</td></tr>
<tr><th id="3759">3759</th><td>	}</td></tr>
<tr><th id="3760">3760</th><td></td></tr>
<tr><th id="3761">3761</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#239" title="do { if (__builtin_expect((drm_debug &amp; 0x04) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Created rotated page mapping for object size %zu (pitch=%u, height=%u, pixel_format=0x%x, %ux%u tiles, %u pages (%u plane 0)).\n&quot;, obj-&gt;base.size, rot_info-&gt;pitch, rot_info-&gt;height, rot_info-&gt;pixel_format, rot_info-&gt;width_pages, rot_info-&gt;height_pages, size_pages + size_pages_uv, size_pages); } while (0)" data-ref="_M/DRM_DEBUG_KMS">DRM_DEBUG_KMS</a>(</td></tr>
<tr><th id="3762">3762</th><td>		      <q>"Created rotated page mapping for object size %zu (pitch=%u, height=%u, pixel_format=0x%x, %ux%u tiles, %u pages (%u plane 0)).\n"</q>,</td></tr>
<tr><th id="3763">3763</th><td>		      <a class="local col3 ref" href="#703obj" title='obj' data-ref="703obj" data-ref-filename="703obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pitch" title='intel_rotation_info::pitch' data-ref="intel_rotation_info::pitch" data-ref-filename="intel_rotation_info..pitch">pitch</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::height" title='intel_rotation_info::height' data-ref="intel_rotation_info::height" data-ref-filename="intel_rotation_info..height">height</a>,</td></tr>
<tr><th id="3764">3764</th><td>		      <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pixel_format" title='intel_rotation_info::pixel_format' data-ref="intel_rotation_info::pixel_format" data-ref-filename="intel_rotation_info..pixel_format">pixel_format</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::width_pages" title='intel_rotation_info::width_pages' data-ref="intel_rotation_info::width_pages" data-ref-filename="intel_rotation_info..width_pages">width_pages</a>,</td></tr>
<tr><th id="3765">3765</th><td>		      <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::height_pages" title='intel_rotation_info::height_pages' data-ref="intel_rotation_info::height_pages" data-ref-filename="intel_rotation_info..height_pages">height_pages</a>, <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a> + <a class="local col6 ref" href="#706size_pages_uv" title='size_pages_uv' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</a>,</td></tr>
<tr><th id="3766">3766</th><td>		      <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a>);</td></tr>
<tr><th id="3767">3767</th><td></td></tr>
<tr><th id="3768">3768</th><td>	<a class="ref fn" href="../../../include/drm/drm_mem_util.h.html#drm_free_large" title='drm_free_large' data-ref="drm_free_large" data-ref-filename="drm_free_large">drm_free_large</a>(<a class="local col0 ref" href="#710page_addr_list" title='page_addr_list' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</a>);</td></tr>
<tr><th id="3769">3769</th><td></td></tr>
<tr><th id="3770">3770</th><td>	<b>return</b> <a class="local col1 ref" href="#711st" title='st' data-ref="711st" data-ref-filename="711st">st</a>;</td></tr>
<tr><th id="3771">3771</th><td></td></tr>
<tr><th id="3772">3772</th><td><dfn class="lbl" id="716err_sg_alloc" data-ref="716err_sg_alloc" data-ref-filename="716err_sg_alloc">err_sg_alloc</dfn>:</td></tr>
<tr><th id="3773">3773</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col1 ref" href="#711st" title='st' data-ref="711st" data-ref-filename="711st">st</a>);</td></tr>
<tr><th id="3774">3774</th><td><dfn class="lbl" id="715err_st_alloc" data-ref="715err_st_alloc" data-ref-filename="715err_st_alloc">err_st_alloc</dfn>:</td></tr>
<tr><th id="3775">3775</th><td>	<a class="ref fn" href="../../../include/drm/drm_mem_util.h.html#drm_free_large" title='drm_free_large' data-ref="drm_free_large" data-ref-filename="drm_free_large">drm_free_large</a>(<a class="local col0 ref" href="#710page_addr_list" title='page_addr_list' data-ref="710page_addr_list" data-ref-filename="710page_addr_list">page_addr_list</a>);</td></tr>
<tr><th id="3776">3776</th><td></td></tr>
<tr><th id="3777">3777</th><td>	<a class="macro" href="../../include/drm/drmP.h.html#239" title="do { if (__builtin_expect((drm_debug &amp; 0x04) != 0, 0)) drm_ut_debug_printk(__func__, &quot;Failed to create rotated mapping for object size %zu! (%d) (pitch=%u, height=%u, pixel_format=0x%x, %ux%u tiles, %u pages (%u plane 0))\n&quot;, obj-&gt;base.size, ret, rot_info-&gt;pitch, rot_info-&gt;height, rot_info-&gt;pixel_format, rot_info-&gt;width_pages, rot_info-&gt;height_pages, size_pages + size_pages_uv, size_pages); } while (0)" data-ref="_M/DRM_DEBUG_KMS">DRM_DEBUG_KMS</a>(</td></tr>
<tr><th id="3778">3778</th><td>		      <q>"Failed to create rotated mapping for object size %zu! (%d) (pitch=%u, height=%u, pixel_format=0x%x, %ux%u tiles, %u pages (%u plane 0))\n"</q>,</td></tr>
<tr><th id="3779">3779</th><td>		      <a class="local col3 ref" href="#703obj" title='obj' data-ref="703obj" data-ref-filename="703obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>, <a class="local col4 ref" href="#714ret" title='ret' data-ref="714ret" data-ref-filename="714ret">ret</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pitch" title='intel_rotation_info::pitch' data-ref="intel_rotation_info::pitch" data-ref-filename="intel_rotation_info..pitch">pitch</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::height" title='intel_rotation_info::height' data-ref="intel_rotation_info::height" data-ref-filename="intel_rotation_info..height">height</a>,</td></tr>
<tr><th id="3780">3780</th><td>		      <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::pixel_format" title='intel_rotation_info::pixel_format' data-ref="intel_rotation_info::pixel_format" data-ref-filename="intel_rotation_info..pixel_format">pixel_format</a>, <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::width_pages" title='intel_rotation_info::width_pages' data-ref="intel_rotation_info::width_pages" data-ref-filename="intel_rotation_info..width_pages">width_pages</a>,</td></tr>
<tr><th id="3781">3781</th><td>		      <a class="local col4 ref" href="#704rot_info" title='rot_info' data-ref="704rot_info" data-ref-filename="704rot_info">rot_info</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::height_pages" title='intel_rotation_info::height_pages' data-ref="intel_rotation_info::height_pages" data-ref-filename="intel_rotation_info..height_pages">height_pages</a>, <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a> + <a class="local col6 ref" href="#706size_pages_uv" title='size_pages_uv' data-ref="706size_pages_uv" data-ref-filename="706size_pages_uv">size_pages_uv</a>,</td></tr>
<tr><th id="3782">3782</th><td>		      <a class="local col5 ref" href="#705size_pages" title='size_pages' data-ref="705size_pages" data-ref-filename="705size_pages">size_pages</a>);</td></tr>
<tr><th id="3783">3783</th><td>	<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col4 ref" href="#714ret" title='ret' data-ref="714ret" data-ref-filename="714ret">ret</a>);</td></tr>
<tr><th id="3784">3784</th><td>}</td></tr>
<tr><th id="3785">3785</th><td></td></tr>
<tr><th id="3786">3786</th><td><em>static</em> <b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *</td></tr>
<tr><th id="3787">3787</th><td><dfn class="tu decl def fn" id="intel_partial_pages" title='intel_partial_pages' data-type='struct sg_table * intel_partial_pages(const struct i915_ggtt_view * view, struct drm_i915_gem_object * obj)' data-ref="intel_partial_pages" data-ref-filename="intel_partial_pages">intel_partial_pages</dfn>(<em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> *<dfn class="local col7 decl" id="717view" title='view' data-type='const struct i915_ggtt_view *' data-ref="717view" data-ref-filename="717view">view</dfn>,</td></tr>
<tr><th id="3788">3788</th><td>		    <b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col8 decl" id="718obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="718obj" data-ref-filename="718obj">obj</dfn>)</td></tr>
<tr><th id="3789">3789</th><td>{</td></tr>
<tr><th id="3790">3790</th><td>	<b>struct</b> <a class="type" href="../../include/drm/drmP.h.html#sg_table" title='sg_table' data-ref="sg_table" data-ref-filename="sg_table">sg_table</a> *<dfn class="local col9 decl" id="719st" title='st' data-type='struct sg_table *' data-ref="719st" data-ref-filename="719st">st</dfn>;</td></tr>
<tr><th id="3791">3791</th><td>	<b>struct</b> <a class="type" href="i915_drv.h.html#scatterlist" title='scatterlist' data-ref="scatterlist" data-ref-filename="scatterlist">scatterlist</a> *<dfn class="local col0 decl" id="720sg" title='sg' data-type='struct scatterlist *' data-ref="720sg" data-ref-filename="720sg">sg</dfn>;</td></tr>
<tr><th id="3792">3792</th><td>	<b>struct</b> <dfn class="local col1 type" id="721sg_page_iter" title='sg_page_iter' data-ref="721sg_page_iter" data-ref-filename="721sg_page_iter"><a class="local col1 type" href="#721sg_page_iter" title='sg_page_iter' data-ref="721sg_page_iter" data-ref-filename="721sg_page_iter">sg_page_iter</a></dfn> <span class='error' title="variable has incomplete type &apos;struct sg_page_iter&apos;"><dfn class="local col2 decl" id="722obj_sg_iter" title='obj_sg_iter' data-type='struct sg_page_iter' data-ref="722obj_sg_iter" data-ref-filename="722obj_sg_iter">obj_sg_iter</dfn></span>;</td></tr>
<tr><th id="3793">3793</th><td>	<em>int</em> <dfn class="local col3 decl" id="723ret" title='ret' data-type='int' data-ref="723ret" data-ref-filename="723ret">ret</dfn> = -<a class="macro" href="../../../../../../sys/errno.h.html#54" title="12" data-ref="_M/ENOMEM">ENOMEM</a>;</td></tr>
<tr><th id="3794">3794</th><td></td></tr>
<tr><th id="3795">3795</th><td>	st = kmalloc(<b>sizeof</b><span class='error' title="invalid application of &apos;sizeof&apos; to an incomplete type &apos;struct sg_table&apos;">(</span>*st), <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3796">3796</th><td>	<b>if</b> (!<a class="local col9 ref" href="#719st" title='st' data-ref="719st" data-ref-filename="719st">st</a>)</td></tr>
<tr><th id="3797">3797</th><td>		<b>goto</b> <a class="lbl" href="#724err_st_alloc" data-ref="724err_st_alloc" data-ref-filename="724err_st_alloc">err_st_alloc</a>;</td></tr>
<tr><th id="3798">3798</th><td></td></tr>
<tr><th id="3799">3799</th><td>	<a class="local col3 ref" href="#723ret" title='ret' data-ref="723ret" data-ref-filename="723ret">ret</a> = <a class="ref fn" href="#3729" title='sg_alloc_table' data-ref="sg_alloc_table" data-ref-filename="sg_alloc_table">sg_alloc_table</a>(<a class="local col9 ref" href="#719st" title='st' data-ref="719st" data-ref-filename="719st">st</a>, <a class="local col7 ref" href="#717view" title='view' data-ref="717view" data-ref-filename="717view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::params" title='i915_ggtt_view::params' data-ref="i915_ggtt_view::params" data-ref-filename="i915_ggtt_view..params">params</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymous)::partial" title='i915_ggtt_view::(anonymous union)::partial' data-ref="i915_ggtt_view::(anonymous)::partial" data-ref-filename="i915_ggtt_view..(anonymous)..partial">partial</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymousunion)::(anonymous)::size" title='i915_ggtt_view::(anonymous union)::(anonymous struct)::size' data-ref="i915_ggtt_view::(anonymousunion)::(anonymous)::size" data-ref-filename="i915_ggtt_view..(anonymousunion)..(anonymous)..size">size</a>, <a class="macro" href="../../../../common/include/linux/gfp.h.html#46" title="((((uintmax_t)(2) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((2) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(6) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((6) &amp; (8 * sizeof(uintmax_t) - 1)))) | (((uintmax_t)(11) &gt;= 8 * sizeof(uintmax_t)) ? 0 : ((uintmax_t)1 &lt;&lt; (uintmax_t)((11) &amp; (8 * sizeof(uintmax_t) - 1)))))" data-ref="_M/GFP_KERNEL">GFP_KERNEL</a>);</td></tr>
<tr><th id="3800">3800</th><td>	<b>if</b> (<a class="local col3 ref" href="#723ret" title='ret' data-ref="723ret" data-ref-filename="723ret">ret</a>)</td></tr>
<tr><th id="3801">3801</th><td>		<b>goto</b> <a class="lbl" href="#725err_sg_alloc" data-ref="725err_sg_alloc" data-ref-filename="725err_sg_alloc">err_sg_alloc</a>;</td></tr>
<tr><th id="3802">3802</th><td></td></tr>
<tr><th id="3803">3803</th><td>	sg = st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl;</td></tr>
<tr><th id="3804">3804</th><td>	st<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents = <var>0</var>;</td></tr>
<tr><th id="3805">3805</th><td>	for_each_sg_page(obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>sgl, &amp;obj_sg_iter, obj-&gt;pages<span class='error' title="incomplete definition of type &apos;struct sg_table&apos;">-&gt;</span>nents,</td></tr>
<tr><th id="3806">3806</th><td>		view-&gt;params.partial.offset)</td></tr>
<tr><th id="3807">3807</th><td>	{</td></tr>
<tr><th id="3808">3808</th><td>		<b>if</b> (st-&gt;nents &gt;= view-&gt;params.partial.size)</td></tr>
<tr><th id="3809">3809</th><td>			<b>break</b>;</td></tr>
<tr><th id="3810">3810</th><td></td></tr>
<tr><th id="3811">3811</th><td>		sg_set_page(sg, <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>, <var>0</var>);</td></tr>
<tr><th id="3812">3812</th><td>		sg_dma_address(sg) = sg_page_iter_dma_address(&amp;obj_sg_iter);</td></tr>
<tr><th id="3813">3813</th><td>		sg_dma_len(sg) = <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#56" title="(1 &lt;&lt; 12)" data-ref="_M/PAGE_SIZE">PAGE_SIZE</a>;</td></tr>
<tr><th id="3814">3814</th><td></td></tr>
<tr><th id="3815">3815</th><td>		sg = sg_next(sg);</td></tr>
<tr><th id="3816">3816</th><td>		st-&gt;nents++;</td></tr>
<tr><th id="3817">3817</th><td>	}</td></tr>
<tr><th id="3818">3818</th><td></td></tr>
<tr><th id="3819">3819</th><td>	<b>return</b> st;</td></tr>
<tr><th id="3820">3820</th><td></td></tr>
<tr><th id="3821">3821</th><td><dfn class="lbl" id="725err_sg_alloc" data-ref="725err_sg_alloc" data-ref-filename="725err_sg_alloc">err_sg_alloc</dfn>:</td></tr>
<tr><th id="3822">3822</th><td>	<a class="ref fn" href="../../../../common/include/linux/slab.h.html#kfree" title='kfree' data-ref="kfree" data-ref-filename="kfree">kfree</a>(<a class="local col9 ref" href="#719st" title='st' data-ref="719st" data-ref-filename="719st">st</a>);</td></tr>
<tr><th id="3823">3823</th><td><dfn class="lbl" id="724err_st_alloc" data-ref="724err_st_alloc" data-ref-filename="724err_st_alloc">err_st_alloc</dfn>:</td></tr>
<tr><th id="3824">3824</th><td>	<b>return</b> <a class="ref fn" href="../../../../common/include/linux/err.h.html#ERR_PTR" title='ERR_PTR' data-ref="ERR_PTR" data-ref-filename="ERR_PTR">ERR_PTR</a>(<a class="local col3 ref" href="#723ret" title='ret' data-ref="723ret" data-ref-filename="723ret">ret</a>);</td></tr>
<tr><th id="3825">3825</th><td>}</td></tr>
<tr><th id="3826">3826</th><td><u>#<span data-ppcond="3664">endif</span></u></td></tr>
<tr><th id="3827">3827</th><td></td></tr>
<tr><th id="3828">3828</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="3829">3829</th><td><dfn class="tu decl def fn" id="i915_get_ggtt_vma_pages" title='i915_get_ggtt_vma_pages' data-type='int i915_get_ggtt_vma_pages(struct i915_vma * vma)' data-ref="i915_get_ggtt_vma_pages" data-ref-filename="i915_get_ggtt_vma_pages">i915_get_ggtt_vma_pages</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col6 decl" id="726vma" title='vma' data-type='struct i915_vma *' data-ref="726vma" data-ref-filename="726vma">vma</dfn>)</td></tr>
<tr><th id="3830">3830</th><td>{</td></tr>
<tr><th id="3831">3831</th><td>	<em>int</em> <dfn class="local col7 decl" id="727ret" title='ret' data-type='int' data-ref="727ret" data-ref-filename="727ret">ret</dfn> = <var>0</var>;</td></tr>
<tr><th id="3832">3832</th><td></td></tr>
<tr><th id="3833">3833</th><td>	<b>if</b> (<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>)</td></tr>
<tr><th id="3834">3834</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3835">3835</th><td></td></tr>
<tr><th id="3836">3836</th><td>	<b>if</b> (<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_NORMAL" title='I915_GGTT_VIEW_NORMAL' data-ref="I915_GGTT_VIEW_NORMAL" data-ref-filename="I915_GGTT_VIEW_NORMAL">I915_GGTT_VIEW_NORMAL</a>)</td></tr>
<tr><th id="3837">3837</th><td>		<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a> = <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::pages" title='drm_i915_gem_object::pages' data-ref="drm_i915_gem_object::pages" data-ref-filename="drm_i915_gem_object..pages">pages</a>;</td></tr>
<tr><th id="3838">3838</th><td><u>#<span data-ppcond="3838">ifndef</span> <span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span></u></td></tr>
<tr><th id="3839">3839</th><td>	<b>else</b> <b>if</b> (<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_ROTATED" title='I915_GGTT_VIEW_ROTATED' data-ref="I915_GGTT_VIEW_ROTATED" data-ref-filename="I915_GGTT_VIEW_ROTATED">I915_GGTT_VIEW_ROTATED</a>)</td></tr>
<tr><th id="3840">3840</th><td>		<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a> =</td></tr>
<tr><th id="3841">3841</th><td>			<a class="tu ref fn" href="#intel_rotate_fb_obj_pages" title='intel_rotate_fb_obj_pages' data-use='c' data-ref="intel_rotate_fb_obj_pages" data-ref-filename="intel_rotate_fb_obj_pages">intel_rotate_fb_obj_pages</a>(&amp;<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>, <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>);</td></tr>
<tr><th id="3842">3842</th><td>	<b>else</b> <b>if</b> (<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_PARTIAL" title='I915_GGTT_VIEW_PARTIAL' data-ref="I915_GGTT_VIEW_PARTIAL" data-ref-filename="I915_GGTT_VIEW_PARTIAL">I915_GGTT_VIEW_PARTIAL</a>)</td></tr>
<tr><th id="3843">3843</th><td>		<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a> =</td></tr>
<tr><th id="3844">3844</th><td>			<a class="tu ref fn" href="#intel_partial_pages" title='intel_partial_pages' data-use='c' data-ref="intel_partial_pages" data-ref-filename="intel_partial_pages">intel_partial_pages</a>(&amp;<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>, <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::obj" title='i915_vma::obj' data-ref="i915_vma::obj" data-ref-filename="i915_vma..obj">obj</a>);</td></tr>
<tr><th id="3845">3845</th><td><u>#<span data-ppcond="3838">endif</span></u></td></tr>
<tr><th id="3846">3846</th><td>	<b>else</b></td></tr>
<tr><th id="3847">3847</th><td>		<a class="macro" href="../../../include/asm/bug.h.html#53" title="linux_warning((1)? (printf(&quot;warning: %s:%d: &quot; &quot;GGTT view %u not implemented!\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3848, vma-&gt;ggtt_view.type), 1) : 0)" data-ref="_M/WARN_ONCE">WARN_ONCE</a>(<var>1</var>, <q>"GGTT view %u not implemented!\n"</q>,</td></tr>
<tr><th id="3848">3848</th><td>			  <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a>);</td></tr>
<tr><th id="3849">3849</th><td></td></tr>
<tr><th id="3850">3850</th><td>	<b>if</b> (!<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>) {</td></tr>
<tr><th id="3851">3851</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3852, __func__, &quot;Failed to get pages for GGTT view type %u!\n&quot;, vma-&gt;ggtt_view.type)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to get pages for GGTT view type %u!\n"</q>,</td></tr>
<tr><th id="3852">3852</th><td>			  <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a>);</td></tr>
<tr><th id="3853">3853</th><td>		<a class="local col7 ref" href="#727ret" title='ret' data-ref="727ret" data-ref-filename="727ret">ret</a> = -<a class="macro" href="../../../../../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="3854">3854</th><td>	} <b>else</b> <b>if</b> (<a class="ref fn" href="../../../../common/include/linux/err.h.html#IS_ERR" title='IS_ERR' data-ref="IS_ERR" data-ref-filename="IS_ERR">IS_ERR</a>(<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>)) {</td></tr>
<tr><th id="3855">3855</th><td>		<a class="local col7 ref" href="#727ret" title='ret' data-ref="727ret" data-ref-filename="727ret">ret</a> = <a class="ref fn" href="../../../../common/include/linux/err.h.html#PTR_ERR" title='PTR_ERR' data-ref="PTR_ERR" data-ref-filename="PTR_ERR">PTR_ERR</a>(<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a>);</td></tr>
<tr><th id="3856">3856</th><td>		<a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::pages" title='i915_ggtt_view::pages' data-ref="i915_ggtt_view::pages" data-ref-filename="i915_ggtt_view..pages">pages</a> = <a class="macro" href="../../../../../../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="3857">3857</th><td>		<a class="macro" href="../../include/drm/drmP.h.html#203" title="drm_err(&quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3858, __func__, &quot;Failed to get pages for VMA view type %u (%d)!\n&quot;, vma-&gt;ggtt_view.type, ret)" data-ref="_M/DRM_ERROR">DRM_ERROR</a>(<q>"Failed to get pages for VMA view type %u (%d)!\n"</q>,</td></tr>
<tr><th id="3858">3858</th><td>			  <a class="local col6 ref" href="#726vma" title='vma' data-ref="726vma" data-ref-filename="726vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::ggtt_view" title='i915_vma::ggtt_view' data-ref="i915_vma::ggtt_view" data-ref-filename="i915_vma..ggtt_view">ggtt_view</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a>, <a class="local col7 ref" href="#727ret" title='ret' data-ref="727ret" data-ref-filename="727ret">ret</a>);</td></tr>
<tr><th id="3859">3859</th><td>	}</td></tr>
<tr><th id="3860">3860</th><td></td></tr>
<tr><th id="3861">3861</th><td>	<b>return</b> <a class="local col7 ref" href="#727ret" title='ret' data-ref="727ret" data-ref-filename="727ret">ret</a>;</td></tr>
<tr><th id="3862">3862</th><td>}</td></tr>
<tr><th id="3863">3863</th><td></td></tr>
<tr><th id="3864">3864</th><td><i class="doc">/**</i></td></tr>
<tr><th id="3865">3865</th><td><i class="doc"> * i915_vma_bind - Sets up PTEs for an VMA in it's corresponding address space.</i></td></tr>
<tr><th id="3866">3866</th><td><i class="doc"> *<span class="command"> @vma</span>: VMA to map</i></td></tr>
<tr><th id="3867">3867</th><td><i class="doc"> *<span class="command"> @cache</span>_level: mapping cache level</i></td></tr>
<tr><th id="3868">3868</th><td><i class="doc"> *<span class="command"> @flags</span>: flags like global or local mapping</i></td></tr>
<tr><th id="3869">3869</th><td><i class="doc"> *</i></td></tr>
<tr><th id="3870">3870</th><td><i class="doc"> * DMA addresses are taken from the scatter-gather table of this object (or of</i></td></tr>
<tr><th id="3871">3871</th><td><i class="doc"> * this VMA in case of non-default GGTT views) and PTE entries set up.</i></td></tr>
<tr><th id="3872">3872</th><td><i class="doc"> * Note that DMA addresses are also the only part of the SG table we care about.</i></td></tr>
<tr><th id="3873">3873</th><td><i class="doc"> */</i></td></tr>
<tr><th id="3874">3874</th><td><em>int</em> <dfn class="decl def fn" id="i915_vma_bind" title='i915_vma_bind' data-ref="i915_vma_bind" data-ref-filename="i915_vma_bind">i915_vma_bind</dfn>(<b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_vma" title='i915_vma' data-ref="i915_vma" data-ref-filename="i915_vma">i915_vma</a> *<dfn class="local col8 decl" id="728vma" title='vma' data-type='struct i915_vma *' data-ref="728vma" data-ref-filename="728vma">vma</dfn>, <b>enum</b> <a class="type" href="i915_gem_gtt.h.html#i915_cache_level" title='i915_cache_level' data-ref="i915_cache_level" data-ref-filename="i915_cache_level">i915_cache_level</a> <dfn class="local col9 decl" id="729cache_level" title='cache_level' data-type='enum i915_cache_level' data-ref="729cache_level" data-ref-filename="729cache_level">cache_level</dfn>,</td></tr>
<tr><th id="3875">3875</th><td>		  <a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col0 decl" id="730flags" title='flags' data-type='u32' data-ref="730flags" data-ref-filename="730flags">flags</dfn>)</td></tr>
<tr><th id="3876">3876</th><td>{</td></tr>
<tr><th id="3877">3877</th><td>	<em>int</em> <dfn class="local col1 decl" id="731ret" title='ret' data-type='int' data-ref="731ret" data-ref-filename="731ret">ret</dfn>;</td></tr>
<tr><th id="3878">3878</th><td>	<a class="typedef" href="../../../include/linux/types.h.html#u32" title='u32' data-type='uint32_t' data-ref="u32" data-ref-filename="u32">u32</a> <dfn class="local col2 decl" id="732bind_flags" title='bind_flags' data-type='u32' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</dfn>;</td></tr>
<tr><th id="3879">3879</th><td></td></tr>
<tr><th id="3880">3880</th><td>	<b>if</b> (<a class="macro" href="i915_drv.h.html#87" title="linux_warning(((flags == 0))? (printf(&quot;warning: %s:%d: &quot; &quot;WARN_ON(%s)&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3880, &quot;flags == 0&quot;), 1) : 0)" data-ref="_M/WARN_ON">WARN_ON</a>(<a class="local col0 ref" href="#730flags" title='flags' data-ref="730flags" data-ref-filename="730flags">flags</a> == <var>0</var>))</td></tr>
<tr><th id="3881">3881</th><td>		<b>return</b> -<a class="macro" href="../../../../../../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>;</td></tr>
<tr><th id="3882">3882</th><td></td></tr>
<tr><th id="3883">3883</th><td>	<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> = <var>0</var>;</td></tr>
<tr><th id="3884">3884</th><td>	<b>if</b> (<a class="local col0 ref" href="#730flags" title='flags' data-ref="730flags" data-ref-filename="730flags">flags</a> &amp; <a class="macro" href="i915_drv.h.html#2948" title="(1&lt;&lt;2)" data-ref="_M/PIN_GLOBAL">PIN_GLOBAL</a>)</td></tr>
<tr><th id="3885">3885</th><td>		<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> |= <a class="macro" href="i915_gem_gtt.h.html#193" title="(1&lt;&lt;0)" data-ref="_M/GLOBAL_BIND">GLOBAL_BIND</a>;</td></tr>
<tr><th id="3886">3886</th><td>	<b>if</b> (<a class="local col0 ref" href="#730flags" title='flags' data-ref="730flags" data-ref-filename="730flags">flags</a> &amp; <a class="macro" href="i915_drv.h.html#2950" title="(1&lt;&lt;4)" data-ref="_M/PIN_USER">PIN_USER</a>)</td></tr>
<tr><th id="3887">3887</th><td>		<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> |= <a class="macro" href="i915_gem_gtt.h.html#194" title="(1&lt;&lt;1)" data-ref="_M/LOCAL_BIND">LOCAL_BIND</a>;</td></tr>
<tr><th id="3888">3888</th><td></td></tr>
<tr><th id="3889">3889</th><td>	<b>if</b> (<a class="local col0 ref" href="#730flags" title='flags' data-ref="730flags" data-ref-filename="730flags">flags</a> &amp; <a class="macro" href="i915_drv.h.html#2951" title="(1&lt;&lt;5)" data-ref="_M/PIN_UPDATE">PIN_UPDATE</a>)</td></tr>
<tr><th id="3890">3890</th><td>		<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> |= <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a>;</td></tr>
<tr><th id="3891">3891</th><td>	<b>else</b></td></tr>
<tr><th id="3892">3892</th><td>		<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> &amp;= ~<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a>;</td></tr>
<tr><th id="3893">3893</th><td></td></tr>
<tr><th id="3894">3894</th><td>	<b>if</b> (<a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a> == <var>0</var>)</td></tr>
<tr><th id="3895">3895</th><td>		<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3896">3896</th><td></td></tr>
<tr><th id="3897">3897</th><td>	<b>if</b> (<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> == <var>0</var> &amp;&amp; <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a>) {</td></tr>
<tr><th id="3898">3898</th><td>		<a class="ref fn" href="../../../include/i915_trace.h.html#trace_i915_va_alloc" title='trace_i915_va_alloc' data-ref="trace_i915_va_alloc" data-ref-filename="trace_i915_va_alloc">trace_i915_va_alloc</a>(<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>,</td></tr>
<tr><th id="3899">3899</th><td>				    <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="3900">3900</th><td>				    <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::size" title='drm_mm_node::size' data-ref="drm_mm_node::size" data-ref-filename="drm_mm_node..size">size</a>,</td></tr>
<tr><th id="3901">3901</th><td>				    <a class="macro" href="../../../include/i915_trace.h.html#397" title="(i915_is_ggtt(vma-&gt;vm) ? &quot;G&quot; : &quot;P&quot;)" data-ref="_M/VM_TO_TRACE_NAME">VM_TO_TRACE_NAME</a>(<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>));</td></tr>
<tr><th id="3902">3902</th><td></td></tr>
<tr><th id="3903">3903</th><td>		<i>/* XXX: i915_vma_pin() will fix this +- hack */</i></td></tr>
<tr><th id="3904">3904</th><td>		<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::pin_count" title='i915_vma::pin_count' data-ref="i915_vma::pin_count" data-ref-filename="i915_vma..pin_count">pin_count</a>++;</td></tr>
<tr><th id="3905">3905</th><td>		<a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a> = <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::allocate_va_range" title='i915_address_space::allocate_va_range' data-ref="i915_address_space::allocate_va_range" data-ref-filename="i915_address_space..allocate_va_range">allocate_va_range</a>(<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>,</td></tr>
<tr><th id="3906">3906</th><td>						 <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::start" title='drm_mm_node::start' data-ref="drm_mm_node::start" data-ref-filename="drm_mm_node..start">start</a>,</td></tr>
<tr><th id="3907">3907</th><td>						 <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::node" title='i915_vma::node' data-ref="i915_vma::node" data-ref-filename="i915_vma..node">node</a>.<a class="ref field" href="../../include/drm/drm_mm.h.html#drm_mm_node::size" title='drm_mm_node::size' data-ref="drm_mm_node::size" data-ref-filename="drm_mm_node..size">size</a>);</td></tr>
<tr><th id="3908">3908</th><td>		<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::pin_count" title='i915_vma::pin_count' data-ref="i915_vma::pin_count" data-ref-filename="i915_vma..pin_count">pin_count</a>--;</td></tr>
<tr><th id="3909">3909</th><td>		<b>if</b> (<a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a>)</td></tr>
<tr><th id="3910">3910</th><td>			<b>return</b> <a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a>;</td></tr>
<tr><th id="3911">3911</th><td>	}</td></tr>
<tr><th id="3912">3912</th><td></td></tr>
<tr><th id="3913">3913</th><td>	<a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a> = <a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::vm" title='i915_vma::vm' data-ref="i915_vma::vm" data-ref-filename="i915_vma..vm">vm</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_address_space::bind_vma" title='i915_address_space::bind_vma' data-ref="i915_address_space::bind_vma" data-ref-filename="i915_address_space..bind_vma">bind_vma</a>(<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>, <a class="local col9 ref" href="#729cache_level" title='cache_level' data-ref="729cache_level" data-ref-filename="729cache_level">cache_level</a>, <a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a>);</td></tr>
<tr><th id="3914">3914</th><td>	<b>if</b> (<a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a>)</td></tr>
<tr><th id="3915">3915</th><td>		<b>return</b> <a class="local col1 ref" href="#731ret" title='ret' data-ref="731ret" data-ref-filename="731ret">ret</a>;</td></tr>
<tr><th id="3916">3916</th><td></td></tr>
<tr><th id="3917">3917</th><td>	<a class="local col8 ref" href="#728vma" title='vma' data-ref="728vma" data-ref-filename="728vma">vma</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_vma::bound" title='i915_vma::bound' data-ref="i915_vma::bound" data-ref-filename="i915_vma..bound">bound</a> |= <a class="local col2 ref" href="#732bind_flags" title='bind_flags' data-ref="732bind_flags" data-ref-filename="732bind_flags">bind_flags</a>;</td></tr>
<tr><th id="3918">3918</th><td></td></tr>
<tr><th id="3919">3919</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="3920">3920</th><td>}</td></tr>
<tr><th id="3921">3921</th><td></td></tr>
<tr><th id="3922">3922</th><td><i class="doc">/**</i></td></tr>
<tr><th id="3923">3923</th><td><i class="doc"> * i915_ggtt_view_size - Get the size of a GGTT view.</i></td></tr>
<tr><th id="3924">3924</th><td><i class="doc"> *<span class="command"> @obj</span>: Object the view is of.</i></td></tr>
<tr><th id="3925">3925</th><td><i class="doc"> *<span class="command"> @view</span>: The view in question.</i></td></tr>
<tr><th id="3926">3926</th><td><i class="doc"> *</i></td></tr>
<tr><th id="3927">3927</th><td><i class="doc"> * <span class="command">@return</span> The size of the GGTT view in bytes.</i></td></tr>
<tr><th id="3928">3928</th><td><i class="doc"> */</i></td></tr>
<tr><th id="3929">3929</th><td><a class="typedef" href="../../../../../../sys/types.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a></td></tr>
<tr><th id="3930">3930</th><td><dfn class="decl def fn" id="i915_ggtt_view_size" title='i915_ggtt_view_size' data-ref="i915_ggtt_view_size" data-ref-filename="i915_ggtt_view_size">i915_ggtt_view_size</dfn>(<b>struct</b> <a class="type" href="i915_drv.h.html#drm_i915_gem_object" title='drm_i915_gem_object' data-ref="drm_i915_gem_object" data-ref-filename="drm_i915_gem_object">drm_i915_gem_object</a> *<dfn class="local col3 decl" id="733obj" title='obj' data-type='struct drm_i915_gem_object *' data-ref="733obj" data-ref-filename="733obj">obj</dfn>,</td></tr>
<tr><th id="3931">3931</th><td>		    <em>const</em> <b>struct</b> <a class="type" href="i915_gem_gtt.h.html#i915_ggtt_view" title='i915_ggtt_view' data-ref="i915_ggtt_view" data-ref-filename="i915_ggtt_view">i915_ggtt_view</a> *<dfn class="local col4 decl" id="734view" title='view' data-type='const struct i915_ggtt_view *' data-ref="734view" data-ref-filename="734view">view</dfn>)</td></tr>
<tr><th id="3932">3932</th><td>{</td></tr>
<tr><th id="3933">3933</th><td>	<b>if</b> (<a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_NORMAL" title='I915_GGTT_VIEW_NORMAL' data-ref="I915_GGTT_VIEW_NORMAL" data-ref-filename="I915_GGTT_VIEW_NORMAL">I915_GGTT_VIEW_NORMAL</a>) {</td></tr>
<tr><th id="3934">3934</th><td>		<b>return</b> <a class="local col3 ref" href="#733obj" title='obj' data-ref="733obj" data-ref-filename="733obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>;</td></tr>
<tr><th id="3935">3935</th><td>	} <b>else</b> <b>if</b> (<a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_ROTATED" title='I915_GGTT_VIEW_ROTATED' data-ref="I915_GGTT_VIEW_ROTATED" data-ref-filename="I915_GGTT_VIEW_ROTATED">I915_GGTT_VIEW_ROTATED</a>) {</td></tr>
<tr><th id="3936">3936</th><td>		<b>return</b> <a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymous)::rotation_info" title='i915_ggtt_view::(anonymous union)::rotation_info' data-ref="i915_ggtt_view::(anonymous)::rotation_info" data-ref-filename="i915_ggtt_view..(anonymous)..rotation_info">rotation_info</a>.<a class="ref field" href="i915_gem_gtt.h.html#intel_rotation_info::size" title='intel_rotation_info::size' data-ref="intel_rotation_info::size" data-ref-filename="intel_rotation_info..size">size</a>;</td></tr>
<tr><th id="3937">3937</th><td>	} <b>else</b> <b>if</b> (<a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a> == <a class="enum" href="i915_gem_gtt.h.html#I915_GGTT_VIEW_PARTIAL" title='I915_GGTT_VIEW_PARTIAL' data-ref="I915_GGTT_VIEW_PARTIAL" data-ref-filename="I915_GGTT_VIEW_PARTIAL">I915_GGTT_VIEW_PARTIAL</a>) {</td></tr>
<tr><th id="3938">3938</th><td>		<b>return</b> <a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::params" title='i915_ggtt_view::params' data-ref="i915_ggtt_view::params" data-ref-filename="i915_ggtt_view..params">params</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymous)::partial" title='i915_ggtt_view::(anonymous union)::partial' data-ref="i915_ggtt_view::(anonymous)::partial" data-ref-filename="i915_ggtt_view..(anonymous)..partial">partial</a>.<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::(anonymousunion)::(anonymous)::size" title='i915_ggtt_view::(anonymous union)::(anonymous struct)::size' data-ref="i915_ggtt_view::(anonymousunion)::(anonymous)::size" data-ref-filename="i915_ggtt_view..(anonymousunion)..(anonymous)..size">size</a> &lt;&lt; <a class="macro" href="../../../../../../arch/amd64/include/vmparam.h.html#55" title="12" data-ref="_M/PAGE_SHIFT">PAGE_SHIFT</a>;</td></tr>
<tr><th id="3939">3939</th><td>	} <b>else</b> {</td></tr>
<tr><th id="3940">3940</th><td>		<a class="macro" href="../../../include/asm/bug.h.html#53" title="linux_warning((1)? (printf(&quot;warning: %s:%d: &quot; &quot;GGTT view %u not implemented!\n&quot;, &quot;/___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/external/bsd/drm2/dist/drm/i915/i915_gem_gtt.c&quot;, 3940, view-&gt;type), 1) : 0)" data-ref="_M/WARN_ONCE">WARN_ONCE</a>(<var>1</var>, <q>"GGTT view %u not implemented!\n"</q>, <a class="local col4 ref" href="#734view" title='view' data-ref="734view" data-ref-filename="734view">view</a>-&gt;<a class="ref field" href="i915_gem_gtt.h.html#i915_ggtt_view::type" title='i915_ggtt_view::type' data-ref="i915_ggtt_view::type" data-ref-filename="i915_ggtt_view..type">type</a>);</td></tr>
<tr><th id="3941">3941</th><td>		<b>return</b> <a class="local col3 ref" href="#733obj" title='obj' data-ref="733obj" data-ref-filename="733obj">obj</a>-&gt;<a class="ref field" href="i915_drv.h.html#drm_i915_gem_object::base" title='drm_i915_gem_object::base' data-ref="drm_i915_gem_object::base" data-ref-filename="drm_i915_gem_object..base">base</a>.<a class="ref field" href="../../include/drm/drm_gem.h.html#drm_gem_object::size" title='drm_gem_object::size' data-ref="drm_gem_object::size" data-ref-filename="drm_gem_object..size">size</a>;</td></tr>
<tr><th id="3942">3942</th><td>	}</td></tr>
<tr><th id="3943">3943</th><td>}</td></tr>
<tr><th id="3944">3944</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
