<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ip6_forward.c source code [netbsd/sys/netinet6/ip6_forward.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/sys/netinet6/ip6_forward.c'; var root_path = '../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../..'>netbsd</a>/<a href='..'>sys</a>/<a href='./'>netinet6</a>/<a href='ip6_forward.c.html'>ip6_forward.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: ip6_forward.c,v 1.96 2019/05/13 07:47:59 ozaki-r Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td><i>/*	$KAME: ip6_forward.c,v 1.109 2002/09/11 08:10:17 sakane Exp $	*/</i></td></tr>
<tr><th id="3">3</th><td></td></tr>
<tr><th id="4">4</th><td><i>/*</i></td></tr>
<tr><th id="5">5</th><td><i> * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.</i></td></tr>
<tr><th id="6">6</th><td><i> * All rights reserved.</i></td></tr>
<tr><th id="7">7</th><td><i> *</i></td></tr>
<tr><th id="8">8</th><td><i> * Redistribution and use in source and binary forms, with or without</i></td></tr>
<tr><th id="9">9</th><td><i> * modification, are permitted provided that the following conditions</i></td></tr>
<tr><th id="10">10</th><td><i> * are met:</i></td></tr>
<tr><th id="11">11</th><td><i> * 1. Redistributions of source code must retain the above copyright</i></td></tr>
<tr><th id="12">12</th><td><i> *    notice, this list of conditions and the following disclaimer.</i></td></tr>
<tr><th id="13">13</th><td><i> * 2. Redistributions in binary form must reproduce the above copyright</i></td></tr>
<tr><th id="14">14</th><td><i> *    notice, this list of conditions and the following disclaimer in the</i></td></tr>
<tr><th id="15">15</th><td><i> *    documentation and/or other materials provided with the distribution.</i></td></tr>
<tr><th id="16">16</th><td><i> * 3. Neither the name of the project nor the names of its contributors</i></td></tr>
<tr><th id="17">17</th><td><i> *    may be used to endorse or promote products derived from this software</i></td></tr>
<tr><th id="18">18</th><td><i> *    without specific prior written permission.</i></td></tr>
<tr><th id="19">19</th><td><i> *</i></td></tr>
<tr><th id="20">20</th><td><i> * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND</i></td></tr>
<tr><th id="21">21</th><td><i> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</i></td></tr>
<tr><th id="22">22</th><td><i> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</i></td></tr>
<tr><th id="23">23</th><td><i> * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE</i></td></tr>
<tr><th id="24">24</th><td><i> * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</i></td></tr>
<tr><th id="25">25</th><td><i> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</i></td></tr>
<tr><th id="26">26</th><td><i> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</i></td></tr>
<tr><th id="27">27</th><td><i> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</i></td></tr>
<tr><th id="28">28</th><td><i> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</i></td></tr>
<tr><th id="29">29</th><td><i> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</i></td></tr>
<tr><th id="30">30</th><td><i> * SUCH DAMAGE.</i></td></tr>
<tr><th id="31">31</th><td><i> */</i></td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td><u>#include <a href="../sys/cdefs.h.html">&lt;sys/cdefs.h&gt;</a></u></td></tr>
<tr><th id="34">34</th><td><a class="macro" href="../sys/cdefs_elf.h.html#156" title="__asm(&quot;.pushsection &quot; &quot;.ident&quot; &quot;\n&quot; &quot;.asciz \&quot;&quot; &quot;$NetBSD: ip6_forward.c,v 1.96 2019/05/13 07:47:59 ozaki-r Exp $&quot; &quot;\&quot;\n&quot; &quot;.popsection&quot;)" data-ref="_M/__KERNEL_RCSID">__KERNEL_RCSID</a>(<var>0</var>, <q>"$NetBSD: ip6_forward.c,v 1.96 2019/05/13 07:47:59 ozaki-r Exp $"</q>);</td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><u>#<span data-ppcond="36">ifdef</span> <span class="macro" data-ref="_M/_KERNEL_OPT">_KERNEL_OPT</span></u></td></tr>
<tr><th id="37">37</th><td><u>#include <a href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_gateway.h.html">"opt_gateway.h"</a></u></td></tr>
<tr><th id="38">38</th><td><u>#include <a href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html">"opt_ipsec.h"</a></u></td></tr>
<tr><th id="39">39</th><td><u>#<span data-ppcond="36">endif</span></u></td></tr>
<tr><th id="40">40</th><td></td></tr>
<tr><th id="41">41</th><td><u>#include <a href="../sys/param.h.html">&lt;sys/param.h&gt;</a></u></td></tr>
<tr><th id="42">42</th><td><u>#include <a href="../sys/systm.h.html">&lt;sys/systm.h&gt;</a></u></td></tr>
<tr><th id="43">43</th><td><u>#include <a href="../sys/mbuf.h.html">&lt;sys/mbuf.h&gt;</a></u></td></tr>
<tr><th id="44">44</th><td><u>#include <a href="../sys/errno.h.html">&lt;sys/errno.h&gt;</a></u></td></tr>
<tr><th id="45">45</th><td><u>#include <a href="../sys/time.h.html">&lt;sys/time.h&gt;</a></u></td></tr>
<tr><th id="46">46</th><td><u>#include <a href="../sys/kernel.h.html">&lt;sys/kernel.h&gt;</a></u></td></tr>
<tr><th id="47">47</th><td><u>#include <a href="../sys/syslog.h.html">&lt;sys/syslog.h&gt;</a></u></td></tr>
<tr><th id="48">48</th><td><u>#include <a href="../sys/percpu.h.html">&lt;sys/percpu.h&gt;</a></u></td></tr>
<tr><th id="49">49</th><td></td></tr>
<tr><th id="50">50</th><td><u>#include <a href="../net/if.h.html">&lt;net/if.h&gt;</a></u></td></tr>
<tr><th id="51">51</th><td><u>#include <a href="../net/route.h.html">&lt;net/route.h&gt;</a></u></td></tr>
<tr><th id="52">52</th><td><u>#include <a href="../net/pfil.h.html">&lt;net/pfil.h&gt;</a></u></td></tr>
<tr><th id="53">53</th><td></td></tr>
<tr><th id="54">54</th><td><u>#include <a href="../netinet/in.h.html">&lt;netinet/in.h&gt;</a></u></td></tr>
<tr><th id="55">55</th><td><u>#include <a href="../netinet/in_var.h.html">&lt;netinet/in_var.h&gt;</a></u></td></tr>
<tr><th id="56">56</th><td><u>#include <a href="../netinet/ip_var.h.html">&lt;netinet/ip_var.h&gt;</a></u></td></tr>
<tr><th id="57">57</th><td><u>#include <a href="../netinet/ip6.h.html">&lt;netinet/ip6.h&gt;</a></u></td></tr>
<tr><th id="58">58</th><td><u>#include <a href="ip6_var.h.html">&lt;netinet6/ip6_var.h&gt;</a></u></td></tr>
<tr><th id="59">59</th><td><u>#include <a href="ip6_private.h.html">&lt;netinet6/ip6_private.h&gt;</a></u></td></tr>
<tr><th id="60">60</th><td><u>#include <a href="scope6_var.h.html">&lt;netinet6/scope6_var.h&gt;</a></u></td></tr>
<tr><th id="61">61</th><td><u>#include <a href="../netinet/icmp6.h.html">&lt;netinet/icmp6.h&gt;</a></u></td></tr>
<tr><th id="62">62</th><td><u>#include <a href="nd6.h.html">&lt;netinet6/nd6.h&gt;</a></u></td></tr>
<tr><th id="63">63</th><td></td></tr>
<tr><th id="64">64</th><td><u>#<span data-ppcond="64">ifdef</span> <a class="macro" href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html#1" data-ref="_M/IPSEC">IPSEC</a></u></td></tr>
<tr><th id="65">65</th><td><u>#include <a href="../netipsec/ipsec.h.html">&lt;netipsec/ipsec.h&gt;</a></u></td></tr>
<tr><th id="66">66</th><td><u>#include <a href="../netipsec/ipsec6.h.html">&lt;netipsec/ipsec6.h&gt;</a></u></td></tr>
<tr><th id="67">67</th><td><u>#include <a href="../netipsec/key.h.html">&lt;netipsec/key.h&gt;</a></u></td></tr>
<tr><th id="68">68</th><td><u>#<span data-ppcond="64">endif</span></u></td></tr>
<tr><th id="69">69</th><td></td></tr>
<tr><th id="70">70</th><td><b>extern</b> <a class="typedef" href="../sys/percpu_types.h.html#percpu_t" title='percpu_t' data-type='struct percpu' data-ref="percpu_t" data-ref-filename="percpu_t">percpu_t</a> *<dfn class="decl" id="ip6_forward_rt_percpu" title='ip6_forward_rt_percpu' data-ref="ip6_forward_rt_percpu" data-ref-filename="ip6_forward_rt_percpu">ip6_forward_rt_percpu</dfn>;</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><b>extern</b> <a class="typedef" href="../net/pfil.h.html#pfil_head_t" title='pfil_head_t' data-type='struct pfil_head' data-ref="pfil_head_t" data-ref-filename="pfil_head_t">pfil_head_t</a> *<dfn class="decl" id="inet6_pfil_hook" title='inet6_pfil_hook' data-ref="inet6_pfil_hook" data-ref-filename="inet6_pfil_hook">inet6_pfil_hook</dfn>;	<i>/* XXX */</i></td></tr>
<tr><th id="73">73</th><td></td></tr>
<tr><th id="74">74</th><td><em>static</em> <em>void</em> <a class="macro" href="../sys/cdefs.h.html#501" title="__attribute__((__format__ (__printf__, 4, 5)))" data-ref="_M/__printflike">__printflike</a>(<var>4</var>, <var>5</var>)</td></tr>
<tr><th id="75">75</th><td><dfn class="tu decl def fn" id="ip6_cantforward" title='ip6_cantforward' data-type='void ip6_cantforward(const struct ip6_hdr * ip6, const struct ifnet * srcifp, const struct ifnet * dstifp, const char * fmt)' data-ref="ip6_cantforward" data-ref-filename="ip6_cantforward">ip6_cantforward</dfn>(<em>const</em> <b>struct</b> <a class="type" href="../netinet/ip6.h.html#ip6_hdr" title='ip6_hdr' data-ref="ip6_hdr" data-ref-filename="ip6_hdr">ip6_hdr</a> *<dfn class="local col1 decl" id="1ip6" title='ip6' data-type='const struct ip6_hdr *' data-ref="1ip6" data-ref-filename="1ip6">ip6</dfn>, <em>const</em> <b>struct</b> <a class="type" href="../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col2 decl" id="2srcifp" title='srcifp' data-type='const struct ifnet *' data-ref="2srcifp" data-ref-filename="2srcifp">srcifp</dfn>,</td></tr>
<tr><th id="76">76</th><td>    <em>const</em> <b>struct</b> <a class="type" href="../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col3 decl" id="3dstifp" title='dstifp' data-type='const struct ifnet *' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</dfn>, <em>const</em> <em>char</em> *<dfn class="local col4 decl" id="4fmt" title='fmt' data-type='const char *' data-ref="4fmt" data-ref-filename="4fmt">fmt</dfn>, ...)</td></tr>
<tr><th id="77">77</th><td>{</td></tr>
<tr><th id="78">78</th><td>	<em>char</em> <dfn class="local col5 decl" id="5sbuf" title='sbuf' data-type='char [46]' data-ref="5sbuf" data-ref-filename="5sbuf">sbuf</dfn>[<a class="macro" href="in6.h.html#138" title="46" data-ref="_M/INET6_ADDRSTRLEN">INET6_ADDRSTRLEN</a>], <dfn class="local col6 decl" id="6dbuf" title='dbuf' data-type='char [46]' data-ref="6dbuf" data-ref-filename="6dbuf">dbuf</dfn>[<a class="macro" href="in6.h.html#138" title="46" data-ref="_M/INET6_ADDRSTRLEN">INET6_ADDRSTRLEN</a>];</td></tr>
<tr><th id="79">79</th><td>	<em>char</em> <dfn class="local col7 decl" id="7reason" title='reason' data-type='char [256]' data-ref="7reason" data-ref-filename="7reason">reason</dfn>[<var>256</var>];</td></tr>
<tr><th id="80">80</th><td>	<a class="typedef" href="../sys/stdarg.h.html#va_list" title='va_list' data-type='__va_list' data-ref="va_list" data-ref-filename="va_list">va_list</a> <dfn class="local col8 decl" id="8ap" title='ap' data-type='va_list' data-ref="8ap" data-ref-filename="8ap">ap</dfn>;</td></tr>
<tr><th id="81">81</th><td>	<a class="typedef" href="../sys/stdint.h.html#uint64_t" title='uint64_t' data-type='__uint64_t' data-ref="uint64_t" data-ref-filename="uint64_t">uint64_t</a> *<dfn class="local col9 decl" id="9ip6s" title='ip6s' data-type='uint64_t *' data-ref="9ip6s" data-ref-filename="9ip6s">ip6s</dfn>;</td></tr>
<tr><th id="82">82</th><td></td></tr>
<tr><th id="83">83</th><td>	<i>/* update statistics */</i></td></tr>
<tr><th id="84">84</th><td>	<a class="local col9 ref" href="#9ip6s" title='ip6s' data-ref="9ip6s" data-ref-filename="9ip6s">ip6s</a> = <a class="macro" href="ip6_private.h.html#40" title="((uint64_t *)percpu_getref((ip6stat_percpu)))" data-ref="_M/IP6_STAT_GETREF">IP6_STAT_GETREF</a>();</td></tr>
<tr><th id="85">85</th><td>	<a class="local col9 ref" href="#9ip6s" title='ip6s' data-ref="9ip6s" data-ref-filename="9ip6s">ip6s</a>[<a class="macro" href="ip6_var.h.html#135" title="8" data-ref="_M/IP6_STAT_CANTFORWARD">IP6_STAT_CANTFORWARD</a>]++;</td></tr>
<tr><th id="86">86</th><td>	<b>if</b> (<a class="local col3 ref" href="#3dstifp" title='dstifp' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</a>)</td></tr>
<tr><th id="87">87</th><td>		<a class="local col9 ref" href="#9ip6s" title='ip6s' data-ref="9ip6s" data-ref-filename="9ip6s">ip6s</a>[<a class="macro" href="ip6_var.h.html#148" title="21" data-ref="_M/IP6_STAT_BADSCOPE">IP6_STAT_BADSCOPE</a>]++;</td></tr>
<tr><th id="88">88</th><td>	<a class="macro" href="ip6_private.h.html#41" title="percpu_putref((ip6stat_percpu))" data-ref="_M/IP6_STAT_PUTREF">IP6_STAT_PUTREF</a>();</td></tr>
<tr><th id="89">89</th><td></td></tr>
<tr><th id="90">90</th><td>	<b>if</b> (<a class="local col3 ref" href="#3dstifp" title='dstifp' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</a>)</td></tr>
<tr><th id="91">91</th><td>		<a class="macro" href="in6_var.h.html#577" title="do { if (dstifp) ((struct in6_ifextra *)((dstifp)-&gt;if_afdata[24]))-&gt;in6_ifstat-&gt;ifs6_in_discard++; } while ( 0)" data-ref="_M/in6_ifstat_inc">in6_ifstat_inc</a>(<a class="local col3 ref" href="#3dstifp" title='dstifp' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</a>, <a class="ref field" href="in6_var.h.html#in6_ifstat::ifs6_in_discard" title='in6_ifstat::ifs6_in_discard' data-ref="in6_ifstat::ifs6_in_discard" data-ref-filename="in6_ifstat..ifs6_in_discard">ifs6_in_discard</a>);</td></tr>
<tr><th id="92">92</th><td></td></tr>
<tr><th id="93">93</th><td>	<b>if</b> (<a class="ref" href="ip6_var.h.html#ip6_log_time" title='ip6_log_time' data-ref="ip6_log_time" data-ref-filename="ip6_log_time">ip6_log_time</a> + <a class="ref" href="ip6_var.h.html#ip6_log_interval" title='ip6_log_interval' data-ref="ip6_log_interval" data-ref-filename="ip6_log_interval">ip6_log_interval</a> &gt;= <a class="ref" href="../sys/timevar.h.html#time_uptime" title='time_uptime' data-ref="time_uptime" data-ref-filename="time_uptime">time_uptime</a>)</td></tr>
<tr><th id="94">94</th><td>		<b>return</b>;</td></tr>
<tr><th id="95">95</th><td>	<a class="ref" href="ip6_var.h.html#ip6_log_time" title='ip6_log_time' data-ref="ip6_log_time" data-ref-filename="ip6_log_time">ip6_log_time</a> = <a class="ref" href="../sys/timevar.h.html#time_uptime" title='time_uptime' data-ref="time_uptime" data-ref-filename="time_uptime">time_uptime</a>;</td></tr>
<tr><th id="96">96</th><td></td></tr>
<tr><th id="97">97</th><td>	<a class="macro" href="../sys/stdarg.h.html#57" title="__builtin_stdarg_start(((ap)), ((fmt)))" data-ref="_M/va_start">va_start</a>(<a class="local col8 ref" href="#8ap" title='ap' data-ref="8ap" data-ref-filename="8ap">ap</a>, <a class="local col4 ref" href="#4fmt" title='fmt' data-ref="4fmt" data-ref-filename="4fmt">fmt</a>);</td></tr>
<tr><th id="98">98</th><td>	<a class="ref fn" href="../sys/systm.h.html#vsnprintf" title='vsnprintf' data-ref="vsnprintf" data-ref-filename="vsnprintf">vsnprintf</a>(<a class="local col7 ref" href="#7reason" title='reason' data-ref="7reason" data-ref-filename="7reason">reason</a>, <b>sizeof</b>(<a class="local col7 ref" href="#7reason" title='reason' data-ref="7reason" data-ref-filename="7reason">reason</a>), <a class="local col4 ref" href="#4fmt" title='fmt' data-ref="4fmt" data-ref-filename="4fmt">fmt</a>, <a class="local col8 ref" href="#8ap" title='ap' data-ref="8ap" data-ref-filename="8ap">ap</a>);</td></tr>
<tr><th id="99">99</th><td>	<a class="macro" href="../sys/stdarg.h.html#59" title="__builtin_va_end(ap)" data-ref="_M/va_end">va_end</a>(<a class="local col8 ref" href="#8ap" title='ap' data-ref="8ap" data-ref-filename="8ap">ap</a>);</td></tr>
<tr><th id="100">100</th><td></td></tr>
<tr><th id="101">101</th><td>	<a class="ref fn" href="../sys/syslog.h.html#log" title='log' data-ref="log" data-ref-filename="log">log</a>(<a class="macro" href="../sys/syslog.h.html#59" title="7" data-ref="_M/LOG_DEBUG">LOG_DEBUG</a>, <q>"Cannot forward from %s@%s to %s@%s nxt %d (%s)\n"</q>,</td></tr>
<tr><th id="102">102</th><td>	    <a class="macro" href="in6.h.html#726" title="(in6_print((sbuf), sizeof(sbuf), (&amp;ip6-&gt;ip6_src)), (sbuf))" data-ref="_M/IN6_PRINT">IN6_PRINT</a>(<a class="local col5 ref" href="#5sbuf" title='sbuf' data-ref="5sbuf" data-ref-filename="5sbuf">sbuf</a>, &amp;<a class="local col1 ref" href="#1ip6" title='ip6' data-ref="1ip6" data-ref-filename="1ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>), <a class="local col2 ref" href="#2srcifp" title='srcifp' data-ref="2srcifp" data-ref-filename="2srcifp">srcifp</a> ? <a class="macro" href="../net/if.h.html#415" title="((srcifp)-&gt;if_xname)" data-ref="_M/if_name">if_name</a>(<a class="local col2 ref" href="#2srcifp" title='srcifp' data-ref="2srcifp" data-ref-filename="2srcifp">srcifp</a>) : <q>"?"</q>,</td></tr>
<tr><th id="103">103</th><td>	    <a class="macro" href="in6.h.html#726" title="(in6_print((dbuf), sizeof(dbuf), (&amp;ip6-&gt;ip6_dst)), (dbuf))" data-ref="_M/IN6_PRINT">IN6_PRINT</a>(<a class="local col6 ref" href="#6dbuf" title='dbuf' data-ref="6dbuf" data-ref-filename="6dbuf">dbuf</a>, &amp;<a class="local col1 ref" href="#1ip6" title='ip6' data-ref="1ip6" data-ref-filename="1ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>), <a class="local col3 ref" href="#3dstifp" title='dstifp' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</a> ? <a class="macro" href="../net/if.h.html#415" title="((dstifp)-&gt;if_xname)" data-ref="_M/if_name">if_name</a>(<a class="local col3 ref" href="#3dstifp" title='dstifp' data-ref="3dstifp" data-ref-filename="3dstifp">dstifp</a>) : <q>"?"</q>,</td></tr>
<tr><th id="104">104</th><td>	    <a class="local col1 ref" href="#1ip6" title='ip6' data-ref="1ip6" data-ref-filename="1ip6">ip6</a>-&gt;<a class="macro" href="../netinet/ip6.h.html#89" title="ip6_ctlun.ip6_un1.ip6_un1_nxt" data-ref="_M/ip6_nxt">ip6_nxt</a>, <a class="local col7 ref" href="#7reason" title='reason' data-ref="7reason" data-ref-filename="7reason">reason</a>);</td></tr>
<tr><th id="105">105</th><td>}</td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td><i>/*</i></td></tr>
<tr><th id="108">108</th><td><i> * Forward a packet.  If some error occurs return the sender</i></td></tr>
<tr><th id="109">109</th><td><i> * an icmp packet.  Note we can't always generate a meaningful</i></td></tr>
<tr><th id="110">110</th><td><i> * icmp message because icmp doesn't have a large enough repertoire</i></td></tr>
<tr><th id="111">111</th><td><i> * of codes and types.</i></td></tr>
<tr><th id="112">112</th><td><i> *</i></td></tr>
<tr><th id="113">113</th><td><i> * If not forwarding, just drop the packet.  This could be confusing</i></td></tr>
<tr><th id="114">114</th><td><i> * if ipforwarding was zero but some routing protocol was advancing</i></td></tr>
<tr><th id="115">115</th><td><i> * us as a gateway to somewhere.  However, we must let the routing</i></td></tr>
<tr><th id="116">116</th><td><i> * protocol deal with that.</i></td></tr>
<tr><th id="117">117</th><td><i> */</i></td></tr>
<tr><th id="118">118</th><td><em>void</em></td></tr>
<tr><th id="119">119</th><td><dfn class="decl def fn" id="ip6_forward" title='ip6_forward' data-ref="ip6_forward" data-ref-filename="ip6_forward">ip6_forward</dfn>(<b>struct</b> <a class="type" href="../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col0 decl" id="10m" title='m' data-type='struct mbuf *' data-ref="10m" data-ref-filename="10m">m</dfn>, <em>int</em> <dfn class="local col1 decl" id="11srcrt" title='srcrt' data-type='int' data-ref="11srcrt" data-ref-filename="11srcrt">srcrt</dfn>)</td></tr>
<tr><th id="120">120</th><td>{</td></tr>
<tr><th id="121">121</th><td>	<b>struct</b> <a class="type" href="../netinet/ip6.h.html#ip6_hdr" title='ip6_hdr' data-ref="ip6_hdr" data-ref-filename="ip6_hdr">ip6_hdr</a> *<dfn class="local col2 decl" id="12ip6" title='ip6' data-type='struct ip6_hdr *' data-ref="12ip6" data-ref-filename="12ip6">ip6</dfn> = <a class="macro" href="../sys/mbuf.h.html#147" title="((struct ip6_hdr *)((m)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <b>struct</b> <a class="type" href="../netinet/ip6.h.html#ip6_hdr" title='ip6_hdr' data-ref="ip6_hdr" data-ref-filename="ip6_hdr">ip6_hdr</a> *);</td></tr>
<tr><th id="122">122</th><td>	<em>const</em> <b>struct</b> <a class="type" href="in6.h.html#sockaddr_in6" title='sockaddr_in6' data-ref="sockaddr_in6" data-ref-filename="sockaddr_in6">sockaddr_in6</a> *<dfn class="local col3 decl" id="13dst" title='dst' data-type='const struct sockaddr_in6 *' data-ref="13dst" data-ref-filename="13dst">dst</dfn>;</td></tr>
<tr><th id="123">123</th><td>	<b>struct</b> <a class="type" href="../net/route.h.html#rtentry" title='rtentry' data-ref="rtentry" data-ref-filename="rtentry">rtentry</a> *<dfn class="local col4 decl" id="14rt" title='rt' data-type='struct rtentry *' data-ref="14rt" data-ref-filename="14rt">rt</dfn> = <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="124">124</th><td>	<em>int</em> <dfn class="local col5 decl" id="15error" title='error' data-type='int' data-ref="15error" data-ref-filename="15error">error</dfn> = <var>0</var>, <dfn class="local col6 decl" id="16type" title='type' data-type='int' data-ref="16type" data-ref-filename="16type">type</dfn> = <var>0</var>, <dfn class="local col7 decl" id="17code" title='code' data-type='int' data-ref="17code" data-ref-filename="17code">code</dfn> = <var>0</var>;</td></tr>
<tr><th id="125">125</th><td>	<b>struct</b> <a class="type" href="../sys/mbuf.h.html#331" title='mbuf' data-ref="mbuf" data-ref-filename="mbuf">mbuf</a> *<dfn class="local col8 decl" id="18mcopy" title='mcopy' data-type='struct mbuf *' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</dfn> = <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="126">126</th><td>	<b>struct</b> <a class="type" href="../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col9 decl" id="19origifp" title='origifp' data-type='struct ifnet *' data-ref="19origifp" data-ref-filename="19origifp">origifp</dfn>;	<i>/* maybe unnecessary */</i></td></tr>
<tr><th id="127">127</th><td>	<a class="typedef" href="../sys/stdint.h.html#uint32_t" title='uint32_t' data-type='__uint32_t' data-ref="uint32_t" data-ref-filename="uint32_t">uint32_t</a> <dfn class="local col0 decl" id="20inzone" title='inzone' data-type='uint32_t' data-ref="20inzone" data-ref-filename="20inzone">inzone</dfn>, <dfn class="local col1 decl" id="21outzone" title='outzone' data-type='uint32_t' data-ref="21outzone" data-ref-filename="21outzone">outzone</dfn>;</td></tr>
<tr><th id="128">128</th><td>	<b>struct</b> <a class="type" href="in6.h.html#in6_addr" title='in6_addr' data-ref="in6_addr" data-ref-filename="in6_addr">in6_addr</a> <dfn class="local col2 decl" id="22src_in6" title='src_in6' data-type='struct in6_addr' data-ref="22src_in6" data-ref-filename="22src_in6">src_in6</dfn>, <dfn class="local col3 decl" id="23dst_in6" title='dst_in6' data-type='struct in6_addr' data-ref="23dst_in6" data-ref-filename="23dst_in6">dst_in6</dfn>;</td></tr>
<tr><th id="129">129</th><td>	<b>struct</b> <a class="type" href="../net/if.h.html#ifnet" title='ifnet' data-ref="ifnet" data-ref-filename="ifnet">ifnet</a> *<dfn class="local col4 decl" id="24rcvif" title='rcvif' data-type='struct ifnet *' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</dfn> = <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="130">130</th><td>	<b>struct</b> <a class="type" href="../sys/psref.h.html#psref" title='psref' data-ref="psref" data-ref-filename="psref">psref</a> <dfn class="local col5 decl" id="25psref" title='psref' data-type='struct psref' data-ref="25psref" data-ref-filename="25psref">psref</dfn>;</td></tr>
<tr><th id="131">131</th><td>	<b>struct</b> <a class="type" href="../net/route.h.html#route" title='route' data-ref="route" data-ref-filename="route">route</a> *<dfn class="local col6 decl" id="26ro" title='ro' data-type='struct route *' data-ref="26ro" data-ref-filename="26ro">ro</dfn> = <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="132">132</th><td><u>#<span data-ppcond="132">ifdef</span> <a class="macro" href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html#1" data-ref="_M/IPSEC">IPSEC</a></u></td></tr>
<tr><th id="133">133</th><td>	<em>int</em> <dfn class="local col7 decl" id="27needipsec" title='needipsec' data-type='int' data-ref="27needipsec" data-ref-filename="27needipsec">needipsec</dfn> = <var>0</var>;</td></tr>
<tr><th id="134">134</th><td>	<b>struct</b> <a class="type" href="../netipsec/ipsec.h.html#secpolicy" title='secpolicy' data-ref="secpolicy" data-ref-filename="secpolicy">secpolicy</a> *<dfn class="local col8 decl" id="28sp" title='sp' data-type='struct secpolicy *' data-ref="28sp" data-ref-filename="28sp">sp</dfn> = <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>;</td></tr>
<tr><th id="135">135</th><td><u>#<span data-ppcond="132">endif</span></u></td></tr>
<tr><th id="136">136</th><td></td></tr>
<tr><th id="137">137</th><td>	<i>/*</i></td></tr>
<tr><th id="138">138</th><td><i>	 * Clear any in-bound checksum flags for this packet.</i></td></tr>
<tr><th id="139">139</th><td><i>	 */</i></td></tr>
<tr><th id="140">140</th><td>	<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>-&gt;<a class="macro" href="../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../sys/mbuf.h.html#pkthdr::csum_flags" title='pkthdr::csum_flags' data-ref="pkthdr::csum_flags" data-ref-filename="pkthdr..csum_flags">csum_flags</a> = <var>0</var>;</td></tr>
<tr><th id="141">141</th><td></td></tr>
<tr><th id="142">142</th><td>	<a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a> = <a class="ref fn" href="../sys/mbuf.h.html#m_get_rcvif_psref" title='m_get_rcvif_psref' data-ref="m_get_rcvif_psref" data-ref-filename="m_get_rcvif_psref">m_get_rcvif_psref</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, &amp;<a class="local col5 ref" href="#25psref" title='psref' data-ref="25psref" data-ref-filename="25psref">psref</a>);</td></tr>
<tr><th id="143">143</th><td>	<b>if</b> (<a class="macro" href="../sys/cdefs.h.html#488" title="__builtin_expect((rcvif == ((void *)0)) != 0, 0)" data-ref="_M/__predict_false">__predict_false</a>(<a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a> == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>))</td></tr>
<tr><th id="144">144</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td>	<i>/*</i></td></tr>
<tr><th id="147">147</th><td><i>	 * Do not forward packets to multicast destination (should be handled</i></td></tr>
<tr><th id="148">148</th><td><i>	 * by ip6_mforward()). Do not forward packets with unspecified source.</i></td></tr>
<tr><th id="149">149</th><td><i>	 * It was discussed in July 2000, on ipngwg mailing list.</i></td></tr>
<tr><th id="150">150</th><td><i>	 */</i></td></tr>
<tr><th id="151">151</th><td>	<b>if</b> ((<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>-&gt;<a class="macro" href="../sys/mbuf.h.html#305" title="m_hdr.mh_flags" data-ref="_M/m_flags">m_flags</a> &amp; (<a class="macro" href="../sys/mbuf.h.html#343" title="0x00000100" data-ref="_M/M_BCAST">M_BCAST</a>|<a class="macro" href="../sys/mbuf.h.html#344" title="0x00000200" data-ref="_M/M_MCAST">M_MCAST</a>)) != <var>0</var> ||</td></tr>
<tr><th id="152">152</th><td>	    <a class="macro" href="in6.h.html#300" title="((&amp;ip6-&gt;ip6_dst)-&gt;__u6_addr.__u6_addr8[0] == 0xff)" data-ref="_M/IN6_IS_ADDR_MULTICAST">IN6_IS_ADDR_MULTICAST</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>) ||</td></tr>
<tr><th id="153">153</th><td>	    <a class="macro" href="in6.h.html#236" title="((&amp;ip6-&gt;ip6_src)-&gt;__u6_addr.__u6_addr32[0] == 0 &amp;&amp; (&amp;ip6-&gt;ip6_src)-&gt;__u6_addr.__u6_addr32[1] == 0 &amp;&amp; (&amp;ip6-&gt;ip6_src)-&gt;__u6_addr.__u6_addr32[2] == 0 &amp;&amp; (&amp;ip6-&gt;ip6_src)-&gt;__u6_addr.__u6_addr32[3] == 0)" data-ref="_M/IN6_IS_ADDR_UNSPECIFIED">IN6_IS_ADDR_UNSPECIFIED</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>)) {</td></tr>
<tr><th id="154">154</th><td>		<a class="tu ref fn" href="#ip6_cantforward" title='ip6_cantforward' data-use='c' data-ref="ip6_cantforward" data-ref-filename="ip6_cantforward">ip6_cantforward</a>(<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>, <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>,</td></tr>
<tr><th id="155">155</th><td>		    ((<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>-&gt;<a class="macro" href="../sys/mbuf.h.html#305" title="m_hdr.mh_flags" data-ref="_M/m_flags">m_flags</a> &amp; (<a class="macro" href="../sys/mbuf.h.html#343" title="0x00000100" data-ref="_M/M_BCAST">M_BCAST</a>|<a class="macro" href="../sys/mbuf.h.html#344" title="0x00000200" data-ref="_M/M_MCAST">M_MCAST</a>)) != <var>0</var>) ? <q>"bcast/mcast"</q> :</td></tr>
<tr><th id="156">156</th><td>		    <a class="macro" href="in6.h.html#300" title="((&amp;ip6-&gt;ip6_dst)-&gt;__u6_addr.__u6_addr8[0] == 0xff)" data-ref="_M/IN6_IS_ADDR_MULTICAST">IN6_IS_ADDR_MULTICAST</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>) ? <q>"mcast/dst"</q> :</td></tr>
<tr><th id="157">157</th><td>		    <q>"unspec/src"</q>);</td></tr>
<tr><th id="158">158</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="159">159</th><td>	}</td></tr>
<tr><th id="160">160</th><td></td></tr>
<tr><th id="161">161</th><td>	<b>if</b> (<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="macro" href="../netinet/ip6.h.html#90" title="ip6_ctlun.ip6_un1.ip6_un1_hlim" data-ref="_M/ip6_hlim">ip6_hlim</a> &lt;= <a class="macro" href="../netinet/ip6.h.html#263" title="1" data-ref="_M/IPV6_HLIMDEC">IPV6_HLIMDEC</a>) {</td></tr>
<tr><th id="162">162</th><td>		<i>/* XXX in6_ifstat_inc(rt-&gt;rt_ifp, ifs6_in_discard) */</i></td></tr>
<tr><th id="163">163</th><td>		<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <a class="macro" href="../netinet/icmp6.h.html#93" title="3" data-ref="_M/ICMP6_TIME_EXCEEDED">ICMP6_TIME_EXCEEDED</a>,</td></tr>
<tr><th id="164">164</th><td>				<a class="macro" href="../netinet/icmp6.h.html#153" title="0" data-ref="_M/ICMP6_TIME_EXCEED_TRANSIT">ICMP6_TIME_EXCEED_TRANSIT</a>, <var>0</var>);</td></tr>
<tr><th id="165">165</th><td>		<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="166">166</th><td>	}</td></tr>
<tr><th id="167">167</th><td>	<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="macro" href="../netinet/ip6.h.html#90" title="ip6_ctlun.ip6_un1.ip6_un1_hlim" data-ref="_M/ip6_hlim">ip6_hlim</a> -= <a class="macro" href="../netinet/ip6.h.html#263" title="1" data-ref="_M/IPV6_HLIMDEC">IPV6_HLIMDEC</a>;</td></tr>
<tr><th id="168">168</th><td></td></tr>
<tr><th id="169">169</th><td>	<i>/*</i></td></tr>
<tr><th id="170">170</th><td><i>	 * Save at most ICMPV6_PLD_MAXLEN (= the min IPv6 MTU -</i></td></tr>
<tr><th id="171">171</th><td><i>	 * size of IPv6 + ICMPv6 headers) bytes of the packet in case</i></td></tr>
<tr><th id="172">172</th><td><i>	 * we need to generate an ICMP6 message to the src.</i></td></tr>
<tr><th id="173">173</th><td><i>	 * Thanks to M_EXT, in most cases copy will not occur.</i></td></tr>
<tr><th id="174">174</th><td><i>	 *</i></td></tr>
<tr><th id="175">175</th><td><i>	 * It is important to save it before IPsec processing as IPsec</i></td></tr>
<tr><th id="176">176</th><td><i>	 * processing may modify the mbuf.</i></td></tr>
<tr><th id="177">177</th><td><i>	 */</i></td></tr>
<tr><th id="178">178</th><td>	<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a> = <a class="ref fn" href="../sys/mbuf.h.html#m_copym" title='m_copym' data-ref="m_copym" data-ref-filename="m_copym">m_copym</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <var>0</var>, <a class="ref fn" href="../lib/libkern/libkern.h.html#imin" title='imin' data-ref="imin" data-ref-filename="imin">imin</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>-&gt;<a class="macro" href="../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a>, <a class="macro" href="../netinet/icmp6.h.html#68" title="1232" data-ref="_M/ICMPV6_PLD_MAXLEN">ICMPV6_PLD_MAXLEN</a>),</td></tr>
<tr><th id="179">179</th><td>	    <a class="macro" href="../sys/mbuf.h.html#410" title="0x0001" data-ref="_M/M_DONTWAIT">M_DONTWAIT</a>);</td></tr>
<tr><th id="180">180</th><td></td></tr>
<tr><th id="181">181</th><td><u>#<span data-ppcond="181">ifdef</span> <a class="macro" href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html#1" data-ref="_M/IPSEC">IPSEC</a></u></td></tr>
<tr><th id="182">182</th><td>	<b>if</b> (<a class="ref" href="../netipsec/ipsec.h.html#ipsec_used" title='ipsec_used' data-ref="ipsec_used" data-ref-filename="ipsec_used">ipsec_used</a>) {</td></tr>
<tr><th id="183">183</th><td>		<i>/* Check the security policy (SP) for the packet */</i></td></tr>
<tr><th id="184">184</th><td>		<a class="local col8 ref" href="#28sp" title='sp' data-ref="28sp" data-ref-filename="28sp">sp</a> = <a class="ref fn" href="../netipsec/ipsec6.h.html#ipsec6_check_policy" title='ipsec6_check_policy' data-ref="ipsec6_check_policy" data-ref-filename="ipsec6_check_policy">ipsec6_check_policy</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>, <var>0</var>, &amp;<a class="local col7 ref" href="#27needipsec" title='needipsec' data-ref="27needipsec" data-ref-filename="27needipsec">needipsec</a>, &amp;<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a>);</td></tr>
<tr><th id="185">185</th><td>		<b>if</b> (<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> != <var>0</var>) {</td></tr>
<tr><th id="186">186</th><td>			<i>/*</i></td></tr>
<tr><th id="187">187</th><td><i>			 * Hack: -EINVAL is used to signal that a packet</i></td></tr>
<tr><th id="188">188</th><td><i>			 * should be silently discarded.  This is typically</i></td></tr>
<tr><th id="189">189</th><td><i>			 * because we asked key management for an SA and</i></td></tr>
<tr><th id="190">190</th><td><i>			 * it was delayed (e.g. kicked up to IKE).</i></td></tr>
<tr><th id="191">191</th><td><i>			 */</i></td></tr>
<tr><th id="192">192</th><td>			<b>if</b> (<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> == -<a class="macro" href="../sys/errno.h.html#64" title="22" data-ref="_M/EINVAL">EINVAL</a>)</td></tr>
<tr><th id="193">193</th><td>				<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> = <var>0</var>;</td></tr>
<tr><th id="194">194</th><td>			<a class="ref fn" href="../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>);</td></tr>
<tr><th id="195">195</th><td>			<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="196">196</th><td>		}</td></tr>
<tr><th id="197">197</th><td>	}</td></tr>
<tr><th id="198">198</th><td><u>#<span data-ppcond="181">endif</span></u></td></tr>
<tr><th id="199">199</th><td></td></tr>
<tr><th id="200">200</th><td>	<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a> = <a class="ref fn" href="../sys/percpu.h.html#percpu_getref" title='percpu_getref' data-ref="percpu_getref" data-ref-filename="percpu_getref">percpu_getref</a>(<a class="ref" href="#ip6_forward_rt_percpu" title='ip6_forward_rt_percpu' data-ref="ip6_forward_rt_percpu" data-ref-filename="ip6_forward_rt_percpu">ip6_forward_rt_percpu</a>);</td></tr>
<tr><th id="201">201</th><td>	<b>if</b> (<a class="local col1 ref" href="#11srcrt" title='srcrt' data-ref="11srcrt" data-ref-filename="11srcrt">srcrt</a>) {</td></tr>
<tr><th id="202">202</th><td>		<b>union</b> {</td></tr>
<tr><th id="203">203</th><td>			<b>struct</b> <a class="type" href="../sys/socket.h.html#sockaddr" title='sockaddr' data-ref="sockaddr" data-ref-filename="sockaddr">sockaddr</a>		<dfn class="local col2 decl field" id="32dst" title='dst' data-type='struct sockaddr' data-ref="32dst" data-ref-filename="32dst">dst</dfn>;</td></tr>
<tr><th id="204">204</th><td>			<b>struct</b> <a class="type" href="in6.h.html#sockaddr_in6" title='sockaddr_in6' data-ref="sockaddr_in6" data-ref-filename="sockaddr_in6">sockaddr_in6</a>	<dfn class="local col3 decl field" id="33dst6" title='dst6' data-type='struct sockaddr_in6' data-ref="33dst6" data-ref-filename="33dst6">dst6</dfn>;</td></tr>
<tr><th id="205">205</th><td>		} <dfn class="local col4 decl" id="34u" title='u' data-type='union (anonymous union at /___NETBSD_SRC___/objdir.amd64/sys/arch/amd64/compile/GENERIC/../../../../../../sys/netinet6/ip6_forward.c:202:3)' data-ref="34u" data-ref-filename="34u">u</dfn>;</td></tr>
<tr><th id="206">206</th><td></td></tr>
<tr><th id="207">207</th><td>		<a class="ref fn" href="in6.h.html#sockaddr_in6_init" title='sockaddr_in6_init' data-ref="sockaddr_in6_init" data-ref-filename="sockaddr_in6_init">sockaddr_in6_init</a>(&amp;<a class="local col4 ref" href="#34u" title='u' data-ref="34u" data-ref-filename="34u">u</a>.<a class="local col3 ref field" href="#33dst6" title='dst6' data-ref="33dst6" data-ref-filename="33dst6">dst6</a>, &amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>, <var>0</var>, <var>0</var>, <var>0</var>);</td></tr>
<tr><th id="208">208</th><td>		<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a> = <a class="ref fn" href="../net/route.h.html#rtcache_lookup" title='rtcache_lookup' data-ref="rtcache_lookup" data-ref-filename="rtcache_lookup">rtcache_lookup</a>(<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>, &amp;<a class="local col4 ref" href="#34u" title='u' data-ref="34u" data-ref-filename="34u">u</a>.<a class="local col2 ref field" href="#32dst" title='dst' data-ref="32dst" data-ref-filename="32dst">dst</a>);</td></tr>
<tr><th id="209">209</th><td>		<b>if</b> (<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a> == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="210">210</th><td>			<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[18]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#145" title="18" data-ref="_M/IP6_STAT_NOROUTE">IP6_STAT_NOROUTE</a>);</td></tr>
<tr><th id="211">211</th><td>			<i>/* XXX in6_ifstat_inc(rt-&gt;rt_ifp, ifs6_in_noroute) */</i></td></tr>
<tr><th id="212">212</th><td>			<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>) {</td></tr>
<tr><th id="213">213</th><td>				<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>,</td></tr>
<tr><th id="214">214</th><td>					    <a class="macro" href="../netinet/icmp6.h.html#143" title="0" data-ref="_M/ICMP6_DST_UNREACH_NOROUTE">ICMP6_DST_UNREACH_NOROUTE</a>, <var>0</var>);</td></tr>
<tr><th id="215">215</th><td>			}</td></tr>
<tr><th id="216">216</th><td>			<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="217">217</th><td>		}</td></tr>
<tr><th id="218">218</th><td>	} <b>else</b> <b>if</b> ((<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a> = <a class="ref fn" href="../net/route.h.html#rtcache_validate" title='rtcache_validate' data-ref="rtcache_validate" data-ref-filename="rtcache_validate">rtcache_validate</a>(<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>)) == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a> &amp;&amp;</td></tr>
<tr><th id="219">219</th><td>	           (<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a> = <a class="ref fn" href="../net/route.h.html#rtcache_update" title='rtcache_update' data-ref="rtcache_update" data-ref-filename="rtcache_update">rtcache_update</a>(<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>, <var>1</var>)) == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="220">220</th><td>		<i>/*</i></td></tr>
<tr><th id="221">221</th><td><i>		 * rtcache_getdst(ip6_forward_rt)-&gt;sin6_addr was equal to</i></td></tr>
<tr><th id="222">222</th><td><i>		 * ip6-&gt;ip6_dst</i></td></tr>
<tr><th id="223">223</th><td><i>		 */</i></td></tr>
<tr><th id="224">224</th><td>		<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[18]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#145" title="18" data-ref="_M/IP6_STAT_NOROUTE">IP6_STAT_NOROUTE</a>);</td></tr>
<tr><th id="225">225</th><td>		<i>/* XXX in6_ifstat_inc(rt-&gt;rt_ifp, ifs6_in_noroute) */</i></td></tr>
<tr><th id="226">226</th><td>		<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>) {</td></tr>
<tr><th id="227">227</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>,</td></tr>
<tr><th id="228">228</th><td>			    <a class="macro" href="../netinet/icmp6.h.html#143" title="0" data-ref="_M/ICMP6_DST_UNREACH_NOROUTE">ICMP6_DST_UNREACH_NOROUTE</a>, <var>0</var>);</td></tr>
<tr><th id="229">229</th><td>		}</td></tr>
<tr><th id="230">230</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="231">231</th><td>	}</td></tr>
<tr><th id="232">232</th><td>	<a class="local col3 ref" href="#13dst" title='dst' data-ref="13dst" data-ref-filename="13dst">dst</a> = <a class="macro" href="in6.h.html#617" title="((const struct sockaddr_in6 *)(rtcache_getdst(ro)))" data-ref="_M/satocsin6">satocsin6</a>(<a class="ref fn" href="../net/route.h.html#rtcache_getdst" title='rtcache_getdst' data-ref="rtcache_getdst" data-ref-filename="rtcache_getdst">rtcache_getdst</a>(<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>));</td></tr>
<tr><th id="233">233</th><td></td></tr>
<tr><th id="234">234</th><td>	<i>/*</i></td></tr>
<tr><th id="235">235</th><td><i>	 * Source scope check: if a packet can't be delivered to its</i></td></tr>
<tr><th id="236">236</th><td><i>	 * destination for the reason that the destination is beyond the scope</i></td></tr>
<tr><th id="237">237</th><td><i>	 * of the source address, discard the packet and return an icmp6</i></td></tr>
<tr><th id="238">238</th><td><i>	 * destination unreachable error with Code 2 (beyond scope of source</i></td></tr>
<tr><th id="239">239</th><td><i>	 * address).  We use a local copy of ip6_src, since in6_setscope()</i></td></tr>
<tr><th id="240">240</th><td><i>	 * will possibly modify its first argument.</i></td></tr>
<tr><th id="241">241</th><td><i>	 * [draft-ietf-ipngwg-icmp-v3-07, Section 3.1]</i></td></tr>
<tr><th id="242">242</th><td><i>	 */</i></td></tr>
<tr><th id="243">243</th><td>	<a class="local col2 ref" href="#22src_in6" title='src_in6' data-ref="22src_in6" data-ref-filename="22src_in6">src_in6</a> = <a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>;</td></tr>
<tr><th id="244">244</th><td>	<a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a> = <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a> = ~<var>0</var>;</td></tr>
<tr><th id="245">245</th><td>	<b>if</b> (<a class="ref fn" href="scope6_var.h.html#in6_setscope" title='in6_setscope' data-ref="in6_setscope" data-ref-filename="in6_setscope">in6_setscope</a>(&amp;<a class="local col2 ref" href="#22src_in6" title='src_in6' data-ref="22src_in6" data-ref-filename="22src_in6">src_in6</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, &amp;<a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>) != <var>0</var> ||</td></tr>
<tr><th id="246">246</th><td>	    <a class="ref fn" href="scope6_var.h.html#in6_setscope" title='in6_setscope' data-ref="in6_setscope" data-ref-filename="in6_setscope">in6_setscope</a>(&amp;<a class="local col2 ref" href="#22src_in6" title='src_in6' data-ref="22src_in6" data-ref-filename="22src_in6">src_in6</a>, <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, &amp;<a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a>) != <var>0</var> ||</td></tr>
<tr><th id="247">247</th><td>	    <a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a> != <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>) {</td></tr>
<tr><th id="248">248</th><td>		<a class="tu ref fn" href="#ip6_cantforward" title='ip6_cantforward' data-use='c' data-ref="ip6_cantforward" data-ref-filename="ip6_cantforward">ip6_cantforward</a>(<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>, <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>,</td></tr>
<tr><th id="249">249</th><td>		    <q>"src[%s] inzone %d outzone %d"</q>,</td></tr>
<tr><th id="250">250</th><td>		    <a class="ref fn" href="scope6_var.h.html#in6_getscopename" title='in6_getscopename' data-ref="in6_getscopename" data-ref-filename="in6_getscopename">in6_getscopename</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>), <a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a>, <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>);</td></tr>
<tr><th id="251">251</th><td>		<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>)</td></tr>
<tr><th id="252">252</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>,</td></tr>
<tr><th id="253">253</th><td>				    <a class="macro" href="../netinet/icmp6.h.html#146" title="2" data-ref="_M/ICMP6_DST_UNREACH_BEYONDSCOPE">ICMP6_DST_UNREACH_BEYONDSCOPE</a>, <var>0</var>);</td></tr>
<tr><th id="254">254</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="255">255</th><td>	}</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td><u>#<span data-ppcond="257">ifdef</span> <a class="macro" href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html#1" data-ref="_M/IPSEC">IPSEC</a></u></td></tr>
<tr><th id="258">258</th><td>	<i>/*</i></td></tr>
<tr><th id="259">259</th><td><i>	 * If we need to encapsulate the packet, do it here.</i></td></tr>
<tr><th id="260">260</th><td><i>	 * ipsec6_process_packet will send the packet using ip6_output.</i></td></tr>
<tr><th id="261">261</th><td><i>	 */</i></td></tr>
<tr><th id="262">262</th><td>	<b>if</b> (<a class="local col7 ref" href="#27needipsec" title='needipsec' data-ref="27needipsec" data-ref-filename="27needipsec">needipsec</a>) {</td></tr>
<tr><th id="263">263</th><td>		<em>int</em> <dfn class="local col5 decl" id="35s" title='s' data-type='int' data-ref="35s" data-ref-filename="35s">s</dfn> = <a class="ref fn" href="../sys/spl.h.html#50" title='splsoftnet' data-ref="splsoftnet" data-ref-filename="splsoftnet">splsoftnet</a>();</td></tr>
<tr><th id="264">264</th><td>		<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> = <a class="ref fn" href="../netipsec/ipsec6.h.html#ipsec6_process_packet" title='ipsec6_process_packet' data-ref="ipsec6_process_packet" data-ref-filename="ipsec6_process_packet">ipsec6_process_packet</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <a class="local col8 ref" href="#28sp" title='sp' data-ref="28sp" data-ref-filename="28sp">sp</a>-&gt;<a class="ref field" href="../netipsec/ipsec.h.html#secpolicy::req" title='secpolicy::req' data-ref="secpolicy::req" data-ref-filename="secpolicy..req">req</a>);</td></tr>
<tr><th id="265">265</th><td>		<a class="macro" href="../arch/x86/include/intr.h.html#170" title="spllower(s)" data-ref="_M/splx">splx</a>(<a class="local col5 ref" href="#35s" title='s' data-ref="35s" data-ref-filename="35s">s</a>);</td></tr>
<tr><th id="266">266</th><td>		<i>/* m is freed */</i></td></tr>
<tr><th id="267">267</th><td>		<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>)</td></tr>
<tr><th id="268">268</th><td>			<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="269">269</th><td>		<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="270">270</th><td>	}</td></tr>
<tr><th id="271">271</th><td><u>#<span data-ppcond="257">endif</span></u></td></tr>
<tr><th id="272">272</th><td></td></tr>
<tr><th id="273">273</th><td>	<i>/*</i></td></tr>
<tr><th id="274">274</th><td><i>	 * Destination scope check: if a packet is going to break the scope</i></td></tr>
<tr><th id="275">275</th><td><i>	 * zone of packet's destination address, discard it.  This case should</i></td></tr>
<tr><th id="276">276</th><td><i>	 * usually be prevented by appropriately-configured routing table, but</i></td></tr>
<tr><th id="277">277</th><td><i>	 * we need an explicit check because we may mistakenly forward the</i></td></tr>
<tr><th id="278">278</th><td><i>	 * packet to a different zone by (e.g.) a default route.</i></td></tr>
<tr><th id="279">279</th><td><i>	 */</i></td></tr>
<tr><th id="280">280</th><td>	<a class="local col3 ref" href="#23dst_in6" title='dst_in6' data-ref="23dst_in6" data-ref-filename="23dst_in6">dst_in6</a> = <a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>;</td></tr>
<tr><th id="281">281</th><td>	<a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a> = <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a> = ~<var>0</var>;</td></tr>
<tr><th id="282">282</th><td>	<b>if</b> (<a class="ref fn" href="scope6_var.h.html#in6_setscope" title='in6_setscope' data-ref="in6_setscope" data-ref-filename="in6_setscope">in6_setscope</a>(&amp;<a class="local col3 ref" href="#23dst_in6" title='dst_in6' data-ref="23dst_in6" data-ref-filename="23dst_in6">dst_in6</a>, <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, &amp;<a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a>) != <var>0</var> ||</td></tr>
<tr><th id="283">283</th><td>	    <a class="ref fn" href="scope6_var.h.html#in6_setscope" title='in6_setscope' data-ref="in6_setscope" data-ref-filename="in6_setscope">in6_setscope</a>(&amp;<a class="local col3 ref" href="#23dst_in6" title='dst_in6' data-ref="23dst_in6" data-ref-filename="23dst_in6">dst_in6</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, &amp;<a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>) != <var>0</var> ||</td></tr>
<tr><th id="284">284</th><td>	    <a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a> != <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>) {</td></tr>
<tr><th id="285">285</th><td>		<a class="tu ref fn" href="#ip6_cantforward" title='ip6_cantforward' data-use='c' data-ref="ip6_cantforward" data-ref-filename="ip6_cantforward">ip6_cantforward</a>(<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>, <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>,</td></tr>
<tr><th id="286">286</th><td>		    <q>"dst[%s] inzone %d outzone %d"</q>,</td></tr>
<tr><th id="287">287</th><td>		    <a class="ref fn" href="scope6_var.h.html#in6_getscopename" title='in6_getscopename' data-ref="in6_getscopename" data-ref-filename="in6_getscopename">in6_getscopename</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>), <a class="local col0 ref" href="#20inzone" title='inzone' data-ref="20inzone" data-ref-filename="20inzone">inzone</a>, <a class="local col1 ref" href="#21outzone" title='outzone' data-ref="21outzone" data-ref-filename="21outzone">outzone</a>);</td></tr>
<tr><th id="288">288</th><td>		<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>)</td></tr>
<tr><th id="289">289</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>,</td></tr>
<tr><th id="290">290</th><td>				    <a class="macro" href="../netinet/icmp6.h.html#146" title="2" data-ref="_M/ICMP6_DST_UNREACH_BEYONDSCOPE">ICMP6_DST_UNREACH_BEYONDSCOPE</a>, <var>0</var>);</td></tr>
<tr><th id="291">291</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="292">292</th><td>	}</td></tr>
<tr><th id="293">293</th><td></td></tr>
<tr><th id="294">294</th><td>	<b>if</b> (<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>-&gt;<a class="macro" href="../sys/mbuf.h.html#308" title="M_dat.MH.MH_pkthdr" data-ref="_M/m_pkthdr">m_pkthdr</a>.<a class="ref field" href="../sys/mbuf.h.html#pkthdr::len" title='pkthdr::len' data-ref="pkthdr::len" data-ref-filename="pkthdr..len">len</a> &gt; <a class="macro" href="nd6.h.html#108" title="(((((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu &amp;&amp; (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu &lt; (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu) ? (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu : (((((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu &amp;&amp; (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu &lt; (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu) ? (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu : (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu))" data-ref="_M/IN6_LINKMTU">IN6_LINKMTU</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>)) {</td></tr>
<tr><th id="295">295</th><td>		<a class="macro" href="in6_var.h.html#577" title="do { if (rt-&gt;rt_ifp) ((struct in6_ifextra *)((rt-&gt;rt_ifp)-&gt;if_afdata[24]))-&gt;in6_ifstat-&gt;ifs6_in_toobig++; } while ( 0)" data-ref="_M/in6_ifstat_inc">in6_ifstat_inc</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, <a class="ref field" href="in6_var.h.html#in6_ifstat::ifs6_in_toobig" title='in6_ifstat::ifs6_in_toobig' data-ref="in6_ifstat::ifs6_in_toobig" data-ref-filename="in6_ifstat..ifs6_in_toobig">ifs6_in_toobig</a>);</td></tr>
<tr><th id="296">296</th><td>		<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>) {</td></tr>
<tr><th id="297">297</th><td>			<a class="typedef" href="../sys/types.h.html#u_long" title='u_long' data-type='unsigned long' data-ref="u_long" data-ref-filename="u_long">u_long</a> <dfn class="local col6 decl" id="36mtu" title='mtu' data-type='u_long' data-ref="36mtu" data-ref-filename="36mtu">mtu</dfn>;</td></tr>
<tr><th id="298">298</th><td></td></tr>
<tr><th id="299">299</th><td>			<a class="local col6 ref" href="#36mtu" title='mtu' data-ref="36mtu" data-ref-filename="36mtu">mtu</a> = <a class="macro" href="nd6.h.html#108" title="(((((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu &amp;&amp; (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu &lt; (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu) ? (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;linkmtu : (((((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu &amp;&amp; (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu &lt; (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu) ? (((struct in6_ifextra *)(rt-&gt;rt_ifp)-&gt;if_afdata[24])-&gt;nd_ifinfo)-&gt;maxmtu : (rt-&gt;rt_ifp)-&gt;if_data.ifi_mtu))" data-ref="_M/IN6_LINKMTU">IN6_LINKMTU</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>);</td></tr>
<tr><th id="300">300</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#92" title="2" data-ref="_M/ICMP6_PACKET_TOO_BIG">ICMP6_PACKET_TOO_BIG</a>, <var>0</var>, <a class="local col6 ref" href="#36mtu" title='mtu' data-ref="36mtu" data-ref-filename="36mtu">mtu</a>);</td></tr>
<tr><th id="301">301</th><td>		}</td></tr>
<tr><th id="302">302</th><td>		<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="303">303</th><td>	}</td></tr>
<tr><th id="304">304</th><td></td></tr>
<tr><th id="305">305</th><td>	<b>if</b> (<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_flags" title='rtentry::rt_flags' data-ref="rtentry::rt_flags" data-ref-filename="rtentry..rt_flags">rt_flags</a> &amp; <a class="macro" href="../net/route.h.html#153" title="0x2" data-ref="_M/RTF_GATEWAY">RTF_GATEWAY</a>)</td></tr>
<tr><th id="306">306</th><td>		<a class="local col3 ref" href="#13dst" title='dst' data-ref="13dst" data-ref-filename="13dst">dst</a> = (<b>struct</b> <a class="type" href="in6.h.html#sockaddr_in6" title='sockaddr_in6' data-ref="sockaddr_in6" data-ref-filename="sockaddr_in6">sockaddr_in6</a> *)<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_gateway" title='rtentry::rt_gateway' data-ref="rtentry::rt_gateway" data-ref-filename="rtentry..rt_gateway">rt_gateway</a>;</td></tr>
<tr><th id="307">307</th><td></td></tr>
<tr><th id="308">308</th><td>	<i>/*</i></td></tr>
<tr><th id="309">309</th><td><i>	 * If we are to forward the packet using the same interface</i></td></tr>
<tr><th id="310">310</th><td><i>	 * as one we got the packet from, perhaps we should send a redirect</i></td></tr>
<tr><th id="311">311</th><td><i>	 * to sender to shortcut a hop.</i></td></tr>
<tr><th id="312">312</th><td><i>	 * Only send redirect if source is sending directly to us,</i></td></tr>
<tr><th id="313">313</th><td><i>	 * and if packet was not source routed (or has any options).</i></td></tr>
<tr><th id="314">314</th><td><i>	 * Also, don't send redirect if forwarding using a route</i></td></tr>
<tr><th id="315">315</th><td><i>	 * modified by a redirect.</i></td></tr>
<tr><th id="316">316</th><td><i>	 */</i></td></tr>
<tr><th id="317">317</th><td>	<b>if</b> (<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a> == <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a> &amp;&amp; !<a class="local col1 ref" href="#11srcrt" title='srcrt' data-ref="11srcrt" data-ref-filename="11srcrt">srcrt</a> &amp;&amp; <a class="ref" href="ip6_var.h.html#ip6_sendredirects" title='ip6_sendredirects' data-ref="ip6_sendredirects" data-ref-filename="ip6_sendredirects">ip6_sendredirects</a> &amp;&amp;</td></tr>
<tr><th id="318">318</th><td>	    (<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_flags" title='rtentry::rt_flags' data-ref="rtentry::rt_flags" data-ref-filename="rtentry..rt_flags">rt_flags</a> &amp; (<a class="macro" href="../net/route.h.html#156" title="0x10" data-ref="_M/RTF_DYNAMIC">RTF_DYNAMIC</a>|<a class="macro" href="../net/route.h.html#157" title="0x20" data-ref="_M/RTF_MODIFIED">RTF_MODIFIED</a>)) == <var>0</var>) {</td></tr>
<tr><th id="319">319</th><td>		<b>if</b> ((<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>-&gt;<a class="ref field" href="../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../net/if.h.html#421" title="0x0010" data-ref="_M/IFF_POINTOPOINT">IFF_POINTOPOINT</a>) &amp;&amp;</td></tr>
<tr><th id="320">320</th><td>		    <a class="ref fn" href="nd6.h.html#nd6_is_addr_neighbor" title='nd6_is_addr_neighbor' data-ref="nd6_is_addr_neighbor" data-ref-filename="nd6_is_addr_neighbor">nd6_is_addr_neighbor</a>(<a class="macro" href="in6.h.html#617" title="((const struct sockaddr_in6 *)(rtcache_getdst(ro)))" data-ref="_M/satocsin6">satocsin6</a>(<a class="ref fn" href="../net/route.h.html#rtcache_getdst" title='rtcache_getdst' data-ref="rtcache_getdst" data-ref-filename="rtcache_getdst">rtcache_getdst</a>(<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>)),</td></tr>
<tr><th id="321">321</th><td>		                         <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>)) {</td></tr>
<tr><th id="322">322</th><td>			<i>/*</i></td></tr>
<tr><th id="323">323</th><td><i>			 * If the incoming interface is equal to the outgoing</i></td></tr>
<tr><th id="324">324</th><td><i>			 * one, the link attached to the interface is</i></td></tr>
<tr><th id="325">325</th><td><i>			 * point-to-point, and the IPv6 destination is</i></td></tr>
<tr><th id="326">326</th><td><i>			 * regarded as on-link on the link, then it will be</i></td></tr>
<tr><th id="327">327</th><td><i>			 * highly probable that the destination address does</i></td></tr>
<tr><th id="328">328</th><td><i>			 * not exist on the link and that the packet is going</i></td></tr>
<tr><th id="329">329</th><td><i>			 * to loop.  Thus, we immediately drop the packet and</i></td></tr>
<tr><th id="330">330</th><td><i>			 * send an ICMPv6 error message.</i></td></tr>
<tr><th id="331">331</th><td><i>			 * For other routing loops, we dare to let the packet</i></td></tr>
<tr><th id="332">332</th><td><i>			 * go to the loop, so that a remote diagnosing host</i></td></tr>
<tr><th id="333">333</th><td><i>			 * can detect the loop by traceroute.</i></td></tr>
<tr><th id="334">334</th><td><i>			 * type/code is based on suggestion by Rich Draves.</i></td></tr>
<tr><th id="335">335</th><td><i>			 * not sure if it is the best pick.</i></td></tr>
<tr><th id="336">336</th><td><i>			 */</i></td></tr>
<tr><th id="337">337</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>,</td></tr>
<tr><th id="338">338</th><td>				    <a class="macro" href="../netinet/icmp6.h.html#147" title="3" data-ref="_M/ICMP6_DST_UNREACH_ADDR">ICMP6_DST_UNREACH_ADDR</a>, <var>0</var>);</td></tr>
<tr><th id="339">339</th><td>			<b>goto</b> <a class="lbl" href="#29drop" data-ref="29drop" data-ref-filename="29drop">drop</a>;</td></tr>
<tr><th id="340">340</th><td>		}</td></tr>
<tr><th id="341">341</th><td>		<a class="local col6 ref" href="#16type" title='type' data-ref="16type" data-ref-filename="16type">type</a> = <a class="macro" href="../netinet/icmp6.h.html#119" title="137" data-ref="_M/ND_REDIRECT">ND_REDIRECT</a>;</td></tr>
<tr><th id="342">342</th><td>	}</td></tr>
<tr><th id="343">343</th><td></td></tr>
<tr><th id="344">344</th><td>	<i>/*</i></td></tr>
<tr><th id="345">345</th><td><i>	 * Fake scoped addresses. Note that even link-local source or</i></td></tr>
<tr><th id="346">346</th><td><i>	 * destination can appear, if the originating node just sends the</i></td></tr>
<tr><th id="347">347</th><td><i>	 * packet to us (without address resolution for the destination).</i></td></tr>
<tr><th id="348">348</th><td><i>	 * Since both icmp6_error and icmp6_redirect_output fill the embedded</i></td></tr>
<tr><th id="349">349</th><td><i>	 * link identifiers, we can do this stuff after making a copy for</i></td></tr>
<tr><th id="350">350</th><td><i>	 * returning an error.</i></td></tr>
<tr><th id="351">351</th><td><i>	 */</i></td></tr>
<tr><th id="352">352</th><td>	<b>if</b> ((<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>-&gt;<a class="ref field" href="../net/if.h.html#ifnet::if_flags" title='ifnet::if_flags' data-ref="ifnet::if_flags" data-ref-filename="ifnet..if_flags">if_flags</a> &amp; <a class="macro" href="../net/if.h.html#420" title="0x0008" data-ref="_M/IFF_LOOPBACK">IFF_LOOPBACK</a>) != <var>0</var>) {</td></tr>
<tr><th id="353">353</th><td>		<i>/*</i></td></tr>
<tr><th id="354">354</th><td><i>		 * See corresponding comments in ip6_output.</i></td></tr>
<tr><th id="355">355</th><td><i>		 * XXX: but is it possible that ip6_forward() sends a packet</i></td></tr>
<tr><th id="356">356</th><td><i>		 *      to a loopback interface? I don't think so, and thus</i></td></tr>
<tr><th id="357">357</th><td><i>		 *      I bark here. (jinmei@kame.net)</i></td></tr>
<tr><th id="358">358</th><td><i>		 * XXX: it is common to route invalid packets to loopback.</i></td></tr>
<tr><th id="359">359</th><td><i>		 *	also, the codepath will be visited on use of ::1 in</i></td></tr>
<tr><th id="360">360</th><td><i>		 *	rthdr. (itojun)</i></td></tr>
<tr><th id="361">361</th><td><i>		 */</i></td></tr>
<tr><th id="362">362</th><td><u>#<span data-ppcond="362">if</span> 1</u></td></tr>
<tr><th id="363">363</th><td>		<b>if</b> (<var>0</var>)</td></tr>
<tr><th id="364">364</th><td><u>#<span data-ppcond="362">else</span></u></td></tr>
<tr><th id="365">365</th><td>		<b>if</b> ((rt-&gt;rt_flags &amp; (RTF_BLACKHOLE|RTF_REJECT)) == <var>0</var>)</td></tr>
<tr><th id="366">366</th><td><u>#<span data-ppcond="362">endif</span></u></td></tr>
<tr><th id="367">367</th><td>		{</td></tr>
<tr><th id="368">368</th><td>			<em>char</em> <dfn class="local col7 decl" id="37ip6bufs" title='ip6bufs' data-type='char [46]' data-ref="37ip6bufs" data-ref-filename="37ip6bufs">ip6bufs</dfn>[<a class="macro" href="in6.h.html#138" title="46" data-ref="_M/INET6_ADDRSTRLEN">INET6_ADDRSTRLEN</a>];</td></tr>
<tr><th id="369">369</th><td>			<em>char</em> <dfn class="local col8 decl" id="38ip6bufd" title='ip6bufd' data-type='char [46]' data-ref="38ip6bufd" data-ref-filename="38ip6bufd">ip6bufd</dfn>[<a class="macro" href="in6.h.html#138" title="46" data-ref="_M/INET6_ADDRSTRLEN">INET6_ADDRSTRLEN</a>];</td></tr>
<tr><th id="370">370</th><td></td></tr>
<tr><th id="371">371</th><td>			<a class="ref fn" href="../sys/systm.h.html#printf" title='printf' data-ref="printf" data-ref-filename="printf">printf</a>(<q>"ip6_forward: outgoing interface is loopback. "</q></td></tr>
<tr><th id="372">372</th><td>			       <q>"src %s, dst %s, nxt %d, rcvif %s, outif %s\n"</q>,</td></tr>
<tr><th id="373">373</th><td>			       <a class="macro" href="in6.h.html#726" title="(in6_print((ip6bufs), sizeof(ip6bufs), (&amp;ip6-&gt;ip6_src)), (ip6bufs))" data-ref="_M/IN6_PRINT">IN6_PRINT</a>(<a class="local col7 ref" href="#37ip6bufs" title='ip6bufs' data-ref="37ip6bufs" data-ref-filename="37ip6bufs">ip6bufs</a>, &amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>),</td></tr>
<tr><th id="374">374</th><td>			       <a class="macro" href="in6.h.html#726" title="(in6_print((ip6bufd), sizeof(ip6bufd), (&amp;ip6-&gt;ip6_dst)), (ip6bufd))" data-ref="_M/IN6_PRINT">IN6_PRINT</a>(<a class="local col8 ref" href="#38ip6bufd" title='ip6bufd' data-ref="38ip6bufd" data-ref-filename="38ip6bufd">ip6bufd</a>, &amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>),</td></tr>
<tr><th id="375">375</th><td>			       <a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="macro" href="../netinet/ip6.h.html#89" title="ip6_ctlun.ip6_un1.ip6_un1_nxt" data-ref="_M/ip6_nxt">ip6_nxt</a>, <a class="macro" href="../net/if.h.html#415" title="((rcvif)-&gt;if_xname)" data-ref="_M/if_name">if_name</a>(<a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>),</td></tr>
<tr><th id="376">376</th><td>			       <a class="macro" href="../net/if.h.html#415" title="((rt-&gt;rt_ifp)-&gt;if_xname)" data-ref="_M/if_name">if_name</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>));</td></tr>
<tr><th id="377">377</th><td>		}</td></tr>
<tr><th id="378">378</th><td></td></tr>
<tr><th id="379">379</th><td>		<i>/* we can just use rcvif in forwarding. */</i></td></tr>
<tr><th id="380">380</th><td>		<a class="local col9 ref" href="#19origifp" title='origifp' data-ref="19origifp" data-ref-filename="19origifp">origifp</a> = <a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>;</td></tr>
<tr><th id="381">381</th><td>	} <b>else</b> {</td></tr>
<tr><th id="382">382</th><td>		<a class="local col9 ref" href="#19origifp" title='origifp' data-ref="19origifp" data-ref-filename="19origifp">origifp</a> = <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>;</td></tr>
<tr><th id="383">383</th><td>	}</td></tr>
<tr><th id="384">384</th><td></td></tr>
<tr><th id="385">385</th><td>	<i>/*</i></td></tr>
<tr><th id="386">386</th><td><i>	 * clear embedded scope identifiers if necessary.</i></td></tr>
<tr><th id="387">387</th><td><i>	 * in6_clearscope will touch the addresses only when necessary.</i></td></tr>
<tr><th id="388">388</th><td><i>	 */</i></td></tr>
<tr><th id="389">389</th><td>	<a class="ref fn" href="scope6_var.h.html#in6_clearscope" title='in6_clearscope' data-ref="in6_clearscope" data-ref-filename="in6_clearscope">in6_clearscope</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_src" title='ip6_hdr::ip6_src' data-ref="ip6_hdr::ip6_src" data-ref-filename="ip6_hdr..ip6_src">ip6_src</a>);</td></tr>
<tr><th id="390">390</th><td>	<a class="ref fn" href="scope6_var.h.html#in6_clearscope" title='in6_clearscope' data-ref="in6_clearscope" data-ref-filename="in6_clearscope">in6_clearscope</a>(&amp;<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a>-&gt;<a class="ref field" href="../netinet/ip6.h.html#ip6_hdr::ip6_dst" title='ip6_hdr::ip6_dst' data-ref="ip6_hdr::ip6_dst" data-ref-filename="ip6_hdr..ip6_dst">ip6_dst</a>);</td></tr>
<tr><th id="391">391</th><td></td></tr>
<tr><th id="392">392</th><td>	<i>/*</i></td></tr>
<tr><th id="393">393</th><td><i>	 * Run through list of hooks for output packets.</i></td></tr>
<tr><th id="394">394</th><td><i>	 */</i></td></tr>
<tr><th id="395">395</th><td>	<b>if</b> ((<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> = <a class="ref fn" href="../net/pfil.h.html#pfil_run_hooks" title='pfil_run_hooks' data-ref="pfil_run_hooks" data-ref-filename="pfil_run_hooks">pfil_run_hooks</a>(<a class="ref" href="#inet6_pfil_hook" title='inet6_pfil_hook' data-ref="inet6_pfil_hook" data-ref-filename="inet6_pfil_hook">inet6_pfil_hook</a>, &amp;<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>,</td></tr>
<tr><th id="396">396</th><td>	    <a class="macro" href="../net/pfil.h.html#46" title="0x00000002" data-ref="_M/PFIL_OUT">PFIL_OUT</a>)) != <var>0</var>) {</td></tr>
<tr><th id="397">397</th><td>		<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[404]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#190" title="404" data-ref="_M/IP6_STAT_PFILDROP_OUT">IP6_STAT_PFILDROP_OUT</a>);</td></tr>
<tr><th id="398">398</th><td>		<b>goto</b> <a class="lbl" href="#39senderr" data-ref="39senderr" data-ref-filename="39senderr">senderr</a>;</td></tr>
<tr><th id="399">399</th><td>	}</td></tr>
<tr><th id="400">400</th><td>	<b>if</b> (<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a> == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="401">401</th><td>		<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[404]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#190" title="404" data-ref="_M/IP6_STAT_PFILDROP_OUT">IP6_STAT_PFILDROP_OUT</a>);</td></tr>
<tr><th id="402">402</th><td>		<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="403">403</th><td>	}</td></tr>
<tr><th id="404">404</th><td>	<a class="local col2 ref" href="#12ip6" title='ip6' data-ref="12ip6" data-ref-filename="12ip6">ip6</a> = <a class="macro" href="../sys/mbuf.h.html#147" title="((struct ip6_hdr *)((m)-&gt;m_hdr.mh_data))" data-ref="_M/mtod">mtod</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <b>struct</b> <a class="type" href="../netinet/ip6.h.html#ip6_hdr" title='ip6_hdr' data-ref="ip6_hdr" data-ref-filename="ip6_hdr">ip6_hdr</a> *);</td></tr>
<tr><th id="405">405</th><td></td></tr>
<tr><th id="406">406</th><td>	<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a> = <a class="ref fn" href="ip6_var.h.html#ip6_if_output" title='ip6_if_output' data-ref="ip6_if_output" data-ref-filename="ip6_if_output">ip6_if_output</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, <a class="local col9 ref" href="#19origifp" title='origifp' data-ref="19origifp" data-ref-filename="19origifp">origifp</a>, <a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>, <a class="local col3 ref" href="#13dst" title='dst' data-ref="13dst" data-ref-filename="13dst">dst</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>);</td></tr>
<tr><th id="407">407</th><td>	<b>if</b> (<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a>) {</td></tr>
<tr><th id="408">408</th><td>		<a class="macro" href="in6_var.h.html#577" title="do { if (rt-&gt;rt_ifp) ((struct in6_ifextra *)((rt-&gt;rt_ifp)-&gt;if_afdata[24]))-&gt;in6_ifstat-&gt;ifs6_out_discard++; } while ( 0)" data-ref="_M/in6_ifstat_inc">in6_ifstat_inc</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, <a class="ref field" href="in6_var.h.html#in6_ifstat::ifs6_out_discard" title='in6_ifstat::ifs6_out_discard' data-ref="in6_ifstat::ifs6_out_discard" data-ref-filename="in6_ifstat..ifs6_out_discard">ifs6_out_discard</a>);</td></tr>
<tr><th id="409">409</th><td>		<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[8]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#135" title="8" data-ref="_M/IP6_STAT_CANTFORWARD">IP6_STAT_CANTFORWARD</a>);</td></tr>
<tr><th id="410">410</th><td>	} <b>else</b> {</td></tr>
<tr><th id="411">411</th><td>		<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[7]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#134" title="7" data-ref="_M/IP6_STAT_FORWARD">IP6_STAT_FORWARD</a>);</td></tr>
<tr><th id="412">412</th><td>		<a class="macro" href="in6_var.h.html#577" title="do { if (rt-&gt;rt_ifp) ((struct in6_ifextra *)((rt-&gt;rt_ifp)-&gt;if_afdata[24]))-&gt;in6_ifstat-&gt;ifs6_out_forward++; } while ( 0)" data-ref="_M/in6_ifstat_inc">in6_ifstat_inc</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>-&gt;<a class="ref field" href="../net/route.h.html#rtentry::rt_ifp" title='rtentry::rt_ifp' data-ref="rtentry::rt_ifp" data-ref-filename="rtentry..rt_ifp">rt_ifp</a>, <a class="ref field" href="in6_var.h.html#in6_ifstat::ifs6_out_forward" title='in6_ifstat::ifs6_out_forward' data-ref="in6_ifstat::ifs6_out_forward" data-ref-filename="in6_ifstat..ifs6_out_forward">ifs6_out_forward</a>);</td></tr>
<tr><th id="413">413</th><td>		<b>if</b> (<a class="local col6 ref" href="#16type" title='type' data-ref="16type" data-ref-filename="16type">type</a>)</td></tr>
<tr><th id="414">414</th><td>			<a class="macro" href="ip6_private.h.html#43" title="do { uint64_t *_stat_ = ((uint64_t *)percpu_getref((ip6stat_percpu))); _stat_[9]++; percpu_putref((ip6stat_percpu)); } while ( 0)" data-ref="_M/IP6_STATINC">IP6_STATINC</a>(<a class="macro" href="ip6_var.h.html#136" title="9" data-ref="_M/IP6_STAT_REDIRECTSENT">IP6_STAT_REDIRECTSENT</a>);</td></tr>
<tr><th id="415">415</th><td>		<b>else</b> {</td></tr>
<tr><th id="416">416</th><td><u>#<span data-ppcond="416">ifdef</span> <span class="macro" data-ref="_M/GATEWAY">GATEWAY</span></u></td></tr>
<tr><th id="417">417</th><td>			<i>/* Need to release rt here */</i></td></tr>
<tr><th id="418">418</th><td>			rtcache_unref(rt, ro);</td></tr>
<tr><th id="419">419</th><td>			rt = NULL;</td></tr>
<tr><th id="420">420</th><td>			<b>if</b> (mcopy-&gt;m_flags &amp; M_CANFASTFWD)</td></tr>
<tr><th id="421">421</th><td>				ip6flow_create(ro, mcopy);</td></tr>
<tr><th id="422">422</th><td><u>#<span data-ppcond="416">endif</span></u></td></tr>
<tr><th id="423">423</th><td>			<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>)</td></tr>
<tr><th id="424">424</th><td>				<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="425">425</th><td>		}</td></tr>
<tr><th id="426">426</th><td>	}</td></tr>
<tr><th id="427">427</th><td></td></tr>
<tr><th id="428">428</th><td><dfn class="lbl" id="39senderr" data-ref="39senderr" data-ref-filename="39senderr">senderr</dfn>:</td></tr>
<tr><th id="429">429</th><td>	<b>if</b> (<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a> == <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="430">430</th><td>		<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="431">431</th><td>	<b>switch</b> (<a class="local col5 ref" href="#15error" title='error' data-ref="15error" data-ref-filename="15error">error</a>) {</td></tr>
<tr><th id="432">432</th><td>	<b>case</b> <var>0</var>:</td></tr>
<tr><th id="433">433</th><td>		<b>if</b> (<a class="local col6 ref" href="#16type" title='type' data-ref="16type" data-ref-filename="16type">type</a> == <a class="macro" href="../netinet/icmp6.h.html#119" title="137" data-ref="_M/ND_REDIRECT">ND_REDIRECT</a>) {</td></tr>
<tr><th id="434">434</th><td>			<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_redirect_output" title='icmp6_redirect_output' data-ref="icmp6_redirect_output" data-ref-filename="icmp6_redirect_output">icmp6_redirect_output</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>);</td></tr>
<tr><th id="435">435</th><td>			<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="436">436</th><td>		}</td></tr>
<tr><th id="437">437</th><td>		<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="438">438</th><td></td></tr>
<tr><th id="439">439</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#89" title="40" data-ref="_M/EMSGSIZE">EMSGSIZE</a>:</td></tr>
<tr><th id="440">440</th><td>		<i>/* xxx MTU is constant in PPP? */</i></td></tr>
<tr><th id="441">441</th><td>		<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="442">442</th><td></td></tr>
<tr><th id="443">443</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#106" title="55" data-ref="_M/ENOBUFS">ENOBUFS</a>:</td></tr>
<tr><th id="444">444</th><td>		<i>/* Tell source to slow down like source quench in IP? */</i></td></tr>
<tr><th id="445">445</th><td>		<b>goto</b> <a class="lbl" href="#31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</a>;</td></tr>
<tr><th id="446">446</th><td></td></tr>
<tr><th id="447">447</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#102" title="51" data-ref="_M/ENETUNREACH">ENETUNREACH</a>:	<i>/* shouldn't happen, checked above */</i></td></tr>
<tr><th id="448">448</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#119" title="65" data-ref="_M/EHOSTUNREACH">EHOSTUNREACH</a>:</td></tr>
<tr><th id="449">449</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#101" title="50" data-ref="_M/ENETDOWN">ENETDOWN</a>:</td></tr>
<tr><th id="450">450</th><td>	<b>case</b> <a class="macro" href="../sys/errno.h.html#118" title="64" data-ref="_M/EHOSTDOWN">EHOSTDOWN</a>:</td></tr>
<tr><th id="451">451</th><td>	<b>default</b>:</td></tr>
<tr><th id="452">452</th><td>		<a class="local col6 ref" href="#16type" title='type' data-ref="16type" data-ref-filename="16type">type</a> = <a class="macro" href="../netinet/icmp6.h.html#91" title="1" data-ref="_M/ICMP6_DST_UNREACH">ICMP6_DST_UNREACH</a>;</td></tr>
<tr><th id="453">453</th><td>		<a class="local col7 ref" href="#17code" title='code' data-ref="17code" data-ref-filename="17code">code</a> = <a class="macro" href="../netinet/icmp6.h.html#147" title="3" data-ref="_M/ICMP6_DST_UNREACH_ADDR">ICMP6_DST_UNREACH_ADDR</a>;</td></tr>
<tr><th id="454">454</th><td>		<b>break</b>;</td></tr>
<tr><th id="455">455</th><td>	}</td></tr>
<tr><th id="456">456</th><td>	<a class="ref fn" href="../netinet/icmp6.h.html#icmp6_error" title='icmp6_error' data-ref="icmp6_error" data-ref-filename="icmp6_error">icmp6_error</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>, <a class="local col6 ref" href="#16type" title='type' data-ref="16type" data-ref-filename="16type">type</a>, <a class="local col7 ref" href="#17code" title='code' data-ref="17code" data-ref-filename="17code">code</a>, <var>0</var>);</td></tr>
<tr><th id="457">457</th><td>	<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="458">458</th><td></td></tr>
<tr><th id="459">459</th><td><dfn class="lbl" id="31freecopy" data-ref="31freecopy" data-ref-filename="31freecopy">freecopy</dfn>:</td></tr>
<tr><th id="460">460</th><td>	<a class="ref fn" href="../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col8 ref" href="#18mcopy" title='mcopy' data-ref="18mcopy" data-ref-filename="18mcopy">mcopy</a>);</td></tr>
<tr><th id="461">461</th><td>	<b>goto</b> <a class="lbl" href="#30out" data-ref="30out" data-ref-filename="30out">out</a>;</td></tr>
<tr><th id="462">462</th><td></td></tr>
<tr><th id="463">463</th><td><dfn class="lbl" id="29drop" data-ref="29drop" data-ref-filename="29drop">drop</dfn>:</td></tr>
<tr><th id="464">464</th><td>	<a class="ref fn" href="../sys/mbuf.h.html#m_freem" title='m_freem' data-ref="m_freem" data-ref-filename="m_freem">m_freem</a>(<a class="local col0 ref" href="#10m" title='m' data-ref="10m" data-ref-filename="10m">m</a>);</td></tr>
<tr><th id="465">465</th><td></td></tr>
<tr><th id="466">466</th><td><dfn class="lbl" id="30out" data-ref="30out" data-ref-filename="30out">out</dfn>:</td></tr>
<tr><th id="467">467</th><td><u>#<span data-ppcond="467">ifdef</span> <a class="macro" href="../../objdir.amd64/sys/arch/amd64/compile/GENERIC/opt_ipsec.h.html#1" data-ref="_M/IPSEC">IPSEC</a></u></td></tr>
<tr><th id="468">468</th><td>	<b>if</b> (<a class="local col8 ref" href="#28sp" title='sp' data-ref="28sp" data-ref-filename="28sp">sp</a> != <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="469">469</th><td>		<a class="macro" href="../netipsec/key.h.html#89" title="key_sp_unref(*(&amp;sp), __func__, 469)" data-ref="_M/KEY_SP_UNREF">KEY_SP_UNREF</a>(&amp;<a class="local col8 ref" href="#28sp" title='sp' data-ref="28sp" data-ref-filename="28sp">sp</a>);</td></tr>
<tr><th id="470">470</th><td><u>#<span data-ppcond="467">endif</span></u></td></tr>
<tr><th id="471">471</th><td>	<a class="ref fn" href="../net/route.h.html#rtcache_unref" title='rtcache_unref' data-ref="rtcache_unref" data-ref-filename="rtcache_unref">rtcache_unref</a>(<a class="local col4 ref" href="#14rt" title='rt' data-ref="14rt" data-ref-filename="14rt">rt</a>, <a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a>);</td></tr>
<tr><th id="472">472</th><td>	<b>if</b> (<a class="local col6 ref" href="#26ro" title='ro' data-ref="26ro" data-ref-filename="26ro">ro</a> != <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="473">473</th><td>		<a class="ref fn" href="../sys/percpu.h.html#percpu_putref" title='percpu_putref' data-ref="percpu_putref" data-ref-filename="percpu_putref">percpu_putref</a>(<a class="ref" href="#ip6_forward_rt_percpu" title='ip6_forward_rt_percpu' data-ref="ip6_forward_rt_percpu" data-ref-filename="ip6_forward_rt_percpu">ip6_forward_rt_percpu</a>);</td></tr>
<tr><th id="474">474</th><td>	<b>if</b> (<a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a> != <a class="macro" href="../sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>)</td></tr>
<tr><th id="475">475</th><td>		<a class="ref fn" href="../sys/mbuf.h.html#m_put_rcvif_psref" title='m_put_rcvif_psref' data-ref="m_put_rcvif_psref" data-ref-filename="m_put_rcvif_psref">m_put_rcvif_psref</a>(<a class="local col4 ref" href="#24rcvif" title='rcvif' data-ref="24rcvif" data-ref-filename="24rcvif">rcvif</a>, &amp;<a class="local col5 ref" href="#25psref" title='psref' data-ref="25psref" data-ref-filename="25psref">psref</a>);</td></tr>
<tr><th id="476">476</th><td>	<b>return</b>;</td></tr>
<tr><th id="477">477</th><td>}</td></tr>
<tr><th id="478">478</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
