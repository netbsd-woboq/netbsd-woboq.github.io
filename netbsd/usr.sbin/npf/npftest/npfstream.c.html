<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>npfstream.c source code [netbsd/usr.sbin/npf/npftest/npfstream.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="https://code.woboq.org/data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="https://code.woboq.org/data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="https://code.woboq.org/data/jquery/jquery-ui.min.js"></script>
<script>var file = 'netbsd/usr.sbin/npf/npftest/npfstream.c'; var root_path = '../../../..'; var data_path = 'https://code.woboq.org/data'; var ecma_script_api_version = 2;</script>
<script src='https://code.woboq.org/data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>netbsd</a>/<a href='../..'>usr.sbin</a>/<a href='..'>npf</a>/<a href='./'>npftest</a>/<a href='npfstream.c.html'>npfstream.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*	$NetBSD: npfstream.c,v 1.8 2019/01/19 21:19:32 rmind Exp $	*/</i></td></tr>
<tr><th id="2">2</th><td></td></tr>
<tr><th id="3">3</th><td><i>/*</i></td></tr>
<tr><th id="4">4</th><td><i> * NPF stream processor.</i></td></tr>
<tr><th id="5">5</th><td><i> *</i></td></tr>
<tr><th id="6">6</th><td><i> * Public Domain.</i></td></tr>
<tr><th id="7">7</th><td><i> */</i></td></tr>
<tr><th id="8">8</th><td></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html">&lt;stdio.h&gt;</a></u></td></tr>
<tr><th id="10">10</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html">&lt;stdlib.h&gt;</a></u></td></tr>
<tr><th id="11">11</th><td><u>#include &lt;stdbool.h&gt;</u></td></tr>
<tr><th id="12">12</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/string.h.html">&lt;string.h&gt;</a></u></td></tr>
<tr><th id="13">13</th><td><u>#include &lt;inttypes.h&gt;</u></td></tr>
<tr><th id="14">14</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/err.h.html">&lt;err.h&gt;</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html">&lt;pcap.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td></td></tr>
<tr><th id="17">17</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/arpa/inet.h.html">&lt;arpa/inet.h&gt;</a></u></td></tr>
<tr><th id="18">18</th><td></td></tr>
<tr><th id="19">19</th><td><u>#<span data-ppcond="19">if</span> !defined(<span class="macro" data-ref="_M/_NPF_STANDALONE">_NPF_STANDALONE</span>)</u></td></tr>
<tr><th id="20">20</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/net/if.h.html">&lt;net/if.h&gt;</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/net/ethertypes.h.html">&lt;net/ethertypes.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/net/if_ether.h.html">&lt;net/if_ether.h&gt;</a></u></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/in_systm.h.html">&lt;netinet/in_systm.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html">&lt;netinet/ip.h&gt;</a></u></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html">&lt;netinet/ip.h&gt;</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html">&lt;netinet/tcp.h&gt;</a></u></td></tr>
<tr><th id="27">27</th><td></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../../../objdir.amd64/destdir.amd64/usr/include/rump/rump.h.html">&lt;rump/rump.h&gt;</a></u></td></tr>
<tr><th id="29">29</th><td><u>#<span data-ppcond="19">endif</span></u></td></tr>
<tr><th id="30">30</th><td></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="npftest.h.html">"npftest.h"</a></u></td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td><em>static</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/in.h.html#in_addr" title='in_addr' data-ref="in_addr" data-ref-filename="in_addr">in_addr</a>	<dfn class="tu decl def" id="initial_ip" title='initial_ip' data-type='struct in_addr' data-ref="initial_ip" data-ref-filename="initial_ip">initial_ip</dfn>;</td></tr>
<tr><th id="34">34</th><td><em>static</em> <em>int</em>		<dfn class="tu decl def" id="snd_packet_no" title='snd_packet_no' data-type='int' data-ref="snd_packet_no" data-ref-filename="snd_packet_no">snd_packet_no</dfn> = <var>0</var>;</td></tr>
<tr><th id="35">35</th><td><em>static</em> <em>int</em>		<dfn class="tu decl def" id="rcv_packet_no" title='rcv_packet_no' data-type='int' data-ref="rcv_packet_no" data-ref-filename="rcv_packet_no">rcv_packet_no</dfn> = <var>0</var>;</td></tr>
<tr><th id="36">36</th><td></td></tr>
<tr><th id="37">37</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="38">38</th><td><dfn class="tu decl def fn" id="process_tcpip" title='process_tcpip' data-type='void process_tcpip(const void * data, size_t len, FILE * fp, ifnet_t * ifp)' data-ref="process_tcpip" data-ref-filename="process_tcpip">process_tcpip</dfn>(<em>const</em> <em>void</em> *<dfn class="local col1 decl" id="1data" title='data' data-type='const void *' data-ref="1data" data-ref-filename="1data">data</dfn>, <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#size_t" title='size_t' data-type='unsigned long' data-ref="size_t" data-ref-filename="size_t">size_t</a> <dfn class="local col2 decl" id="2len" title='len' data-type='size_t' data-ref="2len" data-ref-filename="2len">len</dfn>, <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#FILE" title='FILE' data-type='struct __sFILE' data-ref="FILE" data-ref-filename="FILE">FILE</a> *<dfn class="local col3 decl" id="3fp" title='fp' data-type='FILE *' data-ref="3fp" data-ref-filename="3fp">fp</dfn>, <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/net/if.h.html#ifnet_t" title='ifnet_t' data-type='struct ifnet' data-ref="ifnet_t" data-ref-filename="ifnet_t">ifnet_t</a> *<dfn class="local col4 decl" id="4ifp" title='ifp' data-type='ifnet_t *' data-ref="4ifp" data-ref-filename="4ifp">ifp</dfn>)</td></tr>
<tr><th id="39">39</th><td>{</td></tr>
<tr><th id="40">40</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/net/if_ether.h.html#ether_header" title='ether_header' data-ref="ether_header" data-ref-filename="ether_header">ether_header</a> *<dfn class="local col5 decl" id="5eth" title='eth' data-type='const struct ether_header *' data-ref="5eth" data-ref-filename="5eth">eth</dfn> = <a class="local col1 ref" href="#1data" title='data' data-ref="1data" data-ref-filename="1data">data</a>;</td></tr>
<tr><th id="41">41</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip" title='ip' data-ref="ip" data-ref-filename="ip">ip</a> *<dfn class="local col6 decl" id="6ip" title='ip' data-type='const struct ip *' data-ref="6ip" data-ref-filename="6ip">ip</dfn>;</td></tr>
<tr><th id="42">42</th><td>	<em>const</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a> *<dfn class="local col7 decl" id="7th" title='th' data-type='const struct tcphdr *' data-ref="7th" data-ref-filename="7th">th</dfn>;</td></tr>
<tr><th id="43">43</th><td>	<em>unsigned</em> <dfn class="local col8 decl" id="8hlen" title='hlen' data-type='unsigned int' data-ref="8hlen" data-ref-filename="8hlen">hlen</dfn>, <dfn class="local col9 decl" id="9tcpdlen" title='tcpdlen' data-type='unsigned int' data-ref="9tcpdlen" data-ref-filename="9tcpdlen">tcpdlen</dfn>;</td></tr>
<tr><th id="44">44</th><td>	<em>int</em> <dfn class="local col0 decl" id="10error" title='error' data-type='int' data-ref="10error" data-ref-filename="10error">error</dfn>, <dfn class="local col1 decl" id="11packetno" title='packetno' data-type='int' data-ref="11packetno" data-ref-filename="11packetno">packetno</dfn>;</td></tr>
<tr><th id="45">45</th><td>	<em>const</em> <em>void</em> *<dfn class="local col2 decl" id="12p" title='p' data-type='const void *' data-ref="12p" data-ref-filename="12p">p</dfn>;</td></tr>
<tr><th id="46">46</th><td>	<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcp_seq" title='tcp_seq' data-type='uint32_t' data-ref="tcp_seq" data-ref-filename="tcp_seq">tcp_seq</a> <dfn class="local col3 decl" id="13seq" title='seq' data-type='tcp_seq' data-ref="13seq" data-ref-filename="13seq">seq</dfn>;</td></tr>
<tr><th id="47">47</th><td>	<span class="macro" title="_Bool" data-ref="_M/bool">bool</span> <dfn class="local col4 decl" id="14forw" title='forw' data-type='_Bool' data-ref="14forw" data-ref-filename="14forw">forw</dfn>;</td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td>	<b>if</b> (<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#126" title="((uint16_t)(__builtin_constant_p((((uint16_t)((eth-&gt;ether_type))))) ? (((uint16_t)(((((((uint16_t)((eth-&gt;ether_type)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((eth-&gt;ether_type)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((eth-&gt;ether_type))))))" data-ref="_M/ntohs">ntohs</a>(<a class="local col5 ref" href="#5eth" title='eth' data-ref="5eth" data-ref-filename="5eth">eth</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/net/if_ether.h.html#ether_header::ether_type" title='ether_header::ether_type' data-ref="ether_header::ether_type" data-ref-filename="ether_header..ether_type">ether_type</a>) != <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/net/ethertypes.h.html#67" title="0x0800" data-ref="_M/ETHERTYPE_IP">ETHERTYPE_IP</a>) {</td></tr>
<tr><th id="50">50</th><td>		<a class="local col2 ref" href="#12p" title='p' data-ref="12p" data-ref-filename="12p">p</a> = (<em>const</em> <em>char</em> *)<a class="local col1 ref" href="#1data" title='data' data-ref="1data" data-ref-filename="1data">data</a> + <var>4</var>;</td></tr>
<tr><th id="51">51</th><td>	} <b>else</b> {</td></tr>
<tr><th id="52">52</th><td>		<a class="local col2 ref" href="#12p" title='p' data-ref="12p" data-ref-filename="12p">p</a> = <a class="local col5 ref" href="#5eth" title='eth' data-ref="5eth" data-ref-filename="5eth">eth</a> + <var>1</var>;</td></tr>
<tr><th id="53">53</th><td>	}</td></tr>
<tr><th id="54">54</th><td>	<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a> = (<em>const</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip" title='ip' data-ref="ip" data-ref-filename="ip">ip</a> *)<a class="local col2 ref" href="#12p" title='p' data-ref="12p" data-ref-filename="12p">p</a>;</td></tr>
<tr><th id="55">55</th><td>	<a class="local col8 ref" href="#8hlen" title='hlen' data-ref="8hlen" data-ref-filename="8hlen">hlen</a> = <a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip::ip_hl" title='ip::ip_hl' data-ref="ip::ip_hl" data-ref-filename="ip..ip_hl">ip_hl</a> &lt;&lt; <var>2</var>;</td></tr>
<tr><th id="56">56</th><td>	<a class="local col2 ref" href="#12p" title='p' data-ref="12p" data-ref-filename="12p">p</a> = (<em>const</em> <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *)<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a> + <a class="local col8 ref" href="#8hlen" title='hlen' data-ref="8hlen" data-ref-filename="8hlen">hlen</a>;</td></tr>
<tr><th id="57">57</th><td>	<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a> = (<em>const</em> <b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr" title='tcphdr' data-ref="tcphdr" data-ref-filename="tcphdr">tcphdr</a> *)<a class="local col2 ref" href="#12p" title='p' data-ref="12p" data-ref-filename="12p">p</a>;</td></tr>
<tr><th id="58">58</th><td></td></tr>
<tr><th id="59">59</th><td>	<a class="local col9 ref" href="#9tcpdlen" title='tcpdlen' data-ref="9tcpdlen" data-ref-filename="9tcpdlen">tcpdlen</a> = <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#126" title="((uint16_t)(__builtin_constant_p((((uint16_t)((ip-&gt;ip_len))))) ? (((uint16_t)(((((((uint16_t)((ip-&gt;ip_len)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((ip-&gt;ip_len)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((ip-&gt;ip_len))))))" data-ref="_M/ntohs">ntohs</a>(<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip::ip_len" title='ip::ip_len' data-ref="ip::ip_len" data-ref-filename="ip..ip_len">ip_len</a>) - <a class="local col8 ref" href="#8hlen" title='hlen' data-ref="8hlen" data-ref-filename="8hlen">hlen</a> - (<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_off" title='tcphdr::th_off' data-ref="tcphdr::th_off" data-ref-filename="tcphdr..th_off">th_off</a> &lt;&lt; <var>2</var>);</td></tr>
<tr><th id="60">60</th><td>	<b>if</b> (<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_flags" title='tcphdr::th_flags' data-ref="tcphdr::th_flags" data-ref-filename="tcphdr..th_flags">th_flags</a> &amp; <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#65" title="0x02" data-ref="_M/TH_SYN">TH_SYN</a>) {</td></tr>
<tr><th id="61">61</th><td>		<a class="local col9 ref" href="#9tcpdlen" title='tcpdlen' data-ref="9tcpdlen" data-ref-filename="9tcpdlen">tcpdlen</a>++;</td></tr>
<tr><th id="62">62</th><td>	}</td></tr>
<tr><th id="63">63</th><td>	<b>if</b> (<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_flags" title='tcphdr::th_flags' data-ref="tcphdr::th_flags" data-ref-filename="tcphdr..th_flags">th_flags</a> &amp; <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#64" title="0x01" data-ref="_M/TH_FIN">TH_FIN</a>) {</td></tr>
<tr><th id="64">64</th><td>		<a class="local col9 ref" href="#9tcpdlen" title='tcpdlen' data-ref="9tcpdlen" data-ref-filename="9tcpdlen">tcpdlen</a>++;</td></tr>
<tr><th id="65">65</th><td>	}</td></tr>
<tr><th id="66">66</th><td>	<a class="local col3 ref" href="#13seq" title='seq' data-ref="13seq" data-ref-filename="13seq">seq</a> = <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#125" title="((uint32_t)(__builtin_constant_p((((uint32_t)((th-&gt;th_seq))))) ? (((uint32_t)(((((((uint32_t)((th-&gt;th_seq)))) &amp; 0xff000000) &gt;&gt; 24) | (((((uint32_t)((th-&gt;th_seq)))) &amp; 0x00ff0000) &gt;&gt; 8) | (((((uint32_t)((th-&gt;th_seq)))) &amp; 0x0000ff00) &lt;&lt; 8) | (((((uint32_t)((th-&gt;th_seq)))) &amp; 0x000000ff) &lt;&lt; 24))))) : __byte_swap_u32_variable(((uint32_t)((th-&gt;th_seq))))))" data-ref="_M/ntohl">ntohl</a>(<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_seq" title='tcphdr::th_seq' data-ref="tcphdr::th_seq" data-ref-filename="tcphdr..th_seq">th_seq</a>);</td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td>	<b>if</b> (<a class="tu ref" href="#snd_packet_no" title='snd_packet_no' data-use='r' data-ref="snd_packet_no" data-ref-filename="snd_packet_no">snd_packet_no</a> == <var>0</var>) {</td></tr>
<tr><th id="69">69</th><td>		<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memcpy" title='memcpy' data-ref="memcpy" data-ref-filename="memcpy">memcpy</a>(&amp;<a class="tu ref" href="#initial_ip" title='initial_ip' data-use='a' data-ref="initial_ip" data-ref-filename="initial_ip">initial_ip</a>, &amp;<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip::ip_src" title='ip::ip_src' data-ref="ip::ip_src" data-ref-filename="ip..ip_src">ip_src</a>, <b>sizeof</b>(<b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/in.h.html#in_addr" title='in_addr' data-ref="in_addr" data-ref-filename="in_addr">in_addr</a>));</td></tr>
<tr><th id="70">70</th><td>	}</td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td>	<a class="local col4 ref" href="#14forw" title='forw' data-ref="14forw" data-ref-filename="14forw">forw</a> = (<a class="tu ref" href="#initial_ip" title='initial_ip' data-use='m' data-ref="initial_ip" data-ref-filename="initial_ip">initial_ip</a>.<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/in.h.html#in_addr::s_addr" title='in_addr::s_addr' data-ref="in_addr::s_addr" data-ref-filename="in_addr..s_addr">s_addr</a> == <a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip::ip_src" title='ip::ip_src' data-ref="ip::ip_src" data-ref-filename="ip..ip_src">ip_src</a>.<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/in.h.html#in_addr::s_addr" title='in_addr::s_addr' data-ref="in_addr::s_addr" data-ref-filename="in_addr..s_addr">s_addr</a>);</td></tr>
<tr><th id="73">73</th><td>	<a class="local col1 ref" href="#11packetno" title='packetno' data-ref="11packetno" data-ref-filename="11packetno">packetno</a> = <a class="local col4 ref" href="#14forw" title='forw' data-ref="14forw" data-ref-filename="14forw">forw</a> ? ++<a class="tu ref" href="#snd_packet_no" title='snd_packet_no' data-use='w' data-ref="snd_packet_no" data-ref-filename="snd_packet_no">snd_packet_no</a> : ++<a class="tu ref" href="#rcv_packet_no" title='rcv_packet_no' data-use='w' data-ref="rcv_packet_no" data-ref-filename="rcv_packet_no">rcv_packet_no</a>;</td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td>	<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#int64_t" title='int64_t' data-type='__int64_t' data-ref="int64_t" data-ref-filename="int64_t">int64_t</a> <dfn class="local col5 decl" id="15result" title='result' data-type='int64_t [11]' data-ref="15result" data-ref-filename="15result">result</dfn>[<var>11</var>];</td></tr>
<tr><th id="76">76</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/string.h.html#memset" title='memset' data-ref="memset" data-ref-filename="memset">memset</a>(<a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>, <var>0</var>, <b>sizeof</b>(<a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>));</td></tr>
<tr><th id="77">77</th><td></td></tr>
<tr><th id="78">78</th><td>	<a class="local col2 ref" href="#2len" title='len' data-ref="2len" data-ref-filename="2len">len</a> = <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#126" title="((uint16_t)(__builtin_constant_p((((uint16_t)((ip-&gt;ip_len))))) ? (((uint16_t)(((((((uint16_t)((ip-&gt;ip_len)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((ip-&gt;ip_len)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((ip-&gt;ip_len))))))" data-ref="_M/ntohs">ntohs</a>(<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/ip.h.html#ip::ip_len" title='ip::ip_len' data-ref="ip::ip_len" data-ref-filename="ip..ip_len">ip_len</a>);</td></tr>
<tr><th id="79">79</th><td>	<a class="local col0 ref" href="#10error" title='error' data-ref="10error" data-ref-filename="10error">error</a> = <a class="ref fn" href="npftest.h.html#rumpns_npf_test_statetrack" title='rumpns_npf_test_statetrack' data-ref="rumpns_npf_test_statetrack" data-ref-filename="rumpns_npf_test_statetrack">rumpns_npf_test_statetrack</a>(<a class="local col6 ref" href="#6ip" title='ip' data-ref="6ip" data-ref-filename="6ip">ip</a>, <a class="local col2 ref" href="#2len" title='len' data-ref="2len" data-ref-filename="2len">len</a>, <a class="local col4 ref" href="#4ifp" title='ifp' data-ref="4ifp" data-ref-filename="4ifp">ifp</a>, <a class="local col4 ref" href="#14forw" title='forw' data-ref="14forw" data-ref-filename="14forw">forw</a>, <a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>);</td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fprintf" title='fprintf' data-ref="fprintf" data-ref-filename="fprintf">fprintf</a>(<a class="local col3 ref" href="#3fp" title='fp' data-ref="3fp" data-ref-filename="3fp">fp</a>, <q>"%s%2x %5d %3d %11u %11u %11u %11u %12"</q> <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/common_int_fmtio.h.html#119" title="&quot;lx&quot;" data-ref="_M/PRIxPTR">PRIxPTR</a>,</td></tr>
<tr><th id="82">82</th><td>	    <a class="local col4 ref" href="#14forw" title='forw' data-ref="14forw" data-ref-filename="14forw">forw</a> ? <q>"&gt;"</q> : <q>"&lt;"</q>, (<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_flags" title='tcphdr::th_flags' data-ref="tcphdr::th_flags" data-ref-filename="tcphdr..th_flags">th_flags</a> &amp; (<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#65" title="0x02" data-ref="_M/TH_SYN">TH_SYN</a> | <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#68" title="0x10" data-ref="_M/TH_ACK">TH_ACK</a> | <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#64" title="0x01" data-ref="_M/TH_FIN">TH_FIN</a>)),</td></tr>
<tr><th id="83">83</th><td>	    <a class="local col1 ref" href="#11packetno" title='packetno' data-ref="11packetno" data-ref-filename="11packetno">packetno</a>, <a class="local col0 ref" href="#10error" title='error' data-ref="10error" data-ref-filename="10error">error</a>, (<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>)<a class="local col3 ref" href="#13seq" title='seq' data-ref="13seq" data-ref-filename="13seq">seq</a>, (<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#u_int" title='u_int' data-type='unsigned int' data-ref="u_int" data-ref-filename="u_int">u_int</a>)<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#125" title="((uint32_t)(__builtin_constant_p((((uint32_t)((th-&gt;th_ack))))) ? (((uint32_t)(((((((uint32_t)((th-&gt;th_ack)))) &amp; 0xff000000) &gt;&gt; 24) | (((((uint32_t)((th-&gt;th_ack)))) &amp; 0x00ff0000) &gt;&gt; 8) | (((((uint32_t)((th-&gt;th_ack)))) &amp; 0x0000ff00) &lt;&lt; 8) | (((((uint32_t)((th-&gt;th_ack)))) &amp; 0x000000ff) &lt;&lt; 24))))) : __byte_swap_u32_variable(((uint32_t)((th-&gt;th_ack))))))" data-ref="_M/ntohl">ntohl</a>(<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_ack" title='tcphdr::th_ack' data-ref="tcphdr::th_ack" data-ref-filename="tcphdr..th_ack">th_ack</a>),</td></tr>
<tr><th id="84">84</th><td>	    <a class="local col9 ref" href="#9tcpdlen" title='tcpdlen' data-ref="9tcpdlen" data-ref-filename="9tcpdlen">tcpdlen</a>, <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/endian.h.html#126" title="((uint16_t)(__builtin_constant_p((((uint16_t)((th-&gt;th_win))))) ? (((uint16_t)(((((((uint16_t)((th-&gt;th_win)))) &amp; 0xff00) &gt;&gt; 8) | (((((uint16_t)((th-&gt;th_win)))) &amp; 0x00ff) &lt;&lt; 8))))) : __byte_swap_u16_variable(((uint16_t)((th-&gt;th_win))))))" data-ref="_M/ntohs">ntohs</a>(<a class="local col7 ref" href="#7th" title='th' data-ref="7th" data-ref-filename="7th">th</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/netinet/tcp.h.html#tcphdr::th_win" title='tcphdr::th_win' data-ref="tcphdr::th_win" data-ref-filename="tcphdr..th_win">th_win</a>), (<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/stdint.h.html#uintptr_t" title='uintptr_t' data-type='__uintptr_t' data-ref="uintptr_t" data-ref-filename="uintptr_t">uintptr_t</a>)<a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>[<var>0</var>]);</td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td>	<b>for</b> (<em>unsigned</em> <dfn class="local col6 decl" id="16i" title='i' data-type='unsigned int' data-ref="16i" data-ref-filename="16i">i</dfn> = <var>1</var>; <a class="local col6 ref" href="#16i" title='i' data-ref="16i" data-ref-filename="16i">i</a> &lt; <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/cdefs.h.html#580" title="(sizeof(result) / sizeof(result[0]))" data-ref="_M/__arraycount">__arraycount</a>(<a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>); <a class="local col6 ref" href="#16i" title='i' data-ref="16i" data-ref-filename="16i">i</a>++) {</td></tr>
<tr><th id="87">87</th><td>		<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fprintf" title='fprintf' data-ref="fprintf" data-ref-filename="fprintf">fprintf</a>(<a class="local col3 ref" href="#3fp" title='fp' data-ref="3fp" data-ref-filename="3fp">fp</a>, <q>"%11"</q> <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/common_int_fmtio.h.html#94" title="&quot;lu&quot;" data-ref="_M/PRIu64">PRIu64</a> <q>" "</q>, <a class="local col5 ref" href="#15result" title='result' data-ref="15result" data-ref-filename="15result">result</a>[<a class="local col6 ref" href="#16i" title='i' data-ref="16i" data-ref-filename="16i">i</a>]);</td></tr>
<tr><th id="88">88</th><td>	}</td></tr>
<tr><th id="89">89</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fputs" title='fputs' data-ref="fputs" data-ref-filename="fputs">fputs</a>(<q>"\n"</q>, <a class="local col3 ref" href="#3fp" title='fp' data-ref="3fp" data-ref-filename="3fp">fp</a>);</td></tr>
<tr><th id="90">90</th><td>}</td></tr>
<tr><th id="91">91</th><td></td></tr>
<tr><th id="92">92</th><td><em>int</em></td></tr>
<tr><th id="93">93</th><td><dfn class="decl def fn" id="process_stream" title='process_stream' data-ref="process_stream" data-ref-filename="process_stream">process_stream</dfn>(<em>const</em> <em>char</em> *<dfn class="local col7 decl" id="17input" title='input' data-type='const char *' data-ref="17input" data-ref-filename="17input">input</dfn>, <em>const</em> <em>char</em> *<dfn class="local col8 decl" id="18output" title='output' data-type='const char *' data-ref="18output" data-ref-filename="18output">output</dfn>, <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/net/if.h.html#ifnet_t" title='ifnet_t' data-type='struct ifnet' data-ref="ifnet_t" data-ref-filename="ifnet_t">ifnet_t</a> *<dfn class="local col9 decl" id="19ifp" title='ifp' data-type='ifnet_t *' data-ref="19ifp" data-ref-filename="19ifp">ifp</dfn>)</td></tr>
<tr><th id="94">94</th><td>{</td></tr>
<tr><th id="95">95</th><td>	<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_t" title='pcap_t' data-type='struct pcap' data-ref="pcap_t" data-ref-filename="pcap_t">pcap_t</a> *<dfn class="local col0 decl" id="20pcap" title='pcap' data-type='pcap_t *' data-ref="20pcap" data-ref-filename="20pcap">pcap</dfn>;</td></tr>
<tr><th id="96">96</th><td>	<em>char</em> <dfn class="local col1 decl" id="21pcap_errbuf" title='pcap_errbuf' data-type='char [256]' data-ref="21pcap_errbuf" data-ref-filename="21pcap_errbuf">pcap_errbuf</dfn>[<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#111" title="256" data-ref="_M/PCAP_ERRBUF_SIZE">PCAP_ERRBUF_SIZE</a>];</td></tr>
<tr><th id="97">97</th><td>	<b>struct</b> <a class="type" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_pkthdr" title='pcap_pkthdr' data-ref="pcap_pkthdr" data-ref-filename="pcap_pkthdr">pcap_pkthdr</a> *<dfn class="local col2 decl" id="22phdr" title='phdr' data-type='struct pcap_pkthdr *' data-ref="22phdr" data-ref-filename="22phdr">phdr</dfn>;</td></tr>
<tr><th id="98">98</th><td>	<em>const</em> <a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/types.h.html#uint8_t" title='uint8_t' data-type='__uint8_t' data-ref="uint8_t" data-ref-filename="uint8_t">uint8_t</a> *<dfn class="local col3 decl" id="23data" title='data' data-type='const uint8_t *' data-ref="23data" data-ref-filename="23data">data</dfn>;</td></tr>
<tr><th id="99">99</th><td>	<a class="typedef" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#FILE" title='FILE' data-type='struct __sFILE' data-ref="FILE" data-ref-filename="FILE">FILE</a> *<dfn class="local col4 decl" id="24fp" title='fp' data-type='FILE *' data-ref="24fp" data-ref-filename="24fp">fp</dfn>;</td></tr>
<tr><th id="100">100</th><td></td></tr>
<tr><th id="101">101</th><td>	<a class="local col0 ref" href="#20pcap" title='pcap' data-ref="20pcap" data-ref-filename="20pcap">pcap</a> = <a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_open_offline" title='pcap_open_offline' data-ref="pcap_open_offline" data-ref-filename="pcap_open_offline">pcap_open_offline</a>(<a class="local col7 ref" href="#17input" title='input' data-ref="17input" data-ref-filename="17input">input</a>, <a class="local col1 ref" href="#21pcap_errbuf" title='pcap_errbuf' data-ref="21pcap_errbuf" data-ref-filename="21pcap_errbuf">pcap_errbuf</a>);</td></tr>
<tr><th id="102">102</th><td>	<b>if</b> (<a class="local col0 ref" href="#20pcap" title='pcap' data-ref="20pcap" data-ref-filename="20pcap">pcap</a> == <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="103">103</th><td>		<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/err.h.html#errx" title='errx' data-ref="errx" data-ref-filename="errx">errx</a>(<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#87" title="1" data-ref="_M/EXIT_FAILURE">EXIT_FAILURE</a>, <q>"pcap_open_offline failed: %s"</q>, <a class="local col1 ref" href="#21pcap_errbuf" title='pcap_errbuf' data-ref="21pcap_errbuf" data-ref-filename="21pcap_errbuf">pcap_errbuf</a>);</td></tr>
<tr><th id="104">104</th><td>	}</td></tr>
<tr><th id="105">105</th><td>	<a class="local col4 ref" href="#24fp" title='fp' data-ref="24fp" data-ref-filename="24fp">fp</a> = <a class="local col8 ref" href="#18output" title='output' data-ref="18output" data-ref-filename="18output">output</a> ? <a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fopen" title='fopen' data-ref="fopen" data-ref-filename="fopen">fopen</a>(<a class="local col8 ref" href="#18output" title='output' data-ref="18output" data-ref-filename="18output">output</a>, <q>"w"</q>) : <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#216" title="(&amp;__sF[1])" data-ref="_M/stdout">stdout</a>;</td></tr>
<tr><th id="106">106</th><td>	<b>if</b> (<a class="local col4 ref" href="#24fp" title='fp' data-ref="24fp" data-ref-filename="24fp">fp</a> == <a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/sys/null.h.html#13" title="((void *)0)" data-ref="_M/NULL">NULL</a>) {</td></tr>
<tr><th id="107">107</th><td>		<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/err.h.html#err" title='err' data-ref="err" data-ref-filename="err">err</a>(<a class="macro" href="../../../objdir.amd64/destdir.amd64/usr/include/stdlib.h.html#87" title="1" data-ref="_M/EXIT_FAILURE">EXIT_FAILURE</a>, <q>"fopen"</q>);</td></tr>
<tr><th id="108">108</th><td>	}</td></tr>
<tr><th id="109">109</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fprintf" title='fprintf' data-ref="fprintf" data-ref-filename="fprintf">fprintf</a>(<a class="local col4 ref" href="#24fp" title='fp' data-ref="24fp" data-ref-filename="24fp">fp</a>, <q>"#FL %5s %3s %11s %11s %11s %11s %11s %11s %11s "</q></td></tr>
<tr><th id="110">110</th><td>	    <q>"%11s %11s %11s %5s %11s %11s %11s %5s\n"</q>,</td></tr>
<tr><th id="111">111</th><td>	    <q>"No"</q>, <q>"Err"</q>, <q>"Seq"</q>, <q>"Ack"</q>, <q>"TCP Len"</q>, <q>"Win"</q>,</td></tr>
<tr><th id="112">112</th><td>	    <q>"Stream"</q>, <q>"RetVal"</q>, <q>"State"</q>,</td></tr>
<tr><th id="113">113</th><td>	    <q>"F.END"</q>, <q>"F.MAXEND"</q>, <q>"F.MAXWIN"</q>, <q>"F.WSC"</q>,</td></tr>
<tr><th id="114">114</th><td>	    <q>"T.END"</q>, <q>"T.MAXEND"</q>, <q>"T.MAXWIN"</q>, <q>"T.WSC"</q>);</td></tr>
<tr><th id="115">115</th><td>	<b>while</b> (<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_next_ex" title='pcap_next_ex' data-ref="pcap_next_ex" data-ref-filename="pcap_next_ex">pcap_next_ex</a>(<a class="local col0 ref" href="#20pcap" title='pcap' data-ref="20pcap" data-ref-filename="20pcap">pcap</a>, &amp;<a class="local col2 ref" href="#22phdr" title='phdr' data-ref="22phdr" data-ref-filename="22phdr">phdr</a>, &amp;<a class="local col3 ref" href="#23data" title='data' data-ref="23data" data-ref-filename="23data">data</a>) &gt; <var>0</var>) {</td></tr>
<tr><th id="116">116</th><td>		<b>if</b> (<a class="local col2 ref" href="#22phdr" title='phdr' data-ref="22phdr" data-ref-filename="22phdr">phdr</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_pkthdr::len" title='pcap_pkthdr::len' data-ref="pcap_pkthdr::len" data-ref-filename="pcap_pkthdr..len">len</a> != <a class="local col2 ref" href="#22phdr" title='phdr' data-ref="22phdr" data-ref-filename="22phdr">phdr</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_pkthdr::caplen" title='pcap_pkthdr::caplen' data-ref="pcap_pkthdr::caplen" data-ref-filename="pcap_pkthdr..caplen">caplen</a>) {</td></tr>
<tr><th id="117">117</th><td>			<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/err.h.html#warnx" title='warnx' data-ref="warnx" data-ref-filename="warnx">warnx</a>(<q>"process_stream: truncated packet"</q>);</td></tr>
<tr><th id="118">118</th><td>		}</td></tr>
<tr><th id="119">119</th><td>		<a class="tu ref fn" href="#process_tcpip" title='process_tcpip' data-use='c' data-ref="process_tcpip" data-ref-filename="process_tcpip">process_tcpip</a>(<a class="local col3 ref" href="#23data" title='data' data-ref="23data" data-ref-filename="23data">data</a>, <a class="local col2 ref" href="#22phdr" title='phdr' data-ref="22phdr" data-ref-filename="22phdr">phdr</a>-&gt;<a class="ref field" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_pkthdr::caplen" title='pcap_pkthdr::caplen' data-ref="pcap_pkthdr::caplen" data-ref-filename="pcap_pkthdr..caplen">caplen</a>, <a class="local col4 ref" href="#24fp" title='fp' data-ref="24fp" data-ref-filename="24fp">fp</a>, <a class="local col9 ref" href="#19ifp" title='ifp' data-ref="19ifp" data-ref-filename="19ifp">ifp</a>);</td></tr>
<tr><th id="120">120</th><td>	}</td></tr>
<tr><th id="121">121</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/pcap/pcap.h.html#pcap_close" title='pcap_close' data-ref="pcap_close" data-ref-filename="pcap_close">pcap_close</a>(<a class="local col0 ref" href="#20pcap" title='pcap' data-ref="20pcap" data-ref-filename="20pcap">pcap</a>);</td></tr>
<tr><th id="122">122</th><td>	<a class="ref fn" href="../../../objdir.amd64/destdir.amd64/usr/include/stdio.h.html#fclose" title='fclose' data-ref="fclose" data-ref-filename="fclose">fclose</a>(<a class="local col4 ref" href="#24fp" title='fp' data-ref="24fp" data-ref-filename="24fp">fp</a>);</td></tr>
<tr><th id="123">123</th><td></td></tr>
<tr><th id="124">124</th><td>	<b>return</b> <var>0</var>;</td></tr>
<tr><th id="125">125</th><td>}</td></tr>
<tr><th id="126">126</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2019-Jul-19</em> from project netbsd revision <em>f9da89e0d</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
